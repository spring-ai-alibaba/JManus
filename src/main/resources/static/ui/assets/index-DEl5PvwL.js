import{d as _e,u as Me,a as g,b as h,n as ce,e as n,f as B,g as A,i as d,h as ie,t as u,y as Ge,F as ue,q as me,j as ge,l as ye,A as ms,c as Z,B as nt,r as F,o as De,C as de,D as Le,w as ve,m as Se,E as Ut,G as xt,v as eo,H as hs,I as Ue,J as fs,z as xe,T as Lt,p as Ke,K as to,M as so,N as st,O as oo,x as no}from"./index-Bs8-iiUO.js";import{I as D,_ as we}from"./_plugin-vue_export-helper-Teo9pMJO.js";import{u as vt,m as Te,P as ao,D as Gt,a as Xe,s as Re,t as oe,b as lo}from"./templateStore-mSMDVqGm.js";import{L as ro}from"./LanguageSwitcher-mxaUzvyQ.js";import{M as vs,u as gs,a as ys}from"./useToast-T3RR-vkj.js";import"./llm-check-CJy4TeZw.js";const io={class:"sub-plan-info"},co={class:"sub-plan-details"},uo={class:"sub-plan-title"},po={key:0,class:"nesting-level"},mo={class:"sub-plan-id"},ho={class:"sub-plan-meta"},fo={key:0,class:"trigger-tool"},vo={class:"trigger-text"},go={key:0,class:"sub-plan-progress"},yo={class:"progress-info"},bo={class:"progress-text"},_o={class:"progress-bar"},wo={key:1,class:"sub-plan-agents-steps"},$o={class:"agents-steps-header"},So={class:"agents-label"},To={class:"agents-steps-list"},ko=["onClick"],Eo={class:"agent-step-header"},Po=["title"],Co={class:"sub-agent-execution-info"},Io={key:0,class:"agent-result"},Ro={class:"result-header"},xo={class:"result-label"},Ao={class:"result-content"},Fo={key:1,class:"agent-error"},Do={class:"error-header"},Mo={class:"error-label"},No={class:"error-content"},Uo={key:2,class:"think-act-preview"},Lo={class:"think-act-header"},Oo={class:"think-act-label"},qo={class:"think-act-steps-preview"},Bo=["onClick"],Ho={class:"step-number"},jo={class:"step-description"},Vo={key:0,class:"more-steps"},zo={class:"more-steps-text"},Wo={key:3,class:"nested-sub-plans"},Go={class:"nested-sub-plans-header"},Ko={class:"nested-label"},Jo={class:"nested-sub-plans-list"},Xo={key:4,class:"direct-sub-plans"},Qo={class:"direct-sub-plans-header"},Yo={class:"direct-label"},Zo={class:"direct-sub-plans-list"},en=_e({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=o,s=t,{t:a}=Me(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(G=>G.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(G=>G.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},_=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},i=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const T=c();return Math.min(100,T/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(T=>T.status==="FINISHED").length:0,f=T=>{switch(T){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},E=T=>{switch(T){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},P=T=>{switch(T){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},p=T=>T.thinkActSteps?.some(U=>U.subPlanExecutionRecord)??!1,S=T=>T.thinkActSteps?.filter(U=>U.subPlanExecutionRecord)??[],y=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},v=(T,U)=>{const G=U.stepId??`subplan-${e.subPlanIndex}-agent-${T}`;s("step-selected",G)},R=(T,U,G)=>{const x=G.stepId??`subplan-${e.subPlanIndex}-agent-${T}`;s("step-selected",x)},C=(T,U,G)=>{s("sub-plan-selected",T,U,G)},N=T=>{s("step-selected",T)};return(T,U)=>{const G=ms("RecursiveSubPlan",!0);return h(),g("div",{class:ce(["recursive-sub-plan",l()])},[n("div",{class:"sub-plan-header",onClick:y},[n("div",io,[A(d(D),{icon:_(),class:"sub-plan-status-icon"},null,8,["icon"]),n("div",co,[n("div",uo,[ie(u(T.subPlan.title||T.$t("chat.subPlan"))+" #"+u(T.subPlanIndex+1)+" ",1),(T.nestingLevel??0)>0?(h(),g("span",po,"(L"+u((T.nestingLevel??0)+1)+")",1)):B("",!0)]),n("div",mo,u(T.subPlan.currentPlanId),1)])]),n("div",ho,[n("div",{class:ce(["sub-plan-status-badge",r()])},u(m()),3),T.subPlan.parentActToolCall?(h(),g("div",fo,[A(d(D),{icon:"carbon:function",class:"trigger-icon"}),n("span",vo,u(T.subPlan.parentActToolCall.name),1)])):B("",!0)])]),T.subPlan.agentExecutionSequence?.length?(h(),g("div",go,[n("div",yo,[n("span",bo,u(T.$t("chat.progress"))+": "+u(c())+" / "+u(T.subPlan.agentExecutionSequence.length),1),n("div",_o,[n("div",{class:"progress-fill",style:Ge({width:i()+"%"})},null,4)])])])):B("",!0),T.subPlan.agentExecutionSequence?.length?(h(),g("div",wo,[n("div",$o,[n("span",So,u(T.$t("chat.agentExecutions"))+":",1)]),n("div",To,[(h(!0),g(ue,null,me(T.subPlan.agentExecutionSequence,(x,V)=>(h(),g("div",{key:x.id||V,class:ce(["agent-step-item",f(x.status)]),onClick:w=>v(V,x)},[n("div",Eo,[A(d(D),{icon:E(x.status),class:"agent-icon"},null,8,["icon"]),n("span",{class:"agent-name",title:x.agentName==="ConfigurableDynaAgent"?T.$t("chat.clickToViewExecutionDetails"):""},u(x.agentName==="ConfigurableDynaAgent"?T.$t("chat.funcAgentExecutionDetails"):x.agentName||T.$t("chat.unknownAgent")),9,Po),n("div",{class:ce(["agent-status-badge",f(x.status)])},u(P(x.status)),3)]),n("div",Co,[x.result?(h(),g("div",Io,[n("div",Ro,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),n("span",xo,u(T.$t("chat.agentResult"))+":",1)]),n("pre",Ao,u(x.result),1)])):B("",!0),x.errorMessage?(h(),g("div",Fo,[n("div",Do,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),n("span",Mo,u(T.$t("chat.errorMessage"))+":",1)]),n("pre",No,u(x.errorMessage),1)])):B("",!0),x.thinkActSteps?.length?(h(),g("div",Uo,[n("div",Lo,[A(d(D),{icon:"carbon:thinking",class:"think-act-icon"}),n("span",Oo,u(T.$t("chat.thinkActSteps"))+" ("+u(x.thinkActSteps.length)+")",1)]),n("div",qo,[(h(!0),g(ue,null,me(x.thinkActSteps.slice(0,T.maxVisibleSteps??2),(w,b)=>(h(),g("div",{key:w.id||b,class:"think-act-step-preview",onClick:ge($=>R(V,b,x),["stop"])},[n("span",Ho,"#"+u(b+1),1),n("span",jo,u(w.actionDescription||T.$t("chat.thinking")),1),A(d(D),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Bo))),128)),x.thinkActSteps.length>(T.maxVisibleSteps??2)?(h(),g("div",Vo,[n("span",zo,u(T.$t("chat.andMoreSteps",{count:x.thinkActSteps.length-(T.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),p(x)?(h(),g("div",Wo,[n("div",Go,[A(d(D),{icon:"carbon:tree-view-alt",class:"nested-icon"}),n("span",Ko,u(T.$t("chat.nestedSubPlans")),1)]),n("div",Jo,[(h(!0),g(ue,null,me(S(x),(w,b)=>(h(),ye(G,{key:w.id||b,"sub-plan":w.subPlanExecutionRecord,"sub-plan-index":b,"nesting-level":(T.nestingLevel??0)+1,"max-nesting-depth":T.maxNestingDepth??3,"max-visible-steps":T.maxVisibleSteps??2,onSubPlanSelected:C,onStepSelected:N},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),x.subPlanExecutionRecords?.length?(h(),g("div",Xo,[n("div",Qo,[A(d(D),{icon:"carbon:tree-view",class:"direct-icon"}),n("span",Yo,u(T.$t("chat.directSubPlans")),1)]),n("div",Zo,[(h(!0),g(ue,null,me(x.subPlanExecutionRecords,(w,b)=>(h(),ye(G,{key:w.currentPlanId||b,"sub-plan":w,"sub-plan-index":b,"nesting-level":(T.nestingLevel??0)+1,"max-nesting-depth":T.maxNestingDepth??3,"max-visible-steps":T.maxVisibleSteps??2,onSubPlanSelected:C,onStepSelected:N},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,ko))),128))])])):B("",!0)],2)}}}),tn=we(en,[["__scopeId","data-v-36486b62"]]),sn={class:"execution-details"},on={key:0,class:"plan-overview"},nn={key:0,class:"parent-tool-call"},an={class:"parent-tool-header"},ln={class:"tool-label"},rn={class:"tool-name"},cn={key:0,class:"tool-parameters"},un={class:"param-label"},dn={class:"param-content"},pn={key:1,class:"agent-execution-container"},mn={class:"section-title"},hn=["onClick"],fn={class:"agent-info"},vn={class:"agent-details"},gn=["title"],yn={class:"request-content"},bn={class:"agent-controls"},_n={class:"agent-execution-info"},wn={key:0,class:"agent-result"},$n={class:"result-header"},Sn={class:"result-label"},Tn={class:"result-content"},kn={key:1,class:"agent-error"},En={class:"error-header"},Pn={class:"error-label"},Cn={class:"error-content"},In={key:0,class:"sub-plans-container"},Rn={class:"sub-plans-header"},xn={class:"sub-plans-title"},An={class:"sub-plans-list"},Fn=_e({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=t,{t:s}=Me(),a=f=>{f.stepId?e("step-selected",f.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",f)},l=f=>{switch(f){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=f=>{switch(f){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},m=f=>{switch(f){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},_=(f,E,P)=>{e("sub-plan-selected",f,E,P)},i=f=>{e("step-selected",f)},c=f=>{if(!f)return"";try{const E=JSON.parse(f);return JSON.stringify(E,null,2)}catch{return f}};return(f,E)=>(h(),g("div",sn,[f.planExecution?(h(),g("div",on,[f.planExecution.parentActToolCall?(h(),g("div",nn,[n("div",an,[A(d(D),{icon:"carbon:flow",class:"tool-icon"}),n("span",ln,u(f.$t("chat.triggeredByTool"))+":",1),n("span",rn,u(f.planExecution.parentActToolCall.name),1)]),f.planExecution.parentActToolCall.parameters?(h(),g("div",cn,[n("span",un,u(f.$t("common.parameters"))+":",1),n("pre",dn,u(c(f.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(f.planExecution?.agentExecutionSequence?.length??0)>0?(h(),g("div",pn,[n("h4",mn,u(f.$t("chat.agentExecutionSequence")),1),(h(!0),g(ue,null,me(f.planExecution?.agentExecutionSequence,(P,p)=>(h(),g("div",{key:P.id||p,class:ce(["agent-execution-item",l(P.status)])},[n("div",{class:"agent-header",onClick:S=>a(P)},[n("div",fn,[A(d(D),{icon:m(P.status),class:"agent-status-icon"},null,8,["icon"]),n("div",vn,[n("div",{class:"agent-name",title:P.agentName==="ConfigurableDynaAgent"?f.$t("chat.clickToViewExecutionDetails"):""},u(P.agentName==="ConfigurableDynaAgent"?f.$t("chat.funcAgentExecutionDetails"):P.agentName||f.$t("chat.unknownAgent")),9,gn),n("pre",yn,u(P.agentRequest),1)])]),n("div",bn,[n("div",{class:ce(["agent-status-badge",l(P.status)])},u(r(P.status)),3),A(d(D),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,hn),n("div",_n,[P.result?(h(),g("div",wn,[n("div",$n,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Sn,u(f.$t("chat.agentResult"))+":",1)]),n("pre",Tn,u(P.result),1)])):B("",!0),P.errorMessage?(h(),g("div",kn,[n("div",En,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),n("span",Pn,u(f.$t("chat.errorMessage"))+":",1)]),n("pre",Cn,u(P.errorMessage),1)])):B("",!0)]),P.subPlanExecutionRecords?.length?(h(),g("div",In,[n("div",Rn,[A(d(D),{icon:"carbon:tree-view",class:"sub-plans-icon"}),n("span",xn,u(f.$t("chat.subPlanExecutions"))+" ("+u(P.subPlanExecutionRecords.length)+") ",1)]),n("div",An,[(h(!0),g(ue,null,me(P.subPlanExecutionRecords,(S,y)=>(h(),ye(tn,{key:S.currentPlanId||y,"sub-plan":S,"sub-plan-index":y,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:_,onStepSelected:i},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2))),128))])):B("",!0)]))}}),Dn=we(Fn,[["__scopeId","data-v-ee75d960"]]);function bs(){return{formatResponseText:_=>_?_.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:_=>{if(!_||isNaN(_.getTime()))return"";const c=new Date().getTime()-_.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return _.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.warn("[useMessageFormatting] Error formatting timestamp:",_,f),""}},getMessageClasses:_=>Z(()=>({user:_.type==="user",assistant:_.type==="assistant",streaming:_.isStreaming,"has-error":!!_.error,"has-thinking":!!_.thinking,"has-execution":!!_.planExecution})),formatFileSize:_=>{if(_===0)return"0 B";const i=1024,c=["B","KB","MB","GB"],f=Math.floor(Math.log(_)/Math.log(i));return parseFloat((_/Math.pow(i,f)).toFixed(2))+" "+c[f]},truncateText:(_,i=100)=>!_||_.length<=i?_:_.substring(0,i)+"...",stripHtml:_=>_.replace(/<[^>]*>/g,""),hasDisplayableContent:_=>!!(_.content||(_.thinking??!1)||(_.planExecution??!1)||_.error),getMessageStatus:_=>_.error?"Send failed":_.isStreaming?"Typing...":_.type==="assistant"&&!_.content&&!_.thinking?"Waiting for response":""}}class At{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Mn={class:"user-input-form-container"},Nn={class:"user-input-header"},Un={class:"user-input-title"},Ln={class:"user-input-message"},On={key:0,class:"form-description"},qn={key:0,class:"form-grid"},Bn=["for"],Hn=["id","name","placeholder","required","onUpdate:modelValue"],jn=["id","name","placeholder","required","onUpdate:modelValue"],Vn=["id","name","placeholder","required","onUpdate:modelValue"],zn=["id","name","placeholder","required","onUpdate:modelValue"],Wn=["id","name","placeholder","required","onUpdate:modelValue"],Gn=["id","name","required","onUpdate:modelValue"],Kn={value:""},Jn=["value"],Xn={key:6,class:"checkbox-group"},Qn=["id","name","value","onUpdate:modelValue"],Yn={class:"checkbox-label"},Zn={key:7,class:"radio-group"},ea=["id","name","value","onUpdate:modelValue"],ta={class:"radio-label"},sa=["id","name","placeholder","required","onUpdate:modelValue"],oa={key:1,class:"form-group"},na={for:"form-input-genericInput"},aa={type:"submit",class:"submit-user-input-btn"},la=_e({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:t}){const e=o,s=t;Me();const a=nt({}),l=F(e.genericInput??""),r=F(!1),m=F(null),_=()=>{const E=e.userInputWaitState?.formInputs;E&&E.length>0&&(!r.value||Object.keys(a).length!==E.length)&&(E.forEach((p,S)=>{(!(S in a)||p.type==="checkbox"&&!Array.isArray(a[S])||p.type!=="checkbox"&&a[S]==="")&&(p.type==="checkbox"?a[S]=[]:a[S]="")}),r.value=!0)};De(()=>{_()}),de(()=>e.userInputWaitState?.formInputs,()=>{m.value&&clearTimeout(m.value),m.value=setTimeout(()=>{r.value=!1,_()},100)},{deep:!0});const i=async()=>{try{const E={},P=e.userInputWaitState?.formInputs;P&&P.length>0?Object.entries(a).forEach(([p,S])=>{const y=parseInt(p,10),R=P[y].label||`input_${p}`;Array.isArray(S)?E[R]=S.join(", "):E[R]=S}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",e.planId),e.planId?(await At.submitFormInput(e.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},c=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(P=>P.trim()).filter(P=>P.length>0):[]:[],f=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Le(()=>{m.value&&clearTimeout(m.value)}),(E,P)=>(h(),g("div",Mn,[n("div",Nn,[A(d(D),{icon:"carbon:user",class:"user-icon"}),n("h4",Un,u(E.$t("chat.userInputRequired")),1)]),n("p",Ln,u(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),g("p",On,u(E.userInputWaitState?.formDescription),1)):B("",!0),n("form",{onSubmit:ge(i,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),g("div",qn,[(h(!0),g(ue,null,me(E.userInputWaitState?.formInputs,(p,S)=>(h(),g("div",{key:S,class:"form-group"},[n("label",{for:`form-input-${p.label.replace(/\W+/g,"_")}`},u(p.label)+u(f(p.required)?" *":"")+": ",9,Bn),!p.type||p.type==="text"?ve((h(),g("input",{key:0,type:"text",id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input"},null,8,Hn)),[[Se,a[S]]]):p.type==="email"?ve((h(),g("input",{key:1,type:"email",id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input"},null,8,jn)),[[Se,a[S]]]):p.type==="number"?ve((h(),g("input",{key:2,type:"number",id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input"},null,8,Vn)),[[Se,a[S]]]):p.type==="password"?ve((h(),g("input",{key:3,type:"password",id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input"},null,8,zn)),[[Se,a[S]]]):p.type==="textarea"?ve((h(),g("textarea",{key:4,id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input form-textarea",rows:"4"},null,8,Wn)),[[Se,a[S]]]):p.type==="select"&&p.options?ve((h(),g("select",{key:5,id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input form-select"},[n("option",Kn,u(E.$t("selectCommon.pleaseSelect")),1),(h(!0),g(ue,null,me(c(p.options),y=>(h(),g("option",{key:y,value:y},u(y),9,Jn))),128))],8,Gn)),[[Ut,a[S]]]):p.type==="checkbox"&&p.options?(h(),g("div",Xn,[(h(!0),g(ue,null,me(c(p.options),y=>(h(),g("label",{key:y,class:"checkbox-item"},[ve(n("input",{type:"checkbox",id:`form-input-${p.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:p.label,value:y,"onUpdate:modelValue":v=>a[S]=v,class:"form-checkbox"},null,8,Qn),[[xt,a[S]]]),n("span",Yn,u(y),1)]))),128))])):p.type==="radio"&&p.options?(h(),g("div",Zn,[(h(!0),g(ue,null,me(c(p.options),y=>(h(),g("label",{key:y,class:"radio-item"},[ve(n("input",{type:"radio",id:`form-input-${p.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:p.label,value:y,"onUpdate:modelValue":v=>a[S]=v,class:"form-radio"},null,8,ea),[[eo,a[S]]]),n("span",ta,u(y),1)]))),128))])):ve((h(),g("input",{key:8,type:"text",id:`form-input-${p.label.replace(/\W+/g,"_")}`,name:p.label,placeholder:p.placeholder||"",required:f(p.required),"onUpdate:modelValue":y=>a[S]=y,class:"form-input"},null,8,sa)),[[Se,a[S]]])]))),128))])):(h(),g("div",oa,[n("label",na,u(E.$t("common.input"))+":",1),ve(n("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":P[0]||(P[0]=p=>l.value=p),class:"form-input"},null,512),[[Se,l.value]])])),n("button",aa,u(E.$t("chat.userInput.submit")),1)],32)]))}}),ra=we(la,[["__scopeId","data-v-e4d0802d"]]),ia={class:"response-section"},ca={class:"response-header"},ua={class:"response-avatar"},da={class:"response-name"},pa={key:0,class:"response-timestamp"},ma={class:"response-content"},ha={key:1,class:"final-response"},fa=["innerHTML"],va={class:"response-actions"},ga=["title"],ya=["title"],ba={key:2,class:"response-placeholder"},_a={class:"typing-indicator"},wa={class:"typing-text"},$a={key:3,class:"response-error"},Sa={class:"error-text"},Ta={key:4,class:"response-empty"},ka={class:"empty-text"},Ea=_e({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:t}){const e=o,s=t,{formatResponseText:a,formatTimestamp:l}=bs(),r=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},m=()=>{s("regenerate")},_=()=>{s("retry")},i=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,f)=>(h(),g("div",ia,[n("div",ca,[n("div",ua,[A(d(D),{icon:"carbon:bot",class:"bot-icon"})]),n("div",da,u(c.$t("chat.botName")),1),c.timestamp?(h(),g("div",pa,u(d(l)(c.timestamp)),1)):B("",!0)]),n("div",ma,[c.userInputWaitState?.waiting?(h(),ye(ra,hs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:i}),null,16,["user-input-wait-state","generic-input"])):B("",!0),c.content?(h(),g("div",ha,[n("div",{class:"response-text",innerHTML:d(a)(c.content)},null,8,fa),n("div",va,[n("button",{class:"action-btn copy-btn",onClick:r,title:c.$t("chat.copyResponse")},[A(d(D),{icon:"carbon:copy"})],8,ga),n("button",{class:"action-btn regenerate-btn",onClick:m,title:c.$t("chat.regenerateResponse")},[A(d(D),{icon:"carbon:renew"})],8,ya)])])):c.isStreaming?(h(),g("div",ba,[n("div",_a,[f[0]||(f[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1)),n("span",wa,u(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),g("div",$a,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),n("span",Sa,u(c.error),1),n("button",{class:"retry-btn",onClick:_},u(c.$t("chat.retry")),1)])):(h(),g("div",Ta,[n("span",ka,u(c.$t("chat.waitingForResponse")),1)]))])]))}}),Pa=we(Ea,[["__scopeId","data-v-a03ac86f"]]);function Ca(){const e=F(new Set),s=nt(new Map),a=nt(new Map),l=F(!1),r=F(null),m=C=>a.get(C),_=(C,N)=>{if(!C){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}a.set(C,N),console.log("[usePlanExecution] Cached plan record:",C)},i=()=>Array.from(e.value),c=C=>{if(!C){console.warn("[usePlanExecution] Cannot track empty planId");return}e.value.add(C),console.log("[usePlanExecution] Tracking plan:",C),r.value||p(),E(C)},f=C=>{e.value.delete(C),console.log("[usePlanExecution] Untracking plan:",C),e.value.size===0&&S()},E=async C=>{if(C)try{const N=await At.getDetails(C);if(!N){console.warn(`[usePlanExecution] No details received for planId: ${C} - this might be a temporary network issue`);return}const T=N.rootPlanId||N.currentPlanId;if(!T){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",N);return}if(a.set(T,N),C!==T&&(a.set(C,N),console.log("[usePlanExecution] Stored record with both keys:",{planId:C,recordKey:T})),console.log("[usePlanExecution] Updated plan execution record:",{planId:C,recordKey:T,rootPlanId:N.rootPlanId,currentPlanId:N.currentPlanId,completed:N.completed,status:N.status}),N.completed){console.log(`[usePlanExecution] Plan ${T} completed, checking for summary...`);const U=vt();U.currentTask&&U.currentTask.isRunning&&(U.currentTask.isRunning=!1);const G=N.summary||N.result||N.message,x=s.get(T)||0;if(!G&&x<10)s.set(T,x+1),console.log(`[usePlanExecution] Plan ${T} completed but no summary yet, continuing to poll (${x+1}/10)`);else{console.log(`[usePlanExecution] Plan ${T} completed, cleaning up...`,{hasSummary:!!G,pollCount:x});try{await At.deleteExecutionDetails(T),console.log(`[usePlanExecution] Deleted execution details for plan: ${T}`)}catch(V){const w=V instanceof Error?V.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${w}`)}f(C),s.delete(T),setTimeout(()=>{a.delete(T)},5e3)}}N.status==="failed"&&N.message&&!N.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${T} failed:`,N.message)}catch(N){console.error(`[usePlanExecution] Failed to poll plan status for ${C}:`,N)}},P=async()=>{if(l.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const C=new Set(e.value);for(const[N]of s.entries())C.add(N);if(C.size!==0)try{l.value=!0;const N=Array.from(C).map(T=>E(T));await Promise.all(N)}catch(N){console.error("[usePlanExecution] Failed to poll tracked plans:",N)}finally{l.value=!1}},p=()=>{r.value&&clearInterval(r.value),r.value=window.setInterval(()=>{P()},5e3),console.log("[usePlanExecution] Started polling")},S=()=>{if(s.size>0){console.log(`[usePlanExecution] Not stopping polling - ${s.size} completed plans still waiting for summary`);return}r.value&&(clearInterval(r.value),r.value=null),console.log("[usePlanExecution] Stopped polling")},y=async C=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${C}`),await E(C)},v=C=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:C}),!C){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}vt().setTaskRunning(C),c(C)},R=()=>{S(),e.value.clear(),s.clear(),a.clear(),l.value=!1};return{planExecutionRecords:Ue(a),trackedPlanIds:Ue(e),isPolling:Ue(l),getPlanExecutionRecord:m,setCachedPlanRecord:_,getTrackedPlanIds:i,trackPlan:c,untrackPlan:f,handlePlanExecutionRequested:v,pollPlanStatusImmediately:y,startPolling:p,stopPolling:S,cleanup:R}}let St=null;function Qe(){return St||(St=Ca()),St}function Ia(){const o=Qe(),t=F([]),e=F(null),s=F(null),a=F(null),l=Z(()=>a.value),r=F(!1),m=F(null),_=F(null),i=F(null),c=Z(()=>e.value&&t.value.find(L=>L.id===e.value)||null),f=Z(()=>t.value.length>0),E=Z(()=>t.value.length),P=Z(()=>{if(!s.value)return c.value?.messages||[];const L=[];for(const q of t.value)q.conversationId===s.value&&L.push(...q.messages);return L.sort((q,H)=>q.timestamp.getTime()-H.timestamp.getTime())}),p=L=>{const q={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:L||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(q),e.value=q.id,console.log("[useMessageDialog] Created new dialog round:",q.id,{conversationId:s.value,rootPlanId:a.value}),q},S=L=>t.value.find(q=>q.id===L)||null,y=L=>{if(t.value.forEach(q=>{q.isActive=!1}),L){const q=t.value.find(H=>H.id===L);q&&(q.isActive=!0,e.value=L)}else e.value=null},v=(L,q)=>{const H=t.value.find(X=>X.id===L);H&&(H.messages.push(q),H.updatedAt=new Date)},R=(L,q,H)=>{const X=t.value.find(te=>te.id===L);if(X){const te=X.messages.findIndex(re=>re.id===q);te!==-1&&(X.messages[te]={...X.messages[te],...H},X.updatedAt=new Date)}},C=L=>{const q=t.value.findIndex(H=>H.id===L);if(q!==-1){const H=t.value[q];if(t.value.splice(q,1),console.log("[useMessageDialog] Deleted dialog round:",L),e.value===L){const X=t.value.filter(te=>te.conversationId===H.conversationId);e.value=X.length>0?X[0].id:null,e.value&&y(e.value)}}},N=L=>{const q=t.value.filter(H=>H.planId===L);q.forEach(H=>{C(H.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for plan:`,L)},T=L=>{const q=t.value.filter(H=>H.conversationId===L);q.forEach(H=>{C(H.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for conversation:`,L),s.value===L&&(s.value=null)},U=()=>{t.value=[],e.value=null},G=async L=>{let q=null,H=null;try{if(r.value){const le="Please wait for the current task to complete before starting a new one";return m.value=le,{success:!1,error:le}}r.value=!0,m.value=null,q=p();const X={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:L.input,timestamp:new Date,isStreaming:!1,...L.uploadedFiles&&{attachments:L.uploadedFiles.map(le=>typeof le=="string"?new File([],le):le)}};v(q.id,X),H={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},v(q.id,H);const te=L;let re;if(te.toolName&&te.replacementParams?re=await Gt.executeByToolName(te.toolName,te.replacementParams,L.uploadedFiles,L.uploadKey,"VUE_DIALOG"):re=await Gt.sendMessageWithDefaultPlan(L,"VUE_DIALOG"),re.conversationId&&(s.value=re.conversationId,q.conversationId=re.conversationId,Te.setConversationId(re.conversationId),console.log("[useMessageDialog] Conversation ID set:",re.conversationId)),re.planId){const le=re.planId;a.value=le,q.planId=le,R(q.id,H.id,{thinking:"Planning execution...",planExecution:{currentPlanId:le,rootPlanId:le,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(le),console.log("[useMessageDialog] Root plan ID set and tracking started:",le)}else{const le={content:re.message||re.result||"No response received",isStreaming:!1};R(q.id,H.id,le)}return{success:!0,...re.planId&&{planId:re.planId},...re.conversationId&&{conversationId:re.conversationId}}}catch(X){const te=X instanceof Error?X.message:"Failed to send message";return m.value=te,console.error("[useMessageDialog] Send message failed:",X),q&&H&&R(q.id,H.id,{content:`Error: ${te}`,error:te,isStreaming:!1}),{success:!1,error:te}}finally{r.value=!1}},x=async L=>{let q=null,H=null;try{if(r.value){const M="Please wait for the current task to complete before starting a new one";return m.value=M,{success:!1,error:M}}r.value=!0,m.value=null;const X=Te.getConversationId();X&&!s.value&&(s.value=X,console.log("[useMessageDialog] Restored conversationId from memoryStore:",X)),q=p(L.title),L.title&&(q.title=L.title);const te={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:L.title,timestamp:new Date,isStreaming:!1,...L.uploadedFiles&&{attachments:L.uploadedFiles.map(M=>typeof M=="string"?new File([],M):M)}};v(q.id,te),H={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},v(q.id,H);const re=L.planData.planTemplateId;if(!re||re===null)throw new Error("Plan template ID is required");const le=await ao.executePlan(re,L.params,L.uploadedFiles,L.replacementParams,L.uploadKey??void 0,"VUE_SIDEBAR");if(le.conversationId){const M=le.conversationId,K=s.value||Te.getConversationId();M!==K?(console.log("[useMessageDialog] Conversation ID changed:",K,"->",M),s.value=M,q.conversationId=M,Te.setConversationId(M)):(q.conversationId=M,console.log("[useMessageDialog] Conversation ID unchanged:",M))}else s.value&&(q.conversationId=s.value);if(le.planId){const M=le.planId;a.value=M,q.planId=M,R(q.id,H.id,{thinking:"Planning execution...",planExecution:{currentPlanId:M,rootPlanId:M,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(M),console.log("[useMessageDialog] Root plan ID set and tracking started:",M)}else{const M={content:"Plan execution started",isStreaming:!1};R(q.id,H.id,M)}return{success:!0,...le.planId&&{planId:le.planId}}}catch(X){const te=X instanceof Error?X.message:"Failed to execute plan";return m.value=te,console.error("[useMessageDialog] Execute plan failed:",X),q&&H&&R(q.id,H.id,{content:`Error: ${te}`,error:te,isStreaming:!1}),r.value=!1,{success:!1,error:te}}},V=(L,q,H)=>{const X={};H!==void 0&&(X.planExecution=H),R(L,q,X)},w=L=>{const q={...L};return"agentExecutionSequence"in L&&Array.isArray(L.agentExecutionSequence)&&(q.agentExecutionSequence=L.agentExecutionSequence.map(H=>b(H))),q},b=L=>{const q={...L};return"subPlanExecutionRecords"in L&&Array.isArray(L.subPlanExecutionRecords)&&(q.subPlanExecutionRecords=L.subPlanExecutionRecords.map(H=>w(H))),q},$=(L,q,H)=>{c.value||p();const X=c.value,te={...H};H?.planExecution&&(te.planExecution=w(H.planExecution));const re={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:L,content:q,timestamp:new Date,isStreaming:!1,...te};return X.messages.push(re),X.updatedAt=new Date,re},O=(L,q)=>{if(!c.value)return;const H={...q};q.planExecution&&(H.planExecution=w(q.planExecution));const X=c.value.messages.findIndex(te=>te.id===L);X!==-1&&(c.value.messages[X]={...c.value.messages[X],...H},c.value.updatedAt=new Date)},W=L=>{if(c.value)return c.value.messages.find(q=>q.id===L)},ae=L=>{_.value=L,O(L,{isStreaming:!0})},fe=L=>{L&&O(L,{isStreaming:!1}),(_.value===L||!L)&&(_.value=null)},Ce=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,_.value=null)},ke=(L,q)=>{r.value=!L,q!==void 0&&(i.value=q),console.log("[useMessageDialog] Input state updated:",{enabled:L,placeholder:q,isLoading:r.value})},Ne=L=>{s.value=L,console.log("[useMessageDialog] Set conversationId:",L)},Ie=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,m.value=null,i.value=null},Ee=(L,q,H)=>{const X={planExecution:w(H),isStreaming:!H.completed};if(!H.completed)X.thinking="Processing...";else{if(!H.agentExecutionSequence||H.agentExecutionSequence.length===0){const te=H.summary??H.result??H.message??"Execution completed";te&&(X.content=te,X.thinking="")}else H.summary&&(X.content=H.summary,X.thinking="");H.status==="failed"&&H.message&&(X.content=`Error: ${H.message}`,X.thinking="")}R(L.id,q.id,X)};return fs(()=>{const L=o.planExecutionRecords,q=Array.from(L.entries());for(const H of t.value){if(!H.planId)continue;const X=q.find(([K])=>K===H.planId);if(!X){q.length===0&&console.log("[useMessageDialog] watchEffect: No records in Map yet for planId:",H.planId,{dialogId:H.id});continue}const[,te]=X,re=w(te),le=H.messages.find(K=>K.planExecution?.rootPlanId===H.planId);if(!le){console.log("[useMessageDialog] watchEffect: No message found for planId:",H.planId,{dialogMessages:H.messages.map(K=>({id:K.id,type:K.type,planExecutionRootPlanId:K.planExecution?.rootPlanId}))});continue}Ee(H,le,re),!q.some(([,K])=>K&&!K.completed&&K.status!=="failed")&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading"),r.value=!1)}}),{dialogList:Ue(t),activeDialogId:Ue(e),rootPlanId:Ue(a),conversationId:Ue(s),isLoading:r,error:m,streamingMessageId:Ue(_),inputPlaceholder:Ue(i),activeDialog:c,activeRootPlanId:l,hasDialogs:f,dialogCount:E,messages:P,createDialog:p,getDialog:S,setActiveDialog:y,addMessageToDialog:v,updateMessageInDialog:R,deleteDialog:C,deleteConversationRoundByPlanId:N,deleteConversation:T,clearAllDialogs:U,sendMessage:G,executePlan:x,updatePlanExecutionStatus:V,updateInputState:ke,setConversationId:Ne,reset:Ie,addMessage:$,updateMessage:O,findMessage:W,startStreaming:ae,stopStreaming:fe,clearMessages:Ce}}let Tt=null;function Ye(){return Tt||(Tt=Ia()),Tt}function Ra(o){const t=F(!1),e=F(!0),s=150,a=async(y=!0)=>{o.value&&(await xe(),o.value.scrollTo({top:o.value.scrollHeight,behavior:y?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:y,scrollHeight:v,clientHeight:R}=o.value;return v-y-R<s},r=()=>{if(!o.value)return;const y=l();t.value=!y&&o.value.scrollHeight>o.value.clientHeight,y&&(e.value=!0)},m=()=>{r(),l()||(e.value=!1)},_=async()=>{e.value&&await a()},i=async()=>{e.value=!0,await a()},c=(y,v=!0)=>{if(!o.value)return;const R=o.value.querySelector(`[data-message-id="${y}"]`);R&&R.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},f=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:y,scrollHeight:v,clientHeight:R}=o.value,C=y===0,N=y+R>=v-5,T=v>R?y/(v-R)*100:100;return{scrollTop:y,scrollHeight:v,clientHeight:R,isAtTop:C,isAtBottom:N,scrollPercentage:T}},E=()=>{o.value&&o.value.addEventListener("scroll",m,{passive:!0})},P=()=>{o.value&&o.value.removeEventListener("scroll",m)},p=()=>{E(),r()},S=()=>{P()};return De(()=>{xe(()=>{p()})}),Le(()=>{S()}),{showScrollToBottom:Ue(t),isAutoScrollEnabled:Ue(e),scrollToBottom:a,autoScrollToBottom:_,forceScrollToBottom:i,scrollToMessage:c,isNearBottom:l,checkScrollPosition:r,getScrollInfo:f,addScrollListener:E,removeScrollListener:P,initializeScrollBehavior:p,cleanupScrollBehavior:S}}const xa={class:"chat-container"},Aa=["data-message-id"],Fa={class:"user-content"},Da={class:"message-text"},Ma={key:0,class:"attachments"},Na={class:"attachment-name"},Ua={class:"attachment-size"},La={class:"message-timestamp"},Oa={key:0,class:"message-status error"},qa={class:"status-text"},Ba={key:1,class:"assistant-message"},Ha={key:0,class:"loading-message"},ja={class:"loading-content"},Va=["title"],za=_e({__name:"ChatContainer",emits:["step-selected"],setup(o,{emit:t}){const e=t,{t:s}=Me(),a=Ye(),{messages:l,isLoading:r,streamingMessageId:m,updateMessage:_,startStreaming:i,findMessage:c}=a,f=F(null),{scrollToBottom:E,autoScrollToBottom:P,showScrollToBottom:p}=Ra(f),{getMessageClasses:S,formatTimestamp:y,formatFileSize:v}=bs(),R=w=>m.value===w,C=Z(()=>l.value),N=w=>{const b=w.target;if(b.classList.contains("md-copy-btn")){const $=b.getAttribute("data-raw");if($){const O=decodeURIComponent($);navigator.clipboard.writeText(O).then(()=>{b.textContent=s("chat.copied"),setTimeout(()=>{b.textContent=s("chat.copy")},1e3)})}}},T=async w=>{const b=c(w);if(b)try{const $=b.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText($)}catch($){console.error("Failed to copy message:",$)}},U=w=>{const b=c(w);b&&b.type==="assistant"&&(_(w,{content:""}),i(w),console.warn("[ChatContainer] Regenerate not yet implemented"))},G=w=>{c(w)&&(_(w,{content:""}),i(w),console.warn("[ChatContainer] Retry not yet implemented"))},x=w=>{console.log("[ChatContainer] Step selected:",w),e("step-selected",w)},V=(w,b)=>{console.log("[ChatContainer] User input submitted:",b,"for message:",w.id),console.warn("[ChatContainer] User input submission not yet implemented")};return De(()=>{de(l,()=>{xe(()=>{P()})},{deep:!0})}),Le(()=>{}),(w,b)=>(h(),g("div",xa,[n("div",{class:"messages",ref_key:"messagesRef",ref:f,onClick:N},[(h(!0),g(ue,null,me(C.value,$=>(h(),g("div",{key:$.id,class:ce(["chat-message",[d(S)($),{streaming:R($.id)}]])},[$.type==="user"?(h(),g("div",{key:0,class:"user-message","data-message-id":$.id},[n("div",Fa,[n("div",Da,u($.content),1),$.attachments?.length?(h(),g("div",Ma,[(h(!0),g(ue,null,me($.attachments,(O,W)=>(h(),g("div",{key:W,class:"attachment-item"},[A(d(D),{icon:"carbon:document",class:"attachment-icon"}),n("span",Na,u(O.name),1),n("span",Ua,u(d(v)(O.size)),1)]))),128))])):B("",!0),n("div",La,u(d(y)($.timestamp)),1)]),$.error?(h(),g("div",Oa,[A(d(D),{icon:"carbon:warning",class:"status-icon"}),n("span",qa,u($.error),1)])):B("",!0)],8,Aa)):$.type==="assistant"?(h(),g("div",Ba,[$.planExecution?(h(),ye(Dn,{key:0,"plan-execution":$.planExecution,"step-actions":$.stepActions||[],"generic-input":$.genericInput||"",onStepSelected:x},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),$.content||$.error||R($.id)||$.planExecution?.userInputWaitState?.waiting?(h(),ye(Pa,hs({key:1,content:$.content||"","is-streaming":R($.id)||!1},{ref_for:!0},{...$.error?{error:$.error}:{},...$.planExecution?.userInputWaitState?{userInputWaitState:$.planExecution.userInputWaitState}:{},...$.planExecution?.currentPlanId?{planId:$.planExecution.currentPlanId}:{}},{timestamp:$.timestamp,"generic-input":$.genericInput||"",onCopy:()=>T($.id),onRegenerate:()=>U($.id),onRetry:()=>G($.id),onUserInputSubmitted:O=>V($,O)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):B("",!0)])):B("",!0)],2))),128)),d(r)?(h(),g("div",Ha,[n("div",ja,[A(d(D),{icon:"carbon:circle-dash",class:"loading-icon"}),n("span",null,u(w.$t("chat.processing")),1)])])):B("",!0)],512),A(Lt,{name:"scroll-button"},{default:Ke(()=>[d(p)?(h(),g("button",{key:0,class:"scroll-to-bottom",onClick:b[0]||(b[0]=()=>d(E)()),title:w.$t("chat.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,Va)):B("",!0)]),_:1})]))}}),Wa=we(za,[["__scopeId","data-v-9504dbce"]]);class Kt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const Ga={class:"file-upload-component"},Ka=["accept"],Ja={key:0},Xa={key:1},Qa={key:0,class:"files-list"},Ya={class:"file-name"},Za={class:"file-size"},el=["onClick","title"],tl={key:0,class:"upload-progress"},sl=_e({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:t,emit:e}){const{t:s}=Me(),a=o,l=e,r=F(),m=F([]),_=F(!1),i=F(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),m.value=[],i.value=null,l("upload-key-changed",null)};Le(()=>{c()}),de(()=>m.value,y=>{l("files-removed",y)},{deep:!0});const f=()=>{a.disabled||r.value&&r.value.click()},E=async y=>{const v=y.target,R=v.files;if(!R||R.length===0)return;const C=Array.from(R);console.log("[FileUpload] Selected files for upload:",C.map(N=>N.name)),await P(C),v.value=""},P=async y=>{if(y.length!==0){_.value=!0,l("upload-started");try{const v=await Kt.uploadFiles(y);v.success&&(!i.value&&v.uploadKey?(i.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",i.value),m.value=v.uploadedFiles):i.value?(console.log("[FileUpload] Using existing uploadKey:",i.value),m.value=[...m.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),m.value=v.uploadedFiles),v.uploadKey&&(i.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",i.value)),console.log("[Input] Updated global uploadedFiles state:",m.value),l("files-uploaded",m.value,i.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{_.value=!1}}},p=async y=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",y.originalName,"from uploadKey:",i),i.value){const v=await Kt.deleteFile(i.value,y.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}m.value=m.value.filter(v=>v.originalName!==y.originalName),m.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),i.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",m.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},S=y=>{if(y===0)return"0 Bytes";const v=1024,R=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(y)/Math.log(v));return parseFloat((y/Math.pow(v,C)).toFixed(2))+" "+R[C]};return t({uploadedFiles:m,uploadKey:i,resetSession:c,uploadFiles:P,removeFile:p,isUploading:_}),(y,v)=>(h(),g("div",Ga,[n("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:y.acceptedFileTypes||""},null,40,Ka),n("div",{class:ce(["uploaded-files",{"has-files":m.value.length>0}])},[n("div",{class:"files-header",onClick:f},[A(d(D),{icon:"carbon:attachment"}),m.value.length===0?(h(),g("span",Ja,u(d(s)("input.attachFile")),1)):(h(),g("span",Xa,u(d(s)("input.attachedFiles"))+" ("+u(m.value.length)+")",1))]),m.value.length>0?(h(),g("div",Qa,[(h(!0),g(ue,null,me(m.value,R=>(h(),g("div",{key:R.originalName,class:"file-item"},[A(d(D),{icon:"carbon:document",class:"file-icon"}),n("span",Ya,u(R.originalName),1),n("span",Za,"("+u(S(R.size))+")",1),n("button",{onClick:C=>p(R),class:"remove-btn",title:d(s)("input.removeFile")},[A(d(D),{icon:"carbon:close"})],8,el)]))),128))])):B("",!0)],2),_.value?(h(),g("div",tl,[A(d(D),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),n("span",null,u(d(s)("input.uploading")),1)])):B("",!0)]))}}),_s=we(sl,[["__scopeId","data-v-a97ebade"]]),ol={class:"input-area"},nl={class:"input-container"},al={class:"input-row-first"},ll=["placeholder","disabled"],rl={class:"input-row-second"},il=["title","disabled"],cl={value:""},ul=["value"],dl=["title"],pl=["disabled","title"],ml=["title"],Jt="chatInputHistory",Xt=20,hl=_e({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},emits:["selection-changed"],setup(o,{expose:t,emit:e}){const{t:s}=Me(),a=vt(),l=Xe(),r=Ye(),m=Qe(),_=Z(()=>a.hasRunningTask()),i=o,c=e,f=F(),E=F(),P=F(""),p=Z(()=>s("input.placeholder")),S=F(null),y=Z(()=>r.inputPlaceholder.value?r.inputPlaceholder.value:S.value?S.value:p.value),v=F([]),R=F(null),C=F(""),N=F([]),T=F(!1),U=F([]),G=F(-1),x=F(""),V=Z(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),w=async()=>{T.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const j=l.getAllCoordinatorToolsFromTemplates(),Q=[];for(const he of j)if(he.enableInternalToolcall)try{const Be=JSON.parse(he.inputSchema||"[]");if(Array.isArray(Be)&&Be.length===1){const He=Be[0];Q.push({value:he.planTemplateId,label:`${he.toolName} (${He.name})`,toolName:he.toolName,planTemplateId:he.planTemplateId,paramName:He.name})}}catch(Be){console.warn("[InputArea] Failed to parse inputSchema for tool:",he.toolName,Be)}N.value=Q,console.log("[InputArea] Loaded",Q.length,"inner tools with single parameter");const ne=localStorage.getItem("inputAreaSelectedTool");ne&&(Q.some(Be=>Be.value===ne)?(C.value=ne,console.log("[InputArea] Restored selected tool from localStorage:",ne)):(console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),C.value=""))}catch(j){console.error("[InputArea] Failed to load inner tools:",j),N.value=[]}finally{T.value=!1}},b=Z(()=>N.value.length>0?N.value.map(j=>({value:j.value,label:j.label})):i.selectionOptions);de(C,j=>{c("selection-changed",j),localStorage.setItem("inputAreaSelectedTool",j||"")});const $=()=>{try{const j=localStorage.getItem(Jt);j&&(U.value=JSON.parse(j))}catch(j){console.error("[InputArea] Failed to load history:",j),U.value=[]}},O=()=>{try{localStorage.setItem(Jt,JSON.stringify(U.value))}catch(j){console.error("[InputArea] Failed to save history:",j)}},W=j=>{if(!j.trim())return;const Q=U.value.indexOf(j);Q!==-1&&U.value.splice(Q,1),U.value.unshift(j),U.value.length>Xt&&(U.value=U.value.slice(0,Xt)),O()},ae=j=>{if(U.value.length===0)return;G.value===-1&&(x.value=P.value);let Q=G.value+j;Q<-1?Q=-1:Q>=U.value.length&&(Q=U.value.length-1),G.value=Q,G.value===-1?(P.value=x.value,x.value=""):P.value=U.value[G.value],H()};de(()=>l.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),w()},{deep:!0}),De(()=>{w(),$(),de(()=>m.planExecutionRecords,j=>{for(const Q of j.values())if(Q.completed){console.log("[InputArea] Plan completed, resetting session"),fe();break}},{deep:!0}),de(()=>a.taskToInput,j=>{j?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",j),xe(()=>{Y(j.trim()),a.getAndClearTaskToInput()}))},{immediate:!1})});const fe=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),E.value?.resetSession()};Le(()=>{fe()});const Ce=(j,Q)=>{v.value=j.map(ne=>ne.originalName),R.value=Q,console.log("[InputArea] Files uploaded:",j.length,"uploadKey:",Q),v.value.length>0&&(S.value=s("input.filesAttached",{count:v.value.length}))},ke=j=>{v.value=j.map(Q=>Q.originalName),console.log("[InputArea] Files removed, remaining:",j.length),v.value.length===0?S.value=null:S.value=s("input.filesAttached",{count:v.value.length})},Ne=j=>{R.value=j,console.log("[InputArea] Upload key changed:",j)},Ie=()=>{console.log("[InputArea] Upload started")},Ee=()=>{console.log("[InputArea] Upload completed")},L=j=>{console.error("[InputArea] Upload error:",j)},q=Z(()=>r.isLoading.value),H=()=>{xe(()=>{f.value&&(f.value.style.height="auto",f.value.style.height=Math.min(f.value.scrollHeight,120)+"px")})},X=j=>{if(j.key==="Enter"&&(j.ctrlKey||j.metaKey)){j.preventDefault(),te();return}const Q=V.value?j.altKey:j.ctrlKey;if(j.key==="ArrowUp"&&Q){j.preventDefault(),ae(1);return}if(j.key==="ArrowDown"&&Q){j.preventDefault(),ae(-1);return}G.value!==-1&&j.key.length===1&&!j.ctrlKey&&!j.metaKey&&!j.altKey&&(G.value=-1,x.value="")},te=async()=>{if(!P.value.trim()||q.value)return;const j=P.value.trim();W(j),G.value=-1,x.value="";const Q={input:j,memoryId:Te.selectMemoryId,uploadedFiles:v.value};if(R.value?(Q.uploadKey=R.value,console.log("[InputArea] Including uploadKey in message:",R.value)):console.log("[InputArea] No uploadKey available for message"),C.value){const ne=N.value.find(he=>he.value===C.value);if(ne){const he=Q;he.toolName=ne.planTemplateId,he.replacementParams={[ne.paramName]:j},console.log("[InputArea] Sending message with tool:",ne.toolName)}}try{await r.sendMessage(Q)}catch(ne){const he=ne instanceof Error?ne.message:String(ne);console.error("[InputArea] Send message failed:",he)}M()},re=()=>{Re.toggleSidebar(),console.log("[InputArea] Plan mode button clicked, sidebar toggled, isCollapsed:",Re.isCollapsed)},le=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},M=()=>{P.value="",H()},K=(j,Q)=>{r.updateInputState(j,Q)},Y=j=>{P.value=j,H()},$e=()=>P.value.trim();return de(()=>i.initialValue,j=>{j.trim()&&(P.value=j,H())},{immediate:!0}),t({clearInput:M,updateState:K,getQuery:$e,focus:()=>f.value?.focus(),get uploadedFiles(){return E.value?.uploadedFiles?.map(j=>j.originalName)||[]},get uploadKey(){return E.value?.uploadKey||null}}),(j,Q)=>(h(),g("div",ol,[A(_s,{ref_key:"fileUploadRef",ref:E,disabled:q.value,onFilesUploaded:Ce,onFilesRemoved:ke,onUploadKeyChanged:Ne,onUploadStarted:Ie,onUploadCompleted:Ee,onUploadError:L},null,8,["disabled"]),n("div",nl,[n("div",al,[ve(n("textarea",{"onUpdate:modelValue":Q[0]||(Q[0]=ne=>P.value=ne),ref_key:"inputRef",ref:f,class:"chat-input",placeholder:y.value,disabled:q.value,onKeydown:X,onInput:H},null,40,ll),[[Se,P.value]])]),n("div",rl,[ve(n("select",{"onUpdate:modelValue":Q[1]||(Q[1]=ne=>C.value=ne),class:"selection-input",title:j.$t("input.selectionTitle"),disabled:T.value||q.value},[n("option",cl,u(j.$t("input.defaultFuncAgent")),1),(h(!0),g(ue,null,me(b.value,ne=>(h(),g("option",{key:ne.value,value:ne.value},u(ne.label),9,ul))),128))],8,il),[[Ut,C.value]]),n("button",{class:"plan-mode-btn",title:j.$t("input.planMode"),onClick:re},[A(d(D),{icon:"carbon:document"}),ie(" "+u(j.$t("input.planMode")),1)],8,dl),_.value?(h(),g("button",{key:1,class:"send-button stop-button",onClick:le,title:j.$t("input.stop")},[A(d(D),{icon:"carbon:stop-filled"}),ie(" "+u(j.$t("input.stop")),1)],8,ml)):(h(),g("button",{key:0,class:"send-button",disabled:!P.value.trim()||q.value,onClick:te,title:j.$t("input.send")},[A(d(D),{icon:"carbon:send-alt"}),ie(" "+u(j.$t("input.send")),1)],8,pl))])])]))}}),fl=we(hl,[["__scopeId","data-v-653fc96a"]]);class pt{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const vl={key:0,class:"app-container"},gl={class:"app-content"},yl={class:"header"},bl={class:"relative"},_l={class:"title-edit-group"},wl={id:"main-title",class:"main-title"},$l={key:0,id:"title-edit-container",class:"title-edit-container"},Sl={class:"search-bar"},Tl={class:"search-container"},kl=["placeholder"],El={class:"message-list",id:"message-list"},Pl={class:"message-header"},Cl={class:"message-content"},Il={class:"sender-info"},Rl=["onClick"],xl={class:"sender-name"},Al={class:"action-buttons"},Fl=["onClick"],Dl={class:"action-buttons"},Ml=["onClick"],Nl={class:"message-meta"},Ul={class:"message-id"},Ll={class:"meta-right"},Ol={key:0,class:"unread-count"},ql={class:"message-time"},Bl=["id"],Hl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},jl={class:"bubble-avatar"},Vl={class:"bubble-content"},zl={class:"bubble-text"},Wl={key:0,class:"empty-state"},Gl={class:"modal-content"},Kl={class:"modal-header"},Jl={class:"modal-title"},Xl=["placeholder"],Ql={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},Yl={class:"modal-footer"},Zl={class:"modal-content"},er={class:"modal-header"},tr={class:"modal-title"},sr={class:"state-text",id:"delete-message"},or={class:"modal-footer"},nr=_e({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(o,{emit:t}){const e=F(!1),s=F(""),a=F([]),l=F([]),r=F(!1),m=F(null),_=F(""),i=F(!1),c=F(null),f=new Map,E=t,P=x=>{x.key==="Escape"&&(i.value?U():r.value&&R())};De(()=>{Te.setLoadMessages(p),document.addEventListener("keydown",P)}),Le(()=>{document.removeEventListener("keydown",P)});const p=async()=>{try{const x=await pt.getMemories();a.value=x.map(V=>({...V,expanded:f.has(V.conversation_id)?f.get(V.conversation_id):!1})),l.value=[...a.value],v()}catch(x){console.error("error:",x),a.value=[],l.value=[]}},S=x=>{Te.selectMemory(x),E("memory-selected")},y=x=>{const V=typeof x=="string"?parseInt(x,10):x;return isNaN(V)||V<=0?"--":new Date(V.toString().length===13?V:V*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const x=s.value.toLowerCase().trim();if(!x){l.value=[...a.value];return}l.value=a.value.filter(V=>{const w=V.memory_name.toLowerCase().includes(x),b=V.conversation_id.toLowerCase().includes(x),$=V.messages?.some(O=>O.text.toLowerCase().includes(x))??!1;return w||b||$})},R=()=>{r.value=!1,m.value=null},C=async()=>{if(!m.value)return;const x=_.value.trim()||"unknow name",V=a.value.findIndex(w=>w.conversation_id===m.value);if(V!==-1){const w=a.value[V];try{const b=await pt.updateMemory(w.conversation_id,x);b.messages||(b.messages=[]),a.value[V]={...b,expanded:w.expanded},v(),r.value=!1}catch(b){console.error("error:",b)}}},N=x=>{const V=a.value.find(w=>w.conversation_id===x);if(V){V.expanded=!V.expanded,f.set(x,V.expanded);const w=l.value.findIndex(b=>b.conversation_id===x);w!==-1&&(l.value[w]={...V})}},T=x=>{c.value=x,i.value=!0},U=()=>{i.value=!1,c.value=null},G=async()=>{if(c.value)try{await pt.deleteMemory(c.value),a.value=a.value.filter(x=>x.conversation_id!==c.value),v(),a.value.length===0&&Te.clearMemoryId(),i.value=!1,c.value=null}catch(x){console.error("error:",x)}};return(x,V)=>(h(),ye(to,{to:"body"},[A(Lt,{name:"modal"},{default:Ke(()=>[d(Te).isCollapsed?(h(),g("div",vl,[n("div",gl,[n("div",yl,[n("div",bl,[n("div",_l,[n("h1",wl,[n("span",null,u(x.$t("memory.title")),1)])]),e.value?(h(),g("div",$l)):B("",!0)]),n("button",{class:"close-btn",onClick:V[0]||(V[0]=w=>d(Te).toggleSidebar())},[A(d(D),{icon:"carbon:close"})])]),n("div",Sl,[n("div",Tl,[A(d(D),{class:"search-container-icon",icon:"carbon:search"}),ve(n("input",{type:"text",placeholder:x.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":V[1]||(V[1]=w=>s.value=w),onInput:v},null,40,kl),[[Se,s.value]])])]),n("div",El,[n("div",null,[(h(!0),g(ue,null,me(l.value,w=>(h(),g("div",{class:ce(["message-item",{expanded:w.expanded}]),key:w.conversation_id},[n("div",Pl,[n("div",Cl,[n("div",Il,[n("div",{class:"sender-div",onClick:ge(b=>S(w.conversation_id),["stop"])},[n("h3",xl,u(w.memory_name),1)],8,Rl),n("div",Al,[n("button",{class:"delete-btn",onClick:ge(b=>N(w.conversation_id),["stop"])},[A(d(D),{id:"toggle-"+w.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Fl)]),n("div",Dl,[n("button",{class:"delete-btn",onClick:ge(b=>T(w.conversation_id),["stop"])},[A(d(D),{icon:"carbon:delete"})],8,Ml)])]),n("div",Nl,[n("span",Ul,"ID: "+u(w.conversation_id),1),n("div",Ll,[w.messages&&w.messages.length>0?(h(),g("span",Ol,u(w.messages.length)+" "+u(x.$t("memory.size")),1)):B("",!0),n("span",ql,u(y(w.create_time)),1)])])])]),w.expanded?(h(),g("div",{key:0,id:"content-"+w.conversation_id,class:"expanded-content"},[n("div",Hl,[(h(!0),g(ue,null,me(w.messages,(b,$)=>(h(),g("div",{class:"message-bubble",key:$},[n("div",jl,u(b.messageType),1),n("div",Vl,[n("p",zl,u(b.text),1)])]))),128))])],8,Bl)):B("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),g("div",Wl,V[3]||(V[3]=[n("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),r.value?(h(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ge(R,["self"])},[n("div",Gl,[n("div",Kl,[n("h3",Jl,u(x.$t("memory.changeName")),1),ve(n("input",{type:"text","onUpdate:modelValue":V[2]||(V[2]=w=>_.value=w),class:"edit-input",placeholder:x.$t("memory.newNamePlaceholder")},null,8,Xl),[[Se,_.value]]),n("span",Ql,u(_.value.length),1)]),n("div",Yl,[n("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:R},u(x.$t("memory.cancel")),1),n("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:C},u(x.$t("memory.save")),1)])])])):B("",!0),i.value?(h(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ge(U,["self"])},[n("div",Zl,[n("div",er,[n("h3",tr,u(x.$t("memory.deleteHint")),1),n("p",sr,u(x.$t("memory.deleteHintPrefix"))+" "+u(c.value)+" "+u(x.$t("memory.deleteHintSuffix")),1)]),n("div",or,[n("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:U},u(x.$t("memory.cancel")),1),n("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:G},u(x.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),ar=we(nr,[["__scopeId","data-v-16358835"]]);class We{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),m=document.createElement("a");m.href=r,m.download=s??e.split("/").pop()??"download",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(r),document.body.removeChild(m)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const lr={class:"file-tree-node"},rr={class:"node-icon"},ir={class:"node-name"},cr={key:1,class:"file-size"},ur={key:2,class:"node-actions"},dr={key:0,class:"children"},pr=_e({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:t}){const e=o,s=t,a=F(e.level===0),l=F(!1),r=F(!1),m=F({}),_=()=>{e.node.type==="directory"&&(a.value=!a.value)},i=()=>{e.node.type==="directory"?_():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),P()},f=()=>{s("download-file",e.node),P()},E=v=>{v.preventDefault(),r.value=!0,m.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",P)},0)},P=()=>{r.value=!1,document.removeEventListener("click",P)},p=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(v){console.error("Failed to copy path:",v)}P()},S=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":We.getFileIcon(e.node),y=v=>{if(v===0)return"0 B";const R=1024,C=["B","KB","MB","GB"],N=Math.floor(Math.log(v)/Math.log(R));return parseFloat((v/Math.pow(R,N)).toFixed(1))+" "+C[N]};return Le(()=>{document.removeEventListener("click",P)}),(v,R)=>{const C=ms("FileTreeNode",!0);return h(),g("div",lr,[n("div",{class:ce(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Ge({paddingLeft:`${v.level*16+12}px`}),onClick:i,onContextmenu:ge(E,["prevent"])},[v.node.type==="directory"?(h(),g("div",{key:0,class:"expand-icon",onClick:ge(_,["stop"])},[A(d(D),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),n("div",rr,[A(d(D),{icon:S()},null,8,["icon"])]),n("span",ir,u(v.node.name),1),v.node.type==="file"?(h(),g("span",cr,u(y(v.node.size)),1)):B("",!0),l.value?(h(),g("div",ur,[v.node.type==="file"?(h(),g("button",{key:0,onClick:R[0]||(R[0]=ge(N=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(d(D),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(h(),g("div",dr,[(h(!0),g(ue,null,me(v.node.children,N=>(h(),ye(C,{key:N.path,node:N,level:v.level+1,onFileSelected:R[1]||(R[1]=T=>v.$emit("file-selected",T)),onDownloadFile:R[2]||(R[2]=T=>v.$emit("download-file",T))},null,8,["node","level"]))),128))])):B("",!0),r.value?(h(),g("div",{key:1,class:"context-menu",style:Ge(m.value),onClick:R[3]||(R[3]=ge(()=>{},["stop"]))},[n("div",{class:"context-menu-item",onClick:c},[A(d(D),{icon:"carbon:view"}),R[4]||(R[4]=n("span",null,"Open",-1))]),v.node.type==="file"?(h(),g("div",{key:0,class:"context-menu-item",onClick:f},[A(d(D),{icon:"carbon:download"}),R[5]||(R[5]=n("span",null,"Download",-1))])):B("",!0),R[7]||(R[7]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:p},[A(d(D),{icon:"carbon:copy"}),R[6]||(R[6]=n("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),mr=we(pr,[["__scopeId","data-v-3fc455d1"]]),hr={class:"file-browser"},fr={class:"file-browser-header"},vr={class:"header-actions"},gr=["disabled","title"],yr={class:"file-browser-content"},br={class:"file-tree-panel"},_r={key:0,class:"loading-state"},wr={key:1,class:"error-state"},$r={key:0,class:"waiting-for-files"},Sr={class:"message-content"},Tr={class:"tips"},kr=["disabled"],Er={key:1,class:"actual-error"},Pr={key:2,class:"empty-state"},Cr={key:3,class:"file-tree"},Ir={key:0,class:"file-content-panel"},Rr={class:"file-content-header"},xr={class:"file-info"},Ar={class:"file-name"},Fr={class:"file-size"},Dr={class:"file-actions"},Mr=["title"],Nr=["title"],Ur={class:"file-content-body"},Lr={key:0,class:"loading-content"},Or={key:1,class:"content-error"},qr={key:2,class:"file-content"},Br={key:0,class:"text-content"},Hr={key:1,class:"binary-content"},jr=_e({name:"FileBrowser",__name:"index",props:{planId:{}},setup(o){const t=o,{t:e}=Me(),s=F(!1),a=F(null),l=F(null),r=F(null),m=F(null),_=F(!1),i=F(null),c=F(null),f=Z(()=>!m.value||!r.value?!1:We.isTextFile(m.value.mimeType,r.value.name)),E=Z(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),P=()=>{c.value&&(clearTimeout(c.value),c.value=null)},p=()=>{P(),c.value=window.setTimeout(()=>{E.value&&S()},5e3)},S=async()=>{if(t.planId){s.value=!0,a.value=null,P();try{l.value=await We.getFileTree(t.planId)}catch(T){a.value=T instanceof Error?T.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",T);const U=T instanceof Error?T.message:"";(U.includes("Plan directory not found")||U.includes("not found"))&&p()}finally{s.value=!1}}},y=async T=>{if(T.type!=="directory"){r.value=T,m.value=null,_.value=!0,i.value=null;try{m.value=await We.getFileContent(t.planId,T.path)}catch(U){i.value=U instanceof Error?U.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",U)}finally{_.value=!1}}},v=async T=>{try{await We.downloadFile(t.planId,T.path,T.name)}catch(U){console.error("Failed to download file:",U)}},R=()=>{r.value=null,m.value=null,i.value=null},C=T=>We.getFileIcon(T),N=T=>{if(T===0)return"0 B";const U=1024,G=["B","KB","MB","GB"],x=Math.floor(Math.log(T)/Math.log(U));return parseFloat((T/Math.pow(U,x)).toFixed(1))+" "+G[x]};return de(()=>t.planId,T=>{T&&(r.value=null,m.value=null,S())},{immediate:!0}),De(()=>{t.planId&&S()}),Le(()=>{P()}),(T,U)=>(h(),g("div",hr,[n("div",fr,[n("h3",null,u(T.$t("fileBrowser.title")),1),n("div",vr,[n("button",{class:"refresh-btn",onClick:S,disabled:s.value,title:T.$t("fileBrowser.refresh")},[A(d(D),{icon:"carbon:refresh",class:ce({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,gr)])]),n("div",yr,[n("div",br,[s.value?(h(),g("div",_r,[A(d(D),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(T.$t("fileBrowser.loading")),1)])):a.value?(h(),g("div",wr,[E.value?(h(),g("div",$r,[A(d(D),{icon:"carbon:time",class:"rotating"}),n("div",Sr,[n("h3",null,u(T.$t("fileBrowser.waitingForGeneration")),1),n("p",null,u(T.$t("fileBrowser.planExecuting")),1),n("div",Tr,[A(d(D),{icon:"carbon:information"}),n("span",null,u(T.$t("fileBrowser.filesTip")),1)])]),n("button",{onClick:S,class:"retry-btn",disabled:s.value},[A(d(D),{icon:"carbon:refresh",class:ce({rotating:s.value})},null,8,["class"]),ie(" "+u(s.value?T.$t("fileBrowser.checking"):T.$t("fileBrowser.checkNow")),1)],8,kr)])):(h(),g("div",Er,[A(d(D),{icon:"carbon:warning"}),n("span",null,u(a.value),1),n("button",{onClick:S,class:"retry-btn"},u(T.$t("fileBrowser.retry")),1)]))])):l.value?(h(),g("div",Cr,[A(mr,{node:l.value,level:0,onFileSelected:y,onDownloadFile:v},null,8,["node"])])):(h(),g("div",Pr,[A(d(D),{icon:"carbon:folder-off"}),n("span",null,u(T.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),g("div",Ir,[n("div",Rr,[n("div",xr,[A(d(D),{icon:C(r.value)},null,8,["icon"]),n("span",Ar,u(r.value.name),1),n("span",Fr,"("+u(N(r.value.size))+")",1)]),n("div",Dr,[n("button",{onClick:U[0]||(U[0]=G=>v(r.value)),class:"download-btn",title:T.$t("fileBrowser.download")},[A(d(D),{icon:"carbon:download"})],8,Mr),n("button",{onClick:R,class:"close-btn",title:T.$t("common.close")},[A(d(D),{icon:"carbon:close"})],8,Nr)])]),n("div",Ur,[_.value?(h(),g("div",Lr,[A(d(D),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(T.$t("fileBrowser.loadingContent")),1)])):i.value?(h(),g("div",Or,[A(d(D),{icon:"carbon:warning"}),n("span",null,u(i.value),1)])):m.value?(h(),g("div",qr,[f.value?(h(),g("div",Br,[n("pre",null,[n("code",null,u(m.value.content),1)])])):(h(),g("div",Hr,[A(d(D),{icon:"carbon:document-unknown"}),n("p",null,u(T.$t("fileBrowser.binaryFile")),1),n("button",{onClick:U[1]||(U[1]=G=>v(r.value)),class:"download-btn-large"},[A(d(D),{icon:"carbon:download"}),ie(" "+u(T.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),Vr=we(jr,[["__scopeId","data-v-a19b1e5b"]]),zr="/api/executor";async function ws(o){try{const t=await fetch(`${zr}/agent-execution/${o}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,t),null}}async function Wr(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),ws(o)}function Gr(){const o=Ye(),t=Qe(),e=F(null),s=F(null),a=F("details"),l=Z(()=>o.rootPlanId.value),r=v=>{if(!v)return null;for(const[R,C]of t.planExecutionRecords.entries())if((C.rootPlanId||C.currentPlanId)&&C.agentExecutionSequence)for(const T of C.agentExecutionSequence){if(T.stepId===v){const U=C.rootPlanId||C.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:v,rootPlanId:U,planId:R}),U||null}if(T.subPlanExecutionRecords)for(const U of T.subPlanExecutionRecords){const G=m(U,v);if(G)return G}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",v),null},m=(v,R)=>{if(!v||!v.agentExecutionSequence)return null;for(const C of v.agentExecutionSequence){if(C.stepId===R)return v.rootPlanId||v.currentPlanId||null;if(C.subPlanExecutionRecords)for(const N of C.subPlanExecutionRecords){const T=m(N,R);if(T)return T}}return null},_=Z(()=>s.value||l.value),i=Z(()=>!_.value),c=async v=>{if(console.log("[useRightPanel] Step selected:",{stepId:v}),!v){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}try{const R=r(v);R?(s.value=R,console.log("[useRightPanel] Set selectedRootPlanId to:",R)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const C=await ws(v);if(!C){console.warn("[useRightPanel] Agent execution detail not found for stepId:",v),e.value=null,s.value=null;return}const N={stepId:v,title:C.agentName??`Step ${v}`,description:C.agentDescription??"",agentExecution:C,completed:C.status==="FINISHED",current:C.status==="RUNNING"};e.value=N,console.log("[useRightPanel] Step details updated:",N),await xe(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(R){console.error("[useRightPanel] Error fetching step details:",R),e.value=null,s.value=null}},f=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const v=await Wr(e.value.stepId);v&&(e.value.agentExecution=v,e.value.completed=v.status==="FINISHED",e.value.current=v.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(v){console.error("[useRightPanel] Error refreshing step:",v)}},E=v=>{a.value=v,console.log("[useRightPanel] Active tab set to:",v)},P=v=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",v)},p=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},S=v=>{if(v===null||typeof v>"u"||v==="")return"N/A";if(typeof v=="object"&&v!==null)try{return JSON.stringify(v,null,2)}catch{return String(v)}if(typeof v=="string"){const R=v.trim();if(R==="")return"N/A";try{const C=JSON.parse(R);return JSON.stringify(C,null,2)}catch{return R}}return String(v)},y=()=>{e.value=null,s.value=null,a.value="details",console.log("[useRightPanel] State reset")};return{selectedStep:Ue(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:_,shouldShowNoTaskMessage:i,handleStepSelected:c,refreshCurrentStep:f,setActiveTab:E,updateDisplayedPlanProgress:P,clearSelectedStep:p,formatJson:S,reset:y}}let kt=null;function Kr(){return kt||(kt=Gr()),kt}const Jr={class:"right-panel"},Xr={class:"preview-header"},Qr={class:"preview-tabs"},Yr={class:"preview-content"},Zr={key:0,class:"step-details"},ei={key:0,class:"step-info"},ti={key:0,class:"agent-info"},si={class:"info-item"},oi={class:"label"},ni=["title"],ai={class:"info-item"},li={class:"label"},ri={class:"value"},ii={class:"execution-status"},ci={class:"status-item"},ui={class:"status-text"},di={key:0},pi={key:0,class:"think-act-steps"},mi={class:"steps-container"},hi={class:"step-header"},fi={class:"step-number"},vi={class:"think-section"},gi={class:"think-content"},yi={class:"input"},bi={class:"label"},_i={class:"output"},wi={class:"label"},$i={key:0,class:"action-section"},Si={class:"action-content"},Ti={class:"tool-info"},ki={class:"label"},Ei={class:"value"},Pi={class:"input"},Ci={class:"label"},Ii={class:"output"},Ri={class:"label"},xi={key:0,class:"no-tools"},Ai={key:0,class:"sub-plan-section"},Fi={class:"sub-plan-content"},Di={class:"sub-plan-header"},Mi={class:"sub-plan-info"},Ni={class:"label"},Ui={class:"value"},Li={key:0,class:"sub-plan-info"},Oi={class:"label"},qi={class:"value"},Bi={class:"sub-plan-status"},Hi={class:"status-text"},ji={key:0,class:"no-steps-message"},Vi={key:1,class:"no-execution-message"},zi={class:"step-basic-info"},Wi={class:"info-item"},Gi={class:"label"},Ki={class:"value"},Ji={key:0,class:"info-item"},Xi={class:"label"},Qi={class:"value"},Yi={class:"info-item"},Zi={class:"label"},ec={class:"no-execution-hint"},tc={key:2,class:"execution-indicator"},sc={class:"execution-text"},oc={key:1,class:"no-selection"},nc=["title"],ac={key:1,class:"file-browser-container"},lc={key:1,class:"no-plan-message"},rc={class:"message-content"},ic={class:"tips"},cc=_e({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:t}){const e=o,{t:s}=Me(),a=Kr(),l=F(),r=F(!1),m=F(!0),_=F(!0),i=Z(()=>a.selectedStep.value),c=Z({get:()=>a.activeTab.value,set:x=>a.setActiveTab(x)}),f=Z(()=>a.fileBrowserPlanId.value),E=Z(()=>a.shouldShowNoTaskMessage.value),P=Z(()=>i.value?i.value.completed?s("rightPanel.status.completed"):i.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),p=async x=>{await a.handleStepSelected(x),setTimeout(()=>{v()},100),C()},S=async()=>{await a.refreshCurrentStep(),C()};de(()=>e.selectedStepId,async x=>{x?await p(x):a.clearSelectedStep()},{immediate:!0});const y=x=>{l.value=x??void 0},v=()=>{if(!l.value)return;const{scrollTop:x,scrollHeight:V,clientHeight:w}=l.value,b=V-x-w<50,$=V>w;m.value=b,r.value=$&&!b,b?_.value=!0:V-x-w>100&&(_.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:x,scrollHeight:V,clientHeight:w,isAtBottom:b,hasScrollableContent:$,showButton:r.value,shouldAutoScroll:_.value})},R=()=>{l.value&&(l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"}),xe(()=>{_.value=!0,v()}))},C=()=>{!_.value||!l.value||xe(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},N=a.formatJson,T=()=>{_.value=!0,l.value&&l.value.removeEventListener("scroll",v)},U=()=>{const x=()=>{const V=l.value;return V?(y(V),V.addEventListener("scroll",v),_.value=!0,v(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};xe(()=>{x()||setTimeout(()=>{x()},100)})};return De(()=>{console.log("[RightPanel] Component mounted"),xe(()=>{U()})}),Le(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),T()}),t({handleStepSelected:p,refreshCurrentStep:S,updateDisplayedPlanProgress:x=>{a.updateDisplayedPlanProgress(x)}}),(x,V)=>(h(),g("div",Jr,[n("div",Xr,[n("div",Qr,[n("div",{class:ce(["tab-item",{active:c.value==="details"}]),onClick:V[0]||(V[0]=w=>c.value="details")},[A(d(D),{icon:"carbon:events"}),n("span",null,u(d(s)("rightPanel.stepExecutionDetails")),1)],2),n("div",{class:ce(["tab-item",{active:c.value==="files"}]),onClick:V[1]||(V[1]=w=>c.value="files")},[A(d(D),{icon:"carbon:folder"}),n("span",null,u(d(s)("fileBrowser.title")),1)],2)])]),n("div",Yr,[c.value==="details"?(h(),g("div",Zr,[i.value?(h(),g("div",ei,[n("h3",null,u(i.value.title||i.value.description||d(s)("rightPanel.defaultStepTitle",{number:1})),1),i.value.agentExecution?(h(),g("div",ti,[n("div",si,[n("span",oi,u(d(s)("rightPanel.executingAgent"))+":",1),n("span",{class:"value",title:i.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.clickToViewExecutionDetails"):""},u(i.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.funcAgentExecutionDetails"):i.value.agentExecution.agentName),9,ni)]),n("div",ai,[n("span",li,u(d(s)("rightPanel.callingModel"))+":",1),n("span",ri,u(i.value.agentExecution.modelName),1)])])):B("",!0),n("div",ii,[n("div",ci,[i.value.completed?(h(),ye(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):i.value.current?(h(),ye(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),ye(d(D),{key:2,icon:"carbon:time",class:"status-icon pending"})),n("span",ui,u(P.value),1)])])])):B("",!0),n("div",{ref_key:"scrollContainer",ref:l,class:"step-details-scroll-container",onScroll:v},[i.value?(h(),g("div",di,[i.value.agentExecution?.thinkActSteps&&i.value.agentExecution.thinkActSteps.length>0?(h(),g("div",pi,[n("h4",null,u(d(s)("rightPanel.thinkAndActionSteps")),1),n("div",mi,[(h(!0),g(ue,null,me(i.value.agentExecution.thinkActSteps,(w,b)=>(h(),g("div",{key:b,class:"think-act-step"},[n("div",hi,[n("span",fi,"#"+u(b+1),1),n("span",{class:ce(["step-status",w.status])},u(w.status||d(s)("rightPanel.executing")),3)]),n("div",vi,[n("h5",null,[A(d(D),{icon:"carbon:thinking"}),ie(" "+u(d(s)("rightPanel.thinking")),1)]),n("div",gi,[n("div",yi,[n("span",bi,u(d(s)("rightPanel.input"))+":",1),n("pre",null,u(d(N)(w.thinkInput)),1)]),n("div",_i,[n("span",wi,u(d(s)("rightPanel.output"))+":",1),n("pre",null,u(d(N)(w.thinkOutput)),1)])])]),w.actionNeeded?(h(),g("div",$i,[n("h5",null,[A(d(D),{icon:"carbon:play"}),ie(" "+u(d(s)("rightPanel.action")),1)]),n("div",Si,[(h(!0),g(ue,null,me(w.actToolInfoList||[],($,O)=>(h(),g("div",{key:`tool-${O}-${$?.id||$?.name||O}`,class:"tool-execution-item"},[n("div",Ti,[n("span",ki,u(d(s)("rightPanel.tool"))+":",1),n("span",Ei,u($?.name||"N/A"),1)]),n("div",Pi,[n("span",Ci,u(d(s)("rightPanel.toolParameters"))+":",1),n("pre",null,u(d(N)($?.parameters)),1)]),n("div",Ii,[n("span",Ri,u(d(s)("rightPanel.executionResult"))+":",1),n("pre",null,u(d(N)($?.result)),1)])]))),128)),!w.actToolInfoList||w.actToolInfoList.length===0?(h(),g("div",xi,[n("p",null,u(d(s)("rightPanel.noToolsExecuted")),1)])):B("",!0)]),w.subPlanExecutionRecord?(h(),g("div",Ai,[n("h5",null,[A(d(D),{icon:"carbon:tree-view"}),ie(" "+u(d(s)("rightPanel.subPlan")),1)]),n("div",Fi,[n("div",Di,[n("div",Mi,[n("span",Ni,u(x.$t("rightPanel.subPlanId"))+":",1),n("span",Ui,u(w.subPlanExecutionRecord.currentPlanId),1)]),w.subPlanExecutionRecord.title?(h(),g("div",Li,[n("span",Oi,u(x.$t("rightPanel.title"))+":",1),n("span",qi,u(w.subPlanExecutionRecord.title),1)])):B("",!0),n("div",Bi,[w.subPlanExecutionRecord.completed?(h(),ye(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),ye(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),n("span",Hi,u(w.subPlanExecutionRecord.completed?x.$t("rightPanel.status.completed"):x.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),i.value.agentExecution&&!i.value.agentExecution.thinkActSteps?.length?(h(),g("div",ji,[n("p",null,u(d(s)("rightPanel.noStepDetails")),1)])):i.value.agentExecution?B("",!0):(h(),g("div",Vi,[A(d(D),{icon:"carbon:information",class:"info-icon"}),n("h4",null,u(d(s)("rightPanel.stepInfo")),1),n("div",zi,[n("div",Wi,[n("span",Gi,u(d(s)("rightPanel.stepName"))+":",1),n("span",Ki,u(i.value.title||i.value.description||i.value.stepId),1)]),i.value.description?(h(),g("div",Ji,[n("span",Xi,u(x.$t("rightPanel.description"))+":",1),n("span",Qi,u(i.value.description),1)])):B("",!0),n("div",Yi,[n("span",Zi,u(x.$t("rightPanel.status.label"))+":",1),n("span",{class:ce(["value",{"status-completed":i.value.completed,"status-current":i.value.current,"status-pending":!i.value.completed&&!i.value.current}])},u(i.value.completed?x.$t("rightPanel.status.completed"):i.value.current?x.$t("rightPanel.status.executing"):x.$t("rightPanel.status.pending")),3)])]),n("p",ec,u(d(s)("rightPanel.noExecutionInfo")),1)])),i.value.current&&!i.value.completed?(h(),g("div",tc,[V[2]||(V[2]=n("div",{class:"execution-waves"},[n("div",{class:"wave wave-1"}),n("div",{class:"wave wave-2"}),n("div",{class:"wave wave-3"})],-1)),n("p",sc,[A(d(D),{icon:"carbon:in-progress",class:"rotating-icon"}),ie(" "+u(d(s)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(h(),g("div",oc,[A(d(D),{icon:"carbon:events",class:"empty-icon"}),n("h3",null,u(d(s)("rightPanel.noStepSelected")),1),n("p",null,u(d(s)("rightPanel.selectStepHint")),1)]))])):B("",!0),A(Lt,{name:"scroll-button"},{default:Ke(()=>[r.value?(h(),g("button",{key:0,onClick:R,class:"scroll-to-bottom-btn",title:d(s)("rightPanel.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,nc)):B("",!0)]),_:1})],544)])):B("",!0),c.value==="files"?(h(),g("div",ac,[f.value?(h(),ye(Vr,{key:0,"plan-id":f.value},null,8,["plan-id"])):E.value?(h(),g("div",lc,[A(d(D),{icon:"carbon:folder-off"}),n("div",rc,[n("h3",null,u(d(s)("fileBrowser.noFilesYet")),1),n("p",null,u(d(s)("fileBrowser.noPlanExecuting")),1),n("div",ic,[A(d(D),{icon:"carbon:information"}),n("span",null,u(d(s)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])]))}}),uc=we(cc,[["__scopeId","data-v-5e634fb3"]]);class $s{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function dc(){const o=F([]),t=F(!1),e=F(null);return{availableTools:o,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await $s.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),o.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",o.value=[]}finally{t.value=!1}}},reset:()=>{o.value=[],t.value=!1,e.value=null}}}let Et=null;function at(){return Et||(Et=dc()),Et}class Ss{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}const pc={class:"modal-form wide-modal"},mc={class:"form-section"},hc={class:"form-item"},fc=["placeholder"],vc={class:"field-description"},gc={class:"form-section"},yc={class:"section-title"},bc={key:0,class:"params-help-text"},_c={class:"parameter-table"},wc=["onUpdate:modelValue","placeholder","readonly"],$c=["onUpdate:modelValue","placeholder"],Sc={class:"form-section"},Tc={class:"service-publish-options"},kc={class:"internal-toolcall-publish-option"},Ec={class:"checkbox-label"},Pc={class:"checkbox-text"},Cc={class:"checkbox-description"},Ic={class:"http-publish-option"},Rc={class:"checkbox-label"},xc={class:"checkbox-text"},Ac={class:"checkbox-description"},Fc={class:"button-container"},Dc=["disabled"],Mc=["disabled"],Nc=_e({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(o,{expose:t,emit:e}){const{t:s}=Me(),a=Xe(),l=at(),r=o,m=e,_=Z({get:()=>r.modelValue,set:b=>m("update:modelValue",b)}),i=F(""),c=F(""),f=F(!1),E=F(!1),P=F(!1),p=F(!0),S=F({parameters:[],hasParameters:!1,requirements:""}),y=F(!1),v=nt({userRequest:"",parameters:[]}),R=Z(()=>{const b=!!a.selectedTemplate.value?.toolConfig;return s(b?"mcpService.updateService":"mcpService.createService")}),C=Z(()=>!!a.selectedTemplate.value?.toolConfig),N=()=>{const b=a.selectedTemplate.value?.toolConfig;b?(v.userRequest=b.toolDescription||"",P.value=b.enableHttpService??!1,p.value=b.enableInternalToolcall??!0,b.inputSchema&&Array.isArray(b.inputSchema)&&b.inputSchema.length>0?v.parameters=b.inputSchema.map($=>({name:$.name||"",description:$.description||""})):S.value.hasParameters||(v.parameters=[])):(v.userRequest="",P.value=!1,p.value=!0,S.value.hasParameters||(v.parameters=[]))},T=async()=>{const b=a.currentPlanTemplateId.value;if(!b){S.value={parameters:[],hasParameters:!1,requirements:""};return}y.value=!0;try{const $=await Ss.getParameterRequirements(b);if(S.value=$,$.hasParameters){const O=new Map;v.parameters.forEach(W=>{W.name&&O.set(W.name,W.description||"")}),v.parameters=$.parameters.map(W=>({name:W,description:O.get(W)||""}))}}catch($){console.error("[PublishModal] Failed to load parameter requirements:",$),$ instanceof Error&&!$.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),S.value={parameters:[],hasParameters:!1,requirements:""}}finally{y.value=!1}},U=(b,$)=>{$==="success"?(c.value=b,setTimeout(()=>{c.value=""},3e3)):$==="error"&&(i.value=b,setTimeout(()=>{i.value=""},5e3))},G=()=>{if(!v.userRequest.trim())return U(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return U(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return U(s("mcpService.toolNameRequiredError"),"error"),!1;if(!p.value&&!P.value)return U("Please select at least one service type","error"),!1;for(let O=0;O<v.parameters.length;O++){const W=v.parameters[O];if(W.name&&!W.description.trim())return U(`Parameter "${W.name}" description cannot be empty`,"error"),!1;if(W.description&&!W.name.trim())return U(`Parameter description "${W.description}" corresponding name cannot be empty`,"error"),!1}return!0},x=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",v),console.log("[PublishModal] Publish as HTTP service:",P.value),!G()){console.log("[PublishModal] Form validation failed");return}f.value=!0;try{const b=v.parameters.filter(W=>W.name.trim()&&W.description.trim()).map(W=>({name:W.name.trim(),description:W.description.trim(),type:"string"}));if(a.setToolDescription(v.userRequest.trim()),a.setEnableInternalToolcall(p.value),a.setEnableHttpService(P.value),a.setInputSchema(b),!await a.save())throw new Error("Failed to save plan template");const O=[];p.value&&O.push("Internal Method Call"),P.value&&O.push("HTTP Service"),O.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",O.join(", ")),U(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),m("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),U(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),m("published",null))}catch(b){console.error("[PublishModal] Failed to publish service:",b);const $=b instanceof Error?b.message:"Unknown error";U(s("mcpService.publishFailed")+": "+$,"error")}finally{f.value=!1}},V=async()=>{if(E.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const b=a.currentPlanTemplateId.value;if(!b){U(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",b),a.setToolConfig(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),U(s("mcpService.deleteSuccess"),"success"),_.value=!1,m("published",null)}catch($){console.error("[PublishModal] Failed to delete tool config:",$);const O=$ instanceof Error?$.message:"Unknown error";U(s("mcpService.deleteFailed")+": "+O,"error")}finally{E.value=!1}};return de(()=>r.modelValue,async()=>{_.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),N(),await T())}),de(()=>a.currentPlanTemplateId.value,(b,$)=>{b&&b!==$&&($&&b.startsWith("planTemplate-")?setTimeout(()=>{T()},1e3):T())}),De(async()=>{_.value&&(console.log("[PublishModal] Initialize when component mounted"),N(),await T())}),t({loadParameterRequirements:T}),(b,$)=>(h(),g(ue,null,[A(vs,{modelValue:_.value,"onUpdate:modelValue":$[3]||($[3]=O=>_.value=O),title:R.value,onConfirm:x},{footer:Ke(()=>[n("div",Fc,[C.value?(h(),g("button",{key:0,class:"action-btn danger",onClick:V,disabled:E.value},[E.value?(h(),ye(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ye(d(D),{key:1,icon:"carbon:trash-can"})),ie(" "+u(E.value?d(s)("mcpService.deleting"):d(s)("mcpService.delete")),1)],8,Dc)):B("",!0),n("button",{class:"action-btn primary",onClick:x,disabled:f.value},[f.value?(h(),ye(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ye(d(D),{key:1,icon:"carbon:cloud-upload"})),ie(" "+u(f.value?d(s)("mcpService.publishing"):d(s)("mcpService.publishAsService")),1)],8,Mc)])]),default:Ke(()=>[n("div",pc,[n("div",mc,[n("div",hc,[n("label",null,u(d(s)("mcpService.toolDescriptionRequired")),1),ve(n("textarea",{"onUpdate:modelValue":$[0]||($[0]=O=>v.userRequest=O),placeholder:d(s)("mcpService.toolDescriptionPlaceholder"),class:ce([{error:!v.userRequest||!v.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,fc),[[Se,v.userRequest]]),n("div",vc,u(d(s)("mcpService.toolDescriptionDescription")),1)])]),n("div",gc,[n("div",yc,u(d(s)("mcpService.parameterConfig")),1),S.value.hasParameters?(h(),g("div",bc,u(d(s)("sidebar.parameterRequirementsHelp")),1)):B("",!0),n("div",_c,[n("table",null,[n("thead",null,[n("tr",null,[n("th",null,u(d(s)("mcpService.parameterName")),1),n("th",null,u(d(s)("mcpService.parameterDescription")),1)])]),n("tbody",null,[(h(!0),g(ue,null,me(v.parameters,(O,W)=>(h(),g("tr",{key:W},[n("td",null,[ve(n("input",{type:"text","onUpdate:modelValue":ae=>O.name=ae,placeholder:d(s)("mcpService.parameterName"),class:ce(["parameter-input",{"readonly-input":S.value.hasParameters}]),readonly:S.value.hasParameters,required:""},null,10,wc),[[Se,O.name]])]),n("td",null,[ve(n("input",{type:"text","onUpdate:modelValue":ae=>O.description=ae,placeholder:d(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,$c),[[Se,O.description]])])]))),128))])])])]),n("div",Sc,[n("div",Tc,[n("div",kc,[n("label",Ec,[ve(n("input",{type:"checkbox","onUpdate:modelValue":$[1]||($[1]=O=>p.value=O),class:"checkbox-input"},null,512),[[xt,p.value]]),n("span",Pc,u(d(s)("mcpService.publishAsInternalToolcall")),1)]),n("div",Cc,u(d(s)("mcpService.publishAsInternalToolcallDescription")),1)]),n("div",Ic,[n("label",Rc,[ve(n("input",{type:"checkbox","onUpdate:modelValue":$[2]||($[2]=O=>P.value=O),class:"checkbox-input"},null,512),[[xt,P.value]]),n("span",xc,u(d(s)("mcpService.publishAsHttpService")),1)]),n("div",Ac,u(d(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),i.value?(h(),g("div",{key:0,class:"error-toast",onClick:$[4]||($[4]=O=>i.value="")},[A(d(D),{icon:"carbon:error"}),ie(" "+u(i.value),1)])):B("",!0),c.value?(h(),g("div",{key:1,class:"success-toast",onClick:$[5]||($[5]=O=>c.value="")},[A(d(D),{icon:"carbon:checkmark"}),ie(" "+u(c.value),1)])):B("",!0)],64))}}),Uc=we(Nc,[["__scopeId","data-v-84723fb4"]]),Lc={class:"modal-header"},Oc={class:"modal-body"},qc={class:"modal-footer"},Bc=["disabled"],Hc=_e({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(o,{emit:t}){const e=t,s=F(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(m,_)=>m.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:a},[n("div",{class:"modal-content",onClick:_[0]||(_[0]=ge(()=>{},["stop"]))},[n("div",Lc,[n("h3",null,u(m.$t("sidebar.saveConfirmationTitle")),1),n("button",{class:"close-btn",onClick:a},[A(d(D),{icon:"carbon:close",width:"16"})])]),n("div",Oc,[n("p",null,u(m.$t("sidebar.saveConfirmationMessage")),1)]),n("div",qc,[n("button",{class:"btn btn-secondary",onClick:a},u(m.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),ye(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):B("",!0),ie(" "+u(s.value?m.$t("sidebar.saving"):m.$t("common.save")),1)],8,Bc),n("button",{class:"btn btn-danger",onClick:r},u(m.$t("sidebar.continueWithoutSave")),1)])])])):B("",!0)}}),jc=we(Hc,[["__scopeId","data-v-4817656d"]]),Vc={class:"config-section"},zc={class:"section-header"},Wc={class:"execution-content"},Gc={class:"params-requirements-group"},Kc={class:"params-help-text"},Jc={key:0,class:"parameter-fields"},Xc={class:"parameter-label"},Qc=["onUpdate:modelValue","placeholder","onInput"],Yc={key:0,class:"parameter-error"},Zc={key:1,class:"validation-message"},eu=["disabled"],tu=["disabled"],su={key:1,class:"call-example-wrapper"},ou={class:"call-example-header"},nu={class:"call-example-title"},au={class:"call-example-description"},lu={class:"internal-call-wrapper"},ru={class:"call-info"},iu={class:"call-method"},cu={class:"call-endpoint"},uu={key:0,class:"call-endpoint"},du={class:"call-description"},pu={class:"call-example"},mu={class:"example-code"},hu={key:2,class:"call-example-wrapper"},fu={class:"call-example-header"},vu={class:"call-example-title"},gu={class:"call-example-description"},yu={class:"http-api-urls-wrapper"},bu={class:"tab-container"},_u={class:"tab-header"},wu=["onClick"],$u={class:"tab-content"},Su={class:"http-api-url-display"},Tu={class:"api-method"},ku={class:"api-endpoint"},Eu={class:"api-description"},Pu={key:0,class:"api-example"},Cu={class:"example-code"},Iu={key:3,class:"call-example-wrapper"},Ru={class:"call-example-header"},xu={class:"call-example-title"},Au={class:"call-example-description"},Fu={class:"mcp-call-wrapper"},Du={class:"call-info"},Mu={class:"call-method"},Nu={class:"call-endpoint"},Uu={class:"call-description"},Lu={class:"call-example"},Ou={class:"example-code"},qu=_e({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=Me(),s=gs(),a=Xe(),l=Ye(),r=Qe(),m=o,_=F(""),i=F(!1),c=F({parameters:[],hasParameters:!1,requirements:""}),f=F({}),E=F(!1),P=F("get-sync"),p=F({}),S=F(!1),y=F(!1),v=Z(()=>a.getCoordinatorToolConfig()),R=F(),C=F([]),N=F(null),T=F(!1),U=F(null),G=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),x=Z(()=>{const M=a.selectedTemplate.value?.toolConfig;return M?.enableInternalToolcall??M?.enableHttpService??M?.enableMcpService??!1}),V=Z(()=>x.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),w=Z(()=>l.isLoading.value),b=Z(()=>w.value||m.isExecuting?!1:c.value.hasParameters?c.value.parameters.every(M=>{const K=f.value[M];return typeof K=="string"&&K.trim()!==""}):!0),$=(M,K)=>{C.value=M.map(Y=>Y.originalName),N.value=K,console.log("[ExecutionController] Files uploaded:",M.length,"uploadKey:",K)},O=M=>{C.value=M.map(K=>K.originalName),console.log("[ExecutionController] Files removed, remaining:",M.length)},W=M=>{N.value=M,console.log("[ExecutionController] Upload key changed:",M)},ae=()=>{console.log("[ExecutionController] Upload started")},fe=()=>{console.log("[ExecutionController] Upload completed")},Ce=M=>{console.error("[ExecutionController] Upload error:",M)},ke=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",m.isExecuting,l.isLoading.value,y.value),s.error(e("sidebar.executionInProgress"));return}if(oe.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",p.value);return}const M=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;U.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:M,uploadedFiles:C.value,uploadKey:N.value},T.value=!0;return}await Ne()},Ne=async()=>{if(m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(y.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",p.value),y.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),y.value=!1;return}const M=a.getConfig(),K=a.selectedTemplate.value.planTemplateId||M.planTemplateId,Y={title:M.title||a.selectedTemplate.value.title||"Execution Plan",steps:(M.steps||[]).map(he=>({stepRequirement:he.stepRequirement||"",agentName:he.agentName||"",modelName:he.modelName||null,selectedToolKeys:[],terminateColumns:he.terminateColumns||"",stepContent:""})),directResponse:M.directResponse||!1,...K&&{planTemplateId:K},...M.planType&&{planType:M.planType}},$e=a.selectedTemplate.value.title??M.title??"Execution Plan",j=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",j),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(Y,null,2));const Q={title:$e,planData:Y,params:void 0,replacementParams:j,uploadedFiles:C.value,uploadKey:N.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(Q,null,2));const ne=await l.executePlan(Q);ne.success?console.log("[ExecutionController] âœ… Plan execution started successfully:",ne.planId):(console.error("[ExecutionController] âŒ Plan execution failed:",ne.error),s.error(ne.error||e("sidebar.executeFailed")))}catch(M){console.error("[ExecutionController] âŒ Error executing plan:",M);const K=M instanceof Error?M.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+K),y.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),q(),console.log("[ExecutionController] âœ… Cleanup completed")}},Ie=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const M=a.validate();if(!M.isValid){s.error(`Invalid format, please correct and save.
Errors: `+M.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const $e=a.generateJsonString().trim();a.updateVersionsAfterSave($e);const j=a.planVersions.value.length;oe.hasTaskRequirementModified=!1,await new Promise(Q=>setTimeout(Q,500)),await H(),await oe.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:j})),await new Promise(Q=>setTimeout(Q,500)),U.value&&(await Ne(),U.value=null)}catch(M){console.error("[ExecutionController] âŒ Failed to save before execute:",M);const K=M instanceof Error?M.message:e("sidebar.saveFailed");throw s.error(K),M}},Ee=async()=>{console.log("[ExecutionController] â© Continue without save requested"),U.value&&(await Ne(),U.value=null)},L=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}i.value=!0},q=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),_.value="",f.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},H=async()=>{await new Promise(M=>setTimeout(M,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(M=>M.stepRequirement).join(" ||| ")),await new Promise(M=>setTimeout(M,200)),await X()},X=async()=>{const M=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",M),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!M){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const K=await Ss.getParameterRequirements(M);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(K,null,2)),c.value=K;const Y={};K.parameters.forEach($e=>{Y[$e]=f.value[$e]||""}),f.value=Y,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(f.value,null,2)),le()}catch(K){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",K),K instanceof Error&&!K.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(f.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},te=(M,K)=>{f.value[M]=K,p.value[M]&&delete p.value[M],le()},re=()=>{if(p.value={},S.value=!1,!c.value.hasParameters)return!0;let M=!1;return c.value.parameters.forEach(K=>{(f.value[K]?f.value[K].trim():"")||(p.value[K]=`${K} is required`,M=!0)}),S.value=M,!M},le=()=>{c.value.hasParameters?_.value=JSON.stringify(f.value,null,2):_.value=""};return de(()=>a.currentPlanTemplateId.value,(M,K)=>{if(M&&M!==K){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),K&&M.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),X()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),X())}}),de(()=>{const M=a.selectedTemplate.value;return!M||!M.steps?"":M.steps.map(K=>K.stepRequirement||"").join("|||")},async(M,K)=>{if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}M!==K&&a.currentPlanTemplateId.value&&(console.log("[ExecutionController] ðŸ”„ Steps content changed, will refresh parameter requirements"),console.log("[ExecutionController] ðŸ“‹ Old content:",K?.substring(0,100)||"empty"),console.log("[ExecutionController] ðŸ“‹ New content:",M?.substring(0,100)||"empty"),await new Promise(Y=>setTimeout(Y,2e3)),console.log("[ExecutionController] â° Refreshing parameters after steps change"),await H())},{deep:!1}),de(()=>oe.hasTaskRequirementModified,async(M,K)=>{if(K===!0&&M===!1&&a.currentPlanTemplateId.value){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(Y=>setTimeout(Y,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await H()}}),fs(()=>{const M=r.planExecutionRecords;!Array.from(M.entries()).some(([,$e])=>$e&&!$e.completed&&$e.status!=="failed")&&y.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan"),y.value=!1)}),De(()=>{X()}),t({executionParams:_,clearExecutionParams:q,loadParameterRequirements:X,refreshParameterRequirements:H,fileUploadRef:R,uploadedFiles:C,uploadKey:N}),(M,K)=>(h(),g(ue,null,[n("div",Vc,[n("div",zc,[A(d(D),{icon:"carbon:play",width:"16"}),n("span",null,u(d(e)("sidebar.executionController")),1)]),n("div",Wc,[n("div",Gc,[n("label",null,u(d(e)("sidebar.parameterRequirements")),1),n("div",Kc,u(d(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),g("div",Jc,[(h(!0),g(ue,null,me(c.value.parameters,Y=>(h(),g("div",{key:Y,class:"parameter-field"},[n("label",Xc,[ie(u(Y)+" ",1),K[2]||(K[2]=n("span",{class:"required"},"*",-1))]),ve(n("input",{"onUpdate:modelValue":$e=>f.value[Y]=$e,class:ce(["parameter-input",{error:p.value[Y]}]),placeholder:d(e)("sidebar.enterValueFor",{param:Y}),onInput:$e=>te(Y,$e.target.value),required:""},null,42,Qc),[[Se,f.value[Y]]]),p.value[Y]?(h(),g("div",Yc,u(p.value[Y]),1)):B("",!0)]))),128))])):B("",!0),c.value.hasParameters&&!b.value&&!m.isExecuting?(h(),g("div",Zc,[A(d(D),{icon:"carbon:warning",width:"14"}),ie(" "+u(d(e)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),A(_s,{ref_key:"fileUploadRef",ref:R,disabled:m.isExecuting,onFilesUploaded:$,onFilesRemoved:O,onUploadKeyChanged:W,onUploadStarted:ae,onUploadCompleted:fe,onUploadError:Ce},null,8,["disabled"]),n("button",{class:"btn btn-primary execute-btn",onClick:ke,disabled:!b.value},[A(d(D),{icon:m.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ce({spinning:m.isExecuting})},null,8,["icon","class"]),ie(" "+u(m.isExecuting?d(e)("sidebar.executing"):d(e)("sidebar.executePlan")),1)],8,eu),v.value?(h(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:L,disabled:!d(a).currentPlanTemplateId.value},[A(d(D),{icon:"carbon:application",width:"16"}),ie(" "+u(V.value),1)],8,tu)):B("",!0),d(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),g("div",su,[n("div",ou,[n("h4",nu,u(d(e)("sidebar.internalCall")),1),n("p",au,u(d(e)("sidebar.internalCallDescription")),1)]),n("div",lu,[n("div",ru,[n("div",iu,u(d(e)("sidebar.internalMethodCall")),1),n("div",cu,u(d(e)("sidebar.toolName"))+": "+u(d(a).selectedTemplate.value?.title||d(a).currentPlanTemplateId.value||""),1),d(a).selectedTemplate.value?.serviceGroup?(h(),g("div",uu,u(d(e)("sidebar.serviceGroup"))+": "+u(d(a).selectedTemplate.value.serviceGroup),1)):B("",!0),n("div",du,u(d(e)("sidebar.internalCallUsage")),1),n("div",pu,[n("strong",null,u(d(e)("sidebar.usage"))+":",1),n("pre",mu,u(d(e)("sidebar.internalCallExample")),1)])])])])):B("",!0),d(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),g("div",hu,[n("div",fu,[n("h4",vu,u(d(e)("sidebar.httpCallExample")),1),n("p",gu,u(d(e)("sidebar.httpCallDescription")),1)]),n("div",yu,[n("div",bu,[n("div",_u,[(h(!0),g(ue,null,me(G.value,Y=>(h(),g("button",{key:Y.id,class:ce(["tab-button",{active:P.value===Y.id}]),onClick:$e=>P.value=Y.id},u(Y.label),11,wu))),128))]),n("div",$u,[(h(!0),g(ue,null,me(G.value,Y=>ve((h(),g("div",{key:Y.id,class:"tab-panel"},[n("div",Su,[n("div",Tu,u(Y.method),1),n("div",ku,u(Y.endpoint),1),n("div",Eu,u(Y.description),1),Y.example?(h(),g("div",Pu,[n("strong",null,u(d(e)("sidebar.example"))+":",1),n("pre",Cu,u(Y.example),1)])):B("",!0)])])),[[so,P.value===Y.id]])),128))])])])])):B("",!0),d(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),g("div",Iu,[n("div",Ru,[n("h4",xu,u(d(e)("sidebar.mcpCall")),1),n("p",Au,u(d(e)("sidebar.mcpCallDescription")),1)]),n("div",Fu,[n("div",Du,[n("div",Mu,u(d(e)("sidebar.mcpServiceCall")),1),n("div",Nu,u(d(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),n("div",Uu,u(d(e)("sidebar.mcpCallUsage")),1),n("div",Lu,[n("strong",null,u(d(e)("sidebar.usage"))+":",1),n("pre",Ou,u(d(e)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])]),A(jc,{modelValue:T.value,"onUpdate:modelValue":K[0]||(K[0]=Y=>T.value=Y),onSave:Ie,onContinue:Ee},null,8,["modelValue"]),A(Uc,{modelValue:i.value,"onUpdate:modelValue":K[1]||(K[1]=Y=>i.value=Y)},null,8,["modelValue"])],64))}}),Bu=we(qu,[["__scopeId","data-v-4defd748"]]);function Ts(o,t){return function(){return o.apply(t,arguments)}}const{toString:Hu}=Object.prototype,{getPrototypeOf:Ot}=Object,{iterator:yt,toStringTag:ks}=Symbol,bt=(o=>t=>{const e=Hu.call(t);return o[e]||(o[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=o=>(o=o.toLowerCase(),t=>bt(t)===o),_t=o=>t=>typeof t===o,{isArray:Ze}=Array,Je=_t("undefined");function lt(o){return o!==null&&!Je(o)&&o.constructor!==null&&!Je(o.constructor)&&Ae(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const Es=Oe("ArrayBuffer");function ju(o){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(o):t=o&&o.buffer&&Es(o.buffer),t}const Vu=_t("string"),Ae=_t("function"),Ps=_t("number"),rt=o=>o!==null&&typeof o=="object",zu=o=>o===!0||o===!1,mt=o=>{if(bt(o)!=="object")return!1;const t=Ot(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ks in o)&&!(yt in o)},Wu=o=>{if(!rt(o)||lt(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},Gu=Oe("Date"),Ku=Oe("File"),Ju=Oe("Blob"),Xu=Oe("FileList"),Qu=o=>rt(o)&&Ae(o.pipe),Yu=o=>{let t;return o&&(typeof FormData=="function"&&o instanceof FormData||Ae(o.append)&&((t=bt(o))==="formdata"||t==="object"&&Ae(o.toString)&&o.toString()==="[object FormData]"))},Zu=Oe("URLSearchParams"),[ed,td,sd,od]=["ReadableStream","Request","Response","Headers"].map(Oe),nd=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(o,t,{allOwnKeys:e=!1}={}){if(o===null||typeof o>"u")return;let s,a;if(typeof o!="object"&&(o=[o]),Ze(o))for(s=0,a=o.length;s<a;s++)t.call(null,o[s],s,o);else{if(lt(o))return;const l=e?Object.getOwnPropertyNames(o):Object.keys(o),r=l.length;let m;for(s=0;s<r;s++)m=l[s],t.call(null,o[m],m,o)}}function Cs(o,t){if(lt(o))return null;t=t.toLowerCase();const e=Object.keys(o);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const je=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Is=o=>!Je(o)&&o!==je;function Ft(){const{caseless:o,skipUndefined:t}=Is(this)&&this||{},e={},s=(a,l)=>{const r=o&&Cs(e,l)||l;mt(e[r])&&mt(a)?e[r]=Ft(e[r],a):mt(a)?e[r]=Ft({},a):Ze(a)?e[r]=a.slice():(!t||!Je(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const ad=(o,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&Ae(a)?o[l]=Ts(a,e):o[l]=a},{allOwnKeys:s}),o),ld=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),rd=(o,t,e,s)=>{o.prototype=Object.create(t.prototype,s),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:t.prototype}),e&&Object.assign(o.prototype,e)},id=(o,t,e,s)=>{let a,l,r;const m={};if(t=t||{},o==null)return t;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)r=a[l],(!s||s(r,o,t))&&!m[r]&&(t[r]=o[r],m[r]=!0);o=e!==!1&&Ot(o)}while(o&&(!e||e(o,t))&&o!==Object.prototype);return t},cd=(o,t,e)=>{o=String(o),(e===void 0||e>o.length)&&(e=o.length),e-=t.length;const s=o.indexOf(t,e);return s!==-1&&s===e},ud=o=>{if(!o)return null;if(Ze(o))return o;let t=o.length;if(!Ps(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=o[t];return e},dd=(o=>t=>o&&t instanceof o)(typeof Uint8Array<"u"&&Ot(Uint8Array)),pd=(o,t)=>{const s=(o&&o[yt]).call(o);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(o,l[0],l[1])}},md=(o,t)=>{let e;const s=[];for(;(e=o.exec(t))!==null;)s.push(e);return s},hd=Oe("HTMLFormElement"),fd=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),Qt=(({hasOwnProperty:o})=>(t,e)=>o.call(t,e))(Object.prototype),vd=Oe("RegExp"),Rs=(o,t)=>{const e=Object.getOwnPropertyDescriptors(o),s={};it(e,(a,l)=>{let r;(r=t(a,l,o))!==!1&&(s[l]=r||a)}),Object.defineProperties(o,s)},gd=o=>{Rs(o,(t,e)=>{if(Ae(o)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=o[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},yd=(o,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return Ze(o)?s(o):s(String(o).split(t)),e},bd=()=>{},_d=(o,t)=>o!=null&&Number.isFinite(o=+o)?o:t;function wd(o){return!!(o&&Ae(o.append)&&o[ks]==="FormData"&&o[yt])}const $d=o=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=Ze(s)?[]:{};return it(s,(r,m)=>{const _=e(r,a+1);!Je(_)&&(l[m]=_)}),t[a]=void 0,l}}return s};return e(o,0)},Sd=Oe("AsyncFunction"),Td=o=>o&&(rt(o)||Ae(o))&&Ae(o.then)&&Ae(o.catch),xs=((o,t)=>o?setImmediate:t?((e,s)=>(je.addEventListener("message",({source:a,data:l})=>{a===je&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),je.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(je.postMessage)),kd=typeof queueMicrotask<"u"?queueMicrotask.bind(je):typeof process<"u"&&process.nextTick||xs,Ed=o=>o!=null&&Ae(o[yt]),I={isArray:Ze,isArrayBuffer:Es,isBuffer:lt,isFormData:Yu,isArrayBufferView:ju,isString:Vu,isNumber:Ps,isBoolean:zu,isObject:rt,isPlainObject:mt,isEmptyObject:Wu,isReadableStream:ed,isRequest:td,isResponse:sd,isHeaders:od,isUndefined:Je,isDate:Gu,isFile:Ku,isBlob:Ju,isRegExp:vd,isFunction:Ae,isStream:Qu,isURLSearchParams:Zu,isTypedArray:dd,isFileList:Xu,forEach:it,merge:Ft,extend:ad,trim:nd,stripBOM:ld,inherits:rd,toFlatObject:id,kindOf:bt,kindOfTest:Oe,endsWith:cd,toArray:ud,forEachEntry:pd,matchAll:md,isHTMLForm:hd,hasOwnProperty:Qt,hasOwnProp:Qt,reduceDescriptors:Rs,freezeMethods:gd,toObjectSet:yd,toCamelCase:fd,noop:bd,toFiniteNumber:_d,findKey:Cs,global:je,isContextDefined:Is,isSpecCompliantForm:wd,toJSONObject:$d,isAsyncFn:Sd,isThenable:Td,setImmediate:xs,asap:kd,isIterable:Ed};function ee(o,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(ee,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const As=ee.prototype,Fs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{Fs[o]={value:o}});Object.defineProperties(ee,Fs);Object.defineProperty(As,"isAxiosError",{value:!0});ee.from=(o,t,e,s,a,l)=>{const r=Object.create(As);I.toFlatObject(o,r,function(c){return c!==Error.prototype},i=>i!=="isAxiosError");const m=o&&o.message?o.message:"Error",_=t==null&&o?o.code:t;return ee.call(r,m,_,e,s,a),o&&r.cause==null&&Object.defineProperty(r,"cause",{value:o,configurable:!0}),r.name=o&&o.name||"Error",l&&Object.assign(r,l),r};const Pd=null;function Dt(o){return I.isPlainObject(o)||I.isArray(o)}function Ds(o){return I.endsWith(o,"[]")?o.slice(0,-2):o}function Yt(o,t,e){return o?o.concat(t).map(function(a,l){return a=Ds(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function Cd(o){return I.isArray(o)&&!o.some(Dt)}const Id=I.toFlatObject(I,{},null,function(t){return/^is[A-Z]/.test(t)});function wt(o,t,e){if(!I.isObject(o))throw new TypeError("target must be an object");t=t||new FormData,e=I.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,y){return!I.isUndefined(y[S])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,r=e.indexes,_=(e.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(t);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function i(p){if(p===null)return"";if(I.isDate(p))return p.toISOString();if(I.isBoolean(p))return p.toString();if(!_&&I.isBlob(p))throw new ee("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(p)||I.isTypedArray(p)?_&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,S,y){let v=p;if(p&&!y&&typeof p=="object"){if(I.endsWith(S,"{}"))S=s?S:S.slice(0,-2),p=JSON.stringify(p);else if(I.isArray(p)&&Cd(p)||(I.isFileList(p)||I.endsWith(S,"[]"))&&(v=I.toArray(p)))return S=Ds(S),v.forEach(function(C,N){!(I.isUndefined(C)||C===null)&&t.append(r===!0?Yt([S],N,l):r===null?S:S+"[]",i(C))}),!1}return Dt(p)?!0:(t.append(Yt(y,S,l),i(p)),!1)}const f=[],E=Object.assign(Id,{defaultVisitor:c,convertValue:i,isVisitable:Dt});function P(p,S){if(!I.isUndefined(p)){if(f.indexOf(p)!==-1)throw Error("Circular reference detected in "+S.join("."));f.push(p),I.forEach(p,function(v,R){(!(I.isUndefined(v)||v===null)&&a.call(t,v,I.isString(R)?R.trim():R,S,E))===!0&&P(v,S?S.concat(R):[R])}),f.pop()}}if(!I.isObject(o))throw new TypeError("data must be an object");return P(o),t}function Zt(o){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function qt(o,t){this._pairs=[],o&&wt(o,this,t)}const Ms=qt.prototype;Ms.append=function(t,e){this._pairs.push([t,e])};Ms.toString=function(t){const e=t?function(s){return t.call(this,s,Zt)}:Zt;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function Rd(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ns(o,t,e){if(!t)return o;const s=e&&e.encode||Rd;I.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=I.isURLSearchParams(t)?t.toString():new qt(t,e).toString(s),l){const r=o.indexOf("#");r!==-1&&(o=o.slice(0,r)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class es{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){I.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Us={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xd=typeof URLSearchParams<"u"?URLSearchParams:qt,Ad=typeof FormData<"u"?FormData:null,Fd=typeof Blob<"u"?Blob:null,Dd={isBrowser:!0,classes:{URLSearchParams:xd,FormData:Ad,Blob:Fd},protocols:["http","https","file","blob","url","data"]},Bt=typeof window<"u"&&typeof document<"u",Mt=typeof navigator=="object"&&navigator||void 0,Md=Bt&&(!Mt||["ReactNative","NativeScript","NS"].indexOf(Mt.product)<0),Nd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ud=Bt&&window.location.href||"http://localhost",Ld=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bt,hasStandardBrowserEnv:Md,hasStandardBrowserWebWorkerEnv:Nd,navigator:Mt,origin:Ud},Symbol.toStringTag,{value:"Module"})),Pe={...Ld,...Dd};function Od(o,t){return wt(o,new Pe.classes.URLSearchParams,{visitor:function(e,s,a,l){return Pe.isNode&&I.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function qd(o){return I.matchAll(/\w+|\[(\w*)]/g,o).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Bd(o){const t={},e=Object.keys(o);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=o[l];return t}function Ls(o){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const m=Number.isFinite(+r),_=l>=e.length;return r=!r&&I.isArray(a)?a.length:r,_?(I.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!m):((!a[r]||!I.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&I.isArray(a[r])&&(a[r]=Bd(a[r])),!m)}if(I.isFormData(o)&&I.isFunction(o.entries)){const e={};return I.forEachEntry(o,(s,a)=>{t(qd(s),a,e,0)}),e}return null}function Hd(o,t,e){if(I.isString(o))try{return(t||JSON.parse)(o),I.trim(o)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(o)}const ct={transitional:Us,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=I.isObject(t);if(l&&I.isHTMLForm(t)&&(t=new FormData(t)),I.isFormData(t))return a?JSON.stringify(Ls(t)):t;if(I.isArrayBuffer(t)||I.isBuffer(t)||I.isStream(t)||I.isFile(t)||I.isBlob(t)||I.isReadableStream(t))return t;if(I.isArrayBufferView(t))return t.buffer;if(I.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Od(t,this.formSerializer).toString();if((m=I.isFileList(t))||s.indexOf("multipart/form-data")>-1){const _=this.env&&this.env.FormData;return wt(m?{"files[]":t}:t,_&&new _,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Hd(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(t)||I.isReadableStream(t))return t;if(t&&I.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(m){if(r)throw m.name==="SyntaxError"?ee.from(m,ee.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Pe.classes.FormData,Blob:Pe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],o=>{ct.headers[o]={}});const jd=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Vd=o=>{const t={};let e,s,a;return o&&o.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&jd[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ts=Symbol("internals");function ot(o){return o&&String(o).trim().toLowerCase()}function ht(o){return o===!1||o==null?o:I.isArray(o)?o.map(ht):String(o)}function zd(o){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(o);)t[s[1]]=s[2];return t}const Wd=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function Pt(o,t,e,s,a){if(I.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!I.isString(t)){if(I.isString(s))return t.indexOf(s)!==-1;if(I.isRegExp(s))return s.test(t)}}function Gd(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Kd(o,t){const e=I.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(o,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(m,_,i){const c=ot(_);if(!c)throw new Error("header name must be a non-empty string");const f=I.findKey(a,c);(!f||a[f]===void 0||i===!0||i===void 0&&a[f]!==!1)&&(a[f||_]=ht(m))}const r=(m,_)=>I.forEach(m,(i,c)=>l(i,c,_));if(I.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(I.isString(t)&&(t=t.trim())&&!Wd(t))r(Vd(t),e);else if(I.isObject(t)&&I.isIterable(t)){let m={},_,i;for(const c of t){if(!I.isArray(c))throw TypeError("Object iterator must return a key-value pair");m[i=c[0]]=(_=m[i])?I.isArray(_)?[..._,c[1]]:[_,c[1]]:c[1]}r(m,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=ot(t),t){const s=I.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return zd(a);if(I.isFunction(e))return e.call(this,a,s);if(I.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ot(t),t){const s=I.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Pt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=ot(r),r){const m=I.findKey(s,r);m&&(!e||Pt(s,s[m],m,e))&&(delete s[m],a=!0)}}return I.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Pt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return I.forEach(this,(a,l)=>{const r=I.findKey(s,l);if(r){e[r]=ht(a),delete e[l];return}const m=t?Gd(l):String(l).trim();m!==l&&delete e[l],e[m]=ht(a),s[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return I.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&I.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ts]=this[ts]={accessors:{}}).accessors,a=this.prototype;function l(r){const m=ot(r);s[m]||(Kd(a,r),s[m]=!0)}return I.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Fe.prototype,({value:o},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>o,set(s){this[e]=s}}});I.freezeMethods(Fe);function Ct(o,t){const e=this||ct,s=t||e,a=Fe.from(s.headers);let l=s.data;return I.forEach(o,function(m){l=m.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function Os(o){return!!(o&&o.__CANCEL__)}function et(o,t,e){ee.call(this,o??"canceled",ee.ERR_CANCELED,t,e),this.name="CanceledError"}I.inherits(et,ee,{__CANCEL__:!0});function qs(o,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?o(e):t(new ee("Request failed with status code "+e.status,[ee.ERR_BAD_REQUEST,ee.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Jd(o){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return t&&t[1]||""}function Xd(o,t){o=o||10;const e=new Array(o),s=new Array(o);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(_){const i=Date.now(),c=s[l];r||(r=i),e[a]=_,s[a]=i;let f=l,E=0;for(;f!==a;)E+=e[f++],f=f%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),i-r<t)return;const P=c&&i-c;return P?Math.round(E*1e3/P):void 0}}function Qd(o,t){let e=0,s=1e3/t,a,l;const r=(i,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),o(...i)};return[(...i)=>{const c=Date.now(),f=c-e;f>=s?r(i,c):(a=i,l||(l=setTimeout(()=>{l=null,r(a)},s-f)))},()=>a&&r(a)]}const gt=(o,t,e=3)=>{let s=0;const a=Xd(50,250);return Qd(l=>{const r=l.loaded,m=l.lengthComputable?l.total:void 0,_=r-s,i=a(_),c=r<=m;s=r;const f={loaded:r,total:m,progress:m?r/m:void 0,bytes:_,rate:i||void 0,estimated:i&&m&&c?(m-r)/i:void 0,event:l,lengthComputable:m!=null,[t?"download":"upload"]:!0};o(f)},e)},ss=(o,t)=>{const e=o!=null;return[s=>t[0]({lengthComputable:e,total:o,loaded:s}),t[1]]},os=o=>(...t)=>I.asap(()=>o(...t)),Yd=Pe.hasStandardBrowserEnv?((o,t)=>e=>(e=new URL(e,Pe.origin),o.protocol===e.protocol&&o.host===e.host&&(t||o.port===e.port)))(new URL(Pe.origin),Pe.navigator&&/(msie|trident)/i.test(Pe.navigator.userAgent)):()=>!0,Zd=Pe.hasStandardBrowserEnv?{write(o,t,e,s,a,l,r){if(typeof document>"u")return;const m=[`${o}=${encodeURIComponent(t)}`];I.isNumber(e)&&m.push(`expires=${new Date(e).toUTCString()}`),I.isString(s)&&m.push(`path=${s}`),I.isString(a)&&m.push(`domain=${a}`),l===!0&&m.push("secure"),I.isString(r)&&m.push(`SameSite=${r}`),document.cookie=m.join("; ")},read(o){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ep(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function tp(o,t){return t?o.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):o}function Bs(o,t,e){let s=!ep(t);return o&&(s||e==!1)?tp(o,t):t}const ns=o=>o instanceof Fe?{...o}:o;function ze(o,t){t=t||{};const e={};function s(i,c,f,E){return I.isPlainObject(i)&&I.isPlainObject(c)?I.merge.call({caseless:E},i,c):I.isPlainObject(c)?I.merge({},c):I.isArray(c)?c.slice():c}function a(i,c,f,E){if(I.isUndefined(c)){if(!I.isUndefined(i))return s(void 0,i,f,E)}else return s(i,c,f,E)}function l(i,c){if(!I.isUndefined(c))return s(void 0,c)}function r(i,c){if(I.isUndefined(c)){if(!I.isUndefined(i))return s(void 0,i)}else return s(void 0,c)}function m(i,c,f){if(f in t)return s(i,c);if(f in o)return s(void 0,i)}const _={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:m,headers:(i,c,f)=>a(ns(i),ns(c),f,!0)};return I.forEach(Object.keys({...o,...t}),function(c){const f=_[c]||a,E=f(o[c],t[c],c);I.isUndefined(E)&&f!==m||(e[c]=E)}),e}const Hs=o=>{const t=ze({},o);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:m}=t;if(t.headers=r=Fe.from(r),t.url=Ns(Bs(t.baseURL,t.url,t.allowAbsoluteUrls),o.params,o.paramsSerializer),m&&r.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),I.isFormData(e)){if(Pe.hasStandardBrowserEnv||Pe.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(I.isFunction(e.getHeaders)){const _=e.getHeaders(),i=["content-type","content-length"];Object.entries(_).forEach(([c,f])=>{i.includes(c.toLowerCase())&&r.set(c,f)})}}if(Pe.hasStandardBrowserEnv&&(s&&I.isFunction(s)&&(s=s(t)),s||s!==!1&&Yd(t.url))){const _=a&&l&&Zd.read(l);_&&r.set(a,_)}return t},sp=typeof XMLHttpRequest<"u",op=sp&&function(o){return new Promise(function(e,s){const a=Hs(o);let l=a.data;const r=Fe.from(a.headers).normalize();let{responseType:m,onUploadProgress:_,onDownloadProgress:i}=a,c,f,E,P,p;function S(){P&&P(),p&&p(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function v(){if(!y)return;const C=Fe.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),T={data:!m||m==="text"||m==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:C,config:o,request:y};qs(function(G){e(G),S()},function(G){s(G),S()},T),y=null}"onloadend"in y?y.onloadend=v:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(v)},y.onabort=function(){y&&(s(new ee("Request aborted",ee.ECONNABORTED,o,y)),y=null)},y.onerror=function(N){const T=N&&N.message?N.message:"Network Error",U=new ee(T,ee.ERR_NETWORK,o,y);U.event=N||null,s(U),y=null},y.ontimeout=function(){let N=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const T=a.transitional||Us;a.timeoutErrorMessage&&(N=a.timeoutErrorMessage),s(new ee(N,T.clarifyTimeoutError?ee.ETIMEDOUT:ee.ECONNABORTED,o,y)),y=null},l===void 0&&r.setContentType(null),"setRequestHeader"in y&&I.forEach(r.toJSON(),function(N,T){y.setRequestHeader(T,N)}),I.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),m&&m!=="json"&&(y.responseType=a.responseType),i&&([E,p]=gt(i,!0),y.addEventListener("progress",E)),_&&y.upload&&([f,P]=gt(_),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",P)),(a.cancelToken||a.signal)&&(c=C=>{y&&(s(!C||C.type?new et(null,o,y):C),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const R=Jd(a.url);if(R&&Pe.protocols.indexOf(R)===-1){s(new ee("Unsupported protocol "+R+":",ee.ERR_BAD_REQUEST,o));return}y.send(l||null)})},np=(o,t)=>{const{length:e}=o=o?o.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(i){if(!a){a=!0,m();const c=i instanceof Error?i:this.reason;s.abort(c instanceof ee?c:new et(c instanceof Error?c.message:c))}};let r=t&&setTimeout(()=>{r=null,l(new ee(`timeout ${t} of ms exceeded`,ee.ETIMEDOUT))},t);const m=()=>{o&&(r&&clearTimeout(r),r=null,o.forEach(i=>{i.unsubscribe?i.unsubscribe(l):i.removeEventListener("abort",l)}),o=null)};o.forEach(i=>i.addEventListener("abort",l));const{signal:_}=s;return _.unsubscribe=()=>I.asap(m),_}},ap=function*(o,t){let e=o.byteLength;if(e<t){yield o;return}let s=0,a;for(;s<e;)a=s+t,yield o.slice(s,a),s=a},lp=async function*(o,t){for await(const e of rp(o))yield*ap(e,t)},rp=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const t=o.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},as=(o,t,e,s)=>{const a=lp(o,t);let l=0,r,m=_=>{r||(r=!0,s&&s(_))};return new ReadableStream({async pull(_){try{const{done:i,value:c}=await a.next();if(i){m(),_.close();return}let f=c.byteLength;if(e){let E=l+=f;e(E)}_.enqueue(new Uint8Array(c))}catch(i){throw m(i),i}},cancel(_){return m(_),a.return()}},{highWaterMark:2})},ls=64*1024,{isFunction:dt}=I,ip=(({Request:o,Response:t})=>({Request:o,Response:t}))(I.global),{ReadableStream:rs,TextEncoder:is}=I.global,cs=(o,...t)=>{try{return!!o(...t)}catch{return!1}},cp=o=>{o=I.merge.call({skipUndefined:!0},ip,o);const{fetch:t,Request:e,Response:s}=o,a=t?dt(t):typeof fetch=="function",l=dt(e),r=dt(s);if(!a)return!1;const m=a&&dt(rs),_=a&&(typeof is=="function"?(p=>S=>p.encode(S))(new is):async p=>new Uint8Array(await new e(p).arrayBuffer())),i=l&&m&&cs(()=>{let p=!1;const S=new e(Pe.origin,{body:new rs,method:"POST",get duplex(){return p=!0,"half"}}).headers.has("Content-Type");return p&&!S}),c=r&&m&&cs(()=>I.isReadableStream(new s("").body)),f={stream:c&&(p=>p.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(p=>{!f[p]&&(f[p]=(S,y)=>{let v=S&&S[p];if(v)return v.call(S);throw new ee(`Response type '${p}' is not supported`,ee.ERR_NOT_SUPPORT,y)})});const E=async p=>{if(p==null)return 0;if(I.isBlob(p))return p.size;if(I.isSpecCompliantForm(p))return(await new e(Pe.origin,{method:"POST",body:p}).arrayBuffer()).byteLength;if(I.isArrayBufferView(p)||I.isArrayBuffer(p))return p.byteLength;if(I.isURLSearchParams(p)&&(p=p+""),I.isString(p))return(await _(p)).byteLength},P=async(p,S)=>{const y=I.toFiniteNumber(p.getContentLength());return y??E(S)};return async p=>{let{url:S,method:y,data:v,signal:R,cancelToken:C,timeout:N,onDownloadProgress:T,onUploadProgress:U,responseType:G,headers:x,withCredentials:V="same-origin",fetchOptions:w}=Hs(p),b=t||fetch;G=G?(G+"").toLowerCase():"text";let $=np([R,C&&C.toAbortSignal()],N),O=null;const W=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let ae;try{if(U&&i&&y!=="get"&&y!=="head"&&(ae=await P(x,v))!==0){let Ee=new e(S,{method:"POST",body:v,duplex:"half"}),L;if(I.isFormData(v)&&(L=Ee.headers.get("content-type"))&&x.setContentType(L),Ee.body){const[q,H]=ss(ae,gt(os(U)));v=as(Ee.body,ls,q,H)}}I.isString(V)||(V=V?"include":"omit");const fe=l&&"credentials"in e.prototype,Ce={...w,signal:$,method:y.toUpperCase(),headers:x.normalize().toJSON(),body:v,duplex:"half",credentials:fe?V:void 0};O=l&&new e(S,Ce);let ke=await(l?b(O,w):b(S,Ce));const Ne=c&&(G==="stream"||G==="response");if(c&&(T||Ne&&W)){const Ee={};["status","statusText","headers"].forEach(X=>{Ee[X]=ke[X]});const L=I.toFiniteNumber(ke.headers.get("content-length")),[q,H]=T&&ss(L,gt(os(T),!0))||[];ke=new s(as(ke.body,ls,q,()=>{H&&H(),W&&W()}),Ee)}G=G||"text";let Ie=await f[I.findKey(f,G)||"text"](ke,p);return!Ne&&W&&W(),await new Promise((Ee,L)=>{qs(Ee,L,{data:Ie,headers:Fe.from(ke.headers),status:ke.status,statusText:ke.statusText,config:p,request:O})})}catch(fe){throw W&&W(),fe&&fe.name==="TypeError"&&/Load failed|fetch/i.test(fe.message)?Object.assign(new ee("Network Error",ee.ERR_NETWORK,p,O),{cause:fe.cause||fe}):ee.from(fe,fe&&fe.code,p,O)}}},up=new Map,js=o=>{let t=o&&o.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,m=r,_,i,c=up;for(;m--;)_=l[m],i=c.get(_),i===void 0&&c.set(_,i=m?new Map:cp(t)),c=i;return i};js();const Ht={http:Pd,xhr:op,fetch:{get:js}};I.forEach(Ht,(o,t)=>{if(o){try{Object.defineProperty(o,"name",{value:t})}catch{}Object.defineProperty(o,"adapterName",{value:t})}});const us=o=>`- ${o}`,dp=o=>I.isFunction(o)||o===null||o===!1;function pp(o,t){o=I.isArray(o)?o:[o];const{length:e}=o;let s,a;const l={};for(let r=0;r<e;r++){s=o[r];let m;if(a=s,!dp(s)&&(a=Ht[(m=String(s)).toLowerCase()],a===void 0))throw new ee(`Unknown adapter '${m}'`);if(a&&(I.isFunction(a)||(a=a.get(t))))break;l[m||"#"+r]=a}if(!a){const r=Object.entries(l).map(([_,i])=>`adapter ${_} `+(i===!1?"is not supported by the environment":"is not available in the build"));let m=e?r.length>1?`since :
`+r.map(us).join(`
`):" "+us(r[0]):"as no adapter specified";throw new ee("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return a}const Vs={getAdapter:pp,adapters:Ht};function It(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new et(null,o)}function ds(o){return It(o),o.headers=Fe.from(o.headers),o.data=Ct.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Vs.getAdapter(o.adapter||ct.adapter,o)(o).then(function(s){return It(o),s.data=Ct.call(o,o.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return Os(s)||(It(o),s&&s.response&&(s.response.data=Ct.call(o,o.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const zs="1.13.2",$t={};["object","boolean","number","function","string","symbol"].forEach((o,t)=>{$t[o]=function(s){return typeof s===o||"a"+(t<1?"n ":" ")+o}});const ps={};$t.transitional=function(t,e,s){function a(l,r){return"[Axios v"+zs+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,m)=>{if(t===!1)throw new ee(a(r," has been removed"+(e?" in "+e:"")),ee.ERR_DEPRECATED);return e&&!ps[r]&&(ps[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,m):!0}};$t.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function mp(o,t,e){if(typeof o!="object")throw new ee("options must be an object",ee.ERR_BAD_OPTION_VALUE);const s=Object.keys(o);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const m=o[l],_=m===void 0||r(m,l,o);if(_!==!0)throw new ee("option "+l+" must be "+_,ee.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ee("Unknown option "+l,ee.ERR_BAD_OPTION)}}const ft={assertOptions:mp,validators:$t},qe=ft.validators;let Ve=class{constructor(t){this.defaults=t||{},this.interceptors={request:new es,response:new es}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ze(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&ft.assertOptions(s,{silentJSONParsing:qe.transitional(qe.boolean),forcedJSONParsing:qe.transitional(qe.boolean),clarifyTimeoutError:qe.transitional(qe.boolean)},!1),a!=null&&(I.isFunction(a)?e.paramsSerializer={serialize:a}:ft.assertOptions(a,{encode:qe.function,serialize:qe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),ft.assertOptions(e,{baseUrl:qe.spelling("baseURL"),withXsrfToken:qe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&I.merge(l.common,l[e.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],p=>{delete l[p]}),e.headers=Fe.concat(r,l);const m=[];let _=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(e)===!1||(_=_&&S.synchronous,m.unshift(S.fulfilled,S.rejected))});const i=[];this.interceptors.response.forEach(function(S){i.push(S.fulfilled,S.rejected)});let c,f=0,E;if(!_){const p=[ds.bind(this),void 0];for(p.unshift(...m),p.push(...i),E=p.length,c=Promise.resolve(e);f<E;)c=c.then(p[f++],p[f++]);return c}E=m.length;let P=e;for(;f<E;){const p=m[f++],S=m[f++];try{P=p(P)}catch(y){S.call(this,y);break}}try{c=ds.call(this,P)}catch(p){return Promise.reject(p)}for(f=0,E=i.length;f<E;)c=c.then(i[f++],i[f++]);return c}getUri(t){t=ze(this.defaults,t);const e=Bs(t.baseURL,t.url,t.allowAbsoluteUrls);return Ns(e,t.params,t.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(t){Ve.prototype[t]=function(e,s){return this.request(ze(s||{},{method:t,url:e,data:(s||{}).data}))}});I.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,m){return this.request(ze(m||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}Ve.prototype[t]=e(),Ve.prototype[t+"Form"]=e(!0)});let hp=class Ws{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(m=>{s.subscribe(m),l=m}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,m){s.reason||(s.reason=new et(l,r,m),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ws(function(a){t=a}),cancel:t}}};function fp(o){return function(e){return o.apply(null,e)}}function vp(o){return I.isObject(o)&&o.isAxiosError===!0}const Nt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Nt).forEach(([o,t])=>{Nt[t]=o});function Gs(o){const t=new Ve(o),e=Ts(Ve.prototype.request,t);return I.extend(e,Ve.prototype,t,{allOwnKeys:!0}),I.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Gs(ze(o,a))},e}const be=Gs(ct);be.Axios=Ve;be.CanceledError=et;be.CancelToken=hp;be.isCancel=Os;be.VERSION=zs;be.toFormData=wt;be.AxiosError=ee;be.Cancel=be.CanceledError;be.all=function(t){return Promise.all(t)};be.spread=fp;be.isAxiosError=vp;be.mergeConfig=ze;be.AxiosHeaders=Fe;be.formToJSON=o=>Ls(I.isHTMLForm(o)?new FormData(o):o);be.getAdapter=Vs.getAdapter;be.HttpStatusCode=Nt;be.default=be;const{Axios:$f,AxiosError:Sf,CanceledError:Tf,isCancel:kf,CancelToken:Ef,VERSION:Pf,all:Cf,Cancel:If,isAxiosError:Rf,spread:xf,toFormData:Af,AxiosHeaders:Ff,HttpStatusCode:Df,formToJSON:Mf,getAdapter:Nf,mergeConfig:Uf}=be;class gp{static async getAvailableModels(){try{return(await be({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const yp={class:"assigned-tools"},bp={class:"section-header"},_p=["title"],wp={class:"tool-info"},$p={class:"tool-name"},Sp=["title"],Tp={key:0,class:"no-tools"},kp=_e({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=Z(()=>a.availableTools.value);De(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=Z(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(i=>l.value.some(c=>c.key===i)):[]);de(r,i=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;i.length!==c&&s("tools-filtered",i)},{immediate:!0});const m=i=>{const c=l.value.find(E=>E.key===i);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:i},_=i=>{const c=l.value.find(f=>f.key===i);return c?c.description:""};return(i,c)=>(h(),g("div",yp,[n("div",bp,[n("span",null,u(i.title)+" ("+u(r.value.length)+")",1),i.showAddButton?(h(),g("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=f=>i.$emit("add-tools"))},[A(d(D),{icon:"carbon:add"}),ie(" "+u(i.addButtonText),1)])):B("",!0)]),n("div",{class:ce(["tools-grid",{"grid-layout":i.useGridLayout,"has-more-items":i.useGridLayout&&r.value.length>2}])},[(h(!0),g(ue,null,me(r.value,f=>(h(),g("div",{key:f,class:"tool-item assigned",title:_(f)},[n("div",wp,[n("span",$p,u(m(f)),1),n("span",{class:"tool-desc",title:_(f)},u(_(f)),9,Sp)])],8,_p))),128)),r.value.length===0?(h(),g("div",Tp,[A(d(D),{icon:"carbon:tool-box"}),n("span",null,u(i.emptyText),1)])):B("",!0)],2)]))}}),Ep=we(kp,[["__scopeId","data-v-62354a05"]]),Pp={class:"tool-selection-content"},Cp={class:"tool-controls"},Ip={class:"search-container"},Rp=["placeholder"],xp={class:"sort-container"},Ap={value:"group"},Fp={value:"name"},Dp={value:"enabled"},Mp={class:"tool-summary"},Np={class:"summary-text"},Up={key:0,class:"tool-groups"},Lp=["onClick"],Op={class:"group-title-area"},qp={class:"group-name"},Bp={class:"group-count"},Hp={class:"group-enable-all"},jp=["checked","onChange","data-group"],Vp={class:"enable-label"},zp={class:"tool-info"},Wp={class:"tool-selection-name"},Gp={key:0,class:"tool-selection-desc"},Kp={class:"tool-actions"},Jp=["checked","onChange"],Xp={key:1,class:"empty-state"},Qp=_e({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=Z(()=>a.availableTools.value);De(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),de(()=>e.modelValue,w=>{w&&!a.isLoading.value&&a.loadAvailableTools()});const r=Z({get:()=>e.modelValue,set:w=>s("update:modelValue",w)}),m=F(""),_=F("group"),i=F(new Set),c=F([]),f=F(null),E=(w,b)=>{const $=document.querySelector(`input[data-group="${w}"]`);$&&($.indeterminate=T(b))};de(()=>e.selectedToolIds,w=>{c.value=[...w]},{immediate:!0});const P=Z(()=>{let w=l.value.filter(b=>b.key);if(w=w.filter(b=>b.selectable===!0),m.value){const b=m.value.toLowerCase();w=w.filter($=>$.name.toLowerCase().includes(b)||$.description.toLowerCase().includes(b)||$.serviceGroup.toLowerCase().includes(b))}switch(_.value){case"name":w=[...w].sort((b,$)=>b.name.localeCompare($.name));break;case"enabled":w=[...w].sort((b,$)=>{const O=c.value.includes(b.key),W=c.value.includes($.key);return O&&!W?-1:!O&&W?1:b.name.localeCompare($.name)});break;case"group":default:w=[...w].sort((b,$)=>{const O=b.serviceGroup||"Ungrouped",W=$.serviceGroup||"Ungrouped";return O!==W?O.localeCompare(W):b.name.localeCompare($.name)});break}return w}),p=Z(()=>{const w=new Map;return l.value.filter($=>$.key&&$.selectable===!0).forEach($=>{const O=$.serviceGroup||"Ungrouped";w.has(O)||w.set(O,[]),w.get(O).push($)}),w}),S=Z(()=>{const w=new Map;return P.value.forEach(b=>{const $=b.serviceGroup||"Ungrouped";w.has($)||w.set($,[]),w.get($).push(b)}),new Map([...w.entries()].sort())}),y=Z(()=>P.value.length);de([c,S],()=>{xe(()=>{for(const[w,b]of S.value)E(w,b)})},{flush:"post",deep:!1});const v=w=>c.value.includes(w),R=(w,b)=>{b.stopPropagation();const O=b.target.checked;if(!w){console.error("toolKey is undefined, cannot proceed");return}O?c.value.includes(w)||(c.value=[...c.value,w]):c.value=c.value.filter(W=>W!==w)},C=w=>w.filter(b=>c.value.includes(b.key)),N=w=>w.length>0&&w.every(b=>c.value.includes(b.key)),T=w=>{const b=C(w).length;return b>0&&b<w.length},U=(w,b)=>{b.stopPropagation();const O=b.target.checked,W=w.map(ae=>ae.key);if(O){const ae=[...c.value];W.forEach(fe=>{ae.includes(fe)||ae.push(fe)}),c.value=ae}else c.value=c.value.filter(ae=>!W.includes(ae))},G=w=>{i.value.has(w)?i.value.delete(w):i.value.add(w)},x=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},V=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return de(m,w=>{const b=w.trim().toLowerCase();if(b){f.value===null&&(f.value=new Set(i.value));for(const[$,O]of p.value)O.some(ae=>ae.name.toLowerCase().includes(b)||ae.description&&ae.description.toLowerCase().includes(b)||ae.serviceGroup&&ae.serviceGroup.toLowerCase().includes(b))&&i.value.delete($)}else f.value!==null&&(i.value=new Set(f.value),f.value=null)}),de(r,w=>{if(w){i.value.clear(),f.value=null;const b=Array.from(S.value.keys());b.length>1&&b.slice(1).forEach($=>{i.value.add($)})}}),(w,b)=>(h(),ye(vs,{modelValue:r.value,"onUpdate:modelValue":[b[4]||(b[4]=$=>r.value=$),V],title:w.$t("toolSelection.title"),onConfirm:x},{default:Ke(()=>[n("div",Pp,[n("div",Cp,[n("div",Ip,[ve(n("input",{"onUpdate:modelValue":b[0]||(b[0]=$=>m.value=$),type:"text",class:"search-input",placeholder:w.$t("toolSelection.searchPlaceholder")},null,8,Rp),[[Se,m.value]])]),n("div",xp,[ve(n("select",{"onUpdate:modelValue":b[1]||(b[1]=$=>_.value=$),class:"sort-select"},[n("option",Ap,u(w.$t("toolSelection.sortByGroup")),1),n("option",Fp,u(w.$t("toolSelection.sortByName")),1),n("option",Dp,u(w.$t("toolSelection.sortByStatus")),1)],512),[[Ut,_.value]])])]),n("div",Mp,[n("span",Np,u(w.$t("toolSelection.summary",{groups:S.value.size,tools:y.value,selected:c.value.length})),1)]),S.value.size>0?(h(),g("div",Up,[(h(!0),g(ue,null,me(S.value,([$,O])=>(h(),g("div",{key:$,class:"tool-group"},[n("div",{class:ce(["tool-group-header",{collapsed:i.value.has($)}]),onClick:W=>G($)},[n("div",Op,[A(d(D),{icon:i.value.has($)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(d(D),{icon:"carbon:folder",class:"group-icon"}),n("span",qp,u($),1),n("span",Bp," ("+u(C(O).length)+"/"+u(O.length)+") ",1)]),n("div",{class:"group-actions",onClick:b[2]||(b[2]=ge(()=>{},["stop"]))},[n("label",Hp,[n("input",{type:"checkbox",class:"group-enable-checkbox",checked:N(O),onChange:W=>U(O,W),"data-group":$},null,40,jp),n("span",Vp,u(w.$t("toolSelection.enableAll")),1)])])],10,Lp),n("div",{class:ce(["tool-group-content",{collapsed:i.value.has($)}])},[(h(!0),g(ue,null,me(O,W=>(h(),g("div",{key:W.key,class:"tool-selection-item"},[n("div",zp,[n("div",Wp,u(W.name),1),W.description?(h(),g("div",Gp,u(W.description),1)):B("",!0)]),n("div",Kp,[n("label",{class:"tool-enable-switch",onClick:b[3]||(b[3]=ge(()=>{},["stop"]))},[n("input",{type:"checkbox",class:"tool-enable-checkbox",checked:v(W.key),onChange:ae=>R(W.key,ae)},null,40,Jp),b[5]||(b[5]=n("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),g("div",Xp,[A(d(D),{icon:"carbon:tools",class:"empty-icon"}),n("p",null,u(w.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Yp=we(Qp,[["__scopeId","data-v-627b463f"]]),Zp={class:"config-section"},em={class:"section-header"},tm={class:"visual-editor"},sm={class:"plan-basic-info"},om={class:"form-row"},nm={class:"form-label"},am=["placeholder"],lm={key:0,class:"field-error-message"},rm={class:"form-row"},im={class:"form-label"},cm={class:"service-group-autocomplete"},um=["placeholder"],dm={key:0,class:"service-group-dropdown"},pm=["onMousedown"],mm={class:"field-description"},hm={class:"steps-section"},fm={class:"steps-container"},vm={class:"step-content"},gm={class:"form-row"},ym={class:"form-label"},bm=["value","onInput","placeholder"],_m={class:"form-row"},wm={class:"form-label"},$m=["value","onInput","placeholder"],Sm={key:0,class:"preview-section"},Tm={class:"preview-label"},km={class:"preview-content"},Em={class:"preview-text"},Pm={class:"preview-table-header"},Cm={class:"form-row"},Im={class:"form-label"},Rm={class:"model-selector-wrapper"},xm={class:"model-input-wrapper"},Am=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Fm={key:0,class:"dropdown-item disabled"},Dm={key:1,class:"dropdown-item disabled error"},Mm={key:2,class:"dropdown-item disabled"},Nm=["onClick","onMouseenter"],Um=["onClick","onMouseenter"],Lm=["title"],Om={key:0,class:"error-message"},qm={class:"form-row"},Bm={key:0,class:"empty-steps"},Hm={class:"empty-text"},jm={key:0,class:"json-preview"},Vm={class:"preview-header"},zm={class:"form-label"},Wm={class:"json-code"},Gm={class:"editor-footer"},Km={class:"section-actions"},Jm=["disabled","title"],Xm=["disabled","title"],Qm=["disabled","title"],Ym=["disabled"],Zm={class:"modal-header"},eh={class:"modal-body"},th={class:"form-row"},sh={class:"form-label"},oh=["placeholder"],nh={class:"modal-footer"},ah=["disabled"],lh=_e({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=Me(),s=gs(),a=Xe(),l=nt({title:"",steps:[]}),r=F(!1),m=F(!1),_=F([]),i=F(!1),c=F(""),f=Z(()=>a.generateJsonString()),E=F(!1),P=()=>{E.value=!0;try{const k=a.getConfig();l.title=k.title||"",l.steps=k.steps||[],c.value=k.serviceGroup||""}finally{setTimeout(()=>{E.value=!1},0)}};de(()=>l,()=>{E.value||(a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(oe.hasTaskRequirementModified=!0,console.log("[JsonEditorV2] Task requirements modified (via watch), hasTaskRequirementModified set to true")))},{deep:!0});const p=()=>{r.value=!r.value},S=()=>{r.value=!1},y=()=>{try{a.rollbackVersion()}catch(k){console.error("Error during rollback operation:",k),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},v=()=>{try{a.restoreVersion()}catch(k){console.error("Error during restore operation:",k),s.error(e("sidebar.restoreFailed")||"Restore failed")}},R=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const k=a.validate();if(!k.isValid){s.error(`Invalid format, please correct and save.
Errors: `+k.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const se=a.generateJsonString().trim();a.updateVersionsAfterSave(se);const pe=a.planVersions.value.length;oe.hasTaskRequirementModified=!1,await oe.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:pe}))}catch(k){console.error("Failed to save plan modifications:",k);const z=k instanceof Error?k.message:e("sidebar.saveFailed");throw s.error(z),k}},C=F(""),N=()=>{const k={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(k),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},T=F([]),U=F(!1),G=F(""),x=F(new Map),V=F(new Set),w=F(new Map),b=k=>x.value.get(k)??"",$=(k,z)=>{x.value.set(k,z)},O=k=>{const z=b(k);if(!z.trim())return T.value;const J=z.toLowerCase().trim();return T.value.filter(se=>se.value.toLowerCase().includes(J)||se.label.toLowerCase().includes(J))},W=k=>{const z=l.steps[k],J=b(k);return V.value.has(k)&&J!==""?J:z.modelName??""},ae=k=>U.value||G.value||l.steps[k].modelName?"":e("sidebar.modelNameDescription")||"",fe=k=>V.value.has(k),Ce=k=>{U.value||V.value.add(k)},ke=k=>{V.value.delete(k),w.value.set(k,-1);const z=l.steps[k];$(k,z.modelName??"")},Ne=k=>{fe(k)?ke(k):Ce(k)},Ie=(k,z)=>{const J=l.steps[z];J.modelName=k,$(z,k),ke(z)},Ee=(k,z)=>{const J=k.target;$(z,J.value),Ce(z)},L=k=>w.value.get(k)??-1,q=(k,z)=>{w.value.set(k,z)},H=k=>{const z=L(k),J=O(k);z>=0&&z<J.length?Ie(J[z].value,k):z===-1?Ie("",k):J.length>0?Ie(J[0].value,k):l.steps[k].modelName||Ie("",k)},X=k=>{if(!fe(k)){Ce(k),q(k,0);return}const J=O(k).length+1,se=L(k),pe=Math.min(se+1,J-1);q(k,pe)},te=k=>{if(!fe(k)){Ce(k);const se=O(k);q(k,se.length);return}const z=L(k),J=Math.max(z-1,-1);q(k,J)},re=k=>{k.target.closest(".model-selector")||V.value.clear()};de(()=>l.steps,k=>{k.forEach((z,J)=>{x.value.has(J)||$(J,z.modelName??"")})},{deep:!0,immediate:!0});const le=F(!1),M=F(-1),K=async()=>{if(!U.value){U.value=!0,G.value="";try{const k=await gp.getAvailableModels();T.value=k.options}catch(k){console.error("Failed to load models:",k),G.value=k instanceof Error?k.message:"Failed to load models",T.value=[]}finally{U.value=!1}}},Y=k=>{M.value=k,le.value=!0},$e=k=>{M.value>=0&&M.value<l.steps.length&&(l.steps[M.value].selectedToolKeys=[...k]),le.value=!1,M.value=-1},j=(k,z)=>{k>=0&&k<l.steps.length&&(l.steps[k].selectedToolKeys=[...z])},Q=F(!1),ne=F(""),he=F(!1),Be=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}ne.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),Q.value=!0},He=()=>{Q.value=!1,ne.value="",he.value=!1},jt=async()=>{if(!ne.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}he.value=!0;try{const k=a.getConfig(),z=`planTemplate-${Date.now()}`,J={...k,title:ne.value.trim(),planTemplateId:z};(await lo.createOrUpdatePlanTemplateWithTool(J)).success?(s.success(e("sidebar.copyPlanSuccess",{title:ne.value.trim()})),await oe.loadPlanTemplateList(),He()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(k){if(console.error("[JsonEditorV2] Error copying plan:",k),k instanceof Error&&k.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const z=k instanceof Error?k.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:z}))}}finally{he.value=!1}};de(()=>l.title,k=>{k?.trim()?C.value="":C.value="Title is required field"},{immediate:!0});const Vt=()=>{const k=a.getServiceGroup()||"";c.value=k};de(()=>a.config,()=>{P()},{deep:!0,immediate:!0}),de(()=>a.currentPlanTemplateId.value,(k,z)=>{z!=null&&k!==z&&(x.value.clear(),V.value.clear(),w.value.clear(),le.value=!1,Q.value=!1,r.value=!1,M.value=-1,ne.value="",he.value=!1),P(),Vt()},{immediate:!0}),de(()=>c.value,k=>{a.setServiceGroup(k)});const Ks=async()=>{if(!i.value){i.value=!0;try{const k=await $s.getAvailableTools(),z=new Set;k.forEach(J=>{J.serviceGroup&&z.add(J.serviceGroup)}),_.value=Array.from(z).sort()}catch(k){console.error("[JsonEditorV2] Failed to load service groups:",k),_.value=[]}finally{i.value=!1}}},zt=Z(()=>{const k=c.value.trim();if(!k)return _.value;const z=k.toLowerCase();return _.value.filter(J=>J.toLowerCase().includes(z))}),Js=()=>{m.value=!0},Xs=()=>{setTimeout(()=>{m.value=!1},200)},Qs=k=>{c.value=k,m.value=!1};De(()=>{P(),Vt(),Ks(),K(),document.addEventListener("click",re)}),Le(()=>{document.removeEventListener("click",re)}),t({save:R});const Wt=k=>{const z=k.target;z.style.height="auto";const J=20,se=Math.ceil(z.scrollHeight/J),pe=4,tt=12,ut=Math.max(pe,Math.min(tt,se)),Zs=ut*J;z.style.height=`${Zs}px`,z.rows=ut,se>tt?z.style.overflowY="auto":z.style.overflowY="hidden"},Ys=k=>{if(!k.trim())return"";const z=k.split(",").map(J=>J.trim()).filter(J=>J.length>0);return z.length===0?"":`|${z.join("|")}|`};return(k,z)=>(h(),g("div",Zp,[n("div",em,[A(d(D),{icon:"carbon:code",width:"16"}),n("span",null,u(k.$t("sidebar.dynamicAgentPlan")),1)]),n("div",tm,[n("div",sm,[n("div",om,[n("label",nm,u(k.$t("sidebar.title")),1),ve(n("input",{"onUpdate:modelValue":z[0]||(z[0]=J=>l.title=J),type:"text",class:ce(["form-input",{error:C.value}]),placeholder:k.$t("sidebar.titlePlaceholder")},null,10,am),[[Se,l.title]]),C.value?(h(),g("div",lm,[A(d(D),{icon:"carbon:warning",width:"12"}),ie(" "+u(C.value),1)])):B("",!0)]),n("div",rm,[n("label",im,u(k.$t("mcpService.serviceGroup")),1),n("div",cm,[ve(n("input",{type:"text","onUpdate:modelValue":z[1]||(z[1]=J=>c.value=J),onInput:Js,onFocus:z[2]||(z[2]=J=>m.value=!0),onBlur:Xs,placeholder:k.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,um),[[Se,c.value]]),m.value&&zt.value.length>0?(h(),g("div",dm,[(h(!0),g(ue,null,me(zt.value,J=>(h(),g("div",{key:J,class:"service-group-option",onMousedown:se=>Qs(J)},u(J),41,pm))),128))])):B("",!0)]),n("div",mm,u(k.$t("mcpService.serviceGroupDescription")),1)])]),n("div",hm,[n("div",fm,[(h(!0),g(ue,null,me(l.steps,(J,se)=>(h(),g("div",{key:se,class:"step-item"},[n("div",vm,[n("div",gm,[n("label",ym,u(k.$t("sidebar.stepRequirement")),1),n("textarea",{value:J.stepRequirement||"",onInput:pe=>{J.stepRequirement=pe.target.value,Wt(pe),d(a).setSteps(l.steps),d(a).currentPlanTemplateId.value&&(d(oe).hasTaskRequirementModified=!0,console.log("[JsonEditorV2] Step requirement modified, hasTaskRequirementModified set to true"))},class:"form-textarea auto-resize",placeholder:k.$t("sidebar.stepRequirementPlaceholder"),rows:"4"},null,40,bm)]),n("div",_m,[n("label",wm,u(k.$t("sidebar.terminateColumns")),1),n("textarea",{value:J.terminateColumns||"",onInput:pe=>{J.terminateColumns=pe.target.value,Wt(pe),d(a).setSteps(l.steps),d(a).currentPlanTemplateId.value&&(d(oe).hasTaskRequirementModified=!0,console.log("[JsonEditorV2] Terminate columns modified, hasTaskRequirementModified set to true"))},class:"form-textarea auto-resize",placeholder:k.$t("sidebar.terminateColumnsPlaceholder"),rows:"4"},null,40,$m),J.terminateColumns&&J.terminateColumns.trim()?(h(),g("div",Sm,[n("div",Tm,u(k.$t("sidebar.preview"))+":",1),n("div",km,[n("div",Em,[ie(u(k.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),n("span",Pm,u(Ys(J.terminateColumns)),1)])])])):B("",!0)]),n("div",Cm,[n("label",Im,u(k.$t("sidebar.modelName")),1),n("div",Rm,[n("div",{class:ce(["model-selector",{"is-open":fe(se),"is-disabled":U.value}])},[n("div",xm,[n("input",{value:W(se),type:"text",class:"form-input model-search-input",placeholder:ae(se),disabled:U.value,onClick:ge(pe=>Ce(se),["stop"]),onFocus:pe=>Ce(se),onInput:pe=>Ee(pe,se),onKeydown:[st(pe=>ke(se),["escape"]),st(ge(pe=>H(se),["prevent"]),["enter"]),st(ge(pe=>X(se),["prevent"]),["down"]),st(ge(pe=>te(se),["prevent"]),["up"])]},null,40,Am),A(d(D),{icon:"carbon:chevron-down",width:"14",class:ce(["dropdown-arrow",{"is-open":fe(se)}]),onClick:ge(pe=>Ne(se),["stop"])},null,8,["class","onClick"])]),fe(se)?(h(),g("div",{key:0,class:"model-dropdown",onClick:z[3]||(z[3]=ge(()=>{},["stop"]))},[U.value?(h(),g("div",Fm,u(k.$t("sidebar.loading")),1)):G.value?(h(),g("div",Dm,u(k.$t("sidebar.modelLoadError")),1)):O(se).length===0?(h(),g("div",Mm,u(k.$t("sidebar.noModelsFound")),1)):B("",!0),(h(!0),g(ue,null,me(O(se),(pe,tt)=>(h(),g("div",{key:pe.value,class:ce(["dropdown-item",{"is-selected":J.modelName===pe.value,"is-highlighted":L(se)===tt}]),onClick:ut=>Ie(pe.value,se),onMouseenter:ut=>q(se,tt)},[ie(u(pe.value)+" ",1),J.modelName===pe.value?(h(),ye(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):B("",!0)],42,Nm))),128)),n("div",{class:ce(["dropdown-item",{"is-selected":!J.modelName,"is-highlighted":L(se)===-1}]),onClick:pe=>Ie("",se),onMouseenter:pe=>q(se,-1)},[ie(u(k.$t("sidebar.noModelSelected"))+" ",1),J.modelName?B("",!0):(h(),ye(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Um)])):B("",!0)],2),G.value?(h(),g("button",{key:0,onClick:K,class:"btn btn-sm btn-danger",title:k.$t("sidebar.retryLoadModels")},[A(d(D),{icon:"carbon:warning",width:"14"}),ie(" "+u(k.$t("sidebar.retry")),1)],8,Lm)):B("",!0)]),G.value?(h(),g("div",Om,[A(d(D),{icon:"carbon:warning",width:"12"}),ie(" "+u(G.value),1)])):B("",!0)]),n("div",qm,[A(Ep,{title:k.$t("sidebar.selectedTools"),"selected-tool-ids":J.selectedToolKeys||[],"add-button-text":k.$t("sidebar.addRemoveTools"),"empty-text":k.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:pe=>Y(se),onToolsFiltered:pe=>j(se,pe)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),g("div",Bm,[A(d(D),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),n("p",Hm,u(k.$t("sidebar.noSteps")),1),n("button",{class:"btn btn-primary btn-add-step",onClick:N},[A(d(D),{icon:"carbon:add",width:"16"}),ie(" "+u(k.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r.value?(h(),g("div",jm,[n("div",Vm,[n("label",zm,u(k.$t("sidebar.jsonPreview")),1),n("button",{onClick:S,class:"btn btn-xs"},[A(d(D),{icon:"carbon:close",width:"12"})])]),n("pre",Wm,u(f.value),1)])):B("",!0),n("div",Gm,[n("button",{onClick:p,class:"btn btn-sm btn-secondary"},[A(d(D),{icon:"carbon:code",width:"14"}),ie(" "+u(r.value?k.$t("sidebar.hideJson"):k.$t("sidebar.showJson")),1)]),n("div",Km,[n("button",{class:"btn btn-sm",onClick:Be,disabled:k.isGenerating||k.isExecuting,title:k.$t("sidebar.copyPlan")},[A(d(D),{icon:"carbon:copy",width:"14"}),ie(" "+u(k.$t("sidebar.copyPlan")),1)],8,Jm),n("button",{class:"btn btn-sm",onClick:y,disabled:!d(a).canRollback.value,title:k.$t("sidebar.rollback")},[A(d(D),{icon:"carbon:undo",width:"14"})],8,Xm),n("button",{class:"btn btn-sm",onClick:v,disabled:!d(a).canRestore.value,title:k.$t("sidebar.restore")},[A(d(D),{icon:"carbon:redo",width:"14"})],8,Qm),n("button",{class:"btn btn-primary",onClick:R,disabled:k.isGenerating||k.isExecuting},[A(d(D),{icon:"carbon:save",width:"14"}),z[7]||(z[7]=ie(" Save "))],8,Ym)])])]),A(Yp,{modelValue:le.value,"onUpdate:modelValue":z[4]||(z[4]=J=>le.value=J),"selected-tool-ids":M.value>=0?l.steps[M.value]?.selectedToolKeys||[]:[],onConfirm:$e},null,8,["modelValue","selected-tool-ids"]),Q.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:He},[n("div",{class:"modal-content",onClick:z[6]||(z[6]=ge(()=>{},["stop"]))},[n("div",Zm,[n("h3",null,u(k.$t("sidebar.copyPlan")),1),n("button",{class:"close-btn",onClick:He},[A(d(D),{icon:"carbon:close",width:"16"})])]),n("div",eh,[n("div",th,[n("label",sh,u(k.$t("sidebar.newPlanTitle")),1),ve(n("input",{"onUpdate:modelValue":z[5]||(z[5]=J=>ne.value=J),type:"text",class:"form-input",placeholder:k.$t("sidebar.enterNewPlanTitle"),onKeyup:st(jt,["enter"])},null,40,oh),[[Se,ne.value]])])]),n("div",nh,[n("button",{class:"btn btn-secondary",onClick:He},u(k.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:jt,disabled:!ne.value.trim()||he.value},[he.value?(h(),ye(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):B("",!0),ie(" "+u(he.value?k.$t("sidebar.copying"):k.$t("sidebar.copyPlan")),1)],8,ah)])])])):B("",!0)]))}}),rh=we(lh,[["__scopeId","data-v-7e0def76"]]),ih={class:"template-list-container"},ch={class:"organization-section"},uh={class:"organization-row"},dh={class:"organization-selector"},ph={class:"organization-label"},mh=["value"],hh={value:"by_time"},fh={value:"by_abc"},vh={value:"by_group_time"},gh={value:"by_group_abc"},yh={class:"search-input-wrapper"},bh={class:"search-label"},_h={class:"search-input-container"},wh=["placeholder"],$h=["title"],Sh={class:"sidebar-content-list"},Th={key:0,class:"loading-state"},kh={key:1,class:"error-state"},Eh={key:2,class:"empty-state"},Ph=["onClick","title"],Ch=["onClick","title"],Ih={class:"group-name"},Rh={class:"group-count"},xh=["onClick"],Ah={class:"task-icon"},Fh={class:"task-details"},Dh={class:"task-title"},Mh={class:"task-time"},Nh={class:"task-actions"},Uh=["title","onClick"],Lh=_e({__name:"TemplateList",emits:["templateSelected","templateCreated"],setup(o,{emit:t}){const{t:e}=Me(),s=Xe(),a=at(),l=F(""),r=t,m=p=>{const S=p.target;oe.setOrganizationMethod(S.value)},_=async()=>{const p=s.getPlanType()||"dynamic_agent";await oe.createNewTemplate(p);const S=s.selectedTemplate.value;S&&(s.reset(),s.setPlanType(S.planType||"dynamic_agent"),S.planTemplateId&&s.setPlanTemplateId(S.planTemplateId),s.setTitle(S.title||"")),Re.switchToTab("config"),console.log("[TemplateList] ðŸ”„ Reloading available tools for new template"),await a.loadAvailableTools(),r("templateCreated")},i=p=>{if(isNaN(p.getTime()))return console.warn("Invalid date received:",p),e("time.unknown");const y=new Date().getTime()-p.getTime(),v=Math.floor(y/6e4),R=Math.floor(y/36e5),C=Math.floor(y/864e5);return v<1?e("time.now"):v<60?e("time.minuteAgo",{count:v}):R<24?e("time.hourAgo",{count:R}):C<30?e("time.dayAgo",{count:C}):p.toLocaleDateString("zh-CN")},c=Z(()=>{s.planTemplateList.value;const p=l.value.trim().toLowerCase(),S=oe.groupedTemplates;if(!p)return S;const y=new Map;for(const[v,R]of S){const C=[];for(const N of R)(N.title||"").toLowerCase().includes(p)&&C.push(N);C.length>0&&y.set(v,C)}return y});de(l,p=>{s.planTemplateList.value;const S=p.trim().toLowerCase();if(!S||oe.organizationMethod!=="by_group_time"&&oe.organizationMethod!=="by_group_abc")return;const y=oe.groupedTemplates;for(const[v,R]of y){let C=!1;for(const N of R)if((N.title||"").toLowerCase().includes(S)){C=!0;break}C&&oe.isGroupCollapsed(v)&&oe.toggleGroupCollapse(v)}});const f=p=>{const S=p??"null";return oe.groupCollapseState[S]??!1},E=p=>{oe.toggleGroupCollapse(p)},P=async p=>{await oe.selectTemplate(p),p.planTemplateId?(await s.load(p.planTemplateId),oe.hasTaskRequirementModified=!1):(s.reset(),oe.hasTaskRequirementModified=!1),Re.switchToTab("config"),r("templateSelected",p)};return(p,S)=>(h(),g("div",ih,[n("div",ch,[n("button",{class:"new-task-btn",onClick:_},[A(d(D),{icon:"carbon:add",width:"16"}),ie(" "+u(p.$t("sidebar.newPlan")),1)]),n("div",uh,[n("div",dh,[n("label",ph,u(p.$t("sidebar.organizationLabel")),1),n("select",{value:d(oe).organizationMethod,onChange:m,class:"organization-select"},[n("option",hh,u(p.$t("sidebar.organizationByTime")),1),n("option",fh,u(p.$t("sidebar.organizationByAbc")),1),n("option",vh,u(p.$t("sidebar.organizationByGroupTime")),1),n("option",gh,u(p.$t("sidebar.organizationByGroupAbc")),1)],40,mh)]),n("div",yh,[n("label",bh,u(p.$t("sidebar.searchLabel")),1),n("div",_h,[A(d(D),{icon:"carbon:search",width:"16",class:"search-icon"}),ve(n("input",{"onUpdate:modelValue":S[0]||(S[0]=y=>l.value=y),type:"text",class:"search-input",placeholder:p.$t("sidebar.searchPlaceholder")||"Search..."},null,8,wh),[[Se,l.value]]),l.value?(h(),g("button",{key:0,class:"search-clear-btn",onClick:S[1]||(S[1]=y=>l.value=""),title:p.$t("sidebar.clearSearch")||"Clear search"},[A(d(D),{icon:"carbon:close",width:"14"})],8,$h)):B("",!0)])])])]),n("div",Sh,[d(oe).isLoading?(h(),g("div",Th,[A(d(D),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),n("span",null,u(p.$t("sidebar.loading")),1)])):d(oe).errorMessage?(h(),g("div",kh,[A(d(D),{icon:"carbon:warning",width:"20"}),n("span",null,u(d(oe).errorMessage),1),n("button",{onClick:S[2]||(S[2]=(...y)=>d(oe).loadPlanTemplateList&&d(oe).loadPlanTemplateList(...y)),class:"retry-btn"},u(p.$t("sidebar.retry")),1)])):d(s).planTemplateList.value.length===0?(h(),g("div",Eh,[A(d(D),{icon:"carbon:document",width:"32"}),n("span",null,u(p.$t("sidebar.noTemplates")),1)])):(h(!0),g(ue,{key:3},me(c.value,([y,v])=>(h(),g(ue,{key:y||"ungrouped"},[(d(oe).organizationMethod==="by_group_time"||d(oe).organizationMethod==="by_group_abc")&&v.length>0?(h(),g("div",{key:0,class:"group-header",onClick:ge(R=>E(y),["prevent"]),title:f(y)?p.$t("sidebar.expandGroup"):p.$t("sidebar.collapseGroup")},[n("button",{type:"button",class:"group-toggle-btn",onClick:ge(R=>E(y),["stop","prevent"]),title:f(y)?p.$t("sidebar.expandGroup"):p.$t("sidebar.collapseGroup")},[A(d(D),{icon:f(y)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Ch),A(d(D),{icon:"carbon:folder",width:"16"}),n("span",Ih,u(y===null||y===""?p.$t("sidebar.ungroupedMethods"):y),1),n("span",Rh,"("+u(v.length)+")",1)],8,Ph)):B("",!0),(d(oe).organizationMethod==="by_group_time"||d(oe).organizationMethod==="by_group_abc")&&f(y)?B("",!0):(h(!0),g(ue,{key:1},me(v,R=>(h(),g("div",{key:R.planTemplateId||"unknown",class:ce(["sidebar-content-list-item",{"sidebar-content-list-item-active":R.planTemplateId===d(s).currentPlanTemplateId.value,"grouped-item":d(oe).organizationMethod==="by_group_time"||d(oe).organizationMethod==="by_group_abc"}]),onClick:C=>P(R)},[n("div",Ah,[A(d(D),{icon:"carbon:document",width:"20"})]),n("div",Fh,[n("div",Dh,u(R.title||p.$t("sidebar.unnamedPlan")),1)]),n("div",Mh,u(i(d(s).parseDateTime(R.updateTime||R.createTime))),1),n("div",Nh,[n("button",{class:"delete-task-btn",title:p.$t("sidebar.deleteTemplate"),onClick:ge(C=>d(oe).deleteTemplate(R),["stop"])},[A(d(D),{icon:"carbon:close",width:"16"})],8,Uh)])],10,xh))),128))],64))),128))])]))}}),Oh=we(Lh,[["__scopeId","data-v-c5867107"]]),qh={class:"sidebar-content"},Bh={class:"sidebar-content-header"},Hh={class:"sidebar-content-title"},jh={class:"tab-switcher"},Vh=["disabled"],zh={key:0,class:"tab-content"},Wh={key:1,class:"tab-content config-tab"},Gh={key:0,class:"config-container"},Kh={class:"template-info-header"},Jh={class:"template-info"},Xh={class:"template-id"},Qh=["title"],Yh=_e({name:"SidebarPanel",__name:"Sidebar",setup(o,{expose:t}){const e=at(),s=Xe(),a=F(80),l=F(!1),r=F(0),m=F(0),_=E=>{l.value=!0,r.value=E.clientX,m.value=a.value,document.addEventListener("mousemove",i),document.addEventListener("mouseup",c),document.body.style.cursor="col-resize",document.body.style.userSelect="none",E.preventDefault()},i=E=>{if(!l.value)return;const P=window.innerWidth,S=(E.clientX-r.value)/P*100;let y=m.value+S;y=Math.max(15,Math.min(100,y)),a.value=y},c=()=>{l.value=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",a.value.toString())},f=()=>{a.value=80,localStorage.setItem("sidebarWidth","80")};return De(async()=>{await oe.loadPlanTemplateList(),e.loadAvailableTools();const E=localStorage.getItem("sidebarWidth");E&&(a.value=parseFloat(E))}),Le(()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c)}),t({loadPlanTemplateList:oe.loadPlanTemplateList,toggleSidebar:Re.toggleSidebar,currentPlanTemplateId:s.currentPlanTemplateId}),(E,P)=>(h(),g("div",{class:ce(["sidebar-wrapper",{"sidebar-wrapper-collapsed":d(Re).isCollapsed}]),style:Ge({width:a.value+"%"})},[n("div",qh,[n("div",Bh,[n("div",Hh,u(E.$t("sidebar.title")),1)]),n("div",jh,[n("button",{class:ce(["tab-button",{active:d(Re).currentTab==="list"}]),onClick:P[0]||(P[0]=p=>d(Re).switchToTab("list"))},[A(d(D),{icon:"carbon:list",width:"16"}),ie(" "+u(E.$t("sidebar.templateList")),1)],2),n("button",{class:ce(["tab-button",{active:d(Re).currentTab==="config"}]),onClick:P[1]||(P[1]=p=>d(Re).switchToTab("config")),disabled:!d(s).selectedTemplate.value},[A(d(D),{icon:"carbon:settings",width:"16"}),ie(" "+u(E.$t("sidebar.configuration")),1)],10,Vh)]),d(Re).currentTab==="list"?(h(),g("div",zh,[A(Oh)])):d(Re).currentTab==="config"?(h(),g("div",Wh,[d(s).selectedTemplate.value?(h(),g("div",Gh,[n("div",Kh,[n("div",Jh,[n("h3",null,u(d(s).selectedTemplate.value.title||E.$t("sidebar.unnamedPlan")),1),n("span",Xh,"ID: "+u(d(s).selectedTemplate.value.planTemplateId),1)]),n("button",{class:"back-to-list-btn",onClick:P[2]||(P[2]=p=>d(Re).switchToTab("list"))},[A(d(D),{icon:"carbon:arrow-left",width:"16"})])]),A(rh),A(Bu)])):B("",!0)])):B("",!0)]),n("div",{class:"sidebar-resizer",onMousedown:_,onDblclick:f,title:E.$t("sidebar.resizeHint")},P[3]||(P[3]=[n("div",{class:"resizer-line"},null,-1)]),40,Qh)],6))}}),Zh=we(Yh,[["__scopeId","data-v-1c6f7337"]]);function ef(){const o=Ye(),t=Qe(),{showToast:e}=ys(),{t:s}=Me(),a=i=>{const c={currentPlanId:i.currentPlanId,status:i.completed?"completed":"running"};return i.rootPlanId&&(c.rootPlanId=i.rootPlanId),i.summary&&(c.summary=i.summary),i.completed!==void 0&&(c.completed=i.completed),i.agentExecutionSequence&&(c.agentExecutionSequence=i.agentExecutionSequence),c},l=i=>{if(!i)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(i)){const[c,f,E,P=0,p=0,S=0,y=0]=i,v=new Date(c,f-1,E,P,p,S,Math.floor(y/1e6));return isNaN(v.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",i),new Date):v}if(typeof i=="string"){let c=new Date(i);if(!isNaN(c.getTime()))return c;const f=i.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(f){const[,E,P,p,S,y,v,R]=f;if(c=new Date(parseInt(E),parseInt(P)-1,parseInt(p),parseInt(S),parseInt(y),parseInt(v),R?parseInt(R.substring(0,3)):0),!isNaN(c.getTime()))return c}return!i.includes("Z")&&!i.includes("+")&&!i.includes("-",10)&&(c=new Date(i+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",i),new Date)}if(typeof i=="number"){const c=i.toString().length<13?i*1e3:i,f=new Date(c);return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",i),new Date):f}return console.warn("[useConversationHistory] Unknown date format:",i,typeof i),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",i,c),new Date}},r=i=>{if(!i)return;console.log("[useConversationHistory] Processing record:",{userRequest:i.userRequest,startTime:i.startTime,startTimeType:typeof i.startTime,endTime:i.endTime,endTimeType:typeof i.endTime});const c=i.userRequest||i.title||"History Round",f=o.createDialog(c),E=Te.getConversationId();if(E){const P=o.getDialog(f.id);P&&(P.conversationId=E,i.rootPlanId&&(P.planId=i.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",f.id,E))}if(i.userRequest&&i.startTime){const P=l(i.startTime);console.log("[useConversationHistory] Parsed date:",{original:i.startTime,parsed:P,parsedISO:P.toISOString(),isValid:!isNaN(P.getTime())});const p={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:i.userRequest,timestamp:P,isStreaming:!1};o.addMessageToDialog(f.id,p)}if(i.currentPlanId){const P=i.summary||i.result||i.message||"Execution completed",p=a(i),S={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:P,timestamp:i.endTime&&i.endTime?l(i.endTime):i.startTime?l(i.startTime):new Date,isStreaming:!1,planExecution:p};o.addMessageToDialog(f.id,S),i.rootPlanId&&t.setCachedPlanRecord(i.rootPlanId,p)}},m=async(i,c=!1,f=!0)=>{if(!i){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&o.clearMessages(),Te.setConversationId(i),o.setConversationId(i);const E=await pt.getConversationHistory(i);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const P=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:P.startTime,endTime:P.endTime,startTimeType:typeof P.startTime})}for(const P of E)r(P);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),f&&e(s("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:m,restoreConversationHistory:async i=>m(i,!1,!1),processHistoryRecord:r}}let Rt=null;function tf(){return Rt||(Rt=ef()),Rt}const sf={class:"direct-page"},of={class:"direct-chat"},nf={class:"chat-header"},af={class:"header-actions"},lf=["title"],rf=["title"],cf=["title"],uf={class:"chat-content"},df=["title"],pf={class:"message-content"},mf=_e({name:"DirectIndex",__name:"index",setup(o){const t=oo(),e=no(),s=vt(),{toast:a}=ys(),l=Ye(),r=Qe(),m=tf(),_=F(""),i=F(),c=F(),f=F(null),E=F(50),P=F(!1),p=F(0),S=F(0),y=Z(()=>{if(Re.isCollapsed)return E.value;let b=26;c.value&&c.value.sidebarWidth!==void 0&&(b=c.value.sidebarWidth);const $=100-b;return Math.max(20,Math.min($,E.value))});De(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),de(()=>r.planExecutionRecords,O=>{for(const[W,ae]of O.entries())T(W)&&(i.value&&typeof i.value.updateDisplayedPlanProgress=="function"&&i.value.updateDisplayedPlanProgress(W),ae.completed&&(console.log("[Direct] Plan completed, clearing currentRootPlanId"),f.value=null))},{deep:!0}),de(()=>r.trackedPlanIds,O=>{if(!f.value&&O.value.size>0){const W=Array.from(O.value)[0];f.value=W,console.log("[Direct] Set currentRootPlanId to:",W)}},{deep:!0});const b=Te.getConversationId();if(b&&(console.log("[Direct] Found saved conversationId, restoring conversation:",b),xe(async()=>{try{await m.restoreConversationHistory(b)}catch(O){console.error("[DirectView] Failed to restore conversation history:",O)}})),oe.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const O=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),O.trim()?(s.markTaskAsProcessed(),xe(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",O),await l.sendMessage({input:O})}catch(W){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",W),_.value=O}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(_.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",_.value),console.log("[Direct] No unprocessed task in store"));const $=localStorage.getItem("directPanelWidth");$&&(E.value=parseFloat($)),console.log("[Direct] Final prompt value:",_.value)}),de(()=>s.currentTask,b=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",b),b&&!b.processed&&b.prompt.trim()){const $=b.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",$),xe(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",$),await l.sendMessage({input:$})}catch(O){console.warn("[Direct] messageDialog.sendMessage failed for new task:",O)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),de(()=>_.value,(b,$)=>{console.log("[Direct] prompt value changed from:",$,"to:",b)},{immediate:!1}),Le(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),f.value=null,r.cleanup(),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",C)});const v=b=>{P.value=!0,p.value=b.clientX,S.value=E.value,document.addEventListener("mousemove",R),document.addEventListener("mouseup",C),document.body.style.cursor="col-resize",document.body.style.userSelect="none",b.preventDefault()},R=b=>{if(!P.value)return;const $=window.innerWidth,W=(b.clientX-p.value)/$*100;let ae=S.value+W;ae=Math.max(20,Math.min(80,ae)),E.value=ae},C=()=>{P.value=!1,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",C),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},N=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},T=(b,$=!1)=>!f.value||b===f.value||$&&(b==="ui-state"||b==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",b,"current:",f.value),!1),U=b=>{console.log("[DirectView] Step selected:",b),i.value&&typeof i.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",b),i.value.handleStepSelected(b)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},G=()=>{e.push("/home")},x=()=>{e.push("/configs")},V=async()=>{if(Te.selectMemoryId){console.log("[DirectView] Memory selected:",Te.selectMemoryId);try{await m.loadConversationHistory(Te.selectMemoryId,!0,!0)}catch(b){console.error("[DirectView] Failed to load conversation history:",b)}}},w=()=>{Te.clearMemoryId(),Te.clearConversationId(),l.reset()};return(b,$)=>(h(),g("div",sf,[n("div",of,[A(Zh,{ref_key:"sidebarRef",ref:c},null,512),n("div",{class:"left-panel",style:Ge({width:y.value+"%"})},[n("div",nf,[n("button",{class:"back-button",onClick:G},[A(d(D),{icon:"carbon:arrow-left"})]),n("h2",null,u(b.$t("conversation")),1),n("div",af,[A(ro),n("button",{class:"config-button",onClick:w,title:b.$t("memory.newChat")},[A(d(D),{icon:"carbon:add",width:"20"})],8,lf),n("button",{class:"config-button",onClick:x,title:b.$t("direct.configuration")},[A(d(D),{icon:"carbon:settings-adjust",width:"20"})],8,rf),n("button",{class:"cron-task-btn",onClick:$[0]||($[0]=O=>d(Te).toggleSidebar()),title:b.$t("memory.selectMemory")},[A(d(D),{icon:"carbon:calendar",width:"20"})],8,cf)])]),n("div",uf,[A(Wa,{onStepSelected:U})]),(h(),ye(fl,{key:b.$i18n.locale,"initial-value":_.value},null,8,["initial-value"]))],4),n("div",{class:"panel-resizer",onMousedown:v,onDblclick:N,title:b.$t("direct.panelResizeHint")},$[1]||($[1]=[n("div",{class:"resizer-line"},null,-1)]),40,df),A(uc,{ref_key:"rightPanelRef",ref:i,style:Ge({width:100-E.value+"%"}),"current-root-plan-id":f.value},null,8,["style","current-root-plan-id"])]),A(ar,{onMemorySelected:V}),d(a).show?(h(),g("div",{key:0,class:ce(["message-toast",d(a).type])},[n("div",pf,[n("span",null,u(d(a).text),1)])],2)):B("",!0)]))}}),Lf=we(mf,[["__scopeId","data-v-e66fee1e"]]);export{Lf as default};
//# sourceMappingURL=index-DEl5PvwL.js.map
