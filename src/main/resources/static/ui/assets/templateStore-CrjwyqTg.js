import{R as ae,r as S,_ as ne,C as _,c as G,S as re}from"./index--43eg9Zn.js";import{P as L}from"./plan-template-with-tool-api-service-CL33LTCl.js";import{L as b}from"./llm-check-CJy4TeZw.js";const Ae=ae("task",()=>{const t=S(null),e=S(""),s=S(!1);return{currentTask:t,taskToInput:e,hasVisitedHome:s,setTask:c=>{if(console.log("[TaskStore] setTask called with prompt:",c),!c.trim()){console.warn("[TaskStore] Empty prompt provided, not creating task");return}const g={prompt:c,timestamp:Date.now(),processed:!1};t.value=g,console.log("[TaskStore] Task set, currentTask.value:",t.value)},setTaskToInput:c=>{console.log("[TaskStore] setTaskToInput called with prompt:",c),e.value=c,console.log("[TaskStore] Task to input set:",e.value)},getAndClearTaskToInput:()=>{const c=e.value;return e.value="",console.log("[TaskStore] getAndClearTaskToInput returning:",c),c},markTaskAsProcessed:()=>{console.log("[TaskStore] markTaskAsProcessed called, current task:",t.value),t.value?(t.value.processed=!0,console.log("[TaskStore] Task marked as processed:",t.value)):console.log("[TaskStore] No current task to mark as processed")},clearTask:()=>{t.value=null},hasUnprocessedTask:()=>{const c=t.value&&!t.value.processed;return console.log("[TaskStore] hasUnprocessedTask check - currentTask:",t.value,"result:",c),c},markHomeVisited:()=>{s.value=!0,localStorage.setItem("hasVisitedHome","true")},checkHomeVisited:()=>{const c=localStorage.getItem("hasVisitedHome");return s.value=c==="true",s.value},resetHomeVisited:()=>{s.value=!1,localStorage.removeItem("hasVisitedHome")},emitPlanExecutionRequested:c=>{console.log("[TaskStore] emitPlanExecutionRequested called with payload:",c),window.dispatchEvent(new CustomEvent("plan-execution-requested",{detail:c}))},setTaskRunning:c=>{console.log("[TaskStore] setTaskRunning called with planId:",c),t.value?(t.value.planId=c,t.value.isRunning=!0,console.log("[TaskStore] Updated existing task:",t.value)):(t.value={prompt:"",timestamp:Date.now(),processed:!1,planId:c,isRunning:!0},console.log("[TaskStore] Created new task for running state:",t.value))},stopCurrentTask:async()=>{if(console.log("[TaskStore] stopCurrentTask called"),t.value&&t.value.isRunning&&t.value.planId)try{const{DirectApiService:c}=await ne(async()=>{const{DirectApiService:g}=await Promise.resolve().then(()=>ce);return{DirectApiService:g}},void 0);return await c.stopTask(t.value.planId),console.log("[TaskStore] Task stopped successfully"),t.value.isRunning=!1,!0}catch(c){return console.error("[TaskStore] Failed to stop task:",c),!1}return!1},hasRunningTask:()=>{const c=t.value&&t.value.isRunning;return console.log("[TaskStore] hasRunningTask check - result:",c),c}}});class le{isCollapsed=!1;currentTab="list";toggleSidebar(){this.isCollapsed=!this.isCollapsed}switchToTab(e){this.currentTab=e}}const De=_(new le);class ie{isCollapsed=!1;conversationId=null;loadMessages=()=>{};intervalId=void 0;CONVERSATION_ID_KEY="currentConversationId";constructor(){this.loadConversationIdFromStorage()}loadConversationIdFromStorage(){try{const e=localStorage.getItem(this.CONVERSATION_ID_KEY);e&&(this.conversationId=e,console.log("[MemoryStore] Restored conversationId from localStorage:",e))}catch(e){console.warn("[MemoryStore] Failed to load conversationId from localStorage:",e)}}saveConversationIdToStorage(){try{this.conversationId?(localStorage.setItem(this.CONVERSATION_ID_KEY,this.conversationId),console.log("[MemoryStore] Saved conversationId to localStorage:",this.conversationId)):(localStorage.removeItem(this.CONVERSATION_ID_KEY),console.log("[MemoryStore] Removed conversationId from localStorage"))}catch(e){console.warn("[MemoryStore] Failed to save conversationId to localStorage:",e)}}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectConversation(e){this.toggleSidebar(),this.conversationId=e,this.saveConversationIdToStorage()}clearSelectedConversation(){this.conversationId=null,this.saveConversationIdToStorage()}setConversationId(e){this.conversationId=e,this.saveConversationIdToStorage()}clearConversationId(){this.conversationId=null,this.saveConversationIdToStorage()}getConversationId(){return this.conversationId}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const A=_(new ie);class q{static BASE_URL="/api/executor";static async sendMessage(e){return b.withLlmCheck(async()=>{const s={...e,requestSource:"VUE_DIALOG"},a=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error(`API request failed: ${a.status}`);return await a.json()})}static async sendChatMessage(e,s="VUE_DIALOG",a){return b.withLlmCheck(async()=>{console.log("[DirectApiService] sendChatMessage called with:",{input:e.input,uploadedFiles:e.uploadedFiles,uploadKey:e.uploadKey,requestSource:s});const p={input:e.input,requestSource:s};A.conversationId&&(p.conversationId=A.conversationId,console.log("[DirectApiService] Including conversationId from memoryStore:",A.conversationId)),e.uploadedFiles&&e.uploadedFiles.length>0&&(p.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(p.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Making SSE request to:",`${this.BASE_URL}/chat`),console.log("[DirectApiService] Request body:",p);const n=await fetch(`${this.BASE_URL}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(p)});if(console.log("[DirectApiService] Response status:",n.status,n.ok),console.log("[DirectApiService] Response headers:",{contentType:n.headers.get("Content-Type"),transferEncoding:n.headers.get("Transfer-Encoding")}),!n.ok){const I=await n.text();throw console.error("[DirectApiService] Request failed:",I),new Error(`Failed to send chat message: ${n.status}`)}if(!n.body)throw new Error("Response body is null");const r=n.body.getReader(),i=new TextDecoder;let l="",m,h="";console.log("[DirectApiService] Starting to read SSE stream...");try{for(;;){const{done:I,value:D}=await r.read();if(console.log("[DirectApiService] Read chunk:",{done:I,valueLength:D?.length}),I)break;l+=i.decode(D,{stream:!0}),console.log("[DirectApiService] Buffer length:",l.length,"content:",l.substring(0,200));const w=l.split(`

`);l=w.pop()||"",console.log("[DirectApiService] Split into",w.length,"lines, buffer remaining:",l.length);for(const C of w)if(console.log("[DirectApiService] Processing line:",C),C.startsWith("data:")){const c=C.startsWith("data: ")?C.slice(6):C.slice(5);console.log("[DirectApiService] Extracted data:",c);try{const g=JSON.parse(c);if(console.log("[DirectApiService] Parsed SSE event:",g),g.type==="start"&&g.conversationId)m=g.conversationId,console.log("[DirectApiService] Got start event with conversationId:",m),a&&a({type:"start",conversationId:g.conversationId});else if(g.type==="chunk"&&g.content)h+=g.content,console.log("[DirectApiService] Got chunk, accumulated length:",h.length),a&&a({type:"chunk",content:g.content});else if(g.type==="done")console.log("[DirectApiService] Got done event"),a&&a({type:"done"});else if(g.type==="error")throw console.error("[DirectApiService] Got error event:",g.message),a&&a({type:"error",message:g.message||"Streaming error occurred"}),r.releaseLock(),new Error(g.message||"Streaming error occurred")}catch(g){console.error("[DirectApiService] Error parsing SSE data:",g,"Data:",c)}}}}finally{r.releaseLock()}const y={};return m&&(y.conversationId=m),y.message=h||"No response received",console.log("[DirectApiService] sendChatMessage completed:",y),y})}static async executeByToolName(e,s,a,p,n="VUE_DIALOG",r){return b.withLlmCheck(async()=>{console.log("[DirectApiService] executeByToolName called with:",{toolName:e,replacementParams:s,uploadedFiles:a,uploadKey:p,requestSource:n,serviceGroup:r});const i={toolName:e,requestSource:n};A.conversationId&&(i.conversationId=A.conversationId,console.log("[DirectApiService] Including conversationId from memoryStore:",A.conversationId)),r&&(i.serviceGroup=r,console.log("[DirectApiService] Including serviceGroup:",r)),s&&Object.keys(s).length>0&&(i.replacementParams=s,console.log("[DirectApiService] Including replacement params:",s)),a&&a.length>0&&(i.uploadedFiles=a,console.log("[DirectApiService] Including uploaded files:",a.length)),p&&(i.uploadKey=p,console.log("[DirectApiService] Including uploadKey:",p)),console.log("[DirectApiService] Making request to:",`${this.BASE_URL}/executeByToolNameAsync`),console.log("[DirectApiService] Request body:",i);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(console.log("[DirectApiService] Response status:",l.status,l.ok),!l.ok){const h=await l.text();throw console.error("[DirectApiService] Request failed:",h),new Error(`Failed to execute: ${l.status}`)}const m=await l.json();return console.log("[DirectApiService] executeByToolName response:",m),m})}static async stopTask(e){return b.withLlmCheck(async()=>{console.log("[DirectApiService] Stopping task for planId:",e);const s=await fetch(`${this.BASE_URL}/stopTask/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.error||`Failed to stop task: ${s.status}`)}return await s.json()})}}const ce=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:q},Symbol.toStringTag,{value:"Module"}));class pe{static PLAN_TEMPLATE_URL="/api/plan-template";static async executePlan(e,s,a,p,n,r,i="VUE_SIDEBAR"){return b.withLlmCheck(async()=>(console.log("[PlanActApiService] executePlan called with:",{toolName:e,serviceGroup:s,rawParam:a,uploadedFiles:p,replacementParams:n,uploadKey:r,requestSource:i}),a&&(n||(n={}),n.userRequirement=a,console.log("[PlanActApiService] Added rawParam to replacementParams:",a)),await q.executeByToolName(e,n,p,r,i,s)))}static async getPlanVersions(e){const s=await fetch(`${this.PLAN_TEMPLATE_URL}/versions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:e})});if(!s.ok)throw new Error(`Failed to get plan versions: ${s.status}`);return await s.json()}static async getAllPlanTemplates(){const e=await fetch(`${this.PLAN_TEMPLATE_URL}/list`);if(!e.ok)throw new Error(`Failed to get plan template list: ${e.status}`);return await e.json()}}function ue(){const t=_({title:"",steps:[],directResponse:!1,planType:"dynamic_agent",planTemplateId:"",accessLevel:"editable",serviceGroup:""}),e=S(!1),s=S(null),a=S(!1),p=S(!1),n=S([]),r=S(-1),i=S([]),l=S(null),m=S(null),h=()=>t.title,y=()=>t.planType||"dynamic_agent",I=()=>t.serviceGroup||"",D=o=>{t.title=o},w=o=>{t.steps=o||[]},C=o=>{t.planType=o},c=o=>{t.planTemplateId=o},g=o=>{t.serviceGroup=o},N=o=>{o===void 0?delete t.toolConfig:t.toolConfig=o},B=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.toolDescription=o},x=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableInternalToolcall=o},F=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableHttpService=o},U=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.enableInConversation=o},j=o=>{t.toolConfig||(t.toolConfig={}),t.toolConfig.inputSchema=o||[]},E=()=>({...t}),R=o=>{p.value=!0;const u=o.accessLevel||(o.readOnly?"readOnly":"editable"),T={title:o.title||"",steps:(o.steps||[]).map(f=>({...f,selectedToolKeys:f.selectedToolKeys??[]})),directResponse:o.directResponse||!1,planType:o.planType||"dynamic_agent",planTemplateId:o.planTemplateId||"",accessLevel:u,serviceGroup:o.serviceGroup||""};o.toolConfig&&(T.toolConfig={...o.toolConfig}),Object.assign(t,T),setTimeout(()=>{p.value=!1},50)},K=()=>{p.value=!0,Object.assign(t,{title:"",steps:[],directResponse:!1,planType:"dynamic_agent",planTemplateId:"",accessLevel:"editable",serviceGroup:""}),"toolConfig"in t&&delete t.toolConfig,n.value=[],r.value=-1,s.value=null,setTimeout(()=>{p.value=!1},0)},V=()=>{const o=t.accessLevel||(t.readOnly?"readOnly":"editable"),u={title:t.title||"",steps:(t.steps||[]).map(T=>({...T,selectedToolKeys:T.selectedToolKeys??[]})),directResponse:t.directResponse||!1,planType:t.planType||"dynamic_agent",planTemplateId:t.planTemplateId||"",accessLevel:o,serviceGroup:t.serviceGroup||""};return t.toolConfig&&(u.toolConfig={...t.toolConfig}),JSON.stringify(u,null,2)},M=o=>{try{const u=JSON.parse(o);return R(u),!0}catch(u){return s.value=u instanceof Error?u.message:"Invalid JSON format",!1}},$=G(()=>n.value.length>1&&r.value>0),z=G(()=>n.value.length>1&&r.value<n.value.length-1),Y=()=>{if($.value&&r.value>0){r.value--;const o=n.value[r.value]||"";M(o)}},Q=()=>{if(z.value&&r.value<n.value.length-1){r.value++;const o=n.value[r.value]||"";M(o)}},X=o=>{r.value<n.value.length-1&&(n.value=n.value.slice(0,r.value+1)),n.value.push(o),r.value=n.value.length-1},W=async o=>{if(!o)return s.value="Plan template ID is required",!1;try{e.value=!0,s.value=null;const u=await L.getPlanTemplateConfigVO(o);m.value===o&&(m.value=null,await new Promise(f=>setTimeout(f,0))),a.value=!1,R(u),m.value=o,await new Promise(f=>setTimeout(f,10)),l.value?.planTemplateId===o&&(l.value={...l.value,...u});try{const f=await pe.getPlanVersions(o);n.value=f.versions||[],n.value.length>0?r.value=n.value.length-1:r.value=-1}catch(f){console.warn("Failed to load plan versions:",f),n.value=[],r.value=-1}return!0}catch(u){return s.value=u instanceof Error?u.message:"Failed to load plan template config",console.error("Failed to load plan template config:",u),!1}finally{e.value=!1}},Z=async()=>{if(!t.planTemplateId)return s.value="Plan template ID is required",!1;try{e.value=!0,s.value=null;const o=await L.createOrUpdatePlanTemplateWithTool(E());if(o.success){const u=t.planTemplateId;if(u){if(await W(u),l.value?.planTemplateId===u){const f=E();l.value={...l.value,...f}}const T=i.value.findIndex(f=>f.planTemplateId===u);if(T>=0){const f=E();i.value[T]={...i.value[T],...f}}}}return o.success}catch(o){return s.value=o instanceof Error?o.message:"Failed to save plan template config",console.error("Failed to save plan template config:",o),!1}finally{e.value=!1}},ee=()=>{const o=[];return t.planTemplateId?.trim()||o.push("Plan template ID is required"),t.title?.trim()||o.push("Title is required"),(!t.steps||t.steps.length===0)&&o.push("At least one step is required"),{isValid:o.length===0,errors:o}},te=o=>o?Array.isArray(o)&&o.length>=6?new Date(o[0],o[1]-1,o[2],o[3],o[4],o[5],Math.floor(o[6]/1e6)):typeof o=="string"?new Date(o):new Date:new Date,oe=()=>{const o=[];for(const u of i.value){if(!u.toolConfig)continue;const T=u.toolConfig;if(!T.enableInternalToolcall)continue;let f="[]";T.inputSchema&&Array.isArray(T.inputSchema)&&(f=JSON.stringify(T.inputSchema));const H={toolName:u.title||"",toolDescription:T.toolDescription||"",planTemplateId:u.planTemplateId||"",inputSchema:f,enableInternalToolcall:T.enableInternalToolcall??!0,enableHttpService:T.enableHttpService??!1,enableInConversation:T.enableInConversation??!1};u.serviceGroup&&(H.serviceGroup=u.serviceGroup),o.push(H)}return o},se=()=>i.value.some(o=>o.toolConfig!==void 0),k=o=>{a.value=!0;try{return o()}finally{setTimeout(()=>{a.value=!1},0)}};return{config:t,isLoading:e,error:s,isUserUpdating:a,needsFullRefresh:p,planVersions:n,currentVersionIndex:r,planTemplateList:i,selectedTemplate:l,currentPlanTemplateId:m,getTitle:h,getPlanType:y,getServiceGroup:I,getConfig:E,setTitle:D,setSteps:w,setPlanType:C,setPlanTemplateId:c,setServiceGroup:g,setToolConfig:N,setToolDescription:B,setEnableInternalToolcall:x,setEnableHttpService:F,setEnableInConversation:U,setInputSchema:j,setConfig:R,setStepsWithGuard:o=>k(()=>{w(o)}),setToolConfigWithGuard:o=>k(()=>{N(o)}),setToolDescriptionWithGuard:o=>k(()=>{B(o)}),setEnableInternalToolcallWithGuard:o=>k(()=>{x(o)}),setEnableHttpServiceWithGuard:o=>k(()=>{F(o)}),setEnableInConversationWithGuard:o=>k(()=>{U(o)}),setInputSchemaWithGuard:o=>k(()=>{j(o)}),withUpdateGuard:k,reset:K,load:W,save:Z,validate:ee,generateJsonString:V,fromJsonString:M,rollbackVersion:Y,restoreVersion:Q,updateVersionsAfterSave:X,canRollback:$,canRestore:z,parseDateTime:te,getAllCoordinatorToolsFromTemplates:oe,getCoordinatorToolConfig:se}}let P=null;function J(){return P||(P=ue()),P}class de{isLoading=!1;errorMessage="";hasTaskRequirementModified=!1;organizationMethod="by_group_time";templateServiceGroups=new Map;groupCollapseState={};constructor(){const e=localStorage.getItem("sidebarOrganizationMethod");e&&["by_time","by_abc","by_group_time","by_group_abc"].includes(e)&&(this.organizationMethod=e),this.loadGroupCollapseState()}loadGroupCollapseState(){try{const e=localStorage.getItem("sidebarGroupCollapseState");if(e){const s=JSON.parse(e);this.groupCollapseState=s||{}}}catch(e){console.warn("[TemplateStore] Failed to load group collapse state:",e)}}saveGroupCollapseState(){try{localStorage.setItem("sidebarGroupCollapseState",JSON.stringify(this.groupCollapseState))}catch(e){console.warn("[TemplateStore] Failed to save group collapse state:",e)}}toggleGroupCollapse(e){const s=e??"null",a=this.groupCollapseState[s]??!1;this.groupCollapseState[s]=!a,this.saveGroupCollapseState()}isGroupCollapsed(e){const s=e??"null";return this.groupCollapseState[s]??!1}parseDateTime(e){return e?Array.isArray(e)&&e.length>=6?new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5],Math.floor(e[6]/1e6)):typeof e=="string"?new Date(e):new Date:new Date}templateConfig=J();setOrganizationMethod(e){this.organizationMethod=e,localStorage.setItem("sidebarOrganizationMethod",e)}async loadPlanTemplateList(){this.isLoading=!0,this.errorMessage="";try{console.log("[TemplateStore] Starting to load plan template list...");const e=await L.getAllPlanTemplateConfigVOs();this.templateConfig.planTemplateList.value=e,this.templateServiceGroups.clear();for(const s of this.templateConfig.planTemplateList.value){const a=s.planTemplateId;if(a){const p=s.serviceGroup||"";p&&this.templateServiceGroups.set(a,p)}}console.log(`[TemplateStore] Successfully loaded ${this.templateConfig.planTemplateList.value.length} plan templates`)}catch(e){console.error("[TemplateStore] Failed to load plan template list:",e),this.templateConfig.planTemplateList.value=[];const s=e instanceof Error?e.message:"Unknown error";this.errorMessage=`Load failed: ${s}`}finally{this.isLoading=!1}}async selectTemplate(e){this.templateConfig.currentPlanTemplateId.value=e.planTemplateId||null,this.templateConfig.selectedTemplate.value=e,this.hasTaskRequirementModified=!1,console.log(`[TemplateStore] Selected plan template: ${e.planTemplateId}`)}async createNewTemplate(e){const s={planTemplateId:`new-${Date.now()}`,title:re.global.t("sidebar.newTemplateName"),planType:e,createTime:new Date().toISOString(),updateTime:new Date().toISOString()};this.templateConfig.selectedTemplate.value=s,this.templateConfig.currentPlanTemplateId.value=null,this.hasTaskRequirementModified=!1,console.log("[TemplateStore] Created new empty plan template")}async deleteTemplate(e){const s=e.planTemplateId;if(!s){console.warn("[TemplateStore] deleteTemplate: Invalid template object or ID");return}try{await L.deletePlanTemplate(s),this.templateConfig.currentPlanTemplateId.value===s&&this.clearSelection(),await this.loadPlanTemplateList(),console.log(`[TemplateStore] Plan template ${s} has been deleted`)}catch(a){throw console.error("Failed to delete plan template:",a),await this.loadPlanTemplateList(),a}}clearSelection(){this.templateConfig.currentPlanTemplateId.value=null,this.templateConfig.selectedTemplate.value=null,this.hasTaskRequirementModified=!1}}const v=new de,ge=J(),d=_({isLoading:v.isLoading,errorMessage:v.errorMessage,hasTaskRequirementModified:v.hasTaskRequirementModified,organizationMethod:v.organizationMethod,templateServiceGroups:v.templateServiceGroups,groupCollapseState:v.groupCollapseState,loadGroupCollapseState:()=>v.loadGroupCollapseState(),saveGroupCollapseState:()=>v.saveGroupCollapseState(),toggleGroupCollapse:t=>{v.toggleGroupCollapse(t);const e=t??"null";d.groupCollapseState[e]=v.groupCollapseState[e],d.groupCollapseState={...d.groupCollapseState}},isGroupCollapsed:t=>v.isGroupCollapsed(t),parseDateTime:t=>v.parseDateTime(t),setOrganizationMethod:t=>{v.setOrganizationMethod(t),d.organizationMethod=t},loadPlanTemplateList:async()=>{await v.loadPlanTemplateList(),d.isLoading=v.isLoading,d.errorMessage=v.errorMessage,d.templateServiceGroups=v.templateServiceGroups},selectTemplate:t=>v.selectTemplate(t),createNewTemplate:t=>v.createNewTemplate(t),deleteTemplate:t=>v.deleteTemplate(t),clearSelection:()=>v.clearSelection()}),O=G(()=>{const t=[...ge.planTemplateList.value].filter(e=>(e.accessLevel||(e.readOnly?"readOnly":"editable"))!=="readOnly");switch(d.organizationMethod){case"by_time":return t.sort((e,s)=>{const a=d.parseDateTime(e.updateTime??e.createTime);return d.parseDateTime(s.updateTime??s.createTime).getTime()-a.getTime()});case"by_abc":return t.sort((e,s)=>{const a=(e.title??"").toLowerCase(),p=(s.title??"").toLowerCase();return a.localeCompare(p)});case"by_group_time":case"by_group_abc":{const e=new Map,s=[];t.forEach(r=>{const i=r.planTemplateId||"",l=d.templateServiceGroups.get(i)??"";!l||l==="default"||l===""?s.push(r):(e.has(l)||e.set(l,[]),e.get(l).push(r))});const a=new Map;e.forEach((r,i)=>{const l=[...r];d.organizationMethod==="by_group_time"?l.sort((m,h)=>{const y=d.parseDateTime(m.updateTime??m.createTime);return d.parseDateTime(h.updateTime??h.createTime).getTime()-y.getTime()}):l.sort((m,h)=>{const y=(m.title??"").toLowerCase(),I=(h.title??"").toLowerCase();return y.localeCompare(I)}),a.set(i,l)}),d.organizationMethod==="by_group_time"?s.sort((r,i)=>{const l=d.parseDateTime(r.updateTime??r.createTime);return d.parseDateTime(i.updateTime??i.createTime).getTime()-l.getTime()}):s.sort((r,i)=>{const l=(r.title??"").toLowerCase(),m=(i.title??"").toLowerCase();return l.localeCompare(m)});const p=[];return p.push(...s),Array.from(a.keys()).sort().forEach(r=>{p.push(...a.get(r))}),p}default:return t.sort((e,s)=>{const a=d.parseDateTime(e.updateTime||e.createTime||"");return d.parseDateTime(s.updateTime||s.createTime||"").getTime()-a.getTime()})}}),me=G(()=>{if(d.organizationMethod!=="by_group_time"&&d.organizationMethod!=="by_group_abc")return new Map([[null,O.value]]);const t=new Map,e=[];O.value.forEach(n=>{const r=n.planTemplateId||"",i=d.templateServiceGroups.get(r)??"";!i||i==="default"||i===""?e.push(n):(t.has(i)||t.set(i,[]),t.get(i).push(n))});const a=new Map;return e.length>0&&a.set(null,e),Array.from(t.keys()).sort().forEach(n=>{a.set(n,t.get(n))}),a});Object.defineProperty(d,"sortedTemplates",{get:()=>O.value,enumerable:!0,configurable:!0});Object.defineProperty(d,"groupedTemplates",{get:()=>me.value,enumerable:!0,configurable:!0});export{q as D,pe as P,J as a,A as m,De as s,d as t,Ae as u};
//# sourceMappingURL=templateStore-CrjwyqTg.js.map
