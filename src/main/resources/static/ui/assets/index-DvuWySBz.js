const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-9kmvVBVq.js","assets/index-CVMzSSEY.js","assets/index-DN-vOy2S.css","assets/llm-check-S84pbv31.js"])))=>i.map(i=>d[i]);
var No=Object.defineProperty;var Uo=(n,e,o)=>e in n?No(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var ke=(n,e,o)=>Uo(n,typeof e!="symbol"?e+"":e,o);import{c as ue,d as be,a as g,b as p,e as s,f as B,t as i,F as de,q as pe,g as C,i as r,u as Me,n as ae,h as le,z as ze,j as Se,l as he,B as oo,C as nt,r as N,o as Ae,D as me,E as xe,w as ie,m as ve,G as mt,H as Tt,v as Lo,I as so,J as tt,A as Ce,T as Nt,p as Ke,K as Oo,M as Bo,N as qo,O as et,_ as no,P as jo,y as Vo}from"./index-CVMzSSEY.js";import{D as Go,u as ot,P as ut,T as Ho,s as H}from"./sidebar-9kmvVBVq.js";import{I as R,_ as ye}from"./_plugin-vue_export-helper-B_v8E9K7.js";import{L as Jo}from"./LanguageSwitcher-BWnA7PpR.js";import{M as ao,u as Wo,a as zo}from"./useMessage-BCdDQEZ4.js";import"./llm-check-S84pbv31.js";class ft{static async getDetails(e){try{const o=await fetch(`${this.BASE_URL}/details/${e}`);if(o.status===404)return null;if(!o.ok){const l=await o.text();throw new Error(`Failed to get detailed information: ${o.status} - ${l}`)}const t=await o.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(o){return console.error("[CommonApiService] Failed to get plan details:",o),null}}static async submitFormInput(e,o){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ke(ft,"BASE_URL","/api/executor");function Ut(){return{formatResponseText:m=>m?m.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:m=>{const h=new Date().getTime()-m.getTime();return h<6e4?"Just now":h<36e5?`${Math.floor(h/6e4)} minutes ago`:h<864e5?`${Math.floor(h/36e5)} hours ago`:m.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:m=>ue(()=>({user:m.type==="user",assistant:m.type==="assistant",streaming:m.isStreaming,"has-error":!!m.error,"has-thinking":!!m.thinking,"has-execution":!!m.planExecution})),formatFileSize:m=>{if(m===0)return"0 B";const u=1024,h=["B","KB","MB","GB"],y=Math.floor(Math.log(m)/Math.log(u));return parseFloat((m/Math.pow(u,y)).toFixed(2))+" "+h[y]},truncateText:(m,u=100)=>!m||m.length<=u?m:m.substring(0,u)+"...",stripHtml:m=>m.replace(/<[^>]*>/g,""),hasDisplayableContent:m=>!!(m.content||(m.thinking??!1)||(m.planExecution??!1)||m.error),getMessageStatus:m=>m.error?"Send failed":m.isStreaming?"Typing...":m.type==="assistant"&&!m.content&&!m.thinking?"Waiting for response":""}}const Ko=["data-message-id"],Xo={class:"user-content"},Qo={class:"message-text"},Yo={key:0,class:"attachments"},Zo={class:"attachment-name"},es={class:"attachment-size"},ts={class:"message-timestamp"},os={key:0,class:"message-status error"},ss={class:"status-text"},ns=be({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:o}=Ut();return(t,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":t.message.id},[s("div",Xo,[s("div",Qo,i(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(p(),g("div",Yo,[(p(!0),g(de,null,pe(t.message.attachments,(c,d)=>(p(),g("div",{key:d,class:"attachment-item"},[C(r(R),{icon:"carbon:document",class:"attachment-icon"}),s("span",Zo,i(c.name),1),s("span",es,i(r(o)(c.size)),1)]))),128))])):B("",!0),s("div",ts,i(r(e)(t.message.timestamp)),1)]),t.message.error?(p(),g("div",os,[C(r(R),{icon:"carbon:warning",class:"status-icon"}),s("span",ss,i(t.message.error),1)])):B("",!0)],8,Ko)}}}),as=ye(ns,[["__scopeId","data-v-94372507"]]),ls={class:"sub-plan-info"},rs={class:"sub-plan-details"},is={class:"sub-plan-title"},cs={key:0,class:"nesting-level"},ds={class:"sub-plan-id"},us={class:"sub-plan-meta"},ps={key:0,class:"trigger-tool"},hs={class:"trigger-text"},ms={key:0,class:"sub-plan-progress"},fs={class:"progress-info"},gs={class:"progress-text"},vs={class:"progress-bar"},bs={key:1,class:"sub-plan-agents-steps"},ys={class:"agents-steps-header"},_s={class:"agents-label"},Ss={class:"agents-steps-list"},ws=["onClick"],$s={class:"agent-step-header"},Ps={class:"agent-name"},ks={class:"sub-agent-execution-info"},Es={key:0,class:"agent-result"},Ts={class:"result-header"},Cs={class:"result-label"},Rs={class:"result-content"},Is={key:1,class:"agent-error"},As={class:"error-header"},xs={class:"error-label"},Ms={class:"error-content"},Fs={key:2,class:"think-act-preview"},Ds={class:"think-act-header"},Ns={class:"think-act-label"},Us={class:"think-act-steps-preview"},Ls=["onClick"],Os={class:"step-number"},Bs={class:"step-description"},qs={key:0,class:"more-steps"},js={class:"more-steps-text"},Vs={key:3,class:"nested-sub-plans"},Gs={class:"nested-sub-plans-header"},Hs={class:"nested-label"},Js={class:"nested-sub-plans-list"},Ws={key:4,class:"direct-sub-plans"},zs={class:"direct-sub-plans-header"},Ks={class:"direct-label"},Xs={class:"direct-sub-plans-list"},Qs=be({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Me(),l=()=>`nesting-level-${o.nestingLevel}`,c=()=>{var D,V;return o.subPlan.completed?"completed":((D=o.subPlan.agentExecutionSequence)==null?void 0:D.some(T=>T.status==="RUNNING"))?"running":((V=o.subPlan.agentExecutionSequence)==null?void 0:V.some(T=>T.status==="FINISHED"))?"in-progress":"pending"},d=()=>{switch(c()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},m=()=>{switch(c()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var k;if(!((k=o.subPlan.agentExecutionSequence)!=null&&k.length))return 0;if(o.subPlan.completed)return 100;const f=h();return Math.min(100,f/o.subPlan.agentExecutionSequence.length*100)},h=()=>{var f;return(f=o.subPlan.agentExecutionSequence)!=null&&f.length?o.subPlan.agentExecutionSequence.filter(k=>k.status==="FINISHED").length:0},y=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},F=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},O=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},x=f=>{var k;return((k=f.thinkActSteps)==null?void 0:k.some(D=>D.subPlanExecutionRecord))??!1},w=f=>{var k;return((k=f.thinkActSteps)==null?void 0:k.filter(D=>D.subPlanExecutionRecord))??[]},b=()=>{t("sub-plan-selected",-1,o.subPlanIndex,o.subPlan)},v=(f,k)=>{const D=k.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",D)},E=(f,k,D)=>{const V=D.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",V)},$=(f,k,D)=>{t("sub-plan-selected",f,k,D)},_=f=>{t("step-selected",f)};return(f,k)=>{var V,T;const D=oo("RecursiveSubPlan",!0);return p(),g("div",{class:ae(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:b},[s("div",ls,[C(r(R),{icon:m(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",rs,[s("div",is,[le(i(f.subPlan.title||f.$t("chat.subPlan"))+" #"+i(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(p(),g("span",cs,"(L"+i((f.nestingLevel??0)+1)+")",1)):B("",!0)]),s("div",ds,i(f.subPlan.currentPlanId),1)])]),s("div",us,[s("div",{class:ae(["sub-plan-status-badge",c()])},i(d()),3),f.subPlan.parentActToolCall?(p(),g("div",ps,[C(r(R),{icon:"carbon:function",class:"trigger-icon"}),s("span",hs,i(f.subPlan.parentActToolCall.name),1)])):B("",!0)])]),(V=f.subPlan.agentExecutionSequence)!=null&&V.length?(p(),g("div",ms,[s("div",fs,[s("span",gs,i(f.$t("chat.progress"))+": "+i(h())+" / "+i(f.subPlan.agentExecutionSequence.length),1),s("div",vs,[s("div",{class:"progress-fill",style:ze({width:u()+"%"})},null,4)])])])):B("",!0),(T=f.subPlan.agentExecutionSequence)!=null&&T.length?(p(),g("div",bs,[s("div",ys,[s("span",_s,i(f.$t("chat.agentExecutions"))+":",1)]),s("div",Ss,[(p(!0),g(de,null,pe(f.subPlan.agentExecutionSequence,(M,G)=>{var Y,Q;return p(),g("div",{key:M.id||G,class:ae(["agent-step-item",y(M.status)]),onClick:z=>v(G,M)},[s("div",$s,[C(r(R),{icon:F(M.status),class:"agent-icon"},null,8,["icon"]),s("span",Ps,i(M.agentName||f.$t("chat.unknownAgent")),1),s("div",{class:ae(["agent-status-badge",y(M.status)])},i(O(M.status)),3)]),s("div",ks,[M.result?(p(),g("div",Es,[s("div",Ts,[C(r(R),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Cs,i(f.$t("chat.agentResult"))+":",1)]),s("pre",Rs,i(M.result),1)])):B("",!0),M.errorMessage?(p(),g("div",Is,[s("div",As,[C(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",xs,i(f.$t("chat.errorMessage"))+":",1)]),s("pre",Ms,i(M.errorMessage),1)])):B("",!0),(Y=M.thinkActSteps)!=null&&Y.length?(p(),g("div",Fs,[s("div",Ds,[C(r(R),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",Ns,i(f.$t("chat.thinkActSteps"))+" ("+i(M.thinkActSteps.length)+")",1)]),s("div",Us,[(p(!0),g(de,null,pe(M.thinkActSteps.slice(0,f.maxVisibleSteps??2),(z,K)=>(p(),g("div",{key:z.id||K,class:"think-act-step-preview",onClick:Se(ne=>E(G,K,M),["stop"])},[s("span",Os,"#"+i(K+1),1),s("span",Bs,i(z.actionDescription||f.$t("chat.thinking")),1),C(r(R),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Ls))),128)),M.thinkActSteps.length>(f.maxVisibleSteps??2)?(p(),g("div",qs,[s("span",js,i(f.$t("chat.andMoreSteps",{count:M.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),x(M)?(p(),g("div",Vs,[s("div",Gs,[C(r(R),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",Hs,i(f.$t("chat.nestedSubPlans")),1)]),s("div",Js,[(p(!0),g(de,null,pe(w(M),(z,K)=>(p(),he(D,{key:z.id||K,"sub-plan":z.subPlanExecutionRecord,"sub-plan-index":K,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),(Q=M.subPlanExecutionRecords)!=null&&Q.length?(p(),g("div",Ws,[s("div",zs,[C(r(R),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",Ks,i(f.$t("chat.directSubPlans")),1)]),s("div",Xs,[(p(!0),g(de,null,pe(M.subPlanExecutionRecords,(z,K)=>(p(),he(D,{key:z.currentPlanId||K,"sub-plan":z,"sub-plan-index":K,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,ws)}),128))])])):B("",!0)],2)}}}),Ys=ye(Qs,[["__scopeId","data-v-5dcf159c"]]),Zs={class:"execution-details"},en={key:0,class:"plan-overview"},tn={class:"plan-header"},on={class:"plan-title"},sn={key:0,class:"parent-tool-call"},nn={class:"parent-tool-header"},an={class:"tool-label"},ln={class:"tool-name"},rn={key:0,class:"tool-parameters"},cn={class:"param-label"},dn={class:"param-content"},un={key:1,class:"agent-execution-container"},pn={class:"section-title"},hn=["onClick"],mn={class:"agent-info"},fn={class:"agent-details"},gn={class:"agent-name"},vn={class:"request-content"},bn={class:"agent-controls"},yn={class:"agent-execution-info"},_n={key:0,class:"agent-result"},Sn={class:"result-header"},wn={class:"result-label"},$n={class:"result-content"},Pn={key:1,class:"agent-error"},kn={class:"error-header"},En={class:"error-label"},Tn={class:"error-content"},Cn={key:0,class:"sub-plans-container"},Rn={class:"sub-plans-header"},In={class:"sub-plans-title"},An={class:"sub-plans-list"},xn=be({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Me(),l=ue(()=>o.planExecution.agentExecutionSequence??[]),c=w=>{w.stepId?t("step-selected",w.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",w)},d=()=>o.planExecution.completed?"completed":l.value.some(v=>v.status==="RUNNING")?"running":l.value.some(v=>v.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(d()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=w=>{switch(w){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},h=w=>{switch(w){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},y=w=>{switch(w){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},F=(w,b,v)=>{t("sub-plan-selected",w,b,v)},O=w=>{t("step-selected",w)},x=w=>{if(!w)return"";try{const b=JSON.parse(w);return JSON.stringify(b,null,2)}catch{return w}};return(w,b)=>{var v,E,$;return p(),g("div",Zs,[w.planExecution?(p(),g("div",en,[s("div",tn,[s("h3",on,i(w.planExecution.title||w.$t("chat.planExecution")),1),s("div",{class:ae(["plan-status-badge",d()])},i(m()),3)]),w.planExecution.parentActToolCall?(p(),g("div",sn,[s("div",nn,[C(r(R),{icon:"carbon:flow",class:"tool-icon"}),s("span",an,i(w.$t("chat.triggeredByTool"))+":",1),s("span",ln,i(w.planExecution.parentActToolCall.name),1)]),w.planExecution.parentActToolCall.parameters?(p(),g("div",rn,[s("span",cn,i(w.$t("common.parameters"))+":",1),s("pre",dn,i(x(w.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(((E=(v=w.planExecution)==null?void 0:v.agentExecutionSequence)==null?void 0:E.length)??0)>0?(p(),g("div",un,[s("h4",pn,i(w.$t("chat.agentExecutionSequence")),1),(p(!0),g(de,null,pe(($=w.planExecution)==null?void 0:$.agentExecutionSequence,(_,f)=>{var k;return p(),g("div",{key:_.id||f,class:ae(["agent-execution-item",u(_.status)])},[s("div",{class:"agent-header",onClick:D=>c(_)},[s("div",mn,[C(r(R),{icon:y(_.status),class:"agent-status-icon"},null,8,["icon"]),s("div",fn,[s("div",gn,i(_.agentName||w.$t("chat.unknownAgent")),1),s("pre",vn,i(_.agentRequest),1)])]),s("div",bn,[s("div",{class:ae(["agent-status-badge",u(_.status)])},i(h(_.status)),3),C(r(R),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,hn),s("div",yn,[_.result?(p(),g("div",_n,[s("div",Sn,[C(r(R),{icon:"carbon:checkmark",class:"result-icon"}),s("span",wn,i(w.$t("chat.agentResult"))+":",1)]),s("pre",$n,i(_.result),1)])):B("",!0),_.errorMessage?(p(),g("div",Pn,[s("div",kn,[C(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",En,i(w.$t("chat.errorMessage"))+":",1)]),s("pre",Tn,i(_.errorMessage),1)])):B("",!0)]),(k=_.subPlanExecutionRecords)!=null&&k.length?(p(),g("div",Cn,[s("div",Rn,[C(r(R),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",In,i(w.$t("chat.subPlanExecutions"))+" ("+i(_.subPlanExecutionRecords.length)+") ",1)]),s("div",An,[(p(!0),g(de,null,pe(_.subPlanExecutionRecords,(D,V)=>(p(),he(Ys,{key:D.currentPlanId||V,"sub-plan":D,"sub-plan-index":V,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:F,onStepSelected:O},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2)}),128))])):B("",!0)])}}}),lo=ye(xn,[["__scopeId","data-v-3fdaaeed"]]),Mn={key:0,class:"thinking-section"},Fn={class:"thinking-header"},Dn={class:"thinking-avatar"},Nn={class:"thinking-label"},Un={class:"thinking-content"},Ln={key:0,class:"thinking"},On={key:2,class:"default-processing"},Bn={class:"processing-indicator"},qn=be({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=ue(()=>{var u,h,y,F;return(o.thinking??!1)||(((h=(u=o.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:h.length)??0)>0||(((F=(y=o.planExecution)==null?void 0:y.agentExecutionSequence)==null?void 0:F.length)??0)>0}),l=(u,h)=>{t("agent-selected",u,h)},c=(u,h,y)=>{t("sub-plan-selected",u,h,y)},d=u=>{t("user-input-submitted",u)},m=u=>{t("step-selected",u)};return(u,h)=>a.value?(p(),g("div",Mn,[s("div",Fn,[s("div",Dn,[C(r(R),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Nn,i(u.$t("chat.thinkingLabel")),1)]),s("div",Un,[u.thinking?(p(),g("div",Ln,[C(r(R),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,i(u.thinking),1)])):B("",!0),u.thinkingDetails||u.planExecution?(p(),he(lo,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:l,onSubPlanSelected:c,onUserInputSubmitted:d,onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),g("div",On,[s("div",Bn,[h[0]||(h[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,i(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):B("",!0)])])):B("",!0)}}),jn=ye(qn,[["__scopeId","data-v-1cb833fc"]]),Vn={class:"user-input-form-container"},Gn={class:"user-input-header"},Hn={class:"user-input-title"},Jn={class:"user-input-message"},Wn={key:0,class:"form-description"},zn={key:0,class:"form-grid"},Kn=["for"],Xn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],Yn=["id","name","placeholder","required","onUpdate:modelValue"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","required","onUpdate:modelValue"],oa={value:""},sa=["value"],na={key:6,class:"checkbox-group"},aa=["id","name","value","onUpdate:modelValue"],la={class:"checkbox-label"},ra={key:7,class:"radio-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"radio-label"},da=["id","name","placeholder","required","onUpdate:modelValue"],ua={key:1,class:"form-group"},pa={for:"form-input-genericInput"},ha={type:"submit",class:"submit-user-input-btn"},ma=be({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const o=n,t=e;Me();const a=nt({}),l=N(o.genericInput??""),c=N(!1),d=N(null),m=()=>{var O;const F=(O=o.userInputWaitState)==null?void 0:O.formInputs;F&&F.length>0&&(!c.value||Object.keys(a).length!==F.length)&&(F.forEach((w,b)=>{(!(b in a)||w.type==="checkbox"&&!Array.isArray(a[b])||w.type!=="checkbox"&&a[b]==="")&&(w.type==="checkbox"?a[b]=[]:a[b]="")}),c.value=!0)};Ae(()=>{m()}),me(()=>{var F;return(F=o.userInputWaitState)==null?void 0:F.formInputs},()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{c.value=!1,m()},100)},{deep:!0});const u=async()=>{var F;try{const O={},x=(F=o.userInputWaitState)==null?void 0:F.formInputs;x&&x.length>0?Object.entries(a).forEach(([w,b])=>{const v=parseInt(w,10),$=x[v].label||`input_${w}`;Array.isArray(b)?O[$]=b.join(", "):O[$]=b}):O.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",O,"for planId:",o.planId),o.planId?(await ft.submitFormInput(o.planId,O),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",O)}catch(O){console.error("[UserInputForm] User input submission failed:",O)}},h=F=>F?Array.isArray(F)?F:typeof F=="string"?F.split(",").map(O=>O.trim()).filter(O=>O.length>0):[]:[],y=F=>typeof F=="boolean"?F:typeof F=="string"?F==="true":!1;return xe(()=>{d.value&&clearTimeout(d.value)}),(F,O)=>{var x,w,b,v,E;return p(),g("div",Vn,[s("div",Gn,[C(r(R),{icon:"carbon:user",class:"user-icon"}),s("h4",Hn,i(F.$t("chat.userInputRequired")),1)]),s("p",Jn,i(((x=F.userInputWaitState)==null?void 0:x.title)??F.$t("chat.userInput.message")),1),(w=F.userInputWaitState)!=null&&w.formDescription?(p(),g("p",Wn,i((b=F.userInputWaitState)==null?void 0:b.formDescription),1)):B("",!0),s("form",{onSubmit:Se(u,["prevent"]),class:"user-input-form"},[(v=F.userInputWaitState)!=null&&v.formInputs&&F.userInputWaitState.formInputs.length>0?(p(),g("div",zn,[(p(!0),g(de,null,pe((E=F.userInputWaitState)==null?void 0:E.formInputs,($,_)=>(p(),g("div",{key:_,class:"form-group"},[s("label",{for:`form-input-${$.label.replace(/\W+/g,"_")}`},i($.label)+i(y($.required)?" *":"")+": ",9,Kn),!$.type||$.type==="text"?ie((p(),g("input",{key:0,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Xn)),[[ve,a[_]]]):$.type==="email"?ie((p(),g("input",{key:1,type:"email",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Qn)),[[ve,a[_]]]):$.type==="number"?ie((p(),g("input",{key:2,type:"number",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Yn)),[[ve,a[_]]]):$.type==="password"?ie((p(),g("input",{key:3,type:"password",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Zn)),[[ve,a[_]]]):$.type==="textarea"?ie((p(),g("textarea",{key:4,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-textarea",rows:"4"},null,8,ea)),[[ve,a[_]]]):$.type==="select"&&$.options?ie((p(),g("select",{key:5,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-select"},[s("option",oa,i(F.$t("selectCommon.pleaseSelect")),1),(p(!0),g(de,null,pe(h($.options),f=>(p(),g("option",{key:f,value:f},i(f),9,sa))),128))],8,ta)),[[mt,a[_]]]):$.type==="checkbox"&&$.options?(p(),g("div",na,[(p(!0),g(de,null,pe(h($.options),f=>(p(),g("label",{key:f,class:"checkbox-item"},[ie(s("input",{type:"checkbox",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":k=>a[_]=k,class:"form-checkbox"},null,8,aa),[[Tt,a[_]]]),s("span",la,i(f),1)]))),128))])):$.type==="radio"&&$.options?(p(),g("div",ra,[(p(!0),g(de,null,pe(h($.options),f=>(p(),g("label",{key:f,class:"radio-item"},[ie(s("input",{type:"radio",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":k=>a[_]=k,class:"form-radio"},null,8,ia),[[Lo,a[_]]]),s("span",ca,i(f),1)]))),128))])):ie((p(),g("input",{key:8,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:y($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,da)),[[ve,a[_]]])]))),128))])):(p(),g("div",ua,[s("label",pa,i(F.$t("common.input"))+":",1),ie(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":O[0]||(O[0]=$=>l.value=$),class:"form-input"},null,512),[[ve,l.value]])])),s("button",ha,i(F.$t("chat.userInput.submit")),1)],32)])}}}),fa=ye(ma,[["__scopeId","data-v-fc42d4b8"]]),ga={class:"response-section"},va={class:"response-header"},ba={class:"response-avatar"},ya={class:"response-name"},_a={key:0,class:"response-timestamp"},Sa={class:"response-content"},wa={key:1,class:"final-response"},$a=["innerHTML"],Pa={class:"response-actions"},ka=["title"],Ea=["title"],Ta={key:2,class:"response-placeholder"},Ca={class:"typing-indicator"},Ra={class:"typing-text"},Ia={key:3,class:"response-error"},Aa={class:"error-text"},xa={key:4,class:"response-empty"},Ma={class:"empty-text"},Fa=be({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const o=n,t=e,{formatResponseText:a,formatTimestamp:l}=Ut(),c=async()=>{if(o.content)try{const h=o.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(h),t("copy")}catch(h){console.error("Failed to copy to clipboard:",h)}},d=()=>{t("regenerate")},m=()=>{t("retry")},u=h=>{console.log("[ResponseSection] User input submitted:",h),t("user-input-submitted",h)};return(h,y)=>{var F;return p(),g("div",ga,[s("div",va,[s("div",ba,[C(r(R),{icon:"carbon:bot",class:"bot-icon"})]),s("div",ya,i(h.$t("chat.botName")),1),h.timestamp?(p(),g("div",_a,i(r(l)(h.timestamp)),1)):B("",!0)]),s("div",Sa,[(F=h.userInputWaitState)!=null&&F.waiting?(p(),he(fa,so({key:0,"user-input-wait-state":h.userInputWaitState},h.planId?{"plan-id":h.planId}:{},{"generic-input":h.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):B("",!0),h.content?(p(),g("div",wa,[s("div",{class:"response-text",innerHTML:r(a)(h.content)},null,8,$a),s("div",Pa,[s("button",{class:"action-btn copy-btn",onClick:c,title:h.$t("chat.copyResponse")},[C(r(R),{icon:"carbon:copy"})],8,ka),s("button",{class:"action-btn regenerate-btn",onClick:d,title:h.$t("chat.regenerateResponse")},[C(r(R),{icon:"carbon:renew"})],8,Ea)])])):h.isStreaming?(p(),g("div",Ta,[s("div",Ca,[y[0]||(y[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Ra,i(h.$t("chat.thinkingResponse")),1)])])):h.error?(p(),g("div",Ia,[C(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",Aa,i(h.error),1),s("button",{class:"retry-btn",onClick:m},i(h.$t("chat.retry")),1)])):(p(),g("div",xa,[s("span",Ma,i(h.$t("chat.waitingForResponse")),1)]))])])}}}),Da=ye(Fa,[["__scopeId","data-v-6581a34f"]]),Na={class:"assistant-message"},Ua=be({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=()=>{t("copy",o.message.id)},l=()=>{t("regenerate",o.message.id)},c=()=>{t("retry",o.message.id)},d=(u,h)=>{console.log("[AssistantMessage] User input submitted:",h,"for message:",u.id)},m=u=>{console.log("[AssistantMessage] Step selected:",u),t("step-selected",u)};return(u,h)=>{var y,F,O,x;return p(),g("div",Na,[u.message.thinkingDetails?(p(),he(jn,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:m},null,8,["thinking-details"])):B("",!0),u.message.planExecution?(p(),he(lo,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),u.message.content||u.message.error||u.isStreaming||(F=(y=u.message.planExecution)==null?void 0:y.userInputWaitState)!=null&&F.waiting?(p(),he(Da,so({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(O=u.message.planExecution)!=null&&O.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(x=u.message.planExecution)!=null&&x.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:c,onUserInputSubmitted:h[0]||(h[0]=w=>d(u.message,w))}),null,16,["content","is-streaming","timestamp","generic-input"])):B("",!0)])}}}),La=ye(Ua,[["__scopeId","data-v-3810c279"]]),Oa=be({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,{getMessageClasses:a}=Ut(),l=ue(()=>a(o.message)),c=h=>{t("copy",h)},d=h=>{t("regenerate",h)},m=h=>{t("retry",h)},u=h=>{t("step-selected",h)};return(h,y)=>(p(),g("div",{class:ae(["chat-message",l.value])},[h.message.type==="user"?(p(),he(as,{key:0,message:h.message},null,8,["message"])):h.message.type==="assistant"?(p(),he(La,{key:1,message:h.message,"is-streaming":h.isStreaming||!1,onCopy:c,onRegenerate:d,onRetry:m,onStepSelected:u},null,8,["message","is-streaming"])):B("",!0)],2))}}),Ba=ye(Oa,[["__scopeId","data-v-218b3735"]]);function Ct(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(o=>qa(o))),e}function qa(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(o=>Ct(o))),e}function ja(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=Ct(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=Ct(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function Va(){const n=N([]),e=N(!1),o=N(null),t=N(null),a=ue(()=>n.value.length>0?n.value[n.value.length-1]:null),l=ue(()=>o.value!==null),c=ue(()=>n.value.length>0),d=(_,f,k)=>{const D={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:_,content:f,timestamp:new Date,isStreaming:!1,...k};return n.value.push(D),D},m=(_,f)=>{const k=n.value.findIndex(D=>D.id===_);k!==-1&&(n.value[k]={...n.value[k],...f})},u=_=>{const f=n.value.findIndex(k=>k.id===_);f!==-1&&n.value.splice(f,1)},h=()=>{n.value=[],o.value=null,t.value=null},y=_=>{o.value=_,m(_,{isStreaming:!0})},F=_=>{_&&m(_,{isStreaming:!1}),o.value===_&&(o.value=null)},O=_=>{t.value=_},x=(_,f,k="content")=>{const D=n.value.find(V=>V.id===_);D&&typeof D[k]=="string"&&m(_,{[k]:D[k]+f})},w=(_,f)=>{m(_,{thinkingDetails:f})},b=(_,f)=>{m(_,{thinking:f})},v=(_,f)=>{m(_,{planExecution:f})},E=_=>n.value.find(f=>f.id===_),$=_=>n.value.findIndex(f=>f.id===_);return{messages:tt(n),isLoading:e,streamingMessageId:tt(o),activeMessageId:tt(t),lastMessage:a,isStreaming:l,hasMessages:c,addMessage:d,updateMessage:m,removeMessage:u,clearMessages:h,startStreaming:y,stopStreaming:F,setActiveMessage:O,appendToMessage:x,updateMessageThinking:b,updateMessageThinkingDetails:w,updateMessagePlanExecution:v,findMessage:E,getMessageIndex:$}}function Ga(n){const e=N(!1),o=N(!0),t=150,a=async(b=!0)=>{n.value&&(await Ce(),n.value.scrollTo({top:n.value.scrollHeight,behavior:b?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:b,scrollHeight:v,clientHeight:E}=n.value;return v-b-E<t},c=()=>{if(!n.value)return;const b=l();e.value=!b&&n.value.scrollHeight>n.value.clientHeight,b&&(o.value=!0)},d=()=>{c(),l()||(o.value=!1)},m=async()=>{o.value&&await a()},u=async()=>{o.value=!0,await a()},h=(b,v=!0)=>{if(!n.value)return;const E=n.value.querySelector(`[data-message-id="${b}"]`);E&&E.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},y=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:b,scrollHeight:v,clientHeight:E}=n.value,$=b===0,_=b+E>=v-5,f=v>E?b/(v-E)*100:100;return{scrollTop:b,scrollHeight:v,clientHeight:E,isAtTop:$,isAtBottom:_,scrollPercentage:f}},F=()=>{n.value&&n.value.addEventListener("scroll",d,{passive:!0})},O=()=>{n.value&&n.value.removeEventListener("scroll",d)},x=()=>{F(),c()},w=()=>{O()};return Ae(()=>{Ce(()=>{x()})}),xe(()=>{w()}),{showScrollToBottom:tt(e),isAutoScrollEnabled:tt(o),scrollToBottom:a,autoScrollToBottom:m,forceScrollToBottom:u,scrollToMessage:h,isNearBottom:l,checkScrollPosition:c,getScrollInfo:y,addScrollListener:F,removeScrollListener:O,initializeScrollBehavior:x,cleanupScrollBehavior:w}}const Ge=class Ge{constructor(){ke(this,"POLL_INTERVAL",5e3);ke(this,"state",nt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));ke(this,"callbacks",{});ke(this,"planExecutionCache",new Map);ke(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,o){this.uiStateCache.set(e,o),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,o){this.planExecutionCache.set(e,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const o=this.planExecutionCache.delete(e);return o&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),o}clearAllCachedRecords(){const e=this.planExecutionCache.size,o=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${o}`)}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(o){console.error("[PlanExecutionManager] Failed to send user message:",o);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,o){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:o}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(o??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,o){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,o),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const o=this.state.activePlanId??"ui-state";return this.setCachedUIState(o,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(o),!0}async sendUserMessageAndSetPlanId(e){try{const o=await Go.sendMessage({input:e});if(o!=null&&o.planId)return this.state.activePlanId=o.planId,o;if(o!=null&&o.planTemplateId)return this.state.activePlanId=o.planTemplateId,{...o,planId:o.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",o),new Error("Failed to get valid planId from API response")}catch(o){throw console.error("[PlanExecutionManager] API call failed:",o),o}}initiatePlanExecutionSequence(e,o){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${o}`);const t=o;ot().setTaskRunning(o),console.log("[PlanExecutionManager] Task marked as running with planId:",o),this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();const o=ot();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();const o=ot();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const o=await ft.getDetails(e);return o!=null&&o.rootPlanId&&(this.planExecutionCache.set(o.rootPlanId,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${o.rootPlanId}`)),o}catch(o){return console.error("[PlanExecutionManager] Failed to get plan details:",o),{currentPlanId:e,status:"failed",message:o instanceof Error?o.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};ke(Ge,"instance",null);let Rt=Ge;const Oe=Rt.getInstance(),Ha={class:"chat-container"},Ja={key:0,class:"loading-message"},Wa={class:"loading-content"},za=["title"],Ka=be({__name:"ChatContainer",emits:["step-selected"],setup(n,{expose:e,emit:o}){const t=o,{t:a}=Me(),{messages:l,isLoading:c,streamingMessageId:d,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:y,findMessage:F}=Va(),O=N(null),{scrollToBottom:x,autoScrollToBottom:w,showScrollToBottom:b}=Ga(O),v=N(),E=z=>d.value===z,$=ue(()=>l.value.map(ja)),_=()=>{},f=z=>{const K=z.target;if(K.classList.contains("md-copy-btn")){const ne=K.getAttribute("data-raw");if(ne){const fe=decodeURIComponent(ne);navigator.clipboard.writeText(fe).then(()=>{K.textContent=a("chat.copied"),setTimeout(()=>{K.textContent=a("chat.copy")},1e3)})}}},k=async z=>{const K=F(z);if(K)try{const ne=K.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(ne)}catch(ne){console.error("Failed to copy message:",ne)}},D=z=>{const K=F(z);K&&K.type==="assistant"&&(u(z,{content:""}),h(z))},V=z=>{F(z)&&(u(z,{content:""}),h(z))},T=z=>{console.log("[ChatContainer] Step selected:",z),t("step-selected",z)},M=z=>{console.log("[ChatContainer] Plan update received:",z);const K=Oe.getCachedPlanRecord(z);if(!K){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",z);return}console.log("[ChatContainer] Retrieved plan details from cache:",K);const ne=l.value.findIndex(fe=>{var X;return((X=fe.planExecution)==null?void 0:X.currentPlanId)===K.currentPlanId&&fe.type==="assistant"});if(ne!==-1){const fe=l.value[ne],X={planExecution:JSON.parse(JSON.stringify(K))};if(!K.agentExecutionSequence||K.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),K.completed){X.thinking="";const q=K.summary??K.result??K.message??"Execution completed";X.content=q,console.log("[ChatContainer] Set simple response content:",q)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(fe.id,X)}},G=z=>{if(console.log("[ChatContainer] Plan completed:",z),z.rootPlanId){const K=l.value.findIndex(ne=>{var fe;return((fe=ne.planExecution)==null?void 0:fe.currentPlanId)===z.rootPlanId});if(K!==-1){const ne=l.value[K],fe=z.summary??z.result??"Execution completed";u(ne.id,{thinking:"",content:fe}),console.log("[ChatContainer] Updated completed message:",fe)}}},Y=z=>{console.log("[ChatContainer] Dialog round start:",z)},Q=z=>{console.log("[ChatContainer] Plan error:",z),m("assistant",`Error: ${z}`),console.error("[ChatContainer] Plan execution error:",z)};return Ae(()=>{me(l,()=>{Ce(()=>{w()})},{deep:!0}),Oe.setEventCallbacks({onPlanUpdate:M,onPlanCompleted:G,onDialogRoundStart:Y,onPlanError:Q})}),xe(()=>{v.value&&clearInterval(v.value)}),e({scrollToBottom:x,handlePlanUpdate:M,handlePlanCompleted:G,handleDialogRoundStart:Y,handlePlanError:Q,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:y}),(z,K)=>(p(),g("div",Ha,[s("div",{class:"messages",ref_key:"messagesRef",ref:O,onScroll:_,onClick:f},[(p(!0),g(de,null,pe($.value,ne=>(p(),he(Ba,{key:ne.id,message:ne,"is-streaming":E(ne.id),onCopy:k,onRegenerate:D,onRetry:V,onStepSelected:T},null,8,["message","is-streaming"]))),128)),r(c)?(p(),g("div",Ja,[s("div",Wa,[C(r(R),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,i(z.$t("chat.processing")),1)])])):B("",!0)],544),C(Nt,{name:"scroll-button"},{default:Ke(()=>[r(b)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:K[0]||(K[0]=()=>r(x)()),title:z.$t("chat.scrollToBottom")},[C(r(R),{icon:"carbon:chevron-down"})],8,za)):B("",!0)]),_:1})]))}}),Xa=ye(Ka,[["__scopeId","data-v-3aa5b9a4"]]);class Ne{static async getAllCoordinatorTools(){try{const e=await fetch(`${this.BASE_URL}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tools: ${e.status}`);return await e.json()||[]}catch(e){throw console.error("Failed to get coordinator tools:",e),new Error("Failed to get coordinator tools: "+e.message)}}static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolByTemplate(e){console.log("[CoordinatorToolApiService] Getting coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/by-template/${e}`);try{const o=await fetch(`${this.BASE_URL}/by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",o.status),!o.ok){const l=await o.text();throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to get coordinator tool: ${o.status} - ${l}`)}const t=await o.text();if(!t||t.trim()==="")return console.log("[CoordinatorToolApiService] Tool not found for planTemplateId (empty response):",e),null;let a;try{a=JSON.parse(t)}catch(l){return console.error("[CoordinatorToolApiService] Failed to parse JSON response:",l),null}return a===null||typeof a=="object"&&Object.keys(a).length===0?(console.log("[CoordinatorToolApiService] Tool not found for planTemplateId:",e),null):(console.log("[CoordinatorToolApiService] Successfully got coordinator tool:",a),a)}catch(o){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",o),new Error("Failed to get coordinator tool: "+o.message)}}static createDefaultCoordinatorTool(e,o,t){return{toolName:o?`tool_${o}`:"",toolDescription:t??"",planTemplateId:e,inputSchema:"[]",serviceGroup:"",enableInternalToolcall:!1,enableHttpService:!1,enableMcpService:!1}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const o={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(o,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let l="Unknown error";try{const c=await t.json();l=c.message||c.error||l}catch{l=await t.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${t.status} - ${l}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,o){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",o),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:o.id,toolName:o.toolName,toolDescription:o.toolDescription,inputSchema:o.inputSchema,planTemplateId:o.planTemplateId,httpEndpoint:o.httpEndpoint,mcpEndpoint:o.mcpEndpoint,serviceGroup:o.serviceGroup,enableInternalToolcall:o.enableInternalToolcall,enableHttpService:o.enableHttpService,enableMcpService:o.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let c="Unknown error";try{const d=await a.json();c=d.message||d.error||c}catch{c=await a.text()||c}throw console.error("[CoordinatorToolApiService] Response error content:",c),new Error(`Failed to update coordinator tool: ${a.status} - ${c}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){const a=await o.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${o.status} - ${a}`)}const t=await o.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(o){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",o),new Error("Failed to delete coordinator tool: "+o.message)}}}ke(Ne,"BASE_URL","/api/coordinator-tools");class jt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const o=new FormData;e.forEach(l=>{o.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:o});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(o){throw console.error("[FileUploadApiService] Error uploading files:",o),o}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(o){throw console.error("[FileUploadApiService] Error getting uploaded files:",o),o}}static async deleteFile(e,o){try{console.log("[FileUploadApiService] Deleting file:",o,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(o)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",o),o}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Qa={class:"file-upload-component"},Ya=["accept"],Za={key:0},el={key:1},tl={key:0,class:"files-list"},ol={class:"file-name"},sl={class:"file-size"},nl=["onClick","title"],al={key:0,class:"upload-progress"},ll=be({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:o}){const{t}=Me(),a=n,l=o,c=N(),d=N([]),m=N(!1),u=N(null),h=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],u.value=null,l("upload-key-changed",null)};xe(()=>{h()}),me(()=>d.value,b=>{l("files-removed",b)},{deep:!0});const y=()=>{a.disabled||c.value&&c.value.click()},F=async b=>{const v=b.target,E=v.files;if(!E||E.length===0)return;const $=Array.from(E);console.log("[FileUpload] Selected files for upload:",$.map(_=>_.name)),await O($),v.value=""},O=async b=>{if(b.length!==0){m.value=!0,l("upload-started");try{const v=await jt.uploadFiles(b);v.success&&(!u.value&&v.uploadKey?(u.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",u.value),d.value=v.uploadedFiles):u.value?(console.log("[FileUpload] Using existing uploadKey:",u.value),d.value=[...d.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=v.uploadedFiles),v.uploadKey&&(u.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",u.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,u.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{m.value=!1}}},x=async b=>{try{if(console.log(" Removing file:",b.originalName,"from uploadKey:",u),u.value){const v=await jt.deleteFile(u.value,b.originalName);v.success?console.log(" File deleted from server successfully"):console.error(" Failed to delete file from server:",v.error)}d.value=d.value.filter(v=>v.originalName!==b.originalName),d.value.length===0&&(console.log("[FileUpload]  Clearing uploadKey to force new plan for new files"),u.value=null,l("upload-key-changed",null)),console.log(" File removal completed, remaining files:",d.value.length)}catch(v){console.error(" Error removing file:",v),l("upload-error",v)}},w=b=>{if(b===0)return"0 Bytes";const v=1024,E=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(b)/Math.log(v));return parseFloat((b/Math.pow(v,$)).toFixed(2))+" "+E[$]};return e({uploadedFiles:d,uploadKey:u,resetSession:h,uploadFiles:O,removeFile:x,isUploading:m}),(b,v)=>(p(),g("div",Qa,[s("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:F,accept:b.acceptedFileTypes||""},null,40,Ya),s("div",{class:ae(["uploaded-files",{"has-files":d.value.length>0}])},[s("div",{class:"files-header",onClick:y},[C(r(R),{icon:"carbon:attachment"}),d.value.length===0?(p(),g("span",Za,i(r(t)("input.attachFile")),1)):(p(),g("span",el,i(r(t)("input.attachedFiles"))+" ("+i(d.value.length)+")",1))]),d.value.length>0?(p(),g("div",tl,[(p(!0),g(de,null,pe(d.value,E=>(p(),g("div",{key:E.originalName,class:"file-item"},[C(r(R),{icon:"carbon:document",class:"file-icon"}),s("span",ol,i(E.originalName),1),s("span",sl,"("+i(w(E.size))+")",1),s("button",{onClick:$=>x(E),class:"remove-btn",title:r(t)("input.removeFile")},[C(r(R),{icon:"carbon:close"})],8,nl)]))),128))])):B("",!0)],2),m.value?(p(),g("div",al,[C(r(R),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,i(r(t)("input.uploading")),1)])):B("",!0)]))}}),ro=ye(ll,[["__scopeId","data-v-d1f7078c"]]);class rl{constructor(){ke(this,"isCollapsed",!1);ke(this,"selectMemoryId","");ke(this,"loadMessages",()=>{});ke(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Be=nt(new rl),il={class:"input-area"},cl={class:"input-container"},dl={class:"input-row-first"},ul=["placeholder","disabled"],pl={class:"input-row-second"},hl=["title","disabled"],ml={value:""},fl=["value"],gl=["title"],vl=["disabled","title"],bl=["title"],yl=be({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""},selectionOptions:{default:()=>[]}},emits:["send","clear","update-state","plan-mode-clicked","selection-changed"],setup(n,{expose:e,emit:o}){const{t}=Me(),a=ot(),l=ue(()=>a.hasRunningTask()),c=n,d=o,m=N(),u=N(),h=N(""),y=ue(()=>c.placeholder||t("input.placeholder")),F=N(y.value),O=N([]),x=N(null),w=N(""),b=N([]),v=N(!1),E=async()=>{v.value=!0;try{console.log("[InputArea] Loading inner tools...");const U=await Ne.getAllCoordinatorTools(),A=[];for(const Z of U)if(Z.enableInternalToolcall)try{const P=JSON.parse(Z.inputSchema||"[]");if(Array.isArray(P)&&P.length===1){const W=P[0];A.push({value:Z.planTemplateId,label:`${Z.toolName} (${W.name})`,toolName:Z.toolName,planTemplateId:Z.planTemplateId,paramName:W.name})}}catch(P){console.warn("[InputArea] Failed to parse inputSchema for tool:",Z.toolName,P)}b.value=A,console.log("[InputArea] Loaded",A.length,"inner tools with single parameter");const L=localStorage.getItem("inputAreaSelectedTool");L&&(A.some(P=>P.value===L)?(w.value=L,console.log("[InputArea] Restored selected tool from localStorage:",L)):(console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),w.value=""))}catch(U){console.error("[InputArea] Failed to load inner tools:",U),b.value=[]}finally{v.value=!1}},$=ue(()=>b.value.length>0?b.value.map(U=>({value:U.value,label:U.label})):c.selectionOptions);me(w,U=>{d("selection-changed",U),localStorage.setItem("inputAreaSelectedTool",U||"")}),Ae(()=>{E()});const _=()=>{var U;console.log("[FileUpload] Resetting session and clearing uploadKey"),(U=u.value)==null||U.resetSession()};xe(()=>{_()});const f=(U,A)=>{O.value=U.map(L=>L.originalName),x.value=A,console.log("[InputArea] Files uploaded:",U.length,"uploadKey:",A),O.value.length>0&&(F.value=t("input.filesAttached",{count:O.value.length}))},k=U=>{O.value=U.map(A=>A.originalName),console.log("[InputArea] Files removed, remaining:",U.length),O.value.length===0?F.value=y.value:F.value=t("input.filesAttached",{count:O.value.length})},D=U=>{x.value=U,console.log("[InputArea] Upload key changed:",U)},V=()=>{console.log("[InputArea] Upload started")},T=()=>{console.log("[InputArea] Upload completed")},M=U=>{console.error("[InputArea] Upload error:",U)},G=ue(()=>!!c.disabled),Y=()=>{Ce(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=Math.min(m.value.scrollHeight,120)+"px")})},Q=U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),z())},z=async()=>{if(!h.value.trim()||G.value)return;const U=h.value.trim(),A={input:U,memoryId:Be.selectMemoryId,uploadedFiles:O.value};if(x.value?(A.uploadKey=x.value,console.log("[InputArea] Including uploadKey in message:",x.value)):console.log("[InputArea] No uploadKey available for message"),w.value){const L=b.value.find(Z=>Z.value===w.value);L&&(A.toolName=L.planTemplateId,A.replacementParams={[L.paramName]:U},console.log("[InputArea] Sending message with tool:",L.toolName))}d("send",A),fe()},K=()=>{d("plan-mode-clicked")},ne=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},fe=()=>{h.value="",Y(),d("clear")},X=(U,A)=>{A&&(F.value=U?A:t("input.waiting")),d("update-state",U,A)},q=U=>{h.value=U,Y()},j=()=>h.value.trim();return me(()=>c.initialValue,U=>{U.trim()&&(h.value=U,Y())},{immediate:!0}),e({clearInput:fe,updateState:X,setInputValue:q,getQuery:j,resetSession:_,focus:()=>{var U;return(U=m.value)==null?void 0:U.focus()},get uploadedFiles(){var U,A;return((A=(U=u.value)==null?void 0:U.uploadedFiles)==null?void 0:A.map(L=>L.originalName))||[]},get uploadKey(){var U;return((U=u.value)==null?void 0:U.uploadKey)||null}}),Ae(()=>{}),xe(()=>{}),(U,A)=>(p(),g("div",il,[C(ro,{ref_key:"fileUploadRef",ref:u,disabled:G.value,onFilesUploaded:f,onFilesRemoved:k,onUploadKeyChanged:D,onUploadStarted:V,onUploadCompleted:T,onUploadError:M},null,8,["disabled"]),s("div",cl,[s("div",dl,[ie(s("textarea",{"onUpdate:modelValue":A[0]||(A[0]=L=>h.value=L),ref_key:"inputRef",ref:m,class:"chat-input",placeholder:F.value,disabled:G.value,onKeydown:Q,onInput:Y},null,40,ul),[[ve,h.value]])]),s("div",pl,[ie(s("select",{"onUpdate:modelValue":A[1]||(A[1]=L=>w.value=L),class:"selection-input",title:U.$t("input.selectionTitle"),disabled:v.value||G.value},[s("option",ml,i(U.$t("input.defaultFuncAgent")),1),(p(!0),g(de,null,pe($.value,L=>(p(),g("option",{key:L.value,value:L.value},i(L.label),9,fl))),128))],8,hl),[[mt,w.value]]),s("button",{class:"plan-mode-btn",title:U.$t("input.planMode"),onClick:K},[C(r(R),{icon:"carbon:document"}),le(" "+i(U.$t("input.planMode")),1)],8,gl),l.value?(p(),g("button",{key:1,class:"send-button stop-button",onClick:ne,title:U.$t("input.stop")},[C(r(R),{icon:"carbon:stop-filled"}),le(" "+i(U.$t("input.stop")),1)],8,bl)):(p(),g("button",{key:0,class:"send-button",disabled:!h.value.trim()||G.value,onClick:z,title:U.$t("input.send")},[C(r(R),{icon:"carbon:send-alt"}),le(" "+i(U.$t("input.send")),1)],8,vl))])])]))}}),_l=ye(yl,[["__scopeId","data-v-d9e8df59"]]);class rt{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const o=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(o)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(o){throw console.error("Failed to get memory:",o),o}}static async createMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(o)}catch(o){throw console.error("Failed to delete memory:",o),o}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}ke(rt,"BASE_URL","/api/memories");const Sl={key:0,class:"app-container"},wl={class:"app-content"},$l={class:"header"},Pl={class:"relative"},kl={class:"title-edit-group"},El={id:"main-title",class:"main-title"},Tl={key:0,id:"title-edit-container",class:"title-edit-container"},Cl={class:"search-bar"},Rl={class:"search-container"},Il=["placeholder"],Al={class:"message-list",id:"message-list"},xl={class:"message-header"},Ml={class:"message-content"},Fl={class:"sender-info"},Dl=["onClick"],Nl={class:"sender-name"},Ul=["onClick"],Ll={class:"action-buttons"},Ol=["onClick"],Bl={class:"action-buttons"},ql=["onClick"],jl={class:"message-preview"},Vl={class:"preview-line"},Gl={key:0,class:"preview-line",style:{opacity:"0.8"}},Hl={class:"message-meta"},Jl={class:"message-id"},Wl={class:"meta-right"},zl={key:0,class:"unread-count"},Kl={class:"message-time"},Xl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Yl={class:"bubble-avatar"},Zl={class:"bubble-content"},er={class:"bubble-text"},tr={key:0,class:"empty-state"},or={class:"modal-content"},sr={class:"modal-header"},nr={class:"modal-title"},ar=["placeholder"],lr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},rr={class:"modal-footer"},ir={class:"modal-content"},cr={class:"modal-header"},dr={class:"modal-title"},ur={class:"state-text",id:"delete-message"},pr={class:"modal-footer"},hr=be({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const o=N(!1),t=N(""),a=N([]),l=N([]),c=N(!1),d=N(null),m=N(""),u=N(!1),h=N(null),y=new Map,F=e,O=T=>{T.key==="Escape"&&(u.value?D():c.value&&$())};Ae(()=>{Be.setLoadMessages(x),document.addEventListener("keydown",O)}),xe(()=>{document.removeEventListener("keydown",O)});const x=async()=>{try{const T=await rt.getMemories();a.value=T.map(M=>({...M,expanded:y.has(M.conversation_id)?y.get(M.conversation_id):!1})),l.value=[...a.value],v()}catch(T){console.error("error:",T),a.value=[],l.value=[]}},w=T=>{Be.selectMemory(T),F("memory-selected")},b=T=>{const M=typeof T=="string"?parseInt(T,10):T;return isNaN(M)||M<=0?"unknow time":new Date(M.toString().length===13?M:M*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const T=t.value.toLowerCase().trim();if(!T){l.value=[...a.value];return}l.value=a.value.filter(M=>{var z;const G=M.memory_name.toLowerCase().includes(T),Y=M.conversation_id.toLowerCase().includes(T),Q=((z=M.messages)==null?void 0:z.some(K=>K.text.toLowerCase().includes(T)))??!1;return G||Y||Q})},E=(T,M)=>{d.value=T,m.value=M,c.value=!0},$=()=>{c.value=!1,d.value=null},_=async()=>{if(!d.value)return;const T=m.value.trim()||"unknow name",M=a.value.findIndex(G=>G.conversation_id===d.value);if(M!==-1){const G=a.value[M];try{const Y=await rt.updateMemory(G.conversation_id,T);Y.messages||(Y.messages=[]),a.value[M]={...Y,expanded:G.expanded},v(),c.value=!1}catch(Y){console.error("error:",Y)}}},f=T=>{const M=a.value.find(G=>G.conversation_id===T);if(M){M.expanded=!M.expanded,y.set(T,M.expanded);const G=l.value.findIndex(Y=>Y.conversation_id===T);G!==-1&&(l.value[G]={...M})}},k=T=>{h.value=T,u.value=!0},D=()=>{u.value=!1,h.value=null},V=async()=>{if(h.value)try{await rt.deleteMemory(h.value),a.value=a.value.filter(T=>T.conversation_id!==h.value),v(),a.value.length===0&&Be.clearMemoryId(),u.value=!1,h.value=null}catch(T){console.error("error:",T)}};return(T,M)=>(p(),he(Oo,{to:"body"},[C(Nt,{name:"modal"},{default:Ke(()=>[r(Be).isCollapsed?(p(),g("div",Sl,[s("div",wl,[s("div",$l,[s("div",Pl,[s("div",kl,[s("h1",El,[s("span",null,i(T.$t("memory.title")),1)])]),o.value?(p(),g("div",Tl)):B("",!0)]),s("button",{class:"close-btn",onClick:M[0]||(M[0]=G=>r(Be).toggleSidebar())},[C(r(R),{icon:"carbon:close"})])]),s("div",Cl,[s("div",Rl,[C(r(R),{class:"search-container-icon",icon:"carbon:search"}),ie(s("input",{type:"text",placeholder:T.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":M[1]||(M[1]=G=>t.value=G),onInput:v},null,40,Il),[[ve,t.value]])])]),s("div",Al,[s("div",null,[(p(!0),g(de,null,pe(l.value,G=>(p(),g("div",{class:ae(["message-item",{expanded:G.expanded}]),key:G.conversation_id},[s("div",xl,[s("div",Ml,[s("div",Fl,[s("div",{class:"sender-div",onClick:Se(Y=>w(G.conversation_id),["stop"])},[s("h3",Nl,i(G.memory_name),1)],8,Dl),s("div",{class:"toggle-container",onClick:Se(Y=>E(G.conversation_id,G.memory_name),["stop"])},[C(r(R),{icon:"carbon:edit",class:"edit-btn"})],8,Ul),s("div",Ll,[s("button",{class:"delete-btn",onClick:Se(Y=>f(G.conversation_id),["stop"])},[C(r(R),{id:"toggle-"+G.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Ol)]),s("div",Bl,[s("button",{class:"delete-btn",onClick:Se(Y=>k(G.conversation_id),["stop"])},[C(r(R),{icon:"carbon:delete"})],8,ql)])]),s("div",jl,[s("p",Vl,i(G.messages&&G.messages.length>0?G.messages[0].text:"none message"),1),G.messages&&G.messages.length>1?(p(),g("p",Gl,i(G.messages[1].text),1)):B("",!0)]),s("div",Hl,[s("span",Jl,"ID: "+i(G.conversation_id),1),s("div",Wl,[G.messages&&G.messages.length>0?(p(),g("span",zl,i(G.messages.length)+" "+i(T.$t("memory.size")),1)):B("",!0),s("span",Kl,i(b(G.create_time)),1)])])])]),G.expanded?(p(),g("div",{key:0,id:"content-"+G.conversation_id,class:"expanded-content"},[s("div",Ql,[(p(!0),g(de,null,pe(G.messages,(Y,Q)=>(p(),g("div",{class:"message-bubble",key:Q},[s("div",Yl,i(Y.messageType),1),s("div",Zl,[s("p",er,i(Y.text),1)])]))),128))])],8,Xl)):B("",!0)],2))),128))]),l.value.length===0&&t.value?(p(),g("div",tr,M[3]||(M[3]=[s("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),c.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:Se($,["self"])},[s("div",or,[s("div",sr,[s("h3",nr,i(T.$t("memory.changeName")),1),ie(s("input",{type:"text","onUpdate:modelValue":M[2]||(M[2]=G=>m.value=G),class:"edit-input",placeholder:T.$t("memory.newNamePlaceholder")},null,8,ar),[[ve,m.value]]),s("span",lr,i(m.value.length),1)]),s("div",rr,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:$},i(T.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:_},i(T.$t("memory.save")),1)])])])):B("",!0),u.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:Se(D,["self"])},[s("div",ir,[s("div",cr,[s("h3",dr,i(T.$t("memory.deleteHint")),1),s("p",ur,i(T.$t("memory.deleteHintPrefix"))+" "+i(h.value)+" "+i(T.$t("memory.deleteHintSuffix")),1)]),s("div",pr,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:D},i(T.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:V},i(T.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),mr=ye(hr,[["__scopeId","data-v-4dca2d9f"]]),fr="/api/executor";async function io(n){try{const e=await fetch(`${fr}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function gr(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),io(n)}class Ve{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const o=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(o)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(o){throw console.error("Failed to get file tree:",o),o}}static async getFileContent(e,o){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(o)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,o,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(o)}`);await this.handleResponse(a);const l=await a.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=t??o.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,o){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(c=>e.startsWith(c)))return!0;const l=o.toLowerCase();return a.some(c=>l.endsWith(c))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const o=e.name.toLowerCase();return o.endsWith(".js")?"vscode-icons:file-type-js":o.endsWith(".ts")?"vscode-icons:file-type-typescript":o.endsWith(".vue")?"vscode-icons:file-type-vue":o.endsWith(".java")?"vscode-icons:file-type-java":o.endsWith(".py")?"vscode-icons:file-type-python":o.endsWith(".json")?"vscode-icons:file-type-json":o.endsWith(".xml")?"vscode-icons:file-type-xml":o.endsWith(".html")?"vscode-icons:file-type-html":o.endsWith(".css")?"vscode-icons:file-type-css":o.endsWith(".md")?"vscode-icons:file-type-markdown":o.endsWith(".yml")||o.endsWith(".yaml")?"vscode-icons:file-type-yaml":o.endsWith(".pdf")?"vscode-icons:file-type-pdf2":o.endsWith(".doc")||o.endsWith(".docx")?"vscode-icons:file-type-word":o.endsWith(".xls")||o.endsWith(".xlsx")?"vscode-icons:file-type-excel":o.endsWith(".ppt")||o.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":o.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":o.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}ke(Ve,"BASE_URL","/api/file-browser");const vr={class:"file-tree-node"},br={class:"node-icon"},yr={class:"node-name"},_r={key:1,class:"file-size"},Sr={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=be({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const o=n,t=e,a=N(o.level===0),l=N(!1),c=N(!1),d=N({}),m=()=>{o.node.type==="directory"&&(a.value=!a.value)},u=()=>{o.node.type==="directory"?m():h()},h=()=>{o.node.type==="file"&&t("file-selected",o.node),O()},y=()=>{t("download-file",o.node),O()},F=v=>{v.preventDefault(),c.value=!0,d.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",O)},0)},O=()=>{c.value=!1,document.removeEventListener("click",O)},x=async()=>{try{await navigator.clipboard.writeText(o.node.path)}catch(v){console.error("Failed to copy path:",v)}O()},w=()=>o.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ve.getFileIcon(o.node),b=v=>{if(v===0)return"0 B";const E=1024,$=["B","KB","MB","GB"],_=Math.floor(Math.log(v)/Math.log(E));return parseFloat((v/Math.pow(E,_)).toFixed(1))+" "+$[_]};return xe(()=>{document.removeEventListener("click",O)}),(v,E)=>{const $=oo("FileTreeNode",!0);return p(),g("div",vr,[s("div",{class:ae(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:ze({paddingLeft:`${v.level*16+12}px`}),onClick:u,onContextmenu:Se(F,["prevent"])},[v.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:Se(m,["stop"])},[C(r(R),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),s("div",br,[C(r(R),{icon:w()},null,8,["icon"])]),s("span",yr,i(v.node.name),1),v.node.type==="file"?(p(),g("span",_r,i(b(v.node.size)),1)):B("",!0),l.value?(p(),g("div",Sr,[v.node.type==="file"?(p(),g("button",{key:0,onClick:E[0]||(E[0]=Se(_=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[C(r(R),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(p(),g("div",wr,[(p(!0),g(de,null,pe(v.node.children,_=>(p(),he($,{key:_.path,node:_,level:v.level+1,onFileSelected:E[1]||(E[1]=f=>v.$emit("file-selected",f)),onDownloadFile:E[2]||(E[2]=f=>v.$emit("download-file",f))},null,8,["node","level"]))),128))])):B("",!0),c.value?(p(),g("div",{key:1,class:"context-menu",style:ze(d.value),onClick:E[3]||(E[3]=Se(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:h},[C(r(R),{icon:"carbon:view"}),E[4]||(E[4]=s("span",null,"Open",-1))]),v.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:y},[C(r(R),{icon:"carbon:download"}),E[5]||(E[5]=s("span",null,"Download",-1))])):B("",!0),E[7]||(E[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:x},[C(r(R),{icon:"carbon:copy"}),E[6]||(E[6]=s("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),Pr=ye($r,[["__scopeId","data-v-e4a376d5"]]),kr={class:"file-browser"},Er={class:"file-browser-header"},Tr={class:"header-actions"},Cr=["disabled","title"],Rr={class:"file-browser-content"},Ir={class:"file-tree-panel"},Ar={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Mr={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Dr={class:"tips"},Nr=["disabled"],Ur={key:1,class:"actual-error"},Lr={key:2,class:"empty-state"},Or={key:3,class:"file-tree"},Br={key:0,class:"file-content-panel"},qr={class:"file-content-header"},jr={class:"file-info"},Vr={class:"file-name"},Gr={class:"file-size"},Hr={class:"file-actions"},Jr=["title"],Wr=["title"],zr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Xr={key:1,class:"content-error"},Qr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Zr={key:1,class:"binary-content"},ei=be({__name:"index",props:{planId:{}},setup(n){const e=n,{t:o}=Me(),t=N(!1),a=N(null),l=N(null),c=N(null),d=N(null),m=N(!1),u=N(null),h=N(null),y=ue(()=>!d.value||!c.value?!1:Ve.isTextFile(d.value.mimeType,c.value.name)),F=ue(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),O=()=>{h.value&&(clearTimeout(h.value),h.value=null)},x=()=>{O(),h.value=window.setTimeout(()=>{F.value&&w()},5e3)},w=async()=>{if(e.planId){t.value=!0,a.value=null,O();try{l.value=await Ve.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:o("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const k=f instanceof Error?f.message:"";(k.includes("Plan directory not found")||k.includes("not found"))&&x()}finally{t.value=!1}}},b=async f=>{if(f.type!=="directory"){c.value=f,d.value=null,m.value=!0,u.value=null;try{d.value=await Ve.getFileContent(e.planId,f.path)}catch(k){u.value=k instanceof Error?k.message:o("fileBrowser.contentLoadError"),console.error("Failed to load file content:",k)}finally{m.value=!1}}},v=async f=>{try{await Ve.downloadFile(e.planId,f.path,f.name)}catch(k){console.error("Failed to download file:",k)}},E=()=>{c.value=null,d.value=null,u.value=null},$=f=>Ve.getFileIcon(f),_=f=>{if(f===0)return"0 B";const k=1024,D=["B","KB","MB","GB"],V=Math.floor(Math.log(f)/Math.log(k));return parseFloat((f/Math.pow(k,V)).toFixed(1))+" "+D[V]};return me(()=>e.planId,f=>{f&&(c.value=null,d.value=null,w())},{immediate:!0}),Ae(()=>{e.planId&&w()}),xe(()=>{O()}),(f,k)=>(p(),g("div",kr,[s("div",Er,[s("h3",null,i(f.$t("fileBrowser.title")),1),s("div",Tr,[s("button",{class:"refresh-btn",onClick:w,disabled:t.value,title:f.$t("fileBrowser.refresh")},[C(r(R),{icon:"carbon:refresh",class:ae({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Cr)])]),s("div",Rr,[s("div",Ir,[t.value?(p(),g("div",Ar,[C(r(R),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",xr,[F.value?(p(),g("div",Mr,[C(r(R),{icon:"carbon:time",class:"rotating"}),s("div",Fr,[s("h3",null,i(f.$t("fileBrowser.waitingForGeneration")),1),s("p",null,i(f.$t("fileBrowser.planExecuting")),1),s("div",Dr,[C(r(R),{icon:"carbon:information"}),s("span",null,i(f.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:w,class:"retry-btn",disabled:t.value},[C(r(R),{icon:"carbon:refresh",class:ae({rotating:t.value})},null,8,["class"]),le(" "+i(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Nr)])):(p(),g("div",Ur,[C(r(R),{icon:"carbon:warning"}),s("span",null,i(a.value),1),s("button",{onClick:w,class:"retry-btn"},i(f.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",Or,[C(Pr,{node:l.value,level:0,onFileSelected:b,onDownloadFile:v},null,8,["node"])])):(p(),g("div",Lr,[C(r(R),{icon:"carbon:folder-off"}),s("span",null,i(f.$t("fileBrowser.noFiles")),1)]))]),c.value?(p(),g("div",Br,[s("div",qr,[s("div",jr,[C(r(R),{icon:$(c.value)},null,8,["icon"]),s("span",Vr,i(c.value.name),1),s("span",Gr,"("+i(_(c.value.size))+")",1)]),s("div",Hr,[s("button",{onClick:k[0]||(k[0]=D=>v(c.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[C(r(R),{icon:"carbon:download"})],8,Jr),s("button",{onClick:E,class:"close-btn",title:f.$t("common.close")},[C(r(R),{icon:"carbon:close"})],8,Wr)])]),s("div",zr,[m.value?(p(),g("div",Kr,[C(r(R),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),g("div",Xr,[C(r(R),{icon:"carbon:warning"}),s("span",null,i(u.value),1)])):d.value?(p(),g("div",Qr,[y.value?(p(),g("div",Yr,[s("pre",null,[s("code",null,i(d.value.content),1)])])):(p(),g("div",Zr,[C(r(R),{icon:"carbon:document-unknown"}),s("p",null,i(f.$t("fileBrowser.binaryFile")),1),s("button",{onClick:k[1]||(k[1]=D=>v(c.value)),class:"download-btn-large"},[C(r(R),{icon:"carbon:download"}),le(" "+i(f.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),ti=ye(ei,[["__scopeId","data-v-e7c74fe4"]]),oi={class:"right-panel"},si={class:"preview-header"},ni={class:"preview-tabs"},ai={class:"preview-content"},li={key:0,class:"step-details"},ri={key:0,class:"step-info"},ii={key:0,class:"agent-info"},ci={class:"info-item"},di={class:"label"},ui={class:"value"},pi={class:"info-item"},hi={class:"label"},mi={class:"value"},fi={class:"info-item"},gi={class:"label"},vi={class:"execution-status"},bi={class:"status-item"},yi={class:"status-text"},_i={key:0},Si={key:0,class:"think-act-steps"},wi={class:"steps-container"},$i={class:"step-header"},Pi={class:"step-number"},ki={class:"think-section"},Ei={class:"think-content"},Ti={class:"input"},Ci={class:"label"},Ri={class:"output"},Ii={class:"label"},Ai={key:0,class:"action-section"},xi={class:"action-content"},Mi={class:"tool-info"},Fi={class:"label"},Di={class:"value"},Ni={class:"input"},Ui={class:"label"},Li={class:"output"},Oi={class:"label"},Bi={key:0,class:"sub-plan-section"},qi={class:"sub-plan-content"},ji={class:"sub-plan-header"},Vi={class:"sub-plan-info"},Gi={class:"label"},Hi={class:"value"},Ji={key:0,class:"sub-plan-info"},Wi={class:"label"},zi={class:"value"},Ki={class:"sub-plan-status"},Xi={class:"status-text"},Qi={key:0,class:"no-steps-message"},Yi={key:1,class:"no-execution-message"},Zi={class:"step-basic-info"},ec={class:"info-item"},tc={class:"label"},oc={class:"value"},sc={key:0,class:"info-item"},nc={class:"label"},ac={class:"value"},lc={class:"info-item"},rc={class:"label"},ic={class:"no-execution-hint"},cc={key:2,class:"execution-indicator"},dc={class:"execution-text"},uc={key:1,class:"no-selection"},pc=["title"],hc={key:1,class:"file-browser-container"},mc={key:1,class:"no-plan-message"},fc={class:"message-content"},gc={class:"tips"},vc=be({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const o=n,{t}=Me(),a=N(),l=N(),c=N("details"),d=N(localStorage.getItem("jmanus-last-plan-id")),m=N(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=N(!1),h=N(!0),y=N(!0),F=ue(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),O=ue(()=>o.currentRootPlanId?o.currentRootPlanId:d.value),x=ue(()=>!O.value&&!m.value),w=async T=>{var M,G,Y;if(console.log("[RightPanel] Step selected:",{stepId:T}),!T){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const Q=await io(T);if(!Q){console.warn("[RightPanel] Agent execution detail not found for stepId:",T),l.value=null;return}const z={stepId:T,title:Q.agentName??`Step ${T}`,description:Q.agentDescription??"",agentExecution:Q,completed:Q.status==="FINISHED",current:Q.status==="RUNNING"};l.value=z,console.log("[RightPanel] Step details updated:",z),console.log("[RightPanel] activeTab:",c.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(M=l.value.agentExecution)==null?void 0:M.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Y=(G=l.value.agentExecution)==null?void 0:G.thinkActSteps)==null?void 0:Y.length),await Ce(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{E()},100),_()}catch(Q){console.error("[RightPanel] Error fetching step details:",Q),l.value=null}},b=async()=>{var T;if(!((T=l.value)!=null&&T.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const M=await gr(l.value.stepId);M&&(l.value.agentExecution=M,l.value.completed=M.status==="FINISHED",l.value.current=M.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),_())}catch(M){console.error("[RightPanel] Error refreshing step:",M)}};me(()=>o.selectedStepId,async T=>{T?await w(T):l.value=null},{immediate:!0});const v=T=>{a.value=T??void 0},E=()=>{if(!a.value)return;const{scrollTop:T,scrollHeight:M,clientHeight:G}=a.value,Y=M-T-G<50,Q=M>G;h.value=Y,u.value=Q&&!Y,Y?y.value=!0:M-T-G>100&&(y.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:T,scrollHeight:M,clientHeight:G,isAtBottom:Y,hasScrollableContent:Q,showButton:u.value,shouldAutoScroll:y.value})},$=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Ce(()=>{y.value=!0,E()}))},_=()=>{!y.value||!a.value||Ce(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=T=>{if(T===null||typeof T>"u"||T==="")return"N/A";try{const M=typeof T=="object"?T:JSON.parse(T);return JSON.stringify(M,null,2)}catch{return String(T)}},k=()=>{l.value=null,y.value=!0,a.value&&a.value.removeEventListener("scroll",E)},D=()=>{const T=()=>{const M=a.value;return M?(v(M),M.addEventListener("scroll",E),y.value=!0,E(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ce(()=>{T()||setTimeout(()=>{T()},100)})};return me(()=>o.currentRootPlanId,(T,M)=>{T&&T!==M?(d.value=T,m.value=!0,localStorage.setItem("jmanus-last-plan-id",T),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",T)):!T&&M&&console.log("[RightPanel] Plan execution finished, keeping last plan:",d.value)},{immediate:!0}),Ae(()=>{console.log("[RightPanel] Component mounted"),Ce(()=>{D()})}),xe(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),k()}),e({handleStepSelected:w,refreshCurrentStep:b,updateDisplayedPlanProgress:T=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",T),T&&(d.value=T,m.value=!0,localStorage.setItem("jmanus-last-plan-id",T),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",T))}}),(T,M)=>{var G,Y;return p(),g("div",oi,[s("div",si,[s("div",ni,[s("div",{class:ae(["tab-item",{active:c.value==="details"}]),onClick:M[0]||(M[0]=Q=>c.value="details")},[C(r(R),{icon:"carbon:events"}),s("span",null,i(r(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:ae(["tab-item",{active:c.value==="files"}]),onClick:M[1]||(M[1]=Q=>c.value="files")},[C(r(R),{icon:"carbon:folder"}),s("span",null,i(r(t)("fileBrowser.title")),1)],2)])]),s("div",ai,[c.value==="details"?(p(),g("div",li,[l.value?(p(),g("div",ri,[s("h3",null,i(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",ii,[s("div",ci,[s("span",di,i(r(t)("rightPanel.executingAgent"))+":",1),s("span",ui,i(l.value.agentExecution.agentName),1)]),s("div",pi,[s("span",hi,i(r(t)("rightPanel.callingModel"))+":",1),s("span",mi,i(l.value.agentExecution.modelName),1)]),s("div",fi,[s("span",gi,i(r(t)("rightPanel.executionResult"))+":",1),s("span",{class:ae(["value",{success:l.value.agentExecution.status==="FINISHED"}])},i(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):B("",!0),s("div",vi,[s("div",bi,[l.value.completed?(p(),he(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),he(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),he(r(R),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",yi,i(F.value),1)])])])):B("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:E},[l.value?(p(),g("div",_i,[(G=l.value.agentExecution)!=null&&G.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",Si,[s("h4",null,i(r(t)("rightPanel.thinkAndActionSteps")),1),s("div",wi,[(p(!0),g(de,null,pe(l.value.agentExecution.thinkActSteps,(Q,z)=>(p(),g("div",{key:z,class:"think-act-step"},[s("div",$i,[s("span",Pi,"#"+i(z+1),1),s("span",{class:ae(["step-status",Q.status])},i(Q.status||r(t)("rightPanel.executing")),3)]),s("div",ki,[s("h5",null,[C(r(R),{icon:"carbon:thinking"}),le(" "+i(r(t)("rightPanel.thinking")),1)]),s("div",Ei,[s("div",Ti,[s("span",Ci,i(r(t)("rightPanel.input"))+":",1),s("pre",null,i(f(Q.thinkInput)),1)]),s("div",Ri,[s("span",Ii,i(r(t)("rightPanel.output"))+":",1),s("pre",null,i(f(Q.thinkOutput)),1)])])]),Q.actionNeeded?(p(),g("div",Ai,[s("h5",null,[C(r(R),{icon:"carbon:play"}),le(" "+i(r(t)("rightPanel.action")),1)]),s("div",xi,[(p(!0),g(de,null,pe(Q.actToolInfoList,(K,ne)=>(p(),g("div",{key:ne},[s("div",Mi,[s("span",Fi,i(r(t)("rightPanel.tool"))+":",1),s("span",Di,i(K.name||""),1)]),s("div",Ni,[s("span",Ui,i(r(t)("rightPanel.toolParameters"))+":",1),s("pre",null,i(f(K.parameters)),1)]),s("div",Li,[s("span",Oi,i(r(t)("rightPanel.executionResult"))+":",1),s("pre",null,i(f(K.result)),1)])]))),128))]),Q.subPlanExecutionRecord?(p(),g("div",Bi,[s("h5",null,[C(r(R),{icon:"carbon:tree-view"}),le(" "+i(r(t)("rightPanel.subPlan")),1)]),s("div",qi,[s("div",ji,[s("div",Vi,[s("span",Gi,i(T.$t("rightPanel.subPlanId"))+":",1),s("span",Hi,i(Q.subPlanExecutionRecord.currentPlanId),1)]),Q.subPlanExecutionRecord.title?(p(),g("div",Ji,[s("span",Wi,i(T.$t("rightPanel.title"))+":",1),s("span",zi,i(Q.subPlanExecutionRecord.title),1)])):B("",!0),s("div",Ki,[Q.subPlanExecutionRecord.completed?(p(),he(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),he(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Xi,i(Q.subPlanExecutionRecord.completed?T.$t("rightPanel.status.completed"):T.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),l.value.agentExecution&&!((Y=l.value.agentExecution.thinkActSteps)!=null&&Y.length)?(p(),g("div",Qi,[s("p",null,i(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?B("",!0):(p(),g("div",Yi,[C(r(R),{icon:"carbon:information",class:"info-icon"}),s("h4",null,i(r(t)("rightPanel.stepInfo")),1),s("div",Zi,[s("div",ec,[s("span",tc,i(r(t)("rightPanel.stepName"))+":",1),s("span",oc,i(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",sc,[s("span",nc,i(T.$t("rightPanel.description"))+":",1),s("span",ac,i(l.value.description),1)])):B("",!0),s("div",lc,[s("span",rc,i(T.$t("rightPanel.status.label"))+":",1),s("span",{class:ae(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},i(l.value.completed?T.$t("rightPanel.status.completed"):l.value.current?T.$t("rightPanel.status.executing"):T.$t("rightPanel.status.pending")),3)])]),s("p",ic,i(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",cc,[M[2]||(M[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",dc,[C(r(R),{icon:"carbon:in-progress",class:"rotating-icon"}),le(" "+i(r(t)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(p(),g("div",uc,[C(r(R),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,i(r(t)("rightPanel.noStepSelected")),1),s("p",null,i(r(t)("rightPanel.selectStepHint")),1)]))])):B("",!0),C(Nt,{name:"scroll-button"},{default:Ke(()=>[u.value?(p(),g("button",{key:0,onClick:$,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[C(r(R),{icon:"carbon:chevron-down"})],8,pc)):B("",!0)]),_:1})],544)])):B("",!0),c.value==="files"?(p(),g("div",hc,[O.value?(p(),he(ti,{key:0,"plan-id":O.value},null,8,["plan-id"])):x.value?(p(),g("div",mc,[C(r(R),{icon:"carbon:folder-off"}),s("div",fc,[s("h3",null,i(r(t)("fileBrowser.noFilesYet")),1),s("p",null,i(r(t)("fileBrowser.noPlanExecuting")),1),s("div",gc,[C(r(R),{icon:"carbon:information"}),s("span",null,i(r(t)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])])}}}),bc=ye(vc,[["__scopeId","data-v-3ea813c1"]]);class Lt{static async getParameterRequirements(e){try{const o=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to get parameter requirements: ${o.statusText}`);return await o.json()}catch(o){throw console.error("Error getting parameter requirements:",o),o}}}ke(Lt,"BASE_URL","/api/plan-template");const yc={class:"modal-form wide-modal"},_c={class:"form-section"},Sc={class:"form-item"},wc=["placeholder"],$c={class:"field-description"},Pc={class:"form-section"},kc={class:"form-item"},Ec=["placeholder"],Tc={class:"field-description"},Cc={class:"form-section"},Rc={class:"form-item"},Ic={class:"service-group-autocomplete"},Ac=["placeholder"],xc={key:0,class:"service-group-dropdown"},Mc=["onMousedown"],Fc={class:"field-description"},Dc={class:"form-section"},Nc={class:"section-title"},Uc={key:0,class:"params-help-text"},Lc={class:"parameter-table"},Oc=["onUpdate:modelValue","placeholder","readonly"],Bc=["onUpdate:modelValue","placeholder"],qc={class:"form-section"},jc={class:"service-publish-options"},Vc={class:"internal-toolcall-publish-option"},Gc={class:"checkbox-label"},Hc={class:"checkbox-text"},Jc={class:"checkbox-description"},Wc={class:"http-publish-option"},zc={class:"checkbox-label"},Kc={class:"checkbox-text"},Xc={class:"checkbox-description"},Qc={class:"button-container"},Yc=["disabled"],Zc=["disabled"],ed=be({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:o}){const{t}=Me(),a=n,l=o,c=ue({get:()=>a.modelValue,set:q=>l("update:modelValue",q)}),d=N(""),m=N(""),u=N(!1),h=N(!1),y=N(null),F=N(!1),O=N(!1),x=N(!0),w=N({parameters:[],hasParameters:!1,requirements:""}),b=N(!1),v=N(!1),E=N([]),$=N(!1),_=nt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),f=ue(()=>{const q=_.serviceGroup.trim();if(!q)return E.value;const j=q.toLowerCase();return E.value.filter(U=>U.toLowerCase().includes(j))}),k=ue(()=>{var j;const q=(j=y.value)==null?void 0:j.id;return t(q?"mcpService.updateService":"mcpService.createService")}),D=()=>{_.serviceName="",_.userRequest=a.planDescription||"",_.endpoint="",_.serviceGroup="",w.value.hasParameters||(_.parameters=[]),y.value=null,F.value=!1};me(()=>_.userRequest,q=>{const j=q.trim();j&&(_.serviceName.trim()||(_.serviceName=j))});const V=async()=>{if(!$.value){$.value=!0;try{const q=await Ho.getAvailableTools(),j=new Set;q.forEach(U=>{U.serviceGroup&&j.add(U.serviceGroup)}),E.value=Array.from(j).sort()}catch(q){console.error("[PublishModal] Failed to load service groups:",q),E.value=[]}finally{$.value=!1}}},T=()=>{v.value=!0},M=()=>{setTimeout(()=>{v.value=!1},200)},G=q=>{_.serviceGroup=q,v.value=!1},Y=async()=>{if(!a.planTemplateId){w.value={parameters:[],hasParameters:!1,requirements:""};return}b.value=!0;try{const q=await Lt.getParameterRequirements(a.planTemplateId);w.value=q,q.hasParameters&&(_.parameters=q.parameters.map(j=>({name:j,description:""})))}catch(q){console.error("[PublishModal] Failed to load parameter requirements:",q),q instanceof Error&&!q.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),w.value={parameters:[],hasParameters:!1,requirements:""}}finally{b.value=!1}},Q=(q,j)=>{j==="success"?(m.value=q,setTimeout(()=>{m.value=""},3e3)):j==="error"&&(d.value=q,setTimeout(()=>{d.value=""},5e3))},z=()=>{if(!_.serviceName.trim())return Q(t("mcpService.toolNameRequiredError"),"error"),!1;if(!_.userRequest.trim())return Q(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!_.serviceGroup.trim())return Q(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(!x.value&&!O.value)return Q("Please select at least one service type","error"),!1;for(let q=0;q<_.parameters.length;q++){const j=_.parameters[q];if(j.name&&!j.description.trim())return Q(`Parameter "${j.name}" description cannot be empty`,"error"),!1;if(j.description&&!j.name.trim())return Q(`Parameter description "${j.description}" corresponding name cannot be empty`,"error"),!1}return!0},K=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",_),console.log("[PublishModal] Current tool:",y.value),console.log("[PublishModal] Publish as HTTP service:",O.value),!z()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{if(!y.value){console.log("[PublishModal] No current tool data, getting existing tool or creating default");const U=await Ne.getCoordinatorToolByTemplate(a.planTemplateId);U?y.value=U:y.value=Ne.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription)}console.log("[PublishModal] Updating tool information"),y.value.toolName=_.serviceName.trim(),y.value.toolDescription=_.userRequest.trim(),y.value.serviceGroup=_.serviceGroup.trim(),y.value.planTemplateId=a.planTemplateId,y.value.enableInternalToolcall=x.value,y.value.enableHttpService=O.value,y.value.enableMcpService=!1,y.value.mcpEndpoint=void 0;const q=_.parameters.filter(U=>U.name.trim()&&U.description.trim()).map(U=>({name:U.name.trim(),description:U.description.trim(),type:"string"}));if(y.value.inputSchema=JSON.stringify(q),console.log("[PublishModal] Updated tool information:",y.value),y.value.id)console.log("[PublishModal] Updating existing tool, ID:",y.value.id),await Ne.updateCoordinatorTool(y.value.id,y.value);else{console.log("[PublishModal] Creating new tool");const U=await Ne.createCoordinatorTool(y.value);y.value=U}const j=[];if(x.value&&j.push("Internal Method Call"),O.value&&j.push("HTTP Service"),j.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",y.value.id,"Enabled services:",j.join(", "));const U=[];x.value&&U.push(`Internal Call: ${_.serviceName}`),console.log("[PublishModal] Service published successfully"),Q(t("mcpService.publishSuccess"),"success"),l("published",y.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),Q(t("mcpService.saveSuccess"),"success"),l("published",y.value)}catch(q){console.error("[PublishModal] Failed to publish service:",q),Q(t("mcpService.publishFailed")+": "+q.message,"error")}finally{u.value=!1}},ne=async()=>{var q;if(!h.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!((q=y.value)!=null&&q.id)){Q(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}h.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",y.value.id);const j=await Ne.deleteCoordinatorTool(y.value.id);if(j.success)console.log("[PublishModal] Deleted successfully"),Q(t("mcpService.deleteSuccess"),"success"),c.value=!1,l("published",null);else throw new Error(j.message)}catch(j){console.error("[PublishModal] Failed to delete MCP service:",j),Q(t("mcpService.deleteFailed")+": "+j.message,"error")}finally{h.value=!1}}},fe=async()=>{c.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),D(),await X())},X=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const q=await Ne.getCoordinatorToolByTemplate(a.planTemplateId);let j;q?(j=q,console.log("[PublishModal] Found existing coordinator tool:",j)):(j=Ne.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription),console.log("[PublishModal] Created default coordinator tool VO:",j)),y.value=j,F.value=!!j.id;const U=[];if(j.enableMcpService&&j.mcpEndpoint){const A=window.location.origin;U.push(`MCP: ${A}/mcp${j.mcpEndpoint}`)}j.enableInternalToolcall&&U.push(`Internal Call: ${j.toolName}`),console.log("[PublishModal] Load tool data completed"),_.serviceName=j.toolName||"",_.userRequest=j.toolDescription||a.planDescription||"",_.serviceGroup=j.serviceGroup??"",O.value=j.enableHttpService??!1,x.value=j.enableInternalToolcall??!1;try{if(j.inputSchema){const A=JSON.parse(j.inputSchema);Array.isArray(A)&&A.length>0?(_.parameters=A.map(L=>({name:L.name||"",description:L.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",_.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",_.parameters)}}catch(A){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",A),console.log("[PublishModal] Parsing failed, keeping existing parameters:",_.parameters)}console.log("[PublishModal] Form data filled:",_)}catch(q){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",q),Q(t("mcpService.loadToolDataFailed")+": "+q.message,"error")}};return me(()=>a.modelValue,fe),me(()=>a.planTemplateId,(q,j)=>{q&&q!==j&&(j&&q.startsWith("planTemplate-")?setTimeout(()=>{Y()},1e3):Y())}),me(c,q=>{q&&V()}),Ae(async()=>{c.value&&(console.log("[PublishModal] Initialize when component mounted"),D(),await X(),await Y())}),e({loadParameterRequirements:Y}),(q,j)=>(p(),g(de,null,[C(ao,{modelValue:c.value,"onUpdate:modelValue":j[6]||(j[6]=U=>c.value=U),title:k.value,onConfirm:K},{footer:Ke(()=>{var U;return[s("div",Qc,[F.value&&((U=y.value)!=null&&U.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:ne,disabled:h.value},[h.value?(p(),he(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),he(r(R),{key:1,icon:"carbon:trash-can"})),le(" "+i(h.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Yc)):B("",!0),s("button",{class:"action-btn primary",onClick:K,disabled:u.value},[u.value?(p(),he(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),he(r(R),{key:1,icon:"carbon:cloud-upload"})),le(" "+i(u.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,Zc)])]}),default:Ke(()=>[s("div",yc,[s("div",_c,[s("div",Sc,[s("label",null,i(r(t)("mcpService.toolNameRequired")),1),ie(s("input",{type:"text","onUpdate:modelValue":j[0]||(j[0]=U=>_.serviceName=U),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:ae({error:!_.serviceName||!_.serviceName.trim()}),required:""},null,10,wc),[[ve,_.serviceName]]),s("div",$c,i(r(t)("mcpService.toolNameDescription")),1)])]),s("div",Pc,[s("div",kc,[s("label",null,i(r(t)("mcpService.toolDescriptionRequired")),1),ie(s("textarea",{"onUpdate:modelValue":j[1]||(j[1]=U=>_.userRequest=U),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:ae([{error:!_.userRequest||!_.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Ec),[[ve,_.userRequest]]),s("div",Tc,i(r(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",Cc,[s("div",Rc,[s("label",null,i(r(t)("mcpService.serviceGroup")),1),s("div",Ic,[ie(s("input",{type:"text","onUpdate:modelValue":j[2]||(j[2]=U=>_.serviceGroup=U),onInput:T,onFocus:j[3]||(j[3]=U=>v.value=!0),onBlur:M,placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:ae({error:!_.serviceGroup||!_.serviceGroup.trim()}),required:""},null,42,Ac),[[ve,_.serviceGroup]]),v.value&&f.value.length>0?(p(),g("div",xc,[(p(!0),g(de,null,pe(f.value,U=>(p(),g("div",{key:U,class:"service-group-option",onMousedown:A=>G(U)},i(U),41,Mc))),128))])):B("",!0)]),s("div",Fc,i(r(t)("mcpService.serviceGroupDescription")),1)])]),s("div",Dc,[s("div",Nc,i(r(t)("mcpService.parameterConfig")),1),w.value.hasParameters?(p(),g("div",Uc,i(r(t)("sidebar.parameterRequirementsHelp")),1)):B("",!0),s("div",Lc,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,i(r(t)("mcpService.parameterName")),1),s("th",null,i(r(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),g(de,null,pe(_.parameters,(U,A)=>(p(),g("tr",{key:A},[s("td",null,[ie(s("input",{type:"text","onUpdate:modelValue":L=>U.name=L,placeholder:r(t)("mcpService.parameterName"),class:ae(["parameter-input",{"readonly-input":w.value.hasParameters}]),readonly:w.value.hasParameters,required:""},null,10,Oc),[[ve,U.name]])]),s("td",null,[ie(s("input",{type:"text","onUpdate:modelValue":L=>U.description=L,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Bc),[[ve,U.description]])])]))),128))])])])]),s("div",qc,[s("div",jc,[s("div",Vc,[s("label",Gc,[ie(s("input",{type:"checkbox","onUpdate:modelValue":j[4]||(j[4]=U=>x.value=U),class:"checkbox-input"},null,512),[[Tt,x.value]]),s("span",Hc,i(r(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",Jc,i(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",Wc,[s("label",zc,[ie(s("input",{type:"checkbox","onUpdate:modelValue":j[5]||(j[5]=U=>O.value=U),class:"checkbox-input"},null,512),[[Tt,O.value]]),s("span",Kc,i(r(t)("mcpService.publishAsHttpService")),1)]),s("div",Xc,i(r(t)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),d.value?(p(),g("div",{key:0,class:"error-toast",onClick:j[7]||(j[7]=U=>d.value="")},[C(r(R),{icon:"carbon:error"}),le(" "+i(d.value),1)])):B("",!0),m.value?(p(),g("div",{key:1,class:"success-toast",onClick:j[8]||(j[8]=U=>m.value="")},[C(r(R),{icon:"carbon:checkmark"}),le(" "+i(m.value),1)])):B("",!0)],64))}}),td=ye(ed,[["__scopeId","data-v-0d577e02"]]),od={class:"config-section"},sd={class:"section-header"},nd={class:"execution-content"},ad={class:"params-requirements-group"},ld={class:"params-help-text"},rd={key:0,class:"parameter-fields"},id={class:"parameter-label"},cd=["onUpdate:modelValue","placeholder","onInput"],dd={key:0,class:"parameter-error"},ud={key:1,class:"validation-message"},pd=["disabled"],hd=["disabled"],md={key:1,class:"call-example-wrapper"},fd={class:"call-example-header"},gd={class:"call-example-title"},vd={class:"call-example-description"},bd={class:"internal-call-wrapper"},yd={class:"call-info"},_d={class:"call-method"},Sd={class:"call-endpoint"},wd={key:0,class:"call-endpoint"},$d={class:"call-description"},Pd={class:"call-example"},kd={class:"example-code"},Ed={key:2,class:"call-example-wrapper"},Td={class:"call-example-header"},Cd={class:"call-example-title"},Rd={class:"call-example-description"},Id={class:"http-api-urls-wrapper"},Ad={class:"tab-container"},xd={class:"tab-header"},Md=["onClick"],Fd={class:"tab-content"},Dd={class:"http-api-url-display"},Nd={class:"api-method"},Ud={class:"api-endpoint"},Ld={class:"api-description"},Od={key:0,class:"api-example"},Bd={class:"example-code"},qd={key:3,class:"call-example-wrapper"},jd={class:"call-example-header"},Vd={class:"call-example-title"},Gd={class:"call-example-description"},Hd={class:"mcp-call-wrapper"},Jd={class:"call-info"},Wd={class:"call-method"},zd={class:"call-endpoint"},Kd={class:"call-description"},Xd={class:"call-example"},Qd={class:"example-code"},Yd=be({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:o}){const{t}=Me(),a=n,l=o,c=N(""),d=N({parameters:[],hasParameters:!1,requirements:""}),m=N({}),u=N(!1),h=N("get-sync"),y=N({}),F=N(!1),O=N(!1),x=N(),w=N([]),b=N(null),v=N([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),E=ue(()=>a.toolInfo.enableInternalToolcall??a.toolInfo.enableHttpService??a.toolInfo.enableMcpService),$=ue(()=>E.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),_=ue(()=>a.isExecuting||a.isGenerating?!1:d.value.hasParameters?d.value.parameters.every(X=>{const q=m.value[X];return typeof q=="string"&&q.trim()!==""}):!0),f=(X,q)=>{w.value=X.map(j=>j.originalName),b.value=q,console.log("[ExecutionController] Files uploaded:",X.length,"uploadKey:",q)},k=X=>{w.value=X.map(q=>q.originalName),console.log("[ExecutionController] Files removed, remaining:",X.length)},D=X=>{b.value=X,console.log("[ExecutionController] Upload key changed:",X)},V=()=>{console.log("[ExecutionController] Upload started")},T=()=>{console.log("[ExecutionController] Upload completed")},M=X=>{console.error("[ExecutionController] Upload error:",X)},G=()=>{if(console.log("[ExecutionController]  Execute button clicked"),O.value=!0,console.log("[ExecutionController]  Set isExecutingPlan to true"),!ne()){console.log("[ExecutionController]  Parameter validation failed:",y.value),O.value=!1;return}const X=d.value.hasParameters&&Object.keys(m.value).length>0?m.value:void 0;console.log("[ExecutionController]  Replacement params:",X);const q={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:X,uploadedFiles:w.value,uploadKey:b.value};console.log("[ExecutionController]  Emitting executePlan with payload:",JSON.stringify(q,null,2)),l("executePlan",q)},Y=()=>{l("publishMcpService")},Q=()=>{console.log("[ExecutionController]  clearExecutionParams called"),c.value="",m.value={},O.value=!1,console.log("[ExecutionController]  Reset isExecutingPlan to false"),console.log("[ExecutionController]  After clear - parameterValues cleared"),l("clearParams")},z=async()=>{if(console.log("[ExecutionController]  loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController]  Current parameterRequirements before load:",JSON.stringify(d.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController]  No template ID, resetting parameters"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={};return}d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController]  Cleared previous data before loading new template"),u.value=!0;try{console.log("[ExecutionController]  Fetching parameter requirements from API...");const X=await Lt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController]  Received requirements from API:",JSON.stringify(X,null,2)),d.value=X;const q={};X.parameters.forEach(j=>{q[j]=m.value[j]||""}),m.value=q,console.log("[ExecutionController]  Updated parameterRequirements:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController]  Updated parameterValues:",JSON.stringify(m.value,null,2)),fe()}catch(X){console.error("[ExecutionController]  Failed to load parameter requirements:",X),X instanceof Error&&!X.message.includes("404")&&console.warn("[ExecutionController]  Parameter requirements not available yet, will retry later"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController]  Reset parameterRequirements due to error:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController]  Cleared parameterValues:",JSON.stringify(m.value,null,2))}finally{u.value=!1,console.log("[ExecutionController]  loadParameterRequirements completed")}},K=(X,q)=>{m.value[X]=q,y.value[X]&&delete y.value[X],fe()},ne=()=>{if(y.value={},F.value=!1,!d.value.hasParameters)return!0;let X=!1;return d.value.parameters.forEach(q=>{(m.value[q]?m.value[q].trim():"")||(y.value[q]=`${q} is required`,X=!0)}),F.value=X,!X},fe=()=>{d.value.hasParameters?c.value=JSON.stringify(m.value,null,2):c.value="",l("updateExecutionParams",c.value)};return me(()=>a.currentPlanTemplateId,(X,q)=>{if(X&&X!==q){if(O.value){console.log("[ExecutionController]  Skipping parameter reload - plan is executing");return}console.log("[ExecutionController]  Template ID changed, will reload parameters"),q&&X.startsWith("planTemplate-")?(console.log("[ExecutionController]  New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController]  Delay timeout, calling loadParameterRequirements"),z()},1e3)):(console.log("[ExecutionController]  Immediate reload of parameters"),z())}}),me(()=>c.value,X=>{l("updateExecutionParams",X)}),Ae(()=>{z()}),e({executionParams:c,clearExecutionParams:Q,loadParameterRequirements:z,fileUploadRef:x,uploadedFiles:w,uploadKey:b}),(X,q)=>{var j,U,A,L,Z;return p(),g("div",od,[s("div",sd,[C(r(R),{icon:"carbon:play",width:"16"}),s("span",null,i(r(t)("sidebar.executionController")),1)]),s("div",nd,[s("div",ad,[s("label",null,i(r(t)("sidebar.parameterRequirements")),1),s("div",ld,i(r(t)("sidebar.parameterRequirementsHelp")),1),d.value.hasParameters?(p(),g("div",rd,[(p(!0),g(de,null,pe(d.value.parameters,P=>(p(),g("div",{key:P,class:"parameter-field"},[s("label",id,[le(i(P)+" ",1),q[0]||(q[0]=s("span",{class:"required"},"*",-1))]),ie(s("input",{"onUpdate:modelValue":W=>m.value[P]=W,class:ae(["parameter-input",{error:y.value[P]}]),placeholder:r(t)("sidebar.enterValueFor",{param:P}),onInput:W=>K(P,W.target.value),required:""},null,42,cd),[[ve,m.value[P]]]),y.value[P]?(p(),g("div",dd,i(y.value[P]),1)):B("",!0)]))),128))])):B("",!0),d.value.hasParameters&&!_.value&&!a.isExecuting&&!a.isGenerating?(p(),g("div",ud,[C(r(R),{icon:"carbon:warning",width:"14"}),le(" "+i(r(t)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),C(ro,{ref_key:"fileUploadRef",ref:x,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:k,onUploadKeyChanged:D,onUploadStarted:V,onUploadCompleted:T,onUploadError:M},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:G,disabled:!_.value},[C(r(R),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ae({spinning:a.isExecuting})},null,8,["icon","class"]),le(" "+i(a.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,pd),X.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:Y,disabled:!X.currentPlanTemplateId},[C(r(R),{icon:"carbon:application",width:"16"}),le(" "+i($.value),1)],8,hd)):B("",!0),(j=X.toolInfo)!=null&&j.enableInternalToolcall?(p(),g("div",md,[s("div",fd,[s("h4",gd,i(r(t)("sidebar.internalCall")),1),s("p",vd,i(r(t)("sidebar.internalCallDescription")),1)]),s("div",bd,[s("div",yd,[s("div",_d,i(r(t)("sidebar.internalMethodCall")),1),s("div",Sd,i(r(t)("sidebar.toolName"))+": "+i(((U=X.toolInfo)==null?void 0:U.toolName)||X.currentPlanTemplateId),1),(A=X.toolInfo)!=null&&A.serviceGroup?(p(),g("div",wd,i(r(t)("sidebar.serviceGroup"))+": "+i(X.toolInfo.serviceGroup),1)):B("",!0),s("div",$d,i(r(t)("sidebar.internalCallUsage")),1),s("div",Pd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",kd,i(r(t)("sidebar.internalCallExample")),1)])])])])):B("",!0),(L=X.toolInfo)!=null&&L.enableHttpService?(p(),g("div",Ed,[s("div",Td,[s("h4",Cd,i(r(t)("sidebar.httpCallExample")),1),s("p",Rd,i(r(t)("sidebar.httpCallDescription")),1)]),s("div",Id,[s("div",Ad,[s("div",xd,[(p(!0),g(de,null,pe(v.value,P=>(p(),g("button",{key:P.id,class:ae(["tab-button",{active:h.value===P.id}]),onClick:W=>h.value=P.id},i(P.label),11,Md))),128))]),s("div",Fd,[(p(!0),g(de,null,pe(v.value,P=>ie((p(),g("div",{key:P.id,class:"tab-panel"},[s("div",Dd,[s("div",Nd,i(P.method),1),s("div",Ud,i(P.endpoint),1),s("div",Ld,i(P.description),1),P.example?(p(),g("div",Od,[s("strong",null,i(r(t)("sidebar.example"))+":",1),s("pre",Bd,i(P.example),1)])):B("",!0)])])),[[Bo,h.value===P.id]])),128))])])])])):B("",!0),(Z=X.toolInfo)!=null&&Z.enableMcpService?(p(),g("div",qd,[s("div",jd,[s("h4",Vd,i(r(t)("sidebar.mcpCall")),1),s("p",Gd,i(r(t)("sidebar.mcpCallDescription")),1)]),s("div",Hd,[s("div",Jd,[s("div",Wd,i(r(t)("sidebar.mcpServiceCall")),1),s("div",zd,i(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Kd,i(r(t)("sidebar.mcpCallUsage")),1),s("div",Xd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",Qd,i(r(t)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])])}}}),Zd=ye(Yd,[["__scopeId","data-v-82031dab"]]);function co(n,e){const o=N(!1),t=nt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=b=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",b),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",n.currentPlanTemplateId);try{if(!b){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",t);return}const v=JSON.parse(b);console.log("[JsonEditorLogic] Parsed JSON:",v),t.title=v.title||"",t.directResponse=!1,t.planTemplateId=v.planTemplateId||n.currentPlanTemplateId||"",t.planType=v.planType||"dynamic_agent",t.steps=(v.steps||[]).map(E=>({stepRequirement:E.stepRequirement||"",agentName:E.agentName||"",modelName:E.modelName||null,selectedToolKeys:E.selectedToolKeys||[],terminateColumns:E.terminateColumns||""})),console.log("[JsonEditorLogic] Updated displayData to:",t)}catch(v){console.warn("Failed to parse JSON content:",v),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",t)}},l=()=>{try{const b={title:t.title,steps:t.steps.map(v=>({stepRequirement:v.stepRequirement,agentName:v.agentName,modelName:v.modelName??"",selectedToolKeys:v.selectedToolKeys,terminateColumns:v.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(b,null,2)}catch(b){return console.error("Failed to convert visual data to JSON:",b),"{}"}},c=ue(()=>l());return me(()=>n.jsonContent,(b,v)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",v,"to",b),a(b)},{immediate:!0}),me(t,()=>{const b=l();e("update:jsonContent",b)},{deep:!0}),me(()=>n.currentPlanTemplateId,b=>{b&&(t.planTemplateId=b)}),{showJsonPreview:o,displayData:t,formattedJsonOutput:c,addStep:()=>{const b={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(b)},removeStep:b=>{b>=0&&b<t.steps.length&&t.steps.splice(b,1)},moveStepUp:b=>{if(b>0){const v=t.steps.splice(b,1)[0];t.steps.splice(b-1,0,v)}},moveStepDown:b=>{if(b<t.steps.length-1){const v=t.steps.splice(b,1)[0];t.steps.splice(b+1,0,v)}},toggleJsonPreview:()=>{o.value=!o.value},closeJsonPreview:()=>{o.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const eu={class:"config-section"},tu={class:"section-header"},ou={class:"visual-editor"},su={class:"plan-basic-info"},nu={class:"form-row"},au={class:"form-label"},lu=["placeholder"],ru={class:"steps-section"},iu={class:"steps-header"},cu={class:"form-label"},du={class:"steps-container"},uu={class:"step-header"},pu={class:"step-number"},hu={class:"step-actions"},mu=["onClick","disabled","title"],fu=["onClick","disabled","title"],gu=["onClick","title"],vu={class:"step-content"},bu={class:"form-row"},yu={class:"form-label"},_u={class:"agent-selector"},Su=["onUpdate:modelValue"],wu={value:""},$u=["title"],Pu={class:"form-row"},ku={class:"form-label"},Eu=["onUpdate:modelValue","placeholder"],Tu={class:"form-row"},Cu={class:"form-label"},Ru=["onUpdate:modelValue","placeholder"],Iu={key:0,class:"empty-steps"},Au={class:"plan-id-section"},xu={class:"form-row"},Mu={class:"form-label"},Fu={key:0,class:"json-preview"},Du={class:"preview-header"},Nu={class:"form-label"},Uu={class:"json-code"},Lu={class:"editor-footer"},Ou={class:"section-actions"},Bu=["disabled","title"],qu=["disabled","title"],ju=["disabled"],Vu=be({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const o=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:c,addStep:d,removeStep:m,moveStepUp:u,moveStepDown:h,handleRollback:y,handleRestore:F,handleSave:O,toggleJsonPreview:x,closeJsonPreview:w}=co(o,t),b=v=>{const E=v.target;E.style.height="auto";const $=20,_=Math.ceil(E.scrollHeight/$),f=4,k=12,D=Math.max(f,Math.min(k,_)),V=D*$;E.style.height=`${V}px`,E.rows=D,_>k?E.style.overflowY="auto":E.style.overflowY="hidden"};return(v,E)=>(p(),g("div",eu,[s("div",tu,[C(r(R),{icon:"carbon:code",width:"16"}),s("span",null,i(v.$t("sidebar.jsonTemplate")),1)]),s("div",ou,[s("div",su,[s("div",nu,[s("label",au,i(v.$t("sidebar.title")),1),ie(s("input",{"onUpdate:modelValue":E[0]||(E[0]=$=>r(l).title=$),type:"text",class:"form-input",placeholder:v.$t("sidebar.titlePlaceholder")},null,8,lu),[[ve,r(l).title]])])]),s("div",ru,[s("div",iu,[s("label",cu,i(v.$t("sidebar.tasks")),1)]),s("div",du,[(p(!0),g(de,null,pe(r(l).steps,($,_)=>(p(),g("div",{key:_,class:"step-item"},[s("div",uu,[s("span",pu,i(v.$t("sidebar.subtask"))+" "+i(_+1),1),s("div",hu,[s("button",{onClick:f=>r(u)(_),disabled:_===0,class:"btn btn-xs",title:v.$t("sidebar.moveUp")},[C(r(R),{icon:"carbon:chevron-up",width:"12"})],8,mu),s("button",{onClick:f=>r(h)(_),disabled:_===r(l).steps.length-1,class:"btn btn-xs",title:v.$t("sidebar.moveDown")},[C(r(R),{icon:"carbon:chevron-down",width:"12"})],8,fu),s("button",{onClick:f=>r(m)(_),class:"btn btn-xs btn-danger",title:v.$t("sidebar.removeStep")},[C(r(R),{icon:"carbon:trash-can",width:"12"})],8,gu)])]),s("div",vu,[s("div",bu,[s("label",yu,i(v.$t("sidebar.agent")),1),s("div",_u,[ie(s("select",{"onUpdate:modelValue":f=>$.agentName=f,class:"form-select agent-select"},[s("option",wu,i(v.$t("sidebar.selectAgent")),1),E[10]||(E[10]=qo('<option value="DEFAULT_AGENT" data-v-91f01967>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-91f01967>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-91f01967>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-91f01967>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-91f01967>FILE_MANAGER_AGENT</option>',5))],8,Su),[[mt,$.agentName]]),s("button",{onClick:E[1]||(E[1]=(...f)=>r(d)&&r(d)(...f)),class:"btn btn-sm btn-add-step",title:v.$t("sidebar.addStep")},[C(r(R),{icon:"carbon:add",width:"14"})],8,$u)])]),s("div",Pu,[s("label",ku,i(v.$t("sidebar.stepRequirement")),1),ie(s("textarea",{"onUpdate:modelValue":f=>$.stepContent=f,class:"form-textarea auto-resize",placeholder:v.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:E[2]||(E[2]=f=>b(f))},null,40,Eu),[[ve,$.stepContent]])]),s("div",Tu,[s("label",Cu,i(v.$t("sidebar.terminateColumns")),1),ie(s("input",{"onUpdate:modelValue":f=>$.terminateColumns=f,type:"text",class:"form-input",placeholder:v.$t("sidebar.terminateColumnsPlaceholder")},null,8,Ru),[[ve,$.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",Iu,[C(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(v.$t("sidebar.noSteps")),1),s("button",{onClick:E[3]||(E[3]=(...$)=>r(d)&&r(d)(...$)),class:"btn btn-primary"},[C(r(R),{icon:"carbon:add",width:"14"}),le(" "+i(v.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),s("div",Au,[s("div",xu,[s("label",Mu,i(v.$t("sidebar.planId")),1),ie(s("input",{"onUpdate:modelValue":E[4]||(E[4]=$=>r(l).planTemplateId=$),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ve,r(l).planTemplateId]])])]),r(a)?(p(),g("div",Fu,[s("div",Du,[s("label",Nu,i(v.$t("sidebar.jsonPreview")),1),s("button",{onClick:E[5]||(E[5]=(...$)=>r(w)&&r(w)(...$)),class:"btn btn-xs"},[C(r(R),{icon:"carbon:close",width:"12"})])]),s("pre",Uu,i(r(c)),1)])):B("",!0),s("div",Lu,[s("button",{onClick:E[6]||(E[6]=(...$)=>r(x)&&r(x)(...$)),class:"btn btn-sm btn-secondary"},[C(r(R),{icon:"carbon:code",width:"14"}),le(" "+i(r(a)?v.$t("sidebar.hideJson"):v.$t("sidebar.showJson")),1)]),s("div",Ou,[s("button",{class:"btn btn-sm",onClick:E[7]||(E[7]=(...$)=>r(y)&&r(y)(...$)),disabled:!(v.canRollback??!1),title:v.$t("sidebar.rollback")},[C(r(R),{icon:"carbon:undo",width:"14"})],8,Bu),s("button",{class:"btn btn-sm",onClick:E[8]||(E[8]=(...$)=>r(F)&&r(F)(...$)),disabled:!(v.canRestore??!1),title:v.$t("sidebar.restore")},[C(r(R),{icon:"carbon:redo",width:"14"})],8,qu),s("button",{class:"btn btn-primary",onClick:E[9]||(E[9]=(...$)=>r(O)&&r(O)(...$)),disabled:v.isGenerating||v.isExecuting},[C(r(R),{icon:"carbon:save",width:"14"}),E[11]||(E[11]=le(" Save "))],8,ju)])])])]))}}),Gu=ye(Vu,[["__scopeId","data-v-91f01967"]]);function uo(n,e){return function(){return n.apply(e,arguments)}}const{toString:Hu}=Object.prototype,{getPrototypeOf:Ot}=Object,{iterator:gt,toStringTag:po}=Symbol,vt=(n=>e=>{const o=Hu.call(e);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Ue=n=>(n=n.toLowerCase(),e=>vt(e)===n),bt=n=>e=>typeof e===n,{isArray:Xe}=Array,st=bt("undefined");function Ju(n){return n!==null&&!st(n)&&n.constructor!==null&&!st(n.constructor)&&Re(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ho=Ue("ArrayBuffer");function Wu(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ho(n.buffer),e}const zu=bt("string"),Re=bt("function"),mo=bt("number"),yt=n=>n!==null&&typeof n=="object",Ku=n=>n===!0||n===!1,it=n=>{if(vt(n)!=="object")return!1;const e=Ot(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(po in n)&&!(gt in n)},Xu=Ue("Date"),Qu=Ue("File"),Yu=Ue("Blob"),Zu=Ue("FileList"),ep=n=>yt(n)&&Re(n.pipe),tp=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Re(n.append)&&((e=vt(n))==="formdata"||e==="object"&&Re(n.toString)&&n.toString()==="[object FormData]"))},op=Ue("URLSearchParams"),[sp,np,ap,lp]=["ReadableStream","Request","Response","Headers"].map(Ue),rp=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(n,e,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let t,a;if(typeof n!="object"&&(n=[n]),Xe(n))for(t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else{const l=o?Object.getOwnPropertyNames(n):Object.keys(n),c=l.length;let d;for(t=0;t<c;t++)d=l[t],e.call(null,n[d],d,n)}}function fo(n,e){e=e.toLowerCase();const o=Object.keys(n);let t=o.length,a;for(;t-- >0;)if(a=o[t],e===a.toLowerCase())return a;return null}const He=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,go=n=>!st(n)&&n!==He;function It(){const{caseless:n}=go(this)&&this||{},e={},o=(t,a)=>{const l=n&&fo(e,a)||a;it(e[l])&&it(t)?e[l]=It(e[l],t):it(t)?e[l]=It({},t):Xe(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&at(arguments[t],o);return e}const ip=(n,e,o,{allOwnKeys:t}={})=>(at(e,(a,l)=>{o&&Re(a)?n[l]=uo(a,o):n[l]=a},{allOwnKeys:t}),n),cp=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),dp=(n,e,o,t)=>{n.prototype=Object.create(e.prototype,t),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),o&&Object.assign(n.prototype,o)},up=(n,e,o,t)=>{let a,l,c;const d={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)c=a[l],(!t||t(c,n,e))&&!d[c]&&(e[c]=n[c],d[c]=!0);n=o!==!1&&Ot(n)}while(n&&(!o||o(n,e))&&n!==Object.prototype);return e},pp=(n,e,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=e.length;const t=n.indexOf(e,o);return t!==-1&&t===o},hp=n=>{if(!n)return null;if(Xe(n))return n;let e=n.length;if(!mo(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=n[e];return o},mp=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ot(Uint8Array)),fp=(n,e)=>{const t=(n&&n[gt]).call(n);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},gp=(n,e)=>{let o;const t=[];for(;(o=n.exec(e))!==null;)t.push(o);return t},vp=Ue("HTMLFormElement"),bp=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,t,a){return t.toUpperCase()+a}),Vt=(({hasOwnProperty:n})=>(e,o)=>n.call(e,o))(Object.prototype),yp=Ue("RegExp"),vo=(n,e)=>{const o=Object.getOwnPropertyDescriptors(n),t={};at(o,(a,l)=>{let c;(c=e(a,l,n))!==!1&&(t[l]=c||a)}),Object.defineProperties(n,t)},_p=n=>{vo(n,(e,o)=>{if(Re(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const t=n[o];if(Re(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},Sp=(n,e)=>{const o={},t=a=>{a.forEach(l=>{o[l]=!0})};return Xe(n)?t(n):t(String(n).split(e)),o},wp=()=>{},$p=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Pp(n){return!!(n&&Re(n.append)&&n[po]==="FormData"&&n[gt])}const kp=n=>{const e=new Array(10),o=(t,a)=>{if(yt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=Xe(t)?[]:{};return at(t,(c,d)=>{const m=o(c,a+1);!st(m)&&(l[d]=m)}),e[a]=void 0,l}}return t};return o(n,0)},Ep=Ue("AsyncFunction"),Tp=n=>n&&(yt(n)||Re(n))&&Re(n.then)&&Re(n.catch),bo=((n,e)=>n?setImmediate:e?((o,t)=>(He.addEventListener("message",({source:a,data:l})=>{a===He&&l===o&&t.length&&t.shift()()},!1),a=>{t.push(a),He.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",Re(He.postMessage)),Cp=typeof queueMicrotask<"u"?queueMicrotask.bind(He):typeof process<"u"&&process.nextTick||bo,Rp=n=>n!=null&&Re(n[gt]),I={isArray:Xe,isArrayBuffer:ho,isBuffer:Ju,isFormData:tp,isArrayBufferView:Wu,isString:zu,isNumber:mo,isBoolean:Ku,isObject:yt,isPlainObject:it,isReadableStream:sp,isRequest:np,isResponse:ap,isHeaders:lp,isUndefined:st,isDate:Xu,isFile:Qu,isBlob:Yu,isRegExp:yp,isFunction:Re,isStream:ep,isURLSearchParams:op,isTypedArray:mp,isFileList:Zu,forEach:at,merge:It,extend:ip,trim:rp,stripBOM:cp,inherits:dp,toFlatObject:up,kindOf:vt,kindOfTest:Ue,endsWith:pp,toArray:hp,forEachEntry:fp,matchAll:gp,isHTMLForm:vp,hasOwnProperty:Vt,hasOwnProp:Vt,reduceDescriptors:vo,freezeMethods:_p,toObjectSet:Sp,toCamelCase:bp,noop:wp,toFiniteNumber:$p,findKey:fo,global:He,isContextDefined:go,isSpecCompliantForm:Pp,toJSONObject:kp,isAsyncFn:Ep,isThenable:Tp,setImmediate:bo,asap:Cp,isIterable:Rp};function te(n,e,o,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),o&&(this.config=o),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const yo=te.prototype,_o={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{_o[n]={value:n}});Object.defineProperties(te,_o);Object.defineProperty(yo,"isAxiosError",{value:!0});te.from=(n,e,o,t,a,l)=>{const c=Object.create(yo);return I.toFlatObject(n,c,function(m){return m!==Error.prototype},d=>d!=="isAxiosError"),te.call(c,n.message,e,o,t,a),c.cause=n,c.name=n.name,l&&Object.assign(c,l),c};const Ip=null;function At(n){return I.isPlainObject(n)||I.isArray(n)}function So(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function Gt(n,e,o){return n?n.concat(e).map(function(a,l){return a=So(a),!o&&l?"["+a+"]":a}).join(o?".":""):e}function Ap(n){return I.isArray(n)&&!n.some(At)}const xp=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function _t(n,e,o){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,o=I.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,b){return!I.isUndefined(b[w])});const t=o.metaTokens,a=o.visitor||h,l=o.dots,c=o.indexes,m=(o.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function u(x){if(x===null)return"";if(I.isDate(x))return x.toISOString();if(!m&&I.isBlob(x))throw new te("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(x)||I.isTypedArray(x)?m&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function h(x,w,b){let v=x;if(x&&!b&&typeof x=="object"){if(I.endsWith(w,"{}"))w=t?w:w.slice(0,-2),x=JSON.stringify(x);else if(I.isArray(x)&&Ap(x)||(I.isFileList(x)||I.endsWith(w,"[]"))&&(v=I.toArray(x)))return w=So(w),v.forEach(function($,_){!(I.isUndefined($)||$===null)&&e.append(c===!0?Gt([w],_,l):c===null?w:w+"[]",u($))}),!1}return At(x)?!0:(e.append(Gt(b,w,l),u(x)),!1)}const y=[],F=Object.assign(xp,{defaultVisitor:h,convertValue:u,isVisitable:At});function O(x,w){if(!I.isUndefined(x)){if(y.indexOf(x)!==-1)throw Error("Circular reference detected in "+w.join("."));y.push(x),I.forEach(x,function(v,E){(!(I.isUndefined(v)||v===null)&&a.call(e,v,I.isString(E)?E.trim():E,w,F))===!0&&O(v,w?w.concat(E):[E])}),y.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return O(n),e}function Ht(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Bt(n,e){this._pairs=[],n&&_t(n,this,e)}const wo=Bt.prototype;wo.append=function(e,o){this._pairs.push([e,o])};wo.toString=function(e){const o=e?function(t){return e.call(this,t,Ht)}:Ht;return this._pairs.map(function(a){return o(a[0])+"="+o(a[1])},"").join("&")};function Mp(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $o(n,e,o){if(!e)return n;const t=o&&o.encode||Mp;I.isFunction(o)&&(o={serialize:o});const a=o&&o.serialize;let l;if(a?l=a(e,o):l=I.isURLSearchParams(e)?e.toString():new Bt(e,o).toString(t),l){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Jt{constructor(){this.handlers=[]}use(e,o,t){return this.handlers.push({fulfilled:e,rejected:o,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Po={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fp=typeof URLSearchParams<"u"?URLSearchParams:Bt,Dp=typeof FormData<"u"?FormData:null,Np=typeof Blob<"u"?Blob:null,Up={isBrowser:!0,classes:{URLSearchParams:Fp,FormData:Dp,Blob:Np},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",xt=typeof navigator=="object"&&navigator||void 0,Lp=qt&&(!xt||["ReactNative","NativeScript","NS"].indexOf(xt.product)<0),Op=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Bp=qt&&window.location.href||"http://localhost",qp=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:Lp,hasStandardBrowserWebWorkerEnv:Op,navigator:xt,origin:Bp},Symbol.toStringTag,{value:"Module"})),Ee={...qp,...Up};function jp(n,e){return _t(n,new Ee.classes.URLSearchParams,Object.assign({visitor:function(o,t,a,l){return Ee.isNode&&I.isBuffer(o)?(this.append(t,o.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Vp(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Gp(n){const e={},o=Object.keys(n);let t;const a=o.length;let l;for(t=0;t<a;t++)l=o[t],e[l]=n[l];return e}function ko(n){function e(o,t,a,l){let c=o[l++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),m=l>=o.length;return c=!c&&I.isArray(a)?a.length:c,m?(I.hasOwnProp(a,c)?a[c]=[a[c],t]:a[c]=t,!d):((!a[c]||!I.isObject(a[c]))&&(a[c]=[]),e(o,t,a[c],l)&&I.isArray(a[c])&&(a[c]=Gp(a[c])),!d)}if(I.isFormData(n)&&I.isFunction(n.entries)){const o={};return I.forEachEntry(n,(t,a)=>{e(Vp(t),a,o,0)}),o}return null}function Hp(n,e,o){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(t){if(t.name!=="SyntaxError")throw t}return(o||JSON.stringify)(n)}const lt={transitional:Po,adapter:["xhr","http","fetch"],transformRequest:[function(e,o){const t=o.getContentType()||"",a=t.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(ko(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return jp(e,this.formSerializer).toString();if((d=I.isFileList(e))||t.indexOf("multipart/form-data")>-1){const m=this.env&&this.env.FormData;return _t(d?{"files[]":e}:e,m&&new m,this.formSerializer)}}return l||a?(o.setContentType("application/json",!1),Hp(e)):e}],transformResponse:[function(e){const o=this.transitional||lt.transitional,t=o&&o.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(t&&!this.responseType||a)){const c=!(o&&o.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?te.from(d,te.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ee.classes.FormData,Blob:Ee.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{lt.headers[n]={}});const Jp=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Wp=n=>{const e={};let o,t,a;return n&&n.split(`
`).forEach(function(c){a=c.indexOf(":"),o=c.substring(0,a).trim().toLowerCase(),t=c.substring(a+1).trim(),!(!o||e[o]&&Jp[o])&&(o==="set-cookie"?e[o]?e[o].push(t):e[o]=[t]:e[o]=e[o]?e[o]+", "+t:t)}),e},Wt=Symbol("internals");function Ze(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:I.isArray(n)?n.map(ct):String(n)}function zp(n){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=o.exec(n);)e[t[1]]=t[2];return e}const Kp=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Pt(n,e,o,t,a){if(I.isFunction(t))return t.call(this,e,o);if(a&&(e=o),!!I.isString(e)){if(I.isString(t))return e.indexOf(t)!==-1;if(I.isRegExp(t))return t.test(e)}}function Xp(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,t)=>o.toUpperCase()+t)}function Qp(n,e){const o=I.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(n,t+o,{value:function(a,l,c){return this[t].call(this,e,a,l,c)},configurable:!0})})}let Ie=class{constructor(e){e&&this.set(e)}set(e,o,t){const a=this;function l(d,m,u){const h=Ze(m);if(!h)throw new Error("header name must be a non-empty string");const y=I.findKey(a,h);(!y||a[y]===void 0||u===!0||u===void 0&&a[y]!==!1)&&(a[y||m]=ct(d))}const c=(d,m)=>I.forEach(d,(u,h)=>l(u,h,m));if(I.isPlainObject(e)||e instanceof this.constructor)c(e,o);else if(I.isString(e)&&(e=e.trim())&&!Kp(e))c(Wp(e),o);else if(I.isObject(e)&&I.isIterable(e)){let d={},m,u;for(const h of e){if(!I.isArray(h))throw TypeError("Object iterator must return a key-value pair");d[u=h[0]]=(m=d[u])?I.isArray(m)?[...m,h[1]]:[m,h[1]]:h[1]}c(d,o)}else e!=null&&l(o,e,t);return this}get(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);if(t){const a=this[t];if(!o)return a;if(o===!0)return zp(a);if(I.isFunction(o))return o.call(this,a,t);if(I.isRegExp(o))return o.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);return!!(t&&this[t]!==void 0&&(!o||Pt(this,this[t],t,o)))}return!1}delete(e,o){const t=this;let a=!1;function l(c){if(c=Ze(c),c){const d=I.findKey(t,c);d&&(!o||Pt(t,t[d],d,o))&&(delete t[d],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const o=Object.keys(this);let t=o.length,a=!1;for(;t--;){const l=o[t];(!e||Pt(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const o=this,t={};return I.forEach(this,(a,l)=>{const c=I.findKey(t,l);if(c){o[c]=ct(a),delete o[l];return}const d=e?Xp(l):String(l).trim();d!==l&&delete o[l],o[d]=ct(a),t[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return I.forEach(this,(t,a)=>{t!=null&&t!==!1&&(o[a]=e&&I.isArray(t)?t.join(", "):t)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const t=new this(e);return o.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Wt]=this[Wt]={accessors:{}}).accessors,a=this.prototype;function l(c){const d=Ze(c);t[d]||(Qp(a,c),t[d]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};Ie.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Ie.prototype,({value:n},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(t){this[o]=t}}});I.freezeMethods(Ie);function kt(n,e){const o=this||lt,t=e||o,a=Ie.from(t.headers);let l=t.data;return I.forEach(n,function(d){l=d.call(o,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Eo(n){return!!(n&&n.__CANCEL__)}function Qe(n,e,o){te.call(this,n??"canceled",te.ERR_CANCELED,e,o),this.name="CanceledError"}I.inherits(Qe,te,{__CANCEL__:!0});function To(n,e,o){const t=o.config.validateStatus;!o.status||!t||t(o.status)?n(o):e(new te("Request failed with status code "+o.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function Yp(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Zp(n,e){n=n||10;const o=new Array(n),t=new Array(n);let a=0,l=0,c;return e=e!==void 0?e:1e3,function(m){const u=Date.now(),h=t[l];c||(c=u),o[a]=m,t[a]=u;let y=l,F=0;for(;y!==a;)F+=o[y++],y=y%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),u-c<e)return;const O=h&&u-h;return O?Math.round(F*1e3/O):void 0}}function eh(n,e){let o=0,t=1e3/e,a,l;const c=(u,h=Date.now())=>{o=h,a=null,l&&(clearTimeout(l),l=null),n.apply(null,u)};return[(...u)=>{const h=Date.now(),y=h-o;y>=t?c(u,h):(a=u,l||(l=setTimeout(()=>{l=null,c(a)},t-y)))},()=>a&&c(a)]}const pt=(n,e,o=3)=>{let t=0;const a=Zp(50,250);return eh(l=>{const c=l.loaded,d=l.lengthComputable?l.total:void 0,m=c-t,u=a(m),h=c<=d;t=c;const y={loaded:c,total:d,progress:d?c/d:void 0,bytes:m,rate:u||void 0,estimated:u&&d&&h?(d-c)/u:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};n(y)},o)},zt=(n,e)=>{const o=n!=null;return[t=>e[0]({lengthComputable:o,total:n,loaded:t}),e[1]]},Kt=n=>(...e)=>I.asap(()=>n(...e)),th=Ee.hasStandardBrowserEnv?((n,e)=>o=>(o=new URL(o,Ee.origin),n.protocol===o.protocol&&n.host===o.host&&(e||n.port===o.port)))(new URL(Ee.origin),Ee.navigator&&/(msie|trident)/i.test(Ee.navigator.userAgent)):()=>!0,oh=Ee.hasStandardBrowserEnv?{write(n,e,o,t,a,l){const c=[n+"="+encodeURIComponent(e)];I.isNumber(o)&&c.push("expires="+new Date(o).toGMTString()),I.isString(t)&&c.push("path="+t),I.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sh(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function nh(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Co(n,e,o){let t=!sh(e);return n&&(t||o==!1)?nh(n,e):e}const Xt=n=>n instanceof Ie?{...n}:n;function We(n,e){e=e||{};const o={};function t(u,h,y,F){return I.isPlainObject(u)&&I.isPlainObject(h)?I.merge.call({caseless:F},u,h):I.isPlainObject(h)?I.merge({},h):I.isArray(h)?h.slice():h}function a(u,h,y,F){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u,y,F)}else return t(u,h,y,F)}function l(u,h){if(!I.isUndefined(h))return t(void 0,h)}function c(u,h){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u)}else return t(void 0,h)}function d(u,h,y){if(y in e)return t(u,h);if(y in n)return t(void 0,u)}const m={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(u,h,y)=>a(Xt(u),Xt(h),y,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(h){const y=m[h]||a,F=y(n[h],e[h],h);I.isUndefined(F)&&y!==d||(o[h]=F)}),o}const Ro=n=>{const e=We({},n);let{data:o,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:d}=e;e.headers=c=Ie.from(c),e.url=$o(Co(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let m;if(I.isFormData(o)){if(Ee.hasStandardBrowserEnv||Ee.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((m=c.getContentType())!==!1){const[u,...h]=m?m.split(";").map(y=>y.trim()).filter(Boolean):[];c.setContentType([u||"multipart/form-data",...h].join("; "))}}if(Ee.hasStandardBrowserEnv&&(t&&I.isFunction(t)&&(t=t(e)),t||t!==!1&&th(e.url))){const u=a&&l&&oh.read(l);u&&c.set(a,u)}return e},ah=typeof XMLHttpRequest<"u",lh=ah&&function(n){return new Promise(function(o,t){const a=Ro(n);let l=a.data;const c=Ie.from(a.headers).normalize();let{responseType:d,onUploadProgress:m,onDownloadProgress:u}=a,h,y,F,O,x;function w(){O&&O(),x&&x(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let b=new XMLHttpRequest;b.open(a.method.toUpperCase(),a.url,!0),b.timeout=a.timeout;function v(){if(!b)return;const $=Ie.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),f={data:!d||d==="text"||d==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:$,config:n,request:b};To(function(D){o(D),w()},function(D){t(D),w()},f),b=null}"onloadend"in b?b.onloadend=v:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(v)},b.onabort=function(){b&&(t(new te("Request aborted",te.ECONNABORTED,n,b)),b=null)},b.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,n,b)),b=null},b.ontimeout=function(){let _=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||Po;a.timeoutErrorMessage&&(_=a.timeoutErrorMessage),t(new te(_,f.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,n,b)),b=null},l===void 0&&c.setContentType(null),"setRequestHeader"in b&&I.forEach(c.toJSON(),function(_,f){b.setRequestHeader(f,_)}),I.isUndefined(a.withCredentials)||(b.withCredentials=!!a.withCredentials),d&&d!=="json"&&(b.responseType=a.responseType),u&&([F,x]=pt(u,!0),b.addEventListener("progress",F)),m&&b.upload&&([y,O]=pt(m),b.upload.addEventListener("progress",y),b.upload.addEventListener("loadend",O)),(a.cancelToken||a.signal)&&(h=$=>{b&&(t(!$||$.type?new Qe(null,n,b):$),b.abort(),b=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const E=Yp(a.url);if(E&&Ee.protocols.indexOf(E)===-1){t(new te("Unsupported protocol "+E+":",te.ERR_BAD_REQUEST,n));return}b.send(l||null)})},rh=(n,e)=>{const{length:o}=n=n?n.filter(Boolean):[];if(e||o){let t=new AbortController,a;const l=function(u){if(!a){a=!0,d();const h=u instanceof Error?u:this.reason;t.abort(h instanceof te?h:new Qe(h instanceof Error?h.message:h))}};let c=e&&setTimeout(()=>{c=null,l(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const d=()=>{n&&(c&&clearTimeout(c),c=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),n=null)};n.forEach(u=>u.addEventListener("abort",l));const{signal:m}=t;return m.unsubscribe=()=>I.asap(d),m}},ih=function*(n,e){let o=n.byteLength;if(o<e){yield n;return}let t=0,a;for(;t<o;)a=t+e,yield n.slice(t,a),t=a},ch=async function*(n,e){for await(const o of dh(n))yield*ih(o,e)},dh=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:o,value:t}=await e.read();if(o)break;yield t}}finally{await e.cancel()}},Qt=(n,e,o,t)=>{const a=ch(n,e);let l=0,c,d=m=>{c||(c=!0,t&&t(m))};return new ReadableStream({async pull(m){try{const{done:u,value:h}=await a.next();if(u){d(),m.close();return}let y=h.byteLength;if(o){let F=l+=y;o(F)}m.enqueue(new Uint8Array(h))}catch(u){throw d(u),u}},cancel(m){return d(m),a.return()}},{highWaterMark:2})},St=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Io=St&&typeof ReadableStream=="function",uh=St&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Ao=(n,...e)=>{try{return!!n(...e)}catch{return!1}},ph=Io&&Ao(()=>{let n=!1;const e=new Request(Ee.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Yt=64*1024,Mt=Io&&Ao(()=>I.isReadableStream(new Response("").body)),ht={stream:Mt&&(n=>n.body)};St&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ht[e]&&(ht[e]=I.isFunction(n[e])?o=>o[e]():(o,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const hh=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(Ee.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await uh(n)).byteLength},mh=async(n,e)=>{const o=I.toFiniteNumber(n.getContentLength());return o??hh(e)},fh=St&&(async n=>{let{url:e,method:o,data:t,signal:a,cancelToken:l,timeout:c,onDownloadProgress:d,onUploadProgress:m,responseType:u,headers:h,withCredentials:y="same-origin",fetchOptions:F}=Ro(n);u=u?(u+"").toLowerCase():"text";let O=rh([a,l&&l.toAbortSignal()],c),x;const w=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let b;try{if(m&&ph&&o!=="get"&&o!=="head"&&(b=await mh(h,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),k;if(I.isFormData(t)&&(k=f.headers.get("content-type"))&&h.setContentType(k),f.body){const[D,V]=zt(b,pt(Kt(m)));t=Qt(f.body,Yt,D,V)}}I.isString(y)||(y=y?"include":"omit");const v="credentials"in Request.prototype;x=new Request(e,{...F,signal:O,method:o.toUpperCase(),headers:h.normalize().toJSON(),body:t,duplex:"half",credentials:v?y:void 0});let E=await fetch(x);const $=Mt&&(u==="stream"||u==="response");if(Mt&&(d||$&&w)){const f={};["status","statusText","headers"].forEach(T=>{f[T]=E[T]});const k=I.toFiniteNumber(E.headers.get("content-length")),[D,V]=d&&zt(k,pt(Kt(d),!0))||[];E=new Response(Qt(E.body,Yt,D,()=>{V&&V(),w&&w()}),f)}u=u||"text";let _=await ht[I.findKey(ht,u)||"text"](E,n);return!$&&w&&w(),await new Promise((f,k)=>{To(f,k,{data:_,headers:Ie.from(E.headers),status:E.status,statusText:E.statusText,config:n,request:x})})}catch(v){throw w&&w(),v&&v.name==="TypeError"&&/Load failed|fetch/i.test(v.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,n,x),{cause:v.cause||v}):te.from(v,v&&v.code,n,x)}}),Ft={http:Ip,xhr:lh,fetch:fh};I.forEach(Ft,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Zt=n=>`- ${n}`,gh=n=>I.isFunction(n)||n===null||n===!1,xo={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let o,t;const a={};for(let l=0;l<e;l++){o=n[l];let c;if(t=o,!gh(o)&&(t=Ft[(c=String(o)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${c}'`);if(t)break;a[c||"#"+l]=t}if(!t){const l=Object.entries(a).map(([d,m])=>`adapter ${d} `+(m===!1?"is not supported by the environment":"is not available in the build"));let c=e?l.length>1?`since :
`+l.map(Zt).join(`
`):" "+Zt(l[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return t},adapters:Ft};function Et(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Qe(null,n)}function eo(n){return Et(n),n.headers=Ie.from(n.headers),n.data=kt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),xo.getAdapter(n.adapter||lt.adapter)(n).then(function(t){return Et(n),t.data=kt.call(n,n.transformResponse,t),t.headers=Ie.from(t.headers),t},function(t){return Eo(t)||(Et(n),t&&t.response&&(t.response.data=kt.call(n,n.transformResponse,t.response),t.response.headers=Ie.from(t.response.headers))),Promise.reject(t)})}const Mo="1.9.0",wt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{wt[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const to={};wt.transitional=function(e,o,t){function a(l,c){return"[Axios v"+Mo+"] Transitional option '"+l+"'"+c+(t?". "+t:"")}return(l,c,d)=>{if(e===!1)throw new te(a(c," has been removed"+(o?" in "+o:"")),te.ERR_DEPRECATED);return o&&!to[c]&&(to[c]=!0,console.warn(a(c," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(l,c,d):!0}};wt.spelling=function(e){return(o,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function vh(n,e,o){if(typeof n!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(n);let a=t.length;for(;a-- >0;){const l=t[a],c=e[l];if(c){const d=n[l],m=d===void 0||c(d,l,n);if(m!==!0)throw new te("option "+l+" must be "+m,te.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new te("Unknown option "+l,te.ERR_BAD_OPTION)}}const dt={assertOptions:vh,validators:wt},Le=dt.validators;let Je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jt,response:new Jt}}async request(e,o){try{return await this._request(e,o)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=We(this.defaults,o);const{transitional:t,paramsSerializer:a,headers:l}=o;t!==void 0&&dt.assertOptions(t,{silentJSONParsing:Le.transitional(Le.boolean),forcedJSONParsing:Le.transitional(Le.boolean),clarifyTimeoutError:Le.transitional(Le.boolean)},!1),a!=null&&(I.isFunction(a)?o.paramsSerializer={serialize:a}:dt.assertOptions(a,{encode:Le.function,serialize:Le.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),dt.assertOptions(o,{baseUrl:Le.spelling("baseURL"),withXsrfToken:Le.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let c=l&&I.merge(l.common,l[o.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],x=>{delete l[x]}),o.headers=Ie.concat(c,l);const d=[];let m=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(o)===!1||(m=m&&w.synchronous,d.unshift(w.fulfilled,w.rejected))});const u=[];this.interceptors.response.forEach(function(w){u.push(w.fulfilled,w.rejected)});let h,y=0,F;if(!m){const x=[eo.bind(this),void 0];for(x.unshift.apply(x,d),x.push.apply(x,u),F=x.length,h=Promise.resolve(o);y<F;)h=h.then(x[y++],x[y++]);return h}F=d.length;let O=o;for(y=0;y<F;){const x=d[y++],w=d[y++];try{O=x(O)}catch(b){w.call(this,b);break}}try{h=eo.call(this,O)}catch(x){return Promise.reject(x)}for(y=0,F=u.length;y<F;)h=h.then(u[y++],u[y++]);return h}getUri(e){e=We(this.defaults,e);const o=Co(e.baseURL,e.url,e.allowAbsoluteUrls);return $o(o,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Je.prototype[e]=function(o,t){return this.request(We(t||{},{method:e,url:o,data:(t||{}).data}))}});I.forEach(["post","put","patch"],function(e){function o(t){return function(l,c,d){return this.request(We(d||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}Je.prototype[e]=o(),Je.prototype[e+"Form"]=o(!0)});let bh=class Fo{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(l){o=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(d=>{t.subscribe(d),l=d}).then(a);return c.cancel=function(){t.unsubscribe(l)},c},e(function(l,c,d){t.reason||(t.reason=new Qe(l,c,d),o(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=t=>{e.abort(t)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new Fo(function(a){e=a}),cancel:e}}};function yh(n){return function(o){return n.apply(null,o)}}function _h(n){return I.isObject(n)&&n.isAxiosError===!0}const Dt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dt).forEach(([n,e])=>{Dt[e]=n});function Do(n){const e=new Je(n),o=uo(Je.prototype.request,e);return I.extend(o,Je.prototype,e,{allOwnKeys:!0}),I.extend(o,e,null,{allOwnKeys:!0}),o.create=function(a){return Do(We(n,a))},o}const we=Do(lt);we.Axios=Je;we.CanceledError=Qe;we.CancelToken=bh;we.isCancel=Eo;we.VERSION=Mo;we.toFormData=_t;we.AxiosError=te;we.Cancel=we.CanceledError;we.all=function(e){return Promise.all(e)};we.spread=yh;we.isAxiosError=_h;we.mergeConfig=We;we.AxiosHeaders=Ie;we.formToJSON=n=>ko(I.isHTMLForm(n)?new FormData(n):n);we.getAdapter=xo.getAdapter;we.HttpStatusCode=Dt;we.default=we;const{Axios:fg,AxiosError:gg,CanceledError:vg,isCancel:bg,CancelToken:yg,VERSION:_g,all:Sg,Cancel:wg,isAxiosError:$g,spread:Pg,toFormData:kg,AxiosHeaders:Eg,HttpStatusCode:Tg,formToJSON:Cg,getAdapter:Rg,mergeConfig:Ig}=we;class Sh{static async getAvailableModels(){try{return(await we({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const wh={class:"assigned-tools"},$h={class:"section-header"},Ph={class:"tool-info"},kh={class:"tool-name"},Eh={class:"tool-desc"},Th={key:0,class:"no-tools"},Ch=be({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const o=n,t=e,a=ue(()=>Array.isArray(o.selectedToolIds)?o.selectedToolIds.filter(d=>o.availableTools.some(m=>m.key===d)):[]);me(a,d=>{const m=o.selectedToolIds.length;d.length!==m&&t("tools-filtered",d)},{immediate:!0});const l=d=>{const m=o.availableTools.find(h=>h.key===d);return m?`${m.serviceGroup||"Ungrouped"}.${m.name}`:d},c=d=>{const m=o.availableTools.find(u=>u.key===d);return m?m.description:""};return(d,m)=>(p(),g("div",wh,[s("div",$h,[s("span",null,i(d.title)+" ("+i(a.value.length)+")",1),d.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:m[0]||(m[0]=u=>d.$emit("add-tools"))},[C(r(R),{icon:"carbon:add"}),le(" "+i(d.addButtonText),1)])):B("",!0)]),s("div",{class:ae(["tools-grid",{"grid-layout":d.useGridLayout}])},[(p(!0),g(de,null,pe(a.value,u=>(p(),g("div",{key:u,class:"tool-item assigned"},[s("div",Ph,[s("span",kh,i(l(u)),1),s("span",Eh,i(c(u)),1)])]))),128)),a.value.length===0?(p(),g("div",Th,[C(r(R),{icon:"carbon:tool-box"}),s("span",null,i(d.emptyText),1)])):B("",!0)],2)]))}}),Rh=ye(Ch,[["__scopeId","data-v-10f40d60"]]),Ih={class:"tool-selection-content"},Ah={class:"tool-controls"},xh={class:"search-container"},Mh=["placeholder"],Fh={class:"sort-container"},Dh={value:"group"},Nh={value:"name"},Uh={value:"enabled"},Lh={class:"tool-summary"},Oh={class:"summary-text"},Bh={key:0,class:"tool-groups"},qh=["onClick"],jh={class:"group-title-area"},Vh={class:"group-name"},Gh={class:"group-count"},Hh={class:"group-enable-all"},Jh=["checked","onChange","data-group"],Wh={class:"enable-label"},zh={class:"tool-info"},Kh={class:"tool-selection-name"},Xh={key:0,class:"tool-selection-desc"},Qh={class:"tool-actions"},Yh=["checked","onChange"],Zh={key:1,class:"empty-state"},em=be({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const o=n,t=e,a=ue({get:()=>o.modelValue,set:k=>t("update:modelValue",k)}),l=N(""),c=N("group"),d=N(new Set),m=N([]),u=(k,D)=>{const V=document.querySelector(`input[data-group="${k}"]`);V&&(V.indeterminate=v(D))};me(()=>o.selectedToolIds,k=>{m.value=[...k]},{immediate:!0});const h=ue(()=>{let k=o.tools.filter(D=>D.key);if(k=k.filter(D=>D.selectable===!0),l.value){const D=l.value.toLowerCase();k=k.filter(V=>V.name.toLowerCase().includes(D)||V.description.toLowerCase().includes(D)||V.serviceGroup.toLowerCase().includes(D))}switch(c.value){case"name":k=[...k].sort((D,V)=>D.name.localeCompare(V.name));break;case"enabled":k=[...k].sort((D,V)=>{const T=m.value.includes(D.key),M=m.value.includes(V.key);return T&&!M?-1:!T&&M?1:D.name.localeCompare(V.name)});break;case"group":default:k=[...k].sort((D,V)=>{const T=D.serviceGroup||"Ungrouped",M=V.serviceGroup||"Ungrouped";return T!==M?T.localeCompare(M):D.name.localeCompare(V.name)});break}return k}),y=ue(()=>{const k=new Map;return h.value.forEach(D=>{const V=D.serviceGroup||"Ungrouped";k.has(V)||k.set(V,[]),k.get(V).push(D)}),new Map([...k.entries()].sort())}),F=ue(()=>h.value.length);me([m,y],()=>{Ce(()=>{for(const[k,D]of y.value)u(k,D)})},{flush:"post",deep:!1});const O=k=>m.value.includes(k),x=(k,D)=>{D.stopPropagation();const T=D.target.checked;if(!k){console.error("toolKey is undefined, cannot proceed");return}T?m.value.includes(k)||(m.value=[...m.value,k]):m.value=m.value.filter(M=>M!==k)},w=k=>k.filter(D=>m.value.includes(D.key)),b=k=>k.length>0&&k.every(D=>m.value.includes(D.key)),v=k=>{const D=w(k).length;return D>0&&D<k.length},E=(k,D)=>{D.stopPropagation();const T=D.target.checked,M=k.map(G=>G.key);if(T){const G=[...m.value];M.forEach(Y=>{G.includes(Y)||G.push(Y)}),m.value=G}else m.value=m.value.filter(G=>!M.includes(G))},$=k=>{d.value.has(k)?d.value.delete(k):d.value.add(k)},_=()=>{t("confirm",[...m.value]),t("update:modelValue",!1)},f=()=>{m.value=[...o.selectedToolIds],t("update:modelValue",!1)};return me(a,k=>{if(k){d.value.clear();const D=Array.from(y.value.keys());D.length>1&&D.slice(1).forEach(V=>{d.value.add(V)})}}),(k,D)=>(p(),he(ao,{modelValue:a.value,"onUpdate:modelValue":[D[4]||(D[4]=V=>a.value=V),f],title:k.$t("toolSelection.title"),onConfirm:_},{default:Ke(()=>[s("div",Ih,[s("div",Ah,[s("div",xh,[ie(s("input",{"onUpdate:modelValue":D[0]||(D[0]=V=>l.value=V),type:"text",class:"search-input",placeholder:k.$t("toolSelection.searchPlaceholder")},null,8,Mh),[[ve,l.value]])]),s("div",Fh,[ie(s("select",{"onUpdate:modelValue":D[1]||(D[1]=V=>c.value=V),class:"sort-select"},[s("option",Dh,i(k.$t("toolSelection.sortByGroup")),1),s("option",Nh,i(k.$t("toolSelection.sortByName")),1),s("option",Uh,i(k.$t("toolSelection.sortByStatus")),1)],512),[[mt,c.value]])])]),s("div",Lh,[s("span",Oh,i(k.$t("toolSelection.summary",{groups:y.value.size,tools:F.value,selected:m.value.length})),1)]),y.value.size>0?(p(),g("div",Bh,[(p(!0),g(de,null,pe(y.value,([V,T])=>(p(),g("div",{key:V,class:"tool-group"},[s("div",{class:ae(["tool-group-header",{collapsed:d.value.has(V)}]),onClick:M=>$(V)},[s("div",jh,[C(r(R),{icon:d.value.has(V)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),C(r(R),{icon:"carbon:folder",class:"group-icon"}),s("span",Vh,i(V),1),s("span",Gh," ("+i(w(T).length)+"/"+i(T.length)+") ",1)]),s("div",{class:"group-actions",onClick:D[2]||(D[2]=Se(()=>{},["stop"]))},[s("label",Hh,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:b(T),onChange:M=>E(T,M),"data-group":V},null,40,Jh),s("span",Wh,i(k.$t("toolSelection.enableAll")),1)])])],10,qh),s("div",{class:ae(["tool-group-content",{collapsed:d.value.has(V)}])},[(p(!0),g(de,null,pe(T,M=>(p(),g("div",{key:M.key,class:"tool-selection-item"},[s("div",zh,[s("div",Kh,i(M.name),1),M.description?(p(),g("div",Xh,i(M.description),1)):B("",!0)]),s("div",Qh,[s("label",{class:"tool-enable-switch",onClick:D[3]||(D[3]=Se(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:O(M.key),onChange:G=>x(M.key,G)},null,40,Yh),D[5]||(D[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",Zh,[C(r(R),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,i(k.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),tm=ye(em,[["__scopeId","data-v-197aa115"]]),om={class:"config-section"},sm={class:"section-header"},nm={key:0,class:"error-section"},am={class:"error-message"},lm={class:"error-content"},rm={class:"error-title"},im={class:"error-description"},cm={key:1,class:"visual-editor"},dm={class:"plan-basic-info"},um={class:"form-row"},pm={class:"form-label"},hm=["placeholder"],mm={key:0,class:"field-error-message"},fm={class:"form-row"},gm={class:"form-label"},vm=["value","placeholder"],bm={class:"steps-section"},ym={class:"steps-header"},_m={class:"form-label"},Sm={class:"steps-actions"},wm=["title"],$m={class:"steps-container"},Pm={class:"step-header"},km={class:"step-number"},Em={class:"step-actions"},Tm=["onClick","disabled","title"],Cm=["onClick","disabled","title"],Rm=["onClick","title"],Im={class:"step-content"},Am={class:"form-row"},xm={class:"form-label"},Mm=["onUpdate:modelValue","placeholder"],Fm={class:"form-row"},Dm={class:"form-label"},Nm=["onUpdate:modelValue","placeholder"],Um={key:0,class:"preview-section"},Lm={class:"preview-label"},Om={class:"preview-content"},Bm={class:"preview-text"},qm={class:"preview-table-header"},jm={class:"form-row"},Vm={class:"form-label"},Gm={class:"model-selector-wrapper"},Hm={class:"model-input-wrapper"},Jm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Wm={key:0,class:"dropdown-item disabled"},zm={key:1,class:"dropdown-item disabled error"},Km={key:2,class:"dropdown-item disabled"},Xm=["onClick","onMouseenter"],Qm=["onClick","onMouseenter"],Ym=["title"],Zm={key:0,class:"error-message"},ef={class:"form-row"},tf={key:0,class:"empty-steps"},of={key:0,class:"json-preview"},sf={class:"preview-header"},nf={class:"form-label"},af={class:"json-code"},lf={class:"editor-footer"},rf={class:"section-actions"},cf=["disabled","title"],df=["disabled","title"],uf=["disabled","title"],pf=["disabled"],hf=be({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(n,{emit:e}){const{t:o}=Me(),t=n,a=e,l={...t,hiddenFields:[]},{showJsonPreview:c,displayData:d,formattedJsonOutput:m,addStep:u,removeStep:h,moveStepUp:y,moveStepDown:F,handleRollback:O,handleRestore:x,handleSave:w,toggleJsonPreview:b,closeJsonPreview:v}=co(l,a),E=N(null),$=N(""),_=N([]),f=N(!1),k=N(""),D=N(new Map),V=N(new Set),T=N(new Map),M=S=>D.value.get(S)??"",G=(S,J)=>{D.value.set(S,J)},Y=S=>{const J=M(S);if(!J.trim())return _.value;const se=J.toLowerCase().trim();return _.value.filter(oe=>oe.value.toLowerCase().includes(se)||oe.label.toLowerCase().includes(se))},Q=S=>{const J=d.steps[S],se=M(S);return V.value.has(S)&&se!==""?se:J.modelName??""},z=S=>f.value||k.value||d.steps[S].modelName?"":o("sidebar.modelNameDescription")||"",K=S=>V.value.has(S),ne=S=>{f.value||V.value.add(S)},fe=S=>{V.value.delete(S),T.value.set(S,-1);const J=d.steps[S];G(S,J.modelName??"")},X=S=>{K(S)?fe(S):ne(S)},q=(S,J)=>{const se=d.steps[J];se.modelName=S,G(J,S),fe(J)},j=(S,J)=>{const se=S.target;G(J,se.value),ne(J)},U=S=>T.value.get(S)??-1,A=(S,J)=>{T.value.set(S,J)},L=S=>{const J=U(S),se=Y(S);J>=0&&J<se.length?q(se[J].value,S):J===-1?q("",S):se.length>0?q(se[0].value,S):d.steps[S].modelName||q("",S)},Z=S=>{if(!K(S)){ne(S),A(S,0);return}const se=Y(S).length+1,oe=U(S),re=Math.min(oe+1,se-1);A(S,re)},P=S=>{if(!K(S)){ne(S);const oe=Y(S);A(S,oe.length);return}const J=U(S),se=Math.max(J-1,-1);A(S,se)},W=S=>{S.target.closest(".model-selector")||V.value.clear()};me(()=>d.steps,S=>{S.forEach((J,se)=>{D.value.has(se)||G(se,J.modelName??"")})},{deep:!0,immediate:!0});const ge=N(!1),ee=N(-1),_e=async()=>{if(!f.value){f.value=!0,k.value="";try{const S=await Sh.getAvailableModels();_.value=S.options}catch(S){console.error("Failed to load models:",S),k.value=S instanceof Error?S.message:"Failed to load models",_.value=[]}finally{f.value=!1}}},Fe=S=>{ee.value=S,ge.value=!0,console.log("[JsonEditorV2] Available tools from store:",H.availableTools)},qe=S=>{ee.value>=0&&ee.value<d.steps.length&&(d.steps[ee.value].selectedToolKeys=[...S]),ge.value=!1,ee.value=-1},je=(S,J)=>{S>=0&&S<d.steps.length&&(d.steps[S].selectedToolKeys=[...J])},De=()=>{a("copy-plan")},$e=()=>{try{E.value=null,d.title||(d.title=""),d.directResponse=!1}catch(S){const J=`Failed to initialize JsonEditorV2: ${S instanceof Error?S.message:"Unknown error"}`;E.value=J,console.error(J,S)}};me(()=>d,S=>{try{S.title.trim()?$.value="":$.value="Title is required field",E.value=null}catch(J){E.value=`Invalid data structure: ${J instanceof Error?J.message:"Unknown error"}`,$.value=""}},{immediate:!0,deep:!0}),me(()=>t.jsonContent,(S,J)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",J,"to",S),S&&S!==J){console.log("[JsonEditorV2] Force parsing new jsonContent:",S);try{const se=JSON.parse(S);console.log("[JsonEditorV2] Parsed new jsonContent:",se),Object.assign(d,{title:se.title||"",steps:se.steps||[],directResponse:!1,planTemplateId:se.planTemplateId||t.currentPlanTemplateId||"",planType:se.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",d)}catch(se){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",se)}}},{immediate:!0}),Ae(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",d),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const S=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",S),Object.assign(d,{title:S.title||"",steps:S.steps||[],directResponse:!1,planTemplateId:S.planTemplateId||t.currentPlanTemplateId||"",planType:S.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",d)}catch(S){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",S)}}$e(),_e(),document.addEventListener("click",W)}),xe(()=>{document.removeEventListener("click",W)});const Te=S=>{const J=S.target;J.style.height="auto";const se=20,oe=Math.ceil(J.scrollHeight/se),re=4,ce=12,Ye=Math.max(re,Math.min(ce,oe)),$t=Ye*se;J.style.height=`${$t}px`,J.rows=Ye,oe>ce?J.style.overflowY="auto":J.style.overflowY="hidden"},Pe=S=>{if(!S.trim())return"";const J=S.split(",").map(se=>se.trim()).filter(se=>se.length>0);return J.length===0?"":`|${J.join("|")}|`};return(S,J)=>{var se;return p(),g("div",om,[s("div",sm,[C(r(R),{icon:"carbon:code",width:"16"}),s("span",null,i(S.$t("sidebar.dynamicAgentPlan")),1)]),E.value?(p(),g("div",nm,[s("div",am,[C(r(R),{icon:"carbon:warning",width:"16"}),s("div",lm,[s("div",rm,i(S.$t("sidebar.planTypeError")),1),s("div",im,i(E.value),1)])])])):(p(),g("div",cm,[s("div",dm,[s("div",um,[s("label",pm,i(S.$t("sidebar.title")),1),ie(s("input",{"onUpdate:modelValue":J[0]||(J[0]=oe=>r(d).title=oe),type:"text",class:ae(["form-input",{error:$.value}]),placeholder:S.$t("sidebar.titlePlaceholder")},null,10,hm),[[ve,r(d).title]]),$.value?(p(),g("div",mm,[C(r(R),{icon:"carbon:warning",width:"12"}),le(" "+i($.value),1)])):B("",!0)]),s("div",fm,[s("label",gm,i(S.$t("sidebar.planTemplateId")),1),s("input",{value:S.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:S.$t("sidebar.planTemplateIdPlaceholder")},null,8,vm)])]),s("div",bm,[s("div",ym,[s("label",_m,i(S.$t("sidebar.tasks")),1),s("div",Sm,[s("button",{onClick:J[1]||(J[1]=(...oe)=>r(u)&&r(u)(...oe)),class:"btn btn-xs",title:S.$t("sidebar.addStep")},[C(r(R),{icon:"carbon:add",width:"12"})],8,wm)])]),s("div",$m,[(p(!0),g(de,null,pe(r(d).steps,(oe,re)=>(p(),g("div",{key:re,class:"step-item"},[s("div",Pm,[s("span",km,i(S.$t("sidebar.subtask"))+" "+i(re+1),1),s("div",Em,[s("button",{onClick:ce=>r(y)(re),disabled:re===0,class:"btn btn-xs",title:S.$t("sidebar.moveUp")},[C(r(R),{icon:"carbon:chevron-up",width:"12"})],8,Tm),s("button",{onClick:ce=>r(F)(re),disabled:re===r(d).steps.length-1,class:"btn btn-xs",title:S.$t("sidebar.moveDown")},[C(r(R),{icon:"carbon:chevron-down",width:"12"})],8,Cm),s("button",{onClick:ce=>r(h)(re),class:"btn btn-xs btn-danger",title:S.$t("sidebar.removeStep")},[C(r(R),{icon:"carbon:trash-can",width:"12"})],8,Rm)])]),s("div",Im,[s("div",Am,[s("label",xm,i(S.$t("sidebar.stepRequirement")),1),ie(s("textarea",{"onUpdate:modelValue":ce=>oe.stepRequirement=ce,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:J[2]||(J[2]=ce=>Te(ce))},null,40,Mm),[[ve,oe.stepRequirement]])]),s("div",Fm,[s("label",Dm,i(S.$t("sidebar.terminateColumns")),1),ie(s("textarea",{"onUpdate:modelValue":ce=>oe.terminateColumns=ce,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:J[3]||(J[3]=ce=>Te(ce))},null,40,Nm),[[ve,oe.terminateColumns]]),oe.terminateColumns&&oe.terminateColumns.trim()?(p(),g("div",Um,[s("div",Lm,i(S.$t("sidebar.preview"))+":",1),s("div",Om,[s("div",Bm,[le(i(S.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),s("span",qm,i(Pe(oe.terminateColumns)),1)])])])):B("",!0)]),s("div",jm,[s("label",Vm,i(S.$t("sidebar.modelName")),1),s("div",Gm,[s("div",{class:ae(["model-selector",{"is-open":K(re),"is-disabled":f.value}])},[s("div",Hm,[s("input",{value:Q(re),type:"text",class:"form-input model-search-input",placeholder:z(re),disabled:f.value,onClick:Se(ce=>ne(re),["stop"]),onFocus:ce=>ne(re),onInput:ce=>j(ce,re),onKeydown:[et(ce=>fe(re),["escape"]),et(Se(ce=>L(re),["prevent"]),["enter"]),et(Se(ce=>Z(re),["prevent"]),["down"]),et(Se(ce=>P(re),["prevent"]),["up"])]},null,40,Jm),C(r(R),{icon:"carbon:chevron-down",width:"14",class:ae(["dropdown-arrow",{"is-open":K(re)}]),onClick:Se(ce=>X(re),["stop"])},null,8,["class","onClick"])]),K(re)?(p(),g("div",{key:0,class:"model-dropdown",onClick:J[4]||(J[4]=Se(()=>{},["stop"]))},[f.value?(p(),g("div",Wm,i(S.$t("sidebar.loading")),1)):k.value?(p(),g("div",zm,i(S.$t("sidebar.modelLoadError")),1)):Y(re).length===0?(p(),g("div",Km,i(S.$t("sidebar.noModelsFound")),1)):B("",!0),(p(!0),g(de,null,pe(Y(re),(ce,Ye)=>(p(),g("div",{key:ce.value,class:ae(["dropdown-item",{"is-selected":oe.modelName===ce.value,"is-highlighted":U(re)===Ye}]),onClick:$t=>q(ce.value,re),onMouseenter:$t=>A(re,Ye)},[le(i(ce.value)+" ",1),oe.modelName===ce.value?(p(),he(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):B("",!0)],42,Xm))),128)),s("div",{class:ae(["dropdown-item",{"is-selected":!oe.modelName,"is-highlighted":U(re)===-1}]),onClick:ce=>q("",re),onMouseenter:ce=>A(re,-1)},[le(i(S.$t("sidebar.noModelSelected"))+" ",1),oe.modelName?B("",!0):(p(),he(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Qm)])):B("",!0)],2),k.value?(p(),g("button",{key:0,onClick:_e,class:"btn btn-sm btn-danger",title:S.$t("sidebar.retryLoadModels")},[C(r(R),{icon:"carbon:warning",width:"14"}),le(" "+i(S.$t("sidebar.retry")),1)],8,Ym)):B("",!0)]),k.value?(p(),g("div",Zm,[C(r(R),{icon:"carbon:warning",width:"12"}),le(" "+i(k.value),1)])):B("",!0)]),s("div",ef,[C(Rh,{title:S.$t("sidebar.selectedTools"),"selected-tool-ids":oe.selectedToolKeys,"available-tools":r(H).availableTools,"add-button-text":S.$t("sidebar.addRemoveTools"),"empty-text":S.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ce=>Fe(re),onToolsFiltered:ce=>je(re,ce)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(d).steps.length===0?(p(),g("div",tf,[C(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(S.$t("sidebar.noSteps")),1),s("button",{onClick:J[5]||(J[5]=(...oe)=>r(u)&&r(u)(...oe)),class:"btn btn-primary"},[C(r(R),{icon:"carbon:add",width:"14"}),le(" "+i(S.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r(c)?(p(),g("div",of,[s("div",sf,[s("label",nf,i(S.$t("sidebar.jsonPreview")),1),s("button",{onClick:J[6]||(J[6]=(...oe)=>r(v)&&r(v)(...oe)),class:"btn btn-xs"},[C(r(R),{icon:"carbon:close",width:"12"})])]),s("pre",af,i(r(m)),1)])):B("",!0),s("div",lf,[s("button",{onClick:J[7]||(J[7]=(...oe)=>r(b)&&r(b)(...oe)),class:"btn btn-sm btn-secondary"},[C(r(R),{icon:"carbon:code",width:"14"}),le(" "+i(r(c)?S.$t("sidebar.hideJson"):S.$t("sidebar.showJson")),1)]),s("div",rf,[s("button",{class:"btn btn-sm",onClick:De,disabled:S.isGenerating||S.isExecuting,title:S.$t("sidebar.copyPlan")},[C(r(R),{icon:"carbon:copy",width:"14"}),le(" "+i(S.$t("sidebar.copyPlan")),1)],8,cf),s("button",{class:"btn btn-sm",onClick:J[8]||(J[8]=(...oe)=>r(O)&&r(O)(...oe)),disabled:!(S.canRollback??!1),title:S.$t("sidebar.rollback")},[C(r(R),{icon:"carbon:undo",width:"14"})],8,df),s("button",{class:"btn btn-sm",onClick:J[9]||(J[9]=(...oe)=>r(x)&&r(x)(...oe)),disabled:!(S.canRestore??!1),title:S.$t("sidebar.restore")},[C(r(R),{icon:"carbon:redo",width:"14"})],8,uf),s("button",{class:"btn btn-primary",onClick:J[10]||(J[10]=(...oe)=>r(w)&&r(w)(...oe)),disabled:S.isGenerating||S.isExecuting},[C(r(R),{icon:"carbon:save",width:"14"}),J[12]||(J[12]=le(" Save "))],8,pf)])])])),C(tm,{modelValue:ge.value,"onUpdate:modelValue":J[11]||(J[11]=oe=>ge.value=oe),tools:r(H).availableTools,"selected-tool-ids":ee.value>=0?((se=r(d).steps[ee.value])==null?void 0:se.selectedToolKeys)||[]:[],onConfirm:qe},null,8,["modelValue","tools","selected-tool-ids"])])}}}),mf=ye(hf,[["__scopeId","data-v-91854736"]]),ff={class:"sidebar-content"},gf={class:"sidebar-content-header"},vf={class:"sidebar-content-title"},bf={class:"tab-switcher"},yf=["disabled"],_f={key:0,class:"tab-content"},Sf={class:"new-task-section"},wf={class:"sidebar-content-list"},$f={key:0,class:"loading-state"},Pf={key:1,class:"error-state"},kf={key:2,class:"empty-state"},Ef=["onClick"],Tf={class:"task-icon"},Cf={class:"task-details"},Rf={class:"task-title"},If={class:"task-preview"},Af={class:"task-time"},xf={class:"task-actions"},Mf=["title","onClick"],Ff={key:1,class:"tab-content config-tab"},Df={key:0,class:"config-container"},Nf={class:"template-info-header"},Uf={class:"template-info"},Lf={class:"template-id"},Of=["title"],Bf={class:"modal-header"},qf={class:"modal-body"},jf={class:"form-row"},Vf={class:"form-label"},Gf=["placeholder"],Hf={class:"modal-footer"},Jf=["disabled"],Wf=be({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:o}){const{t}=Me(),a=Wo(),l=N(80),c=N(!1),d=N(0),m=N(0),u=N(null),h=N({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),y=N({}),F=N(null),O=N({enabled:!0,success:!0}),x=ue(()=>O.value.enabled);me(()=>H.currentPlanTemplateId,(P,W)=>{console.log("[Sidebar] currentPlanTemplateId changed from",W,"to",P)}),me(()=>H.jsonContent,(P,W)=>{console.log("[Sidebar] jsonContent changed from",W,"to",P)});const w=async()=>{try{const P=await Ne.getCoordinatorToolConfig();O.value=P}catch(P){console.error("Failed to load CoordinatorTool configuration:",P),O.value={enabled:!0,success:!1,message:P instanceof Error?P.message:"Unknown error"}}},b=o,v=async()=>{try{const P=await H.saveTemplate();P!=null&&P.duplicate?a.success(t("sidebar.saveCompleted",{message:P.message,versionCount:P.versionCount})):P!=null&&P.saved?(a.success(t("sidebar.saveSuccess",{message:P.message,versionCount:P.versionCount})),E()):P!=null&&P.message&&a.success(t("sidebar.saveStatus",{message:P.message}))}catch(P){console.error("Failed to save plan modifications:",P),a.error(P.message||t("sidebar.saveFailed"))}},E=async()=>{await new Promise(P=>setTimeout(P,1e3)),console.log("[Sidebar]  Refreshing parameter requirements for templateId:",H.currentPlanTemplateId),await Ce(),u.value?(console.log("[Sidebar]  Calling ExecutionController.loadParameterRequirements()"),u.value.loadParameterRequirements(),setTimeout(()=>{u.value&&(console.log("[Sidebar]  Retry: Calling ExecutionController.loadParameterRequirements() again"),u.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar]  ExecutionController ref not available"),F.value?(console.log("[Sidebar]  Calling PublishMcpServiceModal.loadParameterRequirements()"),F.value.loadParameterRequirements()):console.warn("[Sidebar]  PublishMcpServiceModal ref not available")},$=()=>{try{typeof H.rollbackVersion=="function"?H.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(P){console.error("Error during rollback operation:",P),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},_=()=>{try{typeof H.restoreVersion=="function"?H.restoreVersion():console.warn("restoreVersion method is not available")}catch(P){console.error("Error during restore operation:",P),a.error(t("sidebar.restoreFailed")||"Restore failed")}},f=async P=>{var W;console.log("[Sidebar]  handleExecutePlan called with payload:",JSON.stringify(P,null,2)),console.log("[Sidebar]  Current sidebarStore state:",{currentPlanTemplateId:H.currentPlanTemplateId,selectedTemplate:(W=H.selectedTemplate)==null?void 0:W.id,jsonContent:H.jsonContent.substring(0,100)+"..."});try{const ge=H.preparePlanExecution();if(console.log("[Sidebar]  Prepared plan data:",JSON.stringify(ge,null,2)),!ge){console.log("[Sidebar]  No plan data available, returning");return}const ee={...ge,uploadedFiles:P.uploadedFiles,uploadKey:P.uploadKey};P.replacementParams&&Object.keys(P.replacementParams).length>0&&(console.log("[Sidebar]  Processing replacement parameters:",P.replacementParams),ee.replacementParams=P.replacementParams),console.log("[Sidebar]  Final plan data:",JSON.stringify(ee,null,2));const _e={...P,title:ee.title,planData:ee.planData,params:ee.params,uploadedFiles:ee.uploadedFiles,uploadKey:ee.uploadKey};console.log("[Sidebar]  Emitting planExecutionRequested with final payload:",JSON.stringify(_e,null,2)),b("planExecutionRequested",_e),console.log("[Sidebar]  Event emitted successfully")}catch(ge){console.error("[Sidebar]  Error executing plan:",ge),a.error(t("sidebar.executeFailed")+": "+ge.message)}finally{console.log("[Sidebar]  Cleaning up after execution"),H.finishPlanExecution(),H.clearExecutionParams(),u.value&&(console.log("[Sidebar]  Calling ExecutionController.clearExecutionParams"),u.value.clearExecutionParams()),console.log("[Sidebar]  Cleanup completed")}},k=N(!1),D=N(!1),V=N(""),T=N(!1),M=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",H.currentPlanTemplateId),!H.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),k.value=!0},G=async P=>{P===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",P),a.success(t("mcpService.publishSuccess")),h.value={...P,toolName:P.toolName,serviceGroup:P.serviceGroup??""}),console.log("[Sidebar]  Reloading available tools after service publish/delete"),await H.loadAvailableTools(),await j()},Y=()=>{H.clearExecutionParams()},Q=P=>{H.executionParams=P},z=()=>{if(console.log("[Sidebar] Copy plan clicked"),!H.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(t("sidebar.selectPlanFirst"));return}V.value=(H.selectedTemplate.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),D.value=!0},K=()=>{D.value=!1,V.value="",T.value=!1},ne=async()=>{if(!V.value.trim()){a.error(t("sidebar.titleRequired"));return}if(!H.selectedTemplate||!H.jsonContent){a.error(t("sidebar.noPlanToCopy"));return}T.value=!0;try{const W={...JSON.parse(H.jsonContent),title:V.value.trim(),planTemplateId:""},{PlanActApiService:ge}=await no(async()=>{const{PlanActApiService:_e}=await import("./sidebar-9kmvVBVq.js").then(Fe=>Fe.p);return{PlanActApiService:_e}},__vite__mapDeps([0,1,2,3])),ee=await ge.savePlanTemplate("",JSON.stringify(W));ee.saved?(a.success(t("sidebar.copyPlanSuccess",{title:V.value.trim()})),await H.loadPlanTemplateList(),K()):a.error(t("sidebar.copyPlanFailed",{message:ee.message||"Unknown error"}))}catch(P){console.error("[Sidebar] Error copying plan:",P),a.error(t("sidebar.copyPlanFailed",{message:P.message||"Unknown error"}))}finally{T.value=!1}},fe=async P=>{if(!P){h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const W=await Ne.getCoordinatorToolByTemplate(P);W?h.value={...W,toolName:W.toolName,serviceGroup:W.serviceGroup??""}:h.value={toolName:"",toolDescription:"",planTemplateId:P,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(W){console.error("Failed to load tool information:",W),h.value={toolName:"",toolDescription:"",planTemplateId:P,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},X=P=>{if(isNaN(P.getTime()))return console.warn("Invalid date received:",P),t("time.unknown");const ge=new Date().getTime()-P.getTime(),ee=Math.floor(ge/6e4),_e=Math.floor(ge/36e5),Fe=Math.floor(ge/864e5);return ee<1?t("time.now"):ee<60?t("time.minuteAgo",{count:ee}):_e<24?t("time.hourAgo",{count:_e}):Fe<30?t("time.dayAgo",{count:Fe}):P.toLocaleDateString("zh-CN")},q=P=>{const W=y.value[P.id];return W!=null&&W.toolName?`${t("sidebar.publishedTool")}: ${W.toolName}`:""},j=async()=>{for(const P of H.planTemplateList)try{const W=await Ne.getCoordinatorToolByTemplate(P.id);W!=null&&W.toolName&&(y.value[P.id]=W)}catch(W){console.debug(`No tool found for template ${P.id}:`,W)}},U=P=>{c.value=!0,d.value=P.clientX,m.value=l.value,document.addEventListener("mousemove",A),document.addEventListener("mouseup",L),document.body.style.cursor="col-resize",document.body.style.userSelect="none",P.preventDefault()},A=P=>{if(!c.value)return;const W=window.innerWidth,ee=(P.clientX-d.value)/W*100;let _e=m.value+ee;_e=Math.max(15,Math.min(100,_e)),l.value=_e},L=()=>{c.value=!1,document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",L),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},Z=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return me(()=>H.currentPlanTemplateId,P=>{fe(P)},{immediate:!0}),Ae(async()=>{await H.loadPlanTemplateList(),await j(),w(),H.loadAvailableTools();const P=localStorage.getItem("sidebarWidth");P&&(l.value=parseFloat(P))}),xe(()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",L)}),e({loadPlanTemplateList:H.loadPlanTemplateList,toggleSidebar:H.toggleSidebar,currentPlanTemplateId:H.currentPlanTemplateId}),(P,W)=>{var ge;return p(),g(de,null,[s("div",{class:ae(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(H).isCollapsed}]),style:ze({width:l.value+"%"})},[s("div",ff,[s("div",gf,[s("div",vf,i(P.$t("sidebar.title")),1)]),s("div",bf,[s("button",{class:ae(["tab-button",{active:r(H).currentTab==="list"}]),onClick:W[0]||(W[0]=ee=>r(H).switchToTab("list"))},[C(r(R),{icon:"carbon:list",width:"16"}),le(" "+i(P.$t("sidebar.templateList")),1)],2),s("button",{class:ae(["tab-button",{active:r(H).currentTab==="config"}]),onClick:W[1]||(W[1]=ee=>r(H).switchToTab("config")),disabled:!r(H).selectedTemplate},[C(r(R),{icon:"carbon:settings",width:"16"}),le(" "+i(P.$t("sidebar.configuration")),1)],10,yf)]),r(H).currentTab==="list"?(p(),g("div",_f,[s("div",Sf,[s("button",{class:"new-task-btn",onClick:W[2]||(W[2]=()=>r(H).createNewTemplate(r(H).planType))},[C(r(R),{icon:"carbon:add",width:"16"}),le(" "+i(P.$t("sidebar.newPlan"))+" ",1),W[10]||(W[10]=s("span",{class:"shortcut"}," K",-1))])]),s("div",wf,[r(H).isLoading?(p(),g("div",$f,[C(r(R),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,i(P.$t("sidebar.loading")),1)])):r(H).errorMessage?(p(),g("div",Pf,[C(r(R),{icon:"carbon:warning",width:"20"}),s("span",null,i(r(H).errorMessage),1),s("button",{onClick:W[3]||(W[3]=(...ee)=>r(H).loadPlanTemplateList&&r(H).loadPlanTemplateList(...ee)),class:"retry-btn"},i(P.$t("sidebar.retry")),1)])):r(H).planTemplateList.length===0?(p(),g("div",kf,[C(r(R),{icon:"carbon:document",width:"32"}),s("span",null,i(P.$t("sidebar.noTemplates")),1)])):(p(!0),g(de,{key:3},pe(r(H).sortedTemplates,ee=>(p(),g("div",{key:ee.id,class:ae(["sidebar-content-list-item",{"sidebar-content-list-item-active":ee.id===r(H).currentPlanTemplateId}]),onClick:_e=>r(H).selectTemplate(ee)},[s("div",Tf,[C(r(R),{icon:"carbon:document",width:"20"})]),s("div",Cf,[s("div",Rf,i(ee.title||P.$t("sidebar.unnamedPlan")),1),s("div",If,i(q(ee)),1)]),s("div",Af,i(X(r(H).parseDateTime(ee.updateTime||ee.createTime))),1),s("div",xf,[s("button",{class:"delete-task-btn",title:P.$t("sidebar.deleteTemplate"),onClick:Se(_e=>r(H).deleteTemplate(ee),["stop"])},[C(r(R),{icon:"carbon:close",width:"16"})],8,Mf)])],10,Ef))),128))])])):r(H).currentTab==="config"?(p(),g("div",Ff,[r(H).selectedTemplate?(p(),g("div",Df,[s("div",Nf,[s("div",Uf,[s("h3",null,i(r(H).selectedTemplate.title||P.$t("sidebar.unnamedPlan")),1),s("span",Lf,"ID: "+i(r(H).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:W[4]||(W[4]=ee=>r(H).switchToTab("list"))},[C(r(R),{icon:"carbon:arrow-left",width:"16"})])]),r(H).planType==="dynamic_agent"?(p(),he(mf,{key:r(H).currentPlanTemplateId||"default","json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:$,onRestore:_,onSave:v,onCopyPlan:z,"onUpdate:jsonContent":W[5]||(W[5]=ee=>r(H).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),he(Gu,{key:"simple-"+(r(H).currentPlanTemplateId||"default"),"json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:$,onRestore:_,onSave:v,"onUpdate:jsonContent":W[6]||(W[6]=ee=>r(H).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),C(Zd,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":r(H).currentPlanTemplateId||"","is-executing":r(H).isExecuting,"is-generating":r(H).isGenerating,"show-publish-button":x.value,"tool-info":h.value,onExecutePlan:f,onPublishMcpService:M,onClearParams:Y,onUpdateExecutionParams:Q},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):B("",!0)])):B("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:U,onDblclick:Z,title:P.$t("sidebar.resizeHint")},W[11]||(W[11]=[s("div",{class:"resizer-line"},null,-1)]),40,Of)],6),C(td,{ref_key:"publishMcpModalRef",ref:F,modelValue:k.value,"onUpdate:modelValue":W[7]||(W[7]=ee=>k.value=ee),"plan-template-id":r(H).currentPlanTemplateId||"","plan-description":((ge=r(H).selectedTemplate)==null?void 0:ge.description)||"",onPublished:G},null,8,["modelValue","plan-template-id","plan-description"]),D.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:K},[s("div",{class:"modal-content",onClick:W[9]||(W[9]=Se(()=>{},["stop"]))},[s("div",Bf,[s("h3",null,i(P.$t("sidebar.copyPlan")),1),s("button",{class:"close-btn",onClick:K},[C(r(R),{icon:"carbon:close",width:"16"})])]),s("div",qf,[s("div",jf,[s("label",Vf,i(P.$t("sidebar.newPlanTitle")),1),ie(s("input",{"onUpdate:modelValue":W[8]||(W[8]=ee=>V.value=ee),type:"text",class:"form-input",placeholder:P.$t("sidebar.enterNewPlanTitle"),onKeyup:et(ne,["enter"])},null,40,Gf),[[ve,V.value]])])]),s("div",Hf,[s("button",{class:"btn btn-secondary",onClick:K},i(P.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:ne,disabled:!V.value.trim()||T.value},[T.value?(p(),he(r(R),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):B("",!0),le(" "+i(T.value?P.$t("sidebar.copying"):P.$t("sidebar.copyPlan")),1)],8,Jf)])])])):B("",!0)],64)}}}),zf=ye(Wf,[["__scopeId","data-v-866b8509"]]),Kf={class:"direct-page"},Xf={class:"direct-chat"},Qf={class:"chat-header"},Yf={class:"header-actions"},Zf=["title"],eg=["title"],tg=["title"],og={class:"chat-content"},sg=["title"],ng={class:"message-content"},ag=be({__name:"index",setup(n){const e=jo(),o=Vo(),t=ot(),{t:a}=Me(),{message:l}=zo(),c=N(""),d=N(""),m=N(),u=N(),h=N(),y=N(),F=N(!1),O=N(!1),x=N(null),w=N(50),b=N(!1),v=N(0),E=N(0),$=ue(()=>{if(H.isCollapsed)return w.value;let A=26;y.value&&y.value.sidebarWidth!==void 0&&(A=y.value.sidebarWidth);const L=100-A;return Math.max(20,Math.min(L,w.value))});Ae(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),Oe.setEventCallbacks({onPlanUpdate:L=>{console.log("[Direct] Plan update event received for rootPlanId:",L),V(L)&&(console.log("[Direct] Processing plan update for current rootPlanId:",L),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",L),u.value.handlePlanUpdate(L)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),m.value&&typeof m.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",L),m.value.updateDisplayedPlanProgress(L)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:L=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",L),!!V(L)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",L),u.value&&typeof u.value.handlePlanCompleted=="function"){const Z=Oe.getCachedPlanRecord(L);Z&&Z.completed?Z.summary&&Z.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(Z)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(Z)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),ft.getDetails(L).then(P=>{console.log("[Direct]  Got fresh details from API:",P),P&&P.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Oe.setCachedPlanRecord(L,P),u.value.handlePlanCompleted(P)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(Z??{planId:L}))}).catch(P=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",P),u.value.handlePlanCompleted(Z??{planId:L})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");x.value=null,console.log("[Direct]  Cleared currentRootPlanId after plan completion"),h.value&&typeof h.value.resetSession=="function"&&(console.log("[Direct]  Calling inputRef.resetSession to clear sessionPlanId"),h.value.resetSession())}},onDialogRoundStart:L=>{console.log("[Direct] Dialog round start event received for rootPlanId:",L),x.value=L,console.log("[Direct] Set currentRootPlanId to:",L),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",L),u.value.handleDialogRoundStart(L)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),G()},onChatInputUpdateState:L=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",L),!V(L,!0))return;const Z=Oe.getCachedUIState(L);Z&&Q(Z.enabled,Z.placeholder)},onPlanError:L=>{u.value.handlePlanError(L)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),H.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const L=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",L),L.trim()?(t.markTaskAsProcessed(),Ce(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",L),await T({input:L})}catch(Z){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",Z),c.value=L}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),t.markTaskAsProcessed())}else{const L=t.getAndClearTaskToInput();L?(d.value=L,console.log("[Direct] Setting inputOnlyContent for input only:",d.value)):(c.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",c.value),console.log("[Direct] No unprocessed task in store"))}const A=localStorage.getItem("directPanelWidth");A&&(w.value=parseFloat(A)),console.log("[Direct] Final prompt value:",c.value),d.value&&Ce(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(d.value),console.log("[Direct] Set input value:",d.value),d.value="")}),window.addEventListener("plan-execution-requested",L=>{console.log("[DirectView] Received plan-execution-requested event:",L.detail),q(L.detail)})}),me(()=>t.currentTask,A=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",A),A&&!A.processed&&A.prompt.trim()){const L=A.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",L),Ce(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",L),await T({input:L})}catch(Z){console.warn("[Direct] handleChatSendMessage failed for new task:",Z)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),me(()=>c.value,(A,L)=>{console.log("[Direct] prompt value changed from:",L,"to:",A)},{immediate:!1}),me(()=>t.taskToInput,A=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",A),A.trim()&&(console.log("[Direct] Setting input value from taskToInput:",A),Ce(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(A.trim()),console.log("[Direct] Input value set from taskToInput watch:",A.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),xe(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),x.value=null,Oe.cleanup(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",k),window.removeEventListener("plan-execution-requested",A=>{q(A.detail)})});const _=A=>{b.value=!0,v.value=A.clientX,E.value=w.value,document.addEventListener("mousemove",f),document.addEventListener("mouseup",k),document.body.style.cursor="col-resize",document.body.style.userSelect="none",A.preventDefault()},f=A=>{if(!b.value)return;const L=window.innerWidth,P=(A.clientX-v.value)/L*100;let W=E.value+P;W=Math.max(20,Math.min(80,W)),w.value=W},k=()=>{b.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",k),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",w.value.toString())},D=()=>{w.value=50,localStorage.setItem("directPanelWidth","50")},V=(A,L=!1)=>!x.value||A===x.value||L&&(A==="ui-state"||A==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",A,"current:",x.value),!1),T=async A=>{var Z,P,W,ge,ee,_e,Fe,qe,je;let L=null;try{if(console.log("[DirectView] Processing send-message event:",A),!A.input.trim()){console.warn("[DirectView] Empty input detected, skipping backend request");return}const De=(Z=u.value)==null?void 0:Z.addMessage("user",A.input);A.attachments&&De&&((P=u.value)==null||P.updateMessage(De.id,{attachments:A.attachments})),L=(W=u.value)==null?void 0:W.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),L&&((ge=u.value)==null||ge.startStreaming(L.id));const{DirectApiService:$e}=await no(async()=>{const{DirectApiService:S}=await import("./sidebar-9kmvVBVq.js").then(J=>J.d);return{DirectApiService:S}},__vite__mapDeps([0,1,2,3])),Te=A;let Pe;Te.toolName&&Te.replacementParams?(console.log("[DirectView] Calling DirectApiService.executeByToolName with tool:",Te.toolName),Pe=await $e.executeByToolName(Te.toolName,Te.replacementParams,A.uploadedFiles,A.uploadKey)):(console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan"),Pe=await $e.sendMessageWithDefaultPlan(A)),console.log("[DirectView] API response received:",Pe),Pe.planId&&L?((ee=u.value)==null||ee.updateMessage(L.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Pe.planId,rootPlanId:Pe.planId,status:"running"}}),x.value=Pe.planId,console.log("[DirectView] Set currentRootPlanId to:",Pe.planId),Oe.handlePlanExecutionRequested(Pe.planId,A.input),console.log("[DirectView] Started polling for plan execution updates")):L&&((_e=u.value)==null||_e.updateMessage(L.id,{content:Pe.message||Pe.result||"No response received from backend"}),(Fe=u.value)==null||Fe.stopStreaming(L.id))}catch(De){console.error("[DirectView] Send message failed:",De),(qe=u.value)==null||qe.addMessage("assistant",`Error: ${(De==null?void 0:De.message)||"Failed to send message"}`),L&&((je=u.value)==null||je.stopStreaming(L.id))}},M=async A=>{console.log("[DirectView] Send message from input:",JSON.stringify(A)),await T(A)},G=()=>{console.log("[DirectView] Input cleared"),h.value&&typeof h.value.clear=="function"&&h.value.clear()},Y=()=>{console.log("[DirectView] Input focused")},Q=(A,L)=>{console.log("[DirectView] Input state updated:",A,L),O.value=!A},z=A=>{console.log("[DirectView] Step selected:",A),m.value&&typeof m.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",A),m.value.handleStepSelected(A)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},K=(A,L,Z,P)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:A,subPlanId:L,stepIndex:Z,subStepIndex:P}),m.value&&typeof m.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:A,subPlanId:L,stepIndex:Z,subStepIndex:P}),m.value.handleSubPlanStepSelected(A,L,Z,P)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},ne=()=>{console.log("[DirectView] Plan mode button clicked"),H.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",H.isCollapsed)},fe=()=>{o.push("/home")},X=()=>{o.push("/configs")},q=async A=>{var P,W,ge,ee,_e,Fe,qe,je,De;if(console.log("[DirectView] Plan execution requested:",A),F.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}F.value=!0;let L=!1,Z=null;try{console.log("[DirectView] Adding messages for plan execution:",A.title),(P=u.value)==null||P.addMessage("user",A.title),L=!0,Z=(W=u.value)==null?void 0:W.addMessage("assistant","",{thinking:a("chat.planningExecution")}),Z&&((ge=u.value)==null||ge.startStreaming(Z.id),console.log("[DirectView] Added assistant message for plan execution:",Z.id))}catch($e){console.warn("[DirectView] Failed to add messages:",$e)}try{const $e=A.planData.planTemplateId;if(!$e)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",$e,"params:",A.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Te=A.uploadedFiles??[],Pe=A.uploadKey??void 0;console.log("[Direct]  DEBUG - InputArea uploadedFiles:",Te),console.log("[Direct]  DEBUG - InputArea uploadKey:",Pe),console.log("[Direct] Executing with uploaded files:",Te.length),console.log("[Direct] Executing with replacement params:",A.replacementParams);let S;if((ee=A.params)!=null&&ee.trim()?(console.log("[Direct] Calling executePlan with rawParam:",A.params.trim()),S=await ut.executePlan($e,A.params.trim(),Te,A.replacementParams,Pe)):(console.log("[Direct] Calling executePlan without rawParam"),S=await ut.executePlan($e,void 0,Te,A.replacementParams,Pe)),console.log("[Direct] Plan execution API response:",S),S.planId&&Z)console.log("[Direct] Got planId from response:",S.planId,"starting plan execution"),(_e=u.value)==null||_e.updateMessage(Z.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:S.planId,rootPlanId:S.planId,status:"running"}}),x.value=S.planId,console.log("[Direct] Set currentRootPlanId to:",S.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Oe.handlePlanExecutionRequested(S.planId,A.title);else throw console.error("[Direct] No planId in response:",S),new Error(a("direct.executionFailedNoPlanId"))}catch($e){console.error("[Direct] Plan execution failed:",$e),console.error("[Direct] Error details:",{message:$e.message,stack:$e.stack}),x.value=null;try{console.log("[Direct] Adding error messages to chat"),L||(Fe=u.value)==null||Fe.addMessage("user",A.title),Z?((qe=u.value)==null||qe.updateMessage(Z.id,{content:`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`,thinking:void 0}),(je=u.value)==null||je.stopStreaming(Z.id)):(De=u.value)==null||De.addMessage("assistant",`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`)}catch(Te){console.error("[Direct] Failed to add error messages:",Te),alert(`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),F.value=!1}},j=()=>{u.value.showMemory()},U=()=>{Be.clearMemoryId(),u.value.newChat()};return(A,L)=>(p(),g("div",Kf,[s("div",Xf,[C(zf,{ref_key:"sidebarRef",ref:y,onPlanExecutionRequested:q},null,512),s("div",{class:"left-panel",style:ze({width:$.value+"%"})},[s("div",Qf,[s("button",{class:"back-button",onClick:fe},[C(r(R),{icon:"carbon:arrow-left"})]),s("h2",null,i(A.$t("conversation")),1),s("div",Yf,[C(Jo),s("button",{class:"config-button",onClick:U,title:A.$t("memory.newChat")},[C(r(R),{icon:"carbon:add",width:"20"})],8,Zf),s("button",{class:"config-button",onClick:X,title:A.$t("direct.configuration")},[C(r(R),{icon:"carbon:settings-adjust",width:"20"})],8,eg),s("button",{class:"cron-task-btn",onClick:L[0]||(L[0]=Z=>r(Be).toggleSidebar()),title:A.$t("memory.selectMemory")},[C(r(R),{icon:"carbon:calendar",width:"20"})],8,tg)])]),s("div",og,[C(Xa,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":c.value||"",onStepSelected:z,onSubPlanStepSelected:K},null,8,["initial-prompt"])]),(p(),he(_l,{key:A.$i18n.locale,ref_key:"inputRef",ref:h,disabled:O.value,placeholder:O.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":c.value,onSend:M,onClear:G,onFocus:Y,onUpdateState:Q,onPlanModeClicked:ne},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:_,onDblclick:D,title:A.$t("direct.panelResizeHint")},L[1]||(L[1]=[s("div",{class:"resizer-line"},null,-1)]),40,sg),C(bc,{ref_key:"rightPanelRef",ref:m,style:ze({width:100-w.value+"%"}),"current-root-plan-id":x.value},null,8,["style","current-root-plan-id"])]),C(mr,{onMemorySelected:j}),r(l).show?(p(),g("div",{key:0,class:ae(["message-toast",r(l).type])},[s("div",ng,[s("span",null,i(r(l).text),1)])],2)):B("",!0)]))}}),Ag=ye(ag,[["__scopeId","data-v-429ad590"]]);export{Ag as default};
//# sourceMappingURL=index-DvuWySBz.js.map
