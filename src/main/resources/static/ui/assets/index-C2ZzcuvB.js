import{_ as uo}from"./Java-AI-BYpq8IxI.js";import{d as Te,u as De,a as y,b as h,n as ve,e as o,f as V,g as A,i as d,h as me,t as u,y as Je,F as he,q as ge,j as we,l as $e,A as vs,c as re,B as He,r as F,o as Me,C as ye,D as Ue,w as be,m as ke,E as Lt,G as At,v as po,H as gs,I as Ne,J as ys,z as xe,T as Ot,p as Xe,K as mo,M as ho,N as st,O as fo,x as vo}from"./index-Fck3VgD_.js";import{I as D,_ as Ee}from"./_plugin-vue_export-helper-CNHaFwu9.js";import{u as gt,m as Ce,P as go,D as Jt,a as We,t as ue,s as bs}from"./templateStore-94hQEG6B.js";import{P as Xt,L as yo}from"./plan-template-with-tool-api-service-2Umn-1DV.js";import{M as _s,u as Bt,a as bo,b as ws}from"./useToast-CzwIxbmK.js";import"./llm-check-CJy4TeZw.js";const _o={class:"sub-plan-info"},wo={class:"sub-plan-details"},$o={class:"sub-plan-title"},So={key:0,class:"nesting-level"},Po={class:"sub-plan-id"},To={class:"sub-plan-meta"},Eo={key:0,class:"trigger-tool"},ko={class:"trigger-text"},Co={key:0,class:"sub-plan-progress"},Io={class:"progress-info"},Ro={class:"progress-text"},xo={class:"progress-bar"},Ao={key:1,class:"sub-plan-agents-steps"},Fo={class:"agents-steps-header"},Mo={class:"agents-label"},Do={class:"agents-steps-list"},No=["onClick"],Uo={class:"agent-step-header"},Lo=["title"],Oo={class:"sub-agent-execution-info"},Bo={key:0,class:"agent-result"},qo={class:"result-header"},Ho={class:"result-label"},Vo={class:"result-content"},jo={key:1,class:"agent-error"},zo={class:"error-header"},Wo={class:"error-label"},Go={class:"error-content"},Ko={key:2,class:"think-act-preview"},Jo={class:"think-act-header"},Xo={class:"think-act-label"},Yo={class:"think-act-steps-preview"},Qo=["onClick"],Zo={class:"step-number"},en={class:"step-description"},tn={key:0,class:"more-steps"},sn={class:"more-steps-text"},on={key:3,class:"nested-sub-plans"},nn={class:"nested-sub-plans-header"},an={class:"nested-label"},ln={class:"nested-sub-plans-list"},rn={key:4,class:"direct-sub-plans"},cn={class:"direct-sub-plans-header"},un={class:"direct-label"},dn={class:"direct-sub-plans-list"},pn=Te({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=n,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(L=>L.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(L=>L.status==="FINISHED")?"in-progress":"pending",p=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},b=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},i=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const P=c();return Math.min(100,P/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0,g=P=>{switch(P){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},E=P=>{switch(P){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},v=P=>{switch(P){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},m=P=>P.thinkActSteps?.some(C=>C.subPlanExecutionRecord)??!1,w=P=>P.thinkActSteps?.filter(C=>C.subPlanExecutionRecord)??[],_=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},f=(P,C)=>{const L=C.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",L)},I=(P,C,L)=>{const O=L.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",O)},j=(P,C,L)=>{s("sub-plan-selected",P,C,L)},J=P=>{s("step-selected",P)};return(P,C)=>{const L=vs("RecursiveSubPlan",!0);return h(),y("div",{class:ve(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:_},[o("div",_o,[A(d(D),{icon:b(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",wo,[o("div",$o,[me(u(P.subPlan.title||P.$t("chat.subPlan"))+" #"+u(P.subPlanIndex+1)+" ",1),(P.nestingLevel??0)>0?(h(),y("span",So,"(L"+u((P.nestingLevel??0)+1)+")",1)):V("",!0)]),o("div",Po,u(P.subPlan.currentPlanId),1)])]),o("div",To,[o("div",{class:ve(["sub-plan-status-badge",r()])},u(p()),3),P.subPlan.parentActToolCall?(h(),y("div",Eo,[A(d(D),{icon:"carbon:function",class:"trigger-icon"}),o("span",ko,u(P.subPlan.parentActToolCall.name),1)])):V("",!0)])]),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Co,[o("div",Io,[o("span",Ro,u(P.$t("chat.progress"))+": "+u(c())+" / "+u(P.subPlan.agentExecutionSequence.length),1),o("div",xo,[o("div",{class:"progress-fill",style:Je({width:i()+"%"})},null,4)])])])):V("",!0),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Ao,[o("div",Fo,[o("span",Mo,u(P.$t("chat.agentExecutions"))+":",1)]),o("div",Do,[(h(!0),y(he,null,ge(P.subPlan.agentExecutionSequence,(O,W)=>(h(),y("div",{key:O.id||W,class:ve(["agent-step-item",g(O.status)]),onClick:S=>f(W,O)},[o("div",Uo,[A(d(D),{icon:E(O.status),class:"agent-icon"},null,8,["icon"]),o("span",{class:"agent-name",title:O.agentName==="ConfigurableDynaAgent"?P.$t("chat.clickToViewExecutionDetails"):""},u(O.agentName==="ConfigurableDynaAgent"?P.$t("chat.funcAgentExecutionDetails"):O.agentName||P.$t("chat.unknownAgent")),9,Lo),o("div",{class:ve(["agent-status-badge",g(O.status)])},u(v(O.status)),3)]),o("div",Oo,[O.result?(h(),y("div",Bo,[o("div",qo,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Ho,u(P.$t("chat.agentResult"))+":",1)]),o("pre",Vo,u(O.result),1)])):V("",!0),O.errorMessage?(h(),y("div",jo,[o("div",zo,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Wo,u(P.$t("chat.errorMessage"))+":",1)]),o("pre",Go,u(O.errorMessage),1)])):V("",!0),O.thinkActSteps?.length?(h(),y("div",Ko,[o("div",Jo,[A(d(D),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Xo,u(P.$t("chat.thinkActSteps"))+" ("+u(O.thinkActSteps.length)+")",1)]),o("div",Yo,[(h(!0),y(he,null,ge(O.thinkActSteps.slice(0,P.maxVisibleSteps??2),(S,x)=>(h(),y("div",{key:S.id||x,class:"think-act-step-preview",onClick:we(T=>I(W,x,O),["stop"])},[o("span",Zo,"#"+u(x+1),1),o("span",en,u(S.actionDescription||P.$t("chat.thinking")),1),A(d(D),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Qo))),128)),O.thinkActSteps.length>(P.maxVisibleSteps??2)?(h(),y("div",tn,[o("span",sn,u(P.$t("chat.andMoreSteps",{count:O.thinkActSteps.length-(P.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),m(O)?(h(),y("div",on,[o("div",nn,[A(d(D),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",an,u(P.$t("chat.nestedSubPlans")),1)]),o("div",ln,[(h(!0),y(he,null,ge(w(O),(S,x)=>(h(),$e(L,{key:S.id||x,"sub-plan":S.subPlanExecutionRecord,"sub-plan-index":x,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:j,onStepSelected:J},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),O.subPlanExecutionRecords?.length?(h(),y("div",rn,[o("div",cn,[A(d(D),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",un,u(P.$t("chat.directSubPlans")),1)]),o("div",dn,[(h(!0),y(he,null,ge(O.subPlanExecutionRecords,(S,x)=>(h(),$e(L,{key:S.currentPlanId||x,"sub-plan":S,"sub-plan-index":x,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:j,onStepSelected:J},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,No))),128))])])):V("",!0)],2)}}}),mn=Ee(pn,[["__scopeId","data-v-36486b62"]]),hn={class:"execution-details"},fn={key:0,class:"plan-overview"},vn={key:0,class:"parent-tool-call"},gn={class:"parent-tool-header"},yn={class:"tool-label"},bn={class:"tool-name"},_n={key:0,class:"tool-parameters"},wn={class:"param-label"},$n={class:"param-content"},Sn={key:1,class:"agent-execution-container"},Pn={class:"section-title"},Tn=["onClick"],En={class:"agent-info"},kn={class:"agent-details"},Cn=["title"],In={class:"request-content"},Rn={class:"agent-controls"},xn={class:"agent-execution-info"},An={key:0,class:"agent-result"},Fn={class:"result-header"},Mn={class:"result-label"},Dn={class:"result-content"},Nn={key:1,class:"agent-error"},Un={class:"error-header"},Ln={class:"error-label"},On={class:"error-content"},Bn={key:0,class:"sub-plans-container"},qn={class:"sub-plans-header"},Hn={class:"sub-plans-title"},Vn={class:"sub-plans-list"},jn=Te({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=g=>{g.stepId?e("step-selected",g.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",g)},l=g=>{switch(g){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=g=>{switch(g){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},p=g=>{switch(g){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},b=(g,E,v)=>{e("sub-plan-selected",g,E,v)},i=g=>{e("step-selected",g)},c=g=>{if(!g)return"";try{const E=JSON.parse(g);return JSON.stringify(E,null,2)}catch{return g}};return(g,E)=>(h(),y("div",hn,[g.planExecution?(h(),y("div",fn,[g.planExecution.parentActToolCall?(h(),y("div",vn,[o("div",gn,[A(d(D),{icon:"carbon:flow",class:"tool-icon"}),o("span",yn,u(g.$t("chat.triggeredByTool"))+":",1),o("span",bn,u(g.planExecution.parentActToolCall.name),1)]),g.planExecution.parentActToolCall.parameters?(h(),y("div",_n,[o("span",wn,u(g.$t("common.parameters"))+":",1),o("pre",$n,u(c(g.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(g.planExecution?.agentExecutionSequence?.length??0)>0?(h(),y("div",Sn,[o("h4",Pn,u(g.$t("chat.agentExecutionSequence")),1),(h(!0),y(he,null,ge(g.planExecution?.agentExecutionSequence,(v,m)=>(h(),y("div",{key:v.id||m,class:ve(["agent-execution-item",l(v.status)])},[o("div",{class:"agent-header",onClick:w=>a(v)},[o("div",En,[A(d(D),{icon:p(v.status),class:"agent-status-icon"},null,8,["icon"]),o("div",kn,[o("div",{class:"agent-name",title:v.agentName==="ConfigurableDynaAgent"?g.$t("chat.clickToViewExecutionDetails"):""},u(v.agentName==="ConfigurableDynaAgent"?g.$t("chat.funcAgentExecutionDetails"):v.agentName||g.$t("chat.unknownAgent")),9,Cn),o("pre",In,u(v.agentRequest),1)])]),o("div",Rn,[o("div",{class:ve(["agent-status-badge",l(v.status)])},u(r(v.status)),3),A(d(D),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Tn),o("div",xn,[v.result?(h(),y("div",An,[o("div",Fn,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Mn,u(g.$t("chat.agentResult"))+":",1)]),o("pre",Dn,u(v.result),1)])):V("",!0),v.errorMessage?(h(),y("div",Nn,[o("div",Un,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ln,u(g.$t("chat.errorMessage"))+":",1)]),o("pre",On,u(v.errorMessage),1)])):V("",!0)]),v.subPlanExecutionRecords?.length?(h(),y("div",Bn,[o("div",qn,[A(d(D),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",Hn,u(g.$t("chat.subPlanExecutions"))+" ("+u(v.subPlanExecutionRecords.length)+") ",1)]),o("div",Vn,[(h(!0),y(he,null,ge(v.subPlanExecutionRecords,(w,_)=>(h(),$e(mn,{key:w.currentPlanId||_,"sub-plan":w,"sub-plan-index":_,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:b,onStepSelected:i},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2))),128))])):V("",!0)]))}}),zn=Ee(jn,[["__scopeId","data-v-ee75d960"]]);function $s(){return{formatResponseText:b=>b?b.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:b=>{if(!b||isNaN(b.getTime()))return"";const c=new Date().getTime()-b.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return b.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(g){return console.warn("[useMessageFormatting] Error formatting timestamp:",b,g),""}},getMessageClasses:b=>re(()=>({user:b.type==="user",assistant:b.type==="assistant",streaming:b.isStreaming,"has-error":!!b.error,"has-thinking":!!b.thinking,"has-execution":!!b.planExecution})),formatFileSize:b=>{if(b===0)return"0 B";const i=1024,c=["B","KB","MB","GB"],g=Math.floor(Math.log(b)/Math.log(i));return parseFloat((b/Math.pow(i,g)).toFixed(2))+" "+c[g]},truncateText:(b,i=100)=>!b||b.length<=i?b:b.substring(0,i)+"...",stripHtml:b=>b.replace(/<[^>]*>/g,""),hasDisplayableContent:b=>!!(b.content||(b.thinking??!1)||(b.planExecution??!1)||b.error),getMessageStatus:b=>b.error?"Send failed":b.isStreaming?"Typing...":b.type==="assistant"&&!b.content&&!b.thinking?"Waiting for response":""}}class Ft{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Wn={class:"user-input-form-container"},Gn={class:"user-input-header"},Kn={class:"user-input-title"},Jn={class:"user-input-message"},Xn={key:0,class:"form-description"},Yn={key:0,class:"form-grid"},Qn=["for"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","placeholder","required","onUpdate:modelValue"],oa=["id","name","placeholder","required","onUpdate:modelValue"],na=["id","name","required","onUpdate:modelValue"],aa={value:""},la=["value"],ra={key:6,class:"checkbox-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"checkbox-label"},ua={key:7,class:"radio-group"},da=["id","name","value","onUpdate:modelValue"],pa={class:"radio-label"},ma=["id","name","placeholder","required","onUpdate:modelValue"],ha={key:1,class:"form-group"},fa={for:"form-input-genericInput"},va={type:"submit",class:"submit-user-input-btn"},ga=Te({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:t}){const e=n,s=t;De();const a=He({}),l=F(e.genericInput??""),r=F(!1),p=F(null),b=()=>{const E=e.userInputWaitState?.formInputs;E&&E.length>0&&(!r.value||Object.keys(a).length!==E.length)&&(E.forEach((m,w)=>{(!(w in a)||m.type==="checkbox"&&!Array.isArray(a[w])||m.type!=="checkbox"&&a[w]==="")&&(m.type==="checkbox"?a[w]=[]:a[w]="")}),r.value=!0)};Me(()=>{b()}),ye(()=>e.userInputWaitState?.formInputs,()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{r.value=!1,b()},100)},{deep:!0});const i=async()=>{try{const E={},v=e.userInputWaitState?.formInputs;v&&v.length>0?Object.entries(a).forEach(([m,w])=>{const _=parseInt(m,10),I=v[_].label||`input_${m}`;Array.isArray(w)?E[I]=w.join(", "):E[I]=w}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",e.planId),e.planId?(await Ft.submitFormInput(e.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},c=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(v=>v.trim()).filter(v=>v.length>0):[]:[],g=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Ue(()=>{p.value&&clearTimeout(p.value)}),(E,v)=>(h(),y("div",Wn,[o("div",Gn,[A(d(D),{icon:"carbon:user",class:"user-icon"}),o("h4",Kn,u(E.$t("chat.userInputRequired")),1)]),o("p",Jn,u(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),y("p",Xn,u(E.userInputWaitState?.formDescription),1)):V("",!0),o("form",{onSubmit:we(i,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),y("div",Yn,[(h(!0),y(he,null,ge(E.userInputWaitState?.formInputs,(m,w)=>(h(),y("div",{key:w,class:"form-group"},[o("label",{for:`form-input-${m.label.replace(/\W+/g,"_")}`},u(m.label)+u(g(m.required)?" *":"")+": ",9,Qn),!m.type||m.type==="text"?be((h(),y("input",{key:0,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,Zn)),[[ke,a[w]]]):m.type==="email"?be((h(),y("input",{key:1,type:"email",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ea)),[[ke,a[w]]]):m.type==="number"?be((h(),y("input",{key:2,type:"number",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ta)),[[ke,a[w]]]):m.type==="password"?be((h(),y("input",{key:3,type:"password",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,sa)),[[ke,a[w]]]):m.type==="textarea"?be((h(),y("textarea",{key:4,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input form-textarea",rows:"4"},null,8,oa)),[[ke,a[w]]]):m.type==="select"&&m.options?be((h(),y("select",{key:5,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input form-select"},[o("option",aa,u(E.$t("selectCommon.pleaseSelect")),1),(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("option",{key:_,value:_},u(_),9,la))),128))],8,na)),[[Lt,a[w]]]):m.type==="checkbox"&&m.options?(h(),y("div",ra,[(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("label",{key:_,class:"checkbox-item"},[be(o("input",{type:"checkbox",id:`form-input-${m.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:m.label,value:_,"onUpdate:modelValue":f=>a[w]=f,class:"form-checkbox"},null,8,ia),[[At,a[w]]]),o("span",ca,u(_),1)]))),128))])):m.type==="radio"&&m.options?(h(),y("div",ua,[(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("label",{key:_,class:"radio-item"},[be(o("input",{type:"radio",id:`form-input-${m.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:m.label,value:_,"onUpdate:modelValue":f=>a[w]=f,class:"form-radio"},null,8,da),[[po,a[w]]]),o("span",pa,u(_),1)]))),128))])):be((h(),y("input",{key:8,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ma)),[[ke,a[w]]])]))),128))])):(h(),y("div",ha,[o("label",fa,u(E.$t("common.input"))+":",1),be(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":v[0]||(v[0]=m=>l.value=m),class:"form-input"},null,512),[[ke,l.value]])])),o("button",va,u(E.$t("chat.userInput.submit")),1)],32)]))}}),ya=Ee(ga,[["__scopeId","data-v-e4d0802d"]]),ba={class:"response-section"},_a={class:"response-header"},wa={class:"response-avatar"},$a={class:"response-name"},Sa={key:0,class:"response-timestamp"},Pa={class:"response-content"},Ta={key:1,class:"final-response"},Ea=["innerHTML"],ka={class:"response-actions"},Ca=["title"],Ia=["title"],Ra={key:2,class:"response-placeholder"},xa={class:"typing-indicator"},Aa={class:"typing-text"},Fa={key:3,class:"response-error"},Ma={class:"error-text"},Da={key:4,class:"response-empty"},Na={class:"empty-text"},Ua=Te({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:t}){const e=n,s=t,{formatResponseText:a,formatTimestamp:l}=$s(),r=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},p=()=>{s("regenerate")},b=()=>{s("retry")},i=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,g)=>(h(),y("div",ba,[o("div",_a,[o("div",wa,[A(d(D),{icon:"carbon:bot",class:"bot-icon"})]),o("div",$a,u(c.$t("chat.botName")),1),c.timestamp?(h(),y("div",Sa,u(d(l)(c.timestamp)),1)):V("",!0)]),o("div",Pa,[c.userInputWaitState?.waiting?(h(),$e(ya,gs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:i}),null,16,["user-input-wait-state","generic-input"])):V("",!0),c.content?(h(),y("div",Ta,[o("div",{class:"response-text",innerHTML:d(a)(c.content)},null,8,Ea),o("div",ka,[o("button",{class:"action-btn copy-btn",onClick:r,title:c.$t("chat.copyResponse")},[A(d(D),{icon:"carbon:copy"})],8,Ca),o("button",{class:"action-btn regenerate-btn",onClick:p,title:c.$t("chat.regenerateResponse")},[A(d(D),{icon:"carbon:renew"})],8,Ia)])])):c.isStreaming?(h(),y("div",Ra,[o("div",xa,[g[0]||(g[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Aa,u(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),y("div",Fa,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ma,u(c.error),1),o("button",{class:"retry-btn",onClick:b},u(c.$t("chat.retry")),1)])):(h(),y("div",Da,[o("span",Na,u(c.$t("chat.waitingForResponse")),1)]))])]))}}),La=Ee(Ua,[["__scopeId","data-v-a03ac86f"]]);function Oa(){const s=F(new Set),a=He(new Map),l=He(new Map),r=He(new Map),p=He(new Map),b=F(!1),i=F(null),c=C=>p.get(C),g=(C,L)=>{if(!C){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}p.set(C,L),console.log("[usePlanExecution] Cached plan record:",C)},E=()=>Array.from(s.value),v=C=>{if(!C){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(C),l.set(C,0),r.set(C,0),console.log("[usePlanExecution] Tracking plan:",C),i.value||f(),w(C).catch(L=>{console.error(`[usePlanExecution] Initial poll failed for ${C}:`,L)})},m=C=>{s.value.delete(C),l.delete(C),r.delete(C),console.log("[usePlanExecution] Untracking plan:",C),s.value.size===0&&a.size===0&&I()},w=async C=>{if(C)try{console.log("[usePlanExecution] Polling plan status for:",C);const L=await Ft.getDetails(C);if(console.log("[usePlanExecution] Received plan details:",L?"YES":"NO",L),r.delete(C),!L){const S=r.get(C)||0;S<10?(r.set(C,S+1),console.log(`[usePlanExecution] Plan ${C} not found yet, retrying (${S+1}/10)`),setTimeout(()=>{s.value.has(C)&&w(C).catch(x=>{console.error(`[usePlanExecution] Retry poll failed for ${C}:`,x)})},1e3)):(console.warn(`[usePlanExecution] Plan ${C} not found after 10 attempts, giving up`),m(C));return}const O=l.get(C)||0;l.set(C,O+1);const W=L.rootPlanId||L.currentPlanId;if(!W){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",L);return}if(p.set(W,L),C!==W&&(p.set(C,L),console.log("[usePlanExecution] Stored record with both keys:",{planId:C,recordKey:W})),console.log("[usePlanExecution] Updated plan execution record:",{planId:C,recordKey:W,rootPlanId:L.rootPlanId,currentPlanId:L.currentPlanId,completed:L.completed,status:L.status,attempt:O+1}),L.completed){console.log(`[usePlanExecution] Plan ${W} completed, checking for summary...`);const S=gt();S.currentTask&&S.currentTask.isRunning&&(S.currentTask.isRunning=!1);const x=L.summary||L.result||L.message,T=a.get(W)||0;if(!x&&T<10)a.set(W,T+1),console.log(`[usePlanExecution] Plan ${W} completed but no summary yet, continuing to poll (${T+1}/10)`);else{console.log(`[usePlanExecution] Plan ${W} completed, cleaning up...`,{hasSummary:!!x,pollCount:T});try{await Ft.deleteExecutionDetails(W),console.log(`[usePlanExecution] Deleted execution details for plan: ${W}`)}catch(B){const U=B instanceof Error?B.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${U}`)}m(C),a.delete(W),setTimeout(()=>{p.delete(W),C!==W&&p.delete(C)},5e3)}}L.status==="failed"&&L.message&&!L.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${W} failed:`,L.message)}catch(L){const O=L instanceof Error?L.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${C}:`,O);const W=r.get(C)||0;W<10&&(r.set(C,W+1),console.log(`[usePlanExecution] Network error for ${C}, retrying (${W+1}/10)`),setTimeout(()=>{s.value.has(C)&&w(C).catch(S=>{console.error(`[usePlanExecution] Retry poll failed for ${C}:`,S)})},1e3*(W+1)))}},_=async()=>{if(b.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const C=new Set(s.value);for(const[L]of a.entries())C.add(L);if(C.size!==0)try{b.value=!0;const L=Array.from(C).map(O=>w(O));await Promise.all(L)}catch(L){console.error("[usePlanExecution] Failed to poll tracked plans:",L)}finally{b.value=!1}},f=()=>{i.value&&clearInterval(i.value),i.value=window.setInterval(()=>{_()},1e3),console.log("[usePlanExecution] Started adaptive polling")},I=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}i.value&&(clearInterval(i.value),i.value=null),console.log("[usePlanExecution] Stopped polling")},j=async C=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${C}`),await w(C)},J=C=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:C}),!C){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}gt().setTaskRunning(C),v(C)},P=()=>{I(),s.value.clear(),a.clear(),l.clear(),r.clear(),p.clear(),b.value=!1};return{planExecutionRecords:Ne(p),trackedPlanIds:Ne(s),isPolling:Ne(b),getPlanExecutionRecord:c,setCachedPlanRecord:g,getTrackedPlanIds:E,trackPlan:v,untrackPlan:m,handlePlanExecutionRequested:J,pollPlanStatusImmediately:j,startPolling:f,stopPolling:I,cleanup:P}}let Pt=null;function Qe(){return Pt||(Pt=Oa()),Pt}function Ba(){const n=Qe(),t=F([]),e=F(null),s=F(null),a=F(null),l=re(()=>a.value),r=F(!1),p=F(null),b=F(null),i=F(null),c=re(()=>e.value&&t.value.find(M=>M.id===e.value)||null),g=re(()=>t.value.length>0),E=re(()=>t.value.length),v=re(()=>{if(!s.value)return c.value?.messages||[];const M=[];for(const q of t.value)q.conversationId===s.value&&M.push(...q.messages);return M.sort((q,z)=>q.timestamp.getTime()-z.timestamp.getTime())}),m=M=>{const q={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:M||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(q),e.value=q.id,console.log("[useMessageDialog] Created new dialog round:",q.id,{conversationId:s.value,rootPlanId:a.value}),q},w=M=>t.value.find(q=>q.id===M)||null,_=M=>{if(t.value.forEach(q=>{q.isActive=!1}),M){const q=t.value.find(z=>z.id===M);q&&(q.isActive=!0,e.value=M)}else e.value=null},f=(M,q)=>{const z=t.value.find(Y=>Y.id===M);z&&(z.messages.push(q),z.updatedAt=new Date)},I=(M,q,z)=>{const Y=t.value.find(se=>se.id===M);if(Y){const se=Y.messages.findIndex(oe=>oe.id===q);se!==-1&&(Y.messages[se]={...Y.messages[se],...z},Y.updatedAt=new Date)}},j=M=>{const q=t.value.findIndex(z=>z.id===M);if(q!==-1){const z=t.value[q];if(t.value.splice(q,1),console.log("[useMessageDialog] Deleted dialog round:",M),e.value===M){const Y=t.value.filter(se=>se.conversationId===z.conversationId);e.value=Y.length>0?Y[0].id:null,e.value&&_(e.value)}}},J=M=>{const q=t.value.filter(z=>z.planId===M);q.forEach(z=>{j(z.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for plan:`,M)},P=M=>{const q=t.value.filter(z=>z.conversationId===M);q.forEach(z=>{j(z.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for conversation:`,M),s.value===M&&(s.value=null)},C=()=>{t.value=[],e.value=null},L=async M=>{let q=null,z=null;try{if(r.value){const pe="Please wait for the current task to complete before starting a new one";return p.value=pe,{success:!1,error:pe}}r.value=!0,p.value=null,q=m();const Y={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.input,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(pe=>typeof pe=="string"?new File([],pe):pe)}};f(q.id,Y),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},f(q.id,z);const se=M;let oe;if(se.toolName&&se.replacementParams?oe=await Jt.executeByToolName(se.toolName,se.replacementParams,M.uploadedFiles,M.uploadKey,"VUE_DIALOG"):oe=await Jt.sendMessageWithDefaultPlan(M,"VUE_DIALOG"),oe.conversationId&&(s.value=oe.conversationId,q.conversationId=oe.conversationId,Ce.setConversationId(oe.conversationId),console.log("[useMessageDialog] Conversation ID set:",oe.conversationId)),oe.planId){const pe=oe.planId;a.value=pe,q.planId=pe,I(q.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:pe,rootPlanId:pe,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(pe),console.log("[useMessageDialog] Root plan ID set and tracking started:",pe)}else{const pe={content:oe.message||oe.result||"No response received",isStreaming:!1};I(q.id,z.id,pe)}return{success:!0,...oe.planId&&{planId:oe.planId},...oe.conversationId&&{conversationId:oe.conversationId}}}catch(Y){const se=Y instanceof Error?Y.message:"Failed to send message";return p.value=se,console.error("[useMessageDialog] Send message failed:",Y),q&&z&&I(q.id,z.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),{success:!1,error:se}}finally{r.value=!1}},O=async M=>{let q=null,z=null;try{if(r.value){const N="Please wait for the current task to complete before starting a new one";return p.value=N,{success:!1,error:N}}r.value=!0,p.value=null;const Y=Ce.getConversationId();Y&&!s.value&&(s.value=Y,console.log("[useMessageDialog] Restored conversationId from memoryStore:",Y)),q=m(M.title),M.title&&(q.title=M.title);const se={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.title,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(N=>typeof N=="string"?new File([],N):N)}};f(q.id,se),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},f(q.id,z);const oe=M.planData.planTemplateId;if(!oe||oe===null)throw new Error("Plan template ID is required");const pe=await go.executePlan(oe,M.params,M.uploadedFiles,M.replacementParams,M.uploadKey??void 0,"VUE_SIDEBAR");if(pe.conversationId){const N=pe.conversationId,Q=s.value||Ce.getConversationId();N!==Q?(console.log("[useMessageDialog] Conversation ID changed:",Q,"->",N),s.value=N,q.conversationId=N,Ce.setConversationId(N)):(q.conversationId=N,console.log("[useMessageDialog] Conversation ID unchanged:",N))}else s.value&&(q.conversationId=s.value);if(pe.planId){const N=pe.planId;a.value=N,q.planId=N,I(q.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:N,rootPlanId:N,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(N),console.log("[useMessageDialog] Root plan ID set and tracking started:",N)}else{const N={content:"Plan execution started",isStreaming:!1};I(q.id,z.id,N)}return{success:!0,...pe.planId&&{planId:pe.planId}}}catch(Y){const se=Y instanceof Error?Y.message:"Failed to execute plan";return p.value=se,console.error("[useMessageDialog] Execute plan failed:",Y),q&&z&&I(q.id,z.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),r.value=!1,{success:!1,error:se}}},W=(M,q,z)=>{const Y={};z!==void 0&&(Y.planExecution=z),I(M,q,Y)},S=M=>{const q={...M};return"agentExecutionSequence"in M&&Array.isArray(M.agentExecutionSequence)&&(q.agentExecutionSequence=M.agentExecutionSequence.map(z=>x(z))),q},x=M=>{const q={...M};return"subPlanExecutionRecords"in M&&Array.isArray(M.subPlanExecutionRecords)&&(q.subPlanExecutionRecords=M.subPlanExecutionRecords.map(z=>S(z))),q},T=(M,q,z)=>{c.value||m();const Y=c.value,se={...z};z?.planExecution&&(se.planExecution=S(z.planExecution));const oe={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:M,content:q,timestamp:new Date,isStreaming:!1,...se};return Y.messages.push(oe),Y.updatedAt=new Date,oe},B=(M,q)=>{if(!c.value)return;const z={...q};q.planExecution&&(z.planExecution=S(q.planExecution));const Y=c.value.messages.findIndex(se=>se.id===M);Y!==-1&&(c.value.messages[Y]={...c.value.messages[Y],...z},c.value.updatedAt=new Date)},U=M=>{if(c.value)return c.value.messages.find(q=>q.id===M)},H=M=>{b.value=M,B(M,{isStreaming:!0})},ee=M=>{M&&B(M,{isStreaming:!1}),(b.value===M||!M)&&(b.value=null)},Se=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,b.value=null)},K=(M,q)=>{r.value=!M,q!==void 0&&(i.value=q),console.log("[useMessageDialog] Input state updated:",{enabled:M,placeholder:q,isLoading:r.value})},ie=M=>{s.value=M,console.log("[useMessageDialog] Set conversationId:",M)},Ie=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,p.value=null,i.value=null},ce=(M,q,z)=>{const Y={planExecution:S(z),isStreaming:!z.completed};if(!z.completed)Y.thinking="Processing...";else{if(!z.agentExecutionSequence||z.agentExecutionSequence.length===0){const se=z.summary??z.result??z.message??"Execution completed";se&&(Y.content=se,Y.thinking="")}else z.summary&&(Y.content=z.summary,Y.thinking="");z.status==="failed"&&z.message&&(Y.content=`Error: ${z.message}`,Y.thinking="")}I(M.id,q.id,Y)};return ys(()=>{const M=n.planExecutionRecords,q=M.size,z=Array.from(M.entries()),Y=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",z.length,"size:",q),console.log("[useMessageDialog] watchEffect - dialogList count:",Y.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",Y.filter(N=>N.planId).map(N=>({id:N.id,planId:N.planId})));for(const N of Y){if(!N.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",N.id);continue}const Q=N.messages.find(de=>de.planExecution?.rootPlanId===N.planId||de.planExecution?.currentPlanId===N.planId);if(!Q){console.log("[useMessageDialog] watchEffect: No message found for planId:",N.planId,{dialogMessages:N.messages.map(de=>({id:de.id,type:de.type,planExecutionRootPlanId:de.planExecution?.rootPlanId,planExecutionCurrentPlanId:de.planExecution?.currentPlanId,hasPlanExecution:!!de.planExecution}))});continue}let R=z.find(([de])=>de===N.planId);const Z=Q.planExecution;if(!R&&Z?.rootPlanId&&(R=z.find(([de])=>de===Z.rootPlanId)),!R&&Z?.currentPlanId&&(R=z.find(([de])=>de===Z.currentPlanId)),!R){for(const[de,_e]of z)if(_e&&(_e.rootPlanId===N.planId||_e.currentPlanId===N.planId||Q.planExecution?.rootPlanId&&(_e.rootPlanId===Q.planExecution.rootPlanId||_e.currentPlanId===Q.planExecution.rootPlanId)||Q.planExecution?.currentPlanId&&(_e.rootPlanId===Q.planExecution.currentPlanId||_e.currentPlanId===Q.planExecution.currentPlanId))){R=[de,_e],console.log("[useMessageDialog] watchEffect: Found record by value matching:",{dialogPlanId:N.planId,recordKey:de,recordRootPlanId:_e.rootPlanId,recordCurrentPlanId:_e.currentPlanId});break}}if(!R){const de=Q.planExecution;if(de&&de.status==="running"){console.log("[useMessageDialog] watchEffect: Message has planExecution but record not found yet, keeping initial state:",{dialogId:N.id,messageId:Q.id,planId:N.planId,messagePlanExecution:de,availableRecordKeys:z.map(([_e])=>_e)});continue}console.log("[useMessageDialog] watchEffect: No record found and message has no running planExecution:",{dialogId:N.id,planId:N.planId,hasPlanExecution:!!Q.planExecution,planExecutionStatus:Q.planExecution?.status,availableRecordKeys:z.map(([_e])=>_e)});continue}const[,te]=R,ne=S(te);console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:N.id,messageId:Q.id,planId:N.planId,recordKey:R[0],recordCompleted:ne.completed,recordStatus:ne.status}),ce(N,Q,ne)}const se=n.trackedPlanIds.value.size>0,oe=z.some(([,N])=>N&&!N.completed&&N.status!=="failed");!(se||oe)&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:se,hasRunningPlansInRecords:oe,trackedPlanIds:Array.from(n.trackedPlanIds.value),recordsCount:z.length}),r.value=!1)}),{dialogList:Ne(t),activeDialogId:Ne(e),rootPlanId:Ne(a),conversationId:Ne(s),isLoading:r,error:p,streamingMessageId:Ne(b),inputPlaceholder:Ne(i),activeDialog:c,activeRootPlanId:l,hasDialogs:g,dialogCount:E,messages:v,createDialog:m,getDialog:w,setActiveDialog:_,addMessageToDialog:f,updateMessageInDialog:I,deleteDialog:j,deleteConversationRoundByPlanId:J,deleteConversation:P,clearAllDialogs:C,sendMessage:L,executePlan:O,updatePlanExecutionStatus:W,updateInputState:K,setConversationId:ie,reset:Ie,addMessage:T,updateMessage:B,findMessage:U,startStreaming:H,stopStreaming:ee,clearMessages:Se}}let Tt=null;function Ze(){return Tt||(Tt=Ba()),Tt}function qa(n){const t=F(!1),e=F(!0),s=150,a=async(_=!0)=>{n.value&&(await xe(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:f,clientHeight:I}=n.value;return f-_-I<s},r=()=>{if(!n.value)return;const _=l();t.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(e.value=!0)},p=()=>{r(),l()||(e.value=!1)},b=async()=>{e.value&&await a()},i=async()=>{e.value=!0,await a()},c=(_,f=!0)=>{if(!n.value)return;const I=n.value.querySelector(`[data-message-id="${_}"]`);I&&I.scrollIntoView({behavior:f?"smooth":"auto",block:"center"})},g=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:f,clientHeight:I}=n.value,j=_===0,J=_+I>=f-5,P=f>I?_/(f-I)*100:100;return{scrollTop:_,scrollHeight:f,clientHeight:I,isAtTop:j,isAtBottom:J,scrollPercentage:P}},E=()=>{n.value&&n.value.addEventListener("scroll",p,{passive:!0})},v=()=>{n.value&&n.value.removeEventListener("scroll",p)},m=()=>{E(),r()},w=()=>{v()};return Me(()=>{xe(()=>{m()})}),Ue(()=>{w()}),{showScrollToBottom:Ne(t),isAutoScrollEnabled:Ne(e),scrollToBottom:a,autoScrollToBottom:b,forceScrollToBottom:i,scrollToMessage:c,isNearBottom:l,checkScrollPosition:r,getScrollInfo:g,addScrollListener:E,removeScrollListener:v,initializeScrollBehavior:m,cleanupScrollBehavior:w}}const Ha={class:"chat-container"},Va=["data-message-id"],ja={class:"user-content"},za={class:"message-text"},Wa={key:0,class:"attachments"},Ga={class:"attachment-name"},Ka={class:"attachment-size"},Ja={class:"message-timestamp"},Xa={key:0,class:"message-status error"},Ya={class:"status-text"},Qa={key:1,class:"assistant-message"},Za={key:0,class:"loading-message"},el={class:"loading-content"},tl=["title"],sl=Te({__name:"ChatContainer",emits:["step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=Ze(),{messages:l,isLoading:r,streamingMessageId:p,updateMessage:b,startStreaming:i,findMessage:c}=a,g=F(null),{scrollToBottom:E,autoScrollToBottom:v,showScrollToBottom:m}=qa(g),{getMessageClasses:w,formatTimestamp:_,formatFileSize:f}=$s(),I=S=>p.value===S,j=re(()=>l.value),J=S=>{const x=S.target;if(x.classList.contains("md-copy-btn")){const T=x.getAttribute("data-raw");if(T){const B=decodeURIComponent(T);navigator.clipboard.writeText(B).then(()=>{x.textContent=s("chat.copied"),setTimeout(()=>{x.textContent=s("chat.copy")},1e3)})}}},P=async S=>{const x=c(S);if(x)try{const T=x.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(T)}catch(T){console.error("Failed to copy message:",T)}},C=S=>{const x=c(S);x&&x.type==="assistant"&&(b(S,{content:""}),i(S),console.warn("[ChatContainer] Regenerate not yet implemented"))},L=S=>{c(S)&&(b(S,{content:""}),i(S),console.warn("[ChatContainer] Retry not yet implemented"))},O=S=>{console.log("[ChatContainer] Step selected:",S),e("step-selected",S)},W=(S,x)=>{console.log("[ChatContainer] User input submitted:",x,"for message:",S.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Me(()=>{ye(l,()=>{xe(()=>{v()})},{deep:!0})}),Ue(()=>{}),(S,x)=>(h(),y("div",Ha,[o("div",{class:"messages",ref_key:"messagesRef",ref:g,onClick:J},[(h(!0),y(he,null,ge(j.value,T=>(h(),y("div",{key:T.id,class:ve(["chat-message",[d(w)(T),{streaming:I(T.id)}]])},[T.type==="user"?(h(),y("div",{key:0,class:"user-message","data-message-id":T.id},[o("div",ja,[o("div",za,u(T.content),1),T.attachments?.length?(h(),y("div",Wa,[(h(!0),y(he,null,ge(T.attachments,(B,U)=>(h(),y("div",{key:U,class:"attachment-item"},[A(d(D),{icon:"carbon:document",class:"attachment-icon"}),o("span",Ga,u(B.name),1),o("span",Ka,u(d(f)(B.size)),1)]))),128))])):V("",!0),o("div",Ja,u(d(_)(T.timestamp)),1)]),T.error?(h(),y("div",Xa,[A(d(D),{icon:"carbon:warning",class:"status-icon"}),o("span",Ya,u(T.error),1)])):V("",!0)],8,Va)):T.type==="assistant"?(h(),y("div",Qa,[T.planExecution?(h(),$e(zn,{key:0,"plan-execution":T.planExecution,"step-actions":T.stepActions||[],"generic-input":T.genericInput||"",onStepSelected:O},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),T.content||T.error||I(T.id)||T.planExecution?.userInputWaitState?.waiting?(h(),$e(La,gs({key:1,content:T.content||"","is-streaming":I(T.id)||!1},{ref_for:!0},{...T.error?{error:T.error}:{},...T.planExecution?.userInputWaitState?{userInputWaitState:T.planExecution.userInputWaitState}:{},...T.planExecution?.currentPlanId?{planId:T.planExecution.currentPlanId}:{}},{timestamp:T.timestamp,"generic-input":T.genericInput||"",onCopy:()=>P(T.id),onRegenerate:()=>C(T.id),onRetry:()=>L(T.id),onUserInputSubmitted:B=>W(T,B)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):V("",!0)])):V("",!0)],2))),128)),d(r)?(h(),y("div",Za,[o("div",el,[A(d(D),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,u(S.$t("chat.processing")),1)])])):V("",!0)],512),A(Ot,{name:"scroll-button"},{default:Xe(()=>[d(m)?(h(),y("button",{key:0,class:"scroll-to-bottom",onClick:x[0]||(x[0]=()=>d(E)()),title:S.$t("chat.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,tl)):V("",!0)]),_:1})]))}}),ol=Ee(sl,[["__scopeId","data-v-b590114c"]]);class Yt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const nl={class:"file-upload-component"},al=["accept"],ll={key:0},rl={key:1},il={key:0,class:"files-list"},cl={class:"file-name"},ul={class:"file-size"},dl=["onClick","title"],pl={key:0,class:"upload-progress"},ml=Te({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=n,l=e,r=F(),p=F([]),b=F(!1),i=F(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],i.value=null,l("upload-key-changed",null)};Ue(()=>{c()}),ye(()=>p.value,_=>{l("files-removed",_)},{deep:!0});const g=()=>{a.disabled||r.value&&r.value.click()},E=async _=>{const f=_.target,I=f.files;if(!I||I.length===0)return;const j=Array.from(I);console.log("[FileUpload] Selected files for upload:",j.map(J=>J.name)),await v(j),f.value=""},v=async _=>{if(_.length!==0){b.value=!0,l("upload-started");try{const f=await Yt.uploadFiles(_);f.success&&(!i.value&&f.uploadKey?(i.value=f.uploadKey,console.log("[FileUpload] Set uploadKey:",i.value),p.value=f.uploadedFiles):i.value?(console.log("[FileUpload] Using existing uploadKey:",i.value),p.value=[...p.value,...f.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=f.uploadedFiles),f.uploadKey&&(i.value=f.uploadKey,console.log("[Input] Saved uploadKey locally:",f.uploadKey),l("upload-key-changed",i.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,i.value)),console.log("Files uploaded successfully:",f),l("upload-completed")}catch(f){console.error("File upload error:",f),l("upload-error",f)}finally{b.value=!1}}},m=async _=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",_.originalName,"from uploadKey:",i),i.value){const f=await Yt.deleteFile(i.value,_.originalName);f.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",f.error)}p.value=p.value.filter(f=>f.originalName!==_.originalName),p.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),i.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",p.value.length)}catch(f){console.error("âŒ Error removing file:",f),l("upload-error",f)}},w=_=>{if(_===0)return"0 Bytes";const f=1024,I=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(_)/Math.log(f));return parseFloat((_/Math.pow(f,j)).toFixed(2))+" "+I[j]};return t({uploadedFiles:p,uploadKey:i,resetSession:c,uploadFiles:v,removeFile:m,isUploading:b}),(_,f)=>(h(),y("div",nl,[o("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:_.acceptedFileTypes||""},null,40,al),o("div",{class:ve(["uploaded-files",{"has-files":p.value.length>0}])},[o("div",{class:"files-header",onClick:g},[A(d(D),{icon:"carbon:attachment"}),p.value.length===0?(h(),y("span",ll,u(d(s)("input.attachFile")),1)):(h(),y("span",rl,u(d(s)("input.attachedFiles"))+" ("+u(p.value.length)+")",1))]),p.value.length>0?(h(),y("div",il,[(h(!0),y(he,null,ge(p.value,I=>(h(),y("div",{key:I.originalName,class:"file-item"},[A(d(D),{icon:"carbon:document",class:"file-icon"}),o("span",cl,u(I.originalName),1),o("span",ul,"("+u(w(I.size))+")",1),o("button",{onClick:j=>m(I),class:"remove-btn",title:d(s)("input.removeFile")},[A(d(D),{icon:"carbon:close"})],8,dl)]))),128))])):V("",!0)],2),b.value?(h(),y("div",pl,[A(d(D),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,u(d(s)("input.uploading")),1)])):V("",!0)]))}}),Ss=Ee(ml,[["__scopeId","data-v-a97ebade"]]),hl={class:"input-area"},fl={class:"input-container"},vl={class:"input-row-first"},gl=["placeholder","disabled"],yl={class:"input-row-second"},bl=["title","disabled"],_l={value:""},wl=["value"],$l=["disabled","title"],Sl=["title"],Qt="chatInputHistory",Zt=20,Pl=Te({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(n,{expose:t}){const{t:e}=De(),s=gt(),a=We(),l=Ze(),r=Qe(),p=re(()=>s.hasRunningTask()),b=n,i=F(),c=F(),g=F(""),E=re(()=>e("input.placeholder")),v=F(null),m=re(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:v.value?v.value:E.value),w=F([]),_=F(null),f=F(""),I=F([]),j=F(!1),J=F(!1),P=F([]),C=F(-1),L=F(""),O=re(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),W=async()=>{j.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const R=a.getAllCoordinatorToolsFromTemplates(),Z=[];for(const ne of R)if(ne.enableInternalToolcall)try{const de=JSON.parse(ne.inputSchema||"[]");if(Array.isArray(de)&&de.length===1){const _e=de[0];Z.push({value:ne.planTemplateId,label:`${ne.toolName} (${_e.name})`,toolName:ne.toolName,planTemplateId:ne.planTemplateId,paramName:_e.name})}}catch(de){console.warn("[InputArea] Failed to parse inputSchema for tool:",ne.toolName,de)}I.value=Z,console.log("[InputArea] Loaded",Z.length,"inner tools with single parameter");const te=localStorage.getItem("inputAreaSelectedTool");if(te){if(Z.length>0)if(Z.some(de=>de.value===te)){J.value=!0;try{f.value=te,console.log("[InputArea] Restored selected tool from localStorage:",te)}finally{J.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),f.value===te&&(f.value="");else if(f.value!==te){J.value=!0;try{f.value=te,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",te)}finally{J.value=!1}}}}catch(R){console.error("[InputArea] Failed to load inner tools:",R),I.value=[]}finally{j.value=!1}},S=re(()=>I.value.length>0?I.value.map(R=>({value:R.value,label:R.label})):b.selectionOptions);ye(f,R=>{J.value||localStorage.setItem("inputAreaSelectedTool",R||"")});const x=()=>{try{const R=localStorage.getItem(Qt);R&&(P.value=JSON.parse(R))}catch(R){console.error("[InputArea] Failed to load history:",R),P.value=[]}},T=()=>{try{localStorage.setItem(Qt,JSON.stringify(P.value))}catch(R){console.error("[InputArea] Failed to save history:",R)}},B=R=>{if(!R.trim())return;const Z=P.value.indexOf(R);Z!==-1&&P.value.splice(Z,1),P.value.unshift(R),P.value.length>Zt&&(P.value=P.value.slice(0,Zt)),T()},U=R=>{if(P.value.length===0)return;C.value===-1&&(L.value=g.value);let Z=C.value+R;Z<-1?Z=-1:Z>=P.value.length&&(Z=P.value.length-1),C.value=Z,C.value===-1?(g.value=L.value,L.value=""):g.value=P.value[C.value],q()};ye(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),W()},{deep:!0}),Me(()=>{W(),x(),ye(()=>r.planExecutionRecords,R=>{const Z=Array.from(R.entries());if(Z.length===0)return;Z.some(([,ne])=>ne&&!ne.completed&&ne.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),H())},{deep:!0}),ye(()=>s.taskToInput,R=>{R?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",R),xe(()=>{N(R.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const H=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),c.value?.resetSession()};Ue(()=>{H()});const ee=(R,Z)=>{w.value=R.map(te=>te.originalName),_.value=Z,console.log("[InputArea] Files uploaded:",R.length,"uploadKey:",Z),w.value.length>0&&(v.value=e("input.filesAttached",{count:w.value.length}))},Se=R=>{w.value=R.map(Z=>Z.originalName),console.log("[InputArea] Files removed, remaining:",R.length),w.value.length===0?v.value=null:v.value=e("input.filesAttached",{count:w.value.length})},K=R=>{_.value=R,console.log("[InputArea] Upload key changed:",R)},ie=()=>{console.log("[InputArea] Upload started")},Ie=()=>{console.log("[InputArea] Upload completed")},ce=R=>{console.error("[InputArea] Upload error:",R)},M=re(()=>l.isLoading.value),q=()=>{xe(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},z=R=>{if(R.key==="Enter"&&(R.ctrlKey||R.metaKey)){R.preventDefault(),Y();return}const Z=O.value?R.altKey:R.ctrlKey;if(R.key==="ArrowUp"&&Z){R.preventDefault(),U(1);return}if(R.key==="ArrowDown"&&Z){R.preventDefault(),U(-1);return}C.value!==-1&&R.key.length===1&&!R.ctrlKey&&!R.metaKey&&!R.altKey&&(C.value=-1,L.value="")},Y=async()=>{if(!g.value.trim()||M.value)return;const R=g.value.trim();B(R),C.value=-1,L.value="";const Z={input:R,memoryId:Ce.selectMemoryId,uploadedFiles:w.value};if(_.value?(Z.uploadKey=_.value,console.log("[InputArea] Including uploadKey in message:",_.value)):console.log("[InputArea] No uploadKey available for message"),f.value){const te=I.value.find(ne=>ne.value===f.value);if(te){const ne=Z;ne.toolName=te.planTemplateId,ne.replacementParams={[te.paramName]:R},console.log("[InputArea] Sending message with tool:",te.toolName)}}try{await l.sendMessage(Z)}catch(te){const ne=te instanceof Error?te.message:String(te);console.error("[InputArea] Send message failed:",ne)}oe()},se=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},oe=()=>{g.value="",q()},pe=(R,Z)=>{l.updateInputState(R,Z)},N=R=>{g.value=R,q()},Q=()=>g.value.trim();return ye(()=>b.initialValue,R=>{R.trim()&&(g.value=R,q())},{immediate:!0}),t({clearInput:oe,updateState:pe,getQuery:Q,focus:()=>i.value?.focus(),get uploadedFiles(){return c.value?.uploadedFiles?.map(R=>R.originalName)||[]},get uploadKey(){return c.value?.uploadKey||null}}),(R,Z)=>(h(),y("div",hl,[A(Ss,{ref_key:"fileUploadRef",ref:c,disabled:M.value,onFilesUploaded:ee,onFilesRemoved:Se,onUploadKeyChanged:K,onUploadStarted:ie,onUploadCompleted:Ie,onUploadError:ce},null,8,["disabled"]),o("div",fl,[o("div",vl,[be(o("textarea",{"onUpdate:modelValue":Z[0]||(Z[0]=te=>g.value=te),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:M.value,onKeydown:z,onInput:q},null,40,gl),[[ke,g.value]])]),o("div",yl,[be(o("select",{"onUpdate:modelValue":Z[1]||(Z[1]=te=>f.value=te),class:"selection-input",title:R.$t("input.selectionTitle"),disabled:j.value||M.value},[o("option",_l,u(R.$t("input.defaultFuncAgent")),1),(h(!0),y(he,null,ge(S.value,te=>(h(),y("option",{key:te.value,value:te.value},u(te.label),9,wl))),128))],8,bl),[[Lt,f.value]]),p.value?(h(),y("button",{key:1,class:"send-button stop-button",onClick:se,title:R.$t("input.stop")},[A(d(D),{icon:"carbon:stop-filled"}),me(" "+u(R.$t("input.stop")),1)],8,Sl)):(h(),y("button",{key:0,class:"send-button",disabled:!g.value.trim()||M.value,onClick:Y,title:R.$t("input.send")},[A(d(D),{icon:"carbon:send-alt"}),me(" "+u(R.$t("input.send")),1)],8,$l))])])]))}}),Tl=Ee(Pl,[["__scopeId","data-v-63823e52"]]);class mt{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const El={key:0,class:"app-container"},kl={class:"app-content"},Cl={class:"header"},Il={class:"relative"},Rl={class:"title-edit-group"},xl={id:"main-title",class:"main-title"},Al={key:0,id:"title-edit-container",class:"title-edit-container"},Fl={class:"search-bar"},Ml={class:"search-container"},Dl=["placeholder"],Nl={class:"message-list",id:"message-list"},Ul={class:"message-header"},Ll={class:"message-content"},Ol={class:"sender-info"},Bl=["onClick"],ql={class:"sender-name"},Hl={class:"action-buttons"},Vl=["onClick"],jl={class:"action-buttons"},zl=["onClick"],Wl={class:"message-meta"},Gl={class:"message-id"},Kl={class:"meta-right"},Jl={key:0,class:"unread-count"},Xl={class:"message-time"},Yl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Zl={class:"bubble-avatar"},er={class:"bubble-content"},tr={class:"bubble-text"},sr={key:0,class:"empty-state"},or={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr=["placeholder"],rr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},ir={class:"modal-footer"},cr={class:"modal-content"},ur={class:"modal-header"},dr={class:"modal-title"},pr={class:"state-text",id:"delete-message"},mr={class:"modal-footer"},hr=Te({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(n,{emit:t}){const e=F(!1),s=F(""),a=F([]),l=F([]),r=F(!1),p=F(null),b=F(""),i=F(!1),c=F(null),g=new Map,E=t,v=O=>{O.key==="Escape"&&(i.value?C():r.value&&I())};Me(()=>{Ce.setLoadMessages(m),document.addEventListener("keydown",v)}),Ue(()=>{document.removeEventListener("keydown",v)});const m=async()=>{try{const O=await mt.getMemories();a.value=O.map(W=>({...W,expanded:g.has(W.conversation_id)?g.get(W.conversation_id):!1})),l.value=[...a.value],f()}catch(O){console.error("error:",O),a.value=[],l.value=[]}},w=O=>{Ce.selectMemory(O),E("memory-selected")},_=O=>{const W=typeof O=="string"?parseInt(O,10):O;return isNaN(W)||W<=0?"--":new Date(W.toString().length===13?W:W*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},f=()=>{const O=s.value.toLowerCase().trim();if(!O){l.value=[...a.value];return}l.value=a.value.filter(W=>{const S=W.memory_name.toLowerCase().includes(O),x=W.conversation_id.toLowerCase().includes(O),T=W.messages?.some(B=>B.text.toLowerCase().includes(O))??!1;return S||x||T})},I=()=>{r.value=!1,p.value=null},j=async()=>{if(!p.value)return;const O=b.value.trim()||"unknow name",W=a.value.findIndex(S=>S.conversation_id===p.value);if(W!==-1){const S=a.value[W];try{const x=await mt.updateMemory(S.conversation_id,O);x.messages||(x.messages=[]),a.value[W]={...x,expanded:S.expanded},f(),r.value=!1}catch(x){console.error("error:",x)}}},J=O=>{const W=a.value.find(S=>S.conversation_id===O);if(W){W.expanded=!W.expanded,g.set(O,W.expanded);const S=l.value.findIndex(x=>x.conversation_id===O);S!==-1&&(l.value[S]={...W})}},P=O=>{c.value=O,i.value=!0},C=()=>{i.value=!1,c.value=null},L=async()=>{if(c.value)try{await mt.deleteMemory(c.value),a.value=a.value.filter(O=>O.conversation_id!==c.value),f(),a.value.length===0&&Ce.clearMemoryId(),i.value=!1,c.value=null}catch(O){console.error("error:",O)}};return(O,W)=>(h(),$e(mo,{to:"body"},[A(Ot,{name:"modal"},{default:Xe(()=>[d(Ce).isCollapsed?(h(),y("div",El,[o("div",kl,[o("div",Cl,[o("div",Il,[o("div",Rl,[o("h1",xl,[o("span",null,u(O.$t("memory.title")),1)])]),e.value?(h(),y("div",Al)):V("",!0)]),o("button",{class:"close-btn",onClick:W[0]||(W[0]=S=>d(Ce).toggleSidebar())},[A(d(D),{icon:"carbon:close"})])]),o("div",Fl,[o("div",Ml,[A(d(D),{class:"search-container-icon",icon:"carbon:search"}),be(o("input",{type:"text",placeholder:O.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":W[1]||(W[1]=S=>s.value=S),onInput:f},null,40,Dl),[[ke,s.value]])])]),o("div",Nl,[o("div",null,[(h(!0),y(he,null,ge(l.value,S=>(h(),y("div",{class:ve(["message-item",{expanded:S.expanded}]),key:S.conversation_id},[o("div",Ul,[o("div",Ll,[o("div",Ol,[o("div",{class:"sender-div",onClick:we(x=>w(S.conversation_id),["stop"])},[o("h3",ql,u(S.memory_name),1)],8,Bl),o("div",Hl,[o("button",{class:"delete-btn",onClick:we(x=>J(S.conversation_id),["stop"])},[A(d(D),{id:"toggle-"+S.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Vl)]),o("div",jl,[o("button",{class:"delete-btn",onClick:we(x=>P(S.conversation_id),["stop"])},[A(d(D),{icon:"carbon:delete"})],8,zl)])]),o("div",Wl,[o("span",Gl,"ID: "+u(S.conversation_id),1),o("div",Kl,[S.messages&&S.messages.length>0?(h(),y("span",Jl,u(S.messages.length)+" "+u(O.$t("memory.size")),1)):V("",!0),o("span",Xl,u(_(S.create_time)),1)])])])]),S.expanded?(h(),y("div",{key:0,id:"content-"+S.conversation_id,class:"expanded-content"},[o("div",Ql,[(h(!0),y(he,null,ge(S.messages,(x,T)=>(h(),y("div",{class:"message-bubble",key:T},[o("div",Zl,u(x.messageType),1),o("div",er,[o("p",tr,u(x.text),1)])]))),128))])],8,Yl)):V("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),y("div",sr,W[3]||(W[3]=[o("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),r.value?(h(),y("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:we(I,["self"])},[o("div",or,[o("div",nr,[o("h3",ar,u(O.$t("memory.changeName")),1),be(o("input",{type:"text","onUpdate:modelValue":W[2]||(W[2]=S=>b.value=S),class:"edit-input",placeholder:O.$t("memory.newNamePlaceholder")},null,8,lr),[[ke,b.value]]),o("span",rr,u(b.value.length),1)]),o("div",ir,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:I},u(O.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:j},u(O.$t("memory.save")),1)])])])):V("",!0),i.value?(h(),y("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:we(C,["self"])},[o("div",cr,[o("div",ur,[o("h3",dr,u(O.$t("memory.deleteHint")),1),o("p",pr,u(O.$t("memory.deleteHintPrefix"))+" "+u(c.value)+" "+u(O.$t("memory.deleteHintSuffix")),1)]),o("div",mr,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:C},u(O.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:L},u(O.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),fr=Ee(hr,[["__scopeId","data-v-16358835"]]);class Ke{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),p=document.createElement("a");p.href=r,p.download=s??e.split("/").pop()??"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(r),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const vr={class:"file-tree-node"},gr={class:"node-icon"},yr={class:"node-name"},br={key:1,class:"file-size"},_r={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=Te({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:t}){const e=n,s=t,a=F(e.level===0),l=F(!1),r=F(!1),p=F({}),b=()=>{e.node.type==="directory"&&(a.value=!a.value)},i=()=>{e.node.type==="directory"?b():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),v()},g=()=>{s("download-file",e.node),v()},E=f=>{f.preventDefault(),r.value=!0,p.value={position:"fixed",top:`${f.clientY}px`,left:`${f.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",v)},0)},v=()=>{r.value=!1,document.removeEventListener("click",v)},m=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(f){console.error("Failed to copy path:",f)}v()},w=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ke.getFileIcon(e.node),_=f=>{if(f===0)return"0 B";const I=1024,j=["B","KB","MB","GB"],J=Math.floor(Math.log(f)/Math.log(I));return parseFloat((f/Math.pow(I,J)).toFixed(1))+" "+j[J]};return Ue(()=>{document.removeEventListener("click",v)}),(f,I)=>{const j=vs("FileTreeNode",!0);return h(),y("div",vr,[o("div",{class:ve(["node-content",{"is-directory":f.node.type==="directory","is-file":f.node.type==="file","is-expanded":a.value}]),style:Je({paddingLeft:`${f.level*16+12}px`}),onClick:i,onContextmenu:we(E,["prevent"])},[f.node.type==="directory"?(h(),y("div",{key:0,class:"expand-icon",onClick:we(b,["stop"])},[A(d(D),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),o("div",gr,[A(d(D),{icon:w()},null,8,["icon"])]),o("span",yr,u(f.node.name),1),f.node.type==="file"?(h(),y("span",br,u(_(f.node.size)),1)):V("",!0),l.value?(h(),y("div",_r,[f.node.type==="file"?(h(),y("button",{key:0,onClick:I[0]||(I[0]=we(J=>f.$emit("download-file",f.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(d(D),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),f.node.type==="directory"&&a.value&&f.node.children?(h(),y("div",wr,[(h(!0),y(he,null,ge(f.node.children,J=>(h(),$e(j,{key:J.path,node:J,level:f.level+1,onFileSelected:I[1]||(I[1]=P=>f.$emit("file-selected",P)),onDownloadFile:I[2]||(I[2]=P=>f.$emit("download-file",P))},null,8,["node","level"]))),128))])):V("",!0),r.value?(h(),y("div",{key:1,class:"context-menu",style:Je(p.value),onClick:I[3]||(I[3]=we(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:c},[A(d(D),{icon:"carbon:view"}),I[4]||(I[4]=o("span",null,"Open",-1))]),f.node.type==="file"?(h(),y("div",{key:0,class:"context-menu-item",onClick:g},[A(d(D),{icon:"carbon:download"}),I[5]||(I[5]=o("span",null,"Download",-1))])):V("",!0),I[7]||(I[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:m},[A(d(D),{icon:"carbon:copy"}),I[6]||(I[6]=o("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),Sr=Ee($r,[["__scopeId","data-v-3fc455d1"]]),Pr={class:"file-browser"},Tr={class:"file-browser-header"},Er={class:"header-actions"},kr=["disabled","title"],Cr={class:"file-browser-content"},Ir={class:"file-tree-panel"},Rr={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Ar={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Mr={class:"tips"},Dr=["disabled"],Nr={key:1,class:"actual-error"},Ur={key:2,class:"empty-state"},Lr={key:3,class:"file-tree"},Or={key:0,class:"file-content-panel"},Br={class:"file-content-header"},qr={class:"file-info"},Hr={class:"file-name"},Vr={class:"file-size"},jr={class:"file-actions"},zr=["title"],Wr=["title"],Gr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Xr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Qr={key:1,class:"binary-content"},Zr=Te({name:"FileBrowser",__name:"index",props:{planId:{}},setup(n){const t=n,{t:e}=De(),s=F(!1),a=F(null),l=F(null),r=F(null),p=F(null),b=F(!1),i=F(null),c=F(null),g=re(()=>!p.value||!r.value?!1:Ke.isTextFile(p.value.mimeType,r.value.name)),E=re(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),v=()=>{c.value&&(clearTimeout(c.value),c.value=null)},m=()=>{v(),c.value=window.setTimeout(()=>{E.value&&w()},5e3)},w=async()=>{if(t.planId){s.value=!0,a.value=null,v();try{l.value=await Ke.getFileTree(t.planId)}catch(P){a.value=P instanceof Error?P.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",P);const C=P instanceof Error?P.message:"";(C.includes("Plan directory not found")||C.includes("not found"))&&m()}finally{s.value=!1}}},_=async P=>{if(P.type!=="directory"){r.value=P,p.value=null,b.value=!0,i.value=null;try{p.value=await Ke.getFileContent(t.planId,P.path)}catch(C){i.value=C instanceof Error?C.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",C)}finally{b.value=!1}}},f=async P=>{try{await Ke.downloadFile(t.planId,P.path,P.name)}catch(C){console.error("Failed to download file:",C)}},I=()=>{r.value=null,p.value=null,i.value=null},j=P=>Ke.getFileIcon(P),J=P=>{if(P===0)return"0 B";const C=1024,L=["B","KB","MB","GB"],O=Math.floor(Math.log(P)/Math.log(C));return parseFloat((P/Math.pow(C,O)).toFixed(1))+" "+L[O]};return ye(()=>t.planId,P=>{P&&(r.value=null,p.value=null,w())},{immediate:!0}),Me(()=>{t.planId&&w()}),Ue(()=>{v()}),(P,C)=>(h(),y("div",Pr,[o("div",Tr,[o("h3",null,u(P.$t("fileBrowser.title")),1),o("div",Er,[o("button",{class:"refresh-btn",onClick:w,disabled:s.value,title:P.$t("fileBrowser.refresh")},[A(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kr)])]),o("div",Cr,[o("div",Ir,[s.value?(h(),y("div",Rr,[A(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(P.$t("fileBrowser.loading")),1)])):a.value?(h(),y("div",xr,[E.value?(h(),y("div",Ar,[A(d(D),{icon:"carbon:time",class:"rotating"}),o("div",Fr,[o("h3",null,u(P.$t("fileBrowser.waitingForGeneration")),1),o("p",null,u(P.$t("fileBrowser.planExecuting")),1),o("div",Mr,[A(d(D),{icon:"carbon:information"}),o("span",null,u(P.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:w,class:"retry-btn",disabled:s.value},[A(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value})},null,8,["class"]),me(" "+u(s.value?P.$t("fileBrowser.checking"):P.$t("fileBrowser.checkNow")),1)],8,Dr)])):(h(),y("div",Nr,[A(d(D),{icon:"carbon:warning"}),o("span",null,u(a.value),1),o("button",{onClick:w,class:"retry-btn"},u(P.$t("fileBrowser.retry")),1)]))])):l.value?(h(),y("div",Lr,[A(Sr,{node:l.value,level:0,onFileSelected:_,onDownloadFile:f},null,8,["node"])])):(h(),y("div",Ur,[A(d(D),{icon:"carbon:folder-off"}),o("span",null,u(P.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),y("div",Or,[o("div",Br,[o("div",qr,[A(d(D),{icon:j(r.value)},null,8,["icon"]),o("span",Hr,u(r.value.name),1),o("span",Vr,"("+u(J(r.value.size))+")",1)]),o("div",jr,[o("button",{onClick:C[0]||(C[0]=L=>f(r.value)),class:"download-btn",title:P.$t("fileBrowser.download")},[A(d(D),{icon:"carbon:download"})],8,zr),o("button",{onClick:I,class:"close-btn",title:P.$t("common.close")},[A(d(D),{icon:"carbon:close"})],8,Wr)])]),o("div",Gr,[b.value?(h(),y("div",Kr,[A(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(P.$t("fileBrowser.loadingContent")),1)])):i.value?(h(),y("div",Jr,[A(d(D),{icon:"carbon:warning"}),o("span",null,u(i.value),1)])):p.value?(h(),y("div",Xr,[g.value?(h(),y("div",Yr,[o("pre",null,[o("code",null,u(p.value.content),1)])])):(h(),y("div",Qr,[A(d(D),{icon:"carbon:document-unknown"}),o("p",null,u(P.$t("fileBrowser.binaryFile")),1),o("button",{onClick:C[1]||(C[1]=L=>f(r.value)),class:"download-btn-large"},[A(d(D),{icon:"carbon:download"}),me(" "+u(P.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),ei=Ee(Zr,[["__scopeId","data-v-a19b1e5b"]]);class Ps{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}class Ts{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function ti(){const n=F([]),t=F(!1),e=F(null);return{availableTools:n,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await Ts.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),n.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",n.value=[]}finally{t.value=!1}}},reset:()=>{n.value=[],t.value=!1,e.value=null}}}let Et=null;function nt(){return Et||(Et=ti()),Et}const si={class:"modal-form wide-modal"},oi={class:"form-section"},ni={class:"form-item"},ai=["placeholder"],li={class:"field-description"},ri={class:"form-section"},ii={class:"section-title"},ci={key:0,class:"params-help-text"},ui={class:"parameter-table"},di=["onUpdate:modelValue","placeholder","readonly"],pi=["onUpdate:modelValue","placeholder"],mi={class:"form-section"},hi={class:"service-publish-options"},fi={class:"internal-toolcall-publish-option"},vi={class:"checkbox-label"},gi={class:"checkbox-text"},yi={class:"checkbox-description"},bi={class:"http-publish-option"},_i={class:"checkbox-label"},wi={class:"checkbox-text"},$i={class:"checkbox-description"},Si={class:"button-container"},Pi=["disabled"],Ti=["disabled"],Ei=Te({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=We(),l=nt(),r=n,p=e,b=re({get:()=>r.modelValue,set:T=>p("update:modelValue",T)}),i=F(""),c=F(""),g=F(!1),E=F(!1),v=F(!1),m=F(!0),w=F({parameters:[],hasParameters:!1,requirements:""}),_=F(!1),f=He({userRequest:"",parameters:[]}),I=re(()=>{const T=!!a.selectedTemplate.value?.toolConfig;return s(T?"mcpService.updateService":"mcpService.createService")}),j=re(()=>!!a.selectedTemplate.value?.toolConfig),J=()=>{const T=a.selectedTemplate.value?.toolConfig;T?(f.userRequest=T.toolDescription||"",v.value=T.enableHttpService??!1,m.value=T.enableInternalToolcall??!0,T.inputSchema&&Array.isArray(T.inputSchema)&&T.inputSchema.length>0?f.parameters=T.inputSchema.map(B=>({name:B.name||"",description:B.description||""})):w.value.hasParameters||(f.parameters=[])):(f.userRequest="",v.value=!1,m.value=!0,w.value.hasParameters||(f.parameters=[]))},P=async()=>{const T=a.currentPlanTemplateId.value;if(!T){w.value={parameters:[],hasParameters:!1,requirements:""},f.parameters=[];return}_.value=!0;try{const B=await Ps.getParameterRequirements(T);if(w.value=B,console.log("[PublishModal] Parameter requirements loaded:",B),B.hasParameters){const U=new Map;f.parameters.forEach(H=>{H.name&&U.set(H.name,H.description||"")}),f.parameters=B.parameters.map(H=>({name:H,description:U.get(H)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",f.parameters)}else f.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(B){console.error("[PublishModal] Failed to load parameter requirements:",B),B instanceof Error&&!B.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),w.value={parameters:[],hasParameters:!1,requirements:""},f.parameters=[]}finally{_.value=!1}},C=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",w.value.parameters),console.log("[PublishModal] Form parameters:",f.parameters);const T=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",T);const B=new Map;if(T.forEach(U=>{U.name&&B.set(U.name,U.description||"")}),w.value.hasParameters){const U=w.value.parameters.map(H=>{const K=f.parameters.find(ie=>ie.name===H)?.description||""||B.get(H)||"";return{name:H,description:K}});return console.log("[PublishModal] Merged parameters (from plan template):",U),U}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},L=(T,B)=>{B==="success"?(c.value=T,setTimeout(()=>{c.value=""},3e3)):B==="error"&&(i.value=T,setTimeout(()=>{i.value=""},5e3))},O=()=>{if(!f.userRequest.trim())return L(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return L(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return L(s("mcpService.toolNameRequiredError"),"error"),!1;if(!m.value&&!v.value)return L("Please select at least one service type","error"),!1;for(let U=0;U<f.parameters.length;U++){const H=f.parameters[U];if(H.name&&!H.description.trim())return L(`Parameter "${H.name}" description cannot be empty`,"error"),!1;if(H.description&&!H.name.trim())return L(`Parameter description "${H.description}" corresponding name cannot be empty`,"error"),!1}return!0},W=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",f),console.log("[PublishModal] Publish as HTTP service:",v.value),!O()){console.log("[PublishModal] Form validation failed");return}g.value=!0;try{const T=C();console.log("[PublishModal] Merged parameters:",T);const B=T.filter(ee=>ee.name.trim()).map(ee=>({name:ee.name.trim(),description:ee.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(f.userRequest.trim()),a.setEnableInternalToolcallWithGuard(m.value),a.setEnableHttpServiceWithGuard(v.value),a.setInputSchemaWithGuard(B),!await a.save())throw new Error("Failed to save plan template");const H=[];m.value&&H.push("Internal Method Call"),v.value&&H.push("HTTP Service"),H.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",H.join(", ")),L(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),p("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),L(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),p("published",null))}catch(T){console.error("[PublishModal] Failed to publish service:",T);const B=T instanceof Error?T.message:"Unknown error";L(s("mcpService.publishFailed")+": "+B,"error")}finally{g.value=!1}},S=async()=>{if(E.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const T=a.currentPlanTemplateId.value;if(!T){L(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",T),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),L(s("mcpService.deleteSuccess"),"success"),b.value=!1,p("published",null)}catch(B){console.error("[PublishModal] Failed to delete tool config:",B);const U=B instanceof Error?B.message:"Unknown error";L(s("mcpService.deleteFailed")+": "+U,"error")}finally{E.value=!1}};return ye(()=>r.modelValue,async()=>{b.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),J(),await P())}),ye(()=>a.currentPlanTemplateId.value,(T,B)=>{T&&T!==B&&(B&&T.startsWith("planTemplate-")?setTimeout(()=>{P()},1e3):P())}),Me(async()=>{b.value&&(console.log("[PublishModal] Initialize when component mounted"),J(),await P())}),t({loadParameterRequirements:P}),(T,B)=>(h(),y(he,null,[A(_s,{modelValue:b.value,"onUpdate:modelValue":B[3]||(B[3]=U=>b.value=U),title:I.value,onConfirm:W},{footer:Xe(()=>[o("div",Si,[j.value?(h(),y("button",{key:0,class:"action-btn danger",onClick:S,disabled:E.value},[E.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),$e(d(D),{key:1,icon:"carbon:trash-can"})),me(" "+u(E.value?d(s)("mcpService.deleting"):d(s)("mcpService.delete")),1)],8,Pi)):V("",!0),o("button",{class:"action-btn primary",onClick:W,disabled:g.value},[g.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),$e(d(D),{key:1,icon:"carbon:cloud-upload"})),me(" "+u(g.value?d(s)("mcpService.publishing"):d(s)("mcpService.publishAsService")),1)],8,Ti)])]),default:Xe(()=>[o("div",si,[o("div",oi,[o("div",ni,[o("label",null,u(d(s)("mcpService.toolDescriptionRequired")),1),be(o("textarea",{"onUpdate:modelValue":B[0]||(B[0]=U=>f.userRequest=U),placeholder:d(s)("mcpService.toolDescriptionPlaceholder"),class:ve([{error:!f.userRequest||!f.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,ai),[[ke,f.userRequest]]),o("div",li,u(d(s)("mcpService.toolDescriptionDescription")),1)])]),o("div",ri,[o("div",ii,u(d(s)("mcpService.parameterConfig")),1),w.value.hasParameters?(h(),y("div",ci,u(d(s)("sidebar.parameterRequirementsHelp")),1)):V("",!0),o("div",ui,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,u(d(s)("mcpService.parameterName")),1),o("th",null,u(d(s)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(h(!0),y(he,null,ge(f.parameters,(U,H)=>(h(),y("tr",{key:H},[o("td",null,[be(o("input",{type:"text","onUpdate:modelValue":ee=>U.name=ee,placeholder:d(s)("mcpService.parameterName"),class:ve(["parameter-input",{"readonly-input":w.value.hasParameters}]),readonly:w.value.hasParameters,required:""},null,10,di),[[ke,U.name]])]),o("td",null,[be(o("input",{type:"text","onUpdate:modelValue":ee=>U.description=ee,placeholder:d(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,pi),[[ke,U.description]])])]))),128))])])])]),o("div",mi,[o("div",hi,[o("div",fi,[o("label",vi,[be(o("input",{type:"checkbox","onUpdate:modelValue":B[1]||(B[1]=U=>m.value=U),class:"checkbox-input"},null,512),[[At,m.value]]),o("span",gi,u(d(s)("mcpService.publishAsInternalToolcall")),1)]),o("div",yi,u(d(s)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",bi,[o("label",_i,[be(o("input",{type:"checkbox","onUpdate:modelValue":B[2]||(B[2]=U=>v.value=U),class:"checkbox-input"},null,512),[[At,v.value]]),o("span",wi,u(d(s)("mcpService.publishAsHttpService")),1)]),o("div",$i,u(d(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),i.value?(h(),y("div",{key:0,class:"error-toast",onClick:B[4]||(B[4]=U=>i.value="")},[A(d(D),{icon:"carbon:error"}),me(" "+u(i.value),1)])):V("",!0),c.value?(h(),y("div",{key:1,class:"success-toast",onClick:B[5]||(B[5]=U=>c.value="")},[A(d(D),{icon:"carbon:checkmark"}),me(" "+u(c.value),1)])):V("",!0)],64))}}),ki=Ee(Ei,[["__scopeId","data-v-235a4588"]]),Ci={class:"modal-header"},Ii={class:"modal-body"},Ri={class:"modal-footer"},xi=["disabled"],Ai=Te({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(n,{emit:t}){const e=t,s=F(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(p,b)=>p.modelValue?(h(),y("div",{key:0,class:"modal-overlay",onClick:a},[o("div",{class:"modal-content",onClick:b[0]||(b[0]=we(()=>{},["stop"]))},[o("div",Ci,[o("h3",null,u(p.$t("sidebar.saveConfirmationTitle")),1),o("button",{class:"close-btn",onClick:a},[A(d(D),{icon:"carbon:close",width:"16"})])]),o("div",Ii,[o("p",null,u(p.$t("sidebar.saveConfirmationMessage")),1)]),o("div",Ri,[o("button",{class:"btn btn-secondary",onClick:a},u(p.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),me(" "+u(s.value?p.$t("sidebar.saving"):p.$t("common.save")),1)],8,xi),o("button",{class:"btn btn-danger",onClick:r},u(p.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),Fi=Ee(Ai,[["__scopeId","data-v-4817656d"]]),Mi={class:"config-section"},Di={class:"section-header"},Ni={class:"execution-content"},Ui={class:"params-requirements-group"},Li={class:"params-help-text"},Oi={key:0,class:"parameter-fields"},Bi={class:"parameter-label"},qi=["onUpdate:modelValue","placeholder","onInput"],Hi={key:0,class:"parameter-error"},Vi={key:1,class:"validation-message"},ji=["disabled"],zi=["disabled"],Wi={key:1,class:"call-example-wrapper"},Gi={class:"call-example-header"},Ki={class:"call-example-title"},Ji={class:"call-example-description"},Xi={class:"internal-call-wrapper"},Yi={class:"call-info"},Qi={class:"call-method"},Zi={class:"call-endpoint"},ec={key:0,class:"call-endpoint"},tc={class:"call-description"},sc={class:"call-example"},oc={class:"example-code"},nc={key:2,class:"call-example-wrapper"},ac={class:"call-example-header"},lc={class:"call-example-title"},rc={class:"call-example-description"},ic={class:"http-api-urls-wrapper"},cc={class:"tab-container"},uc={class:"tab-header"},dc=["onClick"],pc={class:"tab-content"},mc={class:"http-api-url-display"},hc={class:"api-method"},fc={class:"api-endpoint"},vc={class:"api-description"},gc={key:0,class:"api-example"},yc={class:"example-code"},bc={key:3,class:"call-example-wrapper"},_c={class:"call-example-header"},wc={class:"call-example-title"},$c={class:"call-example-description"},Sc={class:"mcp-call-wrapper"},Pc={class:"call-info"},Tc={class:"call-method"},Ec={class:"call-endpoint"},kc={class:"call-description"},Cc={class:"call-example"},Ic={class:"example-code"},Rc=Te({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=Bt(),a=We(),l=Ze(),r=Qe(),p=n,b=F(""),i=F(!1),c=F({parameters:[],hasParameters:!1,requirements:""}),g=F({}),E=F(!1),v=F("get-sync"),m=F({}),w=F(!1),_=F(!1),f=re(()=>a.getCoordinatorToolConfig()),I=F(),j=F([]),J=F(null),P=F(!1),C=F(null),L=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),O=re(()=>{const N=a.selectedTemplate.value?.toolConfig;return N?.enableInternalToolcall??N?.enableHttpService??N?.enableMcpService??!1}),W=re(()=>O.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),S=re(()=>l.isLoading.value),x=re(()=>{if(S.value||p.isExecuting||_.value)return!1;const N=r.trackedPlanIds.value.size>0,R=Array.from(r.planExecutionRecords.entries()).some(([,Z])=>Z&&!Z.completed&&Z.status!=="failed");return N||R?!1:c.value.hasParameters?c.value.parameters.every(Z=>{const te=g.value[Z];return typeof te=="string"&&te.trim()!==""}):!0}),T=(N,Q)=>{j.value=N.map(R=>R.originalName),J.value=Q,console.log("[ExecutionController] Files uploaded:",N.length,"uploadKey:",Q)},B=N=>{j.value=N.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",N.length)},U=N=>{J.value=N,console.log("[ExecutionController] Upload key changed:",N)},H=()=>{console.log("[ExecutionController] Upload started")},ee=()=>{console.log("[ExecutionController] Upload completed")},Se=N=>{console.error("[ExecutionController] Upload error:",N)},K=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),p.isExecuting||l.isLoading.value||_.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",p.isExecuting,l.isLoading.value,_.value),s.error(e("sidebar.executionInProgress"));return}if(ue.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!oe()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value);return}const N=c.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;C.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:N,uploadedFiles:j.value,uploadKey:J.value},P.value=!0;return}await ie()},ie=async()=>{if(p.isExecuting||l.isLoading.value||_.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(_.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!oe()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value),_.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),_.value=!1;return}const N=a.getConfig(),Q=a.selectedTemplate.value.planTemplateId||N.planTemplateId,R={title:N.title||a.selectedTemplate.value.title||"Execution Plan",steps:(N.steps||[]).map(_e=>({stepRequirement:_e.stepRequirement||"",agentName:_e.agentName||"",modelName:_e.modelName||null,selectedToolKeys:[],terminateColumns:_e.terminateColumns||"",stepContent:""})),directResponse:N.directResponse||!1,...Q&&{planTemplateId:Q},...N.planType&&{planType:N.planType}},Z=a.selectedTemplate.value.title??N.title??"Execution Plan",te=c.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",te),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(R,null,2));const ne={title:Z,planData:R,params:void 0,replacementParams:te,uploadedFiles:j.value,uploadKey:J.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(ne,null,2));const de=await l.executePlan(ne);de.success?console.log("[ExecutionController] âœ… Plan execution started successfully:",de.planId):(console.error("[ExecutionController] âŒ Plan execution failed:",de.error),s.error(de.error||e("sidebar.executeFailed")))}catch(N){console.error("[ExecutionController] âŒ Error executing plan:",N);const Q=N instanceof Error?N.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+Q),_.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),q(),console.log("[ExecutionController] âœ… Cleanup completed")}},Ie=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const N=a.validate();if(!N.isValid){s.error(`Invalid format, please correct and save.
Errors: `+N.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const Z=a.generateJsonString().trim();a.updateVersionsAfterSave(Z);const te=a.planVersions.value.length;ue.hasTaskRequirementModified=!1,await new Promise(ne=>setTimeout(ne,500)),await z(),await ue.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:te})),await new Promise(ne=>setTimeout(ne,500)),C.value&&(await ie(),C.value=null)}catch(N){console.error("[ExecutionController] âŒ Failed to save before execute:",N);const Q=N instanceof Error?N.message:e("sidebar.saveFailed");throw s.error(Q),N}},ce=async()=>{console.log("[ExecutionController] â© Continue without save requested"),C.value&&(await ie(),C.value=null)},M=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}i.value=!0},q=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),b.value="",g.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},z=async()=>{await new Promise(N=>setTimeout(N,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(N=>N.stepRequirement).join(" ||| ")),await new Promise(N=>setTimeout(N,200)),await Y()},Y=async()=>{const N=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",N),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!N){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},g.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const Q=await Ps.getParameterRequirements(N);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(Q,null,2)),c.value=Q;const R={};Q.parameters.forEach(Z=>{R[Z]=g.value[Z]||""}),g.value=R,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(g.value,null,2)),pe()}catch(Q){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",Q),Q instanceof Error&&!Q.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},g.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(g.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},se=(N,Q)=>{g.value[N]=Q,m.value[N]&&delete m.value[N],pe()},oe=()=>{if(m.value={},w.value=!1,!c.value.hasParameters)return!0;let N=!1;return c.value.parameters.forEach(Q=>{(g.value[Q]?g.value[Q].trim():"")||(m.value[Q]=`${Q} is required`,N=!0)}),w.value=N,!N},pe=()=>{c.value.hasParameters?b.value=JSON.stringify(g.value,null,2):b.value=""};return ye(()=>a.currentPlanTemplateId.value,(N,Q)=>{if(N&&N!==Q){if(_.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),Q&&N.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),Y()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),Y())}}),ye(()=>ue.hasTaskRequirementModified,async(N,Q)=>{if(Q===!0&&N===!1&&a.currentPlanTemplateId.value){if(_.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(R=>setTimeout(R,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await z()}}),ys(()=>{const N=r.planExecutionRecords,Q=Array.from(N.entries()),R=r.trackedPlanIds.value.size>0,Z=Q.some(([,ne])=>ne&&!ne.completed&&ne.status!=="failed");!(R||Z)&&_.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:R,hasRunningPlansInRecords:Z,trackedPlanIds:Array.from(r.trackedPlanIds.value),recordsCount:Q.length}),_.value=!1)}),Me(()=>{Y()}),t({executionParams:b,clearExecutionParams:q,loadParameterRequirements:Y,refreshParameterRequirements:z,fileUploadRef:I,uploadedFiles:j,uploadKey:J}),(N,Q)=>(h(),y(he,null,[o("div",Mi,[o("div",Di,[A(d(D),{icon:"carbon:play",width:"16"}),o("span",null,u(d(e)("sidebar.executionController")),1)]),o("div",Ni,[o("div",Ui,[o("label",null,u(d(e)("sidebar.parameterRequirements")),1),o("div",Li,u(d(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),y("div",Oi,[(h(!0),y(he,null,ge(c.value.parameters,R=>(h(),y("div",{key:R,class:"parameter-field"},[o("label",Bi,[me(u(R)+" ",1),Q[2]||(Q[2]=o("span",{class:"required"},"*",-1))]),be(o("input",{"onUpdate:modelValue":Z=>g.value[R]=Z,class:ve(["parameter-input",{error:m.value[R]}]),placeholder:d(e)("sidebar.enterValueFor",{param:R}),onInput:Z=>se(R,Z.target.value),required:""},null,42,qi),[[ke,g.value[R]]]),m.value[R]?(h(),y("div",Hi,u(m.value[R]),1)):V("",!0)]))),128))])):V("",!0),c.value.hasParameters&&!x.value&&!p.isExecuting?(h(),y("div",Vi,[A(d(D),{icon:"carbon:warning",width:"14"}),me(" "+u(d(e)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),A(Ss,{ref_key:"fileUploadRef",ref:I,disabled:p.isExecuting,onFilesUploaded:T,onFilesRemoved:B,onUploadKeyChanged:U,onUploadStarted:H,onUploadCompleted:ee,onUploadError:Se},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:K,disabled:!x.value},[A(d(D),{icon:p.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ve({spinning:p.isExecuting})},null,8,["icon","class"]),me(" "+u(p.isExecuting?d(e)("sidebar.executing"):d(e)("sidebar.executePlan")),1)],8,ji),f.value?(h(),y("button",{key:0,class:"btn publish-mcp-btn",onClick:M,disabled:!d(a).currentPlanTemplateId.value},[A(d(D),{icon:"carbon:application",width:"16"}),me(" "+u(W.value),1)],8,zi)):V("",!0),d(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),y("div",Wi,[o("div",Gi,[o("h4",Ki,u(d(e)("sidebar.internalCall")),1),o("p",Ji,u(d(e)("sidebar.internalCallDescription")),1)]),o("div",Xi,[o("div",Yi,[o("div",Qi,u(d(e)("sidebar.internalMethodCall")),1),o("div",Zi,u(d(e)("sidebar.toolName"))+": "+u(d(a).selectedTemplate.value?.title||d(a).currentPlanTemplateId.value||""),1),d(a).selectedTemplate.value?.serviceGroup?(h(),y("div",ec,u(d(e)("sidebar.serviceGroup"))+": "+u(d(a).selectedTemplate.value.serviceGroup),1)):V("",!0),o("div",tc,u(d(e)("sidebar.internalCallUsage")),1),o("div",sc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",oc,u(d(e)("sidebar.internalCallExample")),1)])])])])):V("",!0),d(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),y("div",nc,[o("div",ac,[o("h4",lc,u(d(e)("sidebar.httpCallExample")),1),o("p",rc,u(d(e)("sidebar.httpCallDescription")),1)]),o("div",ic,[o("div",cc,[o("div",uc,[(h(!0),y(he,null,ge(L.value,R=>(h(),y("button",{key:R.id,class:ve(["tab-button",{active:v.value===R.id}]),onClick:Z=>v.value=R.id},u(R.label),11,dc))),128))]),o("div",pc,[(h(!0),y(he,null,ge(L.value,R=>be((h(),y("div",{key:R.id,class:"tab-panel"},[o("div",mc,[o("div",hc,u(R.method),1),o("div",fc,u(R.endpoint),1),o("div",vc,u(R.description),1),R.example?(h(),y("div",gc,[o("strong",null,u(d(e)("sidebar.example"))+":",1),o("pre",yc,u(R.example),1)])):V("",!0)])])),[[ho,v.value===R.id]])),128))])])])])):V("",!0),d(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),y("div",bc,[o("div",_c,[o("h4",wc,u(d(e)("sidebar.mcpCall")),1),o("p",$c,u(d(e)("sidebar.mcpCallDescription")),1)]),o("div",Sc,[o("div",Pc,[o("div",Tc,u(d(e)("sidebar.mcpServiceCall")),1),o("div",Ec,u(d(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",kc,u(d(e)("sidebar.mcpCallUsage")),1),o("div",Cc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",Ic,u(d(e)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])]),A(Fi,{modelValue:P.value,"onUpdate:modelValue":Q[0]||(Q[0]=R=>P.value=R),onSave:Ie,onContinue:ce},null,8,["modelValue"]),A(ki,{modelValue:i.value,"onUpdate:modelValue":Q[1]||(Q[1]=R=>i.value=R)},null,8,["modelValue"])],64))}}),xc=Ee(Rc,[["__scopeId","data-v-8e9b3e6f"]]);function Es(n,t){return function(){return n.apply(t,arguments)}}const{toString:Ac}=Object.prototype,{getPrototypeOf:qt}=Object,{iterator:bt,toStringTag:ks}=Symbol,_t=(n=>t=>{const e=Ac.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Le=n=>(n=n.toLowerCase(),t=>_t(t)===n),wt=n=>t=>typeof t===n,{isArray:et}=Array,Ye=wt("undefined");function at(n){return n!==null&&!Ye(n)&&n.constructor!==null&&!Ye(n.constructor)&&Ae(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Cs=Le("ArrayBuffer");function Fc(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&Cs(n.buffer),t}const Mc=wt("string"),Ae=wt("function"),Is=wt("number"),lt=n=>n!==null&&typeof n=="object",Dc=n=>n===!0||n===!1,ht=n=>{if(_t(n)!=="object")return!1;const t=qt(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ks in n)&&!(bt in n)},Nc=n=>{if(!lt(n)||at(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Uc=Le("Date"),Lc=Le("File"),Oc=Le("Blob"),Bc=Le("FileList"),qc=n=>lt(n)&&Ae(n.pipe),Hc=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||Ae(n.append)&&((t=_t(n))==="formdata"||t==="object"&&Ae(n.toString)&&n.toString()==="[object FormData]"))},Vc=Le("URLSearchParams"),[jc,zc,Wc,Gc]=["ReadableStream","Request","Response","Headers"].map(Le),Kc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function rt(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let s,a;if(typeof n!="object"&&(n=[n]),et(n))for(s=0,a=n.length;s<a;s++)t.call(null,n[s],s,n);else{if(at(n))return;const l=e?Object.getOwnPropertyNames(n):Object.keys(n),r=l.length;let p;for(s=0;s<r;s++)p=l[s],t.call(null,n[p],p,n)}}function Rs(n,t){if(at(n))return null;t=t.toLowerCase();const e=Object.keys(n);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xs=n=>!Ye(n)&&n!==Ve;function Mt(){const{caseless:n,skipUndefined:t}=xs(this)&&this||{},e={},s=(a,l)=>{const r=n&&Rs(e,l)||l;ht(e[r])&&ht(a)?e[r]=Mt(e[r],a):ht(a)?e[r]=Mt({},a):et(a)?e[r]=a.slice():(!t||!Ye(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&rt(arguments[a],s);return e}const Jc=(n,t,e,{allOwnKeys:s}={})=>(rt(t,(a,l)=>{e&&Ae(a)?n[l]=Es(a,e):n[l]=a},{allOwnKeys:s}),n),Xc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Yc=(n,t,e,s)=>{n.prototype=Object.create(t.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},Qc=(n,t,e,s)=>{let a,l,r;const p={};if(t=t||{},n==null)return t;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)r=a[l],(!s||s(r,n,t))&&!p[r]&&(t[r]=n[r],p[r]=!0);n=e!==!1&&qt(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},Zc=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const s=n.indexOf(t,e);return s!==-1&&s===e},eu=n=>{if(!n)return null;if(et(n))return n;let t=n.length;if(!Is(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},tu=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&qt(Uint8Array)),su=(n,t)=>{const s=(n&&n[bt]).call(n);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(n,l[0],l[1])}},ou=(n,t)=>{let e;const s=[];for(;(e=n.exec(t))!==null;)s.push(e);return s},nu=Le("HTMLFormElement"),au=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),es=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),lu=Le("RegExp"),As=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),s={};rt(e,(a,l)=>{let r;(r=t(a,l,n))!==!1&&(s[l]=r||a)}),Object.defineProperties(n,s)},ru=n=>{As(n,(t,e)=>{if(Ae(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=n[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},iu=(n,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return et(n)?s(n):s(String(n).split(t)),e},cu=()=>{},uu=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function du(n){return!!(n&&Ae(n.append)&&n[ks]==="FormData"&&n[bt])}const pu=n=>{const t=new Array(10),e=(s,a)=>{if(lt(s)){if(t.indexOf(s)>=0)return;if(at(s))return s;if(!("toJSON"in s)){t[a]=s;const l=et(s)?[]:{};return rt(s,(r,p)=>{const b=e(r,a+1);!Ye(b)&&(l[p]=b)}),t[a]=void 0,l}}return s};return e(n,0)},mu=Le("AsyncFunction"),hu=n=>n&&(lt(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),Fs=((n,t)=>n?setImmediate:t?((e,s)=>(Ve.addEventListener("message",({source:a,data:l})=>{a===Ve&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),Ve.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(Ve.postMessage)),fu=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||Fs,vu=n=>n!=null&&Ae(n[bt]),k={isArray:et,isArrayBuffer:Cs,isBuffer:at,isFormData:Hc,isArrayBufferView:Fc,isString:Mc,isNumber:Is,isBoolean:Dc,isObject:lt,isPlainObject:ht,isEmptyObject:Nc,isReadableStream:jc,isRequest:zc,isResponse:Wc,isHeaders:Gc,isUndefined:Ye,isDate:Uc,isFile:Lc,isBlob:Oc,isRegExp:lu,isFunction:Ae,isStream:qc,isURLSearchParams:Vc,isTypedArray:tu,isFileList:Bc,forEach:rt,merge:Mt,extend:Jc,trim:Kc,stripBOM:Xc,inherits:Yc,toFlatObject:Qc,kindOf:_t,kindOfTest:Le,endsWith:Zc,toArray:eu,forEachEntry:su,matchAll:ou,isHTMLForm:nu,hasOwnProperty:es,hasOwnProp:es,reduceDescriptors:As,freezeMethods:ru,toObjectSet:iu,toCamelCase:au,noop:cu,toFiniteNumber:uu,findKey:Rs,global:Ve,isContextDefined:xs,isSpecCompliantForm:du,toJSONObject:pu,isAsyncFn:mu,isThenable:hu,setImmediate:Fs,asap:fu,isIterable:vu};function le(n,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}k.inherits(le,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.status}}});const Ms=le.prototype,Ds={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ds[n]={value:n}});Object.defineProperties(le,Ds);Object.defineProperty(Ms,"isAxiosError",{value:!0});le.from=(n,t,e,s,a,l)=>{const r=Object.create(Ms);k.toFlatObject(n,r,function(c){return c!==Error.prototype},i=>i!=="isAxiosError");const p=n&&n.message?n.message:"Error",b=t==null&&n?n.code:t;return le.call(r,p,b,e,s,a),n&&r.cause==null&&Object.defineProperty(r,"cause",{value:n,configurable:!0}),r.name=n&&n.name||"Error",l&&Object.assign(r,l),r};const gu=null;function Dt(n){return k.isPlainObject(n)||k.isArray(n)}function Ns(n){return k.endsWith(n,"[]")?n.slice(0,-2):n}function ts(n,t,e){return n?n.concat(t).map(function(a,l){return a=Ns(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function yu(n){return k.isArray(n)&&!n.some(Dt)}const bu=k.toFlatObject(k,{},null,function(t){return/^is[A-Z]/.test(t)});function $t(n,t,e){if(!k.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=k.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,_){return!k.isUndefined(_[w])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,r=e.indexes,b=(e.Blob||typeof Blob<"u"&&Blob)&&k.isSpecCompliantForm(t);if(!k.isFunction(a))throw new TypeError("visitor must be a function");function i(m){if(m===null)return"";if(k.isDate(m))return m.toISOString();if(k.isBoolean(m))return m.toString();if(!b&&k.isBlob(m))throw new le("Blob is not supported. Use a Buffer instead.");return k.isArrayBuffer(m)||k.isTypedArray(m)?b&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,w,_){let f=m;if(m&&!_&&typeof m=="object"){if(k.endsWith(w,"{}"))w=s?w:w.slice(0,-2),m=JSON.stringify(m);else if(k.isArray(m)&&yu(m)||(k.isFileList(m)||k.endsWith(w,"[]"))&&(f=k.toArray(m)))return w=Ns(w),f.forEach(function(j,J){!(k.isUndefined(j)||j===null)&&t.append(r===!0?ts([w],J,l):r===null?w:w+"[]",i(j))}),!1}return Dt(m)?!0:(t.append(ts(_,w,l),i(m)),!1)}const g=[],E=Object.assign(bu,{defaultVisitor:c,convertValue:i,isVisitable:Dt});function v(m,w){if(!k.isUndefined(m)){if(g.indexOf(m)!==-1)throw Error("Circular reference detected in "+w.join("."));g.push(m),k.forEach(m,function(f,I){(!(k.isUndefined(f)||f===null)&&a.call(t,f,k.isString(I)?I.trim():I,w,E))===!0&&v(f,w?w.concat(I):[I])}),g.pop()}}if(!k.isObject(n))throw new TypeError("data must be an object");return v(n),t}function ss(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Ht(n,t){this._pairs=[],n&&$t(n,this,t)}const Us=Ht.prototype;Us.append=function(t,e){this._pairs.push([t,e])};Us.toString=function(t){const e=t?function(s){return t.call(this,s,ss)}:ss;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function _u(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ls(n,t,e){if(!t)return n;const s=e&&e.encode||_u;k.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=k.isURLSearchParams(t)?t.toString():new Ht(t,e).toString(s),l){const r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class os{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){k.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Os={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wu=typeof URLSearchParams<"u"?URLSearchParams:Ht,$u=typeof FormData<"u"?FormData:null,Su=typeof Blob<"u"?Blob:null,Pu={isBrowser:!0,classes:{URLSearchParams:wu,FormData:$u,Blob:Su},protocols:["http","https","file","blob","url","data"]},Vt=typeof window<"u"&&typeof document<"u",Nt=typeof navigator=="object"&&navigator||void 0,Tu=Vt&&(!Nt||["ReactNative","NativeScript","NS"].indexOf(Nt.product)<0),Eu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ku=Vt&&window.location.href||"http://localhost",Cu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Vt,hasStandardBrowserEnv:Tu,hasStandardBrowserWebWorkerEnv:Eu,navigator:Nt,origin:ku},Symbol.toStringTag,{value:"Module"})),Re={...Cu,...Pu};function Iu(n,t){return $t(n,new Re.classes.URLSearchParams,{visitor:function(e,s,a,l){return Re.isNode&&k.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Ru(n){return k.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function xu(n){const t={},e=Object.keys(n);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=n[l];return t}function Bs(n){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const p=Number.isFinite(+r),b=l>=e.length;return r=!r&&k.isArray(a)?a.length:r,b?(k.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!p):((!a[r]||!k.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&k.isArray(a[r])&&(a[r]=xu(a[r])),!p)}if(k.isFormData(n)&&k.isFunction(n.entries)){const e={};return k.forEachEntry(n,(s,a)=>{t(Ru(s),a,e,0)}),e}return null}function Au(n,t,e){if(k.isString(n))try{return(t||JSON.parse)(n),k.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(n)}const it={transitional:Os,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=k.isObject(t);if(l&&k.isHTMLForm(t)&&(t=new FormData(t)),k.isFormData(t))return a?JSON.stringify(Bs(t)):t;if(k.isArrayBuffer(t)||k.isBuffer(t)||k.isStream(t)||k.isFile(t)||k.isBlob(t)||k.isReadableStream(t))return t;if(k.isArrayBufferView(t))return t.buffer;if(k.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let p;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Iu(t,this.formSerializer).toString();if((p=k.isFileList(t))||s.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return $t(p?{"files[]":t}:t,b&&new b,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Au(t)):t}],transformResponse:[function(t){const e=this.transitional||it.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(k.isResponse(t)||k.isReadableStream(t))return t;if(t&&k.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(p){if(r)throw p.name==="SyntaxError"?le.from(p,le.ERR_BAD_RESPONSE,this,null,this.response):p}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};k.forEach(["delete","get","head","post","put","patch"],n=>{it.headers[n]={}});const Fu=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mu=n=>{const t={};let e,s,a;return n&&n.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&Fu[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ns=Symbol("internals");function ot(n){return n&&String(n).trim().toLowerCase()}function ft(n){return n===!1||n==null?n:k.isArray(n)?n.map(ft):String(n)}function Du(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(n);)t[s[1]]=s[2];return t}const Nu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function kt(n,t,e,s,a){if(k.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!k.isString(t)){if(k.isString(s))return t.indexOf(s)!==-1;if(k.isRegExp(s))return s.test(t)}}function Uu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Lu(n,t){const e=k.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(p,b,i){const c=ot(b);if(!c)throw new Error("header name must be a non-empty string");const g=k.findKey(a,c);(!g||a[g]===void 0||i===!0||i===void 0&&a[g]!==!1)&&(a[g||b]=ft(p))}const r=(p,b)=>k.forEach(p,(i,c)=>l(i,c,b));if(k.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(k.isString(t)&&(t=t.trim())&&!Nu(t))r(Mu(t),e);else if(k.isObject(t)&&k.isIterable(t)){let p={},b,i;for(const c of t){if(!k.isArray(c))throw TypeError("Object iterator must return a key-value pair");p[i=c[0]]=(b=p[i])?k.isArray(b)?[...b,c[1]]:[b,c[1]]:c[1]}r(p,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=ot(t),t){const s=k.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return Du(a);if(k.isFunction(e))return e.call(this,a,s);if(k.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ot(t),t){const s=k.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||kt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=ot(r),r){const p=k.findKey(s,r);p&&(!e||kt(s,s[p],p,e))&&(delete s[p],a=!0)}}return k.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||kt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return k.forEach(this,(a,l)=>{const r=k.findKey(s,l);if(r){e[r]=ft(a),delete e[l];return}const p=t?Uu(l):String(l).trim();p!==l&&delete e[l],e[p]=ft(a),s[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return k.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&k.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ns]=this[ns]={accessors:{}}).accessors,a=this.prototype;function l(r){const p=ot(r);s[p]||(Lu(a,r),s[p]=!0)}return k.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);k.reduceDescriptors(Fe.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[e]=s}}});k.freezeMethods(Fe);function Ct(n,t){const e=this||it,s=t||e,a=Fe.from(s.headers);let l=s.data;return k.forEach(n,function(p){l=p.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function qs(n){return!!(n&&n.__CANCEL__)}function tt(n,t,e){le.call(this,n??"canceled",le.ERR_CANCELED,t,e),this.name="CanceledError"}k.inherits(tt,le,{__CANCEL__:!0});function Hs(n,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?n(e):t(new le("Request failed with status code "+e.status,[le.ERR_BAD_REQUEST,le.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Ou(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function Bu(n,t){n=n||10;const e=new Array(n),s=new Array(n);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(b){const i=Date.now(),c=s[l];r||(r=i),e[a]=b,s[a]=i;let g=l,E=0;for(;g!==a;)E+=e[g++],g=g%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),i-r<t)return;const v=c&&i-c;return v?Math.round(E*1e3/v):void 0}}function qu(n,t){let e=0,s=1e3/t,a,l;const r=(i,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),n(...i)};return[(...i)=>{const c=Date.now(),g=c-e;g>=s?r(i,c):(a=i,l||(l=setTimeout(()=>{l=null,r(a)},s-g)))},()=>a&&r(a)]}const yt=(n,t,e=3)=>{let s=0;const a=Bu(50,250);return qu(l=>{const r=l.loaded,p=l.lengthComputable?l.total:void 0,b=r-s,i=a(b),c=r<=p;s=r;const g={loaded:r,total:p,progress:p?r/p:void 0,bytes:b,rate:i||void 0,estimated:i&&p&&c?(p-r)/i:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0};n(g)},e)},as=(n,t)=>{const e=n!=null;return[s=>t[0]({lengthComputable:e,total:n,loaded:s}),t[1]]},ls=n=>(...t)=>k.asap(()=>n(...t)),Hu=Re.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Re.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,Vu=Re.hasStandardBrowserEnv?{write(n,t,e,s,a,l,r){if(typeof document>"u")return;const p=[`${n}=${encodeURIComponent(t)}`];k.isNumber(e)&&p.push(`expires=${new Date(e).toUTCString()}`),k.isString(s)&&p.push(`path=${s}`),k.isString(a)&&p.push(`domain=${a}`),l===!0&&p.push("secure"),k.isString(r)&&p.push(`SameSite=${r}`),document.cookie=p.join("; ")},read(n){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ju(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zu(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function Vs(n,t,e){let s=!ju(t);return n&&(s||e==!1)?zu(n,t):t}const rs=n=>n instanceof Fe?{...n}:n;function ze(n,t){t=t||{};const e={};function s(i,c,g,E){return k.isPlainObject(i)&&k.isPlainObject(c)?k.merge.call({caseless:E},i,c):k.isPlainObject(c)?k.merge({},c):k.isArray(c)?c.slice():c}function a(i,c,g,E){if(k.isUndefined(c)){if(!k.isUndefined(i))return s(void 0,i,g,E)}else return s(i,c,g,E)}function l(i,c){if(!k.isUndefined(c))return s(void 0,c)}function r(i,c){if(k.isUndefined(c)){if(!k.isUndefined(i))return s(void 0,i)}else return s(void 0,c)}function p(i,c,g){if(g in t)return s(i,c);if(g in n)return s(void 0,i)}const b={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:p,headers:(i,c,g)=>a(rs(i),rs(c),g,!0)};return k.forEach(Object.keys({...n,...t}),function(c){const g=b[c]||a,E=g(n[c],t[c],c);k.isUndefined(E)&&g!==p||(e[c]=E)}),e}const js=n=>{const t=ze({},n);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:p}=t;if(t.headers=r=Fe.from(r),t.url=Ls(Vs(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&r.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),k.isFormData(e)){if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(k.isFunction(e.getHeaders)){const b=e.getHeaders(),i=["content-type","content-length"];Object.entries(b).forEach(([c,g])=>{i.includes(c.toLowerCase())&&r.set(c,g)})}}if(Re.hasStandardBrowserEnv&&(s&&k.isFunction(s)&&(s=s(t)),s||s!==!1&&Hu(t.url))){const b=a&&l&&Vu.read(l);b&&r.set(a,b)}return t},Wu=typeof XMLHttpRequest<"u",Gu=Wu&&function(n){return new Promise(function(e,s){const a=js(n);let l=a.data;const r=Fe.from(a.headers).normalize();let{responseType:p,onUploadProgress:b,onDownloadProgress:i}=a,c,g,E,v,m;function w(){v&&v(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function f(){if(!_)return;const j=Fe.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),P={data:!p||p==="text"||p==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:j,config:n,request:_};Hs(function(L){e(L),w()},function(L){s(L),w()},P),_=null}"onloadend"in _?_.onloadend=f:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(f)},_.onabort=function(){_&&(s(new le("Request aborted",le.ECONNABORTED,n,_)),_=null)},_.onerror=function(J){const P=J&&J.message?J.message:"Network Error",C=new le(P,le.ERR_NETWORK,n,_);C.event=J||null,s(C),_=null},_.ontimeout=function(){let J=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const P=a.transitional||Os;a.timeoutErrorMessage&&(J=a.timeoutErrorMessage),s(new le(J,P.clarifyTimeoutError?le.ETIMEDOUT:le.ECONNABORTED,n,_)),_=null},l===void 0&&r.setContentType(null),"setRequestHeader"in _&&k.forEach(r.toJSON(),function(J,P){_.setRequestHeader(P,J)}),k.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),p&&p!=="json"&&(_.responseType=a.responseType),i&&([E,m]=yt(i,!0),_.addEventListener("progress",E)),b&&_.upload&&([g,v]=yt(b),_.upload.addEventListener("progress",g),_.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(c=j=>{_&&(s(!j||j.type?new tt(null,n,_):j),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const I=Ou(a.url);if(I&&Re.protocols.indexOf(I)===-1){s(new le("Unsupported protocol "+I+":",le.ERR_BAD_REQUEST,n));return}_.send(l||null)})},Ku=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(i){if(!a){a=!0,p();const c=i instanceof Error?i:this.reason;s.abort(c instanceof le?c:new tt(c instanceof Error?c.message:c))}};let r=t&&setTimeout(()=>{r=null,l(new le(`timeout ${t} of ms exceeded`,le.ETIMEDOUT))},t);const p=()=>{n&&(r&&clearTimeout(r),r=null,n.forEach(i=>{i.unsubscribe?i.unsubscribe(l):i.removeEventListener("abort",l)}),n=null)};n.forEach(i=>i.addEventListener("abort",l));const{signal:b}=s;return b.unsubscribe=()=>k.asap(p),b}},Ju=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let s=0,a;for(;s<e;)a=s+t,yield n.slice(s,a),s=a},Xu=async function*(n,t){for await(const e of Yu(n))yield*Ju(e,t)},Yu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},is=(n,t,e,s)=>{const a=Xu(n,t);let l=0,r,p=b=>{r||(r=!0,s&&s(b))};return new ReadableStream({async pull(b){try{const{done:i,value:c}=await a.next();if(i){p(),b.close();return}let g=c.byteLength;if(e){let E=l+=g;e(E)}b.enqueue(new Uint8Array(c))}catch(i){throw p(i),i}},cancel(b){return p(b),a.return()}},{highWaterMark:2})},cs=64*1024,{isFunction:pt}=k,Qu=(({Request:n,Response:t})=>({Request:n,Response:t}))(k.global),{ReadableStream:us,TextEncoder:ds}=k.global,ps=(n,...t)=>{try{return!!n(...t)}catch{return!1}},Zu=n=>{n=k.merge.call({skipUndefined:!0},Qu,n);const{fetch:t,Request:e,Response:s}=n,a=t?pt(t):typeof fetch=="function",l=pt(e),r=pt(s);if(!a)return!1;const p=a&&pt(us),b=a&&(typeof ds=="function"?(m=>w=>m.encode(w))(new ds):async m=>new Uint8Array(await new e(m).arrayBuffer())),i=l&&p&&ps(()=>{let m=!1;const w=new e(Re.origin,{body:new us,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!w}),c=r&&p&&ps(()=>k.isReadableStream(new s("").body)),g={stream:c&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!g[m]&&(g[m]=(w,_)=>{let f=w&&w[m];if(f)return f.call(w);throw new le(`Response type '${m}' is not supported`,le.ERR_NOT_SUPPORT,_)})});const E=async m=>{if(m==null)return 0;if(k.isBlob(m))return m.size;if(k.isSpecCompliantForm(m))return(await new e(Re.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(k.isArrayBufferView(m)||k.isArrayBuffer(m))return m.byteLength;if(k.isURLSearchParams(m)&&(m=m+""),k.isString(m))return(await b(m)).byteLength},v=async(m,w)=>{const _=k.toFiniteNumber(m.getContentLength());return _??E(w)};return async m=>{let{url:w,method:_,data:f,signal:I,cancelToken:j,timeout:J,onDownloadProgress:P,onUploadProgress:C,responseType:L,headers:O,withCredentials:W="same-origin",fetchOptions:S}=js(m),x=t||fetch;L=L?(L+"").toLowerCase():"text";let T=Ku([I,j&&j.toAbortSignal()],J),B=null;const U=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let H;try{if(C&&i&&_!=="get"&&_!=="head"&&(H=await v(O,f))!==0){let ce=new e(w,{method:"POST",body:f,duplex:"half"}),M;if(k.isFormData(f)&&(M=ce.headers.get("content-type"))&&O.setContentType(M),ce.body){const[q,z]=as(H,yt(ls(C)));f=is(ce.body,cs,q,z)}}k.isString(W)||(W=W?"include":"omit");const ee=l&&"credentials"in e.prototype,Se={...S,signal:T,method:_.toUpperCase(),headers:O.normalize().toJSON(),body:f,duplex:"half",credentials:ee?W:void 0};B=l&&new e(w,Se);let K=await(l?x(B,S):x(w,Se));const ie=c&&(L==="stream"||L==="response");if(c&&(P||ie&&U)){const ce={};["status","statusText","headers"].forEach(Y=>{ce[Y]=K[Y]});const M=k.toFiniteNumber(K.headers.get("content-length")),[q,z]=P&&as(M,yt(ls(P),!0))||[];K=new s(is(K.body,cs,q,()=>{z&&z(),U&&U()}),ce)}L=L||"text";let Ie=await g[k.findKey(g,L)||"text"](K,m);return!ie&&U&&U(),await new Promise((ce,M)=>{Hs(ce,M,{data:Ie,headers:Fe.from(K.headers),status:K.status,statusText:K.statusText,config:m,request:B})})}catch(ee){throw U&&U(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new le("Network Error",le.ERR_NETWORK,m,B),{cause:ee.cause||ee}):le.from(ee,ee&&ee.code,m,B)}}},ed=new Map,zs=n=>{let t=n&&n.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,p=r,b,i,c=ed;for(;p--;)b=l[p],i=c.get(b),i===void 0&&c.set(b,i=p?new Map:Zu(t)),c=i;return i};zs();const jt={http:gu,xhr:Gu,fetch:{get:zs}};k.forEach(jt,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const ms=n=>`- ${n}`,td=n=>k.isFunction(n)||n===null||n===!1;function sd(n,t){n=k.isArray(n)?n:[n];const{length:e}=n;let s,a;const l={};for(let r=0;r<e;r++){s=n[r];let p;if(a=s,!td(s)&&(a=jt[(p=String(s)).toLowerCase()],a===void 0))throw new le(`Unknown adapter '${p}'`);if(a&&(k.isFunction(a)||(a=a.get(t))))break;l[p||"#"+r]=a}if(!a){const r=Object.entries(l).map(([b,i])=>`adapter ${b} `+(i===!1?"is not supported by the environment":"is not available in the build"));let p=e?r.length>1?`since :
`+r.map(ms).join(`
`):" "+ms(r[0]):"as no adapter specified";throw new le("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return a}const Ws={getAdapter:sd,adapters:jt};function It(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new tt(null,n)}function hs(n){return It(n),n.headers=Fe.from(n.headers),n.data=Ct.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ws.getAdapter(n.adapter||it.adapter,n)(n).then(function(s){return It(n),s.data=Ct.call(n,n.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return qs(s)||(It(n),s&&s.response&&(s.response.data=Ct.call(n,n.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const Gs="1.13.2",St={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{St[n]=function(s){return typeof s===n||"a"+(t<1?"n ":" ")+n}});const fs={};St.transitional=function(t,e,s){function a(l,r){return"[Axios v"+Gs+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,p)=>{if(t===!1)throw new le(a(r," has been removed"+(e?" in "+e:"")),le.ERR_DEPRECATED);return e&&!fs[r]&&(fs[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,p):!0}};St.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function od(n,t,e){if(typeof n!="object")throw new le("options must be an object",le.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const p=n[l],b=p===void 0||r(p,l,n);if(b!==!0)throw new le("option "+l+" must be "+b,le.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new le("Unknown option "+l,le.ERR_BAD_OPTION)}}const vt={assertOptions:od,validators:St},Oe=vt.validators;let je=class{constructor(t){this.defaults=t||{},this.interceptors={request:new os,response:new os}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ze(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&vt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(k.isFunction(a)?e.paramsSerializer={serialize:a}:vt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),vt.assertOptions(e,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&k.merge(l.common,l[e.method]);l&&k.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),e.headers=Fe.concat(r,l);const p=[];let b=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(e)===!1||(b=b&&w.synchronous,p.unshift(w.fulfilled,w.rejected))});const i=[];this.interceptors.response.forEach(function(w){i.push(w.fulfilled,w.rejected)});let c,g=0,E;if(!b){const m=[hs.bind(this),void 0];for(m.unshift(...p),m.push(...i),E=m.length,c=Promise.resolve(e);g<E;)c=c.then(m[g++],m[g++]);return c}E=p.length;let v=e;for(;g<E;){const m=p[g++],w=p[g++];try{v=m(v)}catch(_){w.call(this,_);break}}try{c=hs.call(this,v)}catch(m){return Promise.reject(m)}for(g=0,E=i.length;g<E;)c=c.then(i[g++],i[g++]);return c}getUri(t){t=ze(this.defaults,t);const e=Vs(t.baseURL,t.url,t.allowAbsoluteUrls);return Ls(e,t.params,t.paramsSerializer)}};k.forEach(["delete","get","head","options"],function(t){je.prototype[t]=function(e,s){return this.request(ze(s||{},{method:t,url:e,data:(s||{}).data}))}});k.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,p){return this.request(ze(p||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}je.prototype[t]=e(),je.prototype[t+"Form"]=e(!0)});let nd=class Ks{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(p=>{s.subscribe(p),l=p}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,p){s.reason||(s.reason=new tt(l,r,p),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ks(function(a){t=a}),cancel:t}}};function ad(n){return function(e){return n.apply(null,e)}}function ld(n){return k.isObject(n)&&n.isAxiosError===!0}const Ut={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Ut).forEach(([n,t])=>{Ut[t]=n});function Js(n){const t=new je(n),e=Es(je.prototype.request,t);return k.extend(e,je.prototype,t,{allOwnKeys:!0}),k.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Js(ze(n,a))},e}const Pe=Js(it);Pe.Axios=je;Pe.CanceledError=tt;Pe.CancelToken=nd;Pe.isCancel=qs;Pe.VERSION=Gs;Pe.toFormData=$t;Pe.AxiosError=le;Pe.Cancel=Pe.CanceledError;Pe.all=function(t){return Promise.all(t)};Pe.spread=ad;Pe.isAxiosError=ld;Pe.mergeConfig=ze;Pe.AxiosHeaders=Fe;Pe.formToJSON=n=>Bs(k.isHTMLForm(n)?new FormData(n):n);Pe.getAdapter=Ws.getAdapter;Pe.HttpStatusCode=Ut;Pe.default=Pe;const{Axios:Lf,AxiosError:Of,CanceledError:Bf,isCancel:qf,CancelToken:Hf,VERSION:Vf,all:jf,Cancel:zf,isAxiosError:Wf,spread:Gf,toFormData:Kf,AxiosHeaders:Jf,HttpStatusCode:Xf,formToJSON:Yf,getAdapter:Qf,mergeConfig:Zf}=Pe;class rd{static async getAvailableModels(){try{return(await Pe({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const id={class:"assigned-tools"},cd={class:"section-header"},ud=["title"],dd={class:"tool-info"},pd={class:"tool-name"},md=["title"],hd={key:0,class:"no-tools"},fd=Te({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:t}){const e=n,s=t,a=nt(),l=re(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=re(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(i=>l.value.some(c=>c.key===i)):[]);ye(r,i=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;i.length!==c&&s("tools-filtered",i)},{immediate:!0});const p=i=>{const c=l.value.find(E=>E.key===i);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:i},b=i=>{const c=l.value.find(g=>g.key===i);return c?c.description:""};return(i,c)=>(h(),y("div",id,[o("div",cd,[o("span",null,u(i.title)+" ("+u(r.value.length)+")",1),i.showAddButton?(h(),y("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=g=>i.$emit("add-tools"))},[A(d(D),{icon:"carbon:add"}),me(" "+u(i.addButtonText),1)])):V("",!0)]),o("div",{class:ve(["tools-grid",{"grid-layout":i.useGridLayout,"has-more-items":i.useGridLayout&&r.value.length>2}])},[(h(!0),y(he,null,ge(r.value,g=>(h(),y("div",{key:g,class:"tool-item assigned",title:b(g)},[o("div",dd,[o("span",pd,u(p(g)),1),o("span",{class:"tool-desc",title:b(g)},u(b(g)),9,md)])],8,ud))),128)),r.value.length===0?(h(),y("div",hd,[A(d(D),{icon:"carbon:tool-box"}),o("span",null,u(i.emptyText),1)])):V("",!0)],2)]))}}),vd=Ee(fd,[["__scopeId","data-v-62354a05"]]),gd={class:"tool-selection-content"},yd={class:"tool-controls"},bd={class:"search-container"},_d=["placeholder"],wd={class:"sort-container"},$d={value:"group"},Sd={value:"name"},Pd={value:"enabled"},Td={class:"tool-summary"},Ed={class:"summary-text"},kd={key:0,class:"tool-groups"},Cd=["onClick"],Id={class:"group-title-area"},Rd={class:"group-name"},xd={class:"group-count"},Ad={class:"group-enable-all"},Fd=["checked","onChange","data-group"],Md={class:"enable-label"},Dd={class:"tool-info"},Nd={class:"tool-selection-name"},Ud={key:0,class:"tool-selection-desc"},Ld={class:"tool-actions"},Od=["checked","onChange"],Bd={key:1,class:"empty-state"},qd=Te({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:t}){const e=n,s=t,a=nt(),l=re(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),ye(()=>e.modelValue,S=>{S&&!a.isLoading.value&&a.loadAvailableTools()});const r=re({get:()=>e.modelValue,set:S=>s("update:modelValue",S)}),p=F(""),b=F("group"),i=F(new Set),c=F([]),g=F(null),E=(S,x)=>{const T=document.querySelector(`input[data-group="${S}"]`);T&&(T.indeterminate=P(x))};ye(()=>e.selectedToolIds,S=>{c.value=[...S]},{immediate:!0});const v=re(()=>{let S=l.value.filter(x=>x.key);if(S=S.filter(x=>x.selectable===!0),p.value){const x=p.value.toLowerCase();S=S.filter(T=>T.name.toLowerCase().includes(x)||T.description.toLowerCase().includes(x)||T.serviceGroup.toLowerCase().includes(x))}switch(b.value){case"name":S=[...S].sort((x,T)=>x.name.localeCompare(T.name));break;case"enabled":S=[...S].sort((x,T)=>{const B=c.value.includes(x.key),U=c.value.includes(T.key);return B&&!U?-1:!B&&U?1:x.name.localeCompare(T.name)});break;case"group":default:S=[...S].sort((x,T)=>{const B=x.serviceGroup||"Ungrouped",U=T.serviceGroup||"Ungrouped";return B!==U?B.localeCompare(U):x.name.localeCompare(T.name)});break}return S}),m=re(()=>{const S=new Map;return l.value.filter(T=>T.key&&T.selectable===!0).forEach(T=>{const B=T.serviceGroup||"Ungrouped";S.has(B)||S.set(B,[]),S.get(B).push(T)}),S}),w=re(()=>{const S=new Map;return v.value.forEach(x=>{const T=x.serviceGroup||"Ungrouped";S.has(T)||S.set(T,[]),S.get(T).push(x)}),new Map([...S.entries()].sort())}),_=re(()=>v.value.length);ye([c,w],()=>{xe(()=>{for(const[S,x]of w.value)E(S,x)})},{flush:"post",deep:!1});const f=S=>c.value.includes(S),I=(S,x)=>{x.stopPropagation();const B=x.target.checked;if(!S){console.error("toolKey is undefined, cannot proceed");return}B?c.value.includes(S)||(c.value=[...c.value,S]):c.value=c.value.filter(U=>U!==S)},j=S=>S.filter(x=>c.value.includes(x.key)),J=S=>S.length>0&&S.every(x=>c.value.includes(x.key)),P=S=>{const x=j(S).length;return x>0&&x<S.length},C=(S,x)=>{x.stopPropagation();const B=x.target.checked,U=S.map(H=>H.key);if(B){const H=[...c.value];U.forEach(ee=>{H.includes(ee)||H.push(ee)}),c.value=H}else c.value=c.value.filter(H=>!U.includes(H))},L=S=>{i.value.has(S)?i.value.delete(S):i.value.add(S)},O=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},W=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return ye(p,S=>{const x=S.trim().toLowerCase();if(x){g.value===null&&(g.value=new Set(i.value));for(const[T,B]of m.value)B.some(H=>H.name.toLowerCase().includes(x)||H.description&&H.description.toLowerCase().includes(x)||H.serviceGroup&&H.serviceGroup.toLowerCase().includes(x))&&i.value.delete(T)}else g.value!==null&&(i.value=new Set(g.value),g.value=null)}),ye(r,S=>{if(S){i.value.clear(),g.value=null;const x=Array.from(w.value.keys());x.length>1&&x.slice(1).forEach(T=>{i.value.add(T)})}}),(S,x)=>(h(),$e(_s,{modelValue:r.value,"onUpdate:modelValue":[x[4]||(x[4]=T=>r.value=T),W],title:S.$t("toolSelection.title"),onConfirm:O},{default:Xe(()=>[o("div",gd,[o("div",yd,[o("div",bd,[be(o("input",{"onUpdate:modelValue":x[0]||(x[0]=T=>p.value=T),type:"text",class:"search-input",placeholder:S.$t("toolSelection.searchPlaceholder")},null,8,_d),[[ke,p.value]])]),o("div",wd,[be(o("select",{"onUpdate:modelValue":x[1]||(x[1]=T=>b.value=T),class:"sort-select"},[o("option",$d,u(S.$t("toolSelection.sortByGroup")),1),o("option",Sd,u(S.$t("toolSelection.sortByName")),1),o("option",Pd,u(S.$t("toolSelection.sortByStatus")),1)],512),[[Lt,b.value]])])]),o("div",Td,[o("span",Ed,u(S.$t("toolSelection.summary",{groups:w.value.size,tools:_.value,selected:c.value.length})),1)]),w.value.size>0?(h(),y("div",kd,[(h(!0),y(he,null,ge(w.value,([T,B])=>(h(),y("div",{key:T,class:"tool-group"},[o("div",{class:ve(["tool-group-header",{collapsed:i.value.has(T)}]),onClick:U=>L(T)},[o("div",Id,[A(d(D),{icon:i.value.has(T)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(d(D),{icon:"carbon:folder",class:"group-icon"}),o("span",Rd,u(T),1),o("span",xd," ("+u(j(B).length)+"/"+u(B.length)+") ",1)]),o("div",{class:"group-actions",onClick:x[2]||(x[2]=we(()=>{},["stop"]))},[o("label",Ad,[o("input",{type:"checkbox",class:"group-enable-checkbox",checked:J(B),onChange:U=>C(B,U),"data-group":T},null,40,Fd),o("span",Md,u(S.$t("toolSelection.enableAll")),1)])])],10,Cd),o("div",{class:ve(["tool-group-content",{collapsed:i.value.has(T)}])},[(h(!0),y(he,null,ge(B,U=>(h(),y("div",{key:U.key,class:"tool-selection-item"},[o("div",Dd,[o("div",Nd,u(U.name),1),U.description?(h(),y("div",Ud,u(U.description),1)):V("",!0)]),o("div",Ld,[o("label",{class:"tool-enable-switch",onClick:x[3]||(x[3]=we(()=>{},["stop"]))},[o("input",{type:"checkbox",class:"tool-enable-checkbox",checked:f(U.key),onChange:H=>I(U.key,H)},null,40,Od),x[5]||(x[5]=o("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),y("div",Bd,[A(d(D),{icon:"carbon:tools",class:"empty-icon"}),o("p",null,u(S.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Hd=Ee(qd,[["__scopeId","data-v-627b463f"]]),Vd={class:"config-section"},jd={class:"section-header"},zd={class:"visual-editor"},Wd={class:"plan-basic-info"},Gd={class:"form-row"},Kd={class:"form-label"},Jd=["placeholder"],Xd={key:0,class:"field-error-message"},Yd={class:"form-row"},Qd={class:"form-label"},Zd={class:"service-group-autocomplete"},ep=["placeholder"],tp={key:0,class:"service-group-dropdown"},sp=["onMousedown"],op={class:"field-description"},np={class:"steps-section"},ap={class:"steps-container"},lp={class:"step-content"},rp={class:"form-row"},ip={class:"form-label"},cp=["value","onInput","placeholder"],up={class:"form-row"},dp={class:"form-label"},pp=["value","onInput","placeholder"],mp={key:0,class:"preview-section"},hp={class:"preview-label"},fp={class:"preview-content"},vp={class:"preview-text"},gp={class:"preview-table-header"},yp={class:"form-row"},bp={class:"form-label"},_p={class:"model-selector-wrapper"},wp={class:"model-input-wrapper"},$p=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Sp={key:0,class:"dropdown-item disabled"},Pp={key:1,class:"dropdown-item disabled error"},Tp={key:2,class:"dropdown-item disabled"},Ep=["onClick","onMouseenter"],kp=["onClick","onMouseenter"],Cp=["title"],Ip={key:0,class:"error-message"},Rp={class:"form-row"},xp={key:0,class:"empty-steps"},Ap={class:"empty-text"},Fp={key:0,class:"json-preview"},Mp={class:"preview-header"},Dp={class:"form-label"},Np={class:"json-code"},Up={class:"editor-footer"},Lp={class:"section-actions"},Op=["disabled","title"],Bp=["disabled","title"],qp=["disabled","title"],Hp=["disabled"],Vp={class:"modal-header"},jp={class:"modal-body"},zp={class:"form-row"},Wp={class:"form-label"},Gp=["placeholder"],Kp={class:"modal-footer"},Jp=["disabled"],Xp=Te({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=Bt(),a=We(),l=He({title:"",steps:[]}),r=F(!1),p=F(!1),b=F([]),i=F(!1),c=F(""),g=re(()=>a.generateJsonString()),E=F(!1);let v=null;const m=()=>{a.isUserUpdating.value=!0,v&&clearTimeout(v),v=setTimeout(()=>{a.isUserUpdating.value=!1,v=null},500)},w=()=>{if(a.isUserUpdating.value){console.log("[JsonEditorV2] syncDisplayDataFromConfig skipped: isUserUpdating is true");return}console.log("[JsonEditorV2] syncDisplayDataFromConfig called"),E.value=!0;try{const $=a.getConfig();console.log("[JsonEditorV2] Syncing displayData with config:",{title:$.title,stepsCount:$.steps?.length||0,serviceGroup:$.serviceGroup}),($.title?.trim()||!l.title?.trim())&&(l.title=$.title||""),l.steps=($.steps||[]).map(G=>({...G})),c.value=$.serviceGroup||"",console.log("[JsonEditorV2] displayData synced:",{title:l.title,stepsCount:l.steps.length,serviceGroup:c.value})}finally{setTimeout(()=>{E.value=!1},0)}},_=()=>{E.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(ue.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{E.value=!1},0)}},f=()=>{r.value=!r.value},I=()=>{r.value=!1},j=()=>{try{v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,a.rollbackVersion()}catch($){console.error("Error during rollback operation:",$),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},J=()=>{try{v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,a.restoreVersion()}catch($){console.error("Error during restore operation:",$),s.error(e("sidebar.restoreFailed")||"Restore failed")}},P=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,_();const $=a.validate();if(!$.isValid){s.error(`Invalid format, please correct and save.
Errors: `+$.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const ae=a.generateJsonString().trim();a.updateVersionsAfterSave(ae);const fe=a.planVersions.value.length;ue.hasTaskRequirementModified=!1,await ue.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:fe}))}catch($){console.error("Failed to save plan modifications:",$);const G=$ instanceof Error?$.message:e("sidebar.saveFailed");throw s.error(G),$}},C=F(""),L=($,G)=>{m();const X=l.steps[G];X&&(X.stepRequirement=$.target.value),Kt($)},O=($,G)=>{m();const X=l.steps[G];X&&(X.terminateColumns=$.target.value),Kt($)},W=()=>{const $={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push($),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},S=F([]),x=F(!1),T=F(""),B=F(new Map),U=F(new Set),H=F(new Map),ee=$=>B.value.get($)??"",Se=($,G)=>{B.value.set($,G)},K=$=>{const G=ee($);if(!G.trim())return S.value;const X=G.toLowerCase().trim();return S.value.filter(ae=>ae.value.toLowerCase().includes(X)||ae.label.toLowerCase().includes(X))},ie=$=>{const G=l.steps[$],X=ee($);return U.value.has($)&&X!==""?X:G.modelName??""},Ie=$=>x.value||T.value||l.steps[$].modelName?"":e("sidebar.modelNameDescription")||"",ce=$=>U.value.has($),M=$=>{x.value||U.value.add($)},q=$=>{U.value.delete($),H.value.set($,-1);const G=l.steps[$];Se($,G.modelName??"")},z=$=>{ce($)?q($):M($)},Y=($,G)=>{m();const X=l.steps[G];X.modelName=$,Se(G,$),q(G)},se=($,G)=>{m();const X=$.target;Se(G,X.value),M(G)},oe=$=>H.value.get($)??-1,pe=($,G)=>{H.value.set($,G)},N=$=>{const G=oe($),X=K($);G>=0&&G<X.length?Y(X[G].value,$):G===-1?Y("",$):X.length>0?Y(X[0].value,$):l.steps[$].modelName||Y("",$)},Q=$=>{if(!ce($)){M($),pe($,0);return}const X=K($).length+1,ae=oe($),fe=Math.min(ae+1,X-1);pe($,fe)},R=$=>{if(!ce($)){M($);const ae=K($);pe($,ae.length);return}const G=oe($),X=Math.max(G-1,-1);pe($,X)},Z=$=>{$.target.closest(".model-selector")||U.value.clear()};ye(()=>l.steps,$=>{$.forEach((G,X)=>{B.value.has(X)||Se(X,G.modelName??"")})},{deep:!0,immediate:!0});const te=F(!1),ne=F(-1),de=async()=>{if(!x.value){x.value=!0,T.value="";try{const $=await rd.getAvailableModels();S.value=$.options}catch($){console.error("Failed to load models:",$),T.value=$ instanceof Error?$.message:"Failed to load models",S.value=[]}finally{x.value=!1}}},_e=$=>{ne.value=$,te.value=!0},Qs=$=>{m(),ne.value>=0&&ne.value<l.steps.length&&(l.steps[ne.value].selectedToolKeys=[...$]),te.value=!1,ne.value=-1},Zs=($,G)=>{m(),$>=0&&$<l.steps.length&&(l.steps[$].selectedToolKeys=[...G])},ct=F(!1),Be=F(""),qe=F(!1),eo=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}Be.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),ct.value=!0},ut=()=>{ct.value=!1,Be.value="",qe.value=!1},to=$=>{$.target===$.currentTarget&&ut()},zt=async()=>{if(!Be.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}qe.value=!0;try{const $=a.getConfig(),G=`planTemplate-${Date.now()}`,{toolConfig:X,...ae}=$,fe={...ae,title:Be.value.trim(),planTemplateId:G};console.log("[JsonEditorV2] Copying plan without toolConfig:",fe),(await Xt.createOrUpdatePlanTemplateWithTool(fe)).success?(s.success(e("sidebar.copyPlanSuccess",{title:Be.value.trim()})),await ue.loadPlanTemplateList(),ut()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch($){if(console.error("[JsonEditorV2] Error copying plan:",$),$ instanceof Error&&$.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const G=$ instanceof Error?$.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:G}))}}finally{qe.value=!1}};ye(()=>l.title,$=>{$?.trim()?C.value="":C.value="Title is required field"},{immediate:!0});const Wt=()=>{const $=a.getServiceGroup()||"";c.value=$};ye(()=>a.config,()=>{a.needsFullRefresh.value&&!E.value&&!a.isUserUpdating.value&&w()},{deep:!0,immediate:!0}),ye(()=>a.currentPlanTemplateId.value,($,G)=>{console.log("[JsonEditorV2] currentPlanTemplateId changed:",{oldId:G,newId:$}),G!=null&&$!==G&&(B.value.clear(),U.value.clear(),H.value.clear(),te.value=!1,ct.value=!1,r.value=!1,ne.value=-1,Be.value="",qe.value=!1),console.log("[JsonEditorV2] Calling syncDisplayDataFromConfig from currentPlanTemplateId watch"),w(),Wt()},{immediate:!0}),ye(()=>c.value,$=>{E.value=!0;try{a.setServiceGroup($)}finally{setTimeout(()=>{E.value=!1},0)}});const so=async()=>{if(!i.value){i.value=!0;try{const $=new Set;try{(await Ts.getAvailableTools()).forEach(X=>{X.serviceGroup&&$.add(X.serviceGroup)})}catch(G){console.error("[JsonEditorV2] Failed to load service groups from tools:",G)}try{(await Xt.getAllPlanTemplateConfigVOs()).forEach(X=>{X.serviceGroup&&$.add(X.serviceGroup)})}catch(G){console.error("[JsonEditorV2] Failed to load service groups from plan templates:",G)}b.value=Array.from($).sort()}catch($){console.error("[JsonEditorV2] Failed to load service groups:",$),b.value=[]}finally{i.value=!1}}},Gt=re(()=>{const $=c.value.trim();if(!$)return b.value;const G=$.toLowerCase();return b.value.filter(X=>X.toLowerCase().includes(G))}),oo=()=>{m()},no=()=>{p.value=!0},ao=()=>{m(),no()},lo=()=>{setTimeout(()=>{p.value=!1},200)},ro=$=>{c.value=$,p.value=!1};Me(()=>{w(),Wt(),so(),de(),document.addEventListener("click",Z)}),Ue(()=>{document.removeEventListener("click",Z),v&&(clearTimeout(v),v=null)}),t({save:P});const Kt=$=>{const G=$.target;G.style.height="auto";const X=20,ae=Math.ceil(G.scrollHeight/X),fe=4,Ge=12,dt=Math.max(fe,Math.min(Ge,ae)),co=dt*X;G.style.height=`${co}px`,G.rows=dt,ae>Ge?G.style.overflowY="auto":G.style.overflowY="hidden"},io=$=>{if(!$.trim())return"";const G=$.split(",").map(X=>X.trim()).filter(X=>X.length>0);return G.length===0?"":`|${G.join("|")}|`};return($,G)=>(h(),y("div",Vd,[o("div",jd,[A(d(D),{icon:"carbon:code",width:"16"}),o("span",null,u($.$t("sidebar.dynamicAgentPlan")),1)]),o("div",zd,[o("div",Wd,[o("div",Gd,[o("label",Kd,u($.$t("sidebar.title")),1),be(o("input",{"onUpdate:modelValue":G[0]||(G[0]=X=>l.title=X),type:"text",class:ve(["form-input",{error:C.value}]),placeholder:$.$t("sidebar.titlePlaceholder"),onInput:oo},null,42,Jd),[[ke,l.title]]),C.value?(h(),y("div",Xd,[A(d(D),{icon:"carbon:warning",width:"12"}),me(" "+u(C.value),1)])):V("",!0)]),o("div",Yd,[o("label",Qd,u($.$t("mcpService.serviceGroup")),1),o("div",Zd,[be(o("input",{type:"text","onUpdate:modelValue":G[1]||(G[1]=X=>c.value=X),onInput:ao,onFocus:G[2]||(G[2]=X=>p.value=!0),onBlur:lo,placeholder:$.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,ep),[[ke,c.value]]),p.value&&Gt.value.length>0?(h(),y("div",tp,[(h(!0),y(he,null,ge(Gt.value,X=>(h(),y("div",{key:X,class:"service-group-option",onMousedown:ae=>ro(X)},u(X),41,sp))),128))])):V("",!0)]),o("div",op,u($.$t("mcpService.serviceGroupDescription")),1)])]),o("div",np,[o("div",ap,[(h(!0),y(he,null,ge(l.steps,(X,ae)=>(h(),y("div",{key:ae,class:"step-item"},[o("div",lp,[o("div",rp,[o("label",ip,u($.$t("sidebar.stepRequirement")),1),o("textarea",{value:X.stepRequirement||"",onInput:fe=>L(fe,ae),class:"form-textarea auto-resize",placeholder:$.$t("sidebar.stepRequirementPlaceholder"),rows:"8"},null,40,cp)]),o("div",up,[o("label",dp,u($.$t("sidebar.terminateColumns")),1),o("textarea",{value:X.terminateColumns||"",onInput:fe=>O(fe,ae),class:"form-textarea auto-resize",placeholder:$.$t("sidebar.terminateColumnsPlaceholder"),rows:"1"},null,40,pp),X.terminateColumns&&X.terminateColumns.trim()?(h(),y("div",mp,[o("div",hp,u($.$t("sidebar.preview"))+":",1),o("div",fp,[o("div",vp,[me(u($.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),o("span",gp,u(io(X.terminateColumns)),1)])])])):V("",!0)]),o("div",yp,[o("label",bp,u($.$t("sidebar.modelName")),1),o("div",_p,[o("div",{class:ve(["model-selector",{"is-open":ce(ae),"is-disabled":x.value}])},[o("div",wp,[o("input",{value:ie(ae),type:"text",class:"form-input model-search-input",placeholder:Ie(ae),disabled:x.value,onClick:we(fe=>M(ae),["stop"]),onFocus:fe=>M(ae),onInput:fe=>se(fe,ae),onKeydown:[st(fe=>q(ae),["escape"]),st(we(fe=>N(ae),["prevent"]),["enter"]),st(we(fe=>Q(ae),["prevent"]),["down"]),st(we(fe=>R(ae),["prevent"]),["up"])]},null,40,$p),A(d(D),{icon:"carbon:chevron-down",width:"14",class:ve(["dropdown-arrow",{"is-open":ce(ae)}]),onClick:we(fe=>z(ae),["stop"])},null,8,["class","onClick"])]),ce(ae)?(h(),y("div",{key:0,class:"model-dropdown",onClick:G[3]||(G[3]=we(()=>{},["stop"]))},[x.value?(h(),y("div",Sp,u($.$t("sidebar.loading")),1)):T.value?(h(),y("div",Pp,u($.$t("sidebar.modelLoadError")),1)):K(ae).length===0?(h(),y("div",Tp,u($.$t("sidebar.noModelsFound")),1)):V("",!0),(h(!0),y(he,null,ge(K(ae),(fe,Ge)=>(h(),y("div",{key:fe.value,class:ve(["dropdown-item",{"is-selected":X.modelName===fe.value,"is-highlighted":oe(ae)===Ge}]),onClick:dt=>Y(fe.value,ae),onMouseenter:dt=>pe(ae,Ge)},[me(u(fe.value)+" ",1),X.modelName===fe.value?(h(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,Ep))),128)),o("div",{class:ve(["dropdown-item",{"is-selected":!X.modelName,"is-highlighted":oe(ae)===-1}]),onClick:fe=>Y("",ae),onMouseenter:fe=>pe(ae,-1)},[me(u($.$t("sidebar.noModelSelected"))+" ",1),X.modelName?V("",!0):(h(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,kp)])):V("",!0)],2),T.value?(h(),y("button",{key:0,onClick:de,class:"btn btn-sm btn-danger",title:$.$t("sidebar.retryLoadModels")},[A(d(D),{icon:"carbon:warning",width:"14"}),me(" "+u($.$t("sidebar.retry")),1)],8,Cp)):V("",!0)]),T.value?(h(),y("div",Ip,[A(d(D),{icon:"carbon:warning",width:"12"}),me(" "+u(T.value),1)])):V("",!0)]),o("div",Rp,[A(vd,{title:$.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys||[],"add-button-text":$.$t("sidebar.addRemoveTools"),"empty-text":$.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:fe=>_e(ae),onToolsFiltered:fe=>Zs(ae,fe)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),y("div",xp,[A(d(D),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),o("p",Ap,u($.$t("sidebar.noSteps")),1),o("button",{class:"btn btn-primary btn-add-step",onClick:W},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u($.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),r.value?(h(),y("div",Fp,[o("div",Mp,[o("label",Dp,u($.$t("sidebar.jsonPreview")),1),o("button",{onClick:I,class:"btn btn-xs"},[A(d(D),{icon:"carbon:close",width:"12"})])]),o("pre",Np,u(g.value),1)])):V("",!0),o("div",Up,[o("button",{onClick:f,class:"btn btn-sm btn-secondary"},[A(d(D),{icon:"carbon:code",width:"14"}),me(" "+u(r.value?$.$t("sidebar.hideJson"):$.$t("sidebar.showJson")),1)]),o("div",Lp,[o("button",{class:"btn btn-sm",onClick:eo,disabled:$.isGenerating||$.isExecuting,title:$.$t("sidebar.copyPlan")},[A(d(D),{icon:"carbon:copy",width:"14"}),me(" "+u($.$t("sidebar.copyPlan")),1)],8,Op),o("button",{class:"btn btn-sm",onClick:j,disabled:!d(a).canRollback.value,title:$.$t("sidebar.rollback")},[A(d(D),{icon:"carbon:undo",width:"14"})],8,Bp),o("button",{class:"btn btn-sm",onClick:J,disabled:!d(a).canRestore.value,title:$.$t("sidebar.restore")},[A(d(D),{icon:"carbon:redo",width:"14"})],8,qp),o("button",{class:"btn btn-primary",onClick:P,disabled:$.isGenerating||$.isExecuting},[A(d(D),{icon:"carbon:save",width:"14"}),G[7]||(G[7]=me(" Save "))],8,Hp)])])]),A(Hd,{modelValue:te.value,"onUpdate:modelValue":G[4]||(G[4]=X=>te.value=X),"selected-tool-ids":ne.value>=0?l.steps[ne.value]?.selectedToolKeys||[]:[],onConfirm:Qs},null,8,["modelValue","selected-tool-ids"]),ct.value?(h(),y("div",{key:0,class:"modal-overlay",onMousedown:to},[o("div",{class:"modal-content",onMousedown:G[6]||(G[6]=we(()=>{},["stop"]))},[o("div",Vp,[o("h3",null,u($.$t("sidebar.copyPlan")),1),o("button",{class:"close-btn",onClick:ut},[A(d(D),{icon:"carbon:close",width:"16"})])]),o("div",jp,[o("div",zp,[o("label",Wp,u($.$t("sidebar.newPlanTitle")),1),be(o("input",{"onUpdate:modelValue":G[5]||(G[5]=X=>Be.value=X),type:"text",class:"form-input",placeholder:$.$t("sidebar.enterNewPlanTitle"),onKeyup:st(zt,["enter"])},null,40,Gp),[[ke,Be.value]])])]),o("div",Kp,[o("button",{class:"btn btn-secondary",onClick:ut},u($.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:zt,disabled:!Be.value.trim()||qe.value},[qe.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),me(" "+u(qe.value?$.$t("sidebar.copying"):$.$t("sidebar.copyPlan")),1)],8,Jp)])],32)],32)):V("",!0)]))}}),Yp=Ee(Xp,[["__scopeId","data-v-91127bd0"]]),Qp="/api/executor";async function Xs(n){try{const t=await fetch(`${Qp}/agent-execution/${n}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,t),null}}async function Zp(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Xs(n)}function em(){const n=Ze(),t=Qe(),e=F(null),s=F(null),a=F("config"),l=re(()=>n.activeRootPlanId.value),r=f=>{if(!f)return null;for(const[I,j]of t.planExecutionRecords.entries())if((j.rootPlanId||j.currentPlanId)&&j.agentExecutionSequence)for(const P of j.agentExecutionSequence){if(P.stepId===f){const C=j.rootPlanId||j.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:f,rootPlanId:C,planId:I}),C||null}if(P.subPlanExecutionRecords)for(const C of P.subPlanExecutionRecords){const L=p(C,f);if(L)return L}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",f),null},p=(f,I)=>{if(!f||!f.agentExecutionSequence)return null;for(const j of f.agentExecutionSequence){if(j.stepId===I)return f.rootPlanId||f.currentPlanId||null;if(j.subPlanExecutionRecords)for(const J of j.subPlanExecutionRecords){const P=p(J,I);if(P)return P}}return null},b=re(()=>s.value||l.value),i=re(()=>!b.value),c=async f=>{if(console.log("[useRightPanel] Step selected:",{stepId:f}),!f){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}E("details"),console.log("[useRightPanel] Switched to details tab");try{const I=r(f);I?(s.value=I,console.log("[useRightPanel] Set selectedRootPlanId to:",I)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const j=await Xs(f);if(!j){console.warn("[useRightPanel] Agent execution detail not found for stepId:",f),e.value=null,s.value=null;return}const J={stepId:f,title:j.agentName??`Step ${f}`,description:j.agentDescription??"",agentExecution:j,completed:j.status==="FINISHED",current:j.status==="RUNNING"};e.value=J,console.log("[useRightPanel] Step details updated:",J),await xe(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(I){console.error("[useRightPanel] Error fetching step details:",I),e.value=null,s.value=null}},g=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const f=await Zp(e.value.stepId);f&&(e.value.agentExecution=f,e.value.completed=f.status==="FINISHED",e.value.current=f.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(f){console.error("[useRightPanel] Error refreshing step:",f)}},E=f=>{a.value=f,console.log("[useRightPanel] Active tab set to:",f)},v=f=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",f)},m=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},w=f=>{if(f===null||typeof f>"u"||f==="")return"N/A";if(typeof f=="object"&&f!==null)try{return JSON.stringify(f,null,2)}catch{return String(f)}if(typeof f=="string"){const I=f.trim();if(I==="")return"N/A";try{const j=JSON.parse(I);return JSON.stringify(j,null,2)}catch{return I}}return String(f)},_=()=>{e.value=null,s.value=null,a.value="config",console.log("[useRightPanel] State reset")};return{selectedStep:Ne(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:b,shouldShowNoTaskMessage:i,handleStepSelected:c,refreshCurrentStep:g,setActiveTab:E,updateDisplayedPlanProgress:v,clearSelectedStep:m,formatJson:w,reset:_}}let Rt=null;function Ys(){return Rt||(Rt=em()),Rt}const tm={class:"right-panel"},sm={class:"preview-header"},om={class:"preview-tabs"},nm={class:"preview-content"},am={key:0,class:"config-tab-content"},lm={key:0,class:"config-container"},rm={class:"template-info-header"},im={class:"template-info"},cm={class:"template-id"},um={key:1,class:"no-template-selected"},dm={class:"action-buttons"},pm=["title"],mm={class:"import-description"},hm={href:"https://github.com/Lynxe-public/Lynxe-public-prompts",target:"_blank",rel:"noopener noreferrer",class:"prompt-library-link"},fm={key:1,class:"step-details"},vm={key:0,class:"step-info"},gm={key:0,class:"agent-info"},ym={class:"info-item"},bm={class:"label"},_m=["title"],wm={class:"info-item"},$m={class:"label"},Sm={class:"value"},Pm={class:"execution-status"},Tm={class:"status-item"},Em={class:"status-text"},km={key:0},Cm={key:0,class:"think-act-steps"},Im={class:"steps-container"},Rm={class:"step-header"},xm={class:"step-number"},Am={class:"think-section"},Fm={class:"think-content"},Mm={class:"input"},Dm={class:"label"},Nm={class:"output"},Um={class:"label"},Lm={key:0,class:"action-section"},Om={class:"action-content"},Bm={class:"tool-info"},qm={class:"label"},Hm={class:"value"},Vm={class:"input"},jm={class:"label"},zm={class:"output"},Wm={class:"label"},Gm={key:0,class:"no-tools"},Km={key:0,class:"sub-plan-section"},Jm={class:"sub-plan-content"},Xm={class:"sub-plan-header"},Ym={class:"sub-plan-info"},Qm={class:"label"},Zm={class:"value"},eh={key:0,class:"sub-plan-info"},th={class:"label"},sh={class:"value"},oh={class:"sub-plan-status"},nh={class:"status-text"},ah={key:0,class:"no-steps-message"},lh={key:1,class:"no-execution-message"},rh={class:"step-basic-info"},ih={class:"info-item"},ch={class:"label"},uh={class:"value"},dh={key:0,class:"info-item"},ph={class:"label"},mh={class:"value"},hh={class:"info-item"},fh={class:"label"},vh={class:"no-execution-hint"},gh={key:2,class:"execution-indicator"},yh={class:"execution-text"},bh={key:1,class:"no-selection"},_h=["title"],wh={key:2,class:"file-browser-container"},$h={key:1,class:"no-plan-message"},Sh={class:"message-content"},Ph={class:"tips"},Th=Te({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:t}){const e=n,{t:s}=De(),a=Bt(),l=Ys(),r=We(),p=nt(),{handleImport:b}=bo(),i=F(),c=F(!1),g=F(!0),E=F(!0),v=re(()=>l.selectedStep.value),m=re({get:()=>l.activeTab.value,set:U=>l.setActiveTab(U)}),w=re(()=>l.fileBrowserPlanId.value),_=re(()=>l.shouldShowNoTaskMessage.value),f=re(()=>v.value?v.value.completed?s("rightPanel.status.completed"):v.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),I=async()=>{try{const U=r.getPlanType()||"dynamic_agent";await ue.createNewTemplate(U);const H=r.selectedTemplate.value;H&&(r.reset(),r.setPlanType(H.planType||"dynamic_agent"),H.planTemplateId&&r.setPlanTemplateId(H.planTemplateId),r.setTitle(H.title||"")),console.log("[RightPanel] ðŸ”„ Reloading available tools for new template"),await p.loadAvailableTools()}catch(U){console.error("[RightPanel] Failed to create new plan:",U);const H=U instanceof Error?U.message:s("rightPanel.createPlanFailed");a.error(H)}},j=async U=>{await b(U,{onSuccess:async H=>{const ee=s("rightPanel.importSuccess",{total:H.total,success:H.successCount,failed:H.failureCount});a.success(ee)},onError:H=>{const ee=H instanceof Error?H.message:s("rightPanel.importFailed");a.error(ee)},onReload:async()=>{await ue.loadPlanTemplateList()},onSingleTemplateImported:async H=>{H.planTemplateId&&(r.setPlanTemplateId(H.planTemplateId),await r.load(H.planTemplateId))}})},J=async U=>{await l.handleStepSelected(U),setTimeout(()=>{L()},100),W()},P=async()=>{await l.refreshCurrentStep(),W()};ye(()=>e.selectedStepId,async U=>{U?await J(U):l.clearSelectedStep()},{immediate:!0});const C=U=>{i.value=U??void 0},L=()=>{if(!i.value)return;const{scrollTop:U,scrollHeight:H,clientHeight:ee}=i.value,Se=H-U-ee<50,K=H>ee;g.value=Se,c.value=K&&!Se,Se?E.value=!0:H-U-ee>100&&(E.value=!1)},O=()=>{i.value&&(i.value.scrollTo({top:i.value.scrollHeight,behavior:"smooth"}),xe(()=>{E.value=!0,L()}))},W=()=>{!E.value||!i.value||xe(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},S=l.formatJson,x=()=>{E.value=!0,i.value&&i.value.removeEventListener("scroll",L)},T=()=>{const U=()=>{const H=i.value;return H?(C(H),H.addEventListener("scroll",L),E.value=!0,L(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};xe(()=>{U()||setTimeout(()=>{U()},100)})};return Me(()=>{console.log("[RightPanel] Component mounted"),xe(()=>{T()})}),Ue(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),x()}),t({handleStepSelected:J,refreshCurrentStep:P,updateDisplayedPlanProgress:U=>{l.updateDisplayedPlanProgress(U)}}),(U,H)=>(h(),y("div",tm,[o("div",sm,[o("div",om,[o("div",{class:ve(["tab-item",{active:m.value==="config"}]),onClick:H[0]||(H[0]=ee=>m.value="config")},[A(d(D),{icon:"carbon:settings"}),o("span",null,u(d(s)("sidebar.configuration")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="details"}]),onClick:H[1]||(H[1]=ee=>m.value="details")},[A(d(D),{icon:"carbon:events"}),o("span",null,u(d(s)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="files"}]),onClick:H[2]||(H[2]=ee=>m.value="files")},[A(d(D),{icon:"carbon:folder"}),o("span",null,u(d(s)("fileBrowser.title")),1)],2)])]),o("div",nm,[m.value==="config"?(h(),y("div",am,[d(r).selectedTemplate.value?(h(),y("div",lm,[o("div",rm,[o("div",im,[o("h3",null,u(d(r).selectedTemplate.value.title||d(s)("sidebar.unnamedPlan")),1),o("span",cm,"ID: "+u(d(r).selectedTemplate.value.planTemplateId),1)]),o("button",{class:"back-to-list-btn",onClick:H[3]||(H[3]=ee=>d(bs).switchToTab("list"))},[A(d(D),{icon:"carbon:arrow-left",width:"16"})])]),A(Yp),A(xc)])):(h(),y("div",um,[o("div",dm,[o("button",{class:"new-task-btn",onClick:I},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u(d(s)("rightPanel.newFuncAgentPlan")),1)]),o("label",{class:"new-task-btn",title:d(s)("rightPanel.importExistingPlan")},[A(d(D),{icon:"carbon:import",width:"16"}),me(" "+u(d(s)("rightPanel.importExistingPlan"))+" ",1),o("input",{type:"file",accept:".json",onChange:j,style:{display:"none"}},null,32)],8,pm)]),o("p",mm,[me(u(d(s)("rightPanel.importDescription"))+" ",1),o("a",hm,u(d(s)("rightPanel.promptLibrary")),1),me(" "+u(d(s)("rightPanel.importDescriptionSuffix")),1)])]))])):V("",!0),m.value==="details"?(h(),y("div",fm,[v.value?(h(),y("div",vm,[o("h3",null,u(v.value.title||v.value.description||d(s)("rightPanel.defaultStepTitle",{number:1})),1),v.value.agentExecution?(h(),y("div",gm,[o("div",ym,[o("span",bm,u(d(s)("rightPanel.executingAgent"))+":",1),o("span",{class:"value",title:v.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.clickToViewExecutionDetails"):""},u(v.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.funcAgentExecutionDetails"):v.value.agentExecution.agentName),9,_m)]),o("div",wm,[o("span",$m,u(d(s)("rightPanel.callingModel"))+":",1),o("span",Sm,u(v.value.agentExecution.modelName),1)])])):V("",!0),o("div",Pm,[o("div",Tm,[v.value.completed?(h(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):v.value.current?(h(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),$e(d(D),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",Em,u(f.value),1)])])])):V("",!0),o("div",{ref_key:"scrollContainer",ref:i,class:"step-details-scroll-container",onScroll:L},[v.value?(h(),y("div",km,[v.value.agentExecution?.thinkActSteps&&v.value.agentExecution.thinkActSteps.length>0?(h(),y("div",Cm,[o("h4",null,u(d(s)("rightPanel.thinkAndActionSteps")),1),o("div",Im,[(h(!0),y(he,null,ge(v.value.agentExecution.thinkActSteps,(ee,Se)=>(h(),y("div",{key:Se,class:"think-act-step"},[o("div",Rm,[o("span",xm,"#"+u(Se+1),1),o("span",{class:ve(["step-status",ee.status])},u(ee.status||d(s)("rightPanel.executing")),3)]),o("div",Am,[o("h5",null,[A(d(D),{icon:"carbon:thinking"}),me(" "+u(d(s)("rightPanel.thinking")),1)]),o("div",Fm,[o("div",Mm,[o("span",Dm,u(d(s)("rightPanel.input"))+":",1),o("pre",null,u(d(S)(ee.thinkInput)),1)]),o("div",Nm,[o("span",Um,u(d(s)("rightPanel.output"))+":",1),o("pre",null,u(d(S)(ee.thinkOutput)),1)])])]),ee.actionNeeded?(h(),y("div",Lm,[o("h5",null,[A(d(D),{icon:"carbon:play"}),me(" "+u(d(s)("rightPanel.action")),1)]),o("div",Om,[(h(!0),y(he,null,ge(ee.actToolInfoList||[],(K,ie)=>(h(),y("div",{key:`tool-${ie}-${K?.id||K?.name||ie}`,class:"tool-execution-item"},[o("div",Bm,[o("span",qm,u(d(s)("rightPanel.tool"))+":",1),o("span",Hm,u(K?.name||"N/A"),1)]),o("div",Vm,[o("span",jm,u(d(s)("rightPanel.toolParameters"))+":",1),o("pre",null,u(d(S)(K?.parameters)),1)]),o("div",zm,[o("span",Wm,u(d(s)("rightPanel.executionResult"))+":",1),o("pre",null,u(d(S)(K?.result)),1)])]))),128)),!ee.actToolInfoList||ee.actToolInfoList.length===0?(h(),y("div",Gm,[o("p",null,u(d(s)("rightPanel.noToolsExecuted")),1)])):V("",!0)]),ee.subPlanExecutionRecord?(h(),y("div",Km,[o("h5",null,[A(d(D),{icon:"carbon:tree-view"}),me(" "+u(d(s)("rightPanel.subPlan")),1)]),o("div",Jm,[o("div",Xm,[o("div",Ym,[o("span",Qm,u(U.$t("rightPanel.subPlanId"))+":",1),o("span",Zm,u(ee.subPlanExecutionRecord.currentPlanId),1)]),ee.subPlanExecutionRecord.title?(h(),y("div",eh,[o("span",th,u(U.$t("rightPanel.title"))+":",1),o("span",sh,u(ee.subPlanExecutionRecord.title),1)])):V("",!0),o("div",oh,[ee.subPlanExecutionRecord.completed?(h(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",nh,u(ee.subPlanExecutionRecord.completed?U.$t("rightPanel.status.completed"):U.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),v.value.agentExecution&&!v.value.agentExecution.thinkActSteps?.length?(h(),y("div",ah,[o("p",null,u(d(s)("rightPanel.noStepDetails")),1)])):v.value.agentExecution?V("",!0):(h(),y("div",lh,[A(d(D),{icon:"carbon:information",class:"info-icon"}),o("h4",null,u(d(s)("rightPanel.stepInfo")),1),o("div",rh,[o("div",ih,[o("span",ch,u(d(s)("rightPanel.stepName"))+":",1),o("span",uh,u(v.value.title||v.value.description||v.value.stepId),1)]),v.value.description?(h(),y("div",dh,[o("span",ph,u(U.$t("rightPanel.description"))+":",1),o("span",mh,u(v.value.description),1)])):V("",!0),o("div",hh,[o("span",fh,u(U.$t("rightPanel.status.label"))+":",1),o("span",{class:ve(["value",{"status-completed":v.value.completed,"status-current":v.value.current,"status-pending":!v.value.completed&&!v.value.current}])},u(v.value.completed?U.$t("rightPanel.status.completed"):v.value.current?U.$t("rightPanel.status.executing"):U.$t("rightPanel.status.pending")),3)])]),o("p",vh,u(d(s)("rightPanel.noExecutionInfo")),1)])),v.value.current&&!v.value.completed?(h(),y("div",gh,[H[4]||(H[4]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",yh,[A(d(D),{icon:"carbon:in-progress",class:"rotating-icon"}),me(" "+u(d(s)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(h(),y("div",bh,[A(d(D),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,u(d(s)("rightPanel.noStepSelected")),1),o("p",null,u(d(s)("rightPanel.selectStepHint")),1)]))])):V("",!0),A(Ot,{name:"scroll-button"},{default:Xe(()=>[c.value?(h(),y("button",{key:0,onClick:O,class:"scroll-to-bottom-btn",title:d(s)("rightPanel.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,_h)):V("",!0)]),_:1})],544)])):V("",!0),m.value==="files"?(h(),y("div",wh,[w.value?(h(),$e(ei,{key:0,"plan-id":w.value},null,8,["plan-id"])):_.value?(h(),y("div",$h,[A(d(D),{icon:"carbon:folder-off"}),o("div",Sh,[o("h3",null,u(d(s)("fileBrowser.noFilesYet")),1),o("p",null,u(d(s)("fileBrowser.noPlanExecuting")),1),o("div",Ph,[A(d(D),{icon:"carbon:information"}),o("span",null,u(d(s)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])]))}}),Eh=Ee(Th,[["__scopeId","data-v-afdd35f3"]]),kh={class:"template-list-container"},Ch={class:"organization-section"},Ih={class:"organization-row"},Rh={class:"organization-selector"},xh={class:"organization-label"},Ah=["value"],Fh={value:"by_time"},Mh={value:"by_abc"},Dh={value:"by_group_time"},Nh={value:"by_group_abc"},Uh={class:"search-input-wrapper"},Lh={class:"search-label"},Oh={class:"search-input-container"},Bh=["placeholder"],qh=["title"],Hh={class:"sidebar-content-list"},Vh={key:0,class:"loading-state"},jh={key:1,class:"error-state"},zh={key:2,class:"empty-state"},Wh=["onClick","title"],Gh=["onClick","title"],Kh={class:"group-name"},Jh={class:"group-count"},Xh=["onClick"],Yh={class:"task-icon"},Qh={class:"task-details"},Zh={class:"task-title"},ef={class:"task-time"},tf={class:"task-actions"},sf=["title","onClick"],of=Te({__name:"TemplateList",emits:["templateSelected"],setup(n,{emit:t}){const{t:e}=De(),s=We(),a=Ys(),l=F(""),r=t,p=v=>{const m=v.target;ue.setOrganizationMethod(m.value)},b=v=>{if(isNaN(v.getTime()))return console.warn("Invalid date received:",v),e("time.unknown");const w=new Date().getTime()-v.getTime(),_=Math.floor(w/6e4),f=Math.floor(w/36e5),I=Math.floor(w/864e5);return _<1?e("time.now"):_<60?e("time.minuteAgo",{count:_}):f<24?e("time.hourAgo",{count:f}):I<30?e("time.dayAgo",{count:I}):v.toLocaleDateString("zh-CN")},i=re(()=>{s.planTemplateList.value;const v=l.value.trim().toLowerCase(),m=ue.groupedTemplates;if(!v)return m;const w=new Map;for(const[_,f]of m){const I=[];for(const j of f)(j.title||"").toLowerCase().includes(v)&&I.push(j);I.length>0&&w.set(_,I)}return w});ye(l,v=>{s.planTemplateList.value;const m=v.trim().toLowerCase();if(!m||ue.organizationMethod!=="by_group_time"&&ue.organizationMethod!=="by_group_abc")return;const w=ue.groupedTemplates;for(const[_,f]of w){let I=!1;for(const j of f)if((j.title||"").toLowerCase().includes(m)){I=!0;break}I&&ue.isGroupCollapsed(_)&&ue.toggleGroupCollapse(_)}});const c=v=>{const m=v??"null";return ue.groupCollapseState[m]??!1},g=v=>{ue.toggleGroupCollapse(v)},E=async v=>{a.setActiveTab("config"),await ue.selectTemplate(v),v.planTemplateId?(await s.load(v.planTemplateId),ue.hasTaskRequirementModified=!1):(s.reset(),ue.hasTaskRequirementModified=!1),r("templateSelected",v)};return(v,m)=>(h(),y("div",kh,[o("div",Ch,[o("div",Ih,[o("div",Rh,[o("label",xh,u(v.$t("sidebar.organizationLabel")),1),o("select",{value:d(ue).organizationMethod,onChange:p,class:"organization-select"},[o("option",Fh,u(v.$t("sidebar.organizationByTime")),1),o("option",Mh,u(v.$t("sidebar.organizationByAbc")),1),o("option",Dh,u(v.$t("sidebar.organizationByGroupTime")),1),o("option",Nh,u(v.$t("sidebar.organizationByGroupAbc")),1)],40,Ah)]),o("div",Uh,[o("label",Lh,u(v.$t("sidebar.searchLabel")),1),o("div",Oh,[A(d(D),{icon:"carbon:search",width:"16",class:"search-icon"}),be(o("input",{"onUpdate:modelValue":m[0]||(m[0]=w=>l.value=w),type:"text",class:"search-input",placeholder:v.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Bh),[[ke,l.value]]),l.value?(h(),y("button",{key:0,class:"search-clear-btn",onClick:m[1]||(m[1]=w=>l.value=""),title:v.$t("sidebar.clearSearch")||"Clear search"},[A(d(D),{icon:"carbon:close",width:"14"})],8,qh)):V("",!0)])])])]),o("div",Hh,[d(ue).isLoading?(h(),y("div",Vh,[A(d(D),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,u(v.$t("sidebar.loading")),1)])):d(ue).errorMessage?(h(),y("div",jh,[A(d(D),{icon:"carbon:warning",width:"20"}),o("span",null,u(d(ue).errorMessage),1),o("button",{onClick:m[2]||(m[2]=(...w)=>d(ue).loadPlanTemplateList&&d(ue).loadPlanTemplateList(...w)),class:"retry-btn"},u(v.$t("sidebar.retry")),1)])):d(s).planTemplateList.value.length===0?(h(),y("div",zh,[A(d(D),{icon:"carbon:document",width:"32"}),o("span",null,u(v.$t("sidebar.noTemplates")),1)])):(h(!0),y(he,{key:3},ge(i.value,([w,_])=>(h(),y(he,{key:w||"ungrouped"},[(d(ue).organizationMethod==="by_group_time"||d(ue).organizationMethod==="by_group_abc")&&_.length>0?(h(),y("div",{key:0,class:"group-header",onClick:we(f=>g(w),["prevent"]),title:c(w)?v.$t("sidebar.expandGroup"):v.$t("sidebar.collapseGroup")},[o("button",{type:"button",class:"group-toggle-btn",onClick:we(f=>g(w),["stop","prevent"]),title:c(w)?v.$t("sidebar.expandGroup"):v.$t("sidebar.collapseGroup")},[A(d(D),{icon:c(w)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Gh),A(d(D),{icon:"carbon:folder",width:"16"}),o("span",Kh,u(w===null||w===""?v.$t("sidebar.ungroupedMethods"):w),1),o("span",Jh,"("+u(_.length)+")",1)],8,Wh)):V("",!0),(d(ue).organizationMethod==="by_group_time"||d(ue).organizationMethod==="by_group_abc")&&c(w)?V("",!0):(h(!0),y(he,{key:1},ge(_,f=>(h(),y("div",{key:f.planTemplateId||"unknown",class:ve(["sidebar-content-list-item",{"sidebar-content-list-item-active":f.planTemplateId===d(s).currentPlanTemplateId.value,"grouped-item":d(ue).organizationMethod==="by_group_time"||d(ue).organizationMethod==="by_group_abc"}]),onClick:I=>E(f)},[o("div",Yh,[A(d(D),{icon:"carbon:document",width:"20"})]),o("div",Qh,[o("div",Zh,u(f.title||v.$t("sidebar.unnamedPlan")),1)]),o("div",ef,u(b(d(s).parseDateTime(f.updateTime||f.createTime))),1),o("div",tf,[o("button",{class:"delete-task-btn",title:v.$t("sidebar.deleteTemplate"),onClick:we(I=>d(ue).deleteTemplate(f),["stop"])},[A(d(D),{icon:"carbon:close",width:"16"})],8,sf)])],10,Xh))),128))],64))),128))])]))}}),nf=Ee(of,[["__scopeId","data-v-ef0e1961"]]),af={class:"sidebar-content"},lf={class:"sidebar-content-header"},rf={class:"sidebar-content-title"},cf={class:"tab-content"},uf=Te({name:"SidebarPanel",__name:"Sidebar",props:{width:{}},setup(n,{expose:t}){const e=n,s=nt(),a=We(),l=async()=>{const r=a.getPlanType()||"dynamic_agent";await ue.createNewTemplate(r);const p=a.selectedTemplate.value;p&&(a.reset(),a.setPlanType(p.planType||"dynamic_agent"),p.planTemplateId&&a.setPlanTemplateId(p.planTemplateId),a.setTitle(p.title||"")),console.log("[Sidebar] ðŸ”„ Reloading available tools for new template"),await s.loadAvailableTools()};return Me(async()=>{await ue.loadPlanTemplateList(),s.loadAvailableTools()}),t({loadPlanTemplateList:ue.loadPlanTemplateList,toggleSidebar:bs.toggleSidebar}),(r,p)=>(h(),y("div",{class:"sidebar-wrapper",style:Je({width:e.width+"%"})},[o("div",af,[o("div",lf,[o("div",rf,u(r.$t("sidebar.title")),1),o("button",{class:"new-task-btn",onClick:l},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u(r.$t("sidebar.newPlan")),1)])]),o("div",cf,[A(nf)])])],4))}}),df=Ee(uf,[["__scopeId","data-v-0c9e30ac"]]);function pf(){const n=Ze(),t=Qe(),{showToast:e}=ws(),{t:s}=De(),a=i=>{const c={currentPlanId:i.currentPlanId,status:i.completed?"completed":"running"};return i.rootPlanId&&(c.rootPlanId=i.rootPlanId),i.summary&&(c.summary=i.summary),i.completed!==void 0&&(c.completed=i.completed),i.agentExecutionSequence&&(c.agentExecutionSequence=i.agentExecutionSequence),c},l=i=>{if(!i)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(i)){const[c,g,E,v=0,m=0,w=0,_=0]=i,f=new Date(c,g-1,E,v,m,w,Math.floor(_/1e6));return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",i),new Date):f}if(typeof i=="string"){let c=new Date(i);if(!isNaN(c.getTime()))return c;const g=i.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(g){const[,E,v,m,w,_,f,I]=g;if(c=new Date(parseInt(E),parseInt(v)-1,parseInt(m),parseInt(w),parseInt(_),parseInt(f),I?parseInt(I.substring(0,3)):0),!isNaN(c.getTime()))return c}return!i.includes("Z")&&!i.includes("+")&&!i.includes("-",10)&&(c=new Date(i+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",i),new Date)}if(typeof i=="number"){const c=i.toString().length<13?i*1e3:i,g=new Date(c);return isNaN(g.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",i),new Date):g}return console.warn("[useConversationHistory] Unknown date format:",i,typeof i),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",i,c),new Date}},r=i=>{if(!i)return;console.log("[useConversationHistory] Processing record:",{userRequest:i.userRequest,startTime:i.startTime,startTimeType:typeof i.startTime,endTime:i.endTime,endTimeType:typeof i.endTime});const c=i.userRequest||i.title||"History Round",g=n.createDialog(c),E=Ce.getConversationId();if(E){const v=n.getDialog(g.id);v&&(v.conversationId=E,i.rootPlanId&&(v.planId=i.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",g.id,E))}if(i.userRequest&&i.startTime){const v=l(i.startTime);console.log("[useConversationHistory] Parsed date:",{original:i.startTime,parsed:v,parsedISO:v.toISOString(),isValid:!isNaN(v.getTime())});const m={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:i.userRequest,timestamp:v,isStreaming:!1};n.addMessageToDialog(g.id,m)}if(i.currentPlanId){const v=i.summary||i.result||i.message||"Execution completed",m=a(i),w={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:v,timestamp:i.endTime&&i.endTime?l(i.endTime):i.startTime?l(i.startTime):new Date,isStreaming:!1,planExecution:m};n.addMessageToDialog(g.id,w),i.rootPlanId&&t.setCachedPlanRecord(i.rootPlanId,m)}},p=async(i,c=!1,g=!0)=>{if(!i){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&n.clearMessages(),Ce.setConversationId(i),n.setConversationId(i);const E=await mt.getConversationHistory(i);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const v=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:v.startTime,endTime:v.endTime,startTimeType:typeof v.startTime})}for(const v of E)r(v);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),g&&e(s("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:p,restoreConversationHistory:async i=>p(i,!1,!1),processHistoryRecord:r}}let xt=null;function mf(){return xt||(xt=pf()),xt}const hf={class:"direct-page"},ff={class:"branding-header"},vf={class:"branding-content"},gf={class:"branding-actions"},yf=["title"],bf={class:"direct-chat"},_f=["title"],wf=["title"],$f={class:"chat-header"},Sf={class:"header-actions"},Pf=["title"],Tf=["title"],Ef={class:"chat-content"},kf={class:"message-content"},Cf=Te({name:"DirectIndex",__name:"index",setup(n){const t=fo(),e=vo(),s=gt(),{toast:a}=ws(),l=Ze(),r=Qe(),p=mf(),b=F(""),i=F(),c=F(),g=F(null),E=F(50),v=F(80),m=F(!1),w=F(0),_=F(0),f=F(!1),I=F(0),j=F(0);Me(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),ye(()=>r.planExecutionRecords,ce=>{for(const[M,q]of ce.entries())T(M)&&(i.value&&typeof i.value.updateDisplayedPlanProgress=="function"&&i.value.updateDisplayedPlanProgress(M),q.completed&&M===g.value&&(Array.from(ce.entries()).some(([se,oe])=>se!==M&&oe&&!oe.completed&&oe.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),g.value=null)))},{deep:!0}),ye(()=>r.trackedPlanIds,ce=>{if(!g.value&&ce.value.size>0){const M=Array.from(ce.value)[0];g.value=M,console.log("[Direct] Set currentRootPlanId to:",M)}},{deep:!0});const K=Ce.getConversationId();if(K&&(console.log("[Direct] Found saved conversationId, restoring conversation:",K),xe(async()=>{try{await p.restoreConversationHistory(K)}catch(ce){console.error("[DirectView] Failed to restore conversation history:",ce)}})),ue.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const ce=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",ce),ce.trim()?(s.markTaskAsProcessed(),xe(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",ce),await l.sendMessage({input:ce})}catch(M){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",M),b.value=ce}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(b.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",b.value),console.log("[Direct] No unprocessed task in store"));const ie=localStorage.getItem("directPanelWidth");ie&&(E.value=parseFloat(ie));const Ie=localStorage.getItem("sidebarWidth");Ie&&(v.value=parseFloat(Ie)),console.log("[Direct] Final prompt value:",b.value)}),ye(()=>s.currentTask,K=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",K),K&&!K.processed&&K.prompt.trim()){const ie=K.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",ie),xe(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",ie),await l.sendMessage({input:ie})}catch(Ie){console.warn("[Direct] messageDialog.sendMessage failed for new task:",Ie)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ye(()=>b.value,(K,ie)=>{console.log("[Direct] prompt value changed from:",ie,"to:",K)},{immediate:!1}),Ue(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),g.value=null,r.cleanup(),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",S)});const J=K=>{m.value=!0,w.value=K.clientX,_.value=E.value,document.addEventListener("mousemove",P),document.addEventListener("mouseup",C),document.body.style.cursor="col-resize",document.body.style.userSelect="none",K.preventDefault()},P=K=>{if(!m.value)return;const ie=window.innerWidth,ce=-(K.clientX-w.value)/ie*100;let M=_.value+ce;M=Math.max(20,Math.min(80,M)),E.value=M},C=()=>{m.value=!1,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},L=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},O=K=>{f.value=!0,I.value=K.clientX,j.value=v.value,document.addEventListener("mousemove",W),document.addEventListener("mouseup",S),document.body.style.cursor="col-resize",document.body.style.userSelect="none",K.preventDefault()},W=K=>{if(!f.value)return;const ie=window.innerWidth,ce=(K.clientX-I.value)/ie*100;let M=j.value+ce;M=Math.max(15,Math.min(100,M)),v.value=M},S=()=>{f.value=!1,document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",S),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",v.value.toString())},x=()=>{v.value=80,localStorage.setItem("sidebarWidth","80")},T=(K,ie=!1)=>!g.value||K===g.value||ie&&(K==="ui-state"||K==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",K,"current:",g.value),!1),B=K=>{console.log("[DirectView] Step selected:",K),i.value&&typeof i.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to config/preview panel:",K),i.value.handleStepSelected(K)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},U=()=>{e.push("/home")},H=()=>{e.push("/configs")},ee=async()=>{if(Ce.selectMemoryId){console.log("[DirectView] Memory selected:",Ce.selectMemoryId);try{await p.loadConversationHistory(Ce.selectMemoryId,!0,!0)}catch(K){console.error("[DirectView] Failed to load conversation history:",K)}}},Se=()=>{Ce.clearMemoryId(),Ce.clearConversationId(),l.reset()};return(K,ie)=>(h(),y("div",hf,[o("header",ff,[o("div",vf,[ie[1]||(ie[1]=o("div",{class:"branding-logo"},[o("img",{src:uo,alt:"Lynxe",class:"java-logo"}),o("h1",null,"Lynxe")],-1)),o("div",gf,[A(yo),o("button",{class:"back-button",onClick:U},[A(d(D),{icon:"carbon:arrow-left"})]),o("button",{class:"config-button",onClick:H,title:K.$t("direct.configuration")},[A(d(D),{icon:"carbon:settings-adjust",width:"20"})],8,yf)])])]),o("div",bf,[A(df,{ref_key:"sidebarRef",ref:c,width:v.value},null,8,["width"]),o("div",{class:"panel-resizer",onMousedown:O,onDblclick:x,title:K.$t("sidebar.resizeHint")},ie[2]||(ie[2]=[o("div",{class:"resizer-line"},null,-1)]),40,_f),A(Eh,{ref_key:"rightPanelRef",ref:i,style:Je({width:100-v.value-E.value+"%"}),"current-root-plan-id":g.value},null,8,["style","current-root-plan-id"]),o("div",{class:"panel-resizer",onMousedown:J,onDblclick:L,title:K.$t("direct.panelResizeHint")},ie[3]||(ie[3]=[o("div",{class:"resizer-line"},null,-1)]),40,wf),o("div",{class:"left-panel",style:Je({width:E.value+"%"})},[o("div",$f,[o("h2",null,u(K.$t("conversation")),1),o("div",Sf,[o("button",{class:"config-button",onClick:Se,title:K.$t("memory.newChat")},[A(d(D),{icon:"carbon:add",width:"20"})],8,Pf),o("button",{class:"cron-task-btn",onClick:ie[0]||(ie[0]=Ie=>d(Ce).toggleSidebar()),title:K.$t("memory.selectMemory")},[A(d(D),{icon:"carbon:calendar",width:"20"})],8,Tf)])]),o("div",Ef,[A(ol,{onStepSelected:B})]),(h(),$e(Tl,{key:K.$i18n.locale,"initial-value":b.value},null,8,["initial-value"]))],4)]),A(fr,{onMemorySelected:ee}),d(a).show?(h(),y("div",{key:0,class:ve(["message-toast",d(a).type])},[o("div",kf,[o("span",null,u(d(a).text),1)])],2)):V("",!0)]))}}),ev=Ee(Cf,[["__scopeId","data-v-4b41408b"]]);export{ev as default};
//# sourceMappingURL=index-C2ZzcuvB.js.map
