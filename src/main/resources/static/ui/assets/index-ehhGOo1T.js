import{_ as po}from"./Java-AI-BYpq8IxI.js";import{d as Te,u as De,a as g,b as f,n as ve,e as o,f as H,g as R,i as d,h as pe,t as u,y as Ye,F as fe,q as ge,j as we,l as $e,A as ys,c as ae,B as He,r as A,o as Me,C as ye,D as Ue,w as _e,m as Ce,E as Bt,G as Dt,v as mo,H as bs,I as Ne,J as _s,z as xe,T as _t,p as ze,K as ws,M as fo,N as ot,O as ho,x as vo}from"./index-Bw138gRh.js";import{I as D,_ as Ee}from"./_plugin-vue_export-helper-CjSaUu-m.js";import{u as yt,m as Ie,P as go,D as Yt,a as Ge,t as de,s as $s}from"./templateStore-CW3EJ1bm.js";import{P as Qt,L as yo}from"./plan-template-with-tool-api-service-B_3WInu2.js";import{M as Ss,u as wt,a as bo,b as Ps}from"./useToast-z0NwZYE3.js";import"./llm-check-CJy4TeZw.js";const _o={class:"sub-plan-info"},wo={class:"sub-plan-details"},$o={class:"sub-plan-title"},So={key:0,class:"nesting-level"},Po={class:"sub-plan-id"},To={class:"sub-plan-meta"},Eo={key:0,class:"trigger-tool"},ko={class:"trigger-text"},Co={key:0,class:"sub-plan-progress"},Io={class:"progress-info"},Ro={class:"progress-text"},xo={class:"progress-bar"},Ao={key:1,class:"sub-plan-agents-steps"},Fo={class:"agents-steps-header"},Mo={class:"agents-label"},Do={class:"agents-steps-list"},No=["onClick"],Uo={class:"agent-step-header"},Lo=["title"],Oo={class:"sub-agent-execution-info"},qo={key:0,class:"agent-result"},Bo={class:"result-header"},Ho={class:"result-label"},Vo={class:"result-content"},jo={key:1,class:"agent-error"},zo={class:"error-header"},Wo={class:"error-label"},Go={class:"error-content"},Ko={key:2,class:"think-act-preview"},Jo={class:"think-act-header"},Xo={class:"think-act-label"},Yo={class:"think-act-steps-preview"},Qo=["onClick"],Zo={class:"step-number"},en={class:"step-description"},tn={key:0,class:"more-steps"},sn={class:"more-steps-text"},on={key:3,class:"nested-sub-plans"},nn={class:"nested-sub-plans-header"},an={class:"nested-label"},ln={class:"nested-sub-plans-list"},rn={key:4,class:"direct-sub-plans"},cn={class:"direct-sub-plans-header"},un={class:"direct-label"},dn={class:"direct-sub-plans-list"},pn=Te({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=n,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(F=>F.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(F=>F.status==="FINISHED")?"in-progress":"pending",p=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},y=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},i=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const b=c();return Math.min(100,b/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(b=>b.status==="FINISHED").length:0,h=b=>{switch(b){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},k=b=>{switch(b){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},_=b=>{switch(b){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},m=b=>b.thinkActSteps?.some(P=>P.subPlanExecutionRecord)??!1,T=b=>b.thinkActSteps?.filter(P=>P.subPlanExecutionRecord)??[],$=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},v=(b,P)=>{const F=P.stepId??`subplan-${e.subPlanIndex}-agent-${b}`;s("step-selected",F)},N=(b,P,F)=>{const L=F.stepId??`subplan-${e.subPlanIndex}-agent-${b}`;s("step-selected",L)},G=(b,P,F)=>{s("sub-plan-selected",b,P,F)},U=b=>{s("step-selected",b)};return(b,P)=>{const F=ys("RecursiveSubPlan",!0);return f(),g("div",{class:ve(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:$},[o("div",_o,[R(d(D),{icon:y(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",wo,[o("div",$o,[pe(u(b.subPlan.title||b.$t("chat.subPlan"))+" #"+u(b.subPlanIndex+1)+" ",1),(b.nestingLevel??0)>0?(f(),g("span",So,"(L"+u((b.nestingLevel??0)+1)+")",1)):H("",!0)]),o("div",Po,u(b.subPlan.currentPlanId),1)])]),o("div",To,[o("div",{class:ve(["sub-plan-status-badge",r()])},u(p()),3),b.subPlan.parentActToolCall?(f(),g("div",Eo,[R(d(D),{icon:"carbon:function",class:"trigger-icon"}),o("span",ko,u(b.subPlan.parentActToolCall.name),1)])):H("",!0)])]),b.subPlan.agentExecutionSequence?.length?(f(),g("div",Co,[o("div",Io,[o("span",Ro,u(b.$t("chat.progress"))+": "+u(c())+" / "+u(b.subPlan.agentExecutionSequence.length),1),o("div",xo,[o("div",{class:"progress-fill",style:Ye({width:i()+"%"})},null,4)])])])):H("",!0),b.subPlan.agentExecutionSequence?.length?(f(),g("div",Ao,[o("div",Fo,[o("span",Mo,u(b.$t("chat.agentExecutions"))+":",1)]),o("div",Do,[(f(!0),g(fe,null,ge(b.subPlan.agentExecutionSequence,(L,B)=>(f(),g("div",{key:L.id||B,class:ve(["agent-step-item",h(L.status)]),onClick:S=>v(B,L)},[o("div",Uo,[R(d(D),{icon:k(L.status),class:"agent-icon"},null,8,["icon"]),o("span",{class:"agent-name",title:L.agentName==="ConfigurableDynaAgent"?b.$t("chat.clickToViewExecutionDetails"):""},u(L.agentName==="ConfigurableDynaAgent"?b.$t("chat.funcAgentExecutionDetails"):L.agentName||b.$t("chat.unknownAgent")),9,Lo),o("div",{class:ve(["agent-status-badge",h(L.status)])},u(_(L.status)),3)]),o("div",Oo,[L.result?(f(),g("div",qo,[o("div",Bo,[R(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Ho,u(b.$t("chat.agentResult"))+":",1)]),o("pre",Vo,u(L.result),1)])):H("",!0),L.errorMessage?(f(),g("div",jo,[o("div",zo,[R(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Wo,u(b.$t("chat.errorMessage"))+":",1)]),o("pre",Go,u(L.errorMessage),1)])):H("",!0),L.thinkActSteps?.length?(f(),g("div",Ko,[o("div",Jo,[R(d(D),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Xo,u(b.$t("chat.thinkActSteps"))+" ("+u(L.thinkActSteps.length)+")",1)]),o("div",Yo,[(f(!0),g(fe,null,ge(L.thinkActSteps.slice(0,b.maxVisibleSteps??2),(S,x)=>(f(),g("div",{key:S.id||x,class:"think-act-step-preview",onClick:we(E=>N(B,x,L),["stop"])},[o("span",Zo,"#"+u(x+1),1),o("span",en,u(S.actionDescription||b.$t("chat.thinking")),1),R(d(D),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Qo))),128)),L.thinkActSteps.length>(b.maxVisibleSteps??2)?(f(),g("div",tn,[o("span",sn,u(b.$t("chat.andMoreSteps",{count:L.thinkActSteps.length-(b.maxVisibleSteps??2)})),1)])):H("",!0)])])):H("",!0),m(L)?(f(),g("div",on,[o("div",nn,[R(d(D),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",an,u(b.$t("chat.nestedSubPlans")),1)]),o("div",ln,[(f(!0),g(fe,null,ge(T(L),(S,x)=>(f(),$e(F,{key:S.id||x,"sub-plan":S.subPlanExecutionRecord,"sub-plan-index":x,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:G,onStepSelected:U},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):H("",!0),L.subPlanExecutionRecords?.length?(f(),g("div",rn,[o("div",cn,[R(d(D),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",un,u(b.$t("chat.directSubPlans")),1)]),o("div",dn,[(f(!0),g(fe,null,ge(L.subPlanExecutionRecords,(S,x)=>(f(),$e(F,{key:S.currentPlanId||x,"sub-plan":S,"sub-plan-index":x,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:G,onStepSelected:U},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):H("",!0)])],10,No))),128))])])):H("",!0)],2)}}}),mn=Ee(pn,[["__scopeId","data-v-36486b62"]]),fn={class:"execution-details"},hn={key:0,class:"plan-overview"},vn={key:0,class:"parent-tool-call"},gn={class:"parent-tool-header"},yn={class:"tool-label"},bn={class:"tool-name"},_n={key:0,class:"tool-parameters"},wn={class:"param-label"},$n={class:"param-content"},Sn={key:1,class:"agent-execution-container"},Pn={class:"section-title"},Tn=["onClick"],En={class:"agent-info"},kn={class:"agent-details"},Cn=["title"],In={class:"request-content"},Rn={class:"agent-controls"},xn={class:"agent-execution-info"},An={key:0,class:"agent-result"},Fn={class:"result-header"},Mn={class:"result-label"},Dn={class:"result-content"},Nn={key:1,class:"agent-error"},Un={class:"error-header"},Ln={class:"error-label"},On={class:"error-content"},qn={key:0,class:"sub-plans-container"},Bn={class:"sub-plans-header"},Hn={class:"sub-plans-title"},Vn={class:"sub-plans-list"},jn=Te({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=h=>{h.stepId?e("step-selected",h.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",h)},l=h=>{switch(h){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=h=>{switch(h){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},p=h=>{switch(h){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},y=(h,k,_)=>{e("sub-plan-selected",h,k,_)},i=h=>{e("step-selected",h)},c=h=>{if(!h)return"";try{const k=JSON.parse(h);return JSON.stringify(k,null,2)}catch{return h}};return(h,k)=>(f(),g("div",fn,[h.planExecution?(f(),g("div",hn,[h.planExecution.parentActToolCall?(f(),g("div",vn,[o("div",gn,[R(d(D),{icon:"carbon:flow",class:"tool-icon"}),o("span",yn,u(h.$t("chat.triggeredByTool"))+":",1),o("span",bn,u(h.planExecution.parentActToolCall.name),1)]),h.planExecution.parentActToolCall.parameters?(f(),g("div",_n,[o("span",wn,u(h.$t("common.parameters"))+":",1),o("pre",$n,u(c(h.planExecution.parentActToolCall.parameters)),1)])):H("",!0)])):H("",!0)])):H("",!0),(h.planExecution?.agentExecutionSequence?.length??0)>0?(f(),g("div",Sn,[o("h4",Pn,u(h.$t("chat.agentExecutionSequence")),1),(f(!0),g(fe,null,ge(h.planExecution?.agentExecutionSequence,(_,m)=>(f(),g("div",{key:_.id||m,class:ve(["agent-execution-item",l(_.status)])},[o("div",{class:"agent-header",onClick:T=>a(_)},[o("div",En,[R(d(D),{icon:p(_.status),class:"agent-status-icon"},null,8,["icon"]),o("div",kn,[o("div",{class:"agent-name",title:_.agentName==="ConfigurableDynaAgent"?h.$t("chat.clickToViewExecutionDetails"):""},u(_.agentName==="ConfigurableDynaAgent"?h.$t("chat.funcAgentExecutionDetails"):_.agentName||h.$t("chat.unknownAgent")),9,Cn),o("pre",In,u(_.agentRequest),1)])]),o("div",Rn,[o("div",{class:ve(["agent-status-badge",l(_.status)])},u(r(_.status)),3),R(d(D),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Tn),o("div",xn,[_.result?(f(),g("div",An,[o("div",Fn,[R(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Mn,u(h.$t("chat.agentResult"))+":",1)]),o("pre",Dn,u(_.result),1)])):H("",!0),_.errorMessage?(f(),g("div",Nn,[o("div",Un,[R(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ln,u(h.$t("chat.errorMessage"))+":",1)]),o("pre",On,u(_.errorMessage),1)])):H("",!0)]),_.subPlanExecutionRecords?.length?(f(),g("div",qn,[o("div",Bn,[R(d(D),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",Hn,u(h.$t("chat.subPlanExecutions"))+" ("+u(_.subPlanExecutionRecords.length)+") ",1)]),o("div",Vn,[(f(!0),g(fe,null,ge(_.subPlanExecutionRecords,(T,$)=>(f(),$e(mn,{key:T.currentPlanId||$,"sub-plan":T,"sub-plan-index":$,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:y,onStepSelected:i},null,8,["sub-plan","sub-plan-index"]))),128))])])):H("",!0)],2))),128))])):H("",!0)]))}}),zn=Ee(jn,[["__scopeId","data-v-ee75d960"]]);function Ts(){return{formatResponseText:y=>y?y.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:y=>{if(!y||isNaN(y.getTime()))return"";const c=new Date().getTime()-y.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return y.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(h){return console.warn("[useMessageFormatting] Error formatting timestamp:",y,h),""}},getMessageClasses:y=>ae(()=>({user:y.type==="user",assistant:y.type==="assistant",streaming:y.isStreaming,"has-error":!!y.error,"has-thinking":!!y.thinking,"has-execution":!!y.planExecution})),formatFileSize:y=>{if(y===0)return"0 B";const i=1024,c=["B","KB","MB","GB"],h=Math.floor(Math.log(y)/Math.log(i));return parseFloat((y/Math.pow(i,h)).toFixed(2))+" "+c[h]},truncateText:(y,i=100)=>!y||y.length<=i?y:y.substring(0,i)+"...",stripHtml:y=>y.replace(/<[^>]*>/g,""),hasDisplayableContent:y=>!!(y.content||(y.thinking??!1)||(y.planExecution??!1)||y.error),getMessageStatus:y=>y.error?"Send failed":y.isStreaming?"Typing...":y.type==="assistant"&&!y.content&&!y.thinking?"Waiting for response":""}}class Nt{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Wn={class:"user-input-form-container"},Gn={class:"user-input-header"},Kn={class:"user-input-title"},Jn={class:"user-input-message"},Xn={key:0,class:"form-description"},Yn={key:0,class:"form-grid"},Qn=["for"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","placeholder","required","onUpdate:modelValue"],oa=["id","name","placeholder","required","onUpdate:modelValue"],na=["id","name","required","onUpdate:modelValue"],aa={value:""},la=["value"],ra={key:6,class:"checkbox-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"checkbox-label"},ua={key:7,class:"radio-group"},da=["id","name","value","onUpdate:modelValue"],pa={class:"radio-label"},ma=["id","name","placeholder","required","onUpdate:modelValue"],fa={key:1,class:"form-group"},ha={for:"form-input-genericInput"},va={type:"submit",class:"submit-user-input-btn"},ga=Te({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:t}){const e=n,s=t;De();const a=He({}),l=A(e.genericInput??""),r=A(!1),p=A(null),y=()=>{const k=e.userInputWaitState?.formInputs;k&&k.length>0&&(!r.value||Object.keys(a).length!==k.length)&&(k.forEach((m,T)=>{(!(T in a)||m.type==="checkbox"&&!Array.isArray(a[T])||m.type!=="checkbox"&&a[T]==="")&&(m.type==="checkbox"?a[T]=[]:a[T]="")}),r.value=!0)};Me(()=>{y()}),ye(()=>e.userInputWaitState?.formInputs,()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{r.value=!1,y()},100)},{deep:!0});const i=async()=>{try{const k={},_=e.userInputWaitState?.formInputs;_&&_.length>0?Object.entries(a).forEach(([m,T])=>{const $=parseInt(m,10),N=_[$].label||`input_${m}`;Array.isArray(T)?k[N]=T.join(", "):k[N]=T}):k.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",k,"for planId:",e.planId),e.planId?(await Nt.submitFormInput(e.planId,k),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",k)}catch(k){console.error("[UserInputForm] User input submission failed:",k)}},c=k=>k?Array.isArray(k)?k:typeof k=="string"?k.split(",").map(_=>_.trim()).filter(_=>_.length>0):[]:[],h=k=>typeof k=="boolean"?k:typeof k=="string"?k==="true":!1;return Ue(()=>{p.value&&clearTimeout(p.value)}),(k,_)=>(f(),g("div",Wn,[o("div",Gn,[R(d(D),{icon:"carbon:user",class:"user-icon"}),o("h4",Kn,u(k.$t("chat.userInputRequired")),1)]),o("p",Jn,u(k.userInputWaitState?.title??k.$t("chat.userInput.message")),1),k.userInputWaitState?.formDescription?(f(),g("p",Xn,u(k.userInputWaitState?.formDescription),1)):H("",!0),o("form",{onSubmit:we(i,["prevent"]),class:"user-input-form"},[k.userInputWaitState?.formInputs&&k.userInputWaitState.formInputs.length>0?(f(),g("div",Yn,[(f(!0),g(fe,null,ge(k.userInputWaitState?.formInputs,(m,T)=>(f(),g("div",{key:T,class:"form-group"},[o("label",{for:`form-input-${m.label.replace(/\W+/g,"_")}`},u(m.label)+u(h(m.required)?" *":"")+": ",9,Qn),!m.type||m.type==="text"?_e((f(),g("input",{key:0,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input"},null,8,Zn)),[[Ce,a[T]]]):m.type==="email"?_e((f(),g("input",{key:1,type:"email",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input"},null,8,ea)),[[Ce,a[T]]]):m.type==="number"?_e((f(),g("input",{key:2,type:"number",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input"},null,8,ta)),[[Ce,a[T]]]):m.type==="password"?_e((f(),g("input",{key:3,type:"password",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input"},null,8,sa)),[[Ce,a[T]]]):m.type==="textarea"?_e((f(),g("textarea",{key:4,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input form-textarea",rows:"4"},null,8,oa)),[[Ce,a[T]]]):m.type==="select"&&m.options?_e((f(),g("select",{key:5,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input form-select"},[o("option",aa,u(k.$t("selectCommon.pleaseSelect")),1),(f(!0),g(fe,null,ge(c(m.options),$=>(f(),g("option",{key:$,value:$},u($),9,la))),128))],8,na)),[[Bt,a[T]]]):m.type==="checkbox"&&m.options?(f(),g("div",ra,[(f(!0),g(fe,null,ge(c(m.options),$=>(f(),g("label",{key:$,class:"checkbox-item"},[_e(o("input",{type:"checkbox",id:`form-input-${m.label.replace(/\W+/g,"_")}-${$.replace(/\W+/g,"_")}`,name:m.label,value:$,"onUpdate:modelValue":v=>a[T]=v,class:"form-checkbox"},null,8,ia),[[Dt,a[T]]]),o("span",ca,u($),1)]))),128))])):m.type==="radio"&&m.options?(f(),g("div",ua,[(f(!0),g(fe,null,ge(c(m.options),$=>(f(),g("label",{key:$,class:"radio-item"},[_e(o("input",{type:"radio",id:`form-input-${m.label.replace(/\W+/g,"_")}-${$.replace(/\W+/g,"_")}`,name:m.label,value:$,"onUpdate:modelValue":v=>a[T]=v,class:"form-radio"},null,8,da),[[mo,a[T]]]),o("span",pa,u($),1)]))),128))])):_e((f(),g("input",{key:8,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:h(m.required),"onUpdate:modelValue":$=>a[T]=$,class:"form-input"},null,8,ma)),[[Ce,a[T]]])]))),128))])):(f(),g("div",fa,[o("label",ha,u(k.$t("common.input"))+":",1),_e(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":_[0]||(_[0]=m=>l.value=m),class:"form-input"},null,512),[[Ce,l.value]])])),o("button",va,u(k.$t("chat.userInput.submit")),1)],32)]))}}),ya=Ee(ga,[["__scopeId","data-v-e4d0802d"]]),ba={class:"response-section"},_a={class:"response-header"},wa={class:"response-avatar"},$a={class:"response-name"},Sa={key:0,class:"response-timestamp"},Pa={class:"response-content"},Ta={key:1,class:"final-response"},Ea=["innerHTML"],ka={class:"response-actions"},Ca=["title"],Ia=["title"],Ra={key:2,class:"response-placeholder"},xa={class:"typing-indicator"},Aa={class:"typing-text"},Fa={key:3,class:"response-error"},Ma={class:"error-text"},Da={key:4,class:"response-empty"},Na={class:"empty-text"},Ua=Te({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:t}){const e=n,s=t,{formatResponseText:a,formatTimestamp:l}=Ts(),r=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},p=()=>{s("regenerate")},y=()=>{s("retry")},i=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,h)=>(f(),g("div",ba,[o("div",_a,[o("div",wa,[R(d(D),{icon:"carbon:bot",class:"bot-icon"})]),o("div",$a,u(c.$t("chat.botName")),1),c.timestamp?(f(),g("div",Sa,u(d(l)(c.timestamp)),1)):H("",!0)]),o("div",Pa,[c.userInputWaitState?.waiting?(f(),$e(ya,bs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:i}),null,16,["user-input-wait-state","generic-input"])):H("",!0),c.content?(f(),g("div",Ta,[o("div",{class:"response-text",innerHTML:d(a)(c.content)},null,8,Ea),o("div",ka,[o("button",{class:"action-btn copy-btn",onClick:r,title:c.$t("chat.copyResponse")},[R(d(D),{icon:"carbon:copy"})],8,Ca),o("button",{class:"action-btn regenerate-btn",onClick:p,title:c.$t("chat.regenerateResponse")},[R(d(D),{icon:"carbon:renew"})],8,Ia)])])):c.isStreaming?(f(),g("div",Ra,[o("div",xa,[h[0]||(h[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Aa,u(c.$t("chat.thinkingResponse")),1)])])):c.error?(f(),g("div",Fa,[R(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ma,u(c.error),1),o("button",{class:"retry-btn",onClick:y},u(c.$t("chat.retry")),1)])):(f(),g("div",Da,[o("span",Na,u(c.$t("chat.waitingForResponse")),1)]))])]))}}),La=Ee(Ua,[["__scopeId","data-v-a03ac86f"]]);function Oa(){const s=A(new Set),a=He(new Map),l=He(new Map),r=He(new Map),p=He(new Map),y=A(!1),i=A(null),c=P=>p.get(P),h=(P,F)=>{if(!P){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}p.set(P,F),console.log("[usePlanExecution] Cached plan record:",P)},k=()=>Array.from(s.value),_=P=>{if(!P){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(P),l.set(P,0),r.set(P,0),console.log("[usePlanExecution] Tracking plan:",P),i.value||v(),T(P).catch(F=>{console.error(`[usePlanExecution] Initial poll failed for ${P}:`,F)})},m=P=>{s.value.delete(P),l.delete(P),r.delete(P),console.log("[usePlanExecution] Untracking plan:",P),s.value.size===0&&a.size===0&&N()},T=async P=>{if(P)try{console.log("[usePlanExecution] Polling plan status for:",P);const F=await Nt.getDetails(P);if(console.log("[usePlanExecution] Received plan details:",F?"YES":"NO",F),r.delete(P),!F){const S=r.get(P)||0;S<10?(r.set(P,S+1),console.log(`[usePlanExecution] Plan ${P} not found yet, retrying (${S+1}/10)`),setTimeout(()=>{s.value.has(P)&&T(P).catch(x=>{console.error(`[usePlanExecution] Retry poll failed for ${P}:`,x)})},1e3)):(console.warn(`[usePlanExecution] Plan ${P} not found after 10 attempts, giving up`),m(P));return}const L=l.get(P)||0;l.set(P,L+1);const B=F.rootPlanId||F.currentPlanId;if(!B){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",F);return}if(p.set(B,F),P!==B&&(p.set(P,F),console.log("[usePlanExecution] Stored record with both keys:",{planId:P,recordKey:B})),console.log("[usePlanExecution] Updated plan execution record:",{planId:P,recordKey:B,rootPlanId:F.rootPlanId,currentPlanId:F.currentPlanId,completed:F.completed,status:F.status,attempt:L+1}),F.completed){console.log(`[usePlanExecution] Plan ${B} completed, checking for summary...`);const S=yt();S.currentTask&&S.currentTask.isRunning&&(S.currentTask.isRunning=!1);const x=F.summary||F.result||F.message,E=a.get(B)||0;if(!x&&E<10)a.set(B,E+1),console.log(`[usePlanExecution] Plan ${B} completed but no summary yet, continuing to poll (${E+1}/10)`);else{console.log(`[usePlanExecution] Plan ${B} completed, cleaning up...`,{hasSummary:!!x,pollCount:E});try{await Nt.deleteExecutionDetails(B),console.log(`[usePlanExecution] Deleted execution details for plan: ${B}`)}catch(q){const O=q instanceof Error?q.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${O}`)}m(P),a.delete(B),setTimeout(()=>{p.delete(B),P!==B&&p.delete(P)},5e3)}}F.status==="failed"&&F.message&&!F.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${B} failed:`,F.message)}catch(F){const L=F instanceof Error?F.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${P}:`,L);const B=r.get(P)||0;B<10&&(r.set(P,B+1),console.log(`[usePlanExecution] Network error for ${P}, retrying (${B+1}/10)`),setTimeout(()=>{s.value.has(P)&&T(P).catch(S=>{console.error(`[usePlanExecution] Retry poll failed for ${P}:`,S)})},1e3*(B+1)))}},$=async()=>{if(y.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const P=new Set(s.value);for(const[F]of a.entries())P.add(F);if(P.size!==0)try{y.value=!0;const F=Array.from(P).map(L=>T(L));await Promise.all(F)}catch(F){console.error("[usePlanExecution] Failed to poll tracked plans:",F)}finally{y.value=!1}},v=()=>{i.value&&clearInterval(i.value),i.value=window.setInterval(()=>{$()},1e3),console.log("[usePlanExecution] Started adaptive polling")},N=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}i.value&&(clearInterval(i.value),i.value=null),console.log("[usePlanExecution] Stopped polling")},G=async P=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${P}`),await T(P)},U=P=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:P}),!P){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}yt().setTaskRunning(P),_(P)},b=()=>{N(),s.value.clear(),a.clear(),l.clear(),r.clear(),p.clear(),y.value=!1};return{planExecutionRecords:Ne(p),trackedPlanIds:Ne(s),isPolling:Ne(y),getPlanExecutionRecord:c,setCachedPlanRecord:h,getTrackedPlanIds:k,trackPlan:_,untrackPlan:m,handlePlanExecutionRequested:U,pollPlanStatusImmediately:G,startPolling:v,stopPolling:N,cleanup:b}}let kt=null;function Ze(){return kt||(kt=Oa()),kt}function qa(){const n=Ze(),t=A([]),e=A(null),s=A(null),a=A(null),l=ae(()=>a.value),r=A(!1),p=A(null),y=A(null),i=A(null),c=ae(()=>e.value&&t.value.find(M=>M.id===e.value)||null),h=ae(()=>t.value.length>0),k=ae(()=>t.value.length),_=ae(()=>{if(!s.value)return c.value?.messages||[];const M=[];for(const j of t.value)j.conversationId===s.value&&M.push(...j.messages);return M.sort((j,K)=>j.timestamp.getTime()-K.timestamp.getTime())}),m=M=>{const j={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:M||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(j),e.value=j.id,console.log("[useMessageDialog] Created new dialog round:",j.id,{conversationId:s.value,rootPlanId:a.value}),j},T=M=>t.value.find(j=>j.id===M)||null,$=M=>{if(t.value.forEach(j=>{j.isActive=!1}),M){const j=t.value.find(K=>K.id===M);j&&(j.isActive=!0,e.value=M)}else e.value=null},v=(M,j)=>{const K=t.value.find(Q=>Q.id===M);K&&(K.messages.push(j),K.updatedAt=new Date)},N=(M,j,K)=>{const Q=t.value.find(se=>se.id===M);if(Q){const se=Q.messages.findIndex(le=>le.id===j);se!==-1&&(Q.messages[se]={...Q.messages[se],...K},Q.updatedAt=new Date)}},G=M=>{const j=t.value.findIndex(K=>K.id===M);if(j!==-1){const K=t.value[j];if(t.value.splice(j,1),console.log("[useMessageDialog] Deleted dialog round:",M),e.value===M){const Q=t.value.filter(se=>se.conversationId===K.conversationId);e.value=Q.length>0?Q[0].id:null,e.value&&$(e.value)}}},U=M=>{const j=t.value.filter(K=>K.planId===M);j.forEach(K=>{G(K.id)}),console.log(`[useMessageDialog] Deleted ${j.length} dialog round(s) for plan:`,M)},b=M=>{const j=t.value.filter(K=>K.conversationId===M);j.forEach(K=>{G(K.id)}),console.log(`[useMessageDialog] Deleted ${j.length} dialog round(s) for conversation:`,M),s.value===M&&(s.value=null)},P=()=>{t.value=[],e.value=null},F=async M=>{let j=null,K=null;try{if(r.value){const me="Please wait for the current task to complete before starting a new one";return p.value=me,{success:!1,error:me}}r.value=!0,p.value=null,j=m();const Q={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.input,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(me=>typeof me=="string"?new File([],me):me)}};v(j.id,Q),K={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},v(j.id,K);const se=M;let le;if(se.toolName&&se.replacementParams?le=await Yt.executeByToolName(se.toolName,se.replacementParams,M.uploadedFiles,M.uploadKey,"VUE_DIALOG"):le=await Yt.sendMessageWithDefaultPlan(M,"VUE_DIALOG"),le.conversationId&&(s.value=le.conversationId,j.conversationId=le.conversationId,Ie.setConversationId(le.conversationId),console.log("[useMessageDialog] Conversation ID set:",le.conversationId)),le.planId){const me=le.planId;a.value=me,j.planId=me,N(j.id,K.id,{thinking:"Planning execution...",planExecution:{currentPlanId:me,rootPlanId:me,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(me),console.log("[useMessageDialog] Root plan ID set and tracking started:",me)}else{const me={content:le.message||le.result||"No response received",isStreaming:!1};N(j.id,K.id,me)}return{success:!0,...le.planId&&{planId:le.planId},...le.conversationId&&{conversationId:le.conversationId}}}catch(Q){const se=Q instanceof Error?Q.message:"Failed to send message";return p.value=se,console.error("[useMessageDialog] Send message failed:",Q),j&&K&&N(j.id,K.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),{success:!1,error:se}}finally{r.value=!1}},L=async M=>{let j=null,K=null;try{if(r.value){const te="Please wait for the current task to complete before starting a new one";return p.value=te,{success:!1,error:te}}r.value=!0,p.value=null;const Q=Ie.getConversationId();Q&&!s.value&&(s.value=Q,console.log("[useMessageDialog] Restored conversationId from memoryStore:",Q)),j=m(M.title),M.title&&(j.title=M.title);const se={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.title,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(te=>typeof te=="string"?new File([],te):te)}};v(j.id,se),K={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},v(j.id,K);const le=M.planData.planTemplateId;if(!le||le===null)throw new Error("Plan template ID is required");const me=await go.executePlan(le,M.params,M.uploadedFiles,M.replacementParams,M.uploadKey??void 0,"VUE_SIDEBAR");if(me.conversationId){const te=me.conversationId,z=s.value||Ie.getConversationId();te!==z?(console.log("[useMessageDialog] Conversation ID changed:",z,"->",te),s.value=te,j.conversationId=te,Ie.setConversationId(te)):(j.conversationId=te,console.log("[useMessageDialog] Conversation ID unchanged:",te))}else s.value&&(j.conversationId=s.value);if(me.planId){const te=me.planId;a.value=te,j.planId=te,N(j.id,K.id,{thinking:"Planning execution...",planExecution:{currentPlanId:te,rootPlanId:te,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(te),console.log("[useMessageDialog] Root plan ID set and tracking started:",te)}else{const te={content:"Plan execution started",isStreaming:!1};N(j.id,K.id,te)}return{success:!0,...me.planId&&{planId:me.planId}}}catch(Q){const se=Q instanceof Error?Q.message:"Failed to execute plan";return p.value=se,console.error("[useMessageDialog] Execute plan failed:",Q),j&&K&&N(j.id,K.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),r.value=!1,{success:!1,error:se}}},B=(M,j,K)=>{const Q={};K!==void 0&&(Q.planExecution=K),N(M,j,Q)},S=M=>{const j={...M};return"agentExecutionSequence"in M&&Array.isArray(M.agentExecutionSequence)&&(j.agentExecutionSequence=M.agentExecutionSequence.map(K=>x(K))),j},x=M=>{const j={...M};return"subPlanExecutionRecords"in M&&Array.isArray(M.subPlanExecutionRecords)&&(j.subPlanExecutionRecords=M.subPlanExecutionRecords.map(K=>S(K))),j},E=(M,j,K)=>{c.value||m();const Q=c.value,se={...K};K?.planExecution&&(se.planExecution=S(K.planExecution));const le={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:M,content:j,timestamp:new Date,isStreaming:!1,...se};return Q.messages.push(le),Q.updatedAt=new Date,le},q=(M,j)=>{if(!c.value)return;const K={...j};j.planExecution&&(K.planExecution=S(j.planExecution));const Q=c.value.messages.findIndex(se=>se.id===M);Q!==-1&&(c.value.messages[Q]={...c.value.messages[Q],...K},c.value.updatedAt=new Date)},O=M=>{if(c.value)return c.value.messages.find(j=>j.id===M)},V=M=>{y.value=M,q(M,{isStreaming:!0})},ee=M=>{M&&q(M,{isStreaming:!1}),(y.value===M||!M)&&(y.value=null)},Se=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,y.value=null)},X=(M,j)=>{r.value=!M,j!==void 0&&(i.value=j),console.log("[useMessageDialog] Input state updated:",{enabled:M,placeholder:j,isLoading:r.value})},ce=M=>{s.value=M,console.log("[useMessageDialog] Set conversationId:",M)},ke=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,p.value=null,i.value=null},ue=(M,j,K)=>{const Q={planExecution:S(K),isStreaming:!K.completed};if(!K.completed)Q.thinking="Processing...";else{if(!K.agentExecutionSequence||K.agentExecutionSequence.length===0){const se=K.summary??K.result??K.message??"Execution completed";se&&(Q.content=se,Q.thinking="")}else K.summary&&(Q.content=K.summary,Q.thinking="");K.status==="failed"&&K.message&&(Q.content=`Error: ${K.message}`,Q.thinking="")}N(M.id,j.id,Q)};return _s(()=>{const M=n.planExecutionRecords,j=M.size,K=Array.from(M.entries()),Q=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",K.length,"size:",j),console.log("[useMessageDialog] watchEffect - dialogList count:",Q.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",Q.filter(te=>te.planId).map(te=>({id:te.id,planId:te.planId})));for(const te of Q){if(!te.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",te.id);continue}const z=te.messages.find(oe=>oe.planExecution?.rootPlanId===te.planId||oe.planExecution?.currentPlanId===te.planId);if(!z){console.log("[useMessageDialog] watchEffect: No message found for planId:",te.planId,{dialogMessages:te.messages.map(oe=>({id:oe.id,type:oe.type,planExecutionRootPlanId:oe.planExecution?.rootPlanId,planExecutionCurrentPlanId:oe.planExecution?.currentPlanId,hasPlanExecution:!!oe.planExecution}))});continue}let I=K.find(([oe])=>oe===te.planId);const W=z.planExecution;if(!I&&W?.rootPlanId&&(I=K.find(([oe])=>oe===W.rootPlanId)),!I&&W?.currentPlanId&&(I=K.find(([oe])=>oe===W.currentPlanId)),!I){for(const[oe,be]of K)if(be&&(be.rootPlanId===te.planId||be.currentPlanId===te.planId||z.planExecution?.rootPlanId&&(be.rootPlanId===z.planExecution.rootPlanId||be.currentPlanId===z.planExecution.rootPlanId)||z.planExecution?.currentPlanId&&(be.rootPlanId===z.planExecution.currentPlanId||be.currentPlanId===z.planExecution.currentPlanId))){I=[oe,be],console.log("[useMessageDialog] watchEffect: Found record by value matching:",{dialogPlanId:te.planId,recordKey:oe,recordRootPlanId:be.rootPlanId,recordCurrentPlanId:be.currentPlanId});break}}if(!I){const oe=z.planExecution;if(oe&&oe.status==="running"){console.log("[useMessageDialog] watchEffect: Message has planExecution but record not found yet, keeping initial state:",{dialogId:te.id,messageId:z.id,planId:te.planId,messagePlanExecution:oe,availableRecordKeys:K.map(([be])=>be)});continue}console.log("[useMessageDialog] watchEffect: No record found and message has no running planExecution:",{dialogId:te.id,planId:te.planId,hasPlanExecution:!!z.planExecution,planExecutionStatus:z.planExecution?.status,availableRecordKeys:K.map(([be])=>be)});continue}const[,Z]=I,ne=S(Z);console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:te.id,messageId:z.id,planId:te.planId,recordKey:I[0],recordCompleted:ne.completed,recordStatus:ne.status}),ue(te,z,ne)}const se=n.trackedPlanIds.value.size>0,le=K.some(([,te])=>te&&!te.completed&&te.status!=="failed");!(se||le)&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:se,hasRunningPlansInRecords:le,trackedPlanIds:Array.from(n.trackedPlanIds.value),recordsCount:K.length}),r.value=!1)}),{dialogList:Ne(t),activeDialogId:Ne(e),rootPlanId:Ne(a),conversationId:Ne(s),isLoading:r,error:p,streamingMessageId:Ne(y),inputPlaceholder:Ne(i),activeDialog:c,activeRootPlanId:l,hasDialogs:h,dialogCount:k,messages:_,createDialog:m,getDialog:T,setActiveDialog:$,addMessageToDialog:v,updateMessageInDialog:N,deleteDialog:G,deleteConversationRoundByPlanId:U,deleteConversation:b,clearAllDialogs:P,sendMessage:F,executePlan:L,updatePlanExecutionStatus:B,updateInputState:X,setConversationId:ce,reset:ke,addMessage:E,updateMessage:q,findMessage:O,startStreaming:V,stopStreaming:ee,clearMessages:Se}}let Ct=null;function et(){return Ct||(Ct=qa()),Ct}function Ba(n){const t=A(!1),e=A(!0),s=150,a=async($=!0)=>{n.value&&(await xe(),n.value.scrollTo({top:n.value.scrollHeight,behavior:$?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:$,scrollHeight:v,clientHeight:N}=n.value;return v-$-N<s},r=()=>{if(!n.value)return;const $=l();t.value=!$&&n.value.scrollHeight>n.value.clientHeight,$&&(e.value=!0)},p=()=>{r(),l()||(e.value=!1)},y=async()=>{e.value&&await a()},i=async()=>{e.value=!0,await a()},c=($,v=!0)=>{if(!n.value)return;const N=n.value.querySelector(`[data-message-id="${$}"]`);N&&N.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},h=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:$,scrollHeight:v,clientHeight:N}=n.value,G=$===0,U=$+N>=v-5,b=v>N?$/(v-N)*100:100;return{scrollTop:$,scrollHeight:v,clientHeight:N,isAtTop:G,isAtBottom:U,scrollPercentage:b}},k=()=>{n.value&&n.value.addEventListener("scroll",p,{passive:!0})},_=()=>{n.value&&n.value.removeEventListener("scroll",p)},m=()=>{k(),r()},T=()=>{_()};return Me(()=>{xe(()=>{m()})}),Ue(()=>{T()}),{showScrollToBottom:Ne(t),isAutoScrollEnabled:Ne(e),scrollToBottom:a,autoScrollToBottom:y,forceScrollToBottom:i,scrollToMessage:c,isNearBottom:l,checkScrollPosition:r,getScrollInfo:h,addScrollListener:k,removeScrollListener:_,initializeScrollBehavior:m,cleanupScrollBehavior:T}}const Ha={class:"chat-container"},Va=["data-message-id"],ja={class:"user-content"},za={class:"message-text"},Wa={key:0,class:"attachments"},Ga={class:"attachment-name"},Ka={class:"attachment-size"},Ja={class:"message-timestamp"},Xa={key:0,class:"message-status error"},Ya={class:"status-text"},Qa={key:1,class:"assistant-message"},Za={key:0,class:"loading-message"},el={class:"loading-content"},tl=["title"],sl=Te({__name:"ChatContainer",emits:["step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=et(),{messages:l,isLoading:r,streamingMessageId:p,updateMessage:y,startStreaming:i,findMessage:c}=a,h=A(null),{scrollToBottom:k,autoScrollToBottom:_,showScrollToBottom:m}=Ba(h),{getMessageClasses:T,formatTimestamp:$,formatFileSize:v}=Ts(),N=S=>p.value===S,G=ae(()=>l.value),U=S=>{const x=S.target;if(x.classList.contains("md-copy-btn")){const E=x.getAttribute("data-raw");if(E){const q=decodeURIComponent(E);navigator.clipboard.writeText(q).then(()=>{x.textContent=s("chat.copied"),setTimeout(()=>{x.textContent=s("chat.copy")},1e3)})}}},b=async S=>{const x=c(S);if(x)try{const E=x.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(E)}catch(E){console.error("Failed to copy message:",E)}},P=S=>{const x=c(S);x&&x.type==="assistant"&&(y(S,{content:""}),i(S),console.warn("[ChatContainer] Regenerate not yet implemented"))},F=S=>{c(S)&&(y(S,{content:""}),i(S),console.warn("[ChatContainer] Retry not yet implemented"))},L=S=>{console.log("[ChatContainer] Step selected:",S),e("step-selected",S)},B=(S,x)=>{console.log("[ChatContainer] User input submitted:",x,"for message:",S.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Me(()=>{ye(l,()=>{xe(()=>{_()})},{deep:!0})}),Ue(()=>{}),(S,x)=>(f(),g("div",Ha,[o("div",{class:"messages",ref_key:"messagesRef",ref:h,onClick:U},[(f(!0),g(fe,null,ge(G.value,E=>(f(),g("div",{key:E.id,class:ve(["chat-message",[d(T)(E),{streaming:N(E.id)}]])},[E.type==="user"?(f(),g("div",{key:0,class:"user-message","data-message-id":E.id},[o("div",ja,[o("div",za,u(E.content),1),E.attachments?.length?(f(),g("div",Wa,[(f(!0),g(fe,null,ge(E.attachments,(q,O)=>(f(),g("div",{key:O,class:"attachment-item"},[R(d(D),{icon:"carbon:document",class:"attachment-icon"}),o("span",Ga,u(q.name),1),o("span",Ka,u(d(v)(q.size)),1)]))),128))])):H("",!0),o("div",Ja,u(d($)(E.timestamp)),1)]),E.error?(f(),g("div",Xa,[R(d(D),{icon:"carbon:warning",class:"status-icon"}),o("span",Ya,u(E.error),1)])):H("",!0)],8,Va)):E.type==="assistant"?(f(),g("div",Qa,[E.planExecution?(f(),$e(zn,{key:0,"plan-execution":E.planExecution,"step-actions":E.stepActions||[],"generic-input":E.genericInput||"",onStepSelected:L},null,8,["plan-execution","step-actions","generic-input"])):H("",!0),E.content||E.error||N(E.id)||E.planExecution?.userInputWaitState?.waiting?(f(),$e(La,bs({key:1,content:E.content||"","is-streaming":N(E.id)||!1},{ref_for:!0},{...E.error?{error:E.error}:{},...E.planExecution?.userInputWaitState?{userInputWaitState:E.planExecution.userInputWaitState}:{},...E.planExecution?.currentPlanId?{planId:E.planExecution.currentPlanId}:{}},{timestamp:E.timestamp,"generic-input":E.genericInput||"",onCopy:()=>b(E.id),onRegenerate:()=>P(E.id),onRetry:()=>F(E.id),onUserInputSubmitted:q=>B(E,q)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):H("",!0)])):H("",!0)],2))),128)),d(r)?(f(),g("div",Za,[o("div",el,[R(d(D),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,u(S.$t("chat.processing")),1)])])):H("",!0)],512),R(_t,{name:"scroll-button"},{default:ze(()=>[d(m)?(f(),g("button",{key:0,class:"scroll-to-bottom",onClick:x[0]||(x[0]=()=>d(k)()),title:S.$t("chat.scrollToBottom")},[R(d(D),{icon:"carbon:chevron-down"})],8,tl)):H("",!0)]),_:1})]))}}),ol=Ee(sl,[["__scopeId","data-v-b590114c"]]);class Zt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const nl={class:"file-upload-component"},al=["accept"],ll={key:0},rl={key:1},il={key:0,class:"files-list"},cl={class:"file-name"},ul={class:"file-size"},dl=["onClick","title"],pl={key:0,class:"upload-progress"},ml=Te({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.mhtml,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=n,l=e,r=A(),p=A([]),y=A(!1),i=A(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],i.value=null,l("upload-key-changed",null)};Ue(()=>{c()}),ye(()=>p.value,$=>{l("files-removed",$)},{deep:!0});const h=()=>{a.disabled||r.value&&r.value.click()},k=async $=>{const v=$.target,N=v.files;if(!N||N.length===0)return;const G=Array.from(N);console.log("[FileUpload] Selected files for upload:",G.map(U=>U.name)),await _(G),v.value=""},_=async $=>{if($.length!==0){y.value=!0,l("upload-started");try{const v=await Zt.uploadFiles($);v.success&&(!i.value&&v.uploadKey?(i.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",i.value),p.value=v.uploadedFiles):i.value?(console.log("[FileUpload] Using existing uploadKey:",i.value),p.value=[...p.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=v.uploadedFiles),v.uploadKey&&(i.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",i.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,i.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{y.value=!1}}},m=async $=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",$.originalName,"from uploadKey:",i),i.value){const v=await Zt.deleteFile(i.value,$.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}p.value=p.value.filter(v=>v.originalName!==$.originalName),p.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),i.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",p.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},T=$=>{if($===0)return"0 Bytes";const v=1024,N=["Bytes","KB","MB","GB"],G=Math.floor(Math.log($)/Math.log(v));return parseFloat(($/Math.pow(v,G)).toFixed(2))+" "+N[G]};return t({uploadedFiles:p,uploadKey:i,resetSession:c,uploadFiles:_,removeFile:m,isUploading:y}),($,v)=>(f(),g("div",nl,[o("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:k,accept:$.acceptedFileTypes||""},null,40,al),o("div",{class:ve(["uploaded-files",{"has-files":p.value.length>0}])},[o("div",{class:"files-header",onClick:h},[R(d(D),{icon:"carbon:attachment"}),p.value.length===0?(f(),g("span",ll,u(d(s)("input.attachFile")),1)):(f(),g("span",rl,u(d(s)("input.attachedFiles"))+" ("+u(p.value.length)+")",1))]),p.value.length>0?(f(),g("div",il,[(f(!0),g(fe,null,ge(p.value,N=>(f(),g("div",{key:N.originalName,class:"file-item"},[R(d(D),{icon:"carbon:document",class:"file-icon"}),o("span",cl,u(N.originalName),1),o("span",ul,"("+u(T(N.size))+")",1),o("button",{onClick:G=>m(N),class:"remove-btn",title:d(s)("input.removeFile")},[R(d(D),{icon:"carbon:close"})],8,dl)]))),128))])):H("",!0)],2),y.value?(f(),g("div",pl,[R(d(D),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,u(d(s)("input.uploading")),1)])):H("",!0)]))}}),Es=Ee(ml,[["__scopeId","data-v-866ef77f"]]),fl={class:"input-area"},hl={class:"input-container"},vl={class:"input-row-first"},gl=["placeholder","disabled"],yl={class:"input-row-second"},bl=["title","disabled"],_l={value:""},wl=["value"],$l=["disabled","title"],Sl=["title"],es="chatInputHistory",ts=20,Pl=Te({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(n,{expose:t}){const{t:e}=De(),s=yt(),a=Ge(),l=et(),r=Ze(),p=ae(()=>s.hasRunningTask()),y=n,i=A(),c=A(),h=A(""),k=ae(()=>e("input.placeholder")),_=A(null),m=ae(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:_.value?_.value:k.value),T=A([]),$=A(null),v=A(""),N=A([]),G=A(!1),U=A(!1),b=A([]),P=A(-1),F=A(""),L=ae(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),B=async()=>{G.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const I=a.getAllCoordinatorToolsFromTemplates(),W=[];for(const ne of I)if(ne.enableInternalToolcall)try{const oe=JSON.parse(ne.inputSchema||"[]");if(Array.isArray(oe)&&oe.length===1){const be=oe[0];W.push({value:ne.planTemplateId,label:`${ne.toolName} (${be.name})`,toolName:ne.toolName,planTemplateId:ne.planTemplateId,paramName:be.name})}}catch(oe){console.warn("[InputArea] Failed to parse inputSchema for tool:",ne.toolName,oe)}N.value=W,console.log("[InputArea] Loaded",W.length,"inner tools with single parameter");const Z=localStorage.getItem("inputAreaSelectedTool");if(Z){if(W.length>0)if(W.some(oe=>oe.value===Z)){U.value=!0;try{v.value=Z,console.log("[InputArea] Restored selected tool from localStorage:",Z)}finally{U.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),v.value===Z&&(v.value="");else if(v.value!==Z){U.value=!0;try{v.value=Z,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",Z)}finally{U.value=!1}}}}catch(I){console.error("[InputArea] Failed to load inner tools:",I),N.value=[]}finally{G.value=!1}},S=ae(()=>N.value.length>0?N.value.map(I=>({value:I.value,label:I.label})):y.selectionOptions);ye(v,I=>{U.value||localStorage.setItem("inputAreaSelectedTool",I||"")});const x=()=>{try{const I=localStorage.getItem(es);I&&(b.value=JSON.parse(I))}catch(I){console.error("[InputArea] Failed to load history:",I),b.value=[]}},E=()=>{try{localStorage.setItem(es,JSON.stringify(b.value))}catch(I){console.error("[InputArea] Failed to save history:",I)}},q=I=>{if(!I.trim())return;const W=b.value.indexOf(I);W!==-1&&b.value.splice(W,1),b.value.unshift(I),b.value.length>ts&&(b.value=b.value.slice(0,ts)),E()},O=I=>{if(b.value.length===0)return;P.value===-1&&(F.value=h.value);let W=P.value+I;W<-1?W=-1:W>=b.value.length&&(W=b.value.length-1),P.value=W,P.value===-1?(h.value=F.value,F.value=""):h.value=b.value[P.value],j()};ye(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),B()},{deep:!0}),Me(()=>{B(),x(),ye(()=>r.planExecutionRecords,I=>{const W=Array.from(I.entries());if(W.length===0)return;W.some(([,ne])=>ne&&!ne.completed&&ne.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),V())},{deep:!0}),ye(()=>s.taskToInput,I=>{I?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",I),xe(()=>{te(I.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const V=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),c.value?.resetSession()};Ue(()=>{V()});const ee=(I,W)=>{T.value=I.map(Z=>Z.originalName),$.value=W,console.log("[InputArea] Files uploaded:",I.length,"uploadKey:",W),T.value.length>0&&(_.value=e("input.filesAttached",{count:T.value.length}))},Se=I=>{T.value=I.map(W=>W.originalName),console.log("[InputArea] Files removed, remaining:",I.length),T.value.length===0?_.value=null:_.value=e("input.filesAttached",{count:T.value.length})},X=I=>{$.value=I,console.log("[InputArea] Upload key changed:",I)},ce=()=>{console.log("[InputArea] Upload started")},ke=()=>{console.log("[InputArea] Upload completed")},ue=I=>{console.error("[InputArea] Upload error:",I)},M=ae(()=>l.isLoading.value),j=()=>{xe(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},K=I=>{if(I.key==="Enter"&&(I.ctrlKey||I.metaKey)){I.preventDefault(),Q();return}const W=L.value?I.altKey:I.ctrlKey;if(I.key==="ArrowUp"&&W){I.preventDefault(),O(1);return}if(I.key==="ArrowDown"&&W){I.preventDefault(),O(-1);return}P.value!==-1&&I.key.length===1&&!I.ctrlKey&&!I.metaKey&&!I.altKey&&(P.value=-1,F.value="")},Q=async()=>{if(!h.value.trim()||M.value)return;const I=h.value.trim();q(I),P.value=-1,F.value="";const W={input:I,memoryId:Ie.selectMemoryId,uploadedFiles:T.value};if($.value?(W.uploadKey=$.value,console.log("[InputArea] Including uploadKey in message:",$.value)):console.log("[InputArea] No uploadKey available for message"),v.value){const Z=N.value.find(ne=>ne.value===v.value);if(Z){const ne=W;ne.toolName=Z.planTemplateId,ne.replacementParams={[Z.paramName]:I},console.log("[InputArea] Sending message with tool:",Z.toolName)}}try{await l.sendMessage(W)}catch(Z){const ne=Z instanceof Error?Z.message:String(Z);console.error("[InputArea] Send message failed:",ne)}le()},se=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},le=()=>{h.value="",j()},me=(I,W)=>{l.updateInputState(I,W)},te=I=>{h.value=I,j()},z=()=>h.value.trim();return ye(()=>y.initialValue,I=>{I.trim()&&(h.value=I,j())},{immediate:!0}),t({clearInput:le,updateState:me,getQuery:z,focus:()=>i.value?.focus(),get uploadedFiles(){return c.value?.uploadedFiles?.map(I=>I.originalName)||[]},get uploadKey(){return c.value?.uploadKey||null}}),(I,W)=>(f(),g("div",fl,[R(Es,{ref_key:"fileUploadRef",ref:c,disabled:M.value,onFilesUploaded:ee,onFilesRemoved:Se,onUploadKeyChanged:X,onUploadStarted:ce,onUploadCompleted:ke,onUploadError:ue},null,8,["disabled"]),o("div",hl,[o("div",vl,[_e(o("textarea",{"onUpdate:modelValue":W[0]||(W[0]=Z=>h.value=Z),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:M.value,onKeydown:K,onInput:j},null,40,gl),[[Ce,h.value]])]),o("div",yl,[_e(o("select",{"onUpdate:modelValue":W[1]||(W[1]=Z=>v.value=Z),class:"selection-input",title:I.$t("input.selectionTitle"),disabled:G.value||M.value},[o("option",_l,u(I.$t("input.defaultFuncAgent")),1),(f(!0),g(fe,null,ge(S.value,Z=>(f(),g("option",{key:Z.value,value:Z.value},u(Z.label),9,wl))),128))],8,bl),[[Bt,v.value]]),p.value?(f(),g("button",{key:1,class:"send-button stop-button",onClick:se,title:I.$t("input.stop")},[R(d(D),{icon:"carbon:stop-filled"}),pe(" "+u(I.$t("input.stop")),1)],8,Sl)):(f(),g("button",{key:0,class:"send-button",disabled:!h.value.trim()||M.value,onClick:Q,title:I.$t("input.send")},[R(d(D),{icon:"carbon:send-alt"}),pe(" "+u(I.$t("input.send")),1)],8,$l))])])]))}}),Tl=Ee(Pl,[["__scopeId","data-v-63823e52"]]);class ft{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const El={key:0,class:"app-container"},kl={class:"app-content"},Cl={class:"header"},Il={class:"relative"},Rl={class:"title-edit-group"},xl={id:"main-title",class:"main-title"},Al={key:0,id:"title-edit-container",class:"title-edit-container"},Fl={class:"search-bar"},Ml={class:"search-container"},Dl=["placeholder"],Nl={class:"message-list",id:"message-list"},Ul={class:"message-header"},Ll={class:"message-content"},Ol={class:"sender-info"},ql=["onClick"],Bl={class:"sender-name"},Hl={class:"action-buttons"},Vl=["onClick"],jl={class:"action-buttons"},zl=["onClick"],Wl={class:"message-meta"},Gl={class:"message-id"},Kl={class:"meta-right"},Jl={key:0,class:"unread-count"},Xl={class:"message-time"},Yl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Zl={class:"bubble-avatar"},er={class:"bubble-content"},tr={class:"bubble-text"},sr={key:0,class:"empty-state"},or={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr=["placeholder"],rr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},ir={class:"modal-footer"},cr={class:"modal-content"},ur={class:"modal-header"},dr={class:"modal-title"},pr={class:"state-text",id:"delete-message"},mr={class:"modal-footer"},fr=Te({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(n,{emit:t}){const e=A(!1),s=A(""),a=A([]),l=A([]),r=A(!1),p=A(null),y=A(""),i=A(!1),c=A(null),h=new Map,k=t,_=L=>{L.key==="Escape"&&(i.value?P():r.value&&N())};Me(()=>{Ie.setLoadMessages(m),document.addEventListener("keydown",_)}),Ue(()=>{document.removeEventListener("keydown",_)});const m=async()=>{try{const L=await ft.getMemories();a.value=L.map(B=>({...B,expanded:h.has(B.conversation_id)?h.get(B.conversation_id):!1})),l.value=[...a.value],v()}catch(L){console.error("error:",L),a.value=[],l.value=[]}},T=L=>{Ie.selectMemory(L),k("memory-selected")},$=L=>{const B=typeof L=="string"?parseInt(L,10):L;return isNaN(B)||B<=0?"--":new Date(B.toString().length===13?B:B*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const L=s.value.toLowerCase().trim();if(!L){l.value=[...a.value];return}l.value=a.value.filter(B=>{const S=B.memory_name.toLowerCase().includes(L),x=B.conversation_id.toLowerCase().includes(L),E=B.messages?.some(q=>q.text.toLowerCase().includes(L))??!1;return S||x||E})},N=()=>{r.value=!1,p.value=null},G=async()=>{if(!p.value)return;const L=y.value.trim()||"unknow name",B=a.value.findIndex(S=>S.conversation_id===p.value);if(B!==-1){const S=a.value[B];try{const x=await ft.updateMemory(S.conversation_id,L);x.messages||(x.messages=[]),a.value[B]={...x,expanded:S.expanded},v(),r.value=!1}catch(x){console.error("error:",x)}}},U=L=>{const B=a.value.find(S=>S.conversation_id===L);if(B){B.expanded=!B.expanded,h.set(L,B.expanded);const S=l.value.findIndex(x=>x.conversation_id===L);S!==-1&&(l.value[S]={...B})}},b=L=>{c.value=L,i.value=!0},P=()=>{i.value=!1,c.value=null},F=async()=>{if(c.value)try{await ft.deleteMemory(c.value),a.value=a.value.filter(L=>L.conversation_id!==c.value),v(),a.value.length===0&&Ie.clearMemoryId(),i.value=!1,c.value=null}catch(L){console.error("error:",L)}};return(L,B)=>(f(),$e(ws,{to:"body"},[R(_t,{name:"modal"},{default:ze(()=>[d(Ie).isCollapsed?(f(),g("div",El,[o("div",kl,[o("div",Cl,[o("div",Il,[o("div",Rl,[o("h1",xl,[o("span",null,u(L.$t("memory.title")),1)])]),e.value?(f(),g("div",Al)):H("",!0)]),o("button",{class:"close-btn",onClick:B[0]||(B[0]=S=>d(Ie).toggleSidebar())},[R(d(D),{icon:"carbon:close"})])]),o("div",Fl,[o("div",Ml,[R(d(D),{class:"search-container-icon",icon:"carbon:search"}),_e(o("input",{type:"text",placeholder:L.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":B[1]||(B[1]=S=>s.value=S),onInput:v},null,40,Dl),[[Ce,s.value]])])]),o("div",Nl,[o("div",null,[(f(!0),g(fe,null,ge(l.value,S=>(f(),g("div",{class:ve(["message-item",{expanded:S.expanded}]),key:S.conversation_id},[o("div",Ul,[o("div",Ll,[o("div",Ol,[o("div",{class:"sender-div",onClick:we(x=>T(S.conversation_id),["stop"])},[o("h3",Bl,u(S.memory_name),1)],8,ql),o("div",Hl,[o("button",{class:"delete-btn",onClick:we(x=>U(S.conversation_id),["stop"])},[R(d(D),{id:"toggle-"+S.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Vl)]),o("div",jl,[o("button",{class:"delete-btn",onClick:we(x=>b(S.conversation_id),["stop"])},[R(d(D),{icon:"carbon:delete"})],8,zl)])]),o("div",Wl,[o("span",Gl,"ID: "+u(S.conversation_id),1),o("div",Kl,[S.messages&&S.messages.length>0?(f(),g("span",Jl,u(S.messages.length)+" "+u(L.$t("memory.size")),1)):H("",!0),o("span",Xl,u($(S.create_time)),1)])])])]),S.expanded?(f(),g("div",{key:0,id:"content-"+S.conversation_id,class:"expanded-content"},[o("div",Ql,[(f(!0),g(fe,null,ge(S.messages,(x,E)=>(f(),g("div",{class:"message-bubble",key:E},[o("div",Zl,u(x.messageType),1),o("div",er,[o("p",tr,u(x.text),1)])]))),128))])],8,Yl)):H("",!0)],2))),128))]),l.value.length===0&&s.value?(f(),g("div",sr,B[3]||(B[3]=[o("p",{class:"state-text"},"none message",-1)]))):H("",!0)]),r.value?(f(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:we(N,["self"])},[o("div",or,[o("div",nr,[o("h3",ar,u(L.$t("memory.changeName")),1),_e(o("input",{type:"text","onUpdate:modelValue":B[2]||(B[2]=S=>y.value=S),class:"edit-input",placeholder:L.$t("memory.newNamePlaceholder")},null,8,lr),[[Ce,y.value]]),o("span",rr,u(y.value.length),1)]),o("div",ir,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:N},u(L.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:G},u(L.$t("memory.save")),1)])])])):H("",!0),i.value?(f(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:we(P,["self"])},[o("div",cr,[o("div",ur,[o("h3",dr,u(L.$t("memory.deleteHint")),1),o("p",pr,u(L.$t("memory.deleteHintPrefix"))+" "+u(c.value)+" "+u(L.$t("memory.deleteHintSuffix")),1)]),o("div",mr,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:P},u(L.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:F},u(L.$t("memory.delete")),1)])])])):H("",!0)])])):H("",!0)]),_:1})]))}}),hr=Ee(fr,[["__scopeId","data-v-16358835"]]);class Xe{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),p=document.createElement("a");p.href=r,p.download=s??e.split("/").pop()??"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(r),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const vr={class:"file-tree-node"},gr={class:"node-icon"},yr={class:"node-name"},br={key:1,class:"file-size"},_r={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=Te({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:t}){const e=n,s=t,a=A(e.level===0),l=A(!1),r=A(!1),p=A({}),y=()=>{e.node.type==="directory"&&(a.value=!a.value)},i=()=>{e.node.type==="directory"?y():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),_()},h=()=>{s("download-file",e.node),_()},k=v=>{v.preventDefault(),r.value=!0,p.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",_)},0)},_=()=>{r.value=!1,document.removeEventListener("click",_)},m=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(v){console.error("Failed to copy path:",v)}_()},T=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Xe.getFileIcon(e.node),$=v=>{if(v===0)return"0 B";const N=1024,G=["B","KB","MB","GB"],U=Math.floor(Math.log(v)/Math.log(N));return parseFloat((v/Math.pow(N,U)).toFixed(1))+" "+G[U]};return Ue(()=>{document.removeEventListener("click",_)}),(v,N)=>{const G=ys("FileTreeNode",!0);return f(),g("div",vr,[o("div",{class:ve(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Ye({paddingLeft:`${v.level*16+12}px`}),onClick:i,onContextmenu:we(k,["prevent"])},[v.node.type==="directory"?(f(),g("div",{key:0,class:"expand-icon",onClick:we(y,["stop"])},[R(d(D),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):H("",!0),o("div",gr,[R(d(D),{icon:T()},null,8,["icon"])]),o("span",yr,u(v.node.name),1),v.node.type==="file"?(f(),g("span",br,u($(v.node.size)),1)):H("",!0),l.value?(f(),g("div",_r,[v.node.type==="file"?(f(),g("button",{key:0,onClick:N[0]||(N[0]=we(U=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[R(d(D),{icon:"carbon:download"})])):H("",!0)])):H("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(f(),g("div",wr,[(f(!0),g(fe,null,ge(v.node.children,U=>(f(),$e(G,{key:U.path,node:U,level:v.level+1,onFileSelected:N[1]||(N[1]=b=>v.$emit("file-selected",b)),onDownloadFile:N[2]||(N[2]=b=>v.$emit("download-file",b))},null,8,["node","level"]))),128))])):H("",!0),r.value?(f(),g("div",{key:1,class:"context-menu",style:Ye(p.value),onClick:N[3]||(N[3]=we(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:c},[R(d(D),{icon:"carbon:view"}),N[4]||(N[4]=o("span",null,"Open",-1))]),v.node.type==="file"?(f(),g("div",{key:0,class:"context-menu-item",onClick:h},[R(d(D),{icon:"carbon:download"}),N[5]||(N[5]=o("span",null,"Download",-1))])):H("",!0),N[7]||(N[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:m},[R(d(D),{icon:"carbon:copy"}),N[6]||(N[6]=o("span",null,"Copy Path",-1))])],4)):H("",!0)])}}}),Sr=Ee($r,[["__scopeId","data-v-3fc455d1"]]),Pr={class:"file-browser"},Tr={class:"file-browser-header"},Er={class:"header-actions"},kr=["disabled","title"],Cr={class:"file-browser-content"},Ir={class:"file-tree-panel"},Rr={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Ar={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Mr={class:"tips"},Dr=["disabled"],Nr={key:1,class:"actual-error"},Ur={key:2,class:"empty-state"},Lr={key:3,class:"file-tree"},Or={key:0,class:"file-content-panel"},qr={class:"file-content-header"},Br={class:"file-info"},Hr={class:"file-name"},Vr={class:"file-size"},jr={class:"file-actions"},zr=["title"],Wr=["title"],Gr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Xr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Qr={key:1,class:"binary-content"},Zr=Te({name:"FileBrowser",__name:"index",props:{planId:{}},setup(n){const t=n,{t:e}=De(),s=A(!1),a=A(null),l=A(null),r=A(null),p=A(null),y=A(!1),i=A(null),c=A(null),h=ae(()=>!p.value||!r.value?!1:Xe.isTextFile(p.value.mimeType,r.value.name)),k=ae(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),_=()=>{c.value&&(clearTimeout(c.value),c.value=null)},m=()=>{_(),c.value=window.setTimeout(()=>{k.value&&T()},5e3)},T=async()=>{if(t.planId){s.value=!0,a.value=null,_();try{l.value=await Xe.getFileTree(t.planId)}catch(b){a.value=b instanceof Error?b.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",b);const P=b instanceof Error?b.message:"";(P.includes("Plan directory not found")||P.includes("not found"))&&m()}finally{s.value=!1}}},$=async b=>{if(b.type!=="directory"){r.value=b,p.value=null,y.value=!0,i.value=null;try{p.value=await Xe.getFileContent(t.planId,b.path)}catch(P){i.value=P instanceof Error?P.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",P)}finally{y.value=!1}}},v=async b=>{try{await Xe.downloadFile(t.planId,b.path,b.name)}catch(P){console.error("Failed to download file:",P)}},N=()=>{r.value=null,p.value=null,i.value=null},G=b=>Xe.getFileIcon(b),U=b=>{if(b===0)return"0 B";const P=1024,F=["B","KB","MB","GB"],L=Math.floor(Math.log(b)/Math.log(P));return parseFloat((b/Math.pow(P,L)).toFixed(1))+" "+F[L]};return ye(()=>t.planId,b=>{b&&(r.value=null,p.value=null,T())},{immediate:!0}),Me(()=>{t.planId&&T()}),Ue(()=>{_()}),(b,P)=>(f(),g("div",Pr,[o("div",Tr,[o("h3",null,u(b.$t("fileBrowser.title")),1),o("div",Er,[o("button",{class:"refresh-btn",onClick:T,disabled:s.value,title:b.$t("fileBrowser.refresh")},[R(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kr)])]),o("div",Cr,[o("div",Ir,[s.value?(f(),g("div",Rr,[R(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(b.$t("fileBrowser.loading")),1)])):a.value?(f(),g("div",xr,[k.value?(f(),g("div",Ar,[R(d(D),{icon:"carbon:time",class:"rotating"}),o("div",Fr,[o("h3",null,u(b.$t("fileBrowser.waitingForGeneration")),1),o("p",null,u(b.$t("fileBrowser.planExecuting")),1),o("div",Mr,[R(d(D),{icon:"carbon:information"}),o("span",null,u(b.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:T,class:"retry-btn",disabled:s.value},[R(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value})},null,8,["class"]),pe(" "+u(s.value?b.$t("fileBrowser.checking"):b.$t("fileBrowser.checkNow")),1)],8,Dr)])):(f(),g("div",Nr,[R(d(D),{icon:"carbon:warning"}),o("span",null,u(a.value),1),o("button",{onClick:T,class:"retry-btn"},u(b.$t("fileBrowser.retry")),1)]))])):l.value?(f(),g("div",Lr,[R(Sr,{node:l.value,level:0,onFileSelected:$,onDownloadFile:v},null,8,["node"])])):(f(),g("div",Ur,[R(d(D),{icon:"carbon:folder-off"}),o("span",null,u(b.$t("fileBrowser.noFiles")),1)]))]),r.value?(f(),g("div",Or,[o("div",qr,[o("div",Br,[R(d(D),{icon:G(r.value)},null,8,["icon"]),o("span",Hr,u(r.value.name),1),o("span",Vr,"("+u(U(r.value.size))+")",1)]),o("div",jr,[o("button",{onClick:P[0]||(P[0]=F=>v(r.value)),class:"download-btn",title:b.$t("fileBrowser.download")},[R(d(D),{icon:"carbon:download"})],8,zr),o("button",{onClick:N,class:"close-btn",title:b.$t("common.close")},[R(d(D),{icon:"carbon:close"})],8,Wr)])]),o("div",Gr,[y.value?(f(),g("div",Kr,[R(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(b.$t("fileBrowser.loadingContent")),1)])):i.value?(f(),g("div",Jr,[R(d(D),{icon:"carbon:warning"}),o("span",null,u(i.value),1)])):p.value?(f(),g("div",Xr,[h.value?(f(),g("div",Yr,[o("pre",null,[o("code",null,u(p.value.content),1)])])):(f(),g("div",Qr,[R(d(D),{icon:"carbon:document-unknown"}),o("p",null,u(b.$t("fileBrowser.binaryFile")),1),o("button",{onClick:P[1]||(P[1]=F=>v(r.value)),class:"download-btn-large"},[R(d(D),{icon:"carbon:download"}),pe(" "+u(b.$t("fileBrowser.downloadToView")),1)])]))])):H("",!0)])])):H("",!0)])]))}}),ei=Ee(Zr,[["__scopeId","data-v-a19b1e5b"]]);class ks{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}class Cs{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function ti(){const n=A([]),t=A(!1),e=A(null);return{availableTools:n,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await Cs.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),n.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",n.value=[]}finally{t.value=!1}}},reset:()=>{n.value=[],t.value=!1,e.value=null}}}let It=null;function at(){return It||(It=ti()),It}const si={class:"modal-form wide-modal"},oi={class:"form-section"},ni={class:"form-item"},ai=["placeholder"],li={class:"field-description"},ri={class:"form-section"},ii={class:"section-title"},ci={key:0,class:"params-help-text"},ui={class:"parameter-table"},di=["onUpdate:modelValue","placeholder","readonly"],pi=["onUpdate:modelValue","placeholder"],mi={class:"form-section"},fi={class:"service-publish-options"},hi={class:"internal-toolcall-publish-option"},vi={class:"checkbox-label"},gi={class:"checkbox-text"},yi={class:"checkbox-description"},bi={class:"http-publish-option"},_i={class:"checkbox-label"},wi={class:"checkbox-text"},$i={class:"checkbox-description"},Si={class:"button-container"},Pi=["disabled"],Ti=["disabled"],Ei=Te({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=Ge(),l=at(),r=n,p=e,y=ae({get:()=>r.modelValue,set:E=>p("update:modelValue",E)}),i=A(""),c=A(""),h=A(!1),k=A(!1),_=A(!1),m=A(!0),T=A({parameters:[],hasParameters:!1,requirements:""}),$=A(!1),v=He({userRequest:"",parameters:[]}),N=ae(()=>{const E=!!a.selectedTemplate.value?.toolConfig;return s(E?"mcpService.updateService":"mcpService.createService")}),G=ae(()=>!!a.selectedTemplate.value?.toolConfig),U=()=>{const E=a.selectedTemplate.value?.toolConfig;E?(v.userRequest=E.toolDescription||"",_.value=E.enableHttpService??!1,m.value=E.enableInternalToolcall??!0,E.inputSchema&&Array.isArray(E.inputSchema)&&E.inputSchema.length>0?v.parameters=E.inputSchema.map(q=>({name:q.name||"",description:q.description||""})):T.value.hasParameters||(v.parameters=[])):(v.userRequest="",_.value=!1,m.value=!0,T.value.hasParameters||(v.parameters=[]))},b=async()=>{const E=a.currentPlanTemplateId.value;if(!E){T.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[];return}$.value=!0;try{const q=await ks.getParameterRequirements(E);if(T.value=q,console.log("[PublishModal] Parameter requirements loaded:",q),q.hasParameters){const O=new Map;v.parameters.forEach(V=>{V.name&&O.set(V.name,V.description||"")}),v.parameters=q.parameters.map(V=>({name:V,description:O.get(V)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",v.parameters)}else v.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(q){console.error("[PublishModal] Failed to load parameter requirements:",q),q instanceof Error&&!q.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),T.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[]}finally{$.value=!1}},P=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",T.value.parameters),console.log("[PublishModal] Form parameters:",v.parameters);const E=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",E);const q=new Map;if(E.forEach(O=>{O.name&&q.set(O.name,O.description||"")}),T.value.hasParameters){const O=T.value.parameters.map(V=>{const X=v.parameters.find(ce=>ce.name===V)?.description||""||q.get(V)||"";return{name:V,description:X}});return console.log("[PublishModal] Merged parameters (from plan template):",O),O}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},F=(E,q)=>{q==="success"?(c.value=E,setTimeout(()=>{c.value=""},3e3)):q==="error"&&(i.value=E,setTimeout(()=>{i.value=""},5e3))},L=()=>{if(!v.userRequest.trim())return F(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return F(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return F(s("mcpService.toolNameRequiredError"),"error"),!1;if(!m.value&&!_.value)return F("Please select at least one service type","error"),!1;for(let O=0;O<v.parameters.length;O++){const V=v.parameters[O];if(V.name&&!V.description.trim())return F(`Parameter "${V.name}" description cannot be empty`,"error"),!1;if(V.description&&!V.name.trim())return F(`Parameter description "${V.description}" corresponding name cannot be empty`,"error"),!1}return!0},B=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",v),console.log("[PublishModal] Publish as HTTP service:",_.value),!L()){console.log("[PublishModal] Form validation failed");return}h.value=!0;try{const E=P();console.log("[PublishModal] Merged parameters:",E);const q=E.filter(ee=>ee.name.trim()).map(ee=>({name:ee.name.trim(),description:ee.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(v.userRequest.trim()),a.setEnableInternalToolcallWithGuard(m.value),a.setEnableHttpServiceWithGuard(_.value),a.setInputSchemaWithGuard(q),!await a.save())throw new Error("Failed to save plan template");const V=[];m.value&&V.push("Internal Method Call"),_.value&&V.push("HTTP Service"),V.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",V.join(", ")),F(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),p("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),F(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),p("published",null))}catch(E){console.error("[PublishModal] Failed to publish service:",E);const q=E instanceof Error?E.message:"Unknown error";F(s("mcpService.publishFailed")+": "+q,"error")}finally{h.value=!1}},S=async()=>{if(k.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const E=a.currentPlanTemplateId.value;if(!E){F(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}k.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",E),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),F(s("mcpService.deleteSuccess"),"success"),y.value=!1,p("published",null)}catch(q){console.error("[PublishModal] Failed to delete tool config:",q);const O=q instanceof Error?q.message:"Unknown error";F(s("mcpService.deleteFailed")+": "+O,"error")}finally{k.value=!1}};return ye(()=>r.modelValue,async()=>{y.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),U(),await b())}),ye(()=>a.currentPlanTemplateId.value,(E,q)=>{E&&E!==q&&(q&&E.startsWith("planTemplate-")?setTimeout(()=>{b()},1e3):b())}),Me(async()=>{y.value&&(console.log("[PublishModal] Initialize when component mounted"),U(),await b())}),t({loadParameterRequirements:b}),(E,q)=>(f(),g(fe,null,[R(Ss,{modelValue:y.value,"onUpdate:modelValue":q[3]||(q[3]=O=>y.value=O),title:N.value,onConfirm:B},{footer:ze(()=>[o("div",Si,[G.value?(f(),g("button",{key:0,class:"action-btn danger",onClick:S,disabled:k.value},[k.value?(f(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(f(),$e(d(D),{key:1,icon:"carbon:trash-can"})),pe(" "+u(k.value?d(s)("mcpService.deleting"):d(s)("mcpService.delete")),1)],8,Pi)):H("",!0),o("button",{class:"action-btn primary",onClick:B,disabled:h.value},[h.value?(f(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(f(),$e(d(D),{key:1,icon:"carbon:cloud-upload"})),pe(" "+u(h.value?d(s)("mcpService.publishing"):d(s)("mcpService.publishAsService")),1)],8,Ti)])]),default:ze(()=>[o("div",si,[o("div",oi,[o("div",ni,[o("label",null,u(d(s)("mcpService.toolDescriptionRequired")),1),_e(o("textarea",{"onUpdate:modelValue":q[0]||(q[0]=O=>v.userRequest=O),placeholder:d(s)("mcpService.toolDescriptionPlaceholder"),class:ve([{error:!v.userRequest||!v.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,ai),[[Ce,v.userRequest]]),o("div",li,u(d(s)("mcpService.toolDescriptionDescription")),1)])]),o("div",ri,[o("div",ii,u(d(s)("mcpService.parameterConfig")),1),T.value.hasParameters?(f(),g("div",ci,u(d(s)("sidebar.parameterRequirementsHelp")),1)):H("",!0),o("div",ui,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,u(d(s)("mcpService.parameterName")),1),o("th",null,u(d(s)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(f(!0),g(fe,null,ge(v.parameters,(O,V)=>(f(),g("tr",{key:V},[o("td",null,[_e(o("input",{type:"text","onUpdate:modelValue":ee=>O.name=ee,placeholder:d(s)("mcpService.parameterName"),class:ve(["parameter-input",{"readonly-input":T.value.hasParameters}]),readonly:T.value.hasParameters,required:""},null,10,di),[[Ce,O.name]])]),o("td",null,[_e(o("input",{type:"text","onUpdate:modelValue":ee=>O.description=ee,placeholder:d(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,pi),[[Ce,O.description]])])]))),128))])])])]),o("div",mi,[o("div",fi,[o("div",hi,[o("label",vi,[_e(o("input",{type:"checkbox","onUpdate:modelValue":q[1]||(q[1]=O=>m.value=O),class:"checkbox-input"},null,512),[[Dt,m.value]]),o("span",gi,u(d(s)("mcpService.publishAsInternalToolcall")),1)]),o("div",yi,u(d(s)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",bi,[o("label",_i,[_e(o("input",{type:"checkbox","onUpdate:modelValue":q[2]||(q[2]=O=>_.value=O),class:"checkbox-input"},null,512),[[Dt,_.value]]),o("span",wi,u(d(s)("mcpService.publishAsHttpService")),1)]),o("div",$i,u(d(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),i.value?(f(),g("div",{key:0,class:"error-toast",onClick:q[4]||(q[4]=O=>i.value="")},[R(d(D),{icon:"carbon:error"}),pe(" "+u(i.value),1)])):H("",!0),c.value?(f(),g("div",{key:1,class:"success-toast",onClick:q[5]||(q[5]=O=>c.value="")},[R(d(D),{icon:"carbon:checkmark"}),pe(" "+u(c.value),1)])):H("",!0)],64))}}),ki=Ee(Ei,[["__scopeId","data-v-235a4588"]]),Ci={class:"modal-header"},Ii={class:"modal-body"},Ri={class:"modal-footer"},xi=["disabled"],Ai=Te({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(n,{emit:t}){const e=t,s=A(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(p,y)=>p.modelValue?(f(),g("div",{key:0,class:"modal-overlay",onClick:a},[o("div",{class:"modal-content",onClick:y[0]||(y[0]=we(()=>{},["stop"]))},[o("div",Ci,[o("h3",null,u(p.$t("sidebar.saveConfirmationTitle")),1),o("button",{class:"close-btn",onClick:a},[R(d(D),{icon:"carbon:close",width:"16"})])]),o("div",Ii,[o("p",null,u(p.$t("sidebar.saveConfirmationMessage")),1)]),o("div",Ri,[o("button",{class:"btn btn-secondary",onClick:a},u(p.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(f(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):H("",!0),pe(" "+u(s.value?p.$t("sidebar.saving"):p.$t("common.save")),1)],8,xi),o("button",{class:"btn btn-danger",onClick:r},u(p.$t("sidebar.continueWithoutSave")),1)])])])):H("",!0)}}),Fi=Ee(Ai,[["__scopeId","data-v-4817656d"]]),Mi={class:"config-section"},Di={class:"section-header"},Ni={class:"execution-content"},Ui={class:"params-requirements-group"},Li={class:"params-help-text"},Oi={key:0,class:"parameter-fields"},qi={class:"parameter-label"},Bi=["onUpdate:modelValue","placeholder","onInput"],Hi={key:0,class:"parameter-error"},Vi={key:1,class:"validation-message"},ji=["disabled"],zi=["disabled"],Wi={key:1,class:"call-example-wrapper"},Gi={class:"call-example-header"},Ki={class:"call-example-title"},Ji={class:"call-example-description"},Xi={class:"internal-call-wrapper"},Yi={class:"call-info"},Qi={class:"call-method"},Zi={class:"call-endpoint"},ec={key:0,class:"call-endpoint"},tc={class:"call-description"},sc={class:"call-example"},oc={class:"example-code"},nc={key:2,class:"call-example-wrapper"},ac={class:"call-example-header"},lc={class:"call-example-title"},rc={class:"call-example-description"},ic={class:"http-api-urls-wrapper"},cc={class:"tab-container"},uc={class:"tab-header"},dc=["onClick"],pc={class:"tab-content"},mc={class:"http-api-url-display"},fc={class:"api-method"},hc={class:"api-endpoint"},vc={class:"api-description"},gc={key:0,class:"api-example"},yc={class:"example-code"},bc={key:3,class:"call-example-wrapper"},_c={class:"call-example-header"},wc={class:"call-example-title"},$c={class:"call-example-description"},Sc={class:"mcp-call-wrapper"},Pc={class:"call-info"},Tc={class:"call-method"},Ec={class:"call-endpoint"},kc={class:"call-description"},Cc={class:"call-example"},Ic={class:"example-code"},Rc=Te({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=wt(),a=Ge(),l=et(),r=Ze(),p=n,y=A(""),i=A(!1),c=A({parameters:[],hasParameters:!1,requirements:""}),h=A({}),k=A(!1),_=A("post-async"),m=A({}),T=A(!1),$=A(!1),v=A(null),N=ae(()=>a.getCoordinatorToolConfig()),G=A(),U=A([]),b=A(null),P=A(!1),F=A(null),L=ae(()=>{const z=a.selectedTemplate.value?.title||"my-tool",I=a.selectedTemplate.value?.serviceGroup||"research",W=a.selectedTemplate.value?.planTemplateId||"template-456",Z={};c.value.hasParameters&&c.value.parameters.length>0?c.value.parameters.forEach(be=>{Z[be]=h.value[be]||"test"}):Z.rawParam="test";const ne=v.value||e("sidebar.defaultPlanId"),oe=v.value||e("sidebar.defaultPlanIdDetails");return[{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "${z}",
  "serviceGroup": "${I}",
  "replacementParams": ${JSON.stringify(Z,null,2)},
  "uploadedFiles": []
}

Note: serviceGroup is optional. Use it to disambiguate tools with the same name in different service groups.

Response: {
  "planId": "${ne}",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "${z}",
  "planTemplateId": "${W}"
}

# Check execution status and get detailed results:
GET /api/executor/details/${oe}
Response: {
  "currentPlanId": "${ne}",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "${z}",
  "serviceGroup": "${I}",
  "replacementParams": ${JSON.stringify(Z,null,2)},
  "uploadedFiles": []
}

Note: serviceGroup is optional. Use it to disambiguate tools with the same name in different service groups.

Response: {
  "status": "completed",
  "result": "Execution result here"
}`}]}),B=ae(()=>{const z=a.selectedTemplate.value?.toolConfig;return z?.enableInternalToolcall??z?.enableHttpService??z?.enableMcpService??!1}),S=ae(()=>B.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),x=ae(()=>l.isLoading.value),E=ae(()=>{if(x.value||p.isExecuting||$.value)return!1;const z=r.trackedPlanIds.value.size>0,W=Array.from(r.planExecutionRecords.entries()).some(([,Z])=>Z&&!Z.completed&&Z.status!=="failed");return z||W?!1:c.value.hasParameters?c.value.parameters.every(Z=>{const ne=h.value[Z];return typeof ne=="string"&&ne.trim()!==""}):!0}),q=(z,I)=>{U.value=z.map(W=>W.originalName),b.value=I,console.log("[ExecutionController] Files uploaded:",z.length,"uploadKey:",I)},O=z=>{U.value=z.map(I=>I.originalName),console.log("[ExecutionController] Files removed, remaining:",z.length)},V=z=>{b.value=z,console.log("[ExecutionController] Upload key changed:",z)},ee=()=>{console.log("[ExecutionController] Upload started")},Se=()=>{console.log("[ExecutionController] Upload completed")},X=z=>{console.error("[ExecutionController] Upload error:",z)},ce=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),p.isExecuting||l.isLoading.value||$.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",p.isExecuting,l.isLoading.value,$.value),s.error(e("sidebar.executionInProgress"));return}if(de.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!me()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value);return}const z=c.value.hasParameters&&Object.keys(h.value).length>0?h.value:void 0;F.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:z,uploadedFiles:U.value,uploadKey:b.value},P.value=!0;return}await ke()},ke=async()=>{if(p.isExecuting||l.isLoading.value||$.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if($.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!me()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value),$.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),$.value=!1;return}const z=a.getConfig(),I=a.selectedTemplate.value.planTemplateId||z.planTemplateId,W={title:z.title||a.selectedTemplate.value.title||"Execution Plan",steps:(z.steps||[]).map(Ke=>({stepRequirement:Ke.stepRequirement||"",agentName:Ke.agentName||"",modelName:Ke.modelName||null,selectedToolKeys:[],terminateColumns:Ke.terminateColumns||"",stepContent:""})),directResponse:z.directResponse||!1,...I&&{planTemplateId:I},...z.planType&&{planType:z.planType}},Z=a.selectedTemplate.value.title??z.title??"Execution Plan",ne=c.value.hasParameters&&Object.keys(h.value).length>0?h.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",ne),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(W,null,2));const oe={title:Z,planData:W,params:void 0,replacementParams:ne,uploadedFiles:U.value,uploadKey:b.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(oe,null,2));const be=await l.executePlan(oe);be.success?(console.log("[ExecutionController] âœ… Plan execution started successfully:",be.planId),be.planId&&(v.value=be.planId,console.log("[ExecutionController] ðŸ“ Tracked planId for API examples:",v.value))):(console.error("[ExecutionController] âŒ Plan execution failed:",be.error),s.error(be.error||e("sidebar.executeFailed")))}catch(z){console.error("[ExecutionController] âŒ Error executing plan:",z);const I=z instanceof Error?z.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+I),$.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),K(),console.log("[ExecutionController] âœ… Cleanup completed")}},ue=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const z=a.validate();if(!z.isValid){s.error(`Invalid format, please correct and save.
Errors: `+z.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const Z=a.generateJsonString().trim();a.updateVersionsAfterSave(Z);const ne=a.planVersions.value.length;de.hasTaskRequirementModified=!1,await new Promise(oe=>setTimeout(oe,500)),await Q(),await de.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ne})),await new Promise(oe=>setTimeout(oe,500)),F.value&&(await ke(),F.value=null)}catch(z){console.error("[ExecutionController] âŒ Failed to save before execute:",z);const I=z instanceof Error?z.message:e("sidebar.saveFailed");throw s.error(I),z}},M=async()=>{console.log("[ExecutionController] â© Continue without save requested"),F.value&&(await ke(),F.value=null)},j=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}i.value=!0},K=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),y.value="",h.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},Q=async()=>{await new Promise(z=>setTimeout(z,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(z=>z.stepRequirement).join(" ||| ")),await new Promise(z=>setTimeout(z,200)),await se()},se=async()=>{const z=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",z),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!z){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},h.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},h.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),k.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const I=await ks.getParameterRequirements(z);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(I,null,2)),c.value=I;const W={};I.parameters.forEach(Z=>{W[Z]=h.value[Z]||""}),h.value=W,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(h.value,null,2)),te()}catch(I){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",I),I instanceof Error&&!I.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},h.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(h.value,null,2))}finally{k.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},le=(z,I)=>{h.value[z]=I,m.value[z]&&delete m.value[z],te()},me=()=>{if(m.value={},T.value=!1,!c.value.hasParameters)return!0;let z=!1;return c.value.parameters.forEach(I=>{(h.value[I]?h.value[I].trim():"")||(m.value[I]=`${I} is required`,z=!0)}),T.value=z,!z},te=()=>{c.value.hasParameters?y.value=JSON.stringify(h.value,null,2):y.value=""};return ye(()=>a.currentPlanTemplateId.value,(z,I)=>{if(z&&z!==I){if($.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),I&&z.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),se()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),se())}}),ye(()=>de.hasTaskRequirementModified,async(z,I)=>{if(I===!0&&z===!1&&a.currentPlanTemplateId.value){if($.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(W=>setTimeout(W,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await Q()}}),_s(()=>{const z=r.planExecutionRecords,I=Array.from(z.entries()),W=r.trackedPlanIds.value.size>0,Z=I.some(([,oe])=>oe&&!oe.completed&&oe.status!=="failed");!(W||Z)&&$.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:W,hasRunningPlansInRecords:Z,trackedPlanIds:Array.from(r.trackedPlanIds.value),recordsCount:I.length}),$.value=!1)}),Me(()=>{se()}),t({executionParams:y,clearExecutionParams:K,loadParameterRequirements:se,refreshParameterRequirements:Q,fileUploadRef:G,uploadedFiles:U,uploadKey:b}),(z,I)=>(f(),g(fe,null,[o("div",Mi,[o("div",Di,[R(d(D),{icon:"carbon:play",width:"16"}),o("span",null,u(d(e)("sidebar.executionController")),1)]),o("div",Ni,[o("div",Ui,[o("label",null,u(d(e)("sidebar.parameterRequirements")),1),o("div",Li,u(d(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(f(),g("div",Oi,[(f(!0),g(fe,null,ge(c.value.parameters,W=>(f(),g("div",{key:W,class:"parameter-field"},[o("label",qi,[pe(u(W)+" ",1),I[2]||(I[2]=o("span",{class:"required"},"*",-1))]),_e(o("input",{"onUpdate:modelValue":Z=>h.value[W]=Z,class:ve(["parameter-input",{error:m.value[W]}]),placeholder:d(e)("sidebar.enterValueFor",{param:W}),onInput:Z=>le(W,Z.target.value),required:""},null,42,Bi),[[Ce,h.value[W]]]),m.value[W]?(f(),g("div",Hi,u(m.value[W]),1)):H("",!0)]))),128))])):H("",!0),c.value.hasParameters&&!E.value&&!p.isExecuting?(f(),g("div",Vi,[R(d(D),{icon:"carbon:warning",width:"14"}),pe(" "+u(d(e)("sidebar.fillAllRequiredParameters")),1)])):H("",!0)]),R(Es,{ref_key:"fileUploadRef",ref:G,disabled:p.isExecuting,onFilesUploaded:q,onFilesRemoved:O,onUploadKeyChanged:V,onUploadStarted:ee,onUploadCompleted:Se,onUploadError:X},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:ce,disabled:!E.value},[R(d(D),{icon:p.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ve({spinning:p.isExecuting})},null,8,["icon","class"]),pe(" "+u(p.isExecuting?d(e)("sidebar.executing"):d(e)("sidebar.executePlan")),1)],8,ji),N.value?(f(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:j,disabled:!d(a).currentPlanTemplateId.value},[R(d(D),{icon:"carbon:application",width:"16"}),pe(" "+u(S.value),1)],8,zi)):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(f(),g("div",Wi,[o("div",Gi,[o("h4",Ki,u(d(e)("sidebar.internalCall")),1),o("p",Ji,u(d(e)("sidebar.internalCallDescription")),1)]),o("div",Xi,[o("div",Yi,[o("div",Qi,u(d(e)("sidebar.internalMethodCall")),1),o("div",Zi,u(d(e)("sidebar.toolName"))+": "+u(d(a).selectedTemplate.value?.title||d(a).currentPlanTemplateId.value||""),1),d(a).selectedTemplate.value?.serviceGroup?(f(),g("div",ec,u(d(e)("sidebar.serviceGroup"))+": "+u(d(a).selectedTemplate.value.serviceGroup),1)):H("",!0),o("div",tc,u(d(e)("sidebar.internalCallUsage")),1),o("div",sc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",oc,u(d(e)("sidebar.internalCallExample")),1)])])])])):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableHttpService?(f(),g("div",nc,[o("div",ac,[o("h4",lc,u(d(e)("sidebar.httpCallExample")),1),o("p",rc,u(d(e)("sidebar.httpCallDescription")),1)]),o("div",ic,[o("div",cc,[o("div",uc,[(f(!0),g(fe,null,ge(L.value,W=>(f(),g("button",{key:W.id,class:ve(["tab-button",{active:_.value===W.id}]),onClick:Z=>_.value=W.id},u(W.label),11,dc))),128))]),o("div",pc,[(f(!0),g(fe,null,ge(L.value,W=>_e((f(),g("div",{key:W.id,class:"tab-panel"},[o("div",mc,[o("div",fc,u(W.method),1),o("div",hc,u(W.endpoint),1),o("div",vc,u(W.description),1),W.example?(f(),g("div",gc,[o("strong",null,u(d(e)("sidebar.example"))+":",1),o("pre",yc,u(W.example),1)])):H("",!0)])])),[[fo,_.value===W.id]])),128))])])])])):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableMcpService?(f(),g("div",bc,[o("div",_c,[o("h4",wc,u(d(e)("sidebar.mcpCall")),1),o("p",$c,u(d(e)("sidebar.mcpCallDescription")),1)]),o("div",Sc,[o("div",Pc,[o("div",Tc,u(d(e)("sidebar.mcpServiceCall")),1),o("div",Ec,u(d(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",kc,u(d(e)("sidebar.mcpCallUsage")),1),o("div",Cc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",Ic,u(d(e)("sidebar.mcpCallExample")),1)])])])])):H("",!0)])]),R(Fi,{modelValue:P.value,"onUpdate:modelValue":I[0]||(I[0]=W=>P.value=W),onSave:ue,onContinue:M},null,8,["modelValue"]),R(ki,{modelValue:i.value,"onUpdate:modelValue":I[1]||(I[1]=W=>i.value=W)},null,8,["modelValue"])],64))}}),xc=Ee(Rc,[["__scopeId","data-v-303a0c4d"]]);function Is(n,t){return function(){return n.apply(t,arguments)}}const{toString:Ac}=Object.prototype,{getPrototypeOf:Ht}=Object,{iterator:$t,toStringTag:Rs}=Symbol,St=(n=>t=>{const e=Ac.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Le=n=>(n=n.toLowerCase(),t=>St(t)===n),Pt=n=>t=>typeof t===n,{isArray:tt}=Array,Qe=Pt("undefined");function lt(n){return n!==null&&!Qe(n)&&n.constructor!==null&&!Qe(n.constructor)&&Ae(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const xs=Le("ArrayBuffer");function Fc(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&xs(n.buffer),t}const Mc=Pt("string"),Ae=Pt("function"),As=Pt("number"),rt=n=>n!==null&&typeof n=="object",Dc=n=>n===!0||n===!1,ht=n=>{if(St(n)!=="object")return!1;const t=Ht(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Rs in n)&&!($t in n)},Nc=n=>{if(!rt(n)||lt(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Uc=Le("Date"),Lc=Le("File"),Oc=Le("Blob"),qc=Le("FileList"),Bc=n=>rt(n)&&Ae(n.pipe),Hc=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||Ae(n.append)&&((t=St(n))==="formdata"||t==="object"&&Ae(n.toString)&&n.toString()==="[object FormData]"))},Vc=Le("URLSearchParams"),[jc,zc,Wc,Gc]=["ReadableStream","Request","Response","Headers"].map(Le),Kc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let s,a;if(typeof n!="object"&&(n=[n]),tt(n))for(s=0,a=n.length;s<a;s++)t.call(null,n[s],s,n);else{if(lt(n))return;const l=e?Object.getOwnPropertyNames(n):Object.keys(n),r=l.length;let p;for(s=0;s<r;s++)p=l[s],t.call(null,n[p],p,n)}}function Fs(n,t){if(lt(n))return null;t=t.toLowerCase();const e=Object.keys(n);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ms=n=>!Qe(n)&&n!==Ve;function Ut(){const{caseless:n,skipUndefined:t}=Ms(this)&&this||{},e={},s=(a,l)=>{const r=n&&Fs(e,l)||l;ht(e[r])&&ht(a)?e[r]=Ut(e[r],a):ht(a)?e[r]=Ut({},a):tt(a)?e[r]=a.slice():(!t||!Qe(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const Jc=(n,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&Ae(a)?n[l]=Is(a,e):n[l]=a},{allOwnKeys:s}),n),Xc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Yc=(n,t,e,s)=>{n.prototype=Object.create(t.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},Qc=(n,t,e,s)=>{let a,l,r;const p={};if(t=t||{},n==null)return t;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)r=a[l],(!s||s(r,n,t))&&!p[r]&&(t[r]=n[r],p[r]=!0);n=e!==!1&&Ht(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},Zc=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const s=n.indexOf(t,e);return s!==-1&&s===e},eu=n=>{if(!n)return null;if(tt(n))return n;let t=n.length;if(!As(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},tu=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&Ht(Uint8Array)),su=(n,t)=>{const s=(n&&n[$t]).call(n);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(n,l[0],l[1])}},ou=(n,t)=>{let e;const s=[];for(;(e=n.exec(t))!==null;)s.push(e);return s},nu=Le("HTMLFormElement"),au=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),ss=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),lu=Le("RegExp"),Ds=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),s={};it(e,(a,l)=>{let r;(r=t(a,l,n))!==!1&&(s[l]=r||a)}),Object.defineProperties(n,s)},ru=n=>{Ds(n,(t,e)=>{if(Ae(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=n[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},iu=(n,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return tt(n)?s(n):s(String(n).split(t)),e},cu=()=>{},uu=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function du(n){return!!(n&&Ae(n.append)&&n[Rs]==="FormData"&&n[$t])}const pu=n=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=tt(s)?[]:{};return it(s,(r,p)=>{const y=e(r,a+1);!Qe(y)&&(l[p]=y)}),t[a]=void 0,l}}return s};return e(n,0)},mu=Le("AsyncFunction"),fu=n=>n&&(rt(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),Ns=((n,t)=>n?setImmediate:t?((e,s)=>(Ve.addEventListener("message",({source:a,data:l})=>{a===Ve&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),Ve.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(Ve.postMessage)),hu=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||Ns,vu=n=>n!=null&&Ae(n[$t]),C={isArray:tt,isArrayBuffer:xs,isBuffer:lt,isFormData:Hc,isArrayBufferView:Fc,isString:Mc,isNumber:As,isBoolean:Dc,isObject:rt,isPlainObject:ht,isEmptyObject:Nc,isReadableStream:jc,isRequest:zc,isResponse:Wc,isHeaders:Gc,isUndefined:Qe,isDate:Uc,isFile:Lc,isBlob:Oc,isRegExp:lu,isFunction:Ae,isStream:Bc,isURLSearchParams:Vc,isTypedArray:tu,isFileList:qc,forEach:it,merge:Ut,extend:Jc,trim:Kc,stripBOM:Xc,inherits:Yc,toFlatObject:Qc,kindOf:St,kindOfTest:Le,endsWith:Zc,toArray:eu,forEachEntry:su,matchAll:ou,isHTMLForm:nu,hasOwnProperty:ss,hasOwnProp:ss,reduceDescriptors:Ds,freezeMethods:ru,toObjectSet:iu,toCamelCase:au,noop:cu,toFiniteNumber:uu,findKey:Fs,global:Ve,isContextDefined:Ms,isSpecCompliantForm:du,toJSONObject:pu,isAsyncFn:mu,isThenable:fu,setImmediate:Ns,asap:hu,isIterable:vu};function ie(n,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(ie,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const Us=ie.prototype,Ls={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Ls[n]={value:n}});Object.defineProperties(ie,Ls);Object.defineProperty(Us,"isAxiosError",{value:!0});ie.from=(n,t,e,s,a,l)=>{const r=Object.create(Us);C.toFlatObject(n,r,function(c){return c!==Error.prototype},i=>i!=="isAxiosError");const p=n&&n.message?n.message:"Error",y=t==null&&n?n.code:t;return ie.call(r,p,y,e,s,a),n&&r.cause==null&&Object.defineProperty(r,"cause",{value:n,configurable:!0}),r.name=n&&n.name||"Error",l&&Object.assign(r,l),r};const gu=null;function Lt(n){return C.isPlainObject(n)||C.isArray(n)}function Os(n){return C.endsWith(n,"[]")?n.slice(0,-2):n}function os(n,t,e){return n?n.concat(t).map(function(a,l){return a=Os(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function yu(n){return C.isArray(n)&&!n.some(Lt)}const bu=C.toFlatObject(C,{},null,function(t){return/^is[A-Z]/.test(t)});function Tt(n,t,e){if(!C.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=C.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,$){return!C.isUndefined($[T])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,r=e.indexes,y=(e.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(t);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function i(m){if(m===null)return"";if(C.isDate(m))return m.toISOString();if(C.isBoolean(m))return m.toString();if(!y&&C.isBlob(m))throw new ie("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(m)||C.isTypedArray(m)?y&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,T,$){let v=m;if(m&&!$&&typeof m=="object"){if(C.endsWith(T,"{}"))T=s?T:T.slice(0,-2),m=JSON.stringify(m);else if(C.isArray(m)&&yu(m)||(C.isFileList(m)||C.endsWith(T,"[]"))&&(v=C.toArray(m)))return T=Os(T),v.forEach(function(G,U){!(C.isUndefined(G)||G===null)&&t.append(r===!0?os([T],U,l):r===null?T:T+"[]",i(G))}),!1}return Lt(m)?!0:(t.append(os($,T,l),i(m)),!1)}const h=[],k=Object.assign(bu,{defaultVisitor:c,convertValue:i,isVisitable:Lt});function _(m,T){if(!C.isUndefined(m)){if(h.indexOf(m)!==-1)throw Error("Circular reference detected in "+T.join("."));h.push(m),C.forEach(m,function(v,N){(!(C.isUndefined(v)||v===null)&&a.call(t,v,C.isString(N)?N.trim():N,T,k))===!0&&_(v,T?T.concat(N):[N])}),h.pop()}}if(!C.isObject(n))throw new TypeError("data must be an object");return _(n),t}function ns(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Vt(n,t){this._pairs=[],n&&Tt(n,this,t)}const qs=Vt.prototype;qs.append=function(t,e){this._pairs.push([t,e])};qs.toString=function(t){const e=t?function(s){return t.call(this,s,ns)}:ns;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function _u(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Bs(n,t,e){if(!t)return n;const s=e&&e.encode||_u;C.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=C.isURLSearchParams(t)?t.toString():new Vt(t,e).toString(s),l){const r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class as{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Hs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wu=typeof URLSearchParams<"u"?URLSearchParams:Vt,$u=typeof FormData<"u"?FormData:null,Su=typeof Blob<"u"?Blob:null,Pu={isBrowser:!0,classes:{URLSearchParams:wu,FormData:$u,Blob:Su},protocols:["http","https","file","blob","url","data"]},jt=typeof window<"u"&&typeof document<"u",Ot=typeof navigator=="object"&&navigator||void 0,Tu=jt&&(!Ot||["ReactNative","NativeScript","NS"].indexOf(Ot.product)<0),Eu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ku=jt&&window.location.href||"http://localhost",Cu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jt,hasStandardBrowserEnv:Tu,hasStandardBrowserWebWorkerEnv:Eu,navigator:Ot,origin:ku},Symbol.toStringTag,{value:"Module"})),Re={...Cu,...Pu};function Iu(n,t){return Tt(n,new Re.classes.URLSearchParams,{visitor:function(e,s,a,l){return Re.isNode&&C.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Ru(n){return C.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function xu(n){const t={},e=Object.keys(n);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=n[l];return t}function Vs(n){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const p=Number.isFinite(+r),y=l>=e.length;return r=!r&&C.isArray(a)?a.length:r,y?(C.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!p):((!a[r]||!C.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&C.isArray(a[r])&&(a[r]=xu(a[r])),!p)}if(C.isFormData(n)&&C.isFunction(n.entries)){const e={};return C.forEachEntry(n,(s,a)=>{t(Ru(s),a,e,0)}),e}return null}function Au(n,t,e){if(C.isString(n))try{return(t||JSON.parse)(n),C.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(n)}const ct={transitional:Hs,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=C.isObject(t);if(l&&C.isHTMLForm(t)&&(t=new FormData(t)),C.isFormData(t))return a?JSON.stringify(Vs(t)):t;if(C.isArrayBuffer(t)||C.isBuffer(t)||C.isStream(t)||C.isFile(t)||C.isBlob(t)||C.isReadableStream(t))return t;if(C.isArrayBufferView(t))return t.buffer;if(C.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let p;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Iu(t,this.formSerializer).toString();if((p=C.isFileList(t))||s.indexOf("multipart/form-data")>-1){const y=this.env&&this.env.FormData;return Tt(p?{"files[]":t}:t,y&&new y,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Au(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(t)||C.isReadableStream(t))return t;if(t&&C.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(p){if(r)throw p.name==="SyntaxError"?ie.from(p,ie.ERR_BAD_RESPONSE,this,null,this.response):p}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],n=>{ct.headers[n]={}});const Fu=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mu=n=>{const t={};let e,s,a;return n&&n.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&Fu[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ls=Symbol("internals");function nt(n){return n&&String(n).trim().toLowerCase()}function vt(n){return n===!1||n==null?n:C.isArray(n)?n.map(vt):String(n)}function Du(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(n);)t[s[1]]=s[2];return t}const Nu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Rt(n,t,e,s,a){if(C.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!C.isString(t)){if(C.isString(s))return t.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(t)}}function Uu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Lu(n,t){const e=C.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(p,y,i){const c=nt(y);if(!c)throw new Error("header name must be a non-empty string");const h=C.findKey(a,c);(!h||a[h]===void 0||i===!0||i===void 0&&a[h]!==!1)&&(a[h||y]=vt(p))}const r=(p,y)=>C.forEach(p,(i,c)=>l(i,c,y));if(C.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(C.isString(t)&&(t=t.trim())&&!Nu(t))r(Mu(t),e);else if(C.isObject(t)&&C.isIterable(t)){let p={},y,i;for(const c of t){if(!C.isArray(c))throw TypeError("Object iterator must return a key-value pair");p[i=c[0]]=(y=p[i])?C.isArray(y)?[...y,c[1]]:[y,c[1]]:c[1]}r(p,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=nt(t),t){const s=C.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return Du(a);if(C.isFunction(e))return e.call(this,a,s);if(C.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=nt(t),t){const s=C.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Rt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=nt(r),r){const p=C.findKey(s,r);p&&(!e||Rt(s,s[p],p,e))&&(delete s[p],a=!0)}}return C.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Rt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return C.forEach(this,(a,l)=>{const r=C.findKey(s,l);if(r){e[r]=vt(a),delete e[l];return}const p=t?Uu(l):String(l).trim();p!==l&&delete e[l],e[p]=vt(a),s[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return C.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&C.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ls]=this[ls]={accessors:{}}).accessors,a=this.prototype;function l(r){const p=nt(r);s[p]||(Lu(a,r),s[p]=!0)}return C.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(Fe.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[e]=s}}});C.freezeMethods(Fe);function xt(n,t){const e=this||ct,s=t||e,a=Fe.from(s.headers);let l=s.data;return C.forEach(n,function(p){l=p.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function js(n){return!!(n&&n.__CANCEL__)}function st(n,t,e){ie.call(this,n??"canceled",ie.ERR_CANCELED,t,e),this.name="CanceledError"}C.inherits(st,ie,{__CANCEL__:!0});function zs(n,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?n(e):t(new ie("Request failed with status code "+e.status,[ie.ERR_BAD_REQUEST,ie.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Ou(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function qu(n,t){n=n||10;const e=new Array(n),s=new Array(n);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(y){const i=Date.now(),c=s[l];r||(r=i),e[a]=y,s[a]=i;let h=l,k=0;for(;h!==a;)k+=e[h++],h=h%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),i-r<t)return;const _=c&&i-c;return _?Math.round(k*1e3/_):void 0}}function Bu(n,t){let e=0,s=1e3/t,a,l;const r=(i,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),n(...i)};return[(...i)=>{const c=Date.now(),h=c-e;h>=s?r(i,c):(a=i,l||(l=setTimeout(()=>{l=null,r(a)},s-h)))},()=>a&&r(a)]}const bt=(n,t,e=3)=>{let s=0;const a=qu(50,250);return Bu(l=>{const r=l.loaded,p=l.lengthComputable?l.total:void 0,y=r-s,i=a(y),c=r<=p;s=r;const h={loaded:r,total:p,progress:p?r/p:void 0,bytes:y,rate:i||void 0,estimated:i&&p&&c?(p-r)/i:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0};n(h)},e)},rs=(n,t)=>{const e=n!=null;return[s=>t[0]({lengthComputable:e,total:n,loaded:s}),t[1]]},is=n=>(...t)=>C.asap(()=>n(...t)),Hu=Re.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Re.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,Vu=Re.hasStandardBrowserEnv?{write(n,t,e,s,a,l,r){if(typeof document>"u")return;const p=[`${n}=${encodeURIComponent(t)}`];C.isNumber(e)&&p.push(`expires=${new Date(e).toUTCString()}`),C.isString(s)&&p.push(`path=${s}`),C.isString(a)&&p.push(`domain=${a}`),l===!0&&p.push("secure"),C.isString(r)&&p.push(`SameSite=${r}`),document.cookie=p.join("; ")},read(n){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ju(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zu(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function Ws(n,t,e){let s=!ju(t);return n&&(s||e==!1)?zu(n,t):t}const cs=n=>n instanceof Fe?{...n}:n;function We(n,t){t=t||{};const e={};function s(i,c,h,k){return C.isPlainObject(i)&&C.isPlainObject(c)?C.merge.call({caseless:k},i,c):C.isPlainObject(c)?C.merge({},c):C.isArray(c)?c.slice():c}function a(i,c,h,k){if(C.isUndefined(c)){if(!C.isUndefined(i))return s(void 0,i,h,k)}else return s(i,c,h,k)}function l(i,c){if(!C.isUndefined(c))return s(void 0,c)}function r(i,c){if(C.isUndefined(c)){if(!C.isUndefined(i))return s(void 0,i)}else return s(void 0,c)}function p(i,c,h){if(h in t)return s(i,c);if(h in n)return s(void 0,i)}const y={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:p,headers:(i,c,h)=>a(cs(i),cs(c),h,!0)};return C.forEach(Object.keys({...n,...t}),function(c){const h=y[c]||a,k=h(n[c],t[c],c);C.isUndefined(k)&&h!==p||(e[c]=k)}),e}const Gs=n=>{const t=We({},n);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:p}=t;if(t.headers=r=Fe.from(r),t.url=Bs(Ws(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&r.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),C.isFormData(e)){if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(C.isFunction(e.getHeaders)){const y=e.getHeaders(),i=["content-type","content-length"];Object.entries(y).forEach(([c,h])=>{i.includes(c.toLowerCase())&&r.set(c,h)})}}if(Re.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(t)),s||s!==!1&&Hu(t.url))){const y=a&&l&&Vu.read(l);y&&r.set(a,y)}return t},Wu=typeof XMLHttpRequest<"u",Gu=Wu&&function(n){return new Promise(function(e,s){const a=Gs(n);let l=a.data;const r=Fe.from(a.headers).normalize();let{responseType:p,onUploadProgress:y,onDownloadProgress:i}=a,c,h,k,_,m;function T(){_&&_(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let $=new XMLHttpRequest;$.open(a.method.toUpperCase(),a.url,!0),$.timeout=a.timeout;function v(){if(!$)return;const G=Fe.from("getAllResponseHeaders"in $&&$.getAllResponseHeaders()),b={data:!p||p==="text"||p==="json"?$.responseText:$.response,status:$.status,statusText:$.statusText,headers:G,config:n,request:$};zs(function(F){e(F),T()},function(F){s(F),T()},b),$=null}"onloadend"in $?$.onloadend=v:$.onreadystatechange=function(){!$||$.readyState!==4||$.status===0&&!($.responseURL&&$.responseURL.indexOf("file:")===0)||setTimeout(v)},$.onabort=function(){$&&(s(new ie("Request aborted",ie.ECONNABORTED,n,$)),$=null)},$.onerror=function(U){const b=U&&U.message?U.message:"Network Error",P=new ie(b,ie.ERR_NETWORK,n,$);P.event=U||null,s(P),$=null},$.ontimeout=function(){let U=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const b=a.transitional||Hs;a.timeoutErrorMessage&&(U=a.timeoutErrorMessage),s(new ie(U,b.clarifyTimeoutError?ie.ETIMEDOUT:ie.ECONNABORTED,n,$)),$=null},l===void 0&&r.setContentType(null),"setRequestHeader"in $&&C.forEach(r.toJSON(),function(U,b){$.setRequestHeader(b,U)}),C.isUndefined(a.withCredentials)||($.withCredentials=!!a.withCredentials),p&&p!=="json"&&($.responseType=a.responseType),i&&([k,m]=bt(i,!0),$.addEventListener("progress",k)),y&&$.upload&&([h,_]=bt(y),$.upload.addEventListener("progress",h),$.upload.addEventListener("loadend",_)),(a.cancelToken||a.signal)&&(c=G=>{$&&(s(!G||G.type?new st(null,n,$):G),$.abort(),$=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const N=Ou(a.url);if(N&&Re.protocols.indexOf(N)===-1){s(new ie("Unsupported protocol "+N+":",ie.ERR_BAD_REQUEST,n));return}$.send(l||null)})},Ku=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(i){if(!a){a=!0,p();const c=i instanceof Error?i:this.reason;s.abort(c instanceof ie?c:new st(c instanceof Error?c.message:c))}};let r=t&&setTimeout(()=>{r=null,l(new ie(`timeout ${t} of ms exceeded`,ie.ETIMEDOUT))},t);const p=()=>{n&&(r&&clearTimeout(r),r=null,n.forEach(i=>{i.unsubscribe?i.unsubscribe(l):i.removeEventListener("abort",l)}),n=null)};n.forEach(i=>i.addEventListener("abort",l));const{signal:y}=s;return y.unsubscribe=()=>C.asap(p),y}},Ju=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let s=0,a;for(;s<e;)a=s+t,yield n.slice(s,a),s=a},Xu=async function*(n,t){for await(const e of Yu(n))yield*Ju(e,t)},Yu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},us=(n,t,e,s)=>{const a=Xu(n,t);let l=0,r,p=y=>{r||(r=!0,s&&s(y))};return new ReadableStream({async pull(y){try{const{done:i,value:c}=await a.next();if(i){p(),y.close();return}let h=c.byteLength;if(e){let k=l+=h;e(k)}y.enqueue(new Uint8Array(c))}catch(i){throw p(i),i}},cancel(y){return p(y),a.return()}},{highWaterMark:2})},ds=64*1024,{isFunction:mt}=C,Qu=(({Request:n,Response:t})=>({Request:n,Response:t}))(C.global),{ReadableStream:ps,TextEncoder:ms}=C.global,fs=(n,...t)=>{try{return!!n(...t)}catch{return!1}},Zu=n=>{n=C.merge.call({skipUndefined:!0},Qu,n);const{fetch:t,Request:e,Response:s}=n,a=t?mt(t):typeof fetch=="function",l=mt(e),r=mt(s);if(!a)return!1;const p=a&&mt(ps),y=a&&(typeof ms=="function"?(m=>T=>m.encode(T))(new ms):async m=>new Uint8Array(await new e(m).arrayBuffer())),i=l&&p&&fs(()=>{let m=!1;const T=new e(Re.origin,{body:new ps,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!T}),c=r&&p&&fs(()=>C.isReadableStream(new s("").body)),h={stream:c&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!h[m]&&(h[m]=(T,$)=>{let v=T&&T[m];if(v)return v.call(T);throw new ie(`Response type '${m}' is not supported`,ie.ERR_NOT_SUPPORT,$)})});const k=async m=>{if(m==null)return 0;if(C.isBlob(m))return m.size;if(C.isSpecCompliantForm(m))return(await new e(Re.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(C.isArrayBufferView(m)||C.isArrayBuffer(m))return m.byteLength;if(C.isURLSearchParams(m)&&(m=m+""),C.isString(m))return(await y(m)).byteLength},_=async(m,T)=>{const $=C.toFiniteNumber(m.getContentLength());return $??k(T)};return async m=>{let{url:T,method:$,data:v,signal:N,cancelToken:G,timeout:U,onDownloadProgress:b,onUploadProgress:P,responseType:F,headers:L,withCredentials:B="same-origin",fetchOptions:S}=Gs(m),x=t||fetch;F=F?(F+"").toLowerCase():"text";let E=Ku([N,G&&G.toAbortSignal()],U),q=null;const O=E&&E.unsubscribe&&(()=>{E.unsubscribe()});let V;try{if(P&&i&&$!=="get"&&$!=="head"&&(V=await _(L,v))!==0){let ue=new e(T,{method:"POST",body:v,duplex:"half"}),M;if(C.isFormData(v)&&(M=ue.headers.get("content-type"))&&L.setContentType(M),ue.body){const[j,K]=rs(V,bt(is(P)));v=us(ue.body,ds,j,K)}}C.isString(B)||(B=B?"include":"omit");const ee=l&&"credentials"in e.prototype,Se={...S,signal:E,method:$.toUpperCase(),headers:L.normalize().toJSON(),body:v,duplex:"half",credentials:ee?B:void 0};q=l&&new e(T,Se);let X=await(l?x(q,S):x(T,Se));const ce=c&&(F==="stream"||F==="response");if(c&&(b||ce&&O)){const ue={};["status","statusText","headers"].forEach(Q=>{ue[Q]=X[Q]});const M=C.toFiniteNumber(X.headers.get("content-length")),[j,K]=b&&rs(M,bt(is(b),!0))||[];X=new s(us(X.body,ds,j,()=>{K&&K(),O&&O()}),ue)}F=F||"text";let ke=await h[C.findKey(h,F)||"text"](X,m);return!ce&&O&&O(),await new Promise((ue,M)=>{zs(ue,M,{data:ke,headers:Fe.from(X.headers),status:X.status,statusText:X.statusText,config:m,request:q})})}catch(ee){throw O&&O(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new ie("Network Error",ie.ERR_NETWORK,m,q),{cause:ee.cause||ee}):ie.from(ee,ee&&ee.code,m,q)}}},ed=new Map,Ks=n=>{let t=n&&n.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,p=r,y,i,c=ed;for(;p--;)y=l[p],i=c.get(y),i===void 0&&c.set(y,i=p?new Map:Zu(t)),c=i;return i};Ks();const zt={http:gu,xhr:Gu,fetch:{get:Ks}};C.forEach(zt,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const hs=n=>`- ${n}`,td=n=>C.isFunction(n)||n===null||n===!1;function sd(n,t){n=C.isArray(n)?n:[n];const{length:e}=n;let s,a;const l={};for(let r=0;r<e;r++){s=n[r];let p;if(a=s,!td(s)&&(a=zt[(p=String(s)).toLowerCase()],a===void 0))throw new ie(`Unknown adapter '${p}'`);if(a&&(C.isFunction(a)||(a=a.get(t))))break;l[p||"#"+r]=a}if(!a){const r=Object.entries(l).map(([y,i])=>`adapter ${y} `+(i===!1?"is not supported by the environment":"is not available in the build"));let p=e?r.length>1?`since :
`+r.map(hs).join(`
`):" "+hs(r[0]):"as no adapter specified";throw new ie("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return a}const Js={getAdapter:sd,adapters:zt};function At(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new st(null,n)}function vs(n){return At(n),n.headers=Fe.from(n.headers),n.data=xt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Js.getAdapter(n.adapter||ct.adapter,n)(n).then(function(s){return At(n),s.data=xt.call(n,n.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return js(s)||(At(n),s&&s.response&&(s.response.data=xt.call(n,n.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const Xs="1.13.2",Et={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{Et[n]=function(s){return typeof s===n||"a"+(t<1?"n ":" ")+n}});const gs={};Et.transitional=function(t,e,s){function a(l,r){return"[Axios v"+Xs+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,p)=>{if(t===!1)throw new ie(a(r," has been removed"+(e?" in "+e:"")),ie.ERR_DEPRECATED);return e&&!gs[r]&&(gs[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,p):!0}};Et.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function od(n,t,e){if(typeof n!="object")throw new ie("options must be an object",ie.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const p=n[l],y=p===void 0||r(p,l,n);if(y!==!0)throw new ie("option "+l+" must be "+y,ie.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ie("Unknown option "+l,ie.ERR_BAD_OPTION)}}const gt={assertOptions:od,validators:Et},Oe=gt.validators;let je=class{constructor(t){this.defaults=t||{},this.interceptors={request:new as,response:new as}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=We(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&gt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(C.isFunction(a)?e.paramsSerializer={serialize:a}:gt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),gt.assertOptions(e,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&C.merge(l.common,l[e.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),e.headers=Fe.concat(r,l);const p=[];let y=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(y=y&&T.synchronous,p.unshift(T.fulfilled,T.rejected))});const i=[];this.interceptors.response.forEach(function(T){i.push(T.fulfilled,T.rejected)});let c,h=0,k;if(!y){const m=[vs.bind(this),void 0];for(m.unshift(...p),m.push(...i),k=m.length,c=Promise.resolve(e);h<k;)c=c.then(m[h++],m[h++]);return c}k=p.length;let _=e;for(;h<k;){const m=p[h++],T=p[h++];try{_=m(_)}catch($){T.call(this,$);break}}try{c=vs.call(this,_)}catch(m){return Promise.reject(m)}for(h=0,k=i.length;h<k;)c=c.then(i[h++],i[h++]);return c}getUri(t){t=We(this.defaults,t);const e=Ws(t.baseURL,t.url,t.allowAbsoluteUrls);return Bs(e,t.params,t.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(t){je.prototype[t]=function(e,s){return this.request(We(s||{},{method:t,url:e,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,p){return this.request(We(p||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}je.prototype[t]=e(),je.prototype[t+"Form"]=e(!0)});let nd=class Ys{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(p=>{s.subscribe(p),l=p}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,p){s.reason||(s.reason=new st(l,r,p),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ys(function(a){t=a}),cancel:t}}};function ad(n){return function(e){return n.apply(null,e)}}function ld(n){return C.isObject(n)&&n.isAxiosError===!0}const qt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(qt).forEach(([n,t])=>{qt[t]=n});function Qs(n){const t=new je(n),e=Is(je.prototype.request,t);return C.extend(e,je.prototype,t,{allOwnKeys:!0}),C.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Qs(We(n,a))},e}const Pe=Qs(ct);Pe.Axios=je;Pe.CanceledError=st;Pe.CancelToken=nd;Pe.isCancel=js;Pe.VERSION=Xs;Pe.toFormData=Tt;Pe.AxiosError=ie;Pe.Cancel=Pe.CanceledError;Pe.all=function(t){return Promise.all(t)};Pe.spread=ad;Pe.isAxiosError=ld;Pe.mergeConfig=We;Pe.AxiosHeaders=Fe;Pe.formToJSON=n=>Vs(C.isHTMLForm(n)?new FormData(n):n);Pe.getAdapter=Js.getAdapter;Pe.HttpStatusCode=qt;Pe.default=Pe;const{Axios:Hh,AxiosError:Vh,CanceledError:jh,isCancel:zh,CancelToken:Wh,VERSION:Gh,all:Kh,Cancel:Jh,isAxiosError:Xh,spread:Yh,toFormData:Qh,AxiosHeaders:Zh,HttpStatusCode:ev,formToJSON:tv,getAdapter:sv,mergeConfig:ov}=Pe;class rd{static async getAvailableModels(){try{return(await Pe({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const id={class:"assigned-tools"},cd={class:"section-header"},ud=["title"],dd={class:"tool-info"},pd={class:"tool-name"},md=["title"],fd={key:0,class:"no-tools"},hd=Te({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=ae(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=ae(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(i=>l.value.some(c=>c.key===i)):[]);ye(r,i=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;i.length!==c&&s("tools-filtered",i)},{immediate:!0});const p=i=>{const c=l.value.find(k=>k.key===i);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:i},y=i=>{const c=l.value.find(h=>h.key===i);return c?c.description:""};return(i,c)=>(f(),g("div",id,[o("div",cd,[o("span",null,u(i.title)+" ("+u(r.value.length)+")",1),i.showAddButton?(f(),g("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=h=>i.$emit("add-tools"))},[R(d(D),{icon:"carbon:add"}),pe(" "+u(i.addButtonText),1)])):H("",!0)]),o("div",{class:ve(["tools-grid",{"grid-layout":i.useGridLayout,"has-more-items":i.useGridLayout&&r.value.length>2}])},[(f(!0),g(fe,null,ge(r.value,h=>(f(),g("div",{key:h,class:"tool-item assigned",title:y(h)},[o("div",dd,[o("span",pd,u(p(h)),1),o("span",{class:"tool-desc",title:y(h)},u(y(h)),9,md)])],8,ud))),128)),r.value.length===0?(f(),g("div",fd,[R(d(D),{icon:"carbon:tool-box"}),o("span",null,u(i.emptyText),1)])):H("",!0)],2)]))}}),vd=Ee(hd,[["__scopeId","data-v-62354a05"]]),gd={class:"tool-selection-content"},yd={class:"tool-controls"},bd={class:"search-container"},_d=["placeholder"],wd={class:"sort-container"},$d={value:"group"},Sd={value:"name"},Pd={value:"enabled"},Td={class:"tool-summary"},Ed={class:"summary-text"},kd={key:0,class:"tool-groups"},Cd=["onClick"],Id={class:"group-title-area"},Rd={class:"group-name"},xd={class:"group-count"},Ad={class:"group-enable-all"},Fd=["checked","onChange","data-group"],Md={class:"enable-label"},Dd={class:"tool-info"},Nd={class:"tool-selection-name"},Ud={key:0,class:"tool-selection-desc"},Ld={class:"tool-actions"},Od=["checked","onChange"],qd={key:1,class:"empty-state"},Bd=Te({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=ae(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),ye(()=>e.modelValue,S=>{S&&!a.isLoading.value&&a.loadAvailableTools()});const r=ae({get:()=>e.modelValue,set:S=>s("update:modelValue",S)}),p=A(""),y=A("group"),i=A(new Set),c=A([]),h=A(null),k=(S,x)=>{const E=document.querySelector(`input[data-group="${S}"]`);E&&(E.indeterminate=b(x))};ye(()=>e.selectedToolIds,S=>{c.value=[...S]},{immediate:!0});const _=ae(()=>{let S=l.value.filter(x=>x.key);if(S=S.filter(x=>x.selectable===!0),p.value){const x=p.value.toLowerCase();S=S.filter(E=>E.name.toLowerCase().includes(x)||E.description.toLowerCase().includes(x)||E.serviceGroup.toLowerCase().includes(x))}switch(y.value){case"name":S=[...S].sort((x,E)=>x.name.localeCompare(E.name));break;case"enabled":S=[...S].sort((x,E)=>{const q=c.value.includes(x.key),O=c.value.includes(E.key);return q&&!O?-1:!q&&O?1:x.name.localeCompare(E.name)});break;case"group":default:S=[...S].sort((x,E)=>{const q=x.serviceGroup||"Ungrouped",O=E.serviceGroup||"Ungrouped";return q!==O?q.localeCompare(O):x.name.localeCompare(E.name)});break}return S}),m=ae(()=>{const S=new Map;return l.value.filter(E=>E.key&&E.selectable===!0).forEach(E=>{const q=E.serviceGroup||"Ungrouped";S.has(q)||S.set(q,[]),S.get(q).push(E)}),S}),T=ae(()=>{const S=new Map;return _.value.forEach(x=>{const E=x.serviceGroup||"Ungrouped";S.has(E)||S.set(E,[]),S.get(E).push(x)}),new Map([...S.entries()].sort())}),$=ae(()=>_.value.length);ye([c,T],()=>{xe(()=>{for(const[S,x]of T.value)k(S,x)})},{flush:"post",deep:!1});const v=S=>c.value.includes(S),N=(S,x)=>{x.stopPropagation();const q=x.target.checked;if(!S){console.error("toolKey is undefined, cannot proceed");return}q?c.value.includes(S)||(c.value=[...c.value,S]):c.value=c.value.filter(O=>O!==S)},G=S=>S.filter(x=>c.value.includes(x.key)),U=S=>S.length>0&&S.every(x=>c.value.includes(x.key)),b=S=>{const x=G(S).length;return x>0&&x<S.length},P=(S,x)=>{x.stopPropagation();const q=x.target.checked,O=S.map(V=>V.key);if(q){const V=[...c.value];O.forEach(ee=>{V.includes(ee)||V.push(ee)}),c.value=V}else c.value=c.value.filter(V=>!O.includes(V))},F=S=>{i.value.has(S)?i.value.delete(S):i.value.add(S)},L=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},B=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return ye(p,S=>{const x=S.trim().toLowerCase();if(x){h.value===null&&(h.value=new Set(i.value));for(const[E,q]of m.value)q.some(V=>V.name.toLowerCase().includes(x)||V.description&&V.description.toLowerCase().includes(x)||V.serviceGroup&&V.serviceGroup.toLowerCase().includes(x))&&i.value.delete(E)}else h.value!==null&&(i.value=new Set(h.value),h.value=null)}),ye(r,S=>{if(S){i.value.clear(),h.value=null;const x=Array.from(T.value.keys());x.length>1&&x.slice(1).forEach(E=>{i.value.add(E)})}}),(S,x)=>(f(),$e(Ss,{modelValue:r.value,"onUpdate:modelValue":[x[4]||(x[4]=E=>r.value=E),B],title:S.$t("toolSelection.title"),onConfirm:L},{default:ze(()=>[o("div",gd,[o("div",yd,[o("div",bd,[_e(o("input",{"onUpdate:modelValue":x[0]||(x[0]=E=>p.value=E),type:"text",class:"search-input",placeholder:S.$t("toolSelection.searchPlaceholder")},null,8,_d),[[Ce,p.value]])]),o("div",wd,[_e(o("select",{"onUpdate:modelValue":x[1]||(x[1]=E=>y.value=E),class:"sort-select"},[o("option",$d,u(S.$t("toolSelection.sortByGroup")),1),o("option",Sd,u(S.$t("toolSelection.sortByName")),1),o("option",Pd,u(S.$t("toolSelection.sortByStatus")),1)],512),[[Bt,y.value]])])]),o("div",Td,[o("span",Ed,u(S.$t("toolSelection.summary",{groups:T.value.size,tools:$.value,selected:c.value.length})),1)]),T.value.size>0?(f(),g("div",kd,[(f(!0),g(fe,null,ge(T.value,([E,q])=>(f(),g("div",{key:E,class:"tool-group"},[o("div",{class:ve(["tool-group-header",{collapsed:i.value.has(E)}]),onClick:O=>F(E)},[o("div",Id,[R(d(D),{icon:i.value.has(E)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),R(d(D),{icon:"carbon:folder",class:"group-icon"}),o("span",Rd,u(E),1),o("span",xd," ("+u(G(q).length)+"/"+u(q.length)+") ",1)]),o("div",{class:"group-actions",onClick:x[2]||(x[2]=we(()=>{},["stop"]))},[o("label",Ad,[o("input",{type:"checkbox",class:"group-enable-checkbox",checked:U(q),onChange:O=>P(q,O),"data-group":E},null,40,Fd),o("span",Md,u(S.$t("toolSelection.enableAll")),1)])])],10,Cd),o("div",{class:ve(["tool-group-content",{collapsed:i.value.has(E)}])},[(f(!0),g(fe,null,ge(q,O=>(f(),g("div",{key:O.key,class:"tool-selection-item"},[o("div",Dd,[o("div",Nd,u(O.name),1),O.description?(f(),g("div",Ud,u(O.description),1)):H("",!0)]),o("div",Ld,[o("label",{class:"tool-enable-switch",onClick:x[3]||(x[3]=we(()=>{},["stop"]))},[o("input",{type:"checkbox",class:"tool-enable-checkbox",checked:v(O.key),onChange:V=>N(O.key,V)},null,40,Od),x[5]||(x[5]=o("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(f(),g("div",qd,[R(d(D),{icon:"carbon:tools",class:"empty-icon"}),o("p",null,u(S.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Hd=Ee(Bd,[["__scopeId","data-v-627b463f"]]),Vd={class:"config-section"},jd={class:"section-header"},zd={class:"visual-editor"},Wd={class:"plan-basic-info"},Gd={class:"form-row"},Kd={class:"form-label"},Jd=["placeholder"],Xd={key:0,class:"field-error-message"},Yd={class:"form-row"},Qd={class:"form-label"},Zd={class:"service-group-autocomplete"},ep=["placeholder"],tp={key:0,class:"service-group-dropdown"},sp=["onMousedown"],op={class:"field-description"},np={class:"steps-section"},ap={class:"steps-container"},lp={class:"step-content"},rp={class:"form-row"},ip={class:"form-label"},cp=["value","onInput","placeholder"],up={class:"form-row"},dp={class:"form-label"},pp=["value","onInput","placeholder"],mp={key:0,class:"preview-section"},fp={class:"preview-label"},hp={class:"preview-content"},vp={class:"preview-text"},gp={class:"preview-table-header"},yp={class:"form-row"},bp={class:"form-label"},_p={class:"model-selector-wrapper"},wp={class:"model-input-wrapper"},$p=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Sp={key:0,class:"dropdown-item disabled"},Pp={key:1,class:"dropdown-item disabled error"},Tp={key:2,class:"dropdown-item disabled"},Ep=["onClick","onMouseenter"],kp=["onClick","onMouseenter"],Cp=["title"],Ip={key:0,class:"error-message"},Rp={class:"form-row"},xp={key:0,class:"empty-steps"},Ap={class:"empty-text"},Fp={key:0,class:"json-preview"},Mp={class:"preview-header"},Dp={class:"form-label"},Np={class:"json-code"},Up={class:"editor-footer"},Lp={class:"section-actions"},Op=["disabled","title"],qp=["disabled","title"],Bp=["disabled","title"],Hp=["disabled"],Vp={class:"modal-header"},jp={class:"modal-body"},zp={class:"form-row"},Wp={class:"form-label"},Gp=["placeholder"],Kp={class:"modal-footer"},Jp=["disabled"],Xp=Te({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=wt(),a=Ge(),l=He({title:"",steps:[]}),r=A(!1),p=A(!1),y=A([]),i=A(!1),c=A(""),h=ae(()=>a.generateJsonString()),k=A(!1);let _=null;const m=()=>{a.isUserUpdating.value=!0,_&&clearTimeout(_),_=setTimeout(()=>{a.isUserUpdating.value=!1,_=null},500)},T=()=>{if(a.isUserUpdating.value){console.log("[JsonEditorV2] syncDisplayDataFromConfig skipped: isUserUpdating is true");return}console.log("[JsonEditorV2] syncDisplayDataFromConfig called"),k.value=!0;try{const w=a.getConfig();console.log("[JsonEditorV2] Syncing displayData with config:",{title:w.title,stepsCount:w.steps?.length||0,serviceGroup:w.serviceGroup}),(w.title?.trim()||!l.title?.trim())&&(l.title=w.title||""),l.steps=(w.steps||[]).map(J=>({...J})),c.value=w.serviceGroup||"",console.log("[JsonEditorV2] displayData synced:",{title:l.title,stepsCount:l.steps.length,serviceGroup:c.value})}finally{setTimeout(()=>{k.value=!1},0)}},$=()=>{k.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(de.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{k.value=!1},0)}},v=()=>{r.value=!r.value},N=()=>{r.value=!1},G=()=>{try{_&&(clearTimeout(_),_=null),a.isUserUpdating.value=!1,a.rollbackVersion()}catch(w){console.error("Error during rollback operation:",w),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},U=()=>{try{_&&(clearTimeout(_),_=null),a.isUserUpdating.value=!1,a.restoreVersion()}catch(w){console.error("Error during restore operation:",w),s.error(e("sidebar.restoreFailed")||"Restore failed")}},b=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}_&&(clearTimeout(_),_=null),a.isUserUpdating.value=!1,$();const w=a.validate();if(!w.isValid){s.error(`Invalid format, please correct and save.
Errors: `+w.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const re=a.generateJsonString().trim();a.updateVersionsAfterSave(re);const he=a.planVersions.value.length;de.hasTaskRequirementModified=!1,await de.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:he}))}catch(w){console.error("Failed to save plan modifications:",w);const J=w instanceof Error?w.message:e("sidebar.saveFailed");throw s.error(J),w}},P=A(""),F=(w,J)=>{m();const Y=l.steps[J];Y&&(Y.stepRequirement=w.target.value),Xt(w)},L=(w,J)=>{m();const Y=l.steps[J];Y&&(Y.terminateColumns=w.target.value),Xt(w)},B=()=>{const w={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(w),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},S=A([]),x=A(!1),E=A(""),q=A(new Map),O=A(new Set),V=A(new Map),ee=w=>q.value.get(w)??"",Se=(w,J)=>{q.value.set(w,J)},X=w=>{const J=ee(w);if(!J.trim())return S.value;const Y=J.toLowerCase().trim();return S.value.filter(re=>re.value.toLowerCase().includes(Y)||re.label.toLowerCase().includes(Y))},ce=w=>{const J=l.steps[w],Y=ee(w);return O.value.has(w)&&Y!==""?Y:J.modelName??""},ke=w=>x.value||E.value||l.steps[w].modelName?"":e("sidebar.modelNameDescription")||"",ue=w=>O.value.has(w),M=w=>{x.value||O.value.add(w)},j=w=>{O.value.delete(w),V.value.set(w,-1);const J=l.steps[w];Se(w,J.modelName??"")},K=w=>{ue(w)?j(w):M(w)},Q=(w,J)=>{m();const Y=l.steps[J];Y.modelName=w,Se(J,w),j(J)},se=(w,J)=>{m();const Y=w.target;Se(J,Y.value),M(J)},le=w=>V.value.get(w)??-1,me=(w,J)=>{V.value.set(w,J)},te=w=>{const J=le(w),Y=X(w);J>=0&&J<Y.length?Q(Y[J].value,w):J===-1?Q("",w):Y.length>0?Q(Y[0].value,w):l.steps[w].modelName||Q("",w)},z=w=>{if(!ue(w)){M(w),me(w,0);return}const Y=X(w).length+1,re=le(w),he=Math.min(re+1,Y-1);me(w,he)},I=w=>{if(!ue(w)){M(w);const re=X(w);me(w,re.length);return}const J=le(w),Y=Math.max(J-1,-1);me(w,Y)},W=w=>{w.target.closest(".model-selector")||O.value.clear()};ye(()=>l.steps,w=>{w.forEach((J,Y)=>{q.value.has(Y)||Se(Y,J.modelName??"")})},{deep:!0,immediate:!0});const Z=A(!1),ne=A(-1),oe=async()=>{if(!x.value){x.value=!0,E.value="";try{const w=await rd.getAvailableModels();S.value=w.options}catch(w){console.error("Failed to load models:",w),E.value=w instanceof Error?w.message:"Failed to load models",S.value=[]}finally{x.value=!1}}},be=w=>{ne.value=w,Z.value=!0},Ke=w=>{m(),ne.value>=0&&ne.value<l.steps.length&&(l.steps[ne.value].selectedToolKeys=[...w]),Z.value=!1,ne.value=-1},eo=(w,J)=>{m(),w>=0&&w<l.steps.length&&(l.steps[w].selectedToolKeys=[...J])},ut=A(!1),qe=A(""),Be=A(!1),to=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}qe.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),ut.value=!0},dt=()=>{ut.value=!1,qe.value="",Be.value=!1},so=w=>{w.target===w.currentTarget&&dt()},Gt=async()=>{if(!qe.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}Be.value=!0;try{const w=a.getConfig(),J=`planTemplate-${Date.now()}`,{toolConfig:Y,...re}=w,he={...re,title:qe.value.trim(),planTemplateId:J};console.log("[JsonEditorV2] Copying plan without toolConfig:",he),(await Qt.createOrUpdatePlanTemplateWithTool(he)).success?(s.success(e("sidebar.copyPlanSuccess",{title:qe.value.trim()})),await de.loadPlanTemplateList(),dt()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(w){if(console.error("[JsonEditorV2] Error copying plan:",w),w instanceof Error&&w.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const J=w instanceof Error?w.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:J}))}}finally{Be.value=!1}};ye(()=>l.title,w=>{w?.trim()?P.value="":P.value="Title is required field"},{immediate:!0});const Kt=()=>{const w=a.getServiceGroup()||"";c.value=w};ye(()=>a.config,()=>{a.needsFullRefresh.value&&!k.value&&!a.isUserUpdating.value&&T()},{deep:!0,immediate:!0}),ye(()=>a.currentPlanTemplateId.value,(w,J)=>{console.log("[JsonEditorV2] currentPlanTemplateId changed:",{oldId:J,newId:w}),J!=null&&w!==J&&(q.value.clear(),O.value.clear(),V.value.clear(),Z.value=!1,ut.value=!1,r.value=!1,ne.value=-1,qe.value="",Be.value=!1),console.log("[JsonEditorV2] Calling syncDisplayDataFromConfig from currentPlanTemplateId watch"),T(),Kt()},{immediate:!0}),ye(()=>c.value,w=>{k.value=!0;try{a.setServiceGroup(w)}finally{setTimeout(()=>{k.value=!1},0)}});const oo=async()=>{if(!i.value){i.value=!0;try{const w=new Set;try{(await Cs.getAvailableTools()).forEach(Y=>{Y.serviceGroup&&w.add(Y.serviceGroup)})}catch(J){console.error("[JsonEditorV2] Failed to load service groups from tools:",J)}try{(await Qt.getAllPlanTemplateConfigVOs()).forEach(Y=>{Y.serviceGroup&&w.add(Y.serviceGroup)})}catch(J){console.error("[JsonEditorV2] Failed to load service groups from plan templates:",J)}y.value=Array.from(w).sort()}catch(w){console.error("[JsonEditorV2] Failed to load service groups:",w),y.value=[]}finally{i.value=!1}}},Jt=ae(()=>{const w=c.value.trim();if(!w)return y.value;const J=w.toLowerCase();return y.value.filter(Y=>Y.toLowerCase().includes(J))}),no=()=>{m()},ao=()=>{p.value=!0},lo=()=>{m(),ao()},ro=()=>{setTimeout(()=>{p.value=!1},200)},io=w=>{c.value=w,p.value=!1};Me(()=>{T(),Kt(),oo(),oe(),document.addEventListener("click",W)}),Ue(()=>{document.removeEventListener("click",W),_&&(clearTimeout(_),_=null)}),t({save:b});const Xt=w=>{const J=w.target;J.style.height="auto";const Y=20,re=Math.ceil(J.scrollHeight/Y),he=4,Je=12,pt=Math.max(he,Math.min(Je,re)),uo=pt*Y;J.style.height=`${uo}px`,J.rows=pt,re>Je?J.style.overflowY="auto":J.style.overflowY="hidden"},co=w=>{if(!w.trim())return"";const J=w.split(",").map(Y=>Y.trim()).filter(Y=>Y.length>0);return J.length===0?"":`|${J.join("|")}|`};return(w,J)=>(f(),g("div",Vd,[o("div",jd,[R(d(D),{icon:"carbon:code",width:"16"}),o("span",null,u(w.$t("sidebar.dynamicAgentPlan")),1)]),o("div",zd,[o("div",Wd,[o("div",Gd,[o("label",Kd,u(w.$t("sidebar.title")),1),_e(o("input",{"onUpdate:modelValue":J[0]||(J[0]=Y=>l.title=Y),type:"text",class:ve(["form-input",{error:P.value}]),placeholder:w.$t("sidebar.titlePlaceholder"),onInput:no},null,42,Jd),[[Ce,l.title]]),P.value?(f(),g("div",Xd,[R(d(D),{icon:"carbon:warning",width:"12"}),pe(" "+u(P.value),1)])):H("",!0)]),o("div",Yd,[o("label",Qd,u(w.$t("mcpService.serviceGroup")),1),o("div",Zd,[_e(o("input",{type:"text","onUpdate:modelValue":J[1]||(J[1]=Y=>c.value=Y),onInput:lo,onFocus:J[2]||(J[2]=Y=>p.value=!0),onBlur:ro,placeholder:w.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,ep),[[Ce,c.value]]),p.value&&Jt.value.length>0?(f(),g("div",tp,[(f(!0),g(fe,null,ge(Jt.value,Y=>(f(),g("div",{key:Y,class:"service-group-option",onMousedown:re=>io(Y)},u(Y),41,sp))),128))])):H("",!0)]),o("div",op,u(w.$t("mcpService.serviceGroupDescription")),1)])]),o("div",np,[o("div",ap,[(f(!0),g(fe,null,ge(l.steps,(Y,re)=>(f(),g("div",{key:re,class:"step-item"},[o("div",lp,[o("div",rp,[o("label",ip,u(w.$t("sidebar.stepRequirement")),1),o("textarea",{value:Y.stepRequirement||"",onInput:he=>F(he,re),class:"form-textarea auto-resize",placeholder:w.$t("sidebar.stepRequirementPlaceholder"),rows:"8"},null,40,cp)]),o("div",up,[o("label",dp,u(w.$t("sidebar.terminateColumns")),1),o("textarea",{value:Y.terminateColumns||"",onInput:he=>L(he,re),class:"form-textarea auto-resize",placeholder:w.$t("sidebar.terminateColumnsPlaceholder"),rows:"1"},null,40,pp),Y.terminateColumns&&Y.terminateColumns.trim()?(f(),g("div",mp,[o("div",fp,u(w.$t("sidebar.preview"))+":",1),o("div",hp,[o("div",vp,[pe(u(w.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),o("span",gp,u(co(Y.terminateColumns)),1)])])])):H("",!0)]),o("div",yp,[o("label",bp,u(w.$t("sidebar.modelName")),1),o("div",_p,[o("div",{class:ve(["model-selector",{"is-open":ue(re),"is-disabled":x.value}])},[o("div",wp,[o("input",{value:ce(re),type:"text",class:"form-input model-search-input",placeholder:ke(re),disabled:x.value,onClick:we(he=>M(re),["stop"]),onFocus:he=>M(re),onInput:he=>se(he,re),onKeydown:[ot(he=>j(re),["escape"]),ot(we(he=>te(re),["prevent"]),["enter"]),ot(we(he=>z(re),["prevent"]),["down"]),ot(we(he=>I(re),["prevent"]),["up"])]},null,40,$p),R(d(D),{icon:"carbon:chevron-down",width:"14",class:ve(["dropdown-arrow",{"is-open":ue(re)}]),onClick:we(he=>K(re),["stop"])},null,8,["class","onClick"])]),ue(re)?(f(),g("div",{key:0,class:"model-dropdown",onClick:J[3]||(J[3]=we(()=>{},["stop"]))},[x.value?(f(),g("div",Sp,u(w.$t("sidebar.loading")),1)):E.value?(f(),g("div",Pp,u(w.$t("sidebar.modelLoadError")),1)):X(re).length===0?(f(),g("div",Tp,u(w.$t("sidebar.noModelsFound")),1)):H("",!0),(f(!0),g(fe,null,ge(X(re),(he,Je)=>(f(),g("div",{key:he.value,class:ve(["dropdown-item",{"is-selected":Y.modelName===he.value,"is-highlighted":le(re)===Je}]),onClick:pt=>Q(he.value,re),onMouseenter:pt=>me(re,Je)},[pe(u(he.value)+" ",1),Y.modelName===he.value?(f(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):H("",!0)],42,Ep))),128)),o("div",{class:ve(["dropdown-item",{"is-selected":!Y.modelName,"is-highlighted":le(re)===-1}]),onClick:he=>Q("",re),onMouseenter:he=>me(re,-1)},[pe(u(w.$t("sidebar.noModelSelected"))+" ",1),Y.modelName?H("",!0):(f(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,kp)])):H("",!0)],2),E.value?(f(),g("button",{key:0,onClick:oe,class:"btn btn-sm btn-danger",title:w.$t("sidebar.retryLoadModels")},[R(d(D),{icon:"carbon:warning",width:"14"}),pe(" "+u(w.$t("sidebar.retry")),1)],8,Cp)):H("",!0)]),E.value?(f(),g("div",Ip,[R(d(D),{icon:"carbon:warning",width:"12"}),pe(" "+u(E.value),1)])):H("",!0)]),o("div",Rp,[R(vd,{title:w.$t("sidebar.selectedTools"),"selected-tool-ids":Y.selectedToolKeys||[],"add-button-text":w.$t("sidebar.addRemoveTools"),"empty-text":w.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:he=>be(re),onToolsFiltered:he=>eo(re,he)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(f(),g("div",xp,[R(d(D),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),o("p",Ap,u(w.$t("sidebar.noSteps")),1),o("button",{class:"btn btn-primary btn-add-step",onClick:B},[R(d(D),{icon:"carbon:add",width:"16"}),pe(" "+u(w.$t("sidebar.addFirstStep")),1)])])):H("",!0)])]),r.value?(f(),g("div",Fp,[o("div",Mp,[o("label",Dp,u(w.$t("sidebar.jsonPreview")),1),o("button",{onClick:N,class:"btn btn-xs"},[R(d(D),{icon:"carbon:close",width:"12"})])]),o("pre",Np,u(h.value),1)])):H("",!0),o("div",Up,[o("button",{onClick:v,class:"btn btn-sm btn-secondary"},[R(d(D),{icon:"carbon:code",width:"14"}),pe(" "+u(r.value?w.$t("sidebar.hideJson"):w.$t("sidebar.showJson")),1)]),o("div",Lp,[o("button",{class:"btn btn-sm",onClick:to,disabled:w.isGenerating||w.isExecuting,title:w.$t("sidebar.copyPlan")},[R(d(D),{icon:"carbon:copy",width:"14"}),pe(" "+u(w.$t("sidebar.copyPlan")),1)],8,Op),o("button",{class:"btn btn-sm",onClick:G,disabled:!d(a).canRollback.value,title:w.$t("sidebar.rollback")},[R(d(D),{icon:"carbon:undo",width:"14"})],8,qp),o("button",{class:"btn btn-sm",onClick:U,disabled:!d(a).canRestore.value,title:w.$t("sidebar.restore")},[R(d(D),{icon:"carbon:redo",width:"14"})],8,Bp),o("button",{class:"btn btn-primary",onClick:b,disabled:w.isGenerating||w.isExecuting},[R(d(D),{icon:"carbon:save",width:"14"}),J[7]||(J[7]=pe(" Save "))],8,Hp)])])]),R(Hd,{modelValue:Z.value,"onUpdate:modelValue":J[4]||(J[4]=Y=>Z.value=Y),"selected-tool-ids":ne.value>=0?l.steps[ne.value]?.selectedToolKeys||[]:[],onConfirm:Ke},null,8,["modelValue","selected-tool-ids"]),ut.value?(f(),g("div",{key:0,class:"modal-overlay",onMousedown:so},[o("div",{class:"modal-content",onMousedown:J[6]||(J[6]=we(()=>{},["stop"]))},[o("div",Vp,[o("h3",null,u(w.$t("sidebar.copyPlan")),1),o("button",{class:"close-btn",onClick:dt},[R(d(D),{icon:"carbon:close",width:"16"})])]),o("div",jp,[o("div",zp,[o("label",Wp,u(w.$t("sidebar.newPlanTitle")),1),_e(o("input",{"onUpdate:modelValue":J[5]||(J[5]=Y=>qe.value=Y),type:"text",class:"form-input",placeholder:w.$t("sidebar.enterNewPlanTitle"),onKeyup:ot(Gt,["enter"])},null,40,Gp),[[Ce,qe.value]])])]),o("div",Kp,[o("button",{class:"btn btn-secondary",onClick:dt},u(w.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:Gt,disabled:!qe.value.trim()||Be.value},[Be.value?(f(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):H("",!0),pe(" "+u(Be.value?w.$t("sidebar.copying"):w.$t("sidebar.copyPlan")),1)],8,Jp)])],32)],32)):H("",!0)]))}}),Yp=Ee(Xp,[["__scopeId","data-v-91127bd0"]]),Qp="/api/executor";async function Zs(n){try{const t=await fetch(`${Qp}/agent-execution/${n}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,t),null}}async function Zp(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Zs(n)}function em(){const n=et(),t=Ze(),e=A(null),s=A(null),a=A("config"),l=ae(()=>n.activeRootPlanId.value),r=v=>{if(!v)return null;for(const[N,G]of t.planExecutionRecords.entries())if((G.rootPlanId||G.currentPlanId)&&G.agentExecutionSequence)for(const b of G.agentExecutionSequence){if(b.stepId===v){const P=G.rootPlanId||G.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:v,rootPlanId:P,planId:N}),P||null}if(b.subPlanExecutionRecords)for(const P of b.subPlanExecutionRecords){const F=p(P,v);if(F)return F}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",v),null},p=(v,N)=>{if(!v||!v.agentExecutionSequence)return null;for(const G of v.agentExecutionSequence){if(G.stepId===N)return v.rootPlanId||v.currentPlanId||null;if(G.subPlanExecutionRecords)for(const U of G.subPlanExecutionRecords){const b=p(U,N);if(b)return b}}return null},y=ae(()=>s.value||l.value),i=ae(()=>!y.value),c=async v=>{if(console.log("[useRightPanel] Step selected:",{stepId:v}),!v){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}k("details"),console.log("[useRightPanel] Switched to details tab");try{const N=r(v);N?(s.value=N,console.log("[useRightPanel] Set selectedRootPlanId to:",N)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const G=await Zs(v);if(!G){console.warn("[useRightPanel] Agent execution detail not found for stepId:",v),e.value=null,s.value=null;return}const U={stepId:v,title:G.agentName??`Step ${v}`,description:G.agentDescription??"",agentExecution:G,completed:G.status==="FINISHED",current:G.status==="RUNNING"};e.value=U,console.log("[useRightPanel] Step details updated:",U),await xe(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(N){console.error("[useRightPanel] Error fetching step details:",N),e.value=null,s.value=null}},h=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const v=await Zp(e.value.stepId);v&&(e.value.agentExecution=v,e.value.completed=v.status==="FINISHED",e.value.current=v.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(v){console.error("[useRightPanel] Error refreshing step:",v)}},k=v=>{a.value=v,console.log("[useRightPanel] Active tab set to:",v)},_=v=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",v)},m=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},T=v=>{if(v===null||typeof v>"u"||v==="")return"N/A";if(typeof v=="object"&&v!==null)try{return JSON.stringify(v,null,2)}catch{return String(v)}if(typeof v=="string"){const N=v.trim();if(N==="")return"N/A";try{const G=JSON.parse(N);return JSON.stringify(G,null,2)}catch{return N}}return String(v)},$=()=>{e.value=null,s.value=null,a.value="config",console.log("[useRightPanel] State reset")};return{selectedStep:Ne(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:y,shouldShowNoTaskMessage:i,handleStepSelected:c,refreshCurrentStep:h,setActiveTab:k,updateDisplayedPlanProgress:_,clearSelectedStep:m,formatJson:T,reset:$}}let Ft=null;function Wt(){return Ft||(Ft=em()),Ft}const tm={class:"right-panel"},sm={class:"preview-header"},om={class:"preview-tabs"},nm={class:"preview-content"},am={key:0,class:"config-tab-content"},lm={key:0,class:"config-container"},rm={class:"template-info-header"},im={class:"template-info"},cm={class:"template-id"},um={key:1,class:"no-template-selected"},dm={class:"action-buttons"},pm=["title"],mm={class:"import-description"},fm={href:"https://github.com/Lynxe-public/Lynxe-public-prompts",target:"_blank",rel:"noopener noreferrer",class:"prompt-library-link"},hm={key:1,class:"step-details"},vm={key:0,class:"step-info"},gm={key:0,class:"agent-info"},ym={class:"info-item"},bm={class:"label"},_m=["title"],wm={class:"info-item"},$m={class:"label"},Sm={class:"value"},Pm={class:"execution-status"},Tm={class:"status-item"},Em={class:"status-text"},km={key:0},Cm={key:0,class:"think-act-steps"},Im={class:"steps-container"},Rm={class:"step-header"},xm={class:"step-number"},Am={class:"think-section"},Fm={class:"think-content"},Mm={class:"input"},Dm={class:"label"},Nm={class:"output"},Um={class:"label"},Lm={key:0,class:"action-section"},Om={class:"action-content"},qm={class:"tool-info"},Bm={class:"label"},Hm={class:"value"},Vm={class:"input"},jm={class:"label"},zm={class:"output"},Wm={class:"label"},Gm={key:0,class:"no-tools"},Km={key:0,class:"sub-plan-section"},Jm={class:"sub-plan-content"},Xm={class:"sub-plan-header"},Ym={class:"sub-plan-info"},Qm={class:"label"},Zm={class:"value"},ef={key:0,class:"sub-plan-info"},tf={class:"label"},sf={class:"value"},of={class:"sub-plan-status"},nf={class:"status-text"},af={key:0,class:"no-steps-message"},lf={key:1,class:"no-execution-message"},rf={class:"step-basic-info"},cf={class:"info-item"},uf={class:"label"},df={class:"value"},pf={key:0,class:"info-item"},mf={class:"label"},ff={class:"value"},hf={class:"info-item"},vf={class:"label"},gf={class:"no-execution-hint"},yf={key:2,class:"execution-indicator"},bf={class:"execution-text"},_f={key:1,class:"no-selection"},wf=["title"],$f={key:2,class:"file-browser-container"},Sf={key:1,class:"no-plan-message"},Pf={class:"message-content"},Tf={class:"tips"},Ef=Te({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:t}){const e=n,{t:s}=De(),a=wt(),l=Wt(),r=Ge(),p=at(),{handleImport:y}=bo(),i=A(),c=A(!1),h=A(!0),k=A(!0),_=ae(()=>l.selectedStep.value),m=ae({get:()=>l.activeTab.value,set:O=>l.setActiveTab(O)}),T=ae(()=>l.fileBrowserPlanId.value),$=ae(()=>l.shouldShowNoTaskMessage.value),v=ae(()=>_.value?_.value.completed?s("rightPanel.status.completed"):_.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),N=async()=>{try{const O=r.getPlanType()||"dynamic_agent";await de.createNewTemplate(O);const V=r.selectedTemplate.value;V&&(r.reset(),r.setPlanType(V.planType||"dynamic_agent"),V.planTemplateId&&r.setPlanTemplateId(V.planTemplateId),r.setTitle(V.title||"")),console.log("[RightPanel] ðŸ”„ Reloading available tools for new template"),await p.loadAvailableTools()}catch(O){console.error("[RightPanel] Failed to create new plan:",O);const V=O instanceof Error?O.message:s("rightPanel.createPlanFailed");a.error(V)}},G=async O=>{await y(O,{onSuccess:async V=>{const ee=s("rightPanel.importSuccess",{total:V.total,success:V.successCount,failed:V.failureCount});a.success(ee)},onError:V=>{const ee=V instanceof Error?V.message:s("rightPanel.importFailed");a.error(ee)},onReload:async()=>{await de.loadPlanTemplateList()},onSingleTemplateImported:async V=>{V.planTemplateId&&(r.setPlanTemplateId(V.planTemplateId),await r.load(V.planTemplateId))}})},U=async O=>{await l.handleStepSelected(O),setTimeout(()=>{F()},100),B()},b=async()=>{await l.refreshCurrentStep(),B()};ye(()=>e.selectedStepId,async O=>{O?await U(O):l.clearSelectedStep()},{immediate:!0});const P=O=>{i.value=O??void 0},F=()=>{if(!i.value)return;const{scrollTop:O,scrollHeight:V,clientHeight:ee}=i.value,Se=V-O-ee<50,X=V>ee;h.value=Se,c.value=X&&!Se,Se?k.value=!0:V-O-ee>100&&(k.value=!1)},L=()=>{i.value&&(i.value.scrollTo({top:i.value.scrollHeight,behavior:"smooth"}),xe(()=>{k.value=!0,F()}))},B=()=>{!k.value||!i.value||xe(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},S=l.formatJson,x=()=>{k.value=!0,i.value&&i.value.removeEventListener("scroll",F)},E=()=>{const O=()=>{const V=i.value;return V?(P(V),V.addEventListener("scroll",F),k.value=!0,F(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};xe(()=>{O()||setTimeout(()=>{O()},100)})};return Me(()=>{console.log("[RightPanel] Component mounted"),xe(()=>{E()})}),Ue(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),x()}),t({handleStepSelected:U,refreshCurrentStep:b,updateDisplayedPlanProgress:O=>{l.updateDisplayedPlanProgress(O)}}),(O,V)=>(f(),g("div",tm,[o("div",sm,[o("div",om,[o("div",{class:ve(["tab-item",{active:m.value==="config"}]),onClick:V[0]||(V[0]=ee=>m.value="config")},[R(d(D),{icon:"carbon:settings"}),o("span",null,u(d(s)("sidebar.configuration")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="details"}]),onClick:V[1]||(V[1]=ee=>m.value="details")},[R(d(D),{icon:"carbon:events"}),o("span",null,u(d(s)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="files"}]),onClick:V[2]||(V[2]=ee=>m.value="files")},[R(d(D),{icon:"carbon:folder"}),o("span",null,u(d(s)("fileBrowser.title")),1)],2)])]),o("div",nm,[m.value==="config"?(f(),g("div",am,[d(r).selectedTemplate.value?(f(),g("div",lm,[o("div",rm,[o("div",im,[o("h3",null,u(d(r).selectedTemplate.value.title||d(s)("sidebar.unnamedPlan")),1),o("span",cm,"ID: "+u(d(r).selectedTemplate.value.planTemplateId),1)]),o("button",{class:"back-to-list-btn",onClick:V[3]||(V[3]=ee=>d($s).switchToTab("list"))},[R(d(D),{icon:"carbon:arrow-left",width:"16"})])]),R(Yp),R(xc)])):(f(),g("div",um,[o("div",dm,[o("button",{class:"new-task-btn",onClick:N},[R(d(D),{icon:"carbon:add",width:"16"}),pe(" "+u(d(s)("rightPanel.newFuncAgentPlan")),1)]),o("label",{class:"new-task-btn",title:d(s)("rightPanel.importExistingPlan")},[R(d(D),{icon:"carbon:import",width:"16"}),pe(" "+u(d(s)("rightPanel.importExistingPlan"))+" ",1),o("input",{type:"file",accept:".json",onChange:G,style:{display:"none"}},null,32)],8,pm)]),o("p",mm,[pe(u(d(s)("rightPanel.importDescription"))+" ",1),o("a",fm,u(d(s)("rightPanel.promptLibrary")),1),pe(" "+u(d(s)("rightPanel.importDescriptionSuffix")),1)])]))])):H("",!0),m.value==="details"?(f(),g("div",hm,[_.value?(f(),g("div",vm,[o("h3",null,u(_.value.title||_.value.description||d(s)("rightPanel.defaultStepTitle",{number:1})),1),_.value.agentExecution?(f(),g("div",gm,[o("div",ym,[o("span",bm,u(d(s)("rightPanel.executingAgent"))+":",1),o("span",{class:"value",title:_.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.clickToViewExecutionDetails"):""},u(_.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.funcAgentExecutionDetails"):_.value.agentExecution.agentName),9,_m)]),o("div",wm,[o("span",$m,u(d(s)("rightPanel.callingModel"))+":",1),o("span",Sm,u(_.value.agentExecution.modelName),1)])])):H("",!0),o("div",Pm,[o("div",Tm,[_.value.completed?(f(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):_.value.current?(f(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(f(),$e(d(D),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",Em,u(v.value),1)])])])):H("",!0),o("div",{ref_key:"scrollContainer",ref:i,class:"step-details-scroll-container",onScroll:F},[_.value?(f(),g("div",km,[_.value.agentExecution?.thinkActSteps&&_.value.agentExecution.thinkActSteps.length>0?(f(),g("div",Cm,[o("h4",null,u(d(s)("rightPanel.thinkAndActionSteps")),1),o("div",Im,[(f(!0),g(fe,null,ge(_.value.agentExecution.thinkActSteps,(ee,Se)=>(f(),g("div",{key:Se,class:"think-act-step"},[o("div",Rm,[o("span",xm,"#"+u(Se+1),1),o("span",{class:ve(["step-status",ee.status])},u(ee.status||d(s)("rightPanel.executing")),3)]),o("div",Am,[o("h5",null,[R(d(D),{icon:"carbon:thinking"}),pe(" "+u(d(s)("rightPanel.thinking")),1)]),o("div",Fm,[o("div",Mm,[o("span",Dm,u(d(s)("rightPanel.input"))+":",1),o("pre",null,u(d(S)(ee.thinkInput)),1)]),o("div",Nm,[o("span",Um,u(d(s)("rightPanel.output"))+":",1),o("pre",null,u(d(S)(ee.thinkOutput)),1)])])]),ee.actionNeeded?(f(),g("div",Lm,[o("h5",null,[R(d(D),{icon:"carbon:play"}),pe(" "+u(d(s)("rightPanel.action")),1)]),o("div",Om,[(f(!0),g(fe,null,ge(ee.actToolInfoList||[],(X,ce)=>(f(),g("div",{key:`tool-${ce}-${X?.id||X?.name||ce}`,class:"tool-execution-item"},[o("div",qm,[o("span",Bm,u(d(s)("rightPanel.tool"))+":",1),o("span",Hm,u(X?.name||"N/A"),1)]),o("div",Vm,[o("span",jm,u(d(s)("rightPanel.toolParameters"))+":",1),o("pre",null,u(d(S)(X?.parameters)),1)]),o("div",zm,[o("span",Wm,u(d(s)("rightPanel.executionResult"))+":",1),o("pre",null,u(d(S)(X?.result)),1)])]))),128)),!ee.actToolInfoList||ee.actToolInfoList.length===0?(f(),g("div",Gm,[o("p",null,u(d(s)("rightPanel.noToolsExecuted")),1)])):H("",!0)]),ee.subPlanExecutionRecord?(f(),g("div",Km,[o("h5",null,[R(d(D),{icon:"carbon:tree-view"}),pe(" "+u(d(s)("rightPanel.subPlan")),1)]),o("div",Jm,[o("div",Xm,[o("div",Ym,[o("span",Qm,u(O.$t("rightPanel.subPlanId"))+":",1),o("span",Zm,u(ee.subPlanExecutionRecord.currentPlanId),1)]),ee.subPlanExecutionRecord.title?(f(),g("div",ef,[o("span",tf,u(O.$t("rightPanel.title"))+":",1),o("span",sf,u(ee.subPlanExecutionRecord.title),1)])):H("",!0),o("div",of,[ee.subPlanExecutionRecord.completed?(f(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(f(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",nf,u(ee.subPlanExecutionRecord.completed?O.$t("rightPanel.status.completed"):O.$t("rightPanel.status.executing")),1)])])])])):H("",!0)])):H("",!0)]))),128))]),_.value.agentExecution&&!_.value.agentExecution.thinkActSteps?.length?(f(),g("div",af,[o("p",null,u(d(s)("rightPanel.noStepDetails")),1)])):_.value.agentExecution?H("",!0):(f(),g("div",lf,[R(d(D),{icon:"carbon:information",class:"info-icon"}),o("h4",null,u(d(s)("rightPanel.stepInfo")),1),o("div",rf,[o("div",cf,[o("span",uf,u(d(s)("rightPanel.stepName"))+":",1),o("span",df,u(_.value.title||_.value.description||_.value.stepId),1)]),_.value.description?(f(),g("div",pf,[o("span",mf,u(O.$t("rightPanel.description"))+":",1),o("span",ff,u(_.value.description),1)])):H("",!0),o("div",hf,[o("span",vf,u(O.$t("rightPanel.status.label"))+":",1),o("span",{class:ve(["value",{"status-completed":_.value.completed,"status-current":_.value.current,"status-pending":!_.value.completed&&!_.value.current}])},u(_.value.completed?O.$t("rightPanel.status.completed"):_.value.current?O.$t("rightPanel.status.executing"):O.$t("rightPanel.status.pending")),3)])]),o("p",gf,u(d(s)("rightPanel.noExecutionInfo")),1)])),_.value.current&&!_.value.completed?(f(),g("div",yf,[V[4]||(V[4]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",bf,[R(d(D),{icon:"carbon:in-progress",class:"rotating-icon"}),pe(" "+u(d(s)("rightPanel.stepExecuting")),1)])])):H("",!0)])):(f(),g("div",_f,[R(d(D),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,u(d(s)("rightPanel.noStepSelected")),1),o("p",null,u(d(s)("rightPanel.selectStepHint")),1)]))])):H("",!0),R(_t,{name:"scroll-button"},{default:ze(()=>[c.value?(f(),g("button",{key:0,onClick:L,class:"scroll-to-bottom-btn",title:d(s)("rightPanel.scrollToBottom")},[R(d(D),{icon:"carbon:chevron-down"})],8,wf)):H("",!0)]),_:1})],544)])):H("",!0),m.value==="files"?(f(),g("div",$f,[T.value?(f(),$e(ei,{key:0,"plan-id":T.value},null,8,["plan-id"])):$.value?(f(),g("div",Sf,[R(d(D),{icon:"carbon:folder-off"}),o("div",Pf,[o("h3",null,u(d(s)("fileBrowser.noFilesYet")),1),o("p",null,u(d(s)("fileBrowser.noPlanExecuting")),1),o("div",Tf,[R(d(D),{icon:"carbon:information"}),o("span",null,u(d(s)("fileBrowser.startTaskTip")),1)])])])):H("",!0)])):H("",!0)])]))}}),kf=Ee(Ef,[["__scopeId","data-v-afdd35f3"]]),Cf={class:"template-list-container"},If={class:"organization-section"},Rf={class:"organization-row"},xf={class:"organization-selector"},Af={class:"organization-label"},Ff=["value"],Mf={value:"by_time"},Df={value:"by_abc"},Nf={value:"by_group_time"},Uf={value:"by_group_abc"},Lf={class:"search-input-wrapper"},Of={class:"search-label"},qf={class:"search-input-container"},Bf=["placeholder"],Hf=["title"],Vf={class:"sidebar-content-list"},jf={key:0,class:"loading-state"},zf={key:1,class:"error-state"},Wf={key:2,class:"empty-state"},Gf=["onClick","title"],Kf=["onClick","title"],Jf={class:"group-name"},Xf={class:"group-count"},Yf=["onClick"],Qf={class:"task-icon"},Zf={class:"task-details"},eh={class:"task-title"},th={class:"task-time"},sh={class:"task-actions"},oh=["title","onClick"],nh={class:"confirm-header"},ah={class:"confirm-content"},lh={class:"confirm-actions"},rh=["disabled"],ih=Te({__name:"TemplateList",emits:["templateSelected"],setup(n,{emit:t}){const{t:e}=De(),s=Ge(),a=Wt(),l=wt(),r=A(""),p=A(!1),y=A(null),i=A(!1),c=t,h=U=>{const b=U.target;de.setOrganizationMethod(b.value)},k=U=>{if(isNaN(U.getTime()))return console.warn("Invalid date received:",U),e("time.unknown");const P=new Date().getTime()-U.getTime(),F=Math.floor(P/6e4),L=Math.floor(P/36e5),B=Math.floor(P/864e5);return F<1?e("time.now"):F<60?e("time.minuteAgo",{count:F}):L<24?e("time.hourAgo",{count:L}):B<30?e("time.dayAgo",{count:B}):U.toLocaleDateString("zh-CN")},_=ae(()=>{s.planTemplateList.value;const U=r.value.trim().toLowerCase(),b=de.groupedTemplates;if(!U)return b;const P=new Map;for(const[F,L]of b){const B=[];for(const S of L)(S.title||"").toLowerCase().includes(U)&&B.push(S);B.length>0&&P.set(F,B)}return P});ye(r,U=>{s.planTemplateList.value;const b=U.trim().toLowerCase();if(!b||de.organizationMethod!=="by_group_time"&&de.organizationMethod!=="by_group_abc")return;const P=de.groupedTemplates;for(const[F,L]of P){let B=!1;for(const S of L)if((S.title||"").toLowerCase().includes(b)){B=!0;break}B&&de.isGroupCollapsed(F)&&de.toggleGroupCollapse(F)}});const m=U=>{const b=U??"null";return de.groupCollapseState[b]??!1},T=U=>{de.toggleGroupCollapse(U)},$=async U=>{a.setActiveTab("config"),await de.selectTemplate(U),U.planTemplateId?(await s.load(U.planTemplateId),de.hasTaskRequirementModified=!1):(s.reset(),de.hasTaskRequirementModified=!1),c("templateSelected",U)},v=U=>{y.value=U,p.value=!0},N=async()=>{if(y.value){i.value=!0;try{await de.deleteTemplate(y.value),p.value=!1,y.value=null,l.success(e("sidebar.deleteSuccess")||"Template deleted successfully")}catch(U){console.error("Failed to delete template:",U),l.error(e("sidebar.deleteFailed")||`Delete failed: ${U instanceof Error?U.message:String(U)}`)}finally{i.value=!1}}},G=()=>{p.value=!1,y.value=null};return(U,b)=>(f(),g(fe,null,[o("div",Cf,[o("div",If,[o("div",Rf,[o("div",xf,[o("label",Af,u(U.$t("sidebar.organizationLabel")),1),o("select",{value:d(de).organizationMethod,onChange:h,class:"organization-select"},[o("option",Mf,u(U.$t("sidebar.organizationByTime")),1),o("option",Df,u(U.$t("sidebar.organizationByAbc")),1),o("option",Nf,u(U.$t("sidebar.organizationByGroupTime")),1),o("option",Uf,u(U.$t("sidebar.organizationByGroupAbc")),1)],40,Ff)]),o("div",Lf,[o("label",Of,u(U.$t("sidebar.searchLabel")),1),o("div",qf,[R(d(D),{icon:"carbon:search",width:"16",class:"search-icon"}),_e(o("input",{"onUpdate:modelValue":b[0]||(b[0]=P=>r.value=P),type:"text",class:"search-input",placeholder:U.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Bf),[[Ce,r.value]]),r.value?(f(),g("button",{key:0,class:"search-clear-btn",onClick:b[1]||(b[1]=P=>r.value=""),title:U.$t("sidebar.clearSearch")||"Clear search"},[R(d(D),{icon:"carbon:close",width:"14"})],8,Hf)):H("",!0)])])])]),o("div",Vf,[d(de).isLoading?(f(),g("div",jf,[R(d(D),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,u(U.$t("sidebar.loading")),1)])):d(de).errorMessage?(f(),g("div",zf,[R(d(D),{icon:"carbon:warning",width:"20"}),o("span",null,u(d(de).errorMessage),1),o("button",{onClick:b[2]||(b[2]=(...P)=>d(de).loadPlanTemplateList&&d(de).loadPlanTemplateList(...P)),class:"retry-btn"},u(U.$t("sidebar.retry")),1)])):d(s).planTemplateList.value.length===0?(f(),g("div",Wf,[R(d(D),{icon:"carbon:document",width:"32"}),o("span",null,u(U.$t("sidebar.noTemplates")),1)])):(f(!0),g(fe,{key:3},ge(_.value,([P,F])=>(f(),g(fe,{key:P||"ungrouped"},[(d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc")&&F.length>0?(f(),g("div",{key:0,class:"group-header",onClick:we(L=>T(P),["prevent"]),title:m(P)?U.$t("sidebar.expandGroup"):U.$t("sidebar.collapseGroup")},[o("button",{type:"button",class:"group-toggle-btn",onClick:we(L=>T(P),["stop","prevent"]),title:m(P)?U.$t("sidebar.expandGroup"):U.$t("sidebar.collapseGroup")},[R(d(D),{icon:m(P)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Kf),R(d(D),{icon:"carbon:folder",width:"16"}),o("span",Jf,u(P===null||P===""?U.$t("sidebar.ungroupedMethods"):P),1),o("span",Xf,"("+u(F.length)+")",1)],8,Gf)):H("",!0),(d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc")&&m(P)?H("",!0):(f(!0),g(fe,{key:1},ge(F,L=>(f(),g("div",{key:L.planTemplateId||"unknown",class:ve(["sidebar-content-list-item",{"sidebar-content-list-item-active":L.planTemplateId===d(s).currentPlanTemplateId.value,"grouped-item":d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc"}]),onClick:B=>$(L)},[o("div",Qf,[R(d(D),{icon:"carbon:document",width:"20"})]),o("div",Zf,[o("div",eh,u(L.title||U.$t("sidebar.unnamedPlan")),1)]),o("div",th,u(k(d(s).parseDateTime(L.updateTime||L.createTime))),1),o("div",sh,[o("button",{class:"delete-task-btn",title:U.$t("sidebar.deleteTemplate"),onClick:we(B=>v(L),["stop"])},[R(d(D),{icon:"carbon:close",width:"16"})],8,oh)])],10,Yf))),128))],64))),128))])]),(f(),$e(ws,{to:"body"},[R(_t,{name:"modal"},{default:ze(()=>[p.value?(f(),g("div",{key:0,class:"modal-overlay",onClick:G},[o("div",{class:"confirm-modal",onClick:b[3]||(b[3]=we(()=>{},["stop"]))},[o("div",nh,[R(d(D),{icon:"carbon:warning",class:"warning-icon"}),o("h3",null,u(U.$t("sidebar.deleteConfirm")),1)]),o("div",ah,[o("p",null,u(U.$t("sidebar.deleteConfirmMessage",{templateName:y.value?.title||""})),1)]),o("div",lh,[o("button",{class:"confirm-btn cancel-btn",onClick:G},u(U.$t("common.cancel")),1),o("button",{class:"confirm-btn delete-btn",onClick:N,disabled:i.value},[R(d(D),{icon:i.value?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),pe(" "+u(U.$t("common.delete")),1)],8,rh)])])])):H("",!0)]),_:1})]))],64))}}),ch=Ee(ih,[["__scopeId","data-v-afbd5426"]]),uh={class:"sidebar-content"},dh={class:"sidebar-content-header"},ph={class:"sidebar-content-title"},mh={class:"tab-content"},fh=Te({name:"SidebarPanel",__name:"Sidebar",props:{width:{}},setup(n,{expose:t}){const e=n,s=at(),a=Ge(),l=Wt(),r=async()=>{const p=a.getPlanType()||"dynamic_agent";await de.createNewTemplate(p);const y=a.selectedTemplate.value;y&&(a.reset(),a.setPlanType(y.planType||"dynamic_agent"),y.planTemplateId&&a.setPlanTemplateId(y.planTemplateId),a.setTitle(y.title||"")),l.setActiveTab("config"),console.log("[Sidebar] ðŸ”„ Reloading available tools for new template"),await s.loadAvailableTools()};return Me(async()=>{await de.loadPlanTemplateList(),s.loadAvailableTools()}),t({loadPlanTemplateList:de.loadPlanTemplateList,toggleSidebar:$s.toggleSidebar}),(p,y)=>(f(),g("div",{class:"sidebar-wrapper",style:Ye({width:e.width+"%"})},[o("div",uh,[o("div",dh,[o("div",ph,u(p.$t("sidebar.title")),1),o("button",{class:"new-task-btn",onClick:r},[R(d(D),{icon:"carbon:add",width:"16"}),pe(" "+u(p.$t("sidebar.newPlan")),1)])]),o("div",mh,[R(ch)])])],4))}}),hh=Ee(fh,[["__scopeId","data-v-0414be7c"]]);function vh(){const n=et(),t=Ze(),{showToast:e}=Ps(),{t:s}=De(),a=i=>{const c={currentPlanId:i.currentPlanId,status:i.completed?"completed":"running"};return i.rootPlanId&&(c.rootPlanId=i.rootPlanId),i.summary&&(c.summary=i.summary),i.completed!==void 0&&(c.completed=i.completed),i.agentExecutionSequence&&(c.agentExecutionSequence=i.agentExecutionSequence),c},l=i=>{if(!i)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(i)){const[c,h,k,_=0,m=0,T=0,$=0]=i,v=new Date(c,h-1,k,_,m,T,Math.floor($/1e6));return isNaN(v.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",i),new Date):v}if(typeof i=="string"){let c=new Date(i);if(!isNaN(c.getTime()))return c;const h=i.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(h){const[,k,_,m,T,$,v,N]=h;if(c=new Date(parseInt(k),parseInt(_)-1,parseInt(m),parseInt(T),parseInt($),parseInt(v),N?parseInt(N.substring(0,3)):0),!isNaN(c.getTime()))return c}return!i.includes("Z")&&!i.includes("+")&&!i.includes("-",10)&&(c=new Date(i+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",i),new Date)}if(typeof i=="number"){const c=i.toString().length<13?i*1e3:i,h=new Date(c);return isNaN(h.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",i),new Date):h}return console.warn("[useConversationHistory] Unknown date format:",i,typeof i),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",i,c),new Date}},r=i=>{if(!i)return;console.log("[useConversationHistory] Processing record:",{userRequest:i.userRequest,startTime:i.startTime,startTimeType:typeof i.startTime,endTime:i.endTime,endTimeType:typeof i.endTime});const c=i.userRequest||i.title||"History Round",h=n.createDialog(c),k=Ie.getConversationId();if(k){const _=n.getDialog(h.id);_&&(_.conversationId=k,i.rootPlanId&&(_.planId=i.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",h.id,k))}if(i.userRequest&&i.startTime){const _=l(i.startTime);console.log("[useConversationHistory] Parsed date:",{original:i.startTime,parsed:_,parsedISO:_.toISOString(),isValid:!isNaN(_.getTime())});const m={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:i.userRequest,timestamp:_,isStreaming:!1};n.addMessageToDialog(h.id,m)}if(i.currentPlanId){const _=i.summary||i.result||i.message||"Execution completed",m=a(i),T={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:_,timestamp:i.endTime&&i.endTime?l(i.endTime):i.startTime?l(i.startTime):new Date,isStreaming:!1,planExecution:m};n.addMessageToDialog(h.id,T),i.rootPlanId&&t.setCachedPlanRecord(i.rootPlanId,m)}},p=async(i,c=!1,h=!0)=>{if(!i){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&n.clearMessages(),Ie.setConversationId(i),n.setConversationId(i);const k=await ft.getConversationHistory(i);if(console.log("[useConversationHistory] Loaded conversation history:",k),k.length>0){const _=k[0];console.log("[useConversationHistory] Sample date formats:",{startTime:_.startTime,endTime:_.endTime,startTimeType:typeof _.startTime})}for(const _ of k)r(_);console.log("[useConversationHistory] Successfully loaded conversation history with",k.length,"dialog rounds")}catch(k){throw console.error("[useConversationHistory] Failed to load conversation history:",k),h&&e(s("memory.loadHistoryFailed"),"error"),k}};return{loadConversationHistory:p,restoreConversationHistory:async i=>p(i,!1,!1),processHistoryRecord:r}}let Mt=null;function gh(){return Mt||(Mt=vh()),Mt}const yh={class:"direct-page"},bh={class:"branding-header"},_h={class:"branding-content"},wh={class:"branding-actions"},$h=["title"],Sh={class:"direct-chat"},Ph=["title"],Th=["title"],Eh={class:"chat-header"},kh={class:"header-actions"},Ch=["title"],Ih=["title"],Rh={class:"chat-content"},xh={class:"message-content"},Ah=Te({name:"DirectIndex",__name:"index",setup(n){const t=ho(),e=vo(),s=yt(),{toast:a}=Ps(),l=et(),r=Ze(),p=gh(),y=A(""),i=A(),c=A(),h=A(null),k=A(50),_=A(80),m=A(!1),T=A(0),$=A(0),v=A(!1),N=A(0),G=A(0);Me(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),ye(()=>r.planExecutionRecords,ue=>{for(const[M,j]of ue.entries())E(M)&&(i.value&&typeof i.value.updateDisplayedPlanProgress=="function"&&i.value.updateDisplayedPlanProgress(M),j.completed&&M===h.value&&(Array.from(ue.entries()).some(([se,le])=>se!==M&&le&&!le.completed&&le.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),h.value=null)))},{deep:!0}),ye(()=>r.trackedPlanIds,ue=>{if(!h.value&&ue.value.size>0){const M=Array.from(ue.value)[0];h.value=M,console.log("[Direct] Set currentRootPlanId to:",M)}},{deep:!0});const X=Ie.getConversationId();if(X&&(console.log("[Direct] Found saved conversationId, restoring conversation:",X),xe(async()=>{try{await p.restoreConversationHistory(X)}catch(ue){console.error("[DirectView] Failed to restore conversation history:",ue)}})),de.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const ue=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",ue),ue.trim()?(s.markTaskAsProcessed(),xe(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",ue),await l.sendMessage({input:ue})}catch(M){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",M),y.value=ue}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(y.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",y.value),console.log("[Direct] No unprocessed task in store"));const ce=localStorage.getItem("directPanelWidth");ce&&(k.value=parseFloat(ce));const ke=localStorage.getItem("sidebarWidth");ke&&(_.value=parseFloat(ke)),console.log("[Direct] Final prompt value:",y.value)}),ye(()=>s.currentTask,X=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",X),X&&!X.processed&&X.prompt.trim()){const ce=X.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",ce),xe(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",ce),await l.sendMessage({input:ce})}catch(ke){console.warn("[Direct] messageDialog.sendMessage failed for new task:",ke)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ye(()=>y.value,(X,ce)=>{console.log("[Direct] prompt value changed from:",ce,"to:",X)},{immediate:!1}),Ue(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),h.value=null,r.cleanup(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",P),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",S)});const U=X=>{m.value=!0,T.value=X.clientX,$.value=k.value,document.addEventListener("mousemove",b),document.addEventListener("mouseup",P),document.body.style.cursor="col-resize",document.body.style.userSelect="none",X.preventDefault()},b=X=>{if(!m.value)return;const ce=window.innerWidth,ue=-(X.clientX-T.value)/ce*100;let M=$.value+ue;M=Math.max(20,Math.min(80,M)),k.value=M},P=()=>{m.value=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",P),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",k.value.toString())},F=()=>{k.value=50,localStorage.setItem("directPanelWidth","50")},L=X=>{v.value=!0,N.value=X.clientX,G.value=_.value,document.addEventListener("mousemove",B),document.addEventListener("mouseup",S),document.body.style.cursor="col-resize",document.body.style.userSelect="none",X.preventDefault()},B=X=>{if(!v.value)return;const ce=window.innerWidth,ue=(X.clientX-N.value)/ce*100;let M=G.value+ue;M=Math.max(15,Math.min(100,M)),_.value=M},S=()=>{v.value=!1,document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",S),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",_.value.toString())},x=()=>{_.value=80,localStorage.setItem("sidebarWidth","80")},E=(X,ce=!1)=>!h.value||X===h.value||ce&&(X==="ui-state"||X==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",X,"current:",h.value),!1),q=X=>{console.log("[DirectView] Step selected:",X),i.value&&typeof i.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to config/preview panel:",X),i.value.handleStepSelected(X)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},O=()=>{e.push("/home")},V=()=>{e.push("/configs")},ee=async()=>{if(Ie.selectMemoryId){console.log("[DirectView] Memory selected:",Ie.selectMemoryId);try{await p.loadConversationHistory(Ie.selectMemoryId,!0,!0)}catch(X){console.error("[DirectView] Failed to load conversation history:",X)}}},Se=()=>{Ie.clearMemoryId(),Ie.clearConversationId(),l.reset()};return(X,ce)=>(f(),g("div",yh,[o("header",bh,[o("div",_h,[ce[1]||(ce[1]=o("div",{class:"branding-logo"},[o("img",{src:po,alt:"Lynxe",class:"java-logo"}),o("h1",null,"Lynxe")],-1)),o("div",wh,[R(yo),o("button",{class:"back-button",onClick:O},[R(d(D),{icon:"carbon:arrow-left"})]),o("button",{class:"config-button",onClick:V,title:X.$t("direct.configuration")},[R(d(D),{icon:"carbon:settings-adjust",width:"20"})],8,$h)])])]),o("div",Sh,[R(hh,{ref_key:"sidebarRef",ref:c,width:_.value},null,8,["width"]),o("div",{class:"panel-resizer",onMousedown:L,onDblclick:x,title:X.$t("sidebar.resizeHint")},ce[2]||(ce[2]=[o("div",{class:"resizer-line"},null,-1)]),40,Ph),R(kf,{ref_key:"rightPanelRef",ref:i,style:Ye({width:100-_.value-k.value+"%"}),"current-root-plan-id":h.value},null,8,["style","current-root-plan-id"]),o("div",{class:"panel-resizer",onMousedown:U,onDblclick:F,title:X.$t("direct.panelResizeHint")},ce[3]||(ce[3]=[o("div",{class:"resizer-line"},null,-1)]),40,Th),o("div",{class:"left-panel",style:Ye({width:k.value+"%"})},[o("div",Eh,[o("h2",null,u(X.$t("conversation")),1),o("div",kh,[o("button",{class:"config-button",onClick:Se,title:X.$t("memory.newChat")},[R(d(D),{icon:"carbon:add",width:"20"})],8,Ch),o("button",{class:"cron-task-btn",onClick:ce[0]||(ce[0]=ke=>d(Ie).toggleSidebar()),title:X.$t("memory.selectMemory")},[R(d(D),{icon:"carbon:calendar",width:"20"})],8,Ih)])]),o("div",Rh,[R(ol,{onStepSelected:q})]),(f(),$e(Tl,{key:X.$i18n.locale,"initial-value":y.value},null,8,["initial-value"]))],4)]),R(hr,{onMemorySelected:ee}),d(a).show?(f(),g("div",{key:0,class:ve(["message-toast",d(a).type])},[o("div",xh,[o("span",null,u(d(a).text),1)])],2)):H("",!0)]))}}),nv=Ee(Ah,[["__scopeId","data-v-4b41408b"]]);export{nv as default};
//# sourceMappingURL=index-ehhGOo1T.js.map
