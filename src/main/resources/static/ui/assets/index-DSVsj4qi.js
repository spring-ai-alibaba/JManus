import{d as _e,u as De,a as b,b as h,n as ce,e as n,f as O,g as A,i as u,h as ie,t as i,y as We,F as ue,q as me,j as ve,l as ge,A as ps,c as te,B as nt,r as F,o as Fe,C as de,D as Le,w as fe,m as Se,E as Ut,G as xt,v as Zs,H as ms,I as Ue,J as hs,z as Re,T as Lt,p as Ge,K as eo,M as to,N as st,O as so,x as oo}from"./index-flMhGIYM.js";import{I as D,_ as we}from"./_plugin-vue_export-helper-CzTF9OYf.js";import{u as vt,P as no,m as Pe,D as Wt,a as Je,s as Ie,t as re,b as ao}from"./templateStore-BzNwvZlh.js";import{L as lo}from"./LanguageSwitcher-C2dqn6CM.js";import{M as fs,u as vs,a as gs}from"./useToast-36JHbEMa.js";import"./llm-check-CJy4TeZw.js";const ro={class:"sub-plan-info"},io={class:"sub-plan-details"},co={class:"sub-plan-title"},uo={key:0,class:"nesting-level"},po={class:"sub-plan-id"},mo={class:"sub-plan-meta"},ho={key:0,class:"trigger-tool"},fo={class:"trigger-text"},vo={key:0,class:"sub-plan-progress"},go={class:"progress-info"},bo={class:"progress-text"},yo={class:"progress-bar"},_o={key:1,class:"sub-plan-agents-steps"},wo={class:"agents-steps-header"},$o={class:"agents-label"},So={class:"agents-steps-list"},ko=["onClick"],Eo={class:"agent-step-header"},Po=["title"],To={class:"sub-agent-execution-info"},Co={key:0,class:"agent-result"},Io={class:"result-header"},Ro={class:"result-label"},xo={class:"result-content"},Ao={key:1,class:"agent-error"},Fo={class:"error-header"},Do={class:"error-label"},Mo={class:"error-content"},No={key:2,class:"think-act-preview"},Uo={class:"think-act-header"},Lo={class:"think-act-label"},Oo={class:"think-act-steps-preview"},Bo=["onClick"],qo={class:"step-number"},Vo={class:"step-description"},jo={key:0,class:"more-steps"},Ho={class:"more-steps-text"},zo={key:3,class:"nested-sub-plans"},Wo={class:"nested-sub-plans-header"},Go={class:"nested-label"},Ko={class:"nested-sub-plans-list"},Jo={key:4,class:"direct-sub-plans"},Xo={class:"direct-sub-plans-header"},Qo={class:"direct-label"},Yo={class:"direct-sub-plans-list"},Zo=_e({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=o,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(G=>G.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(G=>G.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},f=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},p=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const w=c();return Math.min(100,w/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(w=>w.status==="FINISHED").length:0,v=w=>{switch(w){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},P=w=>{switch(w){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},x=w=>{switch(w){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},d=w=>w.thinkActSteps?.some(N=>N.subPlanExecutionRecord)??!1,k=w=>w.thinkActSteps?.filter(N=>N.subPlanExecutionRecord)??[],y=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},g=(w,N)=>{const G=N.stepId??`subplan-${e.subPlanIndex}-agent-${w}`;s("step-selected",G)},I=(w,N,G)=>{const R=G.stepId??`subplan-${e.subPlanIndex}-agent-${w}`;s("step-selected",R)},C=(w,N,G)=>{s("sub-plan-selected",w,N,G)},M=w=>{s("step-selected",w)};return(w,N)=>{const G=ps("RecursiveSubPlan",!0);return h(),b("div",{class:ce(["recursive-sub-plan",l()])},[n("div",{class:"sub-plan-header",onClick:y},[n("div",ro,[A(u(D),{icon:f(),class:"sub-plan-status-icon"},null,8,["icon"]),n("div",io,[n("div",co,[ie(i(w.subPlan.title||w.$t("chat.subPlan"))+" #"+i(w.subPlanIndex+1)+" ",1),(w.nestingLevel??0)>0?(h(),b("span",uo,"(L"+i((w.nestingLevel??0)+1)+")",1)):O("",!0)]),n("div",po,i(w.subPlan.currentPlanId),1)])]),n("div",mo,[n("div",{class:ce(["sub-plan-status-badge",r()])},i(m()),3),w.subPlan.parentActToolCall?(h(),b("div",ho,[A(u(D),{icon:"carbon:function",class:"trigger-icon"}),n("span",fo,i(w.subPlan.parentActToolCall.name),1)])):O("",!0)])]),w.subPlan.agentExecutionSequence?.length?(h(),b("div",vo,[n("div",go,[n("span",bo,i(w.$t("chat.progress"))+": "+i(c())+" / "+i(w.subPlan.agentExecutionSequence.length),1),n("div",yo,[n("div",{class:"progress-fill",style:We({width:p()+"%"})},null,4)])])])):O("",!0),w.subPlan.agentExecutionSequence?.length?(h(),b("div",_o,[n("div",wo,[n("span",$o,i(w.$t("chat.agentExecutions"))+":",1)]),n("div",So,[(h(!0),b(ue,null,me(w.subPlan.agentExecutionSequence,(R,H)=>(h(),b("div",{key:R.id||H,class:ce(["agent-step-item",v(R.status)]),onClick:S=>g(H,R)},[n("div",Eo,[A(u(D),{icon:P(R.status),class:"agent-icon"},null,8,["icon"]),n("span",{class:"agent-name",title:R.agentName==="ConfigurableDynaAgent"?w.$t("chat.clickToViewExecutionDetails"):""},i(R.agentName==="ConfigurableDynaAgent"?w.$t("chat.funcAgentExecutionDetails"):R.agentName||w.$t("chat.unknownAgent")),9,Po),n("div",{class:ce(["agent-status-badge",v(R.status)])},i(x(R.status)),3)]),n("div",To,[R.result?(h(),b("div",Co,[n("div",Io,[A(u(D),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Ro,i(w.$t("chat.agentResult"))+":",1)]),n("pre",xo,i(R.result),1)])):O("",!0),R.errorMessage?(h(),b("div",Ao,[n("div",Fo,[A(u(D),{icon:"carbon:warning",class:"error-icon"}),n("span",Do,i(w.$t("chat.errorMessage"))+":",1)]),n("pre",Mo,i(R.errorMessage),1)])):O("",!0),R.thinkActSteps?.length?(h(),b("div",No,[n("div",Uo,[A(u(D),{icon:"carbon:thinking",class:"think-act-icon"}),n("span",Lo,i(w.$t("chat.thinkActSteps"))+" ("+i(R.thinkActSteps.length)+")",1)]),n("div",Oo,[(h(!0),b(ue,null,me(R.thinkActSteps.slice(0,w.maxVisibleSteps??2),(S,_)=>(h(),b("div",{key:S.id||_,class:"think-act-step-preview",onClick:ve($=>I(H,_,R),["stop"])},[n("span",qo,"#"+i(_+1),1),n("span",Vo,i(S.actionDescription||w.$t("chat.thinking")),1),A(u(D),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Bo))),128)),R.thinkActSteps.length>(w.maxVisibleSteps??2)?(h(),b("div",jo,[n("span",Ho,i(w.$t("chat.andMoreSteps",{count:R.thinkActSteps.length-(w.maxVisibleSteps??2)})),1)])):O("",!0)])])):O("",!0),d(R)?(h(),b("div",zo,[n("div",Wo,[A(u(D),{icon:"carbon:tree-view-alt",class:"nested-icon"}),n("span",Go,i(w.$t("chat.nestedSubPlans")),1)]),n("div",Ko,[(h(!0),b(ue,null,me(k(R),(S,_)=>(h(),ge(G,{key:S.id||_,"sub-plan":S.subPlanExecutionRecord,"sub-plan-index":_,"nesting-level":(w.nestingLevel??0)+1,"max-nesting-depth":w.maxNestingDepth??3,"max-visible-steps":w.maxVisibleSteps??2,onSubPlanSelected:C,onStepSelected:M},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0),R.subPlanExecutionRecords?.length?(h(),b("div",Jo,[n("div",Xo,[A(u(D),{icon:"carbon:tree-view",class:"direct-icon"}),n("span",Qo,i(w.$t("chat.directSubPlans")),1)]),n("div",Yo,[(h(!0),b(ue,null,me(R.subPlanExecutionRecords,(S,_)=>(h(),ge(G,{key:S.currentPlanId||_,"sub-plan":S,"sub-plan-index":_,"nesting-level":(w.nestingLevel??0)+1,"max-nesting-depth":w.maxNestingDepth??3,"max-visible-steps":w.maxVisibleSteps??2,onSubPlanSelected:C,onStepSelected:M},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0)])],10,ko))),128))])])):O("",!0)],2)}}}),en=we(Zo,[["__scopeId","data-v-36486b62"]]),tn={class:"execution-details"},sn={key:0,class:"plan-overview"},on={key:0,class:"parent-tool-call"},nn={class:"parent-tool-header"},an={class:"tool-label"},ln={class:"tool-name"},rn={key:0,class:"tool-parameters"},cn={class:"param-label"},un={class:"param-content"},dn={key:1,class:"agent-execution-container"},pn={class:"section-title"},mn=["onClick"],hn={class:"agent-info"},fn={class:"agent-details"},vn=["title"],gn={class:"request-content"},bn={class:"agent-controls"},yn={class:"agent-execution-info"},_n={key:0,class:"agent-result"},wn={class:"result-header"},$n={class:"result-label"},Sn={class:"result-content"},kn={key:1,class:"agent-error"},En={class:"error-header"},Pn={class:"error-label"},Tn={class:"error-content"},Cn={key:0,class:"sub-plans-container"},In={class:"sub-plans-header"},Rn={class:"sub-plans-title"},xn={class:"sub-plans-list"},An=_e({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=t,{t:s}=De(),a=v=>{v.stepId?e("step-selected",v.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",v)},l=v=>{switch(v){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=v=>{switch(v){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},m=v=>{switch(v){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},f=(v,P,x)=>{e("sub-plan-selected",v,P,x)},p=v=>{e("step-selected",v)},c=v=>{if(!v)return"";try{const P=JSON.parse(v);return JSON.stringify(P,null,2)}catch{return v}};return(v,P)=>(h(),b("div",tn,[v.planExecution?(h(),b("div",sn,[v.planExecution.parentActToolCall?(h(),b("div",on,[n("div",nn,[A(u(D),{icon:"carbon:flow",class:"tool-icon"}),n("span",an,i(v.$t("chat.triggeredByTool"))+":",1),n("span",ln,i(v.planExecution.parentActToolCall.name),1)]),v.planExecution.parentActToolCall.parameters?(h(),b("div",rn,[n("span",cn,i(v.$t("common.parameters"))+":",1),n("pre",un,i(c(v.planExecution.parentActToolCall.parameters)),1)])):O("",!0)])):O("",!0)])):O("",!0),(v.planExecution?.agentExecutionSequence?.length??0)>0?(h(),b("div",dn,[n("h4",pn,i(v.$t("chat.agentExecutionSequence")),1),(h(!0),b(ue,null,me(v.planExecution?.agentExecutionSequence,(x,d)=>(h(),b("div",{key:x.id||d,class:ce(["agent-execution-item",l(x.status)])},[n("div",{class:"agent-header",onClick:k=>a(x)},[n("div",hn,[A(u(D),{icon:m(x.status),class:"agent-status-icon"},null,8,["icon"]),n("div",fn,[n("div",{class:"agent-name",title:x.agentName==="ConfigurableDynaAgent"?v.$t("chat.clickToViewExecutionDetails"):""},i(x.agentName==="ConfigurableDynaAgent"?v.$t("chat.funcAgentExecutionDetails"):x.agentName||v.$t("chat.unknownAgent")),9,vn),n("pre",gn,i(x.agentRequest),1)])]),n("div",bn,[n("div",{class:ce(["agent-status-badge",l(x.status)])},i(r(x.status)),3),A(u(D),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,mn),n("div",yn,[x.result?(h(),b("div",_n,[n("div",wn,[A(u(D),{icon:"carbon:checkmark",class:"result-icon"}),n("span",$n,i(v.$t("chat.agentResult"))+":",1)]),n("pre",Sn,i(x.result),1)])):O("",!0),x.errorMessage?(h(),b("div",kn,[n("div",En,[A(u(D),{icon:"carbon:warning",class:"error-icon"}),n("span",Pn,i(v.$t("chat.errorMessage"))+":",1)]),n("pre",Tn,i(x.errorMessage),1)])):O("",!0)]),x.subPlanExecutionRecords?.length?(h(),b("div",Cn,[n("div",In,[A(u(D),{icon:"carbon:tree-view",class:"sub-plans-icon"}),n("span",Rn,i(v.$t("chat.subPlanExecutions"))+" ("+i(x.subPlanExecutionRecords.length)+") ",1)]),n("div",xn,[(h(!0),b(ue,null,me(x.subPlanExecutionRecords,(k,y)=>(h(),ge(en,{key:k.currentPlanId||y,"sub-plan":k,"sub-plan-index":y,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:f,onStepSelected:p},null,8,["sub-plan","sub-plan-index"]))),128))])])):O("",!0)],2))),128))])):O("",!0)]))}}),Fn=we(An,[["__scopeId","data-v-ee75d960"]]);function bs(){return{formatResponseText:f=>f?f.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:f=>{const c=new Date().getTime()-f.getTime();return c<6e4?"Just now":c<36e5?`${Math.floor(c/6e4)} minutes ago`:c<864e5?`${Math.floor(c/36e5)} hours ago`:f.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:f=>te(()=>({user:f.type==="user",assistant:f.type==="assistant",streaming:f.isStreaming,"has-error":!!f.error,"has-thinking":!!f.thinking,"has-execution":!!f.planExecution})),formatFileSize:f=>{if(f===0)return"0 B";const p=1024,c=["B","KB","MB","GB"],v=Math.floor(Math.log(f)/Math.log(p));return parseFloat((f/Math.pow(p,v)).toFixed(2))+" "+c[v]},truncateText:(f,p=100)=>!f||f.length<=p?f:f.substring(0,p)+"...",stripHtml:f=>f.replace(/<[^>]*>/g,""),hasDisplayableContent:f=>!!(f.content||(f.thinking??!1)||(f.planExecution??!1)||f.error),getMessageStatus:f=>f.error?"Send failed":f.isStreaming?"Typing...":f.type==="assistant"&&!f.content&&!f.thinking?"Waiting for response":""}}class At{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Dn={class:"user-input-form-container"},Mn={class:"user-input-header"},Nn={class:"user-input-title"},Un={class:"user-input-message"},Ln={key:0,class:"form-description"},On={key:0,class:"form-grid"},Bn=["for"],qn=["id","name","placeholder","required","onUpdate:modelValue"],Vn=["id","name","placeholder","required","onUpdate:modelValue"],jn=["id","name","placeholder","required","onUpdate:modelValue"],Hn=["id","name","placeholder","required","onUpdate:modelValue"],zn=["id","name","placeholder","required","onUpdate:modelValue"],Wn=["id","name","required","onUpdate:modelValue"],Gn={value:""},Kn=["value"],Jn={key:6,class:"checkbox-group"},Xn=["id","name","value","onUpdate:modelValue"],Qn={class:"checkbox-label"},Yn={key:7,class:"radio-group"},Zn=["id","name","value","onUpdate:modelValue"],ea={class:"radio-label"},ta=["id","name","placeholder","required","onUpdate:modelValue"],sa={key:1,class:"form-group"},oa={for:"form-input-genericInput"},na={type:"submit",class:"submit-user-input-btn"},aa=_e({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:t}){const e=o,s=t;De();const a=nt({}),l=F(e.genericInput??""),r=F(!1),m=F(null),f=()=>{const P=e.userInputWaitState?.formInputs;P&&P.length>0&&(!r.value||Object.keys(a).length!==P.length)&&(P.forEach((d,k)=>{(!(k in a)||d.type==="checkbox"&&!Array.isArray(a[k])||d.type!=="checkbox"&&a[k]==="")&&(d.type==="checkbox"?a[k]=[]:a[k]="")}),r.value=!0)};Fe(()=>{f()}),de(()=>e.userInputWaitState?.formInputs,()=>{m.value&&clearTimeout(m.value),m.value=setTimeout(()=>{r.value=!1,f()},100)},{deep:!0});const p=async()=>{try{const P={},x=e.userInputWaitState?.formInputs;x&&x.length>0?Object.entries(a).forEach(([d,k])=>{const y=parseInt(d,10),I=x[y].label||`input_${d}`;Array.isArray(k)?P[I]=k.join(", "):P[I]=k}):P.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",P,"for planId:",e.planId),e.planId?(await At.submitFormInput(e.planId,P),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",P)}catch(P){console.error("[UserInputForm] User input submission failed:",P)}},c=P=>P?Array.isArray(P)?P:typeof P=="string"?P.split(",").map(x=>x.trim()).filter(x=>x.length>0):[]:[],v=P=>typeof P=="boolean"?P:typeof P=="string"?P==="true":!1;return Le(()=>{m.value&&clearTimeout(m.value)}),(P,x)=>(h(),b("div",Dn,[n("div",Mn,[A(u(D),{icon:"carbon:user",class:"user-icon"}),n("h4",Nn,i(P.$t("chat.userInputRequired")),1)]),n("p",Un,i(P.userInputWaitState?.title??P.$t("chat.userInput.message")),1),P.userInputWaitState?.formDescription?(h(),b("p",Ln,i(P.userInputWaitState?.formDescription),1)):O("",!0),n("form",{onSubmit:ve(p,["prevent"]),class:"user-input-form"},[P.userInputWaitState?.formInputs&&P.userInputWaitState.formInputs.length>0?(h(),b("div",On,[(h(!0),b(ue,null,me(P.userInputWaitState?.formInputs,(d,k)=>(h(),b("div",{key:k,class:"form-group"},[n("label",{for:`form-input-${d.label.replace(/\W+/g,"_")}`},i(d.label)+i(v(d.required)?" *":"")+": ",9,Bn),!d.type||d.type==="text"?fe((h(),b("input",{key:0,type:"text",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input"},null,8,qn)),[[Se,a[k]]]):d.type==="email"?fe((h(),b("input",{key:1,type:"email",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input"},null,8,Vn)),[[Se,a[k]]]):d.type==="number"?fe((h(),b("input",{key:2,type:"number",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input"},null,8,jn)),[[Se,a[k]]]):d.type==="password"?fe((h(),b("input",{key:3,type:"password",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input"},null,8,Hn)),[[Se,a[k]]]):d.type==="textarea"?fe((h(),b("textarea",{key:4,id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input form-textarea",rows:"4"},null,8,zn)),[[Se,a[k]]]):d.type==="select"&&d.options?fe((h(),b("select",{key:5,id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input form-select"},[n("option",Gn,i(P.$t("selectCommon.pleaseSelect")),1),(h(!0),b(ue,null,me(c(d.options),y=>(h(),b("option",{key:y,value:y},i(y),9,Kn))),128))],8,Wn)),[[Ut,a[k]]]):d.type==="checkbox"&&d.options?(h(),b("div",Jn,[(h(!0),b(ue,null,me(c(d.options),y=>(h(),b("label",{key:y,class:"checkbox-item"},[fe(n("input",{type:"checkbox",id:`form-input-${d.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:d.label,value:y,"onUpdate:modelValue":g=>a[k]=g,class:"form-checkbox"},null,8,Xn),[[xt,a[k]]]),n("span",Qn,i(y),1)]))),128))])):d.type==="radio"&&d.options?(h(),b("div",Yn,[(h(!0),b(ue,null,me(c(d.options),y=>(h(),b("label",{key:y,class:"radio-item"},[fe(n("input",{type:"radio",id:`form-input-${d.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:d.label,value:y,"onUpdate:modelValue":g=>a[k]=g,class:"form-radio"},null,8,Zn),[[Zs,a[k]]]),n("span",ea,i(y),1)]))),128))])):fe((h(),b("input",{key:8,type:"text",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:v(d.required),"onUpdate:modelValue":y=>a[k]=y,class:"form-input"},null,8,ta)),[[Se,a[k]]])]))),128))])):(h(),b("div",sa,[n("label",oa,i(P.$t("common.input"))+":",1),fe(n("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":x[0]||(x[0]=d=>l.value=d),class:"form-input"},null,512),[[Se,l.value]])])),n("button",na,i(P.$t("chat.userInput.submit")),1)],32)]))}}),la=we(aa,[["__scopeId","data-v-e4d0802d"]]),ra={class:"response-section"},ia={class:"response-header"},ca={class:"response-avatar"},ua={class:"response-name"},da={key:0,class:"response-timestamp"},pa={class:"response-content"},ma={key:1,class:"final-response"},ha=["innerHTML"],fa={class:"response-actions"},va=["title"],ga=["title"],ba={key:2,class:"response-placeholder"},ya={class:"typing-indicator"},_a={class:"typing-text"},wa={key:3,class:"response-error"},$a={class:"error-text"},Sa={key:4,class:"response-empty"},ka={class:"empty-text"},Ea=_e({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:t}){const e=o,s=t,{formatResponseText:a,formatTimestamp:l}=bs(),r=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},m=()=>{s("regenerate")},f=()=>{s("retry")},p=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,v)=>(h(),b("div",ra,[n("div",ia,[n("div",ca,[A(u(D),{icon:"carbon:bot",class:"bot-icon"})]),n("div",ua,i(c.$t("chat.botName")),1),c.timestamp?(h(),b("div",da,i(u(l)(c.timestamp)),1)):O("",!0)]),n("div",pa,[c.userInputWaitState?.waiting?(h(),ge(la,ms({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:p}),null,16,["user-input-wait-state","generic-input"])):O("",!0),c.content?(h(),b("div",ma,[n("div",{class:"response-text",innerHTML:u(a)(c.content)},null,8,ha),n("div",fa,[n("button",{class:"action-btn copy-btn",onClick:r,title:c.$t("chat.copyResponse")},[A(u(D),{icon:"carbon:copy"})],8,va),n("button",{class:"action-btn regenerate-btn",onClick:m,title:c.$t("chat.regenerateResponse")},[A(u(D),{icon:"carbon:renew"})],8,ga)])])):c.isStreaming?(h(),b("div",ba,[n("div",ya,[v[0]||(v[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1)),n("span",_a,i(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),b("div",wa,[A(u(D),{icon:"carbon:warning",class:"error-icon"}),n("span",$a,i(c.error),1),n("button",{class:"retry-btn",onClick:f},i(c.$t("chat.retry")),1)])):(h(),b("div",Sa,[n("span",ka,i(c.$t("chat.waitingForResponse")),1)]))])]))}}),Pa=we(Ea,[["__scopeId","data-v-a03ac86f"]]);function Ta(){const e=F(new Set),s=nt(new Map),a=nt(new Map),l=F(!1),r=F(null),m=C=>a.get(C),f=(C,M)=>{if(!C){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}a.set(C,M),console.log("[usePlanExecution] Cached plan record:",C)},p=()=>Array.from(e.value),c=C=>{if(!C){console.warn("[usePlanExecution] Cannot track empty planId");return}e.value.add(C),console.log("[usePlanExecution] Tracking plan:",C),r.value||d(),P(C)},v=C=>{e.value.delete(C),console.log("[usePlanExecution] Untracking plan:",C),e.value.size===0&&k()},P=async C=>{if(C)try{const M=await At.getDetails(C);if(!M){console.warn(`[usePlanExecution] No details received for planId: ${C} - this might be a temporary network issue`);return}const w=M.rootPlanId||M.currentPlanId;if(!w){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",M);return}if(a.set(w,M),C!==w&&(a.set(C,M),console.log("[usePlanExecution] Stored record with both keys:",{planId:C,recordKey:w})),console.log("[usePlanExecution] Updated plan execution record:",{planId:C,recordKey:w,rootPlanId:M.rootPlanId,currentPlanId:M.currentPlanId,completed:M.completed,status:M.status}),M.completed){console.log(`[usePlanExecution] Plan ${w} completed, checking for summary...`);const N=vt();N.currentTask&&N.currentTask.isRunning&&(N.currentTask.isRunning=!1);const G=M.summary||M.result||M.message,R=s.get(w)||0;if(!G&&R<10)s.set(w,R+1),console.log(`[usePlanExecution] Plan ${w} completed but no summary yet, continuing to poll (${R+1}/10)`);else{console.log(`[usePlanExecution] Plan ${w} completed, cleaning up...`,{hasSummary:!!G,pollCount:R});try{await At.deleteExecutionDetails(w),console.log(`[usePlanExecution] Deleted execution details for plan: ${w}`)}catch(H){const S=H instanceof Error?H.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${S}`)}v(C),s.delete(w),setTimeout(()=>{a.delete(w)},5e3)}}M.status==="failed"&&M.message&&!M.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${w} failed:`,M.message)}catch(M){console.error(`[usePlanExecution] Failed to poll plan status for ${C}:`,M)}},x=async()=>{if(l.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const C=new Set(e.value);for(const[M]of s.entries())C.add(M);if(C.size!==0)try{l.value=!0;const M=Array.from(C).map(w=>P(w));await Promise.all(M)}catch(M){console.error("[usePlanExecution] Failed to poll tracked plans:",M)}finally{l.value=!1}},d=()=>{r.value&&clearInterval(r.value),r.value=window.setInterval(()=>{x()},5e3),console.log("[usePlanExecution] Started polling")},k=()=>{if(s.size>0){console.log(`[usePlanExecution] Not stopping polling - ${s.size} completed plans still waiting for summary`);return}r.value&&(clearInterval(r.value),r.value=null),console.log("[usePlanExecution] Stopped polling")},y=async C=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${C}`),await P(C)},g=C=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:C}),!C){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}vt().setTaskRunning(C),c(C)},I=()=>{k(),e.value.clear(),s.clear(),a.clear(),l.value=!1};return{planExecutionRecords:Ue(a),trackedPlanIds:Ue(e),isPolling:Ue(l),getPlanExecutionRecord:m,setCachedPlanRecord:f,getTrackedPlanIds:p,trackPlan:c,untrackPlan:v,handlePlanExecutionRequested:g,pollPlanStatusImmediately:y,startPolling:d,stopPolling:k,cleanup:I}}let St=null;function Xe(){return St||(St=Ta()),St}function Ca(){const o=Xe(),t=F([]),e=F(null),s=F(null),a=F(null),l=te(()=>a.value),r=F(!1),m=F(null),f=F(null),p=F(null),c=te(()=>e.value&&t.value.find(U=>U.id===e.value)||null),v=te(()=>t.value.length>0),P=te(()=>t.value.length),x=te(()=>{if(!s.value)return c.value?.messages||[];const U=[];for(const L of t.value)L.conversationId===s.value&&U.push(...L.messages);return U.sort((L,V)=>L.timestamp.getTime()-V.timestamp.getTime())}),d=U=>{const L={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:U||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(L),e.value=L.id,console.log("[useMessageDialog] Created new dialog round:",L.id,{conversationId:s.value,rootPlanId:a.value}),L},k=U=>t.value.find(L=>L.id===U)||null,y=U=>{if(t.value.forEach(L=>{L.isActive=!1}),U){const L=t.value.find(V=>V.id===U);L&&(L.isActive=!0,e.value=U)}else e.value=null},g=(U,L)=>{const V=t.value.find(J=>J.id===U);V&&(V.messages.push(L),V.updatedAt=new Date)},I=(U,L,V)=>{const J=t.value.find(Y=>Y.id===U);if(J){const Y=J.messages.findIndex(ne=>ne.id===L);Y!==-1&&(J.messages[Y]={...J.messages[Y],...V},J.updatedAt=new Date)}},C=U=>{const L=t.value.findIndex(V=>V.id===U);if(L!==-1){const V=t.value[L];if(t.value.splice(L,1),console.log("[useMessageDialog] Deleted dialog round:",U),e.value===U){const J=t.value.filter(Y=>Y.conversationId===V.conversationId);e.value=J.length>0?J[0].id:null,e.value&&y(e.value)}}},M=U=>{const L=t.value.filter(V=>V.planId===U);L.forEach(V=>{C(V.id)}),console.log(`[useMessageDialog] Deleted ${L.length} dialog round(s) for plan:`,U)},w=U=>{const L=t.value.filter(V=>V.conversationId===U);L.forEach(V=>{C(V.id)}),console.log(`[useMessageDialog] Deleted ${L.length} dialog round(s) for conversation:`,U),s.value===U&&(s.value=null)},N=()=>{t.value=[],e.value=null},G=async U=>{let L=null,V=null;try{if(r.value){const Z="Please wait for the current task to complete before starting a new one";return m.value=Z,{success:!1,error:Z}}r.value=!0,m.value=null,L=d();const J={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:U.input,timestamp:new Date,isStreaming:!1,...U.uploadedFiles&&{attachments:U.uploadedFiles.map(Z=>typeof Z=="string"?new File([],Z):Z)}};g(L.id,J),V={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},g(L.id,V);const Y=U;let ne;if(Y.toolName&&Y.replacementParams?ne=await Wt.executeByToolName(Y.toolName,Y.replacementParams,U.uploadedFiles,U.uploadKey,"VUE_DIALOG"):ne=await Wt.sendMessageWithDefaultPlan(U,"VUE_DIALOG"),ne.conversationId&&(s.value=ne.conversationId,L.conversationId=ne.conversationId,Pe.setConversationId(ne.conversationId),console.log("[useMessageDialog] Conversation ID set:",ne.conversationId)),ne.planId){const Z=ne.planId;a.value=Z,L.planId=Z,I(L.id,V.id,{thinking:"Planning execution...",planExecution:{currentPlanId:Z,rootPlanId:Z,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(Z),console.log("[useMessageDialog] Root plan ID set and tracking started:",Z)}else{const Z={content:ne.message||ne.result||"No response received",isStreaming:!1};I(L.id,V.id,Z)}return{success:!0,...ne.planId&&{planId:ne.planId},...ne.conversationId&&{conversationId:ne.conversationId}}}catch(J){const Y=J instanceof Error?J.message:"Failed to send message";return m.value=Y,console.error("[useMessageDialog] Send message failed:",J),L&&V&&I(L.id,V.id,{content:`Error: ${Y}`,error:Y,isStreaming:!1}),{success:!1,error:Y}}finally{r.value=!1}},R=async U=>{let L=null,V=null;try{if(r.value){const Z="Please wait for the current task to complete before starting a new one";return m.value=Z,{success:!1,error:Z}}r.value=!0,m.value=null,L=d(U.title),U.title&&(L.title=U.title);const J={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:U.title,timestamp:new Date,isStreaming:!1,...U.uploadedFiles&&{attachments:U.uploadedFiles.map(Z=>typeof Z=="string"?new File([],Z):Z)}};g(L.id,J),V={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},g(L.id,V);const Y=U.planData.planTemplateId;if(!Y||Y===null)throw new Error("Plan template ID is required");const ne=await no.executePlan(Y,U.params,U.uploadedFiles,U.replacementParams,U.uploadKey??void 0,"VUE_SIDEBAR");if(ne.conversationId&&(s.value=ne.conversationId,L.conversationId=ne.conversationId,Pe.setConversationId(ne.conversationId),console.log("[useMessageDialog] Conversation ID set:",ne.conversationId)),ne.planId){const Z=ne.planId;a.value=Z,L.planId=Z,I(L.id,V.id,{thinking:"Planning execution...",planExecution:{currentPlanId:Z,rootPlanId:Z,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(Z),console.log("[useMessageDialog] Root plan ID set and tracking started:",Z)}else{const Z={content:"Plan execution started",isStreaming:!1};I(L.id,V.id,Z)}return{success:!0,...ne.planId&&{planId:ne.planId}}}catch(J){const Y=J instanceof Error?J.message:"Failed to execute plan";return m.value=Y,console.error("[useMessageDialog] Execute plan failed:",J),L&&V&&I(L.id,V.id,{content:`Error: ${Y}`,error:Y,isStreaming:!1}),r.value=!1,{success:!1,error:Y}}},H=(U,L,V)=>{const J={};V!==void 0&&(J.planExecution=V),I(U,L,J)},S=U=>{const L={...U};return"agentExecutionSequence"in U&&Array.isArray(U.agentExecutionSequence)&&(L.agentExecutionSequence=U.agentExecutionSequence.map(V=>_(V))),L},_=U=>{const L={...U};return"subPlanExecutionRecords"in U&&Array.isArray(U.subPlanExecutionRecords)&&(L.subPlanExecutionRecords=U.subPlanExecutionRecords.map(V=>S(V))),L},$=(U,L,V)=>{c.value||d();const J=c.value,Y={...V};V?.planExecution&&(Y.planExecution=S(V.planExecution));const ne={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:U,content:L,timestamp:new Date,isStreaming:!1,...Y};return J.messages.push(ne),J.updatedAt=new Date,ne},B=(U,L)=>{if(!c.value)return;const V={...L};L.planExecution&&(V.planExecution=S(L.planExecution));const J=c.value.messages.findIndex(Y=>Y.id===U);J!==-1&&(c.value.messages[J]={...c.value.messages[J],...V},c.value.updatedAt=new Date)},W=U=>{if(c.value)return c.value.messages.find(L=>L.id===U)},se=U=>{f.value=U,B(U,{isStreaming:!0})},he=U=>{U&&B(U,{isStreaming:!1}),(f.value===U||!U)&&(f.value=null)},Me=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,f.value=null)},Ee=(U,L)=>{r.value=!U,L!==void 0&&(p.value=L),console.log("[useMessageDialog] Input state updated:",{enabled:U,placeholder:L,isLoading:r.value})},ke=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,m.value=null,p.value=null},qe=(U,L,V)=>{const J={planExecution:S(V),isStreaming:!V.completed};if(!V.completed)J.thinking="Processing...";else{if(!V.agentExecutionSequence||V.agentExecutionSequence.length===0){const Y=V.summary??V.result??V.message??"Execution completed";Y&&(J.content=Y,J.thinking="")}else V.summary&&(J.content=V.summary,J.thinking="");V.status==="failed"&&V.message&&(J.content=`Error: ${V.message}`,J.thinking="")}I(U.id,L.id,J)};return hs(()=>{const U=o.planExecutionRecords,L=Array.from(U.entries());for(const V of t.value){if(!V.planId)continue;const J=L.find(([q])=>q===V.planId);if(!J){L.length===0&&console.log("[useMessageDialog] watchEffect: No records in Map yet for planId:",V.planId,{dialogId:V.id});continue}const[,Y]=J,ne=S(Y),Z=V.messages.find(q=>q.planExecution?.rootPlanId===V.planId);if(!Z){console.log("[useMessageDialog] watchEffect: No message found for planId:",V.planId,{dialogMessages:V.messages.map(q=>({id:q.id,type:q.type,planExecutionRootPlanId:q.planExecution?.rootPlanId}))});continue}qe(V,Z,ne),!L.some(([,q])=>q&&!q.completed&&q.status!=="failed")&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading"),r.value=!1)}}),{dialogList:Ue(t),activeDialogId:Ue(e),rootPlanId:Ue(a),conversationId:Ue(s),isLoading:r,error:m,streamingMessageId:Ue(f),inputPlaceholder:Ue(p),activeDialog:c,activeRootPlanId:l,hasDialogs:v,dialogCount:P,messages:x,createDialog:d,getDialog:k,setActiveDialog:y,addMessageToDialog:g,updateMessageInDialog:I,deleteDialog:C,deleteConversationRoundByPlanId:M,deleteConversation:w,clearAllDialogs:N,sendMessage:G,executePlan:R,updatePlanExecutionStatus:H,updateInputState:Ee,reset:ke,addMessage:$,updateMessage:B,findMessage:W,startStreaming:se,stopStreaming:he,clearMessages:Me}}let kt=null;function Qe(){return kt||(kt=Ca()),kt}function Ia(o){const t=F(!1),e=F(!0),s=150,a=async(y=!0)=>{o.value&&(await Re(),o.value.scrollTo({top:o.value.scrollHeight,behavior:y?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:y,scrollHeight:g,clientHeight:I}=o.value;return g-y-I<s},r=()=>{if(!o.value)return;const y=l();t.value=!y&&o.value.scrollHeight>o.value.clientHeight,y&&(e.value=!0)},m=()=>{r(),l()||(e.value=!1)},f=async()=>{e.value&&await a()},p=async()=>{e.value=!0,await a()},c=(y,g=!0)=>{if(!o.value)return;const I=o.value.querySelector(`[data-message-id="${y}"]`);I&&I.scrollIntoView({behavior:g?"smooth":"auto",block:"center"})},v=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:y,scrollHeight:g,clientHeight:I}=o.value,C=y===0,M=y+I>=g-5,w=g>I?y/(g-I)*100:100;return{scrollTop:y,scrollHeight:g,clientHeight:I,isAtTop:C,isAtBottom:M,scrollPercentage:w}},P=()=>{o.value&&o.value.addEventListener("scroll",m,{passive:!0})},x=()=>{o.value&&o.value.removeEventListener("scroll",m)},d=()=>{P(),r()},k=()=>{x()};return Fe(()=>{Re(()=>{d()})}),Le(()=>{k()}),{showScrollToBottom:Ue(t),isAutoScrollEnabled:Ue(e),scrollToBottom:a,autoScrollToBottom:f,forceScrollToBottom:p,scrollToMessage:c,isNearBottom:l,checkScrollPosition:r,getScrollInfo:v,addScrollListener:P,removeScrollListener:x,initializeScrollBehavior:d,cleanupScrollBehavior:k}}const Ra={class:"chat-container"},xa=["data-message-id"],Aa={class:"user-content"},Fa={class:"message-text"},Da={key:0,class:"attachments"},Ma={class:"attachment-name"},Na={class:"attachment-size"},Ua={class:"message-timestamp"},La={key:0,class:"message-status error"},Oa={class:"status-text"},Ba={key:1,class:"assistant-message"},qa={key:0,class:"loading-message"},Va={class:"loading-content"},ja=["title"],Ha=_e({__name:"ChatContainer",emits:["step-selected"],setup(o,{emit:t}){const e=t,{t:s}=De(),a=Qe(),{messages:l,isLoading:r,streamingMessageId:m,updateMessage:f,startStreaming:p,findMessage:c}=a,v=F(null),{scrollToBottom:P,autoScrollToBottom:x,showScrollToBottom:d}=Ia(v),{getMessageClasses:k,formatTimestamp:y,formatFileSize:g}=bs(),I=S=>m.value===S,C=te(()=>l.value),M=S=>{const _=S.target;if(_.classList.contains("md-copy-btn")){const $=_.getAttribute("data-raw");if($){const B=decodeURIComponent($);navigator.clipboard.writeText(B).then(()=>{_.textContent=s("chat.copied"),setTimeout(()=>{_.textContent=s("chat.copy")},1e3)})}}},w=async S=>{const _=c(S);if(_)try{const $=_.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText($)}catch($){console.error("Failed to copy message:",$)}},N=S=>{const _=c(S);_&&_.type==="assistant"&&(f(S,{content:""}),p(S),console.warn("[ChatContainer] Regenerate not yet implemented"))},G=S=>{c(S)&&(f(S,{content:""}),p(S),console.warn("[ChatContainer] Retry not yet implemented"))},R=S=>{console.log("[ChatContainer] Step selected:",S),e("step-selected",S)},H=(S,_)=>{console.log("[ChatContainer] User input submitted:",_,"for message:",S.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Fe(()=>{de(l,()=>{Re(()=>{x()})},{deep:!0})}),Le(()=>{}),(S,_)=>(h(),b("div",Ra,[n("div",{class:"messages",ref_key:"messagesRef",ref:v,onClick:M},[(h(!0),b(ue,null,me(C.value,$=>(h(),b("div",{key:$.id,class:ce(["chat-message",[u(k)($),{streaming:I($.id)}]])},[$.type==="user"?(h(),b("div",{key:0,class:"user-message","data-message-id":$.id},[n("div",Aa,[n("div",Fa,i($.content),1),$.attachments?.length?(h(),b("div",Da,[(h(!0),b(ue,null,me($.attachments,(B,W)=>(h(),b("div",{key:W,class:"attachment-item"},[A(u(D),{icon:"carbon:document",class:"attachment-icon"}),n("span",Ma,i(B.name),1),n("span",Na,i(u(g)(B.size)),1)]))),128))])):O("",!0),n("div",Ua,i(u(y)($.timestamp)),1)]),$.error?(h(),b("div",La,[A(u(D),{icon:"carbon:warning",class:"status-icon"}),n("span",Oa,i($.error),1)])):O("",!0)],8,xa)):$.type==="assistant"?(h(),b("div",Ba,[$.planExecution?(h(),ge(Fn,{key:0,"plan-execution":$.planExecution,"step-actions":$.stepActions||[],"generic-input":$.genericInput||"",onStepSelected:R},null,8,["plan-execution","step-actions","generic-input"])):O("",!0),$.content||$.error||I($.id)||$.planExecution?.userInputWaitState?.waiting?(h(),ge(Pa,ms({key:1,content:$.content||"","is-streaming":I($.id)||!1},{ref_for:!0},{...$.error?{error:$.error}:{},...$.planExecution?.userInputWaitState?{userInputWaitState:$.planExecution.userInputWaitState}:{},...$.planExecution?.currentPlanId?{planId:$.planExecution.currentPlanId}:{}},{timestamp:$.timestamp,"generic-input":$.genericInput||"",onCopy:()=>w($.id),onRegenerate:()=>N($.id),onRetry:()=>G($.id),onUserInputSubmitted:B=>H($,B)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):O("",!0)])):O("",!0)],2))),128)),u(r)?(h(),b("div",qa,[n("div",Va,[A(u(D),{icon:"carbon:circle-dash",class:"loading-icon"}),n("span",null,i(S.$t("chat.processing")),1)])])):O("",!0)],512),A(Lt,{name:"scroll-button"},{default:Ge(()=>[u(d)?(h(),b("button",{key:0,class:"scroll-to-bottom",onClick:_[0]||(_[0]=()=>u(P)()),title:S.$t("chat.scrollToBottom")},[A(u(D),{icon:"carbon:chevron-down"})],8,ja)):O("",!0)]),_:1})]))}}),za=we(Ha,[["__scopeId","data-v-9504dbce"]]);class Gt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const Wa={class:"file-upload-component"},Ga=["accept"],Ka={key:0},Ja={key:1},Xa={key:0,class:"files-list"},Qa={class:"file-name"},Ya={class:"file-size"},Za=["onClick","title"],el={key:0,class:"upload-progress"},tl=_e({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:t,emit:e}){const{t:s}=De(),a=o,l=e,r=F(),m=F([]),f=F(!1),p=F(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),m.value=[],p.value=null,l("upload-key-changed",null)};Le(()=>{c()}),de(()=>m.value,y=>{l("files-removed",y)},{deep:!0});const v=()=>{a.disabled||r.value&&r.value.click()},P=async y=>{const g=y.target,I=g.files;if(!I||I.length===0)return;const C=Array.from(I);console.log("[FileUpload] Selected files for upload:",C.map(M=>M.name)),await x(C),g.value=""},x=async y=>{if(y.length!==0){f.value=!0,l("upload-started");try{const g=await Gt.uploadFiles(y);g.success&&(!p.value&&g.uploadKey?(p.value=g.uploadKey,console.log("[FileUpload] Set uploadKey:",p.value),m.value=g.uploadedFiles):p.value?(console.log("[FileUpload] Using existing uploadKey:",p.value),m.value=[...m.value,...g.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),m.value=g.uploadedFiles),g.uploadKey&&(p.value=g.uploadKey,console.log("[Input] Saved uploadKey locally:",g.uploadKey),l("upload-key-changed",p.value)),console.log("[Input] Updated global uploadedFiles state:",m.value),l("files-uploaded",m.value,p.value)),console.log("Files uploaded successfully:",g),l("upload-completed")}catch(g){console.error("File upload error:",g),l("upload-error",g)}finally{f.value=!1}}},d=async y=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",y.originalName,"from uploadKey:",p),p.value){const g=await Gt.deleteFile(p.value,y.originalName);g.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",g.error)}m.value=m.value.filter(g=>g.originalName!==y.originalName),m.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),p.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",m.value.length)}catch(g){console.error("âŒ Error removing file:",g),l("upload-error",g)}},k=y=>{if(y===0)return"0 Bytes";const g=1024,I=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(y)/Math.log(g));return parseFloat((y/Math.pow(g,C)).toFixed(2))+" "+I[C]};return t({uploadedFiles:m,uploadKey:p,resetSession:c,uploadFiles:x,removeFile:d,isUploading:f}),(y,g)=>(h(),b("div",Wa,[n("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:P,accept:y.acceptedFileTypes||""},null,40,Ga),n("div",{class:ce(["uploaded-files",{"has-files":m.value.length>0}])},[n("div",{class:"files-header",onClick:v},[A(u(D),{icon:"carbon:attachment"}),m.value.length===0?(h(),b("span",Ka,i(u(s)("input.attachFile")),1)):(h(),b("span",Ja,i(u(s)("input.attachedFiles"))+" ("+i(m.value.length)+")",1))]),m.value.length>0?(h(),b("div",Xa,[(h(!0),b(ue,null,me(m.value,I=>(h(),b("div",{key:I.originalName,class:"file-item"},[A(u(D),{icon:"carbon:document",class:"file-icon"}),n("span",Qa,i(I.originalName),1),n("span",Ya,"("+i(k(I.size))+")",1),n("button",{onClick:C=>d(I),class:"remove-btn",title:u(s)("input.removeFile")},[A(u(D),{icon:"carbon:close"})],8,Za)]))),128))])):O("",!0)],2),f.value?(h(),b("div",el,[A(u(D),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),n("span",null,i(u(s)("input.uploading")),1)])):O("",!0)]))}}),ys=we(tl,[["__scopeId","data-v-a97ebade"]]),sl={class:"input-area"},ol={class:"input-container"},nl={class:"input-row-first"},al=["placeholder","disabled"],ll={class:"input-row-second"},rl=["title","disabled"],il={value:""},cl=["value"],ul=["title"],dl=["disabled","title"],pl=["title"],Kt="chatInputHistory",Jt=20,ml=_e({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},emits:["selection-changed"],setup(o,{expose:t,emit:e}){const{t:s}=De(),a=vt(),l=Je(),r=Qe(),m=Xe(),f=te(()=>a.hasRunningTask()),p=o,c=e,v=F(),P=F(),x=F(""),d=te(()=>s("input.placeholder")),k=F(null),y=te(()=>r.inputPlaceholder.value?r.inputPlaceholder.value:k.value?k.value:d.value),g=F([]),I=F(null),C=F(""),M=F([]),w=F(!1),N=F([]),G=F(-1),R=F(""),H=te(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),S=async()=>{w.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const j=l.getAllCoordinatorToolsFromTemplates(),Q=[];for(const be of j)if(be.enableInternalToolcall)try{const Ne=JSON.parse(be.inputSchema||"[]");if(Array.isArray(Ne)&&Ne.length===1){const et=Ne[0];Q.push({value:be.planTemplateId,label:`${be.toolName} (${et.name})`,toolName:be.toolName,planTemplateId:be.planTemplateId,paramName:et.name})}}catch(Ne){console.warn("[InputArea] Failed to parse inputSchema for tool:",be.toolName,Ne)}M.value=Q,console.log("[InputArea] Loaded",Q.length,"inner tools with single parameter");const le=localStorage.getItem("inputAreaSelectedTool");le&&(Q.some(Ne=>Ne.value===le)?(C.value=le,console.log("[InputArea] Restored selected tool from localStorage:",le)):(console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),C.value=""))}catch(j){console.error("[InputArea] Failed to load inner tools:",j),M.value=[]}finally{w.value=!1}},_=te(()=>M.value.length>0?M.value.map(j=>({value:j.value,label:j.label})):p.selectionOptions);de(C,j=>{c("selection-changed",j),localStorage.setItem("inputAreaSelectedTool",j||"")});const $=()=>{try{const j=localStorage.getItem(Kt);j&&(N.value=JSON.parse(j))}catch(j){console.error("[InputArea] Failed to load history:",j),N.value=[]}},B=()=>{try{localStorage.setItem(Kt,JSON.stringify(N.value))}catch(j){console.error("[InputArea] Failed to save history:",j)}},W=j=>{if(!j.trim())return;const Q=N.value.indexOf(j);Q!==-1&&N.value.splice(Q,1),N.value.unshift(j),N.value.length>Jt&&(N.value=N.value.slice(0,Jt)),B()},se=j=>{if(N.value.length===0)return;G.value===-1&&(R.value=x.value);let Q=G.value+j;Q<-1?Q=-1:Q>=N.value.length&&(Q=N.value.length-1),G.value=Q,G.value===-1?(x.value=R.value,R.value=""):x.value=N.value[G.value],J()};de(()=>l.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),S()},{deep:!0}),Fe(()=>{S(),$(),de(()=>m.planExecutionRecords,j=>{for(const Q of j.values())if(Q.completed){console.log("[InputArea] Plan completed, resetting session"),he();break}},{deep:!0}),de(()=>a.taskToInput,j=>{j?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",j),Re(()=>{ee(j.trim()),a.getAndClearTaskToInput()}))},{immediate:!1})});const he=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),P.value?.resetSession()};Le(()=>{he()});const Me=(j,Q)=>{g.value=j.map(le=>le.originalName),I.value=Q,console.log("[InputArea] Files uploaded:",j.length,"uploadKey:",Q),g.value.length>0&&(k.value=s("input.filesAttached",{count:g.value.length}))},Ee=j=>{g.value=j.map(Q=>Q.originalName),console.log("[InputArea] Files removed, remaining:",j.length),g.value.length===0?k.value=null:k.value=s("input.filesAttached",{count:g.value.length})},ke=j=>{I.value=j,console.log("[InputArea] Upload key changed:",j)},qe=()=>{console.log("[InputArea] Upload started")},U=()=>{console.log("[InputArea] Upload completed")},L=j=>{console.error("[InputArea] Upload error:",j)},V=te(()=>r.isLoading.value),J=()=>{Re(()=>{v.value&&(v.value.style.height="auto",v.value.style.height=Math.min(v.value.scrollHeight,120)+"px")})},Y=j=>{if(j.key==="Enter"&&(j.ctrlKey||j.metaKey)){j.preventDefault(),ne();return}const Q=H.value?j.altKey:j.ctrlKey;if(j.key==="ArrowUp"&&Q){j.preventDefault(),se(1);return}if(j.key==="ArrowDown"&&Q){j.preventDefault(),se(-1);return}G.value!==-1&&j.key.length===1&&!j.ctrlKey&&!j.metaKey&&!j.altKey&&(G.value=-1,R.value="")},ne=async()=>{if(!x.value.trim()||V.value)return;const j=x.value.trim();W(j),G.value=-1,R.value="";const Q={input:j,memoryId:Pe.selectMemoryId,uploadedFiles:g.value};if(I.value?(Q.uploadKey=I.value,console.log("[InputArea] Including uploadKey in message:",I.value)):console.log("[InputArea] No uploadKey available for message"),C.value){const le=M.value.find(be=>be.value===C.value);if(le){const be=Q;be.toolName=le.planTemplateId,be.replacementParams={[le.paramName]:j},console.log("[InputArea] Sending message with tool:",le.toolName)}}try{await r.sendMessage(Q)}catch(le){const be=le instanceof Error?le.message:String(le);console.error("[InputArea] Send message failed:",be)}q()},Z=()=>{Ie.toggleSidebar(),console.log("[InputArea] Plan mode button clicked, sidebar toggled, isCollapsed:",Ie.isCollapsed)},Ce=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},q=()=>{x.value="",J()},X=(j,Q)=>{r.updateInputState(j,Q)},ee=j=>{x.value=j,J()},$e=()=>x.value.trim();return de(()=>p.initialValue,j=>{j.trim()&&(x.value=j,J())},{immediate:!0}),t({clearInput:q,updateState:X,getQuery:$e,focus:()=>v.value?.focus(),get uploadedFiles(){return P.value?.uploadedFiles?.map(j=>j.originalName)||[]},get uploadKey(){return P.value?.uploadKey||null}}),(j,Q)=>(h(),b("div",sl,[A(ys,{ref_key:"fileUploadRef",ref:P,disabled:V.value,onFilesUploaded:Me,onFilesRemoved:Ee,onUploadKeyChanged:ke,onUploadStarted:qe,onUploadCompleted:U,onUploadError:L},null,8,["disabled"]),n("div",ol,[n("div",nl,[fe(n("textarea",{"onUpdate:modelValue":Q[0]||(Q[0]=le=>x.value=le),ref_key:"inputRef",ref:v,class:"chat-input",placeholder:y.value,disabled:V.value,onKeydown:Y,onInput:J},null,40,al),[[Se,x.value]])]),n("div",ll,[fe(n("select",{"onUpdate:modelValue":Q[1]||(Q[1]=le=>C.value=le),class:"selection-input",title:j.$t("input.selectionTitle"),disabled:w.value||V.value},[n("option",il,i(j.$t("input.defaultFuncAgent")),1),(h(!0),b(ue,null,me(_.value,le=>(h(),b("option",{key:le.value,value:le.value},i(le.label),9,cl))),128))],8,rl),[[Ut,C.value]]),n("button",{class:"plan-mode-btn",title:j.$t("input.planMode"),onClick:Z},[A(u(D),{icon:"carbon:document"}),ie(" "+i(j.$t("input.planMode")),1)],8,ul),f.value?(h(),b("button",{key:1,class:"send-button stop-button",onClick:Ce,title:j.$t("input.stop")},[A(u(D),{icon:"carbon:stop-filled"}),ie(" "+i(j.$t("input.stop")),1)],8,pl)):(h(),b("button",{key:0,class:"send-button",disabled:!x.value.trim()||V.value,onClick:ne,title:j.$t("input.send")},[A(u(D),{icon:"carbon:send-alt"}),ie(" "+i(j.$t("input.send")),1)],8,dl))])])]))}}),hl=we(ml,[["__scopeId","data-v-653fc96a"]]);class pt{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const fl={key:0,class:"app-container"},vl={class:"app-content"},gl={class:"header"},bl={class:"relative"},yl={class:"title-edit-group"},_l={id:"main-title",class:"main-title"},wl={key:0,id:"title-edit-container",class:"title-edit-container"},$l={class:"search-bar"},Sl={class:"search-container"},kl=["placeholder"],El={class:"message-list",id:"message-list"},Pl={class:"message-header"},Tl={class:"message-content"},Cl={class:"sender-info"},Il=["onClick"],Rl={class:"sender-name"},xl={class:"action-buttons"},Al=["onClick"],Fl={class:"action-buttons"},Dl=["onClick"],Ml={class:"message-meta"},Nl={class:"message-id"},Ul={class:"meta-right"},Ll={key:0,class:"unread-count"},Ol={class:"message-time"},Bl=["id"],ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Vl={class:"bubble-avatar"},jl={class:"bubble-content"},Hl={class:"bubble-text"},zl={key:0,class:"empty-state"},Wl={class:"modal-content"},Gl={class:"modal-header"},Kl={class:"modal-title"},Jl=["placeholder"],Xl={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},Ql={class:"modal-footer"},Yl={class:"modal-content"},Zl={class:"modal-header"},er={class:"modal-title"},tr={class:"state-text",id:"delete-message"},sr={class:"modal-footer"},or=_e({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(o,{emit:t}){const e=F(!1),s=F(""),a=F([]),l=F([]),r=F(!1),m=F(null),f=F(""),p=F(!1),c=F(null),v=new Map,P=t,x=R=>{R.key==="Escape"&&(p.value?N():r.value&&I())};Fe(()=>{Pe.setLoadMessages(d),document.addEventListener("keydown",x)}),Le(()=>{document.removeEventListener("keydown",x)});const d=async()=>{try{const R=await pt.getMemories();a.value=R.map(H=>({...H,expanded:v.has(H.conversation_id)?v.get(H.conversation_id):!1})),l.value=[...a.value],g()}catch(R){console.error("error:",R),a.value=[],l.value=[]}},k=R=>{Pe.selectMemory(R),P("memory-selected")},y=R=>{const H=typeof R=="string"?parseInt(R,10):R;return isNaN(H)||H<=0?"--":new Date(H.toString().length===13?H:H*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},g=()=>{const R=s.value.toLowerCase().trim();if(!R){l.value=[...a.value];return}l.value=a.value.filter(H=>{const S=H.memory_name.toLowerCase().includes(R),_=H.conversation_id.toLowerCase().includes(R),$=H.messages?.some(B=>B.text.toLowerCase().includes(R))??!1;return S||_||$})},I=()=>{r.value=!1,m.value=null},C=async()=>{if(!m.value)return;const R=f.value.trim()||"unknow name",H=a.value.findIndex(S=>S.conversation_id===m.value);if(H!==-1){const S=a.value[H];try{const _=await pt.updateMemory(S.conversation_id,R);_.messages||(_.messages=[]),a.value[H]={..._,expanded:S.expanded},g(),r.value=!1}catch(_){console.error("error:",_)}}},M=R=>{const H=a.value.find(S=>S.conversation_id===R);if(H){H.expanded=!H.expanded,v.set(R,H.expanded);const S=l.value.findIndex(_=>_.conversation_id===R);S!==-1&&(l.value[S]={...H})}},w=R=>{c.value=R,p.value=!0},N=()=>{p.value=!1,c.value=null},G=async()=>{if(c.value)try{await pt.deleteMemory(c.value),a.value=a.value.filter(R=>R.conversation_id!==c.value),g(),a.value.length===0&&Pe.clearMemoryId(),p.value=!1,c.value=null}catch(R){console.error("error:",R)}};return(R,H)=>(h(),ge(eo,{to:"body"},[A(Lt,{name:"modal"},{default:Ge(()=>[u(Pe).isCollapsed?(h(),b("div",fl,[n("div",vl,[n("div",gl,[n("div",bl,[n("div",yl,[n("h1",_l,[n("span",null,i(R.$t("memory.title")),1)])]),e.value?(h(),b("div",wl)):O("",!0)]),n("button",{class:"close-btn",onClick:H[0]||(H[0]=S=>u(Pe).toggleSidebar())},[A(u(D),{icon:"carbon:close"})])]),n("div",$l,[n("div",Sl,[A(u(D),{class:"search-container-icon",icon:"carbon:search"}),fe(n("input",{type:"text",placeholder:R.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":H[1]||(H[1]=S=>s.value=S),onInput:g},null,40,kl),[[Se,s.value]])])]),n("div",El,[n("div",null,[(h(!0),b(ue,null,me(l.value,S=>(h(),b("div",{class:ce(["message-item",{expanded:S.expanded}]),key:S.conversation_id},[n("div",Pl,[n("div",Tl,[n("div",Cl,[n("div",{class:"sender-div",onClick:ve(_=>k(S.conversation_id),["stop"])},[n("h3",Rl,i(S.memory_name),1)],8,Il),n("div",xl,[n("button",{class:"delete-btn",onClick:ve(_=>M(S.conversation_id),["stop"])},[A(u(D),{id:"toggle-"+S.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Al)]),n("div",Fl,[n("button",{class:"delete-btn",onClick:ve(_=>w(S.conversation_id),["stop"])},[A(u(D),{icon:"carbon:delete"})],8,Dl)])]),n("div",Ml,[n("span",Nl,"ID: "+i(S.conversation_id),1),n("div",Ul,[S.messages&&S.messages.length>0?(h(),b("span",Ll,i(S.messages.length)+" "+i(R.$t("memory.size")),1)):O("",!0),n("span",Ol,i(y(S.create_time)),1)])])])]),S.expanded?(h(),b("div",{key:0,id:"content-"+S.conversation_id,class:"expanded-content"},[n("div",ql,[(h(!0),b(ue,null,me(S.messages,(_,$)=>(h(),b("div",{class:"message-bubble",key:$},[n("div",Vl,i(_.messageType),1),n("div",jl,[n("p",Hl,i(_.text),1)])]))),128))])],8,Bl)):O("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),b("div",zl,H[3]||(H[3]=[n("p",{class:"state-text"},"none message",-1)]))):O("",!0)]),r.value?(h(),b("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ve(I,["self"])},[n("div",Wl,[n("div",Gl,[n("h3",Kl,i(R.$t("memory.changeName")),1),fe(n("input",{type:"text","onUpdate:modelValue":H[2]||(H[2]=S=>f.value=S),class:"edit-input",placeholder:R.$t("memory.newNamePlaceholder")},null,8,Jl),[[Se,f.value]]),n("span",Xl,i(f.value.length),1)]),n("div",Ql,[n("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:I},i(R.$t("memory.cancel")),1),n("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:C},i(R.$t("memory.save")),1)])])])):O("",!0),p.value?(h(),b("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ve(N,["self"])},[n("div",Yl,[n("div",Zl,[n("h3",er,i(R.$t("memory.deleteHint")),1),n("p",tr,i(R.$t("memory.deleteHintPrefix"))+" "+i(c.value)+" "+i(R.$t("memory.deleteHintSuffix")),1)]),n("div",sr,[n("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:N},i(R.$t("memory.cancel")),1),n("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:G},i(R.$t("memory.delete")),1)])])])):O("",!0)])])):O("",!0)]),_:1})]))}}),nr=we(or,[["__scopeId","data-v-16358835"]]);class ze{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),m=document.createElement("a");m.href=r,m.download=s??e.split("/").pop()??"download",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(r),document.body.removeChild(m)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const ar={class:"file-tree-node"},lr={class:"node-icon"},rr={class:"node-name"},ir={key:1,class:"file-size"},cr={key:2,class:"node-actions"},ur={key:0,class:"children"},dr=_e({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:t}){const e=o,s=t,a=F(e.level===0),l=F(!1),r=F(!1),m=F({}),f=()=>{e.node.type==="directory"&&(a.value=!a.value)},p=()=>{e.node.type==="directory"?f():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),x()},v=()=>{s("download-file",e.node),x()},P=g=>{g.preventDefault(),r.value=!0,m.value={position:"fixed",top:`${g.clientY}px`,left:`${g.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",x)},0)},x=()=>{r.value=!1,document.removeEventListener("click",x)},d=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(g){console.error("Failed to copy path:",g)}x()},k=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":ze.getFileIcon(e.node),y=g=>{if(g===0)return"0 B";const I=1024,C=["B","KB","MB","GB"],M=Math.floor(Math.log(g)/Math.log(I));return parseFloat((g/Math.pow(I,M)).toFixed(1))+" "+C[M]};return Le(()=>{document.removeEventListener("click",x)}),(g,I)=>{const C=ps("FileTreeNode",!0);return h(),b("div",ar,[n("div",{class:ce(["node-content",{"is-directory":g.node.type==="directory","is-file":g.node.type==="file","is-expanded":a.value}]),style:We({paddingLeft:`${g.level*16+12}px`}),onClick:p,onContextmenu:ve(P,["prevent"])},[g.node.type==="directory"?(h(),b("div",{key:0,class:"expand-icon",onClick:ve(f,["stop"])},[A(u(D),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):O("",!0),n("div",lr,[A(u(D),{icon:k()},null,8,["icon"])]),n("span",rr,i(g.node.name),1),g.node.type==="file"?(h(),b("span",ir,i(y(g.node.size)),1)):O("",!0),l.value?(h(),b("div",cr,[g.node.type==="file"?(h(),b("button",{key:0,onClick:I[0]||(I[0]=ve(M=>g.$emit("download-file",g.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(u(D),{icon:"carbon:download"})])):O("",!0)])):O("",!0)],38),g.node.type==="directory"&&a.value&&g.node.children?(h(),b("div",ur,[(h(!0),b(ue,null,me(g.node.children,M=>(h(),ge(C,{key:M.path,node:M,level:g.level+1,onFileSelected:I[1]||(I[1]=w=>g.$emit("file-selected",w)),onDownloadFile:I[2]||(I[2]=w=>g.$emit("download-file",w))},null,8,["node","level"]))),128))])):O("",!0),r.value?(h(),b("div",{key:1,class:"context-menu",style:We(m.value),onClick:I[3]||(I[3]=ve(()=>{},["stop"]))},[n("div",{class:"context-menu-item",onClick:c},[A(u(D),{icon:"carbon:view"}),I[4]||(I[4]=n("span",null,"Open",-1))]),g.node.type==="file"?(h(),b("div",{key:0,class:"context-menu-item",onClick:v},[A(u(D),{icon:"carbon:download"}),I[5]||(I[5]=n("span",null,"Download",-1))])):O("",!0),I[7]||(I[7]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:d},[A(u(D),{icon:"carbon:copy"}),I[6]||(I[6]=n("span",null,"Copy Path",-1))])],4)):O("",!0)])}}}),pr=we(dr,[["__scopeId","data-v-3fc455d1"]]),mr={class:"file-browser"},hr={class:"file-browser-header"},fr={class:"header-actions"},vr=["disabled","title"],gr={class:"file-browser-content"},br={class:"file-tree-panel"},yr={key:0,class:"loading-state"},_r={key:1,class:"error-state"},wr={key:0,class:"waiting-for-files"},$r={class:"message-content"},Sr={class:"tips"},kr=["disabled"],Er={key:1,class:"actual-error"},Pr={key:2,class:"empty-state"},Tr={key:3,class:"file-tree"},Cr={key:0,class:"file-content-panel"},Ir={class:"file-content-header"},Rr={class:"file-info"},xr={class:"file-name"},Ar={class:"file-size"},Fr={class:"file-actions"},Dr=["title"],Mr=["title"],Nr={class:"file-content-body"},Ur={key:0,class:"loading-content"},Lr={key:1,class:"content-error"},Or={key:2,class:"file-content"},Br={key:0,class:"text-content"},qr={key:1,class:"binary-content"},Vr=_e({name:"FileBrowser",__name:"index",props:{planId:{}},setup(o){const t=o,{t:e}=De(),s=F(!1),a=F(null),l=F(null),r=F(null),m=F(null),f=F(!1),p=F(null),c=F(null),v=te(()=>!m.value||!r.value?!1:ze.isTextFile(m.value.mimeType,r.value.name)),P=te(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),x=()=>{c.value&&(clearTimeout(c.value),c.value=null)},d=()=>{x(),c.value=window.setTimeout(()=>{P.value&&k()},5e3)},k=async()=>{if(t.planId){s.value=!0,a.value=null,x();try{l.value=await ze.getFileTree(t.planId)}catch(w){a.value=w instanceof Error?w.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",w);const N=w instanceof Error?w.message:"";(N.includes("Plan directory not found")||N.includes("not found"))&&d()}finally{s.value=!1}}},y=async w=>{if(w.type!=="directory"){r.value=w,m.value=null,f.value=!0,p.value=null;try{m.value=await ze.getFileContent(t.planId,w.path)}catch(N){p.value=N instanceof Error?N.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",N)}finally{f.value=!1}}},g=async w=>{try{await ze.downloadFile(t.planId,w.path,w.name)}catch(N){console.error("Failed to download file:",N)}},I=()=>{r.value=null,m.value=null,p.value=null},C=w=>ze.getFileIcon(w),M=w=>{if(w===0)return"0 B";const N=1024,G=["B","KB","MB","GB"],R=Math.floor(Math.log(w)/Math.log(N));return parseFloat((w/Math.pow(N,R)).toFixed(1))+" "+G[R]};return de(()=>t.planId,w=>{w&&(r.value=null,m.value=null,k())},{immediate:!0}),Fe(()=>{t.planId&&k()}),Le(()=>{x()}),(w,N)=>(h(),b("div",mr,[n("div",hr,[n("h3",null,i(w.$t("fileBrowser.title")),1),n("div",fr,[n("button",{class:"refresh-btn",onClick:k,disabled:s.value,title:w.$t("fileBrowser.refresh")},[A(u(D),{icon:"carbon:refresh",class:ce({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,vr)])]),n("div",gr,[n("div",br,[s.value?(h(),b("div",yr,[A(u(D),{icon:"carbon:loading",class:"rotating"}),n("span",null,i(w.$t("fileBrowser.loading")),1)])):a.value?(h(),b("div",_r,[P.value?(h(),b("div",wr,[A(u(D),{icon:"carbon:time",class:"rotating"}),n("div",$r,[n("h3",null,i(w.$t("fileBrowser.waitingForGeneration")),1),n("p",null,i(w.$t("fileBrowser.planExecuting")),1),n("div",Sr,[A(u(D),{icon:"carbon:information"}),n("span",null,i(w.$t("fileBrowser.filesTip")),1)])]),n("button",{onClick:k,class:"retry-btn",disabled:s.value},[A(u(D),{icon:"carbon:refresh",class:ce({rotating:s.value})},null,8,["class"]),ie(" "+i(s.value?w.$t("fileBrowser.checking"):w.$t("fileBrowser.checkNow")),1)],8,kr)])):(h(),b("div",Er,[A(u(D),{icon:"carbon:warning"}),n("span",null,i(a.value),1),n("button",{onClick:k,class:"retry-btn"},i(w.$t("fileBrowser.retry")),1)]))])):l.value?(h(),b("div",Tr,[A(pr,{node:l.value,level:0,onFileSelected:y,onDownloadFile:g},null,8,["node"])])):(h(),b("div",Pr,[A(u(D),{icon:"carbon:folder-off"}),n("span",null,i(w.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),b("div",Cr,[n("div",Ir,[n("div",Rr,[A(u(D),{icon:C(r.value)},null,8,["icon"]),n("span",xr,i(r.value.name),1),n("span",Ar,"("+i(M(r.value.size))+")",1)]),n("div",Fr,[n("button",{onClick:N[0]||(N[0]=G=>g(r.value)),class:"download-btn",title:w.$t("fileBrowser.download")},[A(u(D),{icon:"carbon:download"})],8,Dr),n("button",{onClick:I,class:"close-btn",title:w.$t("common.close")},[A(u(D),{icon:"carbon:close"})],8,Mr)])]),n("div",Nr,[f.value?(h(),b("div",Ur,[A(u(D),{icon:"carbon:loading",class:"rotating"}),n("span",null,i(w.$t("fileBrowser.loadingContent")),1)])):p.value?(h(),b("div",Lr,[A(u(D),{icon:"carbon:warning"}),n("span",null,i(p.value),1)])):m.value?(h(),b("div",Or,[v.value?(h(),b("div",Br,[n("pre",null,[n("code",null,i(m.value.content),1)])])):(h(),b("div",qr,[A(u(D),{icon:"carbon:document-unknown"}),n("p",null,i(w.$t("fileBrowser.binaryFile")),1),n("button",{onClick:N[1]||(N[1]=G=>g(r.value)),class:"download-btn-large"},[A(u(D),{icon:"carbon:download"}),ie(" "+i(w.$t("fileBrowser.downloadToView")),1)])]))])):O("",!0)])])):O("",!0)])]))}}),jr=we(Vr,[["__scopeId","data-v-a19b1e5b"]]),Hr="/api/executor";async function _s(o){try{const t=await fetch(`${Hr}/agent-execution/${o}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,t),null}}async function zr(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),_s(o)}function Wr(){const o=Qe(),t=Xe(),e=F(null),s=F(null),a=F("details"),l=te(()=>o.rootPlanId.value),r=g=>{if(!g)return null;for(const[I,C]of t.planExecutionRecords.entries())if((C.rootPlanId||C.currentPlanId)&&C.agentExecutionSequence)for(const w of C.agentExecutionSequence){if(w.stepId===g){const N=C.rootPlanId||C.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:g,rootPlanId:N,planId:I}),N||null}if(w.subPlanExecutionRecords)for(const N of w.subPlanExecutionRecords){const G=m(N,g);if(G)return G}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",g),null},m=(g,I)=>{if(!g||!g.agentExecutionSequence)return null;for(const C of g.agentExecutionSequence){if(C.stepId===I)return g.rootPlanId||g.currentPlanId||null;if(C.subPlanExecutionRecords)for(const M of C.subPlanExecutionRecords){const w=m(M,I);if(w)return w}}return null},f=te(()=>s.value||l.value),p=te(()=>!f.value),c=async g=>{if(console.log("[useRightPanel] Step selected:",{stepId:g}),!g){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}try{const I=r(g);I?(s.value=I,console.log("[useRightPanel] Set selectedRootPlanId to:",I)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const C=await _s(g);if(!C){console.warn("[useRightPanel] Agent execution detail not found for stepId:",g),e.value=null,s.value=null;return}const M={stepId:g,title:C.agentName??`Step ${g}`,description:C.agentDescription??"",agentExecution:C,completed:C.status==="FINISHED",current:C.status==="RUNNING"};e.value=M,console.log("[useRightPanel] Step details updated:",M),await Re(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(I){console.error("[useRightPanel] Error fetching step details:",I),e.value=null,s.value=null}},v=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const g=await zr(e.value.stepId);g&&(e.value.agentExecution=g,e.value.completed=g.status==="FINISHED",e.value.current=g.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(g){console.error("[useRightPanel] Error refreshing step:",g)}},P=g=>{a.value=g,console.log("[useRightPanel] Active tab set to:",g)},x=g=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",g)},d=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},k=g=>{if(g===null||typeof g>"u"||g==="")return"N/A";try{const I=typeof g=="object"?g:JSON.parse(g);return JSON.stringify(I,null,2)}catch{return String(g)}},y=()=>{e.value=null,s.value=null,a.value="details",console.log("[useRightPanel] State reset")};return{selectedStep:Ue(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:f,shouldShowNoTaskMessage:p,handleStepSelected:c,refreshCurrentStep:v,setActiveTab:P,updateDisplayedPlanProgress:x,clearSelectedStep:d,formatJson:k,reset:y}}let Et=null;function Gr(){return Et||(Et=Wr()),Et}const Kr={class:"right-panel"},Jr={class:"preview-header"},Xr={class:"preview-tabs"},Qr={class:"preview-content"},Yr={key:0,class:"step-details"},Zr={key:0,class:"step-info"},ei={key:0,class:"agent-info"},ti={class:"info-item"},si={class:"label"},oi=["title"],ni={class:"info-item"},ai={class:"label"},li={class:"value"},ri={class:"execution-status"},ii={class:"status-item"},ci={class:"status-text"},ui={key:0},di={key:0,class:"think-act-steps"},pi={class:"steps-container"},mi={class:"step-header"},hi={class:"step-number"},fi={class:"think-section"},vi={class:"think-content"},gi={class:"input"},bi={class:"label"},yi={class:"output"},_i={class:"label"},wi={key:0,class:"action-section"},$i={class:"action-content"},Si={class:"tool-info"},ki={class:"label"},Ei={class:"value"},Pi={class:"input"},Ti={class:"label"},Ci={class:"output"},Ii={class:"label"},Ri={key:0,class:"sub-plan-section"},xi={class:"sub-plan-content"},Ai={class:"sub-plan-header"},Fi={class:"sub-plan-info"},Di={class:"label"},Mi={class:"value"},Ni={key:0,class:"sub-plan-info"},Ui={class:"label"},Li={class:"value"},Oi={class:"sub-plan-status"},Bi={class:"status-text"},qi={key:0,class:"no-steps-message"},Vi={key:1,class:"no-execution-message"},ji={class:"step-basic-info"},Hi={class:"info-item"},zi={class:"label"},Wi={class:"value"},Gi={key:0,class:"info-item"},Ki={class:"label"},Ji={class:"value"},Xi={class:"info-item"},Qi={class:"label"},Yi={class:"no-execution-hint"},Zi={key:2,class:"execution-indicator"},ec={class:"execution-text"},tc={key:1,class:"no-selection"},sc=["title"],oc={key:1,class:"file-browser-container"},nc={key:1,class:"no-plan-message"},ac={class:"message-content"},lc={class:"tips"},rc=_e({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:t}){const e=o,{t:s}=De(),a=Gr(),l=F(),r=F(!1),m=F(!0),f=F(!0),p=te(()=>a.selectedStep.value),c=te({get:()=>a.activeTab.value,set:R=>a.setActiveTab(R)}),v=te(()=>a.fileBrowserPlanId.value),P=te(()=>a.shouldShowNoTaskMessage.value),x=te(()=>p.value?p.value.completed?s("rightPanel.status.completed"):p.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),d=async R=>{await a.handleStepSelected(R),setTimeout(()=>{g()},100),C()},k=async()=>{await a.refreshCurrentStep(),C()};de(()=>e.selectedStepId,async R=>{R?await d(R):a.clearSelectedStep()},{immediate:!0});const y=R=>{l.value=R??void 0},g=()=>{if(!l.value)return;const{scrollTop:R,scrollHeight:H,clientHeight:S}=l.value,_=H-R-S<50,$=H>S;m.value=_,r.value=$&&!_,_?f.value=!0:H-R-S>100&&(f.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:R,scrollHeight:H,clientHeight:S,isAtBottom:_,hasScrollableContent:$,showButton:r.value,shouldAutoScroll:f.value})},I=()=>{l.value&&(l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"}),Re(()=>{f.value=!0,g()}))},C=()=>{!f.value||!l.value||Re(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},M=a.formatJson,w=()=>{f.value=!0,l.value&&l.value.removeEventListener("scroll",g)},N=()=>{const R=()=>{const H=l.value;return H?(y(H),H.addEventListener("scroll",g),f.value=!0,g(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Re(()=>{R()||setTimeout(()=>{R()},100)})};return Fe(()=>{console.log("[RightPanel] Component mounted"),Re(()=>{N()})}),Le(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),w()}),t({handleStepSelected:d,refreshCurrentStep:k,updateDisplayedPlanProgress:R=>{a.updateDisplayedPlanProgress(R)}}),(R,H)=>(h(),b("div",Kr,[n("div",Jr,[n("div",Xr,[n("div",{class:ce(["tab-item",{active:c.value==="details"}]),onClick:H[0]||(H[0]=S=>c.value="details")},[A(u(D),{icon:"carbon:events"}),n("span",null,i(u(s)("rightPanel.stepExecutionDetails")),1)],2),n("div",{class:ce(["tab-item",{active:c.value==="files"}]),onClick:H[1]||(H[1]=S=>c.value="files")},[A(u(D),{icon:"carbon:folder"}),n("span",null,i(u(s)("fileBrowser.title")),1)],2)])]),n("div",Qr,[c.value==="details"?(h(),b("div",Yr,[p.value?(h(),b("div",Zr,[n("h3",null,i(p.value.title||p.value.description||u(s)("rightPanel.defaultStepTitle",{number:1})),1),p.value.agentExecution?(h(),b("div",ei,[n("div",ti,[n("span",si,i(u(s)("rightPanel.executingAgent"))+":",1),n("span",{class:"value",title:p.value.agentExecution.agentName==="ConfigurableDynaAgent"?u(s)("chat.clickToViewExecutionDetails"):""},i(p.value.agentExecution.agentName==="ConfigurableDynaAgent"?u(s)("chat.funcAgentExecutionDetails"):p.value.agentExecution.agentName),9,oi)]),n("div",ni,[n("span",ai,i(u(s)("rightPanel.callingModel"))+":",1),n("span",li,i(p.value.agentExecution.modelName),1)])])):O("",!0),n("div",ri,[n("div",ii,[p.value.completed?(h(),ge(u(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):p.value.current?(h(),ge(u(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),ge(u(D),{key:2,icon:"carbon:time",class:"status-icon pending"})),n("span",ci,i(x.value),1)])])])):O("",!0),n("div",{ref_key:"scrollContainer",ref:l,class:"step-details-scroll-container",onScroll:g},[p.value?(h(),b("div",ui,[p.value.agentExecution?.thinkActSteps&&p.value.agentExecution.thinkActSteps.length>0?(h(),b("div",di,[n("h4",null,i(u(s)("rightPanel.thinkAndActionSteps")),1),n("div",pi,[(h(!0),b(ue,null,me(p.value.agentExecution.thinkActSteps,(S,_)=>(h(),b("div",{key:_,class:"think-act-step"},[n("div",mi,[n("span",hi,"#"+i(_+1),1),n("span",{class:ce(["step-status",S.status])},i(S.status||u(s)("rightPanel.executing")),3)]),n("div",fi,[n("h5",null,[A(u(D),{icon:"carbon:thinking"}),ie(" "+i(u(s)("rightPanel.thinking")),1)]),n("div",vi,[n("div",gi,[n("span",bi,i(u(s)("rightPanel.input"))+":",1),n("pre",null,i(u(M)(S.thinkInput)),1)]),n("div",yi,[n("span",_i,i(u(s)("rightPanel.output"))+":",1),n("pre",null,i(u(M)(S.thinkOutput)),1)])])]),S.actionNeeded?(h(),b("div",wi,[n("h5",null,[A(u(D),{icon:"carbon:play"}),ie(" "+i(u(s)("rightPanel.action")),1)]),n("div",$i,[(h(!0),b(ue,null,me(S.actToolInfoList,($,B)=>(h(),b("div",{key:B},[n("div",Si,[n("span",ki,i(u(s)("rightPanel.tool"))+":",1),n("span",Ei,i($.name||""),1)]),n("div",Pi,[n("span",Ti,i(u(s)("rightPanel.toolParameters"))+":",1),n("pre",null,i(u(M)($.parameters)),1)]),n("div",Ci,[n("span",Ii,i(u(s)("rightPanel.executionResult"))+":",1),n("pre",null,i(u(M)($.result)),1)])]))),128))]),S.subPlanExecutionRecord?(h(),b("div",Ri,[n("h5",null,[A(u(D),{icon:"carbon:tree-view"}),ie(" "+i(u(s)("rightPanel.subPlan")),1)]),n("div",xi,[n("div",Ai,[n("div",Fi,[n("span",Di,i(R.$t("rightPanel.subPlanId"))+":",1),n("span",Mi,i(S.subPlanExecutionRecord.currentPlanId),1)]),S.subPlanExecutionRecord.title?(h(),b("div",Ni,[n("span",Ui,i(R.$t("rightPanel.title"))+":",1),n("span",Li,i(S.subPlanExecutionRecord.title),1)])):O("",!0),n("div",Oi,[S.subPlanExecutionRecord.completed?(h(),ge(u(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),ge(u(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),n("span",Bi,i(S.subPlanExecutionRecord.completed?R.$t("rightPanel.status.completed"):R.$t("rightPanel.status.executing")),1)])])])])):O("",!0)])):O("",!0)]))),128))]),p.value.agentExecution&&!p.value.agentExecution.thinkActSteps?.length?(h(),b("div",qi,[n("p",null,i(u(s)("rightPanel.noStepDetails")),1)])):p.value.agentExecution?O("",!0):(h(),b("div",Vi,[A(u(D),{icon:"carbon:information",class:"info-icon"}),n("h4",null,i(u(s)("rightPanel.stepInfo")),1),n("div",ji,[n("div",Hi,[n("span",zi,i(u(s)("rightPanel.stepName"))+":",1),n("span",Wi,i(p.value.title||p.value.description||p.value.stepId),1)]),p.value.description?(h(),b("div",Gi,[n("span",Ki,i(R.$t("rightPanel.description"))+":",1),n("span",Ji,i(p.value.description),1)])):O("",!0),n("div",Xi,[n("span",Qi,i(R.$t("rightPanel.status.label"))+":",1),n("span",{class:ce(["value",{"status-completed":p.value.completed,"status-current":p.value.current,"status-pending":!p.value.completed&&!p.value.current}])},i(p.value.completed?R.$t("rightPanel.status.completed"):p.value.current?R.$t("rightPanel.status.executing"):R.$t("rightPanel.status.pending")),3)])]),n("p",Yi,i(u(s)("rightPanel.noExecutionInfo")),1)])),p.value.current&&!p.value.completed?(h(),b("div",Zi,[H[2]||(H[2]=n("div",{class:"execution-waves"},[n("div",{class:"wave wave-1"}),n("div",{class:"wave wave-2"}),n("div",{class:"wave wave-3"})],-1)),n("p",ec,[A(u(D),{icon:"carbon:in-progress",class:"rotating-icon"}),ie(" "+i(u(s)("rightPanel.stepExecuting")),1)])])):O("",!0)])):(h(),b("div",tc,[A(u(D),{icon:"carbon:events",class:"empty-icon"}),n("h3",null,i(u(s)("rightPanel.noStepSelected")),1),n("p",null,i(u(s)("rightPanel.selectStepHint")),1)]))])):O("",!0),A(Lt,{name:"scroll-button"},{default:Ge(()=>[r.value?(h(),b("button",{key:0,onClick:I,class:"scroll-to-bottom-btn",title:u(s)("rightPanel.scrollToBottom")},[A(u(D),{icon:"carbon:chevron-down"})],8,sc)):O("",!0)]),_:1})],544)])):O("",!0),c.value==="files"?(h(),b("div",oc,[v.value?(h(),ge(jr,{key:0,"plan-id":v.value},null,8,["plan-id"])):P.value?(h(),b("div",nc,[A(u(D),{icon:"carbon:folder-off"}),n("div",ac,[n("h3",null,i(u(s)("fileBrowser.noFilesYet")),1),n("p",null,i(u(s)("fileBrowser.noPlanExecuting")),1),n("div",lc,[A(u(D),{icon:"carbon:information"}),n("span",null,i(u(s)("fileBrowser.startTaskTip")),1)])])])):O("",!0)])):O("",!0)])]))}}),ic=we(rc,[["__scopeId","data-v-fac037bd"]]);class ws{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function cc(){const o=F([]),t=F(!1),e=F(null);return{availableTools:o,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await ws.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),o.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",o.value=[]}finally{t.value=!1}}},reset:()=>{o.value=[],t.value=!1,e.value=null}}}let Pt=null;function at(){return Pt||(Pt=cc()),Pt}class $s{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}const uc={class:"modal-form wide-modal"},dc={class:"form-section"},pc={class:"form-item"},mc=["placeholder"],hc={class:"field-description"},fc={class:"form-section"},vc={class:"section-title"},gc={key:0,class:"params-help-text"},bc={class:"parameter-table"},yc=["onUpdate:modelValue","placeholder","readonly"],_c=["onUpdate:modelValue","placeholder"],wc={class:"form-section"},$c={class:"service-publish-options"},Sc={class:"internal-toolcall-publish-option"},kc={class:"checkbox-label"},Ec={class:"checkbox-text"},Pc={class:"checkbox-description"},Tc={class:"http-publish-option"},Cc={class:"checkbox-label"},Ic={class:"checkbox-text"},Rc={class:"checkbox-description"},xc={class:"button-container"},Ac=["disabled"],Fc=["disabled"],Dc=_e({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(o,{expose:t,emit:e}){const{t:s}=De(),a=Je(),l=at(),r=o,m=e,f=te({get:()=>r.modelValue,set:_=>m("update:modelValue",_)}),p=F(""),c=F(""),v=F(!1),P=F(!1),x=F(!1),d=F(!0),k=F({parameters:[],hasParameters:!1,requirements:""}),y=F(!1),g=nt({userRequest:"",parameters:[]}),I=te(()=>{const _=!!a.selectedTemplate.value?.toolConfig;return s(_?"mcpService.updateService":"mcpService.createService")}),C=te(()=>!!a.selectedTemplate.value?.toolConfig),M=()=>{const _=a.selectedTemplate.value?.toolConfig;_?(g.userRequest=_.toolDescription||"",x.value=_.enableHttpService??!1,d.value=_.enableInternalToolcall??!0,_.inputSchema&&Array.isArray(_.inputSchema)&&_.inputSchema.length>0?g.parameters=_.inputSchema.map($=>({name:$.name||"",description:$.description||""})):k.value.hasParameters||(g.parameters=[])):(g.userRequest="",x.value=!1,d.value=!0,k.value.hasParameters||(g.parameters=[]))},w=async()=>{const _=a.currentPlanTemplateId.value;if(!_){k.value={parameters:[],hasParameters:!1,requirements:""};return}y.value=!0;try{const $=await $s.getParameterRequirements(_);if(k.value=$,$.hasParameters){const B=new Map;g.parameters.forEach(W=>{W.name&&B.set(W.name,W.description||"")}),g.parameters=$.parameters.map(W=>({name:W,description:B.get(W)||""}))}}catch($){console.error("[PublishModal] Failed to load parameter requirements:",$),$ instanceof Error&&!$.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),k.value={parameters:[],hasParameters:!1,requirements:""}}finally{y.value=!1}},N=(_,$)=>{$==="success"?(c.value=_,setTimeout(()=>{c.value=""},3e3)):$==="error"&&(p.value=_,setTimeout(()=>{p.value=""},5e3))},G=()=>{if(!g.userRequest.trim())return N(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return N(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return N(s("mcpService.toolNameRequiredError"),"error"),!1;if(!d.value&&!x.value)return N("Please select at least one service type","error"),!1;for(let B=0;B<g.parameters.length;B++){const W=g.parameters[B];if(W.name&&!W.description.trim())return N(`Parameter "${W.name}" description cannot be empty`,"error"),!1;if(W.description&&!W.name.trim())return N(`Parameter description "${W.description}" corresponding name cannot be empty`,"error"),!1}return!0},R=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",g),console.log("[PublishModal] Publish as HTTP service:",x.value),!G()){console.log("[PublishModal] Form validation failed");return}v.value=!0;try{const _=g.parameters.filter(W=>W.name.trim()&&W.description.trim()).map(W=>({name:W.name.trim(),description:W.description.trim(),type:"string"}));if(a.setToolDescription(g.userRequest.trim()),a.setEnableInternalToolcall(d.value),a.setEnableHttpService(x.value),a.setInputSchema(_),!await a.save())throw new Error("Failed to save plan template");const B=[];d.value&&B.push("Internal Method Call"),x.value&&B.push("HTTP Service"),B.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",B.join(", ")),N(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),m("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),N(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),m("published",null))}catch(_){console.error("[PublishModal] Failed to publish service:",_);const $=_ instanceof Error?_.message:"Unknown error";N(s("mcpService.publishFailed")+": "+$,"error")}finally{v.value=!1}},H=async()=>{if(P.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const _=a.currentPlanTemplateId.value;if(!_){N(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}P.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",_),a.setToolConfig(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),N(s("mcpService.deleteSuccess"),"success"),f.value=!1,m("published",null)}catch($){console.error("[PublishModal] Failed to delete tool config:",$);const B=$ instanceof Error?$.message:"Unknown error";N(s("mcpService.deleteFailed")+": "+B,"error")}finally{P.value=!1}};return de(()=>r.modelValue,async()=>{f.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),M(),await w())}),de(()=>a.currentPlanTemplateId.value,(_,$)=>{_&&_!==$&&($&&_.startsWith("planTemplate-")?setTimeout(()=>{w()},1e3):w())}),Fe(async()=>{f.value&&(console.log("[PublishModal] Initialize when component mounted"),M(),await w())}),t({loadParameterRequirements:w}),(_,$)=>(h(),b(ue,null,[A(fs,{modelValue:f.value,"onUpdate:modelValue":$[3]||($[3]=B=>f.value=B),title:I.value,onConfirm:R},{footer:Ge(()=>[n("div",xc,[C.value?(h(),b("button",{key:0,class:"action-btn danger",onClick:H,disabled:P.value},[P.value?(h(),ge(u(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ge(u(D),{key:1,icon:"carbon:trash-can"})),ie(" "+i(P.value?u(s)("mcpService.deleting"):u(s)("mcpService.delete")),1)],8,Ac)):O("",!0),n("button",{class:"action-btn primary",onClick:R,disabled:v.value},[v.value?(h(),ge(u(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ge(u(D),{key:1,icon:"carbon:cloud-upload"})),ie(" "+i(v.value?u(s)("mcpService.publishing"):u(s)("mcpService.publishAsService")),1)],8,Fc)])]),default:Ge(()=>[n("div",uc,[n("div",dc,[n("div",pc,[n("label",null,i(u(s)("mcpService.toolDescriptionRequired")),1),fe(n("textarea",{"onUpdate:modelValue":$[0]||($[0]=B=>g.userRequest=B),placeholder:u(s)("mcpService.toolDescriptionPlaceholder"),class:ce([{error:!g.userRequest||!g.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,mc),[[Se,g.userRequest]]),n("div",hc,i(u(s)("mcpService.toolDescriptionDescription")),1)])]),n("div",fc,[n("div",vc,i(u(s)("mcpService.parameterConfig")),1),k.value.hasParameters?(h(),b("div",gc,i(u(s)("sidebar.parameterRequirementsHelp")),1)):O("",!0),n("div",bc,[n("table",null,[n("thead",null,[n("tr",null,[n("th",null,i(u(s)("mcpService.parameterName")),1),n("th",null,i(u(s)("mcpService.parameterDescription")),1)])]),n("tbody",null,[(h(!0),b(ue,null,me(g.parameters,(B,W)=>(h(),b("tr",{key:W},[n("td",null,[fe(n("input",{type:"text","onUpdate:modelValue":se=>B.name=se,placeholder:u(s)("mcpService.parameterName"),class:ce(["parameter-input",{"readonly-input":k.value.hasParameters}]),readonly:k.value.hasParameters,required:""},null,10,yc),[[Se,B.name]])]),n("td",null,[fe(n("input",{type:"text","onUpdate:modelValue":se=>B.description=se,placeholder:u(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,_c),[[Se,B.description]])])]))),128))])])])]),n("div",wc,[n("div",$c,[n("div",Sc,[n("label",kc,[fe(n("input",{type:"checkbox","onUpdate:modelValue":$[1]||($[1]=B=>d.value=B),class:"checkbox-input"},null,512),[[xt,d.value]]),n("span",Ec,i(u(s)("mcpService.publishAsInternalToolcall")),1)]),n("div",Pc,i(u(s)("mcpService.publishAsInternalToolcallDescription")),1)]),n("div",Tc,[n("label",Cc,[fe(n("input",{type:"checkbox","onUpdate:modelValue":$[2]||($[2]=B=>x.value=B),class:"checkbox-input"},null,512),[[xt,x.value]]),n("span",Ic,i(u(s)("mcpService.publishAsHttpService")),1)]),n("div",Rc,i(u(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),p.value?(h(),b("div",{key:0,class:"error-toast",onClick:$[4]||($[4]=B=>p.value="")},[A(u(D),{icon:"carbon:error"}),ie(" "+i(p.value),1)])):O("",!0),c.value?(h(),b("div",{key:1,class:"success-toast",onClick:$[5]||($[5]=B=>c.value="")},[A(u(D),{icon:"carbon:checkmark"}),ie(" "+i(c.value),1)])):O("",!0)],64))}}),Mc=we(Dc,[["__scopeId","data-v-84723fb4"]]),Nc={class:"modal-header"},Uc={class:"modal-body"},Lc={class:"modal-footer"},Oc=["disabled"],Bc=_e({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(o,{emit:t}){const e=t,s=F(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(m,f)=>m.modelValue?(h(),b("div",{key:0,class:"modal-overlay",onClick:a},[n("div",{class:"modal-content",onClick:f[0]||(f[0]=ve(()=>{},["stop"]))},[n("div",Nc,[n("h3",null,i(m.$t("sidebar.saveConfirmationTitle")),1),n("button",{class:"close-btn",onClick:a},[A(u(D),{icon:"carbon:close",width:"16"})])]),n("div",Uc,[n("p",null,i(m.$t("sidebar.saveConfirmationMessage")),1)]),n("div",Lc,[n("button",{class:"btn btn-secondary",onClick:a},i(m.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),ge(u(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):O("",!0),ie(" "+i(s.value?m.$t("sidebar.saving"):m.$t("common.save")),1)],8,Oc),n("button",{class:"btn btn-danger",onClick:r},i(m.$t("sidebar.continueWithoutSave")),1)])])])):O("",!0)}}),qc=we(Bc,[["__scopeId","data-v-4817656d"]]),Vc={class:"config-section"},jc={class:"section-header"},Hc={class:"execution-content"},zc={class:"params-requirements-group"},Wc={class:"params-help-text"},Gc={key:0,class:"parameter-fields"},Kc={class:"parameter-label"},Jc=["onUpdate:modelValue","placeholder","onInput"],Xc={key:0,class:"parameter-error"},Qc={key:1,class:"validation-message"},Yc=["disabled"],Zc=["disabled"],eu={key:1,class:"call-example-wrapper"},tu={class:"call-example-header"},su={class:"call-example-title"},ou={class:"call-example-description"},nu={class:"internal-call-wrapper"},au={class:"call-info"},lu={class:"call-method"},ru={class:"call-endpoint"},iu={key:0,class:"call-endpoint"},cu={class:"call-description"},uu={class:"call-example"},du={class:"example-code"},pu={key:2,class:"call-example-wrapper"},mu={class:"call-example-header"},hu={class:"call-example-title"},fu={class:"call-example-description"},vu={class:"http-api-urls-wrapper"},gu={class:"tab-container"},bu={class:"tab-header"},yu=["onClick"],_u={class:"tab-content"},wu={class:"http-api-url-display"},$u={class:"api-method"},Su={class:"api-endpoint"},ku={class:"api-description"},Eu={key:0,class:"api-example"},Pu={class:"example-code"},Tu={key:3,class:"call-example-wrapper"},Cu={class:"call-example-header"},Iu={class:"call-example-title"},Ru={class:"call-example-description"},xu={class:"mcp-call-wrapper"},Au={class:"call-info"},Fu={class:"call-method"},Du={class:"call-endpoint"},Mu={class:"call-description"},Nu={class:"call-example"},Uu={class:"example-code"},Lu=_e({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=De(),s=vs(),a=Je(),l=Qe(),r=Xe(),m=o,f=F(""),p=F(!1),c=F({parameters:[],hasParameters:!1,requirements:""}),v=F({}),P=F(!1),x=F("get-sync"),d=F({}),k=F(!1),y=F(!1),g=te(()=>a.getCoordinatorToolConfig()),I=F(),C=F([]),M=F(null),w=F(!1),N=F(null),G=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),R=te(()=>{const q=a.selectedTemplate.value?.toolConfig;return q?.enableInternalToolcall??q?.enableHttpService??q?.enableMcpService??!1}),H=te(()=>R.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),S=te(()=>l.isLoading.value),_=te(()=>S.value||m.isExecuting?!1:c.value.hasParameters?c.value.parameters.every(q=>{const X=v.value[q];return typeof X=="string"&&X.trim()!==""}):!0),$=(q,X)=>{C.value=q.map(ee=>ee.originalName),M.value=X,console.log("[ExecutionController] Files uploaded:",q.length,"uploadKey:",X)},B=q=>{C.value=q.map(X=>X.originalName),console.log("[ExecutionController] Files removed, remaining:",q.length)},W=q=>{M.value=q,console.log("[ExecutionController] Upload key changed:",q)},se=()=>{console.log("[ExecutionController] Upload started")},he=()=>{console.log("[ExecutionController] Upload completed")},Me=q=>{console.error("[ExecutionController] Upload error:",q)},Ee=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",m.isExecuting,l.isLoading.value,y.value),s.error(e("sidebar.executionInProgress"));return}if(re.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!Z()){console.log("[ExecutionController] âŒ Parameter validation failed:",d.value);return}const q=c.value.hasParameters&&Object.keys(v.value).length>0?v.value:void 0;N.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:q,uploadedFiles:C.value,uploadKey:M.value},w.value=!0;return}await ke()},ke=async()=>{if(m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(y.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!Z()){console.log("[ExecutionController] âŒ Parameter validation failed:",d.value),y.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),y.value=!1;return}const q=a.getConfig(),X=a.selectedTemplate.value.planTemplateId||q.planTemplateId,ee={title:q.title||a.selectedTemplate.value.title||"Execution Plan",steps:(q.steps||[]).map(be=>({stepRequirement:be.stepRequirement||"",agentName:be.agentName||"",modelName:be.modelName||null,selectedToolKeys:[],terminateColumns:be.terminateColumns||"",stepContent:""})),directResponse:q.directResponse||!1,...X&&{planTemplateId:X},...q.planType&&{planType:q.planType}},$e=a.selectedTemplate.value.title??q.title??"Execution Plan",j=c.value.hasParameters&&Object.keys(v.value).length>0?v.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",j),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(ee,null,2));const Q={title:$e,planData:ee,params:void 0,replacementParams:j,uploadedFiles:C.value,uploadKey:M.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(Q,null,2));const le=await l.executePlan(Q);le.success?console.log("[ExecutionController] âœ… Plan execution started successfully:",le.planId):(console.error("[ExecutionController] âŒ Plan execution failed:",le.error),s.error(le.error||e("sidebar.executeFailed")))}catch(q){console.error("[ExecutionController] âŒ Error executing plan:",q);const X=q instanceof Error?q.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+X),y.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),V(),console.log("[ExecutionController] âœ… Cleanup completed")}},qe=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const q=a.validate();if(!q.isValid){s.error(`Invalid format, please correct and save.
Errors: `+q.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const $e=a.generateJsonString().trim();a.updateVersionsAfterSave($e);const j=a.planVersions.value.length;re.hasTaskRequirementModified=!1,await new Promise(Q=>setTimeout(Q,500)),await J(),await re.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:j})),await new Promise(Q=>setTimeout(Q,500)),N.value&&(await ke(),N.value=null)}catch(q){console.error("[ExecutionController] âŒ Failed to save before execute:",q);const X=q instanceof Error?q.message:e("sidebar.saveFailed");throw s.error(X),q}},U=async()=>{console.log("[ExecutionController] â© Continue without save requested"),N.value&&(await ke(),N.value=null)},L=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}p.value=!0},V=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),f.value="",v.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},J=async()=>{await new Promise(q=>setTimeout(q,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(q=>q.stepRequirement).join(" ||| ")),await new Promise(q=>setTimeout(q,200)),await Y()},Y=async()=>{const q=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",q),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!q){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},v.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},v.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),P.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const X=await $s.getParameterRequirements(q);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(X,null,2)),c.value=X;const ee={};X.parameters.forEach($e=>{ee[$e]=v.value[$e]||""}),v.value=ee,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(v.value,null,2)),Ce()}catch(X){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",X),X instanceof Error&&!X.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},v.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(v.value,null,2))}finally{P.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},ne=(q,X)=>{v.value[q]=X,d.value[q]&&delete d.value[q],Ce()},Z=()=>{if(d.value={},k.value=!1,!c.value.hasParameters)return!0;let q=!1;return c.value.parameters.forEach(X=>{(v.value[X]?v.value[X].trim():"")||(d.value[X]=`${X} is required`,q=!0)}),k.value=q,!q},Ce=()=>{c.value.hasParameters?f.value=JSON.stringify(v.value,null,2):f.value=""};return de(()=>a.currentPlanTemplateId.value,(q,X)=>{if(q&&q!==X){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),X&&q.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),Y()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),Y())}}),de(()=>{const q=a.selectedTemplate.value;return!q||!q.steps?"":q.steps.map(X=>X.stepRequirement||"").join("|||")},async(q,X)=>{if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}q!==X&&a.currentPlanTemplateId.value&&(console.log("[ExecutionController] ðŸ”„ Steps content changed, will refresh parameter requirements"),console.log("[ExecutionController] ðŸ“‹ Old content:",X?.substring(0,100)||"empty"),console.log("[ExecutionController] ðŸ“‹ New content:",q?.substring(0,100)||"empty"),await new Promise(ee=>setTimeout(ee,2e3)),console.log("[ExecutionController] â° Refreshing parameters after steps change"),await J())},{deep:!1}),de(()=>re.hasTaskRequirementModified,async(q,X)=>{if(X===!0&&q===!1&&a.currentPlanTemplateId.value){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(ee=>setTimeout(ee,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await J()}}),hs(()=>{const q=r.planExecutionRecords;!Array.from(q.entries()).some(([,$e])=>$e&&!$e.completed&&$e.status!=="failed")&&y.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan"),y.value=!1)}),Fe(()=>{Y()}),t({executionParams:f,clearExecutionParams:V,loadParameterRequirements:Y,refreshParameterRequirements:J,fileUploadRef:I,uploadedFiles:C,uploadKey:M}),(q,X)=>(h(),b(ue,null,[n("div",Vc,[n("div",jc,[A(u(D),{icon:"carbon:play",width:"16"}),n("span",null,i(u(e)("sidebar.executionController")),1)]),n("div",Hc,[n("div",zc,[n("label",null,i(u(e)("sidebar.parameterRequirements")),1),n("div",Wc,i(u(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),b("div",Gc,[(h(!0),b(ue,null,me(c.value.parameters,ee=>(h(),b("div",{key:ee,class:"parameter-field"},[n("label",Kc,[ie(i(ee)+" ",1),X[2]||(X[2]=n("span",{class:"required"},"*",-1))]),fe(n("input",{"onUpdate:modelValue":$e=>v.value[ee]=$e,class:ce(["parameter-input",{error:d.value[ee]}]),placeholder:u(e)("sidebar.enterValueFor",{param:ee}),onInput:$e=>ne(ee,$e.target.value),required:""},null,42,Jc),[[Se,v.value[ee]]]),d.value[ee]?(h(),b("div",Xc,i(d.value[ee]),1)):O("",!0)]))),128))])):O("",!0),c.value.hasParameters&&!_.value&&!m.isExecuting?(h(),b("div",Qc,[A(u(D),{icon:"carbon:warning",width:"14"}),ie(" "+i(u(e)("sidebar.fillAllRequiredParameters")),1)])):O("",!0)]),A(ys,{ref_key:"fileUploadRef",ref:I,disabled:m.isExecuting,onFilesUploaded:$,onFilesRemoved:B,onUploadKeyChanged:W,onUploadStarted:se,onUploadCompleted:he,onUploadError:Me},null,8,["disabled"]),n("button",{class:"btn btn-primary execute-btn",onClick:Ee,disabled:!_.value},[A(u(D),{icon:m.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ce({spinning:m.isExecuting})},null,8,["icon","class"]),ie(" "+i(m.isExecuting?u(e)("sidebar.executing"):u(e)("sidebar.executePlan")),1)],8,Yc),g.value?(h(),b("button",{key:0,class:"btn publish-mcp-btn",onClick:L,disabled:!u(a).currentPlanTemplateId.value},[A(u(D),{icon:"carbon:application",width:"16"}),ie(" "+i(H.value),1)],8,Zc)):O("",!0),u(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),b("div",eu,[n("div",tu,[n("h4",su,i(u(e)("sidebar.internalCall")),1),n("p",ou,i(u(e)("sidebar.internalCallDescription")),1)]),n("div",nu,[n("div",au,[n("div",lu,i(u(e)("sidebar.internalMethodCall")),1),n("div",ru,i(u(e)("sidebar.toolName"))+": "+i(u(a).selectedTemplate.value?.title||u(a).currentPlanTemplateId.value||""),1),u(a).selectedTemplate.value?.serviceGroup?(h(),b("div",iu,i(u(e)("sidebar.serviceGroup"))+": "+i(u(a).selectedTemplate.value.serviceGroup),1)):O("",!0),n("div",cu,i(u(e)("sidebar.internalCallUsage")),1),n("div",uu,[n("strong",null,i(u(e)("sidebar.usage"))+":",1),n("pre",du,i(u(e)("sidebar.internalCallExample")),1)])])])])):O("",!0),u(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),b("div",pu,[n("div",mu,[n("h4",hu,i(u(e)("sidebar.httpCallExample")),1),n("p",fu,i(u(e)("sidebar.httpCallDescription")),1)]),n("div",vu,[n("div",gu,[n("div",bu,[(h(!0),b(ue,null,me(G.value,ee=>(h(),b("button",{key:ee.id,class:ce(["tab-button",{active:x.value===ee.id}]),onClick:$e=>x.value=ee.id},i(ee.label),11,yu))),128))]),n("div",_u,[(h(!0),b(ue,null,me(G.value,ee=>fe((h(),b("div",{key:ee.id,class:"tab-panel"},[n("div",wu,[n("div",$u,i(ee.method),1),n("div",Su,i(ee.endpoint),1),n("div",ku,i(ee.description),1),ee.example?(h(),b("div",Eu,[n("strong",null,i(u(e)("sidebar.example"))+":",1),n("pre",Pu,i(ee.example),1)])):O("",!0)])])),[[to,x.value===ee.id]])),128))])])])])):O("",!0),u(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),b("div",Tu,[n("div",Cu,[n("h4",Iu,i(u(e)("sidebar.mcpCall")),1),n("p",Ru,i(u(e)("sidebar.mcpCallDescription")),1)]),n("div",xu,[n("div",Au,[n("div",Fu,i(u(e)("sidebar.mcpServiceCall")),1),n("div",Du,i(u(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),n("div",Mu,i(u(e)("sidebar.mcpCallUsage")),1),n("div",Nu,[n("strong",null,i(u(e)("sidebar.usage"))+":",1),n("pre",Uu,i(u(e)("sidebar.mcpCallExample")),1)])])])])):O("",!0)])]),A(qc,{modelValue:w.value,"onUpdate:modelValue":X[0]||(X[0]=ee=>w.value=ee),onSave:qe,onContinue:U},null,8,["modelValue"]),A(Mc,{modelValue:p.value,"onUpdate:modelValue":X[1]||(X[1]=ee=>p.value=ee)},null,8,["modelValue"])],64))}}),Ou=we(Lu,[["__scopeId","data-v-4defd748"]]);function Ss(o,t){return function(){return o.apply(t,arguments)}}const{toString:Bu}=Object.prototype,{getPrototypeOf:Ot}=Object,{iterator:bt,toStringTag:ks}=Symbol,yt=(o=>t=>{const e=Bu.call(t);return o[e]||(o[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=o=>(o=o.toLowerCase(),t=>yt(t)===o),_t=o=>t=>typeof t===o,{isArray:Ye}=Array,Ke=_t("undefined");function lt(o){return o!==null&&!Ke(o)&&o.constructor!==null&&!Ke(o.constructor)&&xe(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const Es=Oe("ArrayBuffer");function qu(o){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(o):t=o&&o.buffer&&Es(o.buffer),t}const Vu=_t("string"),xe=_t("function"),Ps=_t("number"),rt=o=>o!==null&&typeof o=="object",ju=o=>o===!0||o===!1,mt=o=>{if(yt(o)!=="object")return!1;const t=Ot(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ks in o)&&!(bt in o)},Hu=o=>{if(!rt(o)||lt(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},zu=Oe("Date"),Wu=Oe("File"),Gu=Oe("Blob"),Ku=Oe("FileList"),Ju=o=>rt(o)&&xe(o.pipe),Xu=o=>{let t;return o&&(typeof FormData=="function"&&o instanceof FormData||xe(o.append)&&((t=yt(o))==="formdata"||t==="object"&&xe(o.toString)&&o.toString()==="[object FormData]"))},Qu=Oe("URLSearchParams"),[Yu,Zu,ed,td]=["ReadableStream","Request","Response","Headers"].map(Oe),sd=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(o,t,{allOwnKeys:e=!1}={}){if(o===null||typeof o>"u")return;let s,a;if(typeof o!="object"&&(o=[o]),Ye(o))for(s=0,a=o.length;s<a;s++)t.call(null,o[s],s,o);else{if(lt(o))return;const l=e?Object.getOwnPropertyNames(o):Object.keys(o),r=l.length;let m;for(s=0;s<r;s++)m=l[s],t.call(null,o[m],m,o)}}function Ts(o,t){if(lt(o))return null;t=t.toLowerCase();const e=Object.keys(o);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Cs=o=>!Ke(o)&&o!==Ve;function Ft(){const{caseless:o,skipUndefined:t}=Cs(this)&&this||{},e={},s=(a,l)=>{const r=o&&Ts(e,l)||l;mt(e[r])&&mt(a)?e[r]=Ft(e[r],a):mt(a)?e[r]=Ft({},a):Ye(a)?e[r]=a.slice():(!t||!Ke(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const od=(o,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&xe(a)?o[l]=Ss(a,e):o[l]=a},{allOwnKeys:s}),o),nd=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),ad=(o,t,e,s)=>{o.prototype=Object.create(t.prototype,s),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:t.prototype}),e&&Object.assign(o.prototype,e)},ld=(o,t,e,s)=>{let a,l,r;const m={};if(t=t||{},o==null)return t;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)r=a[l],(!s||s(r,o,t))&&!m[r]&&(t[r]=o[r],m[r]=!0);o=e!==!1&&Ot(o)}while(o&&(!e||e(o,t))&&o!==Object.prototype);return t},rd=(o,t,e)=>{o=String(o),(e===void 0||e>o.length)&&(e=o.length),e-=t.length;const s=o.indexOf(t,e);return s!==-1&&s===e},id=o=>{if(!o)return null;if(Ye(o))return o;let t=o.length;if(!Ps(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=o[t];return e},cd=(o=>t=>o&&t instanceof o)(typeof Uint8Array<"u"&&Ot(Uint8Array)),ud=(o,t)=>{const s=(o&&o[bt]).call(o);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(o,l[0],l[1])}},dd=(o,t)=>{let e;const s=[];for(;(e=o.exec(t))!==null;)s.push(e);return s},pd=Oe("HTMLFormElement"),md=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),Xt=(({hasOwnProperty:o})=>(t,e)=>o.call(t,e))(Object.prototype),hd=Oe("RegExp"),Is=(o,t)=>{const e=Object.getOwnPropertyDescriptors(o),s={};it(e,(a,l)=>{let r;(r=t(a,l,o))!==!1&&(s[l]=r||a)}),Object.defineProperties(o,s)},fd=o=>{Is(o,(t,e)=>{if(xe(o)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=o[e];if(xe(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},vd=(o,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return Ye(o)?s(o):s(String(o).split(t)),e},gd=()=>{},bd=(o,t)=>o!=null&&Number.isFinite(o=+o)?o:t;function yd(o){return!!(o&&xe(o.append)&&o[ks]==="FormData"&&o[bt])}const _d=o=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=Ye(s)?[]:{};return it(s,(r,m)=>{const f=e(r,a+1);!Ke(f)&&(l[m]=f)}),t[a]=void 0,l}}return s};return e(o,0)},wd=Oe("AsyncFunction"),$d=o=>o&&(rt(o)||xe(o))&&xe(o.then)&&xe(o.catch),Rs=((o,t)=>o?setImmediate:t?((e,s)=>(Ve.addEventListener("message",({source:a,data:l})=>{a===Ve&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),Ve.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",xe(Ve.postMessage)),Sd=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||Rs,kd=o=>o!=null&&xe(o[bt]),T={isArray:Ye,isArrayBuffer:Es,isBuffer:lt,isFormData:Xu,isArrayBufferView:qu,isString:Vu,isNumber:Ps,isBoolean:ju,isObject:rt,isPlainObject:mt,isEmptyObject:Hu,isReadableStream:Yu,isRequest:Zu,isResponse:ed,isHeaders:td,isUndefined:Ke,isDate:zu,isFile:Wu,isBlob:Gu,isRegExp:hd,isFunction:xe,isStream:Ju,isURLSearchParams:Qu,isTypedArray:cd,isFileList:Ku,forEach:it,merge:Ft,extend:od,trim:sd,stripBOM:nd,inherits:ad,toFlatObject:ld,kindOf:yt,kindOfTest:Oe,endsWith:rd,toArray:id,forEachEntry:ud,matchAll:dd,isHTMLForm:pd,hasOwnProperty:Xt,hasOwnProp:Xt,reduceDescriptors:Is,freezeMethods:fd,toObjectSet:vd,toCamelCase:md,noop:gd,toFiniteNumber:bd,findKey:Ts,global:Ve,isContextDefined:Cs,isSpecCompliantForm:yd,toJSONObject:_d,isAsyncFn:wd,isThenable:$d,setImmediate:Rs,asap:Sd,isIterable:kd};function oe(o,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}T.inherits(oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:T.toJSONObject(this.config),code:this.code,status:this.status}}});const xs=oe.prototype,As={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{As[o]={value:o}});Object.defineProperties(oe,As);Object.defineProperty(xs,"isAxiosError",{value:!0});oe.from=(o,t,e,s,a,l)=>{const r=Object.create(xs);T.toFlatObject(o,r,function(c){return c!==Error.prototype},p=>p!=="isAxiosError");const m=o&&o.message?o.message:"Error",f=t==null&&o?o.code:t;return oe.call(r,m,f,e,s,a),o&&r.cause==null&&Object.defineProperty(r,"cause",{value:o,configurable:!0}),r.name=o&&o.name||"Error",l&&Object.assign(r,l),r};const Ed=null;function Dt(o){return T.isPlainObject(o)||T.isArray(o)}function Fs(o){return T.endsWith(o,"[]")?o.slice(0,-2):o}function Qt(o,t,e){return o?o.concat(t).map(function(a,l){return a=Fs(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function Pd(o){return T.isArray(o)&&!o.some(Dt)}const Td=T.toFlatObject(T,{},null,function(t){return/^is[A-Z]/.test(t)});function wt(o,t,e){if(!T.isObject(o))throw new TypeError("target must be an object");t=t||new FormData,e=T.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,y){return!T.isUndefined(y[k])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,r=e.indexes,f=(e.Blob||typeof Blob<"u"&&Blob)&&T.isSpecCompliantForm(t);if(!T.isFunction(a))throw new TypeError("visitor must be a function");function p(d){if(d===null)return"";if(T.isDate(d))return d.toISOString();if(T.isBoolean(d))return d.toString();if(!f&&T.isBlob(d))throw new oe("Blob is not supported. Use a Buffer instead.");return T.isArrayBuffer(d)||T.isTypedArray(d)?f&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function c(d,k,y){let g=d;if(d&&!y&&typeof d=="object"){if(T.endsWith(k,"{}"))k=s?k:k.slice(0,-2),d=JSON.stringify(d);else if(T.isArray(d)&&Pd(d)||(T.isFileList(d)||T.endsWith(k,"[]"))&&(g=T.toArray(d)))return k=Fs(k),g.forEach(function(C,M){!(T.isUndefined(C)||C===null)&&t.append(r===!0?Qt([k],M,l):r===null?k:k+"[]",p(C))}),!1}return Dt(d)?!0:(t.append(Qt(y,k,l),p(d)),!1)}const v=[],P=Object.assign(Td,{defaultVisitor:c,convertValue:p,isVisitable:Dt});function x(d,k){if(!T.isUndefined(d)){if(v.indexOf(d)!==-1)throw Error("Circular reference detected in "+k.join("."));v.push(d),T.forEach(d,function(g,I){(!(T.isUndefined(g)||g===null)&&a.call(t,g,T.isString(I)?I.trim():I,k,P))===!0&&x(g,k?k.concat(I):[I])}),v.pop()}}if(!T.isObject(o))throw new TypeError("data must be an object");return x(o),t}function Yt(o){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Bt(o,t){this._pairs=[],o&&wt(o,this,t)}const Ds=Bt.prototype;Ds.append=function(t,e){this._pairs.push([t,e])};Ds.toString=function(t){const e=t?function(s){return t.call(this,s,Yt)}:Yt;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function Cd(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ms(o,t,e){if(!t)return o;const s=e&&e.encode||Cd;T.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=T.isURLSearchParams(t)?t.toString():new Bt(t,e).toString(s),l){const r=o.indexOf("#");r!==-1&&(o=o.slice(0,r)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class Zt{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){T.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Ns={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Id=typeof URLSearchParams<"u"?URLSearchParams:Bt,Rd=typeof FormData<"u"?FormData:null,xd=typeof Blob<"u"?Blob:null,Ad={isBrowser:!0,classes:{URLSearchParams:Id,FormData:Rd,Blob:xd},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",Mt=typeof navigator=="object"&&navigator||void 0,Fd=qt&&(!Mt||["ReactNative","NativeScript","NS"].indexOf(Mt.product)<0),Dd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Md=qt&&window.location.href||"http://localhost",Nd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:Fd,hasStandardBrowserWebWorkerEnv:Dd,navigator:Mt,origin:Md},Symbol.toStringTag,{value:"Module"})),Te={...Nd,...Ad};function Ud(o,t){return wt(o,new Te.classes.URLSearchParams,{visitor:function(e,s,a,l){return Te.isNode&&T.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Ld(o){return T.matchAll(/\w+|\[(\w*)]/g,o).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Od(o){const t={},e=Object.keys(o);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=o[l];return t}function Us(o){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const m=Number.isFinite(+r),f=l>=e.length;return r=!r&&T.isArray(a)?a.length:r,f?(T.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!m):((!a[r]||!T.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&T.isArray(a[r])&&(a[r]=Od(a[r])),!m)}if(T.isFormData(o)&&T.isFunction(o.entries)){const e={};return T.forEachEntry(o,(s,a)=>{t(Ld(s),a,e,0)}),e}return null}function Bd(o,t,e){if(T.isString(o))try{return(t||JSON.parse)(o),T.trim(o)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(o)}const ct={transitional:Ns,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=T.isObject(t);if(l&&T.isHTMLForm(t)&&(t=new FormData(t)),T.isFormData(t))return a?JSON.stringify(Us(t)):t;if(T.isArrayBuffer(t)||T.isBuffer(t)||T.isStream(t)||T.isFile(t)||T.isBlob(t)||T.isReadableStream(t))return t;if(T.isArrayBufferView(t))return t.buffer;if(T.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Ud(t,this.formSerializer).toString();if((m=T.isFileList(t))||s.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return wt(m?{"files[]":t}:t,f&&new f,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Bd(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(T.isResponse(t)||T.isReadableStream(t))return t;if(t&&T.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(m){if(r)throw m.name==="SyntaxError"?oe.from(m,oe.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Te.classes.FormData,Blob:Te.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};T.forEach(["delete","get","head","post","put","patch"],o=>{ct.headers[o]={}});const qd=T.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Vd=o=>{const t={};let e,s,a;return o&&o.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&qd[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},es=Symbol("internals");function ot(o){return o&&String(o).trim().toLowerCase()}function ht(o){return o===!1||o==null?o:T.isArray(o)?o.map(ht):String(o)}function jd(o){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(o);)t[s[1]]=s[2];return t}const Hd=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function Tt(o,t,e,s,a){if(T.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!T.isString(t)){if(T.isString(s))return t.indexOf(s)!==-1;if(T.isRegExp(s))return s.test(t)}}function zd(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Wd(o,t){const e=T.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(o,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Ae=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(m,f,p){const c=ot(f);if(!c)throw new Error("header name must be a non-empty string");const v=T.findKey(a,c);(!v||a[v]===void 0||p===!0||p===void 0&&a[v]!==!1)&&(a[v||f]=ht(m))}const r=(m,f)=>T.forEach(m,(p,c)=>l(p,c,f));if(T.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(T.isString(t)&&(t=t.trim())&&!Hd(t))r(Vd(t),e);else if(T.isObject(t)&&T.isIterable(t)){let m={},f,p;for(const c of t){if(!T.isArray(c))throw TypeError("Object iterator must return a key-value pair");m[p=c[0]]=(f=m[p])?T.isArray(f)?[...f,c[1]]:[f,c[1]]:c[1]}r(m,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=ot(t),t){const s=T.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return jd(a);if(T.isFunction(e))return e.call(this,a,s);if(T.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=ot(t),t){const s=T.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Tt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=ot(r),r){const m=T.findKey(s,r);m&&(!e||Tt(s,s[m],m,e))&&(delete s[m],a=!0)}}return T.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Tt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return T.forEach(this,(a,l)=>{const r=T.findKey(s,l);if(r){e[r]=ht(a),delete e[l];return}const m=t?zd(l):String(l).trim();m!==l&&delete e[l],e[m]=ht(a),s[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return T.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&T.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[es]=this[es]={accessors:{}}).accessors,a=this.prototype;function l(r){const m=ot(r);s[m]||(Wd(a,r),s[m]=!0)}return T.isArray(t)?t.forEach(l):l(t),this}};Ae.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);T.reduceDescriptors(Ae.prototype,({value:o},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>o,set(s){this[e]=s}}});T.freezeMethods(Ae);function Ct(o,t){const e=this||ct,s=t||e,a=Ae.from(s.headers);let l=s.data;return T.forEach(o,function(m){l=m.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function Ls(o){return!!(o&&o.__CANCEL__)}function Ze(o,t,e){oe.call(this,o??"canceled",oe.ERR_CANCELED,t,e),this.name="CanceledError"}T.inherits(Ze,oe,{__CANCEL__:!0});function Os(o,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?o(e):t(new oe("Request failed with status code "+e.status,[oe.ERR_BAD_REQUEST,oe.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Gd(o){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return t&&t[1]||""}function Kd(o,t){o=o||10;const e=new Array(o),s=new Array(o);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(f){const p=Date.now(),c=s[l];r||(r=p),e[a]=f,s[a]=p;let v=l,P=0;for(;v!==a;)P+=e[v++],v=v%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),p-r<t)return;const x=c&&p-c;return x?Math.round(P*1e3/x):void 0}}function Jd(o,t){let e=0,s=1e3/t,a,l;const r=(p,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),o(...p)};return[(...p)=>{const c=Date.now(),v=c-e;v>=s?r(p,c):(a=p,l||(l=setTimeout(()=>{l=null,r(a)},s-v)))},()=>a&&r(a)]}const gt=(o,t,e=3)=>{let s=0;const a=Kd(50,250);return Jd(l=>{const r=l.loaded,m=l.lengthComputable?l.total:void 0,f=r-s,p=a(f),c=r<=m;s=r;const v={loaded:r,total:m,progress:m?r/m:void 0,bytes:f,rate:p||void 0,estimated:p&&m&&c?(m-r)/p:void 0,event:l,lengthComputable:m!=null,[t?"download":"upload"]:!0};o(v)},e)},ts=(o,t)=>{const e=o!=null;return[s=>t[0]({lengthComputable:e,total:o,loaded:s}),t[1]]},ss=o=>(...t)=>T.asap(()=>o(...t)),Xd=Te.hasStandardBrowserEnv?((o,t)=>e=>(e=new URL(e,Te.origin),o.protocol===e.protocol&&o.host===e.host&&(t||o.port===e.port)))(new URL(Te.origin),Te.navigator&&/(msie|trident)/i.test(Te.navigator.userAgent)):()=>!0,Qd=Te.hasStandardBrowserEnv?{write(o,t,e,s,a,l,r){if(typeof document>"u")return;const m=[`${o}=${encodeURIComponent(t)}`];T.isNumber(e)&&m.push(`expires=${new Date(e).toUTCString()}`),T.isString(s)&&m.push(`path=${s}`),T.isString(a)&&m.push(`domain=${a}`),l===!0&&m.push("secure"),T.isString(r)&&m.push(`SameSite=${r}`),document.cookie=m.join("; ")},read(o){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Yd(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function Zd(o,t){return t?o.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):o}function Bs(o,t,e){let s=!Yd(t);return o&&(s||e==!1)?Zd(o,t):t}const os=o=>o instanceof Ae?{...o}:o;function He(o,t){t=t||{};const e={};function s(p,c,v,P){return T.isPlainObject(p)&&T.isPlainObject(c)?T.merge.call({caseless:P},p,c):T.isPlainObject(c)?T.merge({},c):T.isArray(c)?c.slice():c}function a(p,c,v,P){if(T.isUndefined(c)){if(!T.isUndefined(p))return s(void 0,p,v,P)}else return s(p,c,v,P)}function l(p,c){if(!T.isUndefined(c))return s(void 0,c)}function r(p,c){if(T.isUndefined(c)){if(!T.isUndefined(p))return s(void 0,p)}else return s(void 0,c)}function m(p,c,v){if(v in t)return s(p,c);if(v in o)return s(void 0,p)}const f={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:m,headers:(p,c,v)=>a(os(p),os(c),v,!0)};return T.forEach(Object.keys({...o,...t}),function(c){const v=f[c]||a,P=v(o[c],t[c],c);T.isUndefined(P)&&v!==m||(e[c]=P)}),e}const qs=o=>{const t=He({},o);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:m}=t;if(t.headers=r=Ae.from(r),t.url=Ms(Bs(t.baseURL,t.url,t.allowAbsoluteUrls),o.params,o.paramsSerializer),m&&r.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),T.isFormData(e)){if(Te.hasStandardBrowserEnv||Te.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(T.isFunction(e.getHeaders)){const f=e.getHeaders(),p=["content-type","content-length"];Object.entries(f).forEach(([c,v])=>{p.includes(c.toLowerCase())&&r.set(c,v)})}}if(Te.hasStandardBrowserEnv&&(s&&T.isFunction(s)&&(s=s(t)),s||s!==!1&&Xd(t.url))){const f=a&&l&&Qd.read(l);f&&r.set(a,f)}return t},ep=typeof XMLHttpRequest<"u",tp=ep&&function(o){return new Promise(function(e,s){const a=qs(o);let l=a.data;const r=Ae.from(a.headers).normalize();let{responseType:m,onUploadProgress:f,onDownloadProgress:p}=a,c,v,P,x,d;function k(){x&&x(),d&&d(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function g(){if(!y)return;const C=Ae.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),w={data:!m||m==="text"||m==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:C,config:o,request:y};Os(function(G){e(G),k()},function(G){s(G),k()},w),y=null}"onloadend"in y?y.onloadend=g:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(g)},y.onabort=function(){y&&(s(new oe("Request aborted",oe.ECONNABORTED,o,y)),y=null)},y.onerror=function(M){const w=M&&M.message?M.message:"Network Error",N=new oe(w,oe.ERR_NETWORK,o,y);N.event=M||null,s(N),y=null},y.ontimeout=function(){let M=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const w=a.transitional||Ns;a.timeoutErrorMessage&&(M=a.timeoutErrorMessage),s(new oe(M,w.clarifyTimeoutError?oe.ETIMEDOUT:oe.ECONNABORTED,o,y)),y=null},l===void 0&&r.setContentType(null),"setRequestHeader"in y&&T.forEach(r.toJSON(),function(M,w){y.setRequestHeader(w,M)}),T.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),m&&m!=="json"&&(y.responseType=a.responseType),p&&([P,d]=gt(p,!0),y.addEventListener("progress",P)),f&&y.upload&&([v,x]=gt(f),y.upload.addEventListener("progress",v),y.upload.addEventListener("loadend",x)),(a.cancelToken||a.signal)&&(c=C=>{y&&(s(!C||C.type?new Ze(null,o,y):C),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const I=Gd(a.url);if(I&&Te.protocols.indexOf(I)===-1){s(new oe("Unsupported protocol "+I+":",oe.ERR_BAD_REQUEST,o));return}y.send(l||null)})},sp=(o,t)=>{const{length:e}=o=o?o.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(p){if(!a){a=!0,m();const c=p instanceof Error?p:this.reason;s.abort(c instanceof oe?c:new Ze(c instanceof Error?c.message:c))}};let r=t&&setTimeout(()=>{r=null,l(new oe(`timeout ${t} of ms exceeded`,oe.ETIMEDOUT))},t);const m=()=>{o&&(r&&clearTimeout(r),r=null,o.forEach(p=>{p.unsubscribe?p.unsubscribe(l):p.removeEventListener("abort",l)}),o=null)};o.forEach(p=>p.addEventListener("abort",l));const{signal:f}=s;return f.unsubscribe=()=>T.asap(m),f}},op=function*(o,t){let e=o.byteLength;if(e<t){yield o;return}let s=0,a;for(;s<e;)a=s+t,yield o.slice(s,a),s=a},np=async function*(o,t){for await(const e of ap(o))yield*op(e,t)},ap=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const t=o.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},ns=(o,t,e,s)=>{const a=np(o,t);let l=0,r,m=f=>{r||(r=!0,s&&s(f))};return new ReadableStream({async pull(f){try{const{done:p,value:c}=await a.next();if(p){m(),f.close();return}let v=c.byteLength;if(e){let P=l+=v;e(P)}f.enqueue(new Uint8Array(c))}catch(p){throw m(p),p}},cancel(f){return m(f),a.return()}},{highWaterMark:2})},as=64*1024,{isFunction:dt}=T,lp=(({Request:o,Response:t})=>({Request:o,Response:t}))(T.global),{ReadableStream:ls,TextEncoder:rs}=T.global,is=(o,...t)=>{try{return!!o(...t)}catch{return!1}},rp=o=>{o=T.merge.call({skipUndefined:!0},lp,o);const{fetch:t,Request:e,Response:s}=o,a=t?dt(t):typeof fetch=="function",l=dt(e),r=dt(s);if(!a)return!1;const m=a&&dt(ls),f=a&&(typeof rs=="function"?(d=>k=>d.encode(k))(new rs):async d=>new Uint8Array(await new e(d).arrayBuffer())),p=l&&m&&is(()=>{let d=!1;const k=new e(Te.origin,{body:new ls,method:"POST",get duplex(){return d=!0,"half"}}).headers.has("Content-Type");return d&&!k}),c=r&&m&&is(()=>T.isReadableStream(new s("").body)),v={stream:c&&(d=>d.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!v[d]&&(v[d]=(k,y)=>{let g=k&&k[d];if(g)return g.call(k);throw new oe(`Response type '${d}' is not supported`,oe.ERR_NOT_SUPPORT,y)})});const P=async d=>{if(d==null)return 0;if(T.isBlob(d))return d.size;if(T.isSpecCompliantForm(d))return(await new e(Te.origin,{method:"POST",body:d}).arrayBuffer()).byteLength;if(T.isArrayBufferView(d)||T.isArrayBuffer(d))return d.byteLength;if(T.isURLSearchParams(d)&&(d=d+""),T.isString(d))return(await f(d)).byteLength},x=async(d,k)=>{const y=T.toFiniteNumber(d.getContentLength());return y??P(k)};return async d=>{let{url:k,method:y,data:g,signal:I,cancelToken:C,timeout:M,onDownloadProgress:w,onUploadProgress:N,responseType:G,headers:R,withCredentials:H="same-origin",fetchOptions:S}=qs(d),_=t||fetch;G=G?(G+"").toLowerCase():"text";let $=sp([I,C&&C.toAbortSignal()],M),B=null;const W=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let se;try{if(N&&p&&y!=="get"&&y!=="head"&&(se=await x(R,g))!==0){let U=new e(k,{method:"POST",body:g,duplex:"half"}),L;if(T.isFormData(g)&&(L=U.headers.get("content-type"))&&R.setContentType(L),U.body){const[V,J]=ts(se,gt(ss(N)));g=ns(U.body,as,V,J)}}T.isString(H)||(H=H?"include":"omit");const he=l&&"credentials"in e.prototype,Me={...S,signal:$,method:y.toUpperCase(),headers:R.normalize().toJSON(),body:g,duplex:"half",credentials:he?H:void 0};B=l&&new e(k,Me);let Ee=await(l?_(B,S):_(k,Me));const ke=c&&(G==="stream"||G==="response");if(c&&(w||ke&&W)){const U={};["status","statusText","headers"].forEach(Y=>{U[Y]=Ee[Y]});const L=T.toFiniteNumber(Ee.headers.get("content-length")),[V,J]=w&&ts(L,gt(ss(w),!0))||[];Ee=new s(ns(Ee.body,as,V,()=>{J&&J(),W&&W()}),U)}G=G||"text";let qe=await v[T.findKey(v,G)||"text"](Ee,d);return!ke&&W&&W(),await new Promise((U,L)=>{Os(U,L,{data:qe,headers:Ae.from(Ee.headers),status:Ee.status,statusText:Ee.statusText,config:d,request:B})})}catch(he){throw W&&W(),he&&he.name==="TypeError"&&/Load failed|fetch/i.test(he.message)?Object.assign(new oe("Network Error",oe.ERR_NETWORK,d,B),{cause:he.cause||he}):oe.from(he,he&&he.code,d,B)}}},ip=new Map,Vs=o=>{let t=o&&o.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,m=r,f,p,c=ip;for(;m--;)f=l[m],p=c.get(f),p===void 0&&c.set(f,p=m?new Map:rp(t)),c=p;return p};Vs();const Vt={http:Ed,xhr:tp,fetch:{get:Vs}};T.forEach(Vt,(o,t)=>{if(o){try{Object.defineProperty(o,"name",{value:t})}catch{}Object.defineProperty(o,"adapterName",{value:t})}});const cs=o=>`- ${o}`,cp=o=>T.isFunction(o)||o===null||o===!1;function up(o,t){o=T.isArray(o)?o:[o];const{length:e}=o;let s,a;const l={};for(let r=0;r<e;r++){s=o[r];let m;if(a=s,!cp(s)&&(a=Vt[(m=String(s)).toLowerCase()],a===void 0))throw new oe(`Unknown adapter '${m}'`);if(a&&(T.isFunction(a)||(a=a.get(t))))break;l[m||"#"+r]=a}if(!a){const r=Object.entries(l).map(([f,p])=>`adapter ${f} `+(p===!1?"is not supported by the environment":"is not available in the build"));let m=e?r.length>1?`since :
`+r.map(cs).join(`
`):" "+cs(r[0]):"as no adapter specified";throw new oe("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return a}const js={getAdapter:up,adapters:Vt};function It(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Ze(null,o)}function us(o){return It(o),o.headers=Ae.from(o.headers),o.data=Ct.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),js.getAdapter(o.adapter||ct.adapter,o)(o).then(function(s){return It(o),s.data=Ct.call(o,o.transformResponse,s),s.headers=Ae.from(s.headers),s},function(s){return Ls(s)||(It(o),s&&s.response&&(s.response.data=Ct.call(o,o.transformResponse,s.response),s.response.headers=Ae.from(s.response.headers))),Promise.reject(s)})}const Hs="1.13.2",$t={};["object","boolean","number","function","string","symbol"].forEach((o,t)=>{$t[o]=function(s){return typeof s===o||"a"+(t<1?"n ":" ")+o}});const ds={};$t.transitional=function(t,e,s){function a(l,r){return"[Axios v"+Hs+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,m)=>{if(t===!1)throw new oe(a(r," has been removed"+(e?" in "+e:"")),oe.ERR_DEPRECATED);return e&&!ds[r]&&(ds[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,m):!0}};$t.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function dp(o,t,e){if(typeof o!="object")throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);const s=Object.keys(o);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const m=o[l],f=m===void 0||r(m,l,o);if(f!==!0)throw new oe("option "+l+" must be "+f,oe.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new oe("Unknown option "+l,oe.ERR_BAD_OPTION)}}const ft={assertOptions:dp,validators:$t},Be=ft.validators;let je=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Zt,response:new Zt}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=He(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&ft.assertOptions(s,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),a!=null&&(T.isFunction(a)?e.paramsSerializer={serialize:a}:ft.assertOptions(a,{encode:Be.function,serialize:Be.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),ft.assertOptions(e,{baseUrl:Be.spelling("baseURL"),withXsrfToken:Be.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&T.merge(l.common,l[e.method]);l&&T.forEach(["delete","get","head","post","put","patch","common"],d=>{delete l[d]}),e.headers=Ae.concat(r,l);const m=[];let f=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(e)===!1||(f=f&&k.synchronous,m.unshift(k.fulfilled,k.rejected))});const p=[];this.interceptors.response.forEach(function(k){p.push(k.fulfilled,k.rejected)});let c,v=0,P;if(!f){const d=[us.bind(this),void 0];for(d.unshift(...m),d.push(...p),P=d.length,c=Promise.resolve(e);v<P;)c=c.then(d[v++],d[v++]);return c}P=m.length;let x=e;for(;v<P;){const d=m[v++],k=m[v++];try{x=d(x)}catch(y){k.call(this,y);break}}try{c=us.call(this,x)}catch(d){return Promise.reject(d)}for(v=0,P=p.length;v<P;)c=c.then(p[v++],p[v++]);return c}getUri(t){t=He(this.defaults,t);const e=Bs(t.baseURL,t.url,t.allowAbsoluteUrls);return Ms(e,t.params,t.paramsSerializer)}};T.forEach(["delete","get","head","options"],function(t){je.prototype[t]=function(e,s){return this.request(He(s||{},{method:t,url:e,data:(s||{}).data}))}});T.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,m){return this.request(He(m||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}je.prototype[t]=e(),je.prototype[t+"Form"]=e(!0)});let pp=class zs{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(m=>{s.subscribe(m),l=m}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,m){s.reason||(s.reason=new Ze(l,r,m),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new zs(function(a){t=a}),cancel:t}}};function mp(o){return function(e){return o.apply(null,e)}}function hp(o){return T.isObject(o)&&o.isAxiosError===!0}const Nt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Nt).forEach(([o,t])=>{Nt[t]=o});function Ws(o){const t=new je(o),e=Ss(je.prototype.request,t);return T.extend(e,je.prototype,t,{allOwnKeys:!0}),T.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Ws(He(o,a))},e}const ye=Ws(ct);ye.Axios=je;ye.CanceledError=Ze;ye.CancelToken=pp;ye.isCancel=Ls;ye.VERSION=Hs;ye.toFormData=wt;ye.AxiosError=oe;ye.Cancel=ye.CanceledError;ye.all=function(t){return Promise.all(t)};ye.spread=mp;ye.isAxiosError=hp;ye.mergeConfig=He;ye.AxiosHeaders=Ae;ye.formToJSON=o=>Us(T.isHTMLForm(o)?new FormData(o):o);ye.getAdapter=js.getAdapter;ye.HttpStatusCode=Nt;ye.default=ye;const{Axios:_f,AxiosError:wf,CanceledError:$f,isCancel:Sf,CancelToken:kf,VERSION:Ef,all:Pf,Cancel:Tf,isAxiosError:Cf,spread:If,toFormData:Rf,AxiosHeaders:xf,HttpStatusCode:Af,formToJSON:Ff,getAdapter:Df,mergeConfig:Mf}=ye;class fp{static async getAvailableModels(){try{return(await ye({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const vp={class:"assigned-tools"},gp={class:"section-header"},bp=["title"],yp={class:"tool-info"},_p={class:"tool-name"},wp=["title"],$p={key:0,class:"no-tools"},Sp=_e({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=te(()=>a.availableTools.value);Fe(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=te(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(p=>l.value.some(c=>c.key===p)):[]);de(r,p=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;p.length!==c&&s("tools-filtered",p)},{immediate:!0});const m=p=>{const c=l.value.find(P=>P.key===p);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:p},f=p=>{const c=l.value.find(v=>v.key===p);return c?c.description:""};return(p,c)=>(h(),b("div",vp,[n("div",gp,[n("span",null,i(p.title)+" ("+i(r.value.length)+")",1),p.showAddButton?(h(),b("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=v=>p.$emit("add-tools"))},[A(u(D),{icon:"carbon:add"}),ie(" "+i(p.addButtonText),1)])):O("",!0)]),n("div",{class:ce(["tools-grid",{"grid-layout":p.useGridLayout,"has-more-items":p.useGridLayout&&r.value.length>2}])},[(h(!0),b(ue,null,me(r.value,v=>(h(),b("div",{key:v,class:"tool-item assigned",title:f(v)},[n("div",yp,[n("span",_p,i(m(v)),1),n("span",{class:"tool-desc",title:f(v)},i(f(v)),9,wp)])],8,bp))),128)),r.value.length===0?(h(),b("div",$p,[A(u(D),{icon:"carbon:tool-box"}),n("span",null,i(p.emptyText),1)])):O("",!0)],2)]))}}),kp=we(Sp,[["__scopeId","data-v-62354a05"]]),Ep={class:"tool-selection-content"},Pp={class:"tool-controls"},Tp={class:"search-container"},Cp=["placeholder"],Ip={class:"sort-container"},Rp={value:"group"},xp={value:"name"},Ap={value:"enabled"},Fp={class:"tool-summary"},Dp={class:"summary-text"},Mp={key:0,class:"tool-groups"},Np=["onClick"],Up={class:"group-title-area"},Lp={class:"group-name"},Op={class:"group-count"},Bp={class:"group-enable-all"},qp=["checked","onChange","data-group"],Vp={class:"enable-label"},jp={class:"tool-info"},Hp={class:"tool-selection-name"},zp={key:0,class:"tool-selection-desc"},Wp={class:"tool-actions"},Gp=["checked","onChange"],Kp={key:1,class:"empty-state"},Jp=_e({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=te(()=>a.availableTools.value);Fe(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),de(()=>e.modelValue,S=>{S&&!a.isLoading.value&&a.loadAvailableTools()});const r=te({get:()=>e.modelValue,set:S=>s("update:modelValue",S)}),m=F(""),f=F("group"),p=F(new Set),c=F([]),v=F(null),P=(S,_)=>{const $=document.querySelector(`input[data-group="${S}"]`);$&&($.indeterminate=w(_))};de(()=>e.selectedToolIds,S=>{c.value=[...S]},{immediate:!0});const x=te(()=>{let S=l.value.filter(_=>_.key);if(S=S.filter(_=>_.selectable===!0),m.value){const _=m.value.toLowerCase();S=S.filter($=>$.name.toLowerCase().includes(_)||$.description.toLowerCase().includes(_)||$.serviceGroup.toLowerCase().includes(_))}switch(f.value){case"name":S=[...S].sort((_,$)=>_.name.localeCompare($.name));break;case"enabled":S=[...S].sort((_,$)=>{const B=c.value.includes(_.key),W=c.value.includes($.key);return B&&!W?-1:!B&&W?1:_.name.localeCompare($.name)});break;case"group":default:S=[...S].sort((_,$)=>{const B=_.serviceGroup||"Ungrouped",W=$.serviceGroup||"Ungrouped";return B!==W?B.localeCompare(W):_.name.localeCompare($.name)});break}return S}),d=te(()=>{const S=new Map;return l.value.filter($=>$.key&&$.selectable===!0).forEach($=>{const B=$.serviceGroup||"Ungrouped";S.has(B)||S.set(B,[]),S.get(B).push($)}),S}),k=te(()=>{const S=new Map;return x.value.forEach(_=>{const $=_.serviceGroup||"Ungrouped";S.has($)||S.set($,[]),S.get($).push(_)}),new Map([...S.entries()].sort())}),y=te(()=>x.value.length);de([c,k],()=>{Re(()=>{for(const[S,_]of k.value)P(S,_)})},{flush:"post",deep:!1});const g=S=>c.value.includes(S),I=(S,_)=>{_.stopPropagation();const B=_.target.checked;if(!S){console.error("toolKey is undefined, cannot proceed");return}B?c.value.includes(S)||(c.value=[...c.value,S]):c.value=c.value.filter(W=>W!==S)},C=S=>S.filter(_=>c.value.includes(_.key)),M=S=>S.length>0&&S.every(_=>c.value.includes(_.key)),w=S=>{const _=C(S).length;return _>0&&_<S.length},N=(S,_)=>{_.stopPropagation();const B=_.target.checked,W=S.map(se=>se.key);if(B){const se=[...c.value];W.forEach(he=>{se.includes(he)||se.push(he)}),c.value=se}else c.value=c.value.filter(se=>!W.includes(se))},G=S=>{p.value.has(S)?p.value.delete(S):p.value.add(S)},R=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},H=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return de(m,S=>{const _=S.trim().toLowerCase();if(_){v.value===null&&(v.value=new Set(p.value));for(const[$,B]of d.value)B.some(se=>se.name.toLowerCase().includes(_)||se.description&&se.description.toLowerCase().includes(_)||se.serviceGroup&&se.serviceGroup.toLowerCase().includes(_))&&p.value.delete($)}else v.value!==null&&(p.value=new Set(v.value),v.value=null)}),de(r,S=>{if(S){p.value.clear(),v.value=null;const _=Array.from(k.value.keys());_.length>1&&_.slice(1).forEach($=>{p.value.add($)})}}),(S,_)=>(h(),ge(fs,{modelValue:r.value,"onUpdate:modelValue":[_[4]||(_[4]=$=>r.value=$),H],title:S.$t("toolSelection.title"),onConfirm:R},{default:Ge(()=>[n("div",Ep,[n("div",Pp,[n("div",Tp,[fe(n("input",{"onUpdate:modelValue":_[0]||(_[0]=$=>m.value=$),type:"text",class:"search-input",placeholder:S.$t("toolSelection.searchPlaceholder")},null,8,Cp),[[Se,m.value]])]),n("div",Ip,[fe(n("select",{"onUpdate:modelValue":_[1]||(_[1]=$=>f.value=$),class:"sort-select"},[n("option",Rp,i(S.$t("toolSelection.sortByGroup")),1),n("option",xp,i(S.$t("toolSelection.sortByName")),1),n("option",Ap,i(S.$t("toolSelection.sortByStatus")),1)],512),[[Ut,f.value]])])]),n("div",Fp,[n("span",Dp,i(S.$t("toolSelection.summary",{groups:k.value.size,tools:y.value,selected:c.value.length})),1)]),k.value.size>0?(h(),b("div",Mp,[(h(!0),b(ue,null,me(k.value,([$,B])=>(h(),b("div",{key:$,class:"tool-group"},[n("div",{class:ce(["tool-group-header",{collapsed:p.value.has($)}]),onClick:W=>G($)},[n("div",Up,[A(u(D),{icon:p.value.has($)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(u(D),{icon:"carbon:folder",class:"group-icon"}),n("span",Lp,i($),1),n("span",Op," ("+i(C(B).length)+"/"+i(B.length)+") ",1)]),n("div",{class:"group-actions",onClick:_[2]||(_[2]=ve(()=>{},["stop"]))},[n("label",Bp,[n("input",{type:"checkbox",class:"group-enable-checkbox",checked:M(B),onChange:W=>N(B,W),"data-group":$},null,40,qp),n("span",Vp,i(S.$t("toolSelection.enableAll")),1)])])],10,Np),n("div",{class:ce(["tool-group-content",{collapsed:p.value.has($)}])},[(h(!0),b(ue,null,me(B,W=>(h(),b("div",{key:W.key,class:"tool-selection-item"},[n("div",jp,[n("div",Hp,i(W.name),1),W.description?(h(),b("div",zp,i(W.description),1)):O("",!0)]),n("div",Wp,[n("label",{class:"tool-enable-switch",onClick:_[3]||(_[3]=ve(()=>{},["stop"]))},[n("input",{type:"checkbox",class:"tool-enable-checkbox",checked:g(W.key),onChange:se=>I(W.key,se)},null,40,Gp),_[5]||(_[5]=n("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),b("div",Kp,[A(u(D),{icon:"carbon:tools",class:"empty-icon"}),n("p",null,i(S.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Xp=we(Jp,[["__scopeId","data-v-627b463f"]]),Qp={class:"config-section"},Yp={class:"section-header"},Zp={class:"visual-editor"},em={class:"plan-basic-info"},tm={class:"form-row"},sm={class:"form-label"},om=["placeholder"],nm={key:0,class:"field-error-message"},am={class:"form-row"},lm={class:"form-label"},rm={class:"service-group-autocomplete"},im=["placeholder"],cm={key:0,class:"service-group-dropdown"},um=["onMousedown"],dm={class:"field-description"},pm={class:"steps-section"},mm={class:"steps-container"},hm={class:"step-content"},fm={class:"form-row"},vm={class:"form-label"},gm=["value","onInput","placeholder"],bm={class:"form-row"},ym={class:"form-label"},_m=["value","onInput","placeholder"],wm={key:0,class:"preview-section"},$m={class:"preview-label"},Sm={class:"preview-content"},km={class:"preview-text"},Em={class:"preview-table-header"},Pm={class:"form-row"},Tm={class:"form-label"},Cm={class:"model-selector-wrapper"},Im={class:"model-input-wrapper"},Rm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],xm={key:0,class:"dropdown-item disabled"},Am={key:1,class:"dropdown-item disabled error"},Fm={key:2,class:"dropdown-item disabled"},Dm=["onClick","onMouseenter"],Mm=["onClick","onMouseenter"],Nm=["title"],Um={key:0,class:"error-message"},Lm={class:"form-row"},Om={key:0,class:"empty-steps"},Bm={class:"empty-text"},qm={key:0,class:"json-preview"},Vm={class:"preview-header"},jm={class:"form-label"},Hm={class:"json-code"},zm={class:"editor-footer"},Wm={class:"section-actions"},Gm=["disabled","title"],Km=["disabled","title"],Jm=["disabled","title"],Xm=["disabled"],Qm={class:"modal-header"},Ym={class:"modal-body"},Zm={class:"form-row"},eh={class:"form-label"},th=["placeholder"],sh={class:"modal-footer"},oh=["disabled"],nh=_e({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=De(),s=vs(),a=Je(),l=nt({title:"",steps:[]}),r=F(!1),m=F(!1),f=F([]),p=F(!1),c=F(""),v=te(()=>a.generateJsonString()),P=()=>{const E=a.getConfig();l.title=E.title||"",l.steps=E.steps||[],c.value=E.serviceGroup||""};de(()=>l,()=>{a.setTitle(l.title),a.setSteps(l.steps)},{deep:!0});const x=()=>{r.value=!r.value},d=()=>{r.value=!1},k=()=>{try{a.rollbackVersion()}catch(E){console.error("Error during rollback operation:",E),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},y=()=>{try{a.restoreVersion()}catch(E){console.error("Error during restore operation:",E),s.error(e("sidebar.restoreFailed")||"Restore failed")}},g=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const E=a.validate();if(!E.isValid){s.error(`Invalid format, please correct and save.
Errors: `+E.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const ae=a.generateJsonString().trim();a.updateVersionsAfterSave(ae);const pe=a.planVersions.value.length;re.hasTaskRequirementModified=!1,await re.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:pe}))}catch(E){console.error("Failed to save plan modifications:",E);const z=E instanceof Error?E.message:e("sidebar.saveFailed");throw s.error(z),E}},I=F(""),C=()=>{const E={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(E),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},M=F([]),w=F(!1),N=F(""),G=F(new Map),R=F(new Set),H=F(new Map),S=E=>G.value.get(E)??"",_=(E,z)=>{G.value.set(E,z)},$=E=>{const z=S(E);if(!z.trim())return M.value;const K=z.toLowerCase().trim();return M.value.filter(ae=>ae.value.toLowerCase().includes(K)||ae.label.toLowerCase().includes(K))},B=E=>{const z=l.steps[E],K=S(E);return R.value.has(E)&&K!==""?K:z.modelName??""},W=E=>w.value||N.value||l.steps[E].modelName?"":e("sidebar.modelNameDescription")||"",se=E=>R.value.has(E),he=E=>{w.value||R.value.add(E)},Me=E=>{R.value.delete(E),H.value.set(E,-1);const z=l.steps[E];_(E,z.modelName??"")},Ee=E=>{se(E)?Me(E):he(E)},ke=(E,z)=>{const K=l.steps[z];K.modelName=E,_(z,E),Me(z)},qe=(E,z)=>{const K=E.target;_(z,K.value),he(z)},U=E=>H.value.get(E)??-1,L=(E,z)=>{H.value.set(E,z)},V=E=>{const z=U(E),K=$(E);z>=0&&z<K.length?ke(K[z].value,E):z===-1?ke("",E):K.length>0?ke(K[0].value,E):l.steps[E].modelName||ke("",E)},J=E=>{if(!se(E)){he(E),L(E,0);return}const K=$(E).length+1,ae=U(E),pe=Math.min(ae+1,K-1);L(E,pe)},Y=E=>{if(!se(E)){he(E);const ae=$(E);L(E,ae.length);return}const z=U(E),K=Math.max(z-1,-1);L(E,K)},ne=E=>{E.target.closest(".model-selector")||R.value.clear()};de(()=>l.steps,E=>{E.forEach((z,K)=>{G.value.has(K)||_(K,z.modelName??"")})},{deep:!0,immediate:!0});const Z=F(!1),Ce=F(-1),q=async()=>{if(!w.value){w.value=!0,N.value="";try{const E=await fp.getAvailableModels();M.value=E.options}catch(E){console.error("Failed to load models:",E),N.value=E instanceof Error?E.message:"Failed to load models",M.value=[]}finally{w.value=!1}}},X=E=>{Ce.value=E,Z.value=!0},ee=E=>{Ce.value>=0&&Ce.value<l.steps.length&&(l.steps[Ce.value].selectedToolKeys=[...E]),Z.value=!1,Ce.value=-1},$e=(E,z)=>{E>=0&&E<l.steps.length&&(l.steps[E].selectedToolKeys=[...z])},j=F(!1),Q=F(""),le=F(!1),be=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}Q.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),j.value=!0},Ne=()=>{j.value=!1,Q.value="",le.value=!1},et=async()=>{if(!Q.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}le.value=!0;try{const E=a.getConfig(),z=`planTemplate-${Date.now()}`,K={...E,title:Q.value.trim(),planTemplateId:z};(await ao.createOrUpdatePlanTemplateWithTool(K)).success?(s.success(e("sidebar.copyPlanSuccess",{title:Q.value.trim()})),await re.loadPlanTemplateList(),Ne()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(E){if(console.error("[JsonEditorV2] Error copying plan:",E),E instanceof Error&&E.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const z=E instanceof Error?E.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:z}))}}finally{le.value=!1}};de(()=>l.title,E=>{E?.trim()?I.value="":I.value="Title is required field"},{immediate:!0});const jt=()=>{const E=a.getServiceGroup()||"";c.value=E};de(()=>a.config,()=>{P()},{deep:!0,immediate:!0}),de(()=>a.currentPlanTemplateId.value,(E,z)=>{z!=null&&E!==z&&(G.value.clear(),R.value.clear(),H.value.clear(),Z.value=!1,j.value=!1,r.value=!1,Ce.value=-1,Q.value="",le.value=!1),P(),jt()},{immediate:!0}),de(()=>c.value,E=>{a.setServiceGroup(E)});const Gs=async()=>{if(!p.value){p.value=!0;try{const E=await ws.getAvailableTools(),z=new Set;E.forEach(K=>{K.serviceGroup&&z.add(K.serviceGroup)}),f.value=Array.from(z).sort()}catch(E){console.error("[JsonEditorV2] Failed to load service groups:",E),f.value=[]}finally{p.value=!1}}},Ht=te(()=>{const E=c.value.trim();if(!E)return f.value;const z=E.toLowerCase();return f.value.filter(K=>K.toLowerCase().includes(z))}),Ks=()=>{m.value=!0},Js=()=>{setTimeout(()=>{m.value=!1},200)},Xs=E=>{c.value=E,m.value=!1};Fe(()=>{P(),jt(),Gs(),q(),document.addEventListener("click",ne)}),Le(()=>{document.removeEventListener("click",ne)}),t({save:g});const zt=E=>{const z=E.target;z.style.height="auto";const K=20,ae=Math.ceil(z.scrollHeight/K),pe=4,tt=12,ut=Math.max(pe,Math.min(tt,ae)),Ys=ut*K;z.style.height=`${Ys}px`,z.rows=ut,ae>tt?z.style.overflowY="auto":z.style.overflowY="hidden"},Qs=E=>{if(!E.trim())return"";const z=E.split(",").map(K=>K.trim()).filter(K=>K.length>0);return z.length===0?"":`|${z.join("|")}|`};return(E,z)=>(h(),b("div",Qp,[n("div",Yp,[A(u(D),{icon:"carbon:code",width:"16"}),n("span",null,i(E.$t("sidebar.dynamicAgentPlan")),1)]),n("div",Zp,[n("div",em,[n("div",tm,[n("label",sm,i(E.$t("sidebar.title")),1),fe(n("input",{"onUpdate:modelValue":z[0]||(z[0]=K=>l.title=K),type:"text",class:ce(["form-input",{error:I.value}]),placeholder:E.$t("sidebar.titlePlaceholder")},null,10,om),[[Se,l.title]]),I.value?(h(),b("div",nm,[A(u(D),{icon:"carbon:warning",width:"12"}),ie(" "+i(I.value),1)])):O("",!0)]),n("div",am,[n("label",lm,i(E.$t("mcpService.serviceGroup")),1),n("div",rm,[fe(n("input",{type:"text","onUpdate:modelValue":z[1]||(z[1]=K=>c.value=K),onInput:Ks,onFocus:z[2]||(z[2]=K=>m.value=!0),onBlur:Js,placeholder:E.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,im),[[Se,c.value]]),m.value&&Ht.value.length>0?(h(),b("div",cm,[(h(!0),b(ue,null,me(Ht.value,K=>(h(),b("div",{key:K,class:"service-group-option",onMousedown:ae=>Xs(K)},i(K),41,um))),128))])):O("",!0)]),n("div",dm,i(E.$t("mcpService.serviceGroupDescription")),1)])]),n("div",pm,[n("div",mm,[(h(!0),b(ue,null,me(l.steps,(K,ae)=>(h(),b("div",{key:ae,class:"step-item"},[n("div",hm,[n("div",fm,[n("label",vm,i(E.$t("sidebar.stepRequirement")),1),n("textarea",{value:K.stepRequirement||"",onInput:pe=>{K.stepRequirement=pe.target.value,zt(pe)},class:"form-textarea auto-resize",placeholder:E.$t("sidebar.stepRequirementPlaceholder"),rows:"4"},null,40,gm)]),n("div",bm,[n("label",ym,i(E.$t("sidebar.terminateColumns")),1),n("textarea",{value:K.terminateColumns||"",onInput:pe=>{K.terminateColumns=pe.target.value,zt(pe)},class:"form-textarea auto-resize",placeholder:E.$t("sidebar.terminateColumnsPlaceholder"),rows:"4"},null,40,_m),K.terminateColumns&&K.terminateColumns.trim()?(h(),b("div",wm,[n("div",$m,i(E.$t("sidebar.preview"))+":",1),n("div",Sm,[n("div",km,[ie(i(E.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),n("span",Em,i(Qs(K.terminateColumns)),1)])])])):O("",!0)]),n("div",Pm,[n("label",Tm,i(E.$t("sidebar.modelName")),1),n("div",Cm,[n("div",{class:ce(["model-selector",{"is-open":se(ae),"is-disabled":w.value}])},[n("div",Im,[n("input",{value:B(ae),type:"text",class:"form-input model-search-input",placeholder:W(ae),disabled:w.value,onClick:ve(pe=>he(ae),["stop"]),onFocus:pe=>he(ae),onInput:pe=>qe(pe,ae),onKeydown:[st(pe=>Me(ae),["escape"]),st(ve(pe=>V(ae),["prevent"]),["enter"]),st(ve(pe=>J(ae),["prevent"]),["down"]),st(ve(pe=>Y(ae),["prevent"]),["up"])]},null,40,Rm),A(u(D),{icon:"carbon:chevron-down",width:"14",class:ce(["dropdown-arrow",{"is-open":se(ae)}]),onClick:ve(pe=>Ee(ae),["stop"])},null,8,["class","onClick"])]),se(ae)?(h(),b("div",{key:0,class:"model-dropdown",onClick:z[3]||(z[3]=ve(()=>{},["stop"]))},[w.value?(h(),b("div",xm,i(E.$t("sidebar.loading")),1)):N.value?(h(),b("div",Am,i(E.$t("sidebar.modelLoadError")),1)):$(ae).length===0?(h(),b("div",Fm,i(E.$t("sidebar.noModelsFound")),1)):O("",!0),(h(!0),b(ue,null,me($(ae),(pe,tt)=>(h(),b("div",{key:pe.value,class:ce(["dropdown-item",{"is-selected":K.modelName===pe.value,"is-highlighted":U(ae)===tt}]),onClick:ut=>ke(pe.value,ae),onMouseenter:ut=>L(ae,tt)},[ie(i(pe.value)+" ",1),K.modelName===pe.value?(h(),ge(u(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):O("",!0)],42,Dm))),128)),n("div",{class:ce(["dropdown-item",{"is-selected":!K.modelName,"is-highlighted":U(ae)===-1}]),onClick:pe=>ke("",ae),onMouseenter:pe=>L(ae,-1)},[ie(i(E.$t("sidebar.noModelSelected"))+" ",1),K.modelName?O("",!0):(h(),ge(u(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Mm)])):O("",!0)],2),N.value?(h(),b("button",{key:0,onClick:q,class:"btn btn-sm btn-danger",title:E.$t("sidebar.retryLoadModels")},[A(u(D),{icon:"carbon:warning",width:"14"}),ie(" "+i(E.$t("sidebar.retry")),1)],8,Nm)):O("",!0)]),N.value?(h(),b("div",Um,[A(u(D),{icon:"carbon:warning",width:"12"}),ie(" "+i(N.value),1)])):O("",!0)]),n("div",Lm,[A(kp,{title:E.$t("sidebar.selectedTools"),"selected-tool-ids":K.selectedToolKeys||[],"add-button-text":E.$t("sidebar.addRemoveTools"),"empty-text":E.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:pe=>X(ae),onToolsFiltered:pe=>$e(ae,pe)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),b("div",Om,[A(u(D),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),n("p",Bm,i(E.$t("sidebar.noSteps")),1),n("button",{class:"btn btn-primary btn-add-step",onClick:C},[A(u(D),{icon:"carbon:add",width:"16"}),ie(" "+i(E.$t("sidebar.addFirstStep")),1)])])):O("",!0)])]),r.value?(h(),b("div",qm,[n("div",Vm,[n("label",jm,i(E.$t("sidebar.jsonPreview")),1),n("button",{onClick:d,class:"btn btn-xs"},[A(u(D),{icon:"carbon:close",width:"12"})])]),n("pre",Hm,i(v.value),1)])):O("",!0),n("div",zm,[n("button",{onClick:x,class:"btn btn-sm btn-secondary"},[A(u(D),{icon:"carbon:code",width:"14"}),ie(" "+i(r.value?E.$t("sidebar.hideJson"):E.$t("sidebar.showJson")),1)]),n("div",Wm,[n("button",{class:"btn btn-sm",onClick:be,disabled:E.isGenerating||E.isExecuting,title:E.$t("sidebar.copyPlan")},[A(u(D),{icon:"carbon:copy",width:"14"}),ie(" "+i(E.$t("sidebar.copyPlan")),1)],8,Gm),n("button",{class:"btn btn-sm",onClick:k,disabled:!u(a).canRollback.value,title:E.$t("sidebar.rollback")},[A(u(D),{icon:"carbon:undo",width:"14"})],8,Km),n("button",{class:"btn btn-sm",onClick:y,disabled:!u(a).canRestore.value,title:E.$t("sidebar.restore")},[A(u(D),{icon:"carbon:redo",width:"14"})],8,Jm),n("button",{class:"btn btn-primary",onClick:g,disabled:E.isGenerating||E.isExecuting},[A(u(D),{icon:"carbon:save",width:"14"}),z[7]||(z[7]=ie(" Save "))],8,Xm)])])]),A(Xp,{modelValue:Z.value,"onUpdate:modelValue":z[4]||(z[4]=K=>Z.value=K),"selected-tool-ids":Ce.value>=0?l.steps[Ce.value]?.selectedToolKeys||[]:[],onConfirm:ee},null,8,["modelValue","selected-tool-ids"]),j.value?(h(),b("div",{key:0,class:"modal-overlay",onClick:Ne},[n("div",{class:"modal-content",onClick:z[6]||(z[6]=ve(()=>{},["stop"]))},[n("div",Qm,[n("h3",null,i(E.$t("sidebar.copyPlan")),1),n("button",{class:"close-btn",onClick:Ne},[A(u(D),{icon:"carbon:close",width:"16"})])]),n("div",Ym,[n("div",Zm,[n("label",eh,i(E.$t("sidebar.newPlanTitle")),1),fe(n("input",{"onUpdate:modelValue":z[5]||(z[5]=K=>Q.value=K),type:"text",class:"form-input",placeholder:E.$t("sidebar.enterNewPlanTitle"),onKeyup:st(et,["enter"])},null,40,th),[[Se,Q.value]])])]),n("div",sh,[n("button",{class:"btn btn-secondary",onClick:Ne},i(E.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:et,disabled:!Q.value.trim()||le.value},[le.value?(h(),ge(u(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):O("",!0),ie(" "+i(le.value?E.$t("sidebar.copying"):E.$t("sidebar.copyPlan")),1)],8,oh)])])])):O("",!0)]))}}),ah=we(nh,[["__scopeId","data-v-4e89cf4e"]]),lh={class:"template-list-container"},rh={class:"organization-section"},ih={class:"organization-row"},ch={class:"organization-selector"},uh={class:"organization-label"},dh=["value"],ph={value:"by_time"},mh={value:"by_abc"},hh={value:"by_group_time"},fh={value:"by_group_abc"},vh={class:"search-input-wrapper"},gh={class:"search-label"},bh={class:"search-input-container"},yh=["placeholder"],_h=["title"],wh={class:"sidebar-content-list"},$h={key:0,class:"loading-state"},Sh={key:1,class:"error-state"},kh={key:2,class:"empty-state"},Eh=["onClick","title"],Ph=["onClick","title"],Th={class:"group-name"},Ch={class:"group-count"},Ih=["onClick"],Rh={class:"task-icon"},xh={class:"task-details"},Ah={class:"task-title"},Fh={class:"task-time"},Dh={class:"task-actions"},Mh=["title","onClick"],Nh=_e({__name:"TemplateList",emits:["templateSelected","templateCreated"],setup(o,{emit:t}){const{t:e}=De(),s=Je(),a=at(),l=F(""),r=t,m=d=>{const k=d.target;re.setOrganizationMethod(k.value)},f=async()=>{const d=s.getPlanType()||"dynamic_agent";await re.createNewTemplate(d);const k=s.selectedTemplate.value;k&&(s.reset(),s.setPlanType(k.planType||"dynamic_agent"),k.planTemplateId&&s.setPlanTemplateId(k.planTemplateId),s.setTitle(k.title||"")),Ie.switchToTab("config"),console.log("[TemplateList] ðŸ”„ Reloading available tools for new template"),await a.loadAvailableTools(),r("templateCreated")},p=d=>{if(isNaN(d.getTime()))return console.warn("Invalid date received:",d),e("time.unknown");const y=new Date().getTime()-d.getTime(),g=Math.floor(y/6e4),I=Math.floor(y/36e5),C=Math.floor(y/864e5);return g<1?e("time.now"):g<60?e("time.minuteAgo",{count:g}):I<24?e("time.hourAgo",{count:I}):C<30?e("time.dayAgo",{count:C}):d.toLocaleDateString("zh-CN")},c=te(()=>{s.planTemplateList.value;const d=l.value.trim().toLowerCase(),k=re.groupedTemplates;if(!d)return k;const y=new Map;for(const[g,I]of k){const C=[];for(const M of I)(M.title||"").toLowerCase().includes(d)&&C.push(M);C.length>0&&y.set(g,C)}return y});de(l,d=>{s.planTemplateList.value;const k=d.trim().toLowerCase();if(!k||re.organizationMethod!=="by_group_time"&&re.organizationMethod!=="by_group_abc")return;const y=re.groupedTemplates;for(const[g,I]of y){let C=!1;for(const M of I)if((M.title||"").toLowerCase().includes(k)){C=!0;break}C&&re.isGroupCollapsed(g)&&re.toggleGroupCollapse(g)}});const v=d=>{const k=d??"null";return re.groupCollapseState[k]??!1},P=d=>{re.toggleGroupCollapse(d)},x=async d=>{await re.selectTemplate(d),d.planTemplateId?(await s.load(d.planTemplateId),re.hasTaskRequirementModified=!1):(s.reset(),re.hasTaskRequirementModified=!1),Ie.switchToTab("config"),r("templateSelected",d)};return(d,k)=>(h(),b("div",lh,[n("div",rh,[n("button",{class:"new-task-btn",onClick:f},[A(u(D),{icon:"carbon:add",width:"16"}),ie(" "+i(d.$t("sidebar.newPlan")),1)]),n("div",ih,[n("div",ch,[n("label",uh,i(d.$t("sidebar.organizationLabel")),1),n("select",{value:u(re).organizationMethod,onChange:m,class:"organization-select"},[n("option",ph,i(d.$t("sidebar.organizationByTime")),1),n("option",mh,i(d.$t("sidebar.organizationByAbc")),1),n("option",hh,i(d.$t("sidebar.organizationByGroupTime")),1),n("option",fh,i(d.$t("sidebar.organizationByGroupAbc")),1)],40,dh)]),n("div",vh,[n("label",gh,i(d.$t("sidebar.searchLabel")),1),n("div",bh,[A(u(D),{icon:"carbon:search",width:"16",class:"search-icon"}),fe(n("input",{"onUpdate:modelValue":k[0]||(k[0]=y=>l.value=y),type:"text",class:"search-input",placeholder:d.$t("sidebar.searchPlaceholder")||"Search..."},null,8,yh),[[Se,l.value]]),l.value?(h(),b("button",{key:0,class:"search-clear-btn",onClick:k[1]||(k[1]=y=>l.value=""),title:d.$t("sidebar.clearSearch")||"Clear search"},[A(u(D),{icon:"carbon:close",width:"14"})],8,_h)):O("",!0)])])])]),n("div",wh,[u(re).isLoading?(h(),b("div",$h,[A(u(D),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),n("span",null,i(d.$t("sidebar.loading")),1)])):u(re).errorMessage?(h(),b("div",Sh,[A(u(D),{icon:"carbon:warning",width:"20"}),n("span",null,i(u(re).errorMessage),1),n("button",{onClick:k[2]||(k[2]=(...y)=>u(re).loadPlanTemplateList&&u(re).loadPlanTemplateList(...y)),class:"retry-btn"},i(d.$t("sidebar.retry")),1)])):u(s).planTemplateList.value.length===0?(h(),b("div",kh,[A(u(D),{icon:"carbon:document",width:"32"}),n("span",null,i(d.$t("sidebar.noTemplates")),1)])):(h(!0),b(ue,{key:3},me(c.value,([y,g])=>(h(),b(ue,{key:y||"ungrouped"},[(u(re).organizationMethod==="by_group_time"||u(re).organizationMethod==="by_group_abc")&&g.length>0?(h(),b("div",{key:0,class:"group-header",onClick:ve(I=>P(y),["prevent"]),title:v(y)?d.$t("sidebar.expandGroup"):d.$t("sidebar.collapseGroup")},[n("button",{type:"button",class:"group-toggle-btn",onClick:ve(I=>P(y),["stop","prevent"]),title:v(y)?d.$t("sidebar.expandGroup"):d.$t("sidebar.collapseGroup")},[A(u(D),{icon:v(y)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Ph),A(u(D),{icon:"carbon:folder",width:"16"}),n("span",Th,i(y===null||y===""?d.$t("sidebar.ungroupedMethods"):y),1),n("span",Ch,"("+i(g.length)+")",1)],8,Eh)):O("",!0),(u(re).organizationMethod==="by_group_time"||u(re).organizationMethod==="by_group_abc")&&v(y)?O("",!0):(h(!0),b(ue,{key:1},me(g,I=>(h(),b("div",{key:I.planTemplateId||"unknown",class:ce(["sidebar-content-list-item",{"sidebar-content-list-item-active":I.planTemplateId===u(s).currentPlanTemplateId.value,"grouped-item":u(re).organizationMethod==="by_group_time"||u(re).organizationMethod==="by_group_abc"}]),onClick:C=>x(I)},[n("div",Rh,[A(u(D),{icon:"carbon:document",width:"20"})]),n("div",xh,[n("div",Ah,i(I.title||d.$t("sidebar.unnamedPlan")),1)]),n("div",Fh,i(p(u(s).parseDateTime(I.updateTime||I.createTime))),1),n("div",Dh,[n("button",{class:"delete-task-btn",title:d.$t("sidebar.deleteTemplate"),onClick:ve(C=>u(re).deleteTemplate(I),["stop"])},[A(u(D),{icon:"carbon:close",width:"16"})],8,Mh)])],10,Ih))),128))],64))),128))])]))}}),Uh=we(Nh,[["__scopeId","data-v-c5867107"]]),Lh={class:"sidebar-content"},Oh={class:"sidebar-content-header"},Bh={class:"sidebar-content-title"},qh={class:"tab-switcher"},Vh=["disabled"],jh={key:0,class:"tab-content"},Hh={key:1,class:"tab-content config-tab"},zh={key:0,class:"config-container"},Wh={class:"template-info-header"},Gh={class:"template-info"},Kh={class:"template-id"},Jh=["title"],Xh=_e({name:"SidebarPanel",__name:"Sidebar",setup(o,{expose:t}){const e=at(),s=Je(),a=F(80),l=F(!1),r=F(0),m=F(0),f=P=>{l.value=!0,r.value=P.clientX,m.value=a.value,document.addEventListener("mousemove",p),document.addEventListener("mouseup",c),document.body.style.cursor="col-resize",document.body.style.userSelect="none",P.preventDefault()},p=P=>{if(!l.value)return;const x=window.innerWidth,k=(P.clientX-r.value)/x*100;let y=m.value+k;y=Math.max(15,Math.min(100,y)),a.value=y},c=()=>{l.value=!1,document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",a.value.toString())},v=()=>{a.value=80,localStorage.setItem("sidebarWidth","80")};return Fe(async()=>{await re.loadPlanTemplateList(),e.loadAvailableTools();const P=localStorage.getItem("sidebarWidth");P&&(a.value=parseFloat(P))}),Le(()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",c)}),t({loadPlanTemplateList:re.loadPlanTemplateList,toggleSidebar:Ie.toggleSidebar,currentPlanTemplateId:s.currentPlanTemplateId}),(P,x)=>(h(),b("div",{class:ce(["sidebar-wrapper",{"sidebar-wrapper-collapsed":u(Ie).isCollapsed}]),style:We({width:a.value+"%"})},[n("div",Lh,[n("div",Oh,[n("div",Bh,i(P.$t("sidebar.title")),1)]),n("div",qh,[n("button",{class:ce(["tab-button",{active:u(Ie).currentTab==="list"}]),onClick:x[0]||(x[0]=d=>u(Ie).switchToTab("list"))},[A(u(D),{icon:"carbon:list",width:"16"}),ie(" "+i(P.$t("sidebar.templateList")),1)],2),n("button",{class:ce(["tab-button",{active:u(Ie).currentTab==="config"}]),onClick:x[1]||(x[1]=d=>u(Ie).switchToTab("config")),disabled:!u(s).selectedTemplate.value},[A(u(D),{icon:"carbon:settings",width:"16"}),ie(" "+i(P.$t("sidebar.configuration")),1)],10,Vh)]),u(Ie).currentTab==="list"?(h(),b("div",jh,[A(Uh)])):u(Ie).currentTab==="config"?(h(),b("div",Hh,[u(s).selectedTemplate.value?(h(),b("div",zh,[n("div",Wh,[n("div",Gh,[n("h3",null,i(u(s).selectedTemplate.value.title||P.$t("sidebar.unnamedPlan")),1),n("span",Kh,"ID: "+i(u(s).selectedTemplate.value.planTemplateId),1)]),n("button",{class:"back-to-list-btn",onClick:x[2]||(x[2]=d=>u(Ie).switchToTab("list"))},[A(u(D),{icon:"carbon:arrow-left",width:"16"})])]),A(ah),A(Ou)])):O("",!0)])):O("",!0)]),n("div",{class:"sidebar-resizer",onMousedown:f,onDblclick:v,title:P.$t("sidebar.resizeHint")},x[3]||(x[3]=[n("div",{class:"resizer-line"},null,-1)]),40,Jh)],6))}}),Qh=we(Xh,[["__scopeId","data-v-1c6f7337"]]);function Yh(){const o=Qe(),t=Xe(),{showToast:e}=gs(),{t:s}=De(),a=f=>{const p={currentPlanId:f.currentPlanId,status:f.completed?"completed":"running"};return f.rootPlanId&&(p.rootPlanId=f.rootPlanId),f.summary&&(p.summary=f.summary),f.completed!==void 0&&(p.completed=f.completed),f.agentExecutionSequence&&(p.agentExecutionSequence=f.agentExecutionSequence),p},l=f=>{if(f&&(f.userRequest&&f.startTime&&o.addMessage("user",f.userRequest,{timestamp:new Date(f.startTime)}),f.currentPlanId)){const p=f.summary||f.result||f.message||"Execution completed",c=a(f);o.addMessage("assistant",p,{timestamp:f.endTime&&f.endTime?new Date(f.endTime):f.startTime?new Date(f.startTime):new Date,planExecution:c}),f.rootPlanId&&t.setCachedPlanRecord(f.rootPlanId,c)}},r=async(f,p=!1,c=!0)=>{if(!f){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{p&&o.clearMessages(),Pe.setConversationId(f);const v=await pt.getConversationHistory(f);console.log("[useConversationHistory] Loaded conversation history:",v);for(const P of v)l(P);console.log("[useConversationHistory] Successfully loaded conversation history with",v.length,"dialog rounds")}catch(v){throw console.error("[useConversationHistory] Failed to load conversation history:",v),c&&e(s("memory.loadHistoryFailed"),"error"),v}};return{loadConversationHistory:r,restoreConversationHistory:async f=>r(f,!1,!1),processHistoryRecord:l}}let Rt=null;function Zh(){return Rt||(Rt=Yh()),Rt}const ef={class:"direct-page"},tf={class:"direct-chat"},sf={class:"chat-header"},of={class:"header-actions"},nf=["title"],af=["title"],lf=["title"],rf={class:"chat-content"},cf=["title"],uf={class:"message-content"},df=_e({name:"DirectIndex",__name:"index",setup(o){const t=so(),e=oo(),s=vt(),{toast:a}=gs(),l=Qe(),r=Xe(),m=Zh(),f=F(""),p=F(),c=F(),v=F(null),P=F(50),x=F(!1),d=F(0),k=F(0),y=te(()=>{if(Ie.isCollapsed)return P.value;let _=26;c.value&&c.value.sidebarWidth!==void 0&&(_=c.value.sidebarWidth);const $=100-_;return Math.max(20,Math.min($,P.value))});Fe(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),de(()=>r.planExecutionRecords,B=>{for(const[W,se]of B.entries())w(W)&&(p.value&&typeof p.value.updateDisplayedPlanProgress=="function"&&p.value.updateDisplayedPlanProgress(W),se.completed&&(console.log("[Direct] Plan completed, clearing currentRootPlanId"),v.value=null))},{deep:!0}),de(()=>r.trackedPlanIds,B=>{if(!v.value&&B.value.size>0){const W=Array.from(B.value)[0];v.value=W,console.log("[Direct] Set currentRootPlanId to:",W)}},{deep:!0});const _=Pe.getConversationId();if(_&&(console.log("[Direct] Found saved conversationId, restoring conversation:",_),Re(async()=>{try{await m.restoreConversationHistory(_)}catch(B){console.error("[DirectView] Failed to restore conversation history:",B)}})),re.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const B=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",B),B.trim()?(s.markTaskAsProcessed(),Re(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",B),await l.sendMessage({input:B})}catch(W){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",W),f.value=B}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(f.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",f.value),console.log("[Direct] No unprocessed task in store"));const $=localStorage.getItem("directPanelWidth");$&&(P.value=parseFloat($)),console.log("[Direct] Final prompt value:",f.value)}),de(()=>s.currentTask,_=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",_),_&&!_.processed&&_.prompt.trim()){const $=_.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",$),Re(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",$),await l.sendMessage({input:$})}catch(B){console.warn("[Direct] messageDialog.sendMessage failed for new task:",B)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),de(()=>f.value,(_,$)=>{console.log("[Direct] prompt value changed from:",$,"to:",_)},{immediate:!1}),Le(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),v.value=null,r.cleanup(),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",C)});const g=_=>{x.value=!0,d.value=_.clientX,k.value=P.value,document.addEventListener("mousemove",I),document.addEventListener("mouseup",C),document.body.style.cursor="col-resize",document.body.style.userSelect="none",_.preventDefault()},I=_=>{if(!x.value)return;const $=window.innerWidth,W=(_.clientX-d.value)/$*100;let se=k.value+W;se=Math.max(20,Math.min(80,se)),P.value=se},C=()=>{x.value=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",C),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",P.value.toString())},M=()=>{P.value=50,localStorage.setItem("directPanelWidth","50")},w=(_,$=!1)=>!v.value||_===v.value||$&&(_==="ui-state"||_==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",_,"current:",v.value),!1),N=_=>{console.log("[DirectView] Step selected:",_),p.value&&typeof p.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",_),p.value.handleStepSelected(_)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},G=()=>{e.push("/home")},R=()=>{e.push("/configs")},H=async()=>{if(Pe.selectMemoryId){console.log("[DirectView] Memory selected:",Pe.selectMemoryId);try{await m.loadConversationHistory(Pe.selectMemoryId,!0,!0)}catch(_){console.error("[DirectView] Failed to load conversation history:",_)}}},S=()=>{Pe.clearMemoryId(),Pe.clearConversationId(),l.reset()};return(_,$)=>(h(),b("div",ef,[n("div",tf,[A(Qh,{ref_key:"sidebarRef",ref:c},null,512),n("div",{class:"left-panel",style:We({width:y.value+"%"})},[n("div",sf,[n("button",{class:"back-button",onClick:G},[A(u(D),{icon:"carbon:arrow-left"})]),n("h2",null,i(_.$t("conversation")),1),n("div",of,[A(lo),n("button",{class:"config-button",onClick:S,title:_.$t("memory.newChat")},[A(u(D),{icon:"carbon:add",width:"20"})],8,nf),n("button",{class:"config-button",onClick:R,title:_.$t("direct.configuration")},[A(u(D),{icon:"carbon:settings-adjust",width:"20"})],8,af),n("button",{class:"cron-task-btn",onClick:$[0]||($[0]=B=>u(Pe).toggleSidebar()),title:_.$t("memory.selectMemory")},[A(u(D),{icon:"carbon:calendar",width:"20"})],8,lf)])]),n("div",rf,[A(za,{onStepSelected:N})]),(h(),ge(hl,{key:_.$i18n.locale,"initial-value":f.value},null,8,["initial-value"]))],4),n("div",{class:"panel-resizer",onMousedown:g,onDblclick:M,title:_.$t("direct.panelResizeHint")},$[1]||($[1]=[n("div",{class:"resizer-line"},null,-1)]),40,cf),A(ic,{ref_key:"rightPanelRef",ref:p,style:We({width:100-P.value+"%"}),"current-root-plan-id":v.value},null,8,["style","current-root-plan-id"])]),A(nr,{onMemorySelected:H}),u(a).show?(h(),b("div",{key:0,class:ce(["message-toast",u(a).type])},[n("div",uf,[n("span",null,i(u(a).text),1)])],2)):O("",!0)]))}}),Nf=we(df,[["__scopeId","data-v-e66fee1e"]]);export{Nf as default};
//# sourceMappingURL=index-DSVsj4qi.js.map
