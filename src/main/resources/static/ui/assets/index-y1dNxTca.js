import{d as $e,u as De,a as y,b as h,n as ue,e as n,f as V,g as A,i as p,h as ce,t as d,y as Je,F as de,q as he,j as ge,l as ye,A as vs,c as se,B as Ve,r as x,o as Me,C as fe,D as Ue,w as ve,m as Te,E as Bt,G as Ft,v as co,H as gs,I as Ne,J as ys,z as Ie,T as qt,p as Xe,K as uo,M as po,N as ot,O as mo,x as ho}from"./index-C5PP8rL-.js";import{I as F,_ as Se}from"./_plugin-vue_export-helper-yejE8nR1.js";import{u as bt,m as Pe,P as fo,D as Xt,a as Qe,s as Re,t as ae,b as vo}from"./templateStore-DTztFgRU.js";import{L as go}from"./LanguageSwitcher-BVNfbYj9.js";import{M as bs,u as _s,a as ws}from"./useToast-CgzwrqBR.js";import"./llm-check-CJy4TeZw.js";const yo={class:"sub-plan-info"},bo={class:"sub-plan-details"},_o={class:"sub-plan-title"},wo={key:0,class:"nesting-level"},$o={class:"sub-plan-id"},So={class:"sub-plan-meta"},To={key:0,class:"trigger-tool"},Po={class:"trigger-text"},Eo={key:0,class:"sub-plan-progress"},ko={class:"progress-info"},Co={class:"progress-text"},Ro={class:"progress-bar"},Io={key:1,class:"sub-plan-agents-steps"},Ao={class:"agents-steps-header"},xo={class:"agents-label"},Mo={class:"agents-steps-list"},Fo=["onClick"],Do={class:"agent-step-header"},No=["title"],Uo={class:"sub-agent-execution-info"},Lo={key:0,class:"agent-result"},Oo={class:"result-header"},Bo={class:"result-label"},qo={class:"result-content"},Ho={key:1,class:"agent-error"},Vo={class:"error-header"},jo={class:"error-label"},zo={class:"error-content"},Wo={key:2,class:"think-act-preview"},Go={class:"think-act-header"},Ko={class:"think-act-label"},Jo={class:"think-act-steps-preview"},Xo=["onClick"],Yo={class:"step-number"},Qo={class:"step-description"},Zo={key:0,class:"more-steps"},en={class:"more-steps-text"},tn={key:3,class:"nested-sub-plans"},sn={class:"nested-sub-plans-header"},on={class:"nested-label"},nn={class:"nested-sub-plans-list"},an={key:4,class:"direct-sub-plans"},ln={class:"direct-sub-plans-header"},rn={class:"direct-label"},cn={class:"direct-sub-plans-list"},un=$e({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=o,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,i=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(U=>U.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(U=>U.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},b=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},r=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const P=c();return Math.min(100,P/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0,f=P=>{switch(P){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},E=P=>{switch(P){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},k=P=>{switch(P){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},u=P=>P.thinkActSteps?.some(I=>I.subPlanExecutionRecord)??!1,_=P=>P.thinkActSteps?.filter(I=>I.subPlanExecutionRecord)??[],g=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},v=(P,I)=>{const U=I.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",U)},R=(P,I,U)=>{const M=U.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",M)},B=(P,I,U)=>{s("sub-plan-selected",P,I,U)},G=P=>{s("step-selected",P)};return(P,I)=>{const U=vs("RecursiveSubPlan",!0);return h(),y("div",{class:ue(["recursive-sub-plan",l()])},[n("div",{class:"sub-plan-header",onClick:g},[n("div",yo,[A(p(F),{icon:b(),class:"sub-plan-status-icon"},null,8,["icon"]),n("div",bo,[n("div",_o,[ce(d(P.subPlan.title||P.$t("chat.subPlan"))+" #"+d(P.subPlanIndex+1)+" ",1),(P.nestingLevel??0)>0?(h(),y("span",wo,"(L"+d((P.nestingLevel??0)+1)+")",1)):V("",!0)]),n("div",$o,d(P.subPlan.currentPlanId),1)])]),n("div",So,[n("div",{class:ue(["sub-plan-status-badge",i()])},d(m()),3),P.subPlan.parentActToolCall?(h(),y("div",To,[A(p(F),{icon:"carbon:function",class:"trigger-icon"}),n("span",Po,d(P.subPlan.parentActToolCall.name),1)])):V("",!0)])]),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Eo,[n("div",ko,[n("span",Co,d(P.$t("chat.progress"))+": "+d(c())+" / "+d(P.subPlan.agentExecutionSequence.length),1),n("div",Ro,[n("div",{class:"progress-fill",style:Je({width:r()+"%"})},null,4)])])])):V("",!0),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Io,[n("div",Ao,[n("span",xo,d(P.$t("chat.agentExecutions"))+":",1)]),n("div",Mo,[(h(!0),y(de,null,he(P.subPlan.agentExecutionSequence,(M,H)=>(h(),y("div",{key:M.id||H,class:ue(["agent-step-item",f(M.status)]),onClick:$=>v(H,M)},[n("div",Do,[A(p(F),{icon:E(M.status),class:"agent-icon"},null,8,["icon"]),n("span",{class:"agent-name",title:M.agentName==="ConfigurableDynaAgent"?P.$t("chat.clickToViewExecutionDetails"):""},d(M.agentName==="ConfigurableDynaAgent"?P.$t("chat.funcAgentExecutionDetails"):M.agentName||P.$t("chat.unknownAgent")),9,No),n("div",{class:ue(["agent-status-badge",f(M.status)])},d(k(M.status)),3)]),n("div",Uo,[M.result?(h(),y("div",Lo,[n("div",Oo,[A(p(F),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Bo,d(P.$t("chat.agentResult"))+":",1)]),n("pre",qo,d(M.result),1)])):V("",!0),M.errorMessage?(h(),y("div",Ho,[n("div",Vo,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",jo,d(P.$t("chat.errorMessage"))+":",1)]),n("pre",zo,d(M.errorMessage),1)])):V("",!0),M.thinkActSteps?.length?(h(),y("div",Wo,[n("div",Go,[A(p(F),{icon:"carbon:thinking",class:"think-act-icon"}),n("span",Ko,d(P.$t("chat.thinkActSteps"))+" ("+d(M.thinkActSteps.length)+")",1)]),n("div",Jo,[(h(!0),y(de,null,he(M.thinkActSteps.slice(0,P.maxVisibleSteps??2),($,T)=>(h(),y("div",{key:$.id||T,class:"think-act-step-preview",onClick:ge(w=>R(H,T,M),["stop"])},[n("span",Yo,"#"+d(T+1),1),n("span",Qo,d($.actionDescription||P.$t("chat.thinking")),1),A(p(F),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Xo))),128)),M.thinkActSteps.length>(P.maxVisibleSteps??2)?(h(),y("div",Zo,[n("span",en,d(P.$t("chat.andMoreSteps",{count:M.thinkActSteps.length-(P.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),u(M)?(h(),y("div",tn,[n("div",sn,[A(p(F),{icon:"carbon:tree-view-alt",class:"nested-icon"}),n("span",on,d(P.$t("chat.nestedSubPlans")),1)]),n("div",nn,[(h(!0),y(de,null,he(_(M),($,T)=>(h(),ye(U,{key:$.id||T,"sub-plan":$.subPlanExecutionRecord,"sub-plan-index":T,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:B,onStepSelected:G},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),M.subPlanExecutionRecords?.length?(h(),y("div",an,[n("div",ln,[A(p(F),{icon:"carbon:tree-view",class:"direct-icon"}),n("span",rn,d(P.$t("chat.directSubPlans")),1)]),n("div",cn,[(h(!0),y(de,null,he(M.subPlanExecutionRecords,($,T)=>(h(),ye(U,{key:$.currentPlanId||T,"sub-plan":$,"sub-plan-index":T,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:B,onStepSelected:G},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,Fo))),128))])])):V("",!0)],2)}}}),dn=Se(un,[["__scopeId","data-v-36486b62"]]),pn={class:"execution-details"},mn={key:0,class:"plan-overview"},hn={key:0,class:"parent-tool-call"},fn={class:"parent-tool-header"},vn={class:"tool-label"},gn={class:"tool-name"},yn={key:0,class:"tool-parameters"},bn={class:"param-label"},_n={class:"param-content"},wn={key:1,class:"agent-execution-container"},$n={class:"section-title"},Sn=["onClick"],Tn={class:"agent-info"},Pn={class:"agent-details"},En=["title"],kn={class:"request-content"},Cn={class:"agent-controls"},Rn={class:"agent-execution-info"},In={key:0,class:"agent-result"},An={class:"result-header"},xn={class:"result-label"},Mn={class:"result-content"},Fn={key:1,class:"agent-error"},Dn={class:"error-header"},Nn={class:"error-label"},Un={class:"error-content"},Ln={key:0,class:"sub-plans-container"},On={class:"sub-plans-header"},Bn={class:"sub-plans-title"},qn={class:"sub-plans-list"},Hn=$e({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=t,{t:s}=De(),a=f=>{f.stepId?e("step-selected",f.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",f)},l=f=>{switch(f){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},i=f=>{switch(f){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},m=f=>{switch(f){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},b=(f,E,k)=>{e("sub-plan-selected",f,E,k)},r=f=>{e("step-selected",f)},c=f=>{if(!f)return"";try{const E=JSON.parse(f);return JSON.stringify(E,null,2)}catch{return f}};return(f,E)=>(h(),y("div",pn,[f.planExecution?(h(),y("div",mn,[f.planExecution.parentActToolCall?(h(),y("div",hn,[n("div",fn,[A(p(F),{icon:"carbon:flow",class:"tool-icon"}),n("span",vn,d(f.$t("chat.triggeredByTool"))+":",1),n("span",gn,d(f.planExecution.parentActToolCall.name),1)]),f.planExecution.parentActToolCall.parameters?(h(),y("div",yn,[n("span",bn,d(f.$t("common.parameters"))+":",1),n("pre",_n,d(c(f.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(f.planExecution?.agentExecutionSequence?.length??0)>0?(h(),y("div",wn,[n("h4",$n,d(f.$t("chat.agentExecutionSequence")),1),(h(!0),y(de,null,he(f.planExecution?.agentExecutionSequence,(k,u)=>(h(),y("div",{key:k.id||u,class:ue(["agent-execution-item",l(k.status)])},[n("div",{class:"agent-header",onClick:_=>a(k)},[n("div",Tn,[A(p(F),{icon:m(k.status),class:"agent-status-icon"},null,8,["icon"]),n("div",Pn,[n("div",{class:"agent-name",title:k.agentName==="ConfigurableDynaAgent"?f.$t("chat.clickToViewExecutionDetails"):""},d(k.agentName==="ConfigurableDynaAgent"?f.$t("chat.funcAgentExecutionDetails"):k.agentName||f.$t("chat.unknownAgent")),9,En),n("pre",kn,d(k.agentRequest),1)])]),n("div",Cn,[n("div",{class:ue(["agent-status-badge",l(k.status)])},d(i(k.status)),3),A(p(F),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Sn),n("div",Rn,[k.result?(h(),y("div",In,[n("div",An,[A(p(F),{icon:"carbon:checkmark",class:"result-icon"}),n("span",xn,d(f.$t("chat.agentResult"))+":",1)]),n("pre",Mn,d(k.result),1)])):V("",!0),k.errorMessage?(h(),y("div",Fn,[n("div",Dn,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",Nn,d(f.$t("chat.errorMessage"))+":",1)]),n("pre",Un,d(k.errorMessage),1)])):V("",!0)]),k.subPlanExecutionRecords?.length?(h(),y("div",Ln,[n("div",On,[A(p(F),{icon:"carbon:tree-view",class:"sub-plans-icon"}),n("span",Bn,d(f.$t("chat.subPlanExecutions"))+" ("+d(k.subPlanExecutionRecords.length)+") ",1)]),n("div",qn,[(h(!0),y(de,null,he(k.subPlanExecutionRecords,(_,g)=>(h(),ye(dn,{key:_.currentPlanId||g,"sub-plan":_,"sub-plan-index":g,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:b,onStepSelected:r},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2))),128))])):V("",!0)]))}}),Vn=Se(Hn,[["__scopeId","data-v-ee75d960"]]);function $s(){return{formatResponseText:b=>b?b.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:b=>{if(!b||isNaN(b.getTime()))return"";const c=new Date().getTime()-b.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return b.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.warn("[useMessageFormatting] Error formatting timestamp:",b,f),""}},getMessageClasses:b=>se(()=>({user:b.type==="user",assistant:b.type==="assistant",streaming:b.isStreaming,"has-error":!!b.error,"has-thinking":!!b.thinking,"has-execution":!!b.planExecution})),formatFileSize:b=>{if(b===0)return"0 B";const r=1024,c=["B","KB","MB","GB"],f=Math.floor(Math.log(b)/Math.log(r));return parseFloat((b/Math.pow(r,f)).toFixed(2))+" "+c[f]},truncateText:(b,r=100)=>!b||b.length<=r?b:b.substring(0,r)+"...",stripHtml:b=>b.replace(/<[^>]*>/g,""),hasDisplayableContent:b=>!!(b.content||(b.thinking??!1)||(b.planExecution??!1)||b.error),getMessageStatus:b=>b.error?"Send failed":b.isStreaming?"Typing...":b.type==="assistant"&&!b.content&&!b.thinking?"Waiting for response":""}}class Dt{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const jn={class:"user-input-form-container"},zn={class:"user-input-header"},Wn={class:"user-input-title"},Gn={class:"user-input-message"},Kn={key:0,class:"form-description"},Jn={key:0,class:"form-grid"},Xn=["for"],Yn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","required","onUpdate:modelValue"],oa={value:""},na=["value"],aa={key:6,class:"checkbox-group"},la=["id","name","value","onUpdate:modelValue"],ra={class:"checkbox-label"},ia={key:7,class:"radio-group"},ca=["id","name","value","onUpdate:modelValue"],ua={class:"radio-label"},da=["id","name","placeholder","required","onUpdate:modelValue"],pa={key:1,class:"form-group"},ma={for:"form-input-genericInput"},ha={type:"submit",class:"submit-user-input-btn"},fa=$e({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:t}){const e=o,s=t;De();const a=Ve({}),l=x(e.genericInput??""),i=x(!1),m=x(null),b=()=>{const E=e.userInputWaitState?.formInputs;E&&E.length>0&&(!i.value||Object.keys(a).length!==E.length)&&(E.forEach((u,_)=>{(!(_ in a)||u.type==="checkbox"&&!Array.isArray(a[_])||u.type!=="checkbox"&&a[_]==="")&&(u.type==="checkbox"?a[_]=[]:a[_]="")}),i.value=!0)};Me(()=>{b()}),fe(()=>e.userInputWaitState?.formInputs,()=>{m.value&&clearTimeout(m.value),m.value=setTimeout(()=>{i.value=!1,b()},100)},{deep:!0});const r=async()=>{try{const E={},k=e.userInputWaitState?.formInputs;k&&k.length>0?Object.entries(a).forEach(([u,_])=>{const g=parseInt(u,10),R=k[g].label||`input_${u}`;Array.isArray(_)?E[R]=_.join(", "):E[R]=_}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",e.planId),e.planId?(await Dt.submitFormInput(e.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},c=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(k=>k.trim()).filter(k=>k.length>0):[]:[],f=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Ue(()=>{m.value&&clearTimeout(m.value)}),(E,k)=>(h(),y("div",jn,[n("div",zn,[A(p(F),{icon:"carbon:user",class:"user-icon"}),n("h4",Wn,d(E.$t("chat.userInputRequired")),1)]),n("p",Gn,d(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),y("p",Kn,d(E.userInputWaitState?.formDescription),1)):V("",!0),n("form",{onSubmit:ge(r,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),y("div",Jn,[(h(!0),y(de,null,he(E.userInputWaitState?.formInputs,(u,_)=>(h(),y("div",{key:_,class:"form-group"},[n("label",{for:`form-input-${u.label.replace(/\W+/g,"_")}`},d(u.label)+d(f(u.required)?" *":"")+": ",9,Xn),!u.type||u.type==="text"?ve((h(),y("input",{key:0,type:"text",id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input"},null,8,Yn)),[[Te,a[_]]]):u.type==="email"?ve((h(),y("input",{key:1,type:"email",id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input"},null,8,Qn)),[[Te,a[_]]]):u.type==="number"?ve((h(),y("input",{key:2,type:"number",id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input"},null,8,Zn)),[[Te,a[_]]]):u.type==="password"?ve((h(),y("input",{key:3,type:"password",id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input"},null,8,ea)),[[Te,a[_]]]):u.type==="textarea"?ve((h(),y("textarea",{key:4,id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input form-textarea",rows:"4"},null,8,ta)),[[Te,a[_]]]):u.type==="select"&&u.options?ve((h(),y("select",{key:5,id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input form-select"},[n("option",oa,d(E.$t("selectCommon.pleaseSelect")),1),(h(!0),y(de,null,he(c(u.options),g=>(h(),y("option",{key:g,value:g},d(g),9,na))),128))],8,sa)),[[Bt,a[_]]]):u.type==="checkbox"&&u.options?(h(),y("div",aa,[(h(!0),y(de,null,he(c(u.options),g=>(h(),y("label",{key:g,class:"checkbox-item"},[ve(n("input",{type:"checkbox",id:`form-input-${u.label.replace(/\W+/g,"_")}-${g.replace(/\W+/g,"_")}`,name:u.label,value:g,"onUpdate:modelValue":v=>a[_]=v,class:"form-checkbox"},null,8,la),[[Ft,a[_]]]),n("span",ra,d(g),1)]))),128))])):u.type==="radio"&&u.options?(h(),y("div",ia,[(h(!0),y(de,null,he(c(u.options),g=>(h(),y("label",{key:g,class:"radio-item"},[ve(n("input",{type:"radio",id:`form-input-${u.label.replace(/\W+/g,"_")}-${g.replace(/\W+/g,"_")}`,name:u.label,value:g,"onUpdate:modelValue":v=>a[_]=v,class:"form-radio"},null,8,ca),[[co,a[_]]]),n("span",ua,d(g),1)]))),128))])):ve((h(),y("input",{key:8,type:"text",id:`form-input-${u.label.replace(/\W+/g,"_")}`,name:u.label,placeholder:u.placeholder||"",required:f(u.required),"onUpdate:modelValue":g=>a[_]=g,class:"form-input"},null,8,da)),[[Te,a[_]]])]))),128))])):(h(),y("div",pa,[n("label",ma,d(E.$t("common.input"))+":",1),ve(n("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":k[0]||(k[0]=u=>l.value=u),class:"form-input"},null,512),[[Te,l.value]])])),n("button",ha,d(E.$t("chat.userInput.submit")),1)],32)]))}}),va=Se(fa,[["__scopeId","data-v-e4d0802d"]]),ga={class:"response-section"},ya={class:"response-header"},ba={class:"response-avatar"},_a={class:"response-name"},wa={key:0,class:"response-timestamp"},$a={class:"response-content"},Sa={key:1,class:"final-response"},Ta=["innerHTML"],Pa={class:"response-actions"},Ea=["title"],ka=["title"],Ca={key:2,class:"response-placeholder"},Ra={class:"typing-indicator"},Ia={class:"typing-text"},Aa={key:3,class:"response-error"},xa={class:"error-text"},Ma={key:4,class:"response-empty"},Fa={class:"empty-text"},Da=$e({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:t}){const e=o,s=t,{formatResponseText:a,formatTimestamp:l}=$s(),i=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},m=()=>{s("regenerate")},b=()=>{s("retry")},r=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,f)=>(h(),y("div",ga,[n("div",ya,[n("div",ba,[A(p(F),{icon:"carbon:bot",class:"bot-icon"})]),n("div",_a,d(c.$t("chat.botName")),1),c.timestamp?(h(),y("div",wa,d(p(l)(c.timestamp)),1)):V("",!0)]),n("div",$a,[c.userInputWaitState?.waiting?(h(),ye(va,gs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:r}),null,16,["user-input-wait-state","generic-input"])):V("",!0),c.content?(h(),y("div",Sa,[n("div",{class:"response-text",innerHTML:p(a)(c.content)},null,8,Ta),n("div",Pa,[n("button",{class:"action-btn copy-btn",onClick:i,title:c.$t("chat.copyResponse")},[A(p(F),{icon:"carbon:copy"})],8,Ea),n("button",{class:"action-btn regenerate-btn",onClick:m,title:c.$t("chat.regenerateResponse")},[A(p(F),{icon:"carbon:renew"})],8,ka)])])):c.isStreaming?(h(),y("div",Ca,[n("div",Ra,[f[0]||(f[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1)),n("span",Ia,d(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),y("div",Aa,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",xa,d(c.error),1),n("button",{class:"retry-btn",onClick:b},d(c.$t("chat.retry")),1)])):(h(),y("div",Ma,[n("span",Fa,d(c.$t("chat.waitingForResponse")),1)]))])]))}}),Na=Se(Da,[["__scopeId","data-v-a03ac86f"]]);function Ua(){const s=x(new Set),a=Ve(new Map),l=Ve(new Map),i=Ve(new Map),m=Ve(new Map),b=x(!1),r=x(null),c=I=>m.get(I),f=(I,U)=>{if(!I){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}m.set(I,U),console.log("[usePlanExecution] Cached plan record:",I)},E=()=>Array.from(s.value),k=I=>{if(!I){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(I),l.set(I,0),i.set(I,0),console.log("[usePlanExecution] Tracking plan:",I),r.value||v(),_(I).catch(U=>{console.error(`[usePlanExecution] Initial poll failed for ${I}:`,U)})},u=I=>{s.value.delete(I),l.delete(I),i.delete(I),console.log("[usePlanExecution] Untracking plan:",I),s.value.size===0&&a.size===0&&R()},_=async I=>{if(I)try{console.log("[usePlanExecution] Polling plan status for:",I);const U=await Dt.getDetails(I);if(console.log("[usePlanExecution] Received plan details:",U?"YES":"NO",U),i.delete(I),!U){const $=i.get(I)||0;$<10?(i.set(I,$+1),console.log(`[usePlanExecution] Plan ${I} not found yet, retrying (${$+1}/10)`),setTimeout(()=>{s.value.has(I)&&_(I).catch(T=>{console.error(`[usePlanExecution] Retry poll failed for ${I}:`,T)})},1e3)):(console.warn(`[usePlanExecution] Plan ${I} not found after 10 attempts, giving up`),u(I));return}const M=l.get(I)||0;l.set(I,M+1);const H=U.rootPlanId||U.currentPlanId;if(!H){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",U);return}if(m.set(H,U),I!==H&&(m.set(I,U),console.log("[usePlanExecution] Stored record with both keys:",{planId:I,recordKey:H})),console.log("[usePlanExecution] Updated plan execution record:",{planId:I,recordKey:H,rootPlanId:U.rootPlanId,currentPlanId:U.currentPlanId,completed:U.completed,status:U.status,attempt:M+1}),U.completed){console.log(`[usePlanExecution] Plan ${H} completed, checking for summary...`);const $=bt();$.currentTask&&$.currentTask.isRunning&&($.currentTask.isRunning=!1);const T=U.summary||U.result||U.message,w=a.get(H)||0;if(!T&&w<10)a.set(H,w+1),console.log(`[usePlanExecution] Plan ${H} completed but no summary yet, continuing to poll (${w+1}/10)`);else{console.log(`[usePlanExecution] Plan ${H} completed, cleaning up...`,{hasSummary:!!T,pollCount:w});try{await Dt.deleteExecutionDetails(H),console.log(`[usePlanExecution] Deleted execution details for plan: ${H}`)}catch(D){const j=D instanceof Error?D.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${j}`)}u(I),a.delete(H),setTimeout(()=>{m.delete(H),I!==H&&m.delete(I)},5e3)}}U.status==="failed"&&U.message&&!U.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${H} failed:`,U.message)}catch(U){const M=U instanceof Error?U.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${I}:`,M);const H=i.get(I)||0;H<10&&(i.set(I,H+1),console.log(`[usePlanExecution] Network error for ${I}, retrying (${H+1}/10)`),setTimeout(()=>{s.value.has(I)&&_(I).catch($=>{console.error(`[usePlanExecution] Retry poll failed for ${I}:`,$)})},1e3*(H+1)))}},g=async()=>{if(b.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const I=new Set(s.value);for(const[U]of a.entries())I.add(U);if(I.size!==0)try{b.value=!0;const U=Array.from(I).map(M=>_(M));await Promise.all(U)}catch(U){console.error("[usePlanExecution] Failed to poll tracked plans:",U)}finally{b.value=!1}},v=()=>{r.value&&clearInterval(r.value),r.value=window.setInterval(()=>{g()},1e3),console.log("[usePlanExecution] Started adaptive polling")},R=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}r.value&&(clearInterval(r.value),r.value=null),console.log("[usePlanExecution] Stopped polling")},B=async I=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${I}`),await _(I)},G=I=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:I}),!I){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}bt().setTaskRunning(I),k(I)},P=()=>{R(),s.value.clear(),a.clear(),l.clear(),i.clear(),m.clear(),b.value=!1};return{planExecutionRecords:Ne(m),trackedPlanIds:Ne(s),isPolling:Ne(b),getPlanExecutionRecord:c,setCachedPlanRecord:f,getTrackedPlanIds:E,trackPlan:k,untrackPlan:u,handlePlanExecutionRequested:G,pollPlanStatusImmediately:B,startPolling:v,stopPolling:R,cleanup:P}}let Et=null;function Ze(){return Et||(Et=Ua()),Et}function La(){const o=Ze(),t=x([]),e=x(null),s=x(null),a=x(null),l=se(()=>a.value),i=x(!1),m=x(null),b=x(null),r=x(null),c=se(()=>e.value&&t.value.find(L=>L.id===e.value)||null),f=se(()=>t.value.length>0),E=se(()=>t.value.length),k=se(()=>{if(!s.value)return c.value?.messages||[];const L=[];for(const q of t.value)q.conversationId===s.value&&L.push(...q.messages);return L.sort((q,z)=>q.timestamp.getTime()-z.timestamp.getTime())}),u=L=>{const q={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:L||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(q),e.value=q.id,console.log("[useMessageDialog] Created new dialog round:",q.id,{conversationId:s.value,rootPlanId:a.value}),q},_=L=>t.value.find(q=>q.id===L)||null,g=L=>{if(t.value.forEach(q=>{q.isActive=!1}),L){const q=t.value.find(z=>z.id===L);q&&(q.isActive=!0,e.value=L)}else e.value=null},v=(L,q)=>{const z=t.value.find(X=>X.id===L);z&&(z.messages.push(q),z.updatedAt=new Date)},R=(L,q,z)=>{const X=t.value.find(te=>te.id===L);if(X){const te=X.messages.findIndex(ie=>ie.id===q);te!==-1&&(X.messages[te]={...X.messages[te],...z},X.updatedAt=new Date)}},B=L=>{const q=t.value.findIndex(z=>z.id===L);if(q!==-1){const z=t.value[q];if(t.value.splice(q,1),console.log("[useMessageDialog] Deleted dialog round:",L),e.value===L){const X=t.value.filter(te=>te.conversationId===z.conversationId);e.value=X.length>0?X[0].id:null,e.value&&g(e.value)}}},G=L=>{const q=t.value.filter(z=>z.planId===L);q.forEach(z=>{B(z.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for plan:`,L)},P=L=>{const q=t.value.filter(z=>z.conversationId===L);q.forEach(z=>{B(z.id)}),console.log(`[useMessageDialog] Deleted ${q.length} dialog round(s) for conversation:`,L),s.value===L&&(s.value=null)},I=()=>{t.value=[],e.value=null},U=async L=>{let q=null,z=null;try{if(i.value){const re="Please wait for the current task to complete before starting a new one";return m.value=re,{success:!1,error:re}}i.value=!0,m.value=null,q=u();const X={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:L.input,timestamp:new Date,isStreaming:!1,...L.uploadedFiles&&{attachments:L.uploadedFiles.map(re=>typeof re=="string"?new File([],re):re)}};v(q.id,X),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},v(q.id,z);const te=L;let ie;if(te.toolName&&te.replacementParams?ie=await Xt.executeByToolName(te.toolName,te.replacementParams,L.uploadedFiles,L.uploadKey,"VUE_DIALOG"):ie=await Xt.sendMessageWithDefaultPlan(L,"VUE_DIALOG"),ie.conversationId&&(s.value=ie.conversationId,q.conversationId=ie.conversationId,Pe.setConversationId(ie.conversationId),console.log("[useMessageDialog] Conversation ID set:",ie.conversationId)),ie.planId){const re=ie.planId;a.value=re,q.planId=re,R(q.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:re,rootPlanId:re,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(re),console.log("[useMessageDialog] Root plan ID set and tracking started:",re)}else{const re={content:ie.message||ie.result||"No response received",isStreaming:!1};R(q.id,z.id,re)}return{success:!0,...ie.planId&&{planId:ie.planId},...ie.conversationId&&{conversationId:ie.conversationId}}}catch(X){const te=X instanceof Error?X.message:"Failed to send message";return m.value=te,console.error("[useMessageDialog] Send message failed:",X),q&&z&&R(q.id,z.id,{content:`Error: ${te}`,error:te,isStreaming:!1}),{success:!1,error:te}}finally{i.value=!1}},M=async L=>{let q=null,z=null;try{if(i.value){const N="Please wait for the current task to complete before starting a new one";return m.value=N,{success:!1,error:N}}i.value=!0,m.value=null;const X=Pe.getConversationId();X&&!s.value&&(s.value=X,console.log("[useMessageDialog] Restored conversationId from memoryStore:",X)),q=u(L.title),L.title&&(q.title=L.title);const te={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:L.title,timestamp:new Date,isStreaming:!1,...L.uploadedFiles&&{attachments:L.uploadedFiles.map(N=>typeof N=="string"?new File([],N):N)}};v(q.id,te),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},v(q.id,z);const ie=L.planData.planTemplateId;if(!ie||ie===null)throw new Error("Plan template ID is required");const re=await fo.executePlan(ie,L.params,L.uploadedFiles,L.replacementParams,L.uploadKey??void 0,"VUE_SIDEBAR");if(re.conversationId){const N=re.conversationId,Q=s.value||Pe.getConversationId();N!==Q?(console.log("[useMessageDialog] Conversation ID changed:",Q,"->",N),s.value=N,q.conversationId=N,Pe.setConversationId(N)):(q.conversationId=N,console.log("[useMessageDialog] Conversation ID unchanged:",N))}else s.value&&(q.conversationId=s.value);if(re.planId){const N=re.planId;a.value=N,q.planId=N,R(q.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:N,rootPlanId:N,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(N),console.log("[useMessageDialog] Root plan ID set and tracking started:",N)}else{const N={content:"Plan execution started",isStreaming:!1};R(q.id,z.id,N)}return{success:!0,...re.planId&&{planId:re.planId}}}catch(X){const te=X instanceof Error?X.message:"Failed to execute plan";return m.value=te,console.error("[useMessageDialog] Execute plan failed:",X),q&&z&&R(q.id,z.id,{content:`Error: ${te}`,error:te,isStreaming:!1}),i.value=!1,{success:!1,error:te}}},H=(L,q,z)=>{const X={};z!==void 0&&(X.planExecution=z),R(L,q,X)},$=L=>{const q={...L};return"agentExecutionSequence"in L&&Array.isArray(L.agentExecutionSequence)&&(q.agentExecutionSequence=L.agentExecutionSequence.map(z=>T(z))),q},T=L=>{const q={...L};return"subPlanExecutionRecords"in L&&Array.isArray(L.subPlanExecutionRecords)&&(q.subPlanExecutionRecords=L.subPlanExecutionRecords.map(z=>$(z))),q},w=(L,q,z)=>{c.value||u();const X=c.value,te={...z};z?.planExecution&&(te.planExecution=$(z.planExecution));const ie={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:L,content:q,timestamp:new Date,isStreaming:!1,...te};return X.messages.push(ie),X.updatedAt=new Date,ie},D=(L,q)=>{if(!c.value)return;const z={...q};q.planExecution&&(z.planExecution=$(q.planExecution));const X=c.value.messages.findIndex(te=>te.id===L);X!==-1&&(c.value.messages[X]={...c.value.messages[X],...z},c.value.updatedAt=new Date)},j=L=>{if(c.value)return c.value.messages.find(q=>q.id===L)},J=L=>{b.value=L,D(L,{isStreaming:!0})},le=L=>{L&&D(L,{isStreaming:!1}),(b.value===L||!L)&&(b.value=null)},Fe=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,b.value=null)},be=(L,q)=>{i.value=!L,q!==void 0&&(r.value=q),console.log("[useMessageDialog] Input state updated:",{enabled:L,placeholder:q,isLoading:i.value})},_e=L=>{s.value=L,console.log("[useMessageDialog] Set conversationId:",L)},Be=()=>{t.value=[],e.value=null,a.value=null,s.value=null,i.value=!1,m.value=null,r.value=null},Ee=(L,q,z)=>{const X={planExecution:$(z),isStreaming:!z.completed};if(!z.completed)X.thinking="Processing...";else{if(!z.agentExecutionSequence||z.agentExecutionSequence.length===0){const te=z.summary??z.result??z.message??"Execution completed";te&&(X.content=te,X.thinking="")}else z.summary&&(X.content=z.summary,X.thinking="");z.status==="failed"&&z.message&&(X.content=`Error: ${z.message}`,X.thinking="")}R(L.id,q.id,X)};return ys(()=>{const L=o.planExecutionRecords,q=L.size,z=Array.from(L.entries()),X=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",z.length,"size:",q),console.log("[useMessageDialog] watchEffect - dialogList count:",X.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",X.filter(N=>N.planId).map(N=>({id:N.id,planId:N.planId})));for(const N of X){if(!N.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",N.id);continue}const Q=z.find(([Y])=>Y===N.planId);if(!Q){console.log("[useMessageDialog] watchEffect: No record found for planId:",N.planId,{dialogId:N.id,availableRecordKeys:z.map(([Y])=>Y)});continue}const[,ee]=Q,O=$(ee),Z=N.messages.find(Y=>Y.planExecution?.rootPlanId===N.planId);if(!Z){console.log("[useMessageDialog] watchEffect: No message found for planId:",N.planId,{dialogMessages:N.messages.map(Y=>({id:Y.id,type:Y.type,planExecutionRootPlanId:Y.planExecution?.rootPlanId,hasPlanExecution:!!Y.planExecution}))});continue}console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:N.id,messageId:Z.id,planId:N.planId,recordCompleted:O.completed,recordStatus:O.status}),Ee(N,Z,O)}const te=o.trackedPlanIds.value.size>0,ie=z.some(([,N])=>N&&!N.completed&&N.status!=="failed");!(te||ie)&&i.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:te,hasRunningPlansInRecords:ie,trackedPlanIds:Array.from(o.trackedPlanIds.value),recordsCount:z.length}),i.value=!1)}),{dialogList:Ne(t),activeDialogId:Ne(e),rootPlanId:Ne(a),conversationId:Ne(s),isLoading:i,error:m,streamingMessageId:Ne(b),inputPlaceholder:Ne(r),activeDialog:c,activeRootPlanId:l,hasDialogs:f,dialogCount:E,messages:k,createDialog:u,getDialog:_,setActiveDialog:g,addMessageToDialog:v,updateMessageInDialog:R,deleteDialog:B,deleteConversationRoundByPlanId:G,deleteConversation:P,clearAllDialogs:I,sendMessage:U,executePlan:M,updatePlanExecutionStatus:H,updateInputState:be,setConversationId:_e,reset:Be,addMessage:w,updateMessage:D,findMessage:j,startStreaming:J,stopStreaming:le,clearMessages:Fe}}let kt=null;function et(){return kt||(kt=La()),kt}function Oa(o){const t=x(!1),e=x(!0),s=150,a=async(g=!0)=>{o.value&&(await Ie(),o.value.scrollTo({top:o.value.scrollHeight,behavior:g?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:g,scrollHeight:v,clientHeight:R}=o.value;return v-g-R<s},i=()=>{if(!o.value)return;const g=l();t.value=!g&&o.value.scrollHeight>o.value.clientHeight,g&&(e.value=!0)},m=()=>{i(),l()||(e.value=!1)},b=async()=>{e.value&&await a()},r=async()=>{e.value=!0,await a()},c=(g,v=!0)=>{if(!o.value)return;const R=o.value.querySelector(`[data-message-id="${g}"]`);R&&R.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},f=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:g,scrollHeight:v,clientHeight:R}=o.value,B=g===0,G=g+R>=v-5,P=v>R?g/(v-R)*100:100;return{scrollTop:g,scrollHeight:v,clientHeight:R,isAtTop:B,isAtBottom:G,scrollPercentage:P}},E=()=>{o.value&&o.value.addEventListener("scroll",m,{passive:!0})},k=()=>{o.value&&o.value.removeEventListener("scroll",m)},u=()=>{E(),i()},_=()=>{k()};return Me(()=>{Ie(()=>{u()})}),Ue(()=>{_()}),{showScrollToBottom:Ne(t),isAutoScrollEnabled:Ne(e),scrollToBottom:a,autoScrollToBottom:b,forceScrollToBottom:r,scrollToMessage:c,isNearBottom:l,checkScrollPosition:i,getScrollInfo:f,addScrollListener:E,removeScrollListener:k,initializeScrollBehavior:u,cleanupScrollBehavior:_}}const Ba={class:"chat-container"},qa=["data-message-id"],Ha={class:"user-content"},Va={class:"message-text"},ja={key:0,class:"attachments"},za={class:"attachment-name"},Wa={class:"attachment-size"},Ga={class:"message-timestamp"},Ka={key:0,class:"message-status error"},Ja={class:"status-text"},Xa={key:1,class:"assistant-message"},Ya={key:0,class:"loading-message"},Qa={class:"loading-content"},Za=["title"],el=$e({__name:"ChatContainer",emits:["step-selected"],setup(o,{emit:t}){const e=t,{t:s}=De(),a=et(),{messages:l,isLoading:i,streamingMessageId:m,updateMessage:b,startStreaming:r,findMessage:c}=a,f=x(null),{scrollToBottom:E,autoScrollToBottom:k,showScrollToBottom:u}=Oa(f),{getMessageClasses:_,formatTimestamp:g,formatFileSize:v}=$s(),R=$=>m.value===$,B=se(()=>l.value),G=$=>{const T=$.target;if(T.classList.contains("md-copy-btn")){const w=T.getAttribute("data-raw");if(w){const D=decodeURIComponent(w);navigator.clipboard.writeText(D).then(()=>{T.textContent=s("chat.copied"),setTimeout(()=>{T.textContent=s("chat.copy")},1e3)})}}},P=async $=>{const T=c($);if(T)try{const w=T.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(w)}catch(w){console.error("Failed to copy message:",w)}},I=$=>{const T=c($);T&&T.type==="assistant"&&(b($,{content:""}),r($),console.warn("[ChatContainer] Regenerate not yet implemented"))},U=$=>{c($)&&(b($,{content:""}),r($),console.warn("[ChatContainer] Retry not yet implemented"))},M=$=>{console.log("[ChatContainer] Step selected:",$),e("step-selected",$)},H=($,T)=>{console.log("[ChatContainer] User input submitted:",T,"for message:",$.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Me(()=>{fe(l,()=>{Ie(()=>{k()})},{deep:!0})}),Ue(()=>{}),($,T)=>(h(),y("div",Ba,[n("div",{class:"messages",ref_key:"messagesRef",ref:f,onClick:G},[(h(!0),y(de,null,he(B.value,w=>(h(),y("div",{key:w.id,class:ue(["chat-message",[p(_)(w),{streaming:R(w.id)}]])},[w.type==="user"?(h(),y("div",{key:0,class:"user-message","data-message-id":w.id},[n("div",Ha,[n("div",Va,d(w.content),1),w.attachments?.length?(h(),y("div",ja,[(h(!0),y(de,null,he(w.attachments,(D,j)=>(h(),y("div",{key:j,class:"attachment-item"},[A(p(F),{icon:"carbon:document",class:"attachment-icon"}),n("span",za,d(D.name),1),n("span",Wa,d(p(v)(D.size)),1)]))),128))])):V("",!0),n("div",Ga,d(p(g)(w.timestamp)),1)]),w.error?(h(),y("div",Ka,[A(p(F),{icon:"carbon:warning",class:"status-icon"}),n("span",Ja,d(w.error),1)])):V("",!0)],8,qa)):w.type==="assistant"?(h(),y("div",Xa,[w.planExecution?(h(),ye(Vn,{key:0,"plan-execution":w.planExecution,"step-actions":w.stepActions||[],"generic-input":w.genericInput||"",onStepSelected:M},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),w.content||w.error||R(w.id)||w.planExecution?.userInputWaitState?.waiting?(h(),ye(Na,gs({key:1,content:w.content||"","is-streaming":R(w.id)||!1},{ref_for:!0},{...w.error?{error:w.error}:{},...w.planExecution?.userInputWaitState?{userInputWaitState:w.planExecution.userInputWaitState}:{},...w.planExecution?.currentPlanId?{planId:w.planExecution.currentPlanId}:{}},{timestamp:w.timestamp,"generic-input":w.genericInput||"",onCopy:()=>P(w.id),onRegenerate:()=>I(w.id),onRetry:()=>U(w.id),onUserInputSubmitted:D=>H(w,D)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):V("",!0)])):V("",!0)],2))),128)),p(i)?(h(),y("div",Ya,[n("div",Qa,[A(p(F),{icon:"carbon:circle-dash",class:"loading-icon"}),n("span",null,d($.$t("chat.processing")),1)])])):V("",!0)],512),A(qt,{name:"scroll-button"},{default:Xe(()=>[p(u)?(h(),y("button",{key:0,class:"scroll-to-bottom",onClick:T[0]||(T[0]=()=>p(E)()),title:$.$t("chat.scrollToBottom")},[A(p(F),{icon:"carbon:chevron-down"})],8,Za)):V("",!0)]),_:1})]))}}),tl=Se(el,[["__scopeId","data-v-9504dbce"]]);class Yt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const sl={class:"file-upload-component"},ol=["accept"],nl={key:0},al={key:1},ll={key:0,class:"files-list"},rl={class:"file-name"},il={class:"file-size"},cl=["onClick","title"],ul={key:0,class:"upload-progress"},dl=$e({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:t,emit:e}){const{t:s}=De(),a=o,l=e,i=x(),m=x([]),b=x(!1),r=x(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),m.value=[],r.value=null,l("upload-key-changed",null)};Ue(()=>{c()}),fe(()=>m.value,g=>{l("files-removed",g)},{deep:!0});const f=()=>{a.disabled||i.value&&i.value.click()},E=async g=>{const v=g.target,R=v.files;if(!R||R.length===0)return;const B=Array.from(R);console.log("[FileUpload] Selected files for upload:",B.map(G=>G.name)),await k(B),v.value=""},k=async g=>{if(g.length!==0){b.value=!0,l("upload-started");try{const v=await Yt.uploadFiles(g);v.success&&(!r.value&&v.uploadKey?(r.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",r.value),m.value=v.uploadedFiles):r.value?(console.log("[FileUpload] Using existing uploadKey:",r.value),m.value=[...m.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),m.value=v.uploadedFiles),v.uploadKey&&(r.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",r.value)),console.log("[Input] Updated global uploadedFiles state:",m.value),l("files-uploaded",m.value,r.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{b.value=!1}}},u=async g=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",g.originalName,"from uploadKey:",r),r.value){const v=await Yt.deleteFile(r.value,g.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}m.value=m.value.filter(v=>v.originalName!==g.originalName),m.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),r.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",m.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},_=g=>{if(g===0)return"0 Bytes";const v=1024,R=["Bytes","KB","MB","GB"],B=Math.floor(Math.log(g)/Math.log(v));return parseFloat((g/Math.pow(v,B)).toFixed(2))+" "+R[B]};return t({uploadedFiles:m,uploadKey:r,resetSession:c,uploadFiles:k,removeFile:u,isUploading:b}),(g,v)=>(h(),y("div",sl,[n("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:g.acceptedFileTypes||""},null,40,ol),n("div",{class:ue(["uploaded-files",{"has-files":m.value.length>0}])},[n("div",{class:"files-header",onClick:f},[A(p(F),{icon:"carbon:attachment"}),m.value.length===0?(h(),y("span",nl,d(p(s)("input.attachFile")),1)):(h(),y("span",al,d(p(s)("input.attachedFiles"))+" ("+d(m.value.length)+")",1))]),m.value.length>0?(h(),y("div",ll,[(h(!0),y(de,null,he(m.value,R=>(h(),y("div",{key:R.originalName,class:"file-item"},[A(p(F),{icon:"carbon:document",class:"file-icon"}),n("span",rl,d(R.originalName),1),n("span",il,"("+d(_(R.size))+")",1),n("button",{onClick:B=>u(R),class:"remove-btn",title:p(s)("input.removeFile")},[A(p(F),{icon:"carbon:close"})],8,cl)]))),128))])):V("",!0)],2),b.value?(h(),y("div",ul,[A(p(F),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),n("span",null,d(p(s)("input.uploading")),1)])):V("",!0)]))}}),Ss=Se(dl,[["__scopeId","data-v-a97ebade"]]),pl={class:"input-area"},ml={class:"input-container"},hl={class:"input-row-first"},fl=["placeholder","disabled"],vl={class:"input-row-second"},gl=["title","disabled"],yl={value:""},bl=["value"],_l=["title"],wl=["disabled","title"],$l=["title"],Qt="chatInputHistory",Zt=20,Sl=$e({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(o,{expose:t}){const{t:e}=De(),s=bt(),a=Qe(),l=et(),i=Ze(),m=se(()=>s.hasRunningTask()),b=o,r=x(),c=x(),f=x(""),E=se(()=>e("input.placeholder")),k=x(null),u=se(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:k.value?k.value:E.value),_=x([]),g=x(null),v=x(""),R=x([]),B=x(!1),G=x(!1),P=x([]),I=x(-1),U=x(""),M=se(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),H=async()=>{B.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const O=a.getAllCoordinatorToolsFromTemplates(),Z=[];for(const pe of O)if(pe.enableInternalToolcall)try{const Ce=JSON.parse(pe.inputSchema||"[]");if(Array.isArray(Ce)&&Ce.length===1){const ut=Ce[0];Z.push({value:pe.planTemplateId,label:`${pe.toolName} (${ut.name})`,toolName:pe.toolName,planTemplateId:pe.planTemplateId,paramName:ut.name})}}catch(Ce){console.warn("[InputArea] Failed to parse inputSchema for tool:",pe.toolName,Ce)}R.value=Z,console.log("[InputArea] Loaded",Z.length,"inner tools with single parameter");const Y=localStorage.getItem("inputAreaSelectedTool");if(Y){if(Z.length>0)if(Z.some(Ce=>Ce.value===Y)){G.value=!0;try{v.value=Y,console.log("[InputArea] Restored selected tool from localStorage:",Y)}finally{G.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),v.value===Y&&(v.value="");else if(v.value!==Y){G.value=!0;try{v.value=Y,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",Y)}finally{G.value=!1}}}}catch(O){console.error("[InputArea] Failed to load inner tools:",O),R.value=[]}finally{B.value=!1}},$=se(()=>R.value.length>0?R.value.map(O=>({value:O.value,label:O.label})):b.selectionOptions);fe(v,O=>{G.value||localStorage.setItem("inputAreaSelectedTool",O||"")});const T=()=>{try{const O=localStorage.getItem(Qt);O&&(P.value=JSON.parse(O))}catch(O){console.error("[InputArea] Failed to load history:",O),P.value=[]}},w=()=>{try{localStorage.setItem(Qt,JSON.stringify(P.value))}catch(O){console.error("[InputArea] Failed to save history:",O)}},D=O=>{if(!O.trim())return;const Z=P.value.indexOf(O);Z!==-1&&P.value.splice(Z,1),P.value.unshift(O),P.value.length>Zt&&(P.value=P.value.slice(0,Zt)),w()},j=O=>{if(P.value.length===0)return;I.value===-1&&(U.value=f.value);let Z=I.value+O;Z<-1?Z=-1:Z>=P.value.length&&(Z=P.value.length-1),I.value=Z,I.value===-1?(f.value=U.value,U.value=""):f.value=P.value[I.value],q()};fe(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),H()},{deep:!0}),Me(()=>{H(),T(),fe(()=>i.planExecutionRecords,O=>{const Z=Array.from(O.entries());if(Z.length===0)return;Z.some(([,pe])=>pe&&!pe.completed&&pe.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),J())},{deep:!0}),fe(()=>s.taskToInput,O=>{O?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",O),Ie(()=>{Q(O.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const J=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),c.value?.resetSession()};Ue(()=>{J()});const le=(O,Z)=>{_.value=O.map(Y=>Y.originalName),g.value=Z,console.log("[InputArea] Files uploaded:",O.length,"uploadKey:",Z),_.value.length>0&&(k.value=e("input.filesAttached",{count:_.value.length}))},Fe=O=>{_.value=O.map(Z=>Z.originalName),console.log("[InputArea] Files removed, remaining:",O.length),_.value.length===0?k.value=null:k.value=e("input.filesAttached",{count:_.value.length})},be=O=>{g.value=O,console.log("[InputArea] Upload key changed:",O)},_e=()=>{console.log("[InputArea] Upload started")},Be=()=>{console.log("[InputArea] Upload completed")},Ee=O=>{console.error("[InputArea] Upload error:",O)},L=se(()=>l.isLoading.value),q=()=>{Ie(()=>{r.value&&(r.value.style.height="auto",r.value.style.height=Math.min(r.value.scrollHeight,120)+"px")})},z=O=>{if(O.key==="Enter"&&(O.ctrlKey||O.metaKey)){O.preventDefault(),X();return}const Z=M.value?O.altKey:O.ctrlKey;if(O.key==="ArrowUp"&&Z){O.preventDefault(),j(1);return}if(O.key==="ArrowDown"&&Z){O.preventDefault(),j(-1);return}I.value!==-1&&O.key.length===1&&!O.ctrlKey&&!O.metaKey&&!O.altKey&&(I.value=-1,U.value="")},X=async()=>{if(!f.value.trim()||L.value)return;const O=f.value.trim();D(O),I.value=-1,U.value="";const Z={input:O,memoryId:Pe.selectMemoryId,uploadedFiles:_.value};if(g.value?(Z.uploadKey=g.value,console.log("[InputArea] Including uploadKey in message:",g.value)):console.log("[InputArea] No uploadKey available for message"),v.value){const Y=R.value.find(pe=>pe.value===v.value);if(Y){const pe=Z;pe.toolName=Y.planTemplateId,pe.replacementParams={[Y.paramName]:O},console.log("[InputArea] Sending message with tool:",Y.toolName)}}try{await l.sendMessage(Z)}catch(Y){const pe=Y instanceof Error?Y.message:String(Y);console.error("[InputArea] Send message failed:",pe)}re()},te=()=>{Re.toggleSidebar(),console.log("[InputArea] Plan mode button clicked, sidebar toggled, isCollapsed:",Re.isCollapsed)},ie=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},re=()=>{f.value="",q()},N=(O,Z)=>{l.updateInputState(O,Z)},Q=O=>{f.value=O,q()},ee=()=>f.value.trim();return fe(()=>b.initialValue,O=>{O.trim()&&(f.value=O,q())},{immediate:!0}),t({clearInput:re,updateState:N,getQuery:ee,focus:()=>r.value?.focus(),get uploadedFiles(){return c.value?.uploadedFiles?.map(O=>O.originalName)||[]},get uploadKey(){return c.value?.uploadKey||null}}),(O,Z)=>(h(),y("div",pl,[A(Ss,{ref_key:"fileUploadRef",ref:c,disabled:L.value,onFilesUploaded:le,onFilesRemoved:Fe,onUploadKeyChanged:be,onUploadStarted:_e,onUploadCompleted:Be,onUploadError:Ee},null,8,["disabled"]),n("div",ml,[n("div",hl,[ve(n("textarea",{"onUpdate:modelValue":Z[0]||(Z[0]=Y=>f.value=Y),ref_key:"inputRef",ref:r,class:"chat-input",placeholder:u.value,disabled:L.value,onKeydown:z,onInput:q},null,40,fl),[[Te,f.value]])]),n("div",vl,[ve(n("select",{"onUpdate:modelValue":Z[1]||(Z[1]=Y=>v.value=Y),class:"selection-input",title:O.$t("input.selectionTitle"),disabled:B.value||L.value},[n("option",yl,d(O.$t("input.defaultFuncAgent")),1),(h(!0),y(de,null,he($.value,Y=>(h(),y("option",{key:Y.value,value:Y.value},d(Y.label),9,bl))),128))],8,gl),[[Bt,v.value]]),n("button",{class:"plan-mode-btn",title:O.$t("input.planMode"),onClick:te},[A(p(F),{icon:"carbon:document"}),ce(" "+d(O.$t("input.planMode")),1)],8,_l),m.value?(h(),y("button",{key:1,class:"send-button stop-button",onClick:ie,title:O.$t("input.stop")},[A(p(F),{icon:"carbon:stop-filled"}),ce(" "+d(O.$t("input.stop")),1)],8,$l)):(h(),y("button",{key:0,class:"send-button",disabled:!f.value.trim()||L.value,onClick:X,title:O.$t("input.send")},[A(p(F),{icon:"carbon:send-alt"}),ce(" "+d(O.$t("input.send")),1)],8,wl))])])]))}}),Tl=Se(Sl,[["__scopeId","data-v-f6666260"]]);class ft{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const Pl={key:0,class:"app-container"},El={class:"app-content"},kl={class:"header"},Cl={class:"relative"},Rl={class:"title-edit-group"},Il={id:"main-title",class:"main-title"},Al={key:0,id:"title-edit-container",class:"title-edit-container"},xl={class:"search-bar"},Ml={class:"search-container"},Fl=["placeholder"],Dl={class:"message-list",id:"message-list"},Nl={class:"message-header"},Ul={class:"message-content"},Ll={class:"sender-info"},Ol=["onClick"],Bl={class:"sender-name"},ql={class:"action-buttons"},Hl=["onClick"],Vl={class:"action-buttons"},jl=["onClick"],zl={class:"message-meta"},Wl={class:"message-id"},Gl={class:"meta-right"},Kl={key:0,class:"unread-count"},Jl={class:"message-time"},Xl=["id"],Yl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Ql={class:"bubble-avatar"},Zl={class:"bubble-content"},er={class:"bubble-text"},tr={key:0,class:"empty-state"},sr={class:"modal-content"},or={class:"modal-header"},nr={class:"modal-title"},ar=["placeholder"],lr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},rr={class:"modal-footer"},ir={class:"modal-content"},cr={class:"modal-header"},ur={class:"modal-title"},dr={class:"state-text",id:"delete-message"},pr={class:"modal-footer"},mr=$e({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(o,{emit:t}){const e=x(!1),s=x(""),a=x([]),l=x([]),i=x(!1),m=x(null),b=x(""),r=x(!1),c=x(null),f=new Map,E=t,k=M=>{M.key==="Escape"&&(r.value?I():i.value&&R())};Me(()=>{Pe.setLoadMessages(u),document.addEventListener("keydown",k)}),Ue(()=>{document.removeEventListener("keydown",k)});const u=async()=>{try{const M=await ft.getMemories();a.value=M.map(H=>({...H,expanded:f.has(H.conversation_id)?f.get(H.conversation_id):!1})),l.value=[...a.value],v()}catch(M){console.error("error:",M),a.value=[],l.value=[]}},_=M=>{Pe.selectMemory(M),E("memory-selected")},g=M=>{const H=typeof M=="string"?parseInt(M,10):M;return isNaN(H)||H<=0?"--":new Date(H.toString().length===13?H:H*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const M=s.value.toLowerCase().trim();if(!M){l.value=[...a.value];return}l.value=a.value.filter(H=>{const $=H.memory_name.toLowerCase().includes(M),T=H.conversation_id.toLowerCase().includes(M),w=H.messages?.some(D=>D.text.toLowerCase().includes(M))??!1;return $||T||w})},R=()=>{i.value=!1,m.value=null},B=async()=>{if(!m.value)return;const M=b.value.trim()||"unknow name",H=a.value.findIndex($=>$.conversation_id===m.value);if(H!==-1){const $=a.value[H];try{const T=await ft.updateMemory($.conversation_id,M);T.messages||(T.messages=[]),a.value[H]={...T,expanded:$.expanded},v(),i.value=!1}catch(T){console.error("error:",T)}}},G=M=>{const H=a.value.find($=>$.conversation_id===M);if(H){H.expanded=!H.expanded,f.set(M,H.expanded);const $=l.value.findIndex(T=>T.conversation_id===M);$!==-1&&(l.value[$]={...H})}},P=M=>{c.value=M,r.value=!0},I=()=>{r.value=!1,c.value=null},U=async()=>{if(c.value)try{await ft.deleteMemory(c.value),a.value=a.value.filter(M=>M.conversation_id!==c.value),v(),a.value.length===0&&Pe.clearMemoryId(),r.value=!1,c.value=null}catch(M){console.error("error:",M)}};return(M,H)=>(h(),ye(uo,{to:"body"},[A(qt,{name:"modal"},{default:Xe(()=>[p(Pe).isCollapsed?(h(),y("div",Pl,[n("div",El,[n("div",kl,[n("div",Cl,[n("div",Rl,[n("h1",Il,[n("span",null,d(M.$t("memory.title")),1)])]),e.value?(h(),y("div",Al)):V("",!0)]),n("button",{class:"close-btn",onClick:H[0]||(H[0]=$=>p(Pe).toggleSidebar())},[A(p(F),{icon:"carbon:close"})])]),n("div",xl,[n("div",Ml,[A(p(F),{class:"search-container-icon",icon:"carbon:search"}),ve(n("input",{type:"text",placeholder:M.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":H[1]||(H[1]=$=>s.value=$),onInput:v},null,40,Fl),[[Te,s.value]])])]),n("div",Dl,[n("div",null,[(h(!0),y(de,null,he(l.value,$=>(h(),y("div",{class:ue(["message-item",{expanded:$.expanded}]),key:$.conversation_id},[n("div",Nl,[n("div",Ul,[n("div",Ll,[n("div",{class:"sender-div",onClick:ge(T=>_($.conversation_id),["stop"])},[n("h3",Bl,d($.memory_name),1)],8,Ol),n("div",ql,[n("button",{class:"delete-btn",onClick:ge(T=>G($.conversation_id),["stop"])},[A(p(F),{id:"toggle-"+$.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Hl)]),n("div",Vl,[n("button",{class:"delete-btn",onClick:ge(T=>P($.conversation_id),["stop"])},[A(p(F),{icon:"carbon:delete"})],8,jl)])]),n("div",zl,[n("span",Wl,"ID: "+d($.conversation_id),1),n("div",Gl,[$.messages&&$.messages.length>0?(h(),y("span",Kl,d($.messages.length)+" "+d(M.$t("memory.size")),1)):V("",!0),n("span",Jl,d(g($.create_time)),1)])])])]),$.expanded?(h(),y("div",{key:0,id:"content-"+$.conversation_id,class:"expanded-content"},[n("div",Yl,[(h(!0),y(de,null,he($.messages,(T,w)=>(h(),y("div",{class:"message-bubble",key:w},[n("div",Ql,d(T.messageType),1),n("div",Zl,[n("p",er,d(T.text),1)])]))),128))])],8,Xl)):V("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),y("div",tr,H[3]||(H[3]=[n("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),i.value?(h(),y("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ge(R,["self"])},[n("div",sr,[n("div",or,[n("h3",nr,d(M.$t("memory.changeName")),1),ve(n("input",{type:"text","onUpdate:modelValue":H[2]||(H[2]=$=>b.value=$),class:"edit-input",placeholder:M.$t("memory.newNamePlaceholder")},null,8,ar),[[Te,b.value]]),n("span",lr,d(b.value.length),1)]),n("div",rr,[n("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:R},d(M.$t("memory.cancel")),1),n("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:B},d(M.$t("memory.save")),1)])])])):V("",!0),r.value?(h(),y("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ge(I,["self"])},[n("div",ir,[n("div",cr,[n("h3",ur,d(M.$t("memory.deleteHint")),1),n("p",dr,d(M.$t("memory.deleteHintPrefix"))+" "+d(c.value)+" "+d(M.$t("memory.deleteHintSuffix")),1)]),n("div",pr,[n("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:I},d(M.$t("memory.cancel")),1),n("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:U},d(M.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),hr=Se(mr,[["__scopeId","data-v-16358835"]]);class Ke{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),m=document.createElement("a");m.href=i,m.download=s??e.split("/").pop()??"download",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(i),document.body.removeChild(m)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(i=>t.startsWith(i)))return!0;const l=e.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const fr={class:"file-tree-node"},vr={class:"node-icon"},gr={class:"node-name"},yr={key:1,class:"file-size"},br={key:2,class:"node-actions"},_r={key:0,class:"children"},wr=$e({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:t}){const e=o,s=t,a=x(e.level===0),l=x(!1),i=x(!1),m=x({}),b=()=>{e.node.type==="directory"&&(a.value=!a.value)},r=()=>{e.node.type==="directory"?b():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),k()},f=()=>{s("download-file",e.node),k()},E=v=>{v.preventDefault(),i.value=!0,m.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",k)},0)},k=()=>{i.value=!1,document.removeEventListener("click",k)},u=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(v){console.error("Failed to copy path:",v)}k()},_=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ke.getFileIcon(e.node),g=v=>{if(v===0)return"0 B";const R=1024,B=["B","KB","MB","GB"],G=Math.floor(Math.log(v)/Math.log(R));return parseFloat((v/Math.pow(R,G)).toFixed(1))+" "+B[G]};return Ue(()=>{document.removeEventListener("click",k)}),(v,R)=>{const B=vs("FileTreeNode",!0);return h(),y("div",fr,[n("div",{class:ue(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Je({paddingLeft:`${v.level*16+12}px`}),onClick:r,onContextmenu:ge(E,["prevent"])},[v.node.type==="directory"?(h(),y("div",{key:0,class:"expand-icon",onClick:ge(b,["stop"])},[A(p(F),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),n("div",vr,[A(p(F),{icon:_()},null,8,["icon"])]),n("span",gr,d(v.node.name),1),v.node.type==="file"?(h(),y("span",yr,d(g(v.node.size)),1)):V("",!0),l.value?(h(),y("div",br,[v.node.type==="file"?(h(),y("button",{key:0,onClick:R[0]||(R[0]=ge(G=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(p(F),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(h(),y("div",_r,[(h(!0),y(de,null,he(v.node.children,G=>(h(),ye(B,{key:G.path,node:G,level:v.level+1,onFileSelected:R[1]||(R[1]=P=>v.$emit("file-selected",P)),onDownloadFile:R[2]||(R[2]=P=>v.$emit("download-file",P))},null,8,["node","level"]))),128))])):V("",!0),i.value?(h(),y("div",{key:1,class:"context-menu",style:Je(m.value),onClick:R[3]||(R[3]=ge(()=>{},["stop"]))},[n("div",{class:"context-menu-item",onClick:c},[A(p(F),{icon:"carbon:view"}),R[4]||(R[4]=n("span",null,"Open",-1))]),v.node.type==="file"?(h(),y("div",{key:0,class:"context-menu-item",onClick:f},[A(p(F),{icon:"carbon:download"}),R[5]||(R[5]=n("span",null,"Download",-1))])):V("",!0),R[7]||(R[7]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:u},[A(p(F),{icon:"carbon:copy"}),R[6]||(R[6]=n("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),$r=Se(wr,[["__scopeId","data-v-3fc455d1"]]),Sr={class:"file-browser"},Tr={class:"file-browser-header"},Pr={class:"header-actions"},Er=["disabled","title"],kr={class:"file-browser-content"},Cr={class:"file-tree-panel"},Rr={key:0,class:"loading-state"},Ir={key:1,class:"error-state"},Ar={key:0,class:"waiting-for-files"},xr={class:"message-content"},Mr={class:"tips"},Fr=["disabled"],Dr={key:1,class:"actual-error"},Nr={key:2,class:"empty-state"},Ur={key:3,class:"file-tree"},Lr={key:0,class:"file-content-panel"},Or={class:"file-content-header"},Br={class:"file-info"},qr={class:"file-name"},Hr={class:"file-size"},Vr={class:"file-actions"},jr=["title"],zr=["title"],Wr={class:"file-content-body"},Gr={key:0,class:"loading-content"},Kr={key:1,class:"content-error"},Jr={key:2,class:"file-content"},Xr={key:0,class:"text-content"},Yr={key:1,class:"binary-content"},Qr=$e({name:"FileBrowser",__name:"index",props:{planId:{}},setup(o){const t=o,{t:e}=De(),s=x(!1),a=x(null),l=x(null),i=x(null),m=x(null),b=x(!1),r=x(null),c=x(null),f=se(()=>!m.value||!i.value?!1:Ke.isTextFile(m.value.mimeType,i.value.name)),E=se(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),k=()=>{c.value&&(clearTimeout(c.value),c.value=null)},u=()=>{k(),c.value=window.setTimeout(()=>{E.value&&_()},5e3)},_=async()=>{if(t.planId){s.value=!0,a.value=null,k();try{l.value=await Ke.getFileTree(t.planId)}catch(P){a.value=P instanceof Error?P.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",P);const I=P instanceof Error?P.message:"";(I.includes("Plan directory not found")||I.includes("not found"))&&u()}finally{s.value=!1}}},g=async P=>{if(P.type!=="directory"){i.value=P,m.value=null,b.value=!0,r.value=null;try{m.value=await Ke.getFileContent(t.planId,P.path)}catch(I){r.value=I instanceof Error?I.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",I)}finally{b.value=!1}}},v=async P=>{try{await Ke.downloadFile(t.planId,P.path,P.name)}catch(I){console.error("Failed to download file:",I)}},R=()=>{i.value=null,m.value=null,r.value=null},B=P=>Ke.getFileIcon(P),G=P=>{if(P===0)return"0 B";const I=1024,U=["B","KB","MB","GB"],M=Math.floor(Math.log(P)/Math.log(I));return parseFloat((P/Math.pow(I,M)).toFixed(1))+" "+U[M]};return fe(()=>t.planId,P=>{P&&(i.value=null,m.value=null,_())},{immediate:!0}),Me(()=>{t.planId&&_()}),Ue(()=>{k()}),(P,I)=>(h(),y("div",Sr,[n("div",Tr,[n("h3",null,d(P.$t("fileBrowser.title")),1),n("div",Pr,[n("button",{class:"refresh-btn",onClick:_,disabled:s.value,title:P.$t("fileBrowser.refresh")},[A(p(F),{icon:"carbon:refresh",class:ue({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Er)])]),n("div",kr,[n("div",Cr,[s.value?(h(),y("div",Rr,[A(p(F),{icon:"carbon:loading",class:"rotating"}),n("span",null,d(P.$t("fileBrowser.loading")),1)])):a.value?(h(),y("div",Ir,[E.value?(h(),y("div",Ar,[A(p(F),{icon:"carbon:time",class:"rotating"}),n("div",xr,[n("h3",null,d(P.$t("fileBrowser.waitingForGeneration")),1),n("p",null,d(P.$t("fileBrowser.planExecuting")),1),n("div",Mr,[A(p(F),{icon:"carbon:information"}),n("span",null,d(P.$t("fileBrowser.filesTip")),1)])]),n("button",{onClick:_,class:"retry-btn",disabled:s.value},[A(p(F),{icon:"carbon:refresh",class:ue({rotating:s.value})},null,8,["class"]),ce(" "+d(s.value?P.$t("fileBrowser.checking"):P.$t("fileBrowser.checkNow")),1)],8,Fr)])):(h(),y("div",Dr,[A(p(F),{icon:"carbon:warning"}),n("span",null,d(a.value),1),n("button",{onClick:_,class:"retry-btn"},d(P.$t("fileBrowser.retry")),1)]))])):l.value?(h(),y("div",Ur,[A($r,{node:l.value,level:0,onFileSelected:g,onDownloadFile:v},null,8,["node"])])):(h(),y("div",Nr,[A(p(F),{icon:"carbon:folder-off"}),n("span",null,d(P.$t("fileBrowser.noFiles")),1)]))]),i.value?(h(),y("div",Lr,[n("div",Or,[n("div",Br,[A(p(F),{icon:B(i.value)},null,8,["icon"]),n("span",qr,d(i.value.name),1),n("span",Hr,"("+d(G(i.value.size))+")",1)]),n("div",Vr,[n("button",{onClick:I[0]||(I[0]=U=>v(i.value)),class:"download-btn",title:P.$t("fileBrowser.download")},[A(p(F),{icon:"carbon:download"})],8,jr),n("button",{onClick:R,class:"close-btn",title:P.$t("common.close")},[A(p(F),{icon:"carbon:close"})],8,zr)])]),n("div",Wr,[b.value?(h(),y("div",Gr,[A(p(F),{icon:"carbon:loading",class:"rotating"}),n("span",null,d(P.$t("fileBrowser.loadingContent")),1)])):r.value?(h(),y("div",Kr,[A(p(F),{icon:"carbon:warning"}),n("span",null,d(r.value),1)])):m.value?(h(),y("div",Jr,[f.value?(h(),y("div",Xr,[n("pre",null,[n("code",null,d(m.value.content),1)])])):(h(),y("div",Yr,[A(p(F),{icon:"carbon:document-unknown"}),n("p",null,d(P.$t("fileBrowser.binaryFile")),1),n("button",{onClick:I[1]||(I[1]=U=>v(i.value)),class:"download-btn-large"},[A(p(F),{icon:"carbon:download"}),ce(" "+d(P.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),Zr=Se(Qr,[["__scopeId","data-v-a19b1e5b"]]),ei="/api/executor";async function Ts(o){try{const t=await fetch(`${ei}/agent-execution/${o}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,t),null}}async function ti(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Ts(o)}function si(){const o=et(),t=Ze(),e=x(null),s=x(null),a=x("details"),l=se(()=>o.rootPlanId.value),i=v=>{if(!v)return null;for(const[R,B]of t.planExecutionRecords.entries())if((B.rootPlanId||B.currentPlanId)&&B.agentExecutionSequence)for(const P of B.agentExecutionSequence){if(P.stepId===v){const I=B.rootPlanId||B.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:v,rootPlanId:I,planId:R}),I||null}if(P.subPlanExecutionRecords)for(const I of P.subPlanExecutionRecords){const U=m(I,v);if(U)return U}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",v),null},m=(v,R)=>{if(!v||!v.agentExecutionSequence)return null;for(const B of v.agentExecutionSequence){if(B.stepId===R)return v.rootPlanId||v.currentPlanId||null;if(B.subPlanExecutionRecords)for(const G of B.subPlanExecutionRecords){const P=m(G,R);if(P)return P}}return null},b=se(()=>s.value||l.value),r=se(()=>!b.value),c=async v=>{if(console.log("[useRightPanel] Step selected:",{stepId:v}),!v){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}try{const R=i(v);R?(s.value=R,console.log("[useRightPanel] Set selectedRootPlanId to:",R)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const B=await Ts(v);if(!B){console.warn("[useRightPanel] Agent execution detail not found for stepId:",v),e.value=null,s.value=null;return}const G={stepId:v,title:B.agentName??`Step ${v}`,description:B.agentDescription??"",agentExecution:B,completed:B.status==="FINISHED",current:B.status==="RUNNING"};e.value=G,console.log("[useRightPanel] Step details updated:",G),await Ie(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(R){console.error("[useRightPanel] Error fetching step details:",R),e.value=null,s.value=null}},f=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const v=await ti(e.value.stepId);v&&(e.value.agentExecution=v,e.value.completed=v.status==="FINISHED",e.value.current=v.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(v){console.error("[useRightPanel] Error refreshing step:",v)}},E=v=>{a.value=v,console.log("[useRightPanel] Active tab set to:",v)},k=v=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",v)},u=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},_=v=>{if(v===null||typeof v>"u"||v==="")return"N/A";if(typeof v=="object"&&v!==null)try{return JSON.stringify(v,null,2)}catch{return String(v)}if(typeof v=="string"){const R=v.trim();if(R==="")return"N/A";try{const B=JSON.parse(R);return JSON.stringify(B,null,2)}catch{return R}}return String(v)},g=()=>{e.value=null,s.value=null,a.value="details",console.log("[useRightPanel] State reset")};return{selectedStep:Ne(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:b,shouldShowNoTaskMessage:r,handleStepSelected:c,refreshCurrentStep:f,setActiveTab:E,updateDisplayedPlanProgress:k,clearSelectedStep:u,formatJson:_,reset:g}}let Ct=null;function oi(){return Ct||(Ct=si()),Ct}const ni={class:"right-panel"},ai={class:"preview-header"},li={class:"preview-tabs"},ri={class:"preview-content"},ii={key:0,class:"step-details"},ci={key:0,class:"step-info"},ui={key:0,class:"agent-info"},di={class:"info-item"},pi={class:"label"},mi=["title"],hi={class:"info-item"},fi={class:"label"},vi={class:"value"},gi={class:"execution-status"},yi={class:"status-item"},bi={class:"status-text"},_i={key:0},wi={key:0,class:"think-act-steps"},$i={class:"steps-container"},Si={class:"step-header"},Ti={class:"step-number"},Pi={class:"think-section"},Ei={class:"think-content"},ki={class:"input"},Ci={class:"label"},Ri={class:"output"},Ii={class:"label"},Ai={key:0,class:"action-section"},xi={class:"action-content"},Mi={class:"tool-info"},Fi={class:"label"},Di={class:"value"},Ni={class:"input"},Ui={class:"label"},Li={class:"output"},Oi={class:"label"},Bi={key:0,class:"no-tools"},qi={key:0,class:"sub-plan-section"},Hi={class:"sub-plan-content"},Vi={class:"sub-plan-header"},ji={class:"sub-plan-info"},zi={class:"label"},Wi={class:"value"},Gi={key:0,class:"sub-plan-info"},Ki={class:"label"},Ji={class:"value"},Xi={class:"sub-plan-status"},Yi={class:"status-text"},Qi={key:0,class:"no-steps-message"},Zi={key:1,class:"no-execution-message"},ec={class:"step-basic-info"},tc={class:"info-item"},sc={class:"label"},oc={class:"value"},nc={key:0,class:"info-item"},ac={class:"label"},lc={class:"value"},rc={class:"info-item"},ic={class:"label"},cc={class:"no-execution-hint"},uc={key:2,class:"execution-indicator"},dc={class:"execution-text"},pc={key:1,class:"no-selection"},mc=["title"],hc={key:1,class:"file-browser-container"},fc={key:1,class:"no-plan-message"},vc={class:"message-content"},gc={class:"tips"},yc=$e({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:t}){const e=o,{t:s}=De(),a=oi(),l=x(),i=x(!1),m=x(!0),b=x(!0),r=se(()=>a.selectedStep.value),c=se({get:()=>a.activeTab.value,set:M=>a.setActiveTab(M)}),f=se(()=>a.fileBrowserPlanId.value),E=se(()=>a.shouldShowNoTaskMessage.value),k=se(()=>r.value?r.value.completed?s("rightPanel.status.completed"):r.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),u=async M=>{await a.handleStepSelected(M),setTimeout(()=>{v()},100),B()},_=async()=>{await a.refreshCurrentStep(),B()};fe(()=>e.selectedStepId,async M=>{M?await u(M):a.clearSelectedStep()},{immediate:!0});const g=M=>{l.value=M??void 0},v=()=>{if(!l.value)return;const{scrollTop:M,scrollHeight:H,clientHeight:$}=l.value,T=H-M-$<50,w=H>$;m.value=T,i.value=w&&!T,T?b.value=!0:H-M-$>100&&(b.value=!1)},R=()=>{l.value&&(l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"}),Ie(()=>{b.value=!0,v()}))},B=()=>{!b.value||!l.value||Ie(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},G=a.formatJson,P=()=>{b.value=!0,l.value&&l.value.removeEventListener("scroll",v)},I=()=>{const M=()=>{const H=l.value;return H?(g(H),H.addEventListener("scroll",v),b.value=!0,v(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ie(()=>{M()||setTimeout(()=>{M()},100)})};return Me(()=>{console.log("[RightPanel] Component mounted"),Ie(()=>{I()})}),Ue(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),P()}),t({handleStepSelected:u,refreshCurrentStep:_,updateDisplayedPlanProgress:M=>{a.updateDisplayedPlanProgress(M)}}),(M,H)=>(h(),y("div",ni,[n("div",ai,[n("div",li,[n("div",{class:ue(["tab-item",{active:c.value==="details"}]),onClick:H[0]||(H[0]=$=>c.value="details")},[A(p(F),{icon:"carbon:events"}),n("span",null,d(p(s)("rightPanel.stepExecutionDetails")),1)],2),n("div",{class:ue(["tab-item",{active:c.value==="files"}]),onClick:H[1]||(H[1]=$=>c.value="files")},[A(p(F),{icon:"carbon:folder"}),n("span",null,d(p(s)("fileBrowser.title")),1)],2)])]),n("div",ri,[c.value==="details"?(h(),y("div",ii,[r.value?(h(),y("div",ci,[n("h3",null,d(r.value.title||r.value.description||p(s)("rightPanel.defaultStepTitle",{number:1})),1),r.value.agentExecution?(h(),y("div",ui,[n("div",di,[n("span",pi,d(p(s)("rightPanel.executingAgent"))+":",1),n("span",{class:"value",title:r.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.clickToViewExecutionDetails"):""},d(r.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.funcAgentExecutionDetails"):r.value.agentExecution.agentName),9,mi)]),n("div",hi,[n("span",fi,d(p(s)("rightPanel.callingModel"))+":",1),n("span",vi,d(r.value.agentExecution.modelName),1)])])):V("",!0),n("div",gi,[n("div",yi,[r.value.completed?(h(),ye(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):r.value.current?(h(),ye(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),ye(p(F),{key:2,icon:"carbon:time",class:"status-icon pending"})),n("span",bi,d(k.value),1)])])])):V("",!0),n("div",{ref_key:"scrollContainer",ref:l,class:"step-details-scroll-container",onScroll:v},[r.value?(h(),y("div",_i,[r.value.agentExecution?.thinkActSteps&&r.value.agentExecution.thinkActSteps.length>0?(h(),y("div",wi,[n("h4",null,d(p(s)("rightPanel.thinkAndActionSteps")),1),n("div",$i,[(h(!0),y(de,null,he(r.value.agentExecution.thinkActSteps,($,T)=>(h(),y("div",{key:T,class:"think-act-step"},[n("div",Si,[n("span",Ti,"#"+d(T+1),1),n("span",{class:ue(["step-status",$.status])},d($.status||p(s)("rightPanel.executing")),3)]),n("div",Pi,[n("h5",null,[A(p(F),{icon:"carbon:thinking"}),ce(" "+d(p(s)("rightPanel.thinking")),1)]),n("div",Ei,[n("div",ki,[n("span",Ci,d(p(s)("rightPanel.input"))+":",1),n("pre",null,d(p(G)($.thinkInput)),1)]),n("div",Ri,[n("span",Ii,d(p(s)("rightPanel.output"))+":",1),n("pre",null,d(p(G)($.thinkOutput)),1)])])]),$.actionNeeded?(h(),y("div",Ai,[n("h5",null,[A(p(F),{icon:"carbon:play"}),ce(" "+d(p(s)("rightPanel.action")),1)]),n("div",xi,[(h(!0),y(de,null,he($.actToolInfoList||[],(w,D)=>(h(),y("div",{key:`tool-${D}-${w?.id||w?.name||D}`,class:"tool-execution-item"},[n("div",Mi,[n("span",Fi,d(p(s)("rightPanel.tool"))+":",1),n("span",Di,d(w?.name||"N/A"),1)]),n("div",Ni,[n("span",Ui,d(p(s)("rightPanel.toolParameters"))+":",1),n("pre",null,d(p(G)(w?.parameters)),1)]),n("div",Li,[n("span",Oi,d(p(s)("rightPanel.executionResult"))+":",1),n("pre",null,d(p(G)(w?.result)),1)])]))),128)),!$.actToolInfoList||$.actToolInfoList.length===0?(h(),y("div",Bi,[n("p",null,d(p(s)("rightPanel.noToolsExecuted")),1)])):V("",!0)]),$.subPlanExecutionRecord?(h(),y("div",qi,[n("h5",null,[A(p(F),{icon:"carbon:tree-view"}),ce(" "+d(p(s)("rightPanel.subPlan")),1)]),n("div",Hi,[n("div",Vi,[n("div",ji,[n("span",zi,d(M.$t("rightPanel.subPlanId"))+":",1),n("span",Wi,d($.subPlanExecutionRecord.currentPlanId),1)]),$.subPlanExecutionRecord.title?(h(),y("div",Gi,[n("span",Ki,d(M.$t("rightPanel.title"))+":",1),n("span",Ji,d($.subPlanExecutionRecord.title),1)])):V("",!0),n("div",Xi,[$.subPlanExecutionRecord.completed?(h(),ye(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),ye(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),n("span",Yi,d($.subPlanExecutionRecord.completed?M.$t("rightPanel.status.completed"):M.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),r.value.agentExecution&&!r.value.agentExecution.thinkActSteps?.length?(h(),y("div",Qi,[n("p",null,d(p(s)("rightPanel.noStepDetails")),1)])):r.value.agentExecution?V("",!0):(h(),y("div",Zi,[A(p(F),{icon:"carbon:information",class:"info-icon"}),n("h4",null,d(p(s)("rightPanel.stepInfo")),1),n("div",ec,[n("div",tc,[n("span",sc,d(p(s)("rightPanel.stepName"))+":",1),n("span",oc,d(r.value.title||r.value.description||r.value.stepId),1)]),r.value.description?(h(),y("div",nc,[n("span",ac,d(M.$t("rightPanel.description"))+":",1),n("span",lc,d(r.value.description),1)])):V("",!0),n("div",rc,[n("span",ic,d(M.$t("rightPanel.status.label"))+":",1),n("span",{class:ue(["value",{"status-completed":r.value.completed,"status-current":r.value.current,"status-pending":!r.value.completed&&!r.value.current}])},d(r.value.completed?M.$t("rightPanel.status.completed"):r.value.current?M.$t("rightPanel.status.executing"):M.$t("rightPanel.status.pending")),3)])]),n("p",cc,d(p(s)("rightPanel.noExecutionInfo")),1)])),r.value.current&&!r.value.completed?(h(),y("div",uc,[H[2]||(H[2]=n("div",{class:"execution-waves"},[n("div",{class:"wave wave-1"}),n("div",{class:"wave wave-2"}),n("div",{class:"wave wave-3"})],-1)),n("p",dc,[A(p(F),{icon:"carbon:in-progress",class:"rotating-icon"}),ce(" "+d(p(s)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(h(),y("div",pc,[A(p(F),{icon:"carbon:events",class:"empty-icon"}),n("h3",null,d(p(s)("rightPanel.noStepSelected")),1),n("p",null,d(p(s)("rightPanel.selectStepHint")),1)]))])):V("",!0),A(qt,{name:"scroll-button"},{default:Xe(()=>[i.value?(h(),y("button",{key:0,onClick:R,class:"scroll-to-bottom-btn",title:p(s)("rightPanel.scrollToBottom")},[A(p(F),{icon:"carbon:chevron-down"})],8,mc)):V("",!0)]),_:1})],544)])):V("",!0),c.value==="files"?(h(),y("div",hc,[f.value?(h(),ye(Zr,{key:0,"plan-id":f.value},null,8,["plan-id"])):E.value?(h(),y("div",fc,[A(p(F),{icon:"carbon:folder-off"}),n("div",vc,[n("h3",null,d(p(s)("fileBrowser.noFilesYet")),1),n("p",null,d(p(s)("fileBrowser.noPlanExecuting")),1),n("div",gc,[A(p(F),{icon:"carbon:information"}),n("span",null,d(p(s)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])]))}}),bc=Se(yc,[["__scopeId","data-v-139a2d37"]]);class Ps{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function _c(){const o=x([]),t=x(!1),e=x(null);return{availableTools:o,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await Ps.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),o.value=l.filter(i=>i.selectable!==!1).map(i=>({key:i.key||"",name:i.name||"",description:i.description||"",enabled:i.enabled||!1,serviceGroup:i.serviceGroup||"default",selectable:i.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",o.value=[]}finally{t.value=!1}}},reset:()=>{o.value=[],t.value=!1,e.value=null}}}let Rt=null;function at(){return Rt||(Rt=_c()),Rt}class Es{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}const wc={class:"modal-form wide-modal"},$c={class:"form-section"},Sc={class:"form-item"},Tc=["placeholder"],Pc={class:"field-description"},Ec={class:"form-section"},kc={class:"section-title"},Cc={key:0,class:"params-help-text"},Rc={class:"parameter-table"},Ic=["onUpdate:modelValue","placeholder","readonly"],Ac=["onUpdate:modelValue","placeholder"],xc={class:"form-section"},Mc={class:"service-publish-options"},Fc={class:"internal-toolcall-publish-option"},Dc={class:"checkbox-label"},Nc={class:"checkbox-text"},Uc={class:"checkbox-description"},Lc={class:"http-publish-option"},Oc={class:"checkbox-label"},Bc={class:"checkbox-text"},qc={class:"checkbox-description"},Hc={class:"button-container"},Vc=["disabled"],jc=["disabled"],zc=$e({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(o,{expose:t,emit:e}){const{t:s}=De(),a=Qe(),l=at(),i=o,m=e,b=se({get:()=>i.modelValue,set:w=>m("update:modelValue",w)}),r=x(""),c=x(""),f=x(!1),E=x(!1),k=x(!1),u=x(!0),_=x({parameters:[],hasParameters:!1,requirements:""}),g=x(!1),v=Ve({userRequest:"",parameters:[]}),R=se(()=>{const w=!!a.selectedTemplate.value?.toolConfig;return s(w?"mcpService.updateService":"mcpService.createService")}),B=se(()=>!!a.selectedTemplate.value?.toolConfig),G=()=>{const w=a.selectedTemplate.value?.toolConfig;w?(v.userRequest=w.toolDescription||"",k.value=w.enableHttpService??!1,u.value=w.enableInternalToolcall??!0,w.inputSchema&&Array.isArray(w.inputSchema)&&w.inputSchema.length>0?v.parameters=w.inputSchema.map(D=>({name:D.name||"",description:D.description||""})):_.value.hasParameters||(v.parameters=[])):(v.userRequest="",k.value=!1,u.value=!0,_.value.hasParameters||(v.parameters=[]))},P=async()=>{const w=a.currentPlanTemplateId.value;if(!w){_.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[];return}g.value=!0;try{const D=await Es.getParameterRequirements(w);if(_.value=D,console.log("[PublishModal] Parameter requirements loaded:",D),D.hasParameters){const j=new Map;v.parameters.forEach(J=>{J.name&&j.set(J.name,J.description||"")}),v.parameters=D.parameters.map(J=>({name:J,description:j.get(J)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",v.parameters)}else v.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(D){console.error("[PublishModal] Failed to load parameter requirements:",D),D instanceof Error&&!D.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),_.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[]}finally{g.value=!1}},I=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",_.value.parameters),console.log("[PublishModal] Form parameters:",v.parameters);const w=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",w);const D=new Map;if(w.forEach(j=>{j.name&&D.set(j.name,j.description||"")}),_.value.hasParameters){const j=_.value.parameters.map(J=>{const be=v.parameters.find(_e=>_e.name===J)?.description||""||D.get(J)||"";return{name:J,description:be}});return console.log("[PublishModal] Merged parameters (from plan template):",j),j}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},U=(w,D)=>{D==="success"?(c.value=w,setTimeout(()=>{c.value=""},3e3)):D==="error"&&(r.value=w,setTimeout(()=>{r.value=""},5e3))},M=()=>{if(!v.userRequest.trim())return U(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return U(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return U(s("mcpService.toolNameRequiredError"),"error"),!1;if(!u.value&&!k.value)return U("Please select at least one service type","error"),!1;for(let j=0;j<v.parameters.length;j++){const J=v.parameters[j];if(J.name&&!J.description.trim())return U(`Parameter "${J.name}" description cannot be empty`,"error"),!1;if(J.description&&!J.name.trim())return U(`Parameter description "${J.description}" corresponding name cannot be empty`,"error"),!1}return!0},H=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",v),console.log("[PublishModal] Publish as HTTP service:",k.value),!M()){console.log("[PublishModal] Form validation failed");return}f.value=!0;try{const w=I();console.log("[PublishModal] Merged parameters:",w);const D=w.filter(le=>le.name.trim()).map(le=>({name:le.name.trim(),description:le.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(v.userRequest.trim()),a.setEnableInternalToolcallWithGuard(u.value),a.setEnableHttpServiceWithGuard(k.value),a.setInputSchemaWithGuard(D),!await a.save())throw new Error("Failed to save plan template");const J=[];u.value&&J.push("Internal Method Call"),k.value&&J.push("HTTP Service"),J.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",J.join(", ")),U(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),m("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),U(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),m("published",null))}catch(w){console.error("[PublishModal] Failed to publish service:",w);const D=w instanceof Error?w.message:"Unknown error";U(s("mcpService.publishFailed")+": "+D,"error")}finally{f.value=!1}},$=async()=>{if(E.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const w=a.currentPlanTemplateId.value;if(!w){U(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",w),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),U(s("mcpService.deleteSuccess"),"success"),b.value=!1,m("published",null)}catch(D){console.error("[PublishModal] Failed to delete tool config:",D);const j=D instanceof Error?D.message:"Unknown error";U(s("mcpService.deleteFailed")+": "+j,"error")}finally{E.value=!1}};return fe(()=>i.modelValue,async()=>{b.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),G(),await P())}),fe(()=>a.currentPlanTemplateId.value,(w,D)=>{w&&w!==D&&(D&&w.startsWith("planTemplate-")?setTimeout(()=>{P()},1e3):P())}),Me(async()=>{b.value&&(console.log("[PublishModal] Initialize when component mounted"),G(),await P())}),t({loadParameterRequirements:P}),(w,D)=>(h(),y(de,null,[A(bs,{modelValue:b.value,"onUpdate:modelValue":D[3]||(D[3]=j=>b.value=j),title:R.value,onConfirm:H},{footer:Xe(()=>[n("div",Hc,[B.value?(h(),y("button",{key:0,class:"action-btn danger",onClick:$,disabled:E.value},[E.value?(h(),ye(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ye(p(F),{key:1,icon:"carbon:trash-can"})),ce(" "+d(E.value?p(s)("mcpService.deleting"):p(s)("mcpService.delete")),1)],8,Vc)):V("",!0),n("button",{class:"action-btn primary",onClick:H,disabled:f.value},[f.value?(h(),ye(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ye(p(F),{key:1,icon:"carbon:cloud-upload"})),ce(" "+d(f.value?p(s)("mcpService.publishing"):p(s)("mcpService.publishAsService")),1)],8,jc)])]),default:Xe(()=>[n("div",wc,[n("div",$c,[n("div",Sc,[n("label",null,d(p(s)("mcpService.toolDescriptionRequired")),1),ve(n("textarea",{"onUpdate:modelValue":D[0]||(D[0]=j=>v.userRequest=j),placeholder:p(s)("mcpService.toolDescriptionPlaceholder"),class:ue([{error:!v.userRequest||!v.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Tc),[[Te,v.userRequest]]),n("div",Pc,d(p(s)("mcpService.toolDescriptionDescription")),1)])]),n("div",Ec,[n("div",kc,d(p(s)("mcpService.parameterConfig")),1),_.value.hasParameters?(h(),y("div",Cc,d(p(s)("sidebar.parameterRequirementsHelp")),1)):V("",!0),n("div",Rc,[n("table",null,[n("thead",null,[n("tr",null,[n("th",null,d(p(s)("mcpService.parameterName")),1),n("th",null,d(p(s)("mcpService.parameterDescription")),1)])]),n("tbody",null,[(h(!0),y(de,null,he(v.parameters,(j,J)=>(h(),y("tr",{key:J},[n("td",null,[ve(n("input",{type:"text","onUpdate:modelValue":le=>j.name=le,placeholder:p(s)("mcpService.parameterName"),class:ue(["parameter-input",{"readonly-input":_.value.hasParameters}]),readonly:_.value.hasParameters,required:""},null,10,Ic),[[Te,j.name]])]),n("td",null,[ve(n("input",{type:"text","onUpdate:modelValue":le=>j.description=le,placeholder:p(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Ac),[[Te,j.description]])])]))),128))])])])]),n("div",xc,[n("div",Mc,[n("div",Fc,[n("label",Dc,[ve(n("input",{type:"checkbox","onUpdate:modelValue":D[1]||(D[1]=j=>u.value=j),class:"checkbox-input"},null,512),[[Ft,u.value]]),n("span",Nc,d(p(s)("mcpService.publishAsInternalToolcall")),1)]),n("div",Uc,d(p(s)("mcpService.publishAsInternalToolcallDescription")),1)]),n("div",Lc,[n("label",Oc,[ve(n("input",{type:"checkbox","onUpdate:modelValue":D[2]||(D[2]=j=>k.value=j),class:"checkbox-input"},null,512),[[Ft,k.value]]),n("span",Bc,d(p(s)("mcpService.publishAsHttpService")),1)]),n("div",qc,d(p(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),r.value?(h(),y("div",{key:0,class:"error-toast",onClick:D[4]||(D[4]=j=>r.value="")},[A(p(F),{icon:"carbon:error"}),ce(" "+d(r.value),1)])):V("",!0),c.value?(h(),y("div",{key:1,class:"success-toast",onClick:D[5]||(D[5]=j=>c.value="")},[A(p(F),{icon:"carbon:checkmark"}),ce(" "+d(c.value),1)])):V("",!0)],64))}}),Wc=Se(zc,[["__scopeId","data-v-235a4588"]]),Gc={class:"modal-header"},Kc={class:"modal-body"},Jc={class:"modal-footer"},Xc=["disabled"],Yc=$e({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(o,{emit:t}){const e=t,s=x(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},i=()=>{e("continue"),e("update:modelValue",!1)};return(m,b)=>m.modelValue?(h(),y("div",{key:0,class:"modal-overlay",onClick:a},[n("div",{class:"modal-content",onClick:b[0]||(b[0]=ge(()=>{},["stop"]))},[n("div",Gc,[n("h3",null,d(m.$t("sidebar.saveConfirmationTitle")),1),n("button",{class:"close-btn",onClick:a},[A(p(F),{icon:"carbon:close",width:"16"})])]),n("div",Kc,[n("p",null,d(m.$t("sidebar.saveConfirmationMessage")),1)]),n("div",Jc,[n("button",{class:"btn btn-secondary",onClick:a},d(m.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),ye(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ce(" "+d(s.value?m.$t("sidebar.saving"):m.$t("common.save")),1)],8,Xc),n("button",{class:"btn btn-danger",onClick:i},d(m.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),Qc=Se(Yc,[["__scopeId","data-v-4817656d"]]),Zc={class:"config-section"},eu={class:"section-header"},tu={class:"execution-content"},su={class:"params-requirements-group"},ou={class:"params-help-text"},nu={key:0,class:"parameter-fields"},au={class:"parameter-label"},lu=["onUpdate:modelValue","placeholder","onInput"],ru={key:0,class:"parameter-error"},iu={key:1,class:"validation-message"},cu=["disabled"],uu=["disabled"],du={key:1,class:"call-example-wrapper"},pu={class:"call-example-header"},mu={class:"call-example-title"},hu={class:"call-example-description"},fu={class:"internal-call-wrapper"},vu={class:"call-info"},gu={class:"call-method"},yu={class:"call-endpoint"},bu={key:0,class:"call-endpoint"},_u={class:"call-description"},wu={class:"call-example"},$u={class:"example-code"},Su={key:2,class:"call-example-wrapper"},Tu={class:"call-example-header"},Pu={class:"call-example-title"},Eu={class:"call-example-description"},ku={class:"http-api-urls-wrapper"},Cu={class:"tab-container"},Ru={class:"tab-header"},Iu=["onClick"],Au={class:"tab-content"},xu={class:"http-api-url-display"},Mu={class:"api-method"},Fu={class:"api-endpoint"},Du={class:"api-description"},Nu={key:0,class:"api-example"},Uu={class:"example-code"},Lu={key:3,class:"call-example-wrapper"},Ou={class:"call-example-header"},Bu={class:"call-example-title"},qu={class:"call-example-description"},Hu={class:"mcp-call-wrapper"},Vu={class:"call-info"},ju={class:"call-method"},zu={class:"call-endpoint"},Wu={class:"call-description"},Gu={class:"call-example"},Ku={class:"example-code"},Ju=$e({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=De(),s=_s(),a=Qe(),l=et(),i=Ze(),m=o,b=x(""),r=x(!1),c=x({parameters:[],hasParameters:!1,requirements:""}),f=x({}),E=x(!1),k=x("get-sync"),u=x({}),_=x(!1),g=x(!1),v=se(()=>a.getCoordinatorToolConfig()),R=x(),B=x([]),G=x(null),P=x(!1),I=x(null),U=x([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),M=se(()=>{const N=a.selectedTemplate.value?.toolConfig;return N?.enableInternalToolcall??N?.enableHttpService??N?.enableMcpService??!1}),H=se(()=>M.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),$=se(()=>l.isLoading.value),T=se(()=>{if($.value||m.isExecuting||g.value)return!1;const N=i.trackedPlanIds.value.size>0,ee=Array.from(i.planExecutionRecords.entries()).some(([,O])=>O&&!O.completed&&O.status!=="failed");return N||ee?!1:c.value.hasParameters?c.value.parameters.every(O=>{const Z=f.value[O];return typeof Z=="string"&&Z.trim()!==""}):!0}),w=(N,Q)=>{B.value=N.map(ee=>ee.originalName),G.value=Q,console.log("[ExecutionController] Files uploaded:",N.length,"uploadKey:",Q)},D=N=>{B.value=N.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",N.length)},j=N=>{G.value=N,console.log("[ExecutionController] Upload key changed:",N)},J=()=>{console.log("[ExecutionController] Upload started")},le=()=>{console.log("[ExecutionController] Upload completed")},Fe=N=>{console.error("[ExecutionController] Upload error:",N)},be=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),m.isExecuting||l.isLoading.value||g.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",m.isExecuting,l.isLoading.value,g.value),s.error(e("sidebar.executionInProgress"));return}if(ae.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!ie()){console.log("[ExecutionController] âŒ Parameter validation failed:",u.value);return}const N=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;I.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:N,uploadedFiles:B.value,uploadKey:G.value},P.value=!0;return}await _e()},_e=async()=>{if(m.isExecuting||l.isLoading.value||g.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(g.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!ie()){console.log("[ExecutionController] âŒ Parameter validation failed:",u.value),g.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),g.value=!1;return}const N=a.getConfig(),Q=a.selectedTemplate.value.planTemplateId||N.planTemplateId,ee={title:N.title||a.selectedTemplate.value.title||"Execution Plan",steps:(N.steps||[]).map(Ce=>({stepRequirement:Ce.stepRequirement||"",agentName:Ce.agentName||"",modelName:Ce.modelName||null,selectedToolKeys:[],terminateColumns:Ce.terminateColumns||"",stepContent:""})),directResponse:N.directResponse||!1,...Q&&{planTemplateId:Q},...N.planType&&{planType:N.planType}},O=a.selectedTemplate.value.title??N.title??"Execution Plan",Z=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",Z),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(ee,null,2));const Y={title:O,planData:ee,params:void 0,replacementParams:Z,uploadedFiles:B.value,uploadKey:G.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(Y,null,2));const pe=await l.executePlan(Y);pe.success?console.log("[ExecutionController] âœ… Plan execution started successfully:",pe.planId):(console.error("[ExecutionController] âŒ Plan execution failed:",pe.error),s.error(pe.error||e("sidebar.executeFailed")))}catch(N){console.error("[ExecutionController] âŒ Error executing plan:",N);const Q=N instanceof Error?N.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+Q),g.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),q(),console.log("[ExecutionController] âœ… Cleanup completed")}},Be=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const N=a.validate();if(!N.isValid){s.error(`Invalid format, please correct and save.
Errors: `+N.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const O=a.generateJsonString().trim();a.updateVersionsAfterSave(O);const Z=a.planVersions.value.length;ae.hasTaskRequirementModified=!1,await new Promise(Y=>setTimeout(Y,500)),await z(),await ae.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:Z})),await new Promise(Y=>setTimeout(Y,500)),I.value&&(await _e(),I.value=null)}catch(N){console.error("[ExecutionController] âŒ Failed to save before execute:",N);const Q=N instanceof Error?N.message:e("sidebar.saveFailed");throw s.error(Q),N}},Ee=async()=>{console.log("[ExecutionController] â© Continue without save requested"),I.value&&(await _e(),I.value=null)},L=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}r.value=!0},q=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),b.value="",f.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},z=async()=>{await new Promise(N=>setTimeout(N,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(N=>N.stepRequirement).join(" ||| ")),await new Promise(N=>setTimeout(N,200)),await X()},X=async()=>{const N=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",N),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!N){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const Q=await Es.getParameterRequirements(N);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(Q,null,2)),c.value=Q;const ee={};Q.parameters.forEach(O=>{ee[O]=f.value[O]||""}),f.value=ee,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(f.value,null,2)),re()}catch(Q){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",Q),Q instanceof Error&&!Q.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(f.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},te=(N,Q)=>{f.value[N]=Q,u.value[N]&&delete u.value[N],re()},ie=()=>{if(u.value={},_.value=!1,!c.value.hasParameters)return!0;let N=!1;return c.value.parameters.forEach(Q=>{(f.value[Q]?f.value[Q].trim():"")||(u.value[Q]=`${Q} is required`,N=!0)}),_.value=N,!N},re=()=>{c.value.hasParameters?b.value=JSON.stringify(f.value,null,2):b.value=""};return fe(()=>a.currentPlanTemplateId.value,(N,Q)=>{if(N&&N!==Q){if(g.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),Q&&N.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),X()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),X())}}),fe(()=>ae.hasTaskRequirementModified,async(N,Q)=>{if(Q===!0&&N===!1&&a.currentPlanTemplateId.value){if(g.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(ee=>setTimeout(ee,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await z()}}),ys(()=>{const N=i.planExecutionRecords,Q=Array.from(N.entries()),ee=i.trackedPlanIds.value.size>0,O=Q.some(([,Y])=>Y&&!Y.completed&&Y.status!=="failed");!(ee||O)&&g.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:ee,hasRunningPlansInRecords:O,trackedPlanIds:Array.from(i.trackedPlanIds.value),recordsCount:Q.length}),g.value=!1)}),Me(()=>{X()}),t({executionParams:b,clearExecutionParams:q,loadParameterRequirements:X,refreshParameterRequirements:z,fileUploadRef:R,uploadedFiles:B,uploadKey:G}),(N,Q)=>(h(),y(de,null,[n("div",Zc,[n("div",eu,[A(p(F),{icon:"carbon:play",width:"16"}),n("span",null,d(p(e)("sidebar.executionController")),1)]),n("div",tu,[n("div",su,[n("label",null,d(p(e)("sidebar.parameterRequirements")),1),n("div",ou,d(p(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),y("div",nu,[(h(!0),y(de,null,he(c.value.parameters,ee=>(h(),y("div",{key:ee,class:"parameter-field"},[n("label",au,[ce(d(ee)+" ",1),Q[2]||(Q[2]=n("span",{class:"required"},"*",-1))]),ve(n("input",{"onUpdate:modelValue":O=>f.value[ee]=O,class:ue(["parameter-input",{error:u.value[ee]}]),placeholder:p(e)("sidebar.enterValueFor",{param:ee}),onInput:O=>te(ee,O.target.value),required:""},null,42,lu),[[Te,f.value[ee]]]),u.value[ee]?(h(),y("div",ru,d(u.value[ee]),1)):V("",!0)]))),128))])):V("",!0),c.value.hasParameters&&!T.value&&!m.isExecuting?(h(),y("div",iu,[A(p(F),{icon:"carbon:warning",width:"14"}),ce(" "+d(p(e)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),A(Ss,{ref_key:"fileUploadRef",ref:R,disabled:m.isExecuting,onFilesUploaded:w,onFilesRemoved:D,onUploadKeyChanged:j,onUploadStarted:J,onUploadCompleted:le,onUploadError:Fe},null,8,["disabled"]),n("button",{class:"btn btn-primary execute-btn",onClick:be,disabled:!T.value},[A(p(F),{icon:m.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ue({spinning:m.isExecuting})},null,8,["icon","class"]),ce(" "+d(m.isExecuting?p(e)("sidebar.executing"):p(e)("sidebar.executePlan")),1)],8,cu),v.value?(h(),y("button",{key:0,class:"btn publish-mcp-btn",onClick:L,disabled:!p(a).currentPlanTemplateId.value},[A(p(F),{icon:"carbon:application",width:"16"}),ce(" "+d(H.value),1)],8,uu)):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),y("div",du,[n("div",pu,[n("h4",mu,d(p(e)("sidebar.internalCall")),1),n("p",hu,d(p(e)("sidebar.internalCallDescription")),1)]),n("div",fu,[n("div",vu,[n("div",gu,d(p(e)("sidebar.internalMethodCall")),1),n("div",yu,d(p(e)("sidebar.toolName"))+": "+d(p(a).selectedTemplate.value?.title||p(a).currentPlanTemplateId.value||""),1),p(a).selectedTemplate.value?.serviceGroup?(h(),y("div",bu,d(p(e)("sidebar.serviceGroup"))+": "+d(p(a).selectedTemplate.value.serviceGroup),1)):V("",!0),n("div",_u,d(p(e)("sidebar.internalCallUsage")),1),n("div",wu,[n("strong",null,d(p(e)("sidebar.usage"))+":",1),n("pre",$u,d(p(e)("sidebar.internalCallExample")),1)])])])])):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),y("div",Su,[n("div",Tu,[n("h4",Pu,d(p(e)("sidebar.httpCallExample")),1),n("p",Eu,d(p(e)("sidebar.httpCallDescription")),1)]),n("div",ku,[n("div",Cu,[n("div",Ru,[(h(!0),y(de,null,he(U.value,ee=>(h(),y("button",{key:ee.id,class:ue(["tab-button",{active:k.value===ee.id}]),onClick:O=>k.value=ee.id},d(ee.label),11,Iu))),128))]),n("div",Au,[(h(!0),y(de,null,he(U.value,ee=>ve((h(),y("div",{key:ee.id,class:"tab-panel"},[n("div",xu,[n("div",Mu,d(ee.method),1),n("div",Fu,d(ee.endpoint),1),n("div",Du,d(ee.description),1),ee.example?(h(),y("div",Nu,[n("strong",null,d(p(e)("sidebar.example"))+":",1),n("pre",Uu,d(ee.example),1)])):V("",!0)])])),[[po,k.value===ee.id]])),128))])])])])):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),y("div",Lu,[n("div",Ou,[n("h4",Bu,d(p(e)("sidebar.mcpCall")),1),n("p",qu,d(p(e)("sidebar.mcpCallDescription")),1)]),n("div",Hu,[n("div",Vu,[n("div",ju,d(p(e)("sidebar.mcpServiceCall")),1),n("div",zu,d(p(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),n("div",Wu,d(p(e)("sidebar.mcpCallUsage")),1),n("div",Gu,[n("strong",null,d(p(e)("sidebar.usage"))+":",1),n("pre",Ku,d(p(e)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])]),A(Qc,{modelValue:P.value,"onUpdate:modelValue":Q[0]||(Q[0]=ee=>P.value=ee),onSave:Be,onContinue:Ee},null,8,["modelValue"]),A(Wc,{modelValue:r.value,"onUpdate:modelValue":Q[1]||(Q[1]=ee=>r.value=ee)},null,8,["modelValue"])],64))}}),Xu=Se(Ju,[["__scopeId","data-v-8e9b3e6f"]]);function ks(o,t){return function(){return o.apply(t,arguments)}}const{toString:Yu}=Object.prototype,{getPrototypeOf:Ht}=Object,{iterator:wt,toStringTag:Cs}=Symbol,$t=(o=>t=>{const e=Yu.call(t);return o[e]||(o[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Le=o=>(o=o.toLowerCase(),t=>$t(t)===o),St=o=>t=>typeof t===o,{isArray:tt}=Array,Ye=St("undefined");function lt(o){return o!==null&&!Ye(o)&&o.constructor!==null&&!Ye(o.constructor)&&Ae(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const Rs=Le("ArrayBuffer");function Qu(o){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(o):t=o&&o.buffer&&Rs(o.buffer),t}const Zu=St("string"),Ae=St("function"),Is=St("number"),rt=o=>o!==null&&typeof o=="object",ed=o=>o===!0||o===!1,vt=o=>{if($t(o)!=="object")return!1;const t=Ht(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Cs in o)&&!(wt in o)},td=o=>{if(!rt(o)||lt(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},sd=Le("Date"),od=Le("File"),nd=Le("Blob"),ad=Le("FileList"),ld=o=>rt(o)&&Ae(o.pipe),rd=o=>{let t;return o&&(typeof FormData=="function"&&o instanceof FormData||Ae(o.append)&&((t=$t(o))==="formdata"||t==="object"&&Ae(o.toString)&&o.toString()==="[object FormData]"))},id=Le("URLSearchParams"),[cd,ud,dd,pd]=["ReadableStream","Request","Response","Headers"].map(Le),md=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(o,t,{allOwnKeys:e=!1}={}){if(o===null||typeof o>"u")return;let s,a;if(typeof o!="object"&&(o=[o]),tt(o))for(s=0,a=o.length;s<a;s++)t.call(null,o[s],s,o);else{if(lt(o))return;const l=e?Object.getOwnPropertyNames(o):Object.keys(o),i=l.length;let m;for(s=0;s<i;s++)m=l[s],t.call(null,o[m],m,o)}}function As(o,t){if(lt(o))return null;t=t.toLowerCase();const e=Object.keys(o);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const je=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xs=o=>!Ye(o)&&o!==je;function Nt(){const{caseless:o,skipUndefined:t}=xs(this)&&this||{},e={},s=(a,l)=>{const i=o&&As(e,l)||l;vt(e[i])&&vt(a)?e[i]=Nt(e[i],a):vt(a)?e[i]=Nt({},a):tt(a)?e[i]=a.slice():(!t||!Ye(a))&&(e[i]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const hd=(o,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&Ae(a)?o[l]=ks(a,e):o[l]=a},{allOwnKeys:s}),o),fd=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),vd=(o,t,e,s)=>{o.prototype=Object.create(t.prototype,s),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:t.prototype}),e&&Object.assign(o.prototype,e)},gd=(o,t,e,s)=>{let a,l,i;const m={};if(t=t||{},o==null)return t;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)i=a[l],(!s||s(i,o,t))&&!m[i]&&(t[i]=o[i],m[i]=!0);o=e!==!1&&Ht(o)}while(o&&(!e||e(o,t))&&o!==Object.prototype);return t},yd=(o,t,e)=>{o=String(o),(e===void 0||e>o.length)&&(e=o.length),e-=t.length;const s=o.indexOf(t,e);return s!==-1&&s===e},bd=o=>{if(!o)return null;if(tt(o))return o;let t=o.length;if(!Is(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=o[t];return e},_d=(o=>t=>o&&t instanceof o)(typeof Uint8Array<"u"&&Ht(Uint8Array)),wd=(o,t)=>{const s=(o&&o[wt]).call(o);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(o,l[0],l[1])}},$d=(o,t)=>{let e;const s=[];for(;(e=o.exec(t))!==null;)s.push(e);return s},Sd=Le("HTMLFormElement"),Td=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),es=(({hasOwnProperty:o})=>(t,e)=>o.call(t,e))(Object.prototype),Pd=Le("RegExp"),Ms=(o,t)=>{const e=Object.getOwnPropertyDescriptors(o),s={};it(e,(a,l)=>{let i;(i=t(a,l,o))!==!1&&(s[l]=i||a)}),Object.defineProperties(o,s)},Ed=o=>{Ms(o,(t,e)=>{if(Ae(o)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=o[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},kd=(o,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return tt(o)?s(o):s(String(o).split(t)),e},Cd=()=>{},Rd=(o,t)=>o!=null&&Number.isFinite(o=+o)?o:t;function Id(o){return!!(o&&Ae(o.append)&&o[Cs]==="FormData"&&o[wt])}const Ad=o=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=tt(s)?[]:{};return it(s,(i,m)=>{const b=e(i,a+1);!Ye(b)&&(l[m]=b)}),t[a]=void 0,l}}return s};return e(o,0)},xd=Le("AsyncFunction"),Md=o=>o&&(rt(o)||Ae(o))&&Ae(o.then)&&Ae(o.catch),Fs=((o,t)=>o?setImmediate:t?((e,s)=>(je.addEventListener("message",({source:a,data:l})=>{a===je&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),je.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(je.postMessage)),Fd=typeof queueMicrotask<"u"?queueMicrotask.bind(je):typeof process<"u"&&process.nextTick||Fs,Dd=o=>o!=null&&Ae(o[wt]),C={isArray:tt,isArrayBuffer:Rs,isBuffer:lt,isFormData:rd,isArrayBufferView:Qu,isString:Zu,isNumber:Is,isBoolean:ed,isObject:rt,isPlainObject:vt,isEmptyObject:td,isReadableStream:cd,isRequest:ud,isResponse:dd,isHeaders:pd,isUndefined:Ye,isDate:sd,isFile:od,isBlob:nd,isRegExp:Pd,isFunction:Ae,isStream:ld,isURLSearchParams:id,isTypedArray:_d,isFileList:ad,forEach:it,merge:Nt,extend:hd,trim:md,stripBOM:fd,inherits:vd,toFlatObject:gd,kindOf:$t,kindOfTest:Le,endsWith:yd,toArray:bd,forEachEntry:wd,matchAll:$d,isHTMLForm:Sd,hasOwnProperty:es,hasOwnProp:es,reduceDescriptors:Ms,freezeMethods:Ed,toObjectSet:kd,toCamelCase:Td,noop:Cd,toFiniteNumber:Rd,findKey:As,global:je,isContextDefined:xs,isSpecCompliantForm:Id,toJSONObject:Ad,isAsyncFn:xd,isThenable:Md,setImmediate:Fs,asap:Fd,isIterable:Dd};function ne(o,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(ne,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const Ds=ne.prototype,Ns={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{Ns[o]={value:o}});Object.defineProperties(ne,Ns);Object.defineProperty(Ds,"isAxiosError",{value:!0});ne.from=(o,t,e,s,a,l)=>{const i=Object.create(Ds);C.toFlatObject(o,i,function(c){return c!==Error.prototype},r=>r!=="isAxiosError");const m=o&&o.message?o.message:"Error",b=t==null&&o?o.code:t;return ne.call(i,m,b,e,s,a),o&&i.cause==null&&Object.defineProperty(i,"cause",{value:o,configurable:!0}),i.name=o&&o.name||"Error",l&&Object.assign(i,l),i};const Nd=null;function Ut(o){return C.isPlainObject(o)||C.isArray(o)}function Us(o){return C.endsWith(o,"[]")?o.slice(0,-2):o}function ts(o,t,e){return o?o.concat(t).map(function(a,l){return a=Us(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function Ud(o){return C.isArray(o)&&!o.some(Ut)}const Ld=C.toFlatObject(C,{},null,function(t){return/^is[A-Z]/.test(t)});function Tt(o,t,e){if(!C.isObject(o))throw new TypeError("target must be an object");t=t||new FormData,e=C.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,g){return!C.isUndefined(g[_])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,i=e.indexes,b=(e.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(t);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function r(u){if(u===null)return"";if(C.isDate(u))return u.toISOString();if(C.isBoolean(u))return u.toString();if(!b&&C.isBlob(u))throw new ne("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(u)||C.isTypedArray(u)?b&&typeof Blob=="function"?new Blob([u]):Buffer.from(u):u}function c(u,_,g){let v=u;if(u&&!g&&typeof u=="object"){if(C.endsWith(_,"{}"))_=s?_:_.slice(0,-2),u=JSON.stringify(u);else if(C.isArray(u)&&Ud(u)||(C.isFileList(u)||C.endsWith(_,"[]"))&&(v=C.toArray(u)))return _=Us(_),v.forEach(function(B,G){!(C.isUndefined(B)||B===null)&&t.append(i===!0?ts([_],G,l):i===null?_:_+"[]",r(B))}),!1}return Ut(u)?!0:(t.append(ts(g,_,l),r(u)),!1)}const f=[],E=Object.assign(Ld,{defaultVisitor:c,convertValue:r,isVisitable:Ut});function k(u,_){if(!C.isUndefined(u)){if(f.indexOf(u)!==-1)throw Error("Circular reference detected in "+_.join("."));f.push(u),C.forEach(u,function(v,R){(!(C.isUndefined(v)||v===null)&&a.call(t,v,C.isString(R)?R.trim():R,_,E))===!0&&k(v,_?_.concat(R):[R])}),f.pop()}}if(!C.isObject(o))throw new TypeError("data must be an object");return k(o),t}function ss(o){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Vt(o,t){this._pairs=[],o&&Tt(o,this,t)}const Ls=Vt.prototype;Ls.append=function(t,e){this._pairs.push([t,e])};Ls.toString=function(t){const e=t?function(s){return t.call(this,s,ss)}:ss;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function Od(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Os(o,t,e){if(!t)return o;const s=e&&e.encode||Od;C.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=C.isURLSearchParams(t)?t.toString():new Vt(t,e).toString(s),l){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class os{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Bs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Bd=typeof URLSearchParams<"u"?URLSearchParams:Vt,qd=typeof FormData<"u"?FormData:null,Hd=typeof Blob<"u"?Blob:null,Vd={isBrowser:!0,classes:{URLSearchParams:Bd,FormData:qd,Blob:Hd},protocols:["http","https","file","blob","url","data"]},jt=typeof window<"u"&&typeof document<"u",Lt=typeof navigator=="object"&&navigator||void 0,jd=jt&&(!Lt||["ReactNative","NativeScript","NS"].indexOf(Lt.product)<0),zd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Wd=jt&&window.location.href||"http://localhost",Gd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jt,hasStandardBrowserEnv:jd,hasStandardBrowserWebWorkerEnv:zd,navigator:Lt,origin:Wd},Symbol.toStringTag,{value:"Module"})),ke={...Gd,...Vd};function Kd(o,t){return Tt(o,new ke.classes.URLSearchParams,{visitor:function(e,s,a,l){return ke.isNode&&C.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Jd(o){return C.matchAll(/\w+|\[(\w*)]/g,o).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Xd(o){const t={},e=Object.keys(o);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=o[l];return t}function qs(o){function t(e,s,a,l){let i=e[l++];if(i==="__proto__")return!0;const m=Number.isFinite(+i),b=l>=e.length;return i=!i&&C.isArray(a)?a.length:i,b?(C.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!m):((!a[i]||!C.isObject(a[i]))&&(a[i]=[]),t(e,s,a[i],l)&&C.isArray(a[i])&&(a[i]=Xd(a[i])),!m)}if(C.isFormData(o)&&C.isFunction(o.entries)){const e={};return C.forEachEntry(o,(s,a)=>{t(Jd(s),a,e,0)}),e}return null}function Yd(o,t,e){if(C.isString(o))try{return(t||JSON.parse)(o),C.trim(o)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(o)}const ct={transitional:Bs,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=C.isObject(t);if(l&&C.isHTMLForm(t)&&(t=new FormData(t)),C.isFormData(t))return a?JSON.stringify(qs(t)):t;if(C.isArrayBuffer(t)||C.isBuffer(t)||C.isStream(t)||C.isFile(t)||C.isBlob(t)||C.isReadableStream(t))return t;if(C.isArrayBufferView(t))return t.buffer;if(C.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Kd(t,this.formSerializer).toString();if((m=C.isFileList(t))||s.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return Tt(m?{"files[]":t}:t,b&&new b,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Yd(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(t)||C.isReadableStream(t))return t;if(t&&C.isString(t)&&(s&&!this.responseType||a)){const i=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(m){if(i)throw m.name==="SyntaxError"?ne.from(m,ne.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ke.classes.FormData,Blob:ke.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],o=>{ct.headers[o]={}});const Qd=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zd=o=>{const t={};let e,s,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),e=i.substring(0,a).trim().toLowerCase(),s=i.substring(a+1).trim(),!(!e||t[e]&&Qd[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ns=Symbol("internals");function nt(o){return o&&String(o).trim().toLowerCase()}function gt(o){return o===!1||o==null?o:C.isArray(o)?o.map(gt):String(o)}function ep(o){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(o);)t[s[1]]=s[2];return t}const tp=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function It(o,t,e,s,a){if(C.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!C.isString(t)){if(C.isString(s))return t.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(t)}}function sp(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function op(o,t){const e=C.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(o,s+e,{value:function(a,l,i){return this[s].call(this,t,a,l,i)},configurable:!0})})}let xe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(m,b,r){const c=nt(b);if(!c)throw new Error("header name must be a non-empty string");const f=C.findKey(a,c);(!f||a[f]===void 0||r===!0||r===void 0&&a[f]!==!1)&&(a[f||b]=gt(m))}const i=(m,b)=>C.forEach(m,(r,c)=>l(r,c,b));if(C.isPlainObject(t)||t instanceof this.constructor)i(t,e);else if(C.isString(t)&&(t=t.trim())&&!tp(t))i(Zd(t),e);else if(C.isObject(t)&&C.isIterable(t)){let m={},b,r;for(const c of t){if(!C.isArray(c))throw TypeError("Object iterator must return a key-value pair");m[r=c[0]]=(b=m[r])?C.isArray(b)?[...b,c[1]]:[b,c[1]]:c[1]}i(m,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=nt(t),t){const s=C.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return ep(a);if(C.isFunction(e))return e.call(this,a,s);if(C.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=nt(t),t){const s=C.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||It(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(i){if(i=nt(i),i){const m=C.findKey(s,i);m&&(!e||It(s,s[m],m,e))&&(delete s[m],a=!0)}}return C.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||It(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return C.forEach(this,(a,l)=>{const i=C.findKey(s,l);if(i){e[i]=gt(a),delete e[l];return}const m=t?sp(l):String(l).trim();m!==l&&delete e[l],e[m]=gt(a),s[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return C.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&C.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ns]=this[ns]={accessors:{}}).accessors,a=this.prototype;function l(i){const m=nt(i);s[m]||(op(a,i),s[m]=!0)}return C.isArray(t)?t.forEach(l):l(t),this}};xe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(xe.prototype,({value:o},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>o,set(s){this[e]=s}}});C.freezeMethods(xe);function At(o,t){const e=this||ct,s=t||e,a=xe.from(s.headers);let l=s.data;return C.forEach(o,function(m){l=m.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function Hs(o){return!!(o&&o.__CANCEL__)}function st(o,t,e){ne.call(this,o??"canceled",ne.ERR_CANCELED,t,e),this.name="CanceledError"}C.inherits(st,ne,{__CANCEL__:!0});function Vs(o,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?o(e):t(new ne("Request failed with status code "+e.status,[ne.ERR_BAD_REQUEST,ne.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function np(o){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return t&&t[1]||""}function ap(o,t){o=o||10;const e=new Array(o),s=new Array(o);let a=0,l=0,i;return t=t!==void 0?t:1e3,function(b){const r=Date.now(),c=s[l];i||(i=r),e[a]=b,s[a]=r;let f=l,E=0;for(;f!==a;)E+=e[f++],f=f%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),r-i<t)return;const k=c&&r-c;return k?Math.round(E*1e3/k):void 0}}function lp(o,t){let e=0,s=1e3/t,a,l;const i=(r,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),o(...r)};return[(...r)=>{const c=Date.now(),f=c-e;f>=s?i(r,c):(a=r,l||(l=setTimeout(()=>{l=null,i(a)},s-f)))},()=>a&&i(a)]}const _t=(o,t,e=3)=>{let s=0;const a=ap(50,250);return lp(l=>{const i=l.loaded,m=l.lengthComputable?l.total:void 0,b=i-s,r=a(b),c=i<=m;s=i;const f={loaded:i,total:m,progress:m?i/m:void 0,bytes:b,rate:r||void 0,estimated:r&&m&&c?(m-i)/r:void 0,event:l,lengthComputable:m!=null,[t?"download":"upload"]:!0};o(f)},e)},as=(o,t)=>{const e=o!=null;return[s=>t[0]({lengthComputable:e,total:o,loaded:s}),t[1]]},ls=o=>(...t)=>C.asap(()=>o(...t)),rp=ke.hasStandardBrowserEnv?((o,t)=>e=>(e=new URL(e,ke.origin),o.protocol===e.protocol&&o.host===e.host&&(t||o.port===e.port)))(new URL(ke.origin),ke.navigator&&/(msie|trident)/i.test(ke.navigator.userAgent)):()=>!0,ip=ke.hasStandardBrowserEnv?{write(o,t,e,s,a,l,i){if(typeof document>"u")return;const m=[`${o}=${encodeURIComponent(t)}`];C.isNumber(e)&&m.push(`expires=${new Date(e).toUTCString()}`),C.isString(s)&&m.push(`path=${s}`),C.isString(a)&&m.push(`domain=${a}`),l===!0&&m.push("secure"),C.isString(i)&&m.push(`SameSite=${i}`),document.cookie=m.join("; ")},read(o){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function cp(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function up(o,t){return t?o.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):o}function js(o,t,e){let s=!cp(t);return o&&(s||e==!1)?up(o,t):t}const rs=o=>o instanceof xe?{...o}:o;function We(o,t){t=t||{};const e={};function s(r,c,f,E){return C.isPlainObject(r)&&C.isPlainObject(c)?C.merge.call({caseless:E},r,c):C.isPlainObject(c)?C.merge({},c):C.isArray(c)?c.slice():c}function a(r,c,f,E){if(C.isUndefined(c)){if(!C.isUndefined(r))return s(void 0,r,f,E)}else return s(r,c,f,E)}function l(r,c){if(!C.isUndefined(c))return s(void 0,c)}function i(r,c){if(C.isUndefined(c)){if(!C.isUndefined(r))return s(void 0,r)}else return s(void 0,c)}function m(r,c,f){if(f in t)return s(r,c);if(f in o)return s(void 0,r)}const b={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:m,headers:(r,c,f)=>a(rs(r),rs(c),f,!0)};return C.forEach(Object.keys({...o,...t}),function(c){const f=b[c]||a,E=f(o[c],t[c],c);C.isUndefined(E)&&f!==m||(e[c]=E)}),e}const zs=o=>{const t=We({},o);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:m}=t;if(t.headers=i=xe.from(i),t.url=Os(js(t.baseURL,t.url,t.allowAbsoluteUrls),o.params,o.paramsSerializer),m&&i.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),C.isFormData(e)){if(ke.hasStandardBrowserEnv||ke.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(C.isFunction(e.getHeaders)){const b=e.getHeaders(),r=["content-type","content-length"];Object.entries(b).forEach(([c,f])=>{r.includes(c.toLowerCase())&&i.set(c,f)})}}if(ke.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(t)),s||s!==!1&&rp(t.url))){const b=a&&l&&ip.read(l);b&&i.set(a,b)}return t},dp=typeof XMLHttpRequest<"u",pp=dp&&function(o){return new Promise(function(e,s){const a=zs(o);let l=a.data;const i=xe.from(a.headers).normalize();let{responseType:m,onUploadProgress:b,onDownloadProgress:r}=a,c,f,E,k,u;function _(){k&&k(),u&&u(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(a.method.toUpperCase(),a.url,!0),g.timeout=a.timeout;function v(){if(!g)return;const B=xe.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),P={data:!m||m==="text"||m==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:B,config:o,request:g};Vs(function(U){e(U),_()},function(U){s(U),_()},P),g=null}"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(v)},g.onabort=function(){g&&(s(new ne("Request aborted",ne.ECONNABORTED,o,g)),g=null)},g.onerror=function(G){const P=G&&G.message?G.message:"Network Error",I=new ne(P,ne.ERR_NETWORK,o,g);I.event=G||null,s(I),g=null},g.ontimeout=function(){let G=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const P=a.transitional||Bs;a.timeoutErrorMessage&&(G=a.timeoutErrorMessage),s(new ne(G,P.clarifyTimeoutError?ne.ETIMEDOUT:ne.ECONNABORTED,o,g)),g=null},l===void 0&&i.setContentType(null),"setRequestHeader"in g&&C.forEach(i.toJSON(),function(G,P){g.setRequestHeader(P,G)}),C.isUndefined(a.withCredentials)||(g.withCredentials=!!a.withCredentials),m&&m!=="json"&&(g.responseType=a.responseType),r&&([E,u]=_t(r,!0),g.addEventListener("progress",E)),b&&g.upload&&([f,k]=_t(b),g.upload.addEventListener("progress",f),g.upload.addEventListener("loadend",k)),(a.cancelToken||a.signal)&&(c=B=>{g&&(s(!B||B.type?new st(null,o,g):B),g.abort(),g=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const R=np(a.url);if(R&&ke.protocols.indexOf(R)===-1){s(new ne("Unsupported protocol "+R+":",ne.ERR_BAD_REQUEST,o));return}g.send(l||null)})},mp=(o,t)=>{const{length:e}=o=o?o.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(r){if(!a){a=!0,m();const c=r instanceof Error?r:this.reason;s.abort(c instanceof ne?c:new st(c instanceof Error?c.message:c))}};let i=t&&setTimeout(()=>{i=null,l(new ne(`timeout ${t} of ms exceeded`,ne.ETIMEDOUT))},t);const m=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(r=>{r.unsubscribe?r.unsubscribe(l):r.removeEventListener("abort",l)}),o=null)};o.forEach(r=>r.addEventListener("abort",l));const{signal:b}=s;return b.unsubscribe=()=>C.asap(m),b}},hp=function*(o,t){let e=o.byteLength;if(e<t){yield o;return}let s=0,a;for(;s<e;)a=s+t,yield o.slice(s,a),s=a},fp=async function*(o,t){for await(const e of vp(o))yield*hp(e,t)},vp=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const t=o.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},is=(o,t,e,s)=>{const a=fp(o,t);let l=0,i,m=b=>{i||(i=!0,s&&s(b))};return new ReadableStream({async pull(b){try{const{done:r,value:c}=await a.next();if(r){m(),b.close();return}let f=c.byteLength;if(e){let E=l+=f;e(E)}b.enqueue(new Uint8Array(c))}catch(r){throw m(r),r}},cancel(b){return m(b),a.return()}},{highWaterMark:2})},cs=64*1024,{isFunction:ht}=C,gp=(({Request:o,Response:t})=>({Request:o,Response:t}))(C.global),{ReadableStream:us,TextEncoder:ds}=C.global,ps=(o,...t)=>{try{return!!o(...t)}catch{return!1}},yp=o=>{o=C.merge.call({skipUndefined:!0},gp,o);const{fetch:t,Request:e,Response:s}=o,a=t?ht(t):typeof fetch=="function",l=ht(e),i=ht(s);if(!a)return!1;const m=a&&ht(us),b=a&&(typeof ds=="function"?(u=>_=>u.encode(_))(new ds):async u=>new Uint8Array(await new e(u).arrayBuffer())),r=l&&m&&ps(()=>{let u=!1;const _=new e(ke.origin,{body:new us,method:"POST",get duplex(){return u=!0,"half"}}).headers.has("Content-Type");return u&&!_}),c=i&&m&&ps(()=>C.isReadableStream(new s("").body)),f={stream:c&&(u=>u.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(u=>{!f[u]&&(f[u]=(_,g)=>{let v=_&&_[u];if(v)return v.call(_);throw new ne(`Response type '${u}' is not supported`,ne.ERR_NOT_SUPPORT,g)})});const E=async u=>{if(u==null)return 0;if(C.isBlob(u))return u.size;if(C.isSpecCompliantForm(u))return(await new e(ke.origin,{method:"POST",body:u}).arrayBuffer()).byteLength;if(C.isArrayBufferView(u)||C.isArrayBuffer(u))return u.byteLength;if(C.isURLSearchParams(u)&&(u=u+""),C.isString(u))return(await b(u)).byteLength},k=async(u,_)=>{const g=C.toFiniteNumber(u.getContentLength());return g??E(_)};return async u=>{let{url:_,method:g,data:v,signal:R,cancelToken:B,timeout:G,onDownloadProgress:P,onUploadProgress:I,responseType:U,headers:M,withCredentials:H="same-origin",fetchOptions:$}=zs(u),T=t||fetch;U=U?(U+"").toLowerCase():"text";let w=mp([R,B&&B.toAbortSignal()],G),D=null;const j=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let J;try{if(I&&r&&g!=="get"&&g!=="head"&&(J=await k(M,v))!==0){let Ee=new e(_,{method:"POST",body:v,duplex:"half"}),L;if(C.isFormData(v)&&(L=Ee.headers.get("content-type"))&&M.setContentType(L),Ee.body){const[q,z]=as(J,_t(ls(I)));v=is(Ee.body,cs,q,z)}}C.isString(H)||(H=H?"include":"omit");const le=l&&"credentials"in e.prototype,Fe={...$,signal:w,method:g.toUpperCase(),headers:M.normalize().toJSON(),body:v,duplex:"half",credentials:le?H:void 0};D=l&&new e(_,Fe);let be=await(l?T(D,$):T(_,Fe));const _e=c&&(U==="stream"||U==="response");if(c&&(P||_e&&j)){const Ee={};["status","statusText","headers"].forEach(X=>{Ee[X]=be[X]});const L=C.toFiniteNumber(be.headers.get("content-length")),[q,z]=P&&as(L,_t(ls(P),!0))||[];be=new s(is(be.body,cs,q,()=>{z&&z(),j&&j()}),Ee)}U=U||"text";let Be=await f[C.findKey(f,U)||"text"](be,u);return!_e&&j&&j(),await new Promise((Ee,L)=>{Vs(Ee,L,{data:Be,headers:xe.from(be.headers),status:be.status,statusText:be.statusText,config:u,request:D})})}catch(le){throw j&&j(),le&&le.name==="TypeError"&&/Load failed|fetch/i.test(le.message)?Object.assign(new ne("Network Error",ne.ERR_NETWORK,u,D),{cause:le.cause||le}):ne.from(le,le&&le.code,u,D)}}},bp=new Map,Ws=o=>{let t=o&&o.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let i=l.length,m=i,b,r,c=bp;for(;m--;)b=l[m],r=c.get(b),r===void 0&&c.set(b,r=m?new Map:yp(t)),c=r;return r};Ws();const zt={http:Nd,xhr:pp,fetch:{get:Ws}};C.forEach(zt,(o,t)=>{if(o){try{Object.defineProperty(o,"name",{value:t})}catch{}Object.defineProperty(o,"adapterName",{value:t})}});const ms=o=>`- ${o}`,_p=o=>C.isFunction(o)||o===null||o===!1;function wp(o,t){o=C.isArray(o)?o:[o];const{length:e}=o;let s,a;const l={};for(let i=0;i<e;i++){s=o[i];let m;if(a=s,!_p(s)&&(a=zt[(m=String(s)).toLowerCase()],a===void 0))throw new ne(`Unknown adapter '${m}'`);if(a&&(C.isFunction(a)||(a=a.get(t))))break;l[m||"#"+i]=a}if(!a){const i=Object.entries(l).map(([b,r])=>`adapter ${b} `+(r===!1?"is not supported by the environment":"is not available in the build"));let m=e?i.length>1?`since :
`+i.map(ms).join(`
`):" "+ms(i[0]):"as no adapter specified";throw new ne("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return a}const Gs={getAdapter:wp,adapters:zt};function xt(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new st(null,o)}function hs(o){return xt(o),o.headers=xe.from(o.headers),o.data=At.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Gs.getAdapter(o.adapter||ct.adapter,o)(o).then(function(s){return xt(o),s.data=At.call(o,o.transformResponse,s),s.headers=xe.from(s.headers),s},function(s){return Hs(s)||(xt(o),s&&s.response&&(s.response.data=At.call(o,o.transformResponse,s.response),s.response.headers=xe.from(s.response.headers))),Promise.reject(s)})}const Ks="1.13.2",Pt={};["object","boolean","number","function","string","symbol"].forEach((o,t)=>{Pt[o]=function(s){return typeof s===o||"a"+(t<1?"n ":" ")+o}});const fs={};Pt.transitional=function(t,e,s){function a(l,i){return"[Axios v"+Ks+"] Transitional option '"+l+"'"+i+(s?". "+s:"")}return(l,i,m)=>{if(t===!1)throw new ne(a(i," has been removed"+(e?" in "+e:"")),ne.ERR_DEPRECATED);return e&&!fs[i]&&(fs[i]=!0,console.warn(a(i," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,i,m):!0}};Pt.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function $p(o,t,e){if(typeof o!="object")throw new ne("options must be an object",ne.ERR_BAD_OPTION_VALUE);const s=Object.keys(o);let a=s.length;for(;a-- >0;){const l=s[a],i=t[l];if(i){const m=o[l],b=m===void 0||i(m,l,o);if(b!==!0)throw new ne("option "+l+" must be "+b,ne.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ne("Unknown option "+l,ne.ERR_BAD_OPTION)}}const yt={assertOptions:$p,validators:Pt},Oe=yt.validators;let ze=class{constructor(t){this.defaults=t||{},this.interceptors={request:new os,response:new os}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=We(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&yt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(C.isFunction(a)?e.paramsSerializer={serialize:a}:yt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),yt.assertOptions(e,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let i=l&&C.merge(l.common,l[e.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],u=>{delete l[u]}),e.headers=xe.concat(i,l);const m=[];let b=!0;this.interceptors.request.forEach(function(_){typeof _.runWhen=="function"&&_.runWhen(e)===!1||(b=b&&_.synchronous,m.unshift(_.fulfilled,_.rejected))});const r=[];this.interceptors.response.forEach(function(_){r.push(_.fulfilled,_.rejected)});let c,f=0,E;if(!b){const u=[hs.bind(this),void 0];for(u.unshift(...m),u.push(...r),E=u.length,c=Promise.resolve(e);f<E;)c=c.then(u[f++],u[f++]);return c}E=m.length;let k=e;for(;f<E;){const u=m[f++],_=m[f++];try{k=u(k)}catch(g){_.call(this,g);break}}try{c=hs.call(this,k)}catch(u){return Promise.reject(u)}for(f=0,E=r.length;f<E;)c=c.then(r[f++],r[f++]);return c}getUri(t){t=We(this.defaults,t);const e=js(t.baseURL,t.url,t.allowAbsoluteUrls);return Os(e,t.params,t.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(t){ze.prototype[t]=function(e,s){return this.request(We(s||{},{method:t,url:e,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(t){function e(s){return function(l,i,m){return this.request(We(m||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}ze.prototype[t]=e(),ze.prototype[t+"Form"]=e(!0)});let Sp=class Js{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(m=>{s.subscribe(m),l=m}).then(a);return i.cancel=function(){s.unsubscribe(l)},i},t(function(l,i,m){s.reason||(s.reason=new st(l,i,m),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Js(function(a){t=a}),cancel:t}}};function Tp(o){return function(e){return o.apply(null,e)}}function Pp(o){return C.isObject(o)&&o.isAxiosError===!0}const Ot={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Ot).forEach(([o,t])=>{Ot[t]=o});function Xs(o){const t=new ze(o),e=ks(ze.prototype.request,t);return C.extend(e,ze.prototype,t,{allOwnKeys:!0}),C.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Xs(We(o,a))},e}const we=Xs(ct);we.Axios=ze;we.CanceledError=st;we.CancelToken=Sp;we.isCancel=Hs;we.VERSION=Ks;we.toFormData=Tt;we.AxiosError=ne;we.Cancel=we.CanceledError;we.all=function(t){return Promise.all(t)};we.spread=Tp;we.isAxiosError=Pp;we.mergeConfig=We;we.AxiosHeaders=xe;we.formToJSON=o=>qs(C.isHTMLForm(o)?new FormData(o):o);we.getAdapter=Gs.getAdapter;we.HttpStatusCode=Ot;we.default=we;const{Axios:Af,AxiosError:xf,CanceledError:Mf,isCancel:Ff,CancelToken:Df,VERSION:Nf,all:Uf,Cancel:Lf,isAxiosError:Of,spread:Bf,toFormData:qf,AxiosHeaders:Hf,HttpStatusCode:Vf,formToJSON:jf,getAdapter:zf,mergeConfig:Wf}=we;class Ep{static async getAvailableModels(){try{return(await we({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const kp={class:"assigned-tools"},Cp={class:"section-header"},Rp=["title"],Ip={class:"tool-info"},Ap={class:"tool-name"},xp=["title"],Mp={key:0,class:"no-tools"},Fp=$e({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=se(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const i=se(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(r=>l.value.some(c=>c.key===r)):[]);fe(i,r=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;r.length!==c&&s("tools-filtered",r)},{immediate:!0});const m=r=>{const c=l.value.find(E=>E.key===r);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:r},b=r=>{const c=l.value.find(f=>f.key===r);return c?c.description:""};return(r,c)=>(h(),y("div",kp,[n("div",Cp,[n("span",null,d(r.title)+" ("+d(i.value.length)+")",1),r.showAddButton?(h(),y("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=f=>r.$emit("add-tools"))},[A(p(F),{icon:"carbon:add"}),ce(" "+d(r.addButtonText),1)])):V("",!0)]),n("div",{class:ue(["tools-grid",{"grid-layout":r.useGridLayout,"has-more-items":r.useGridLayout&&i.value.length>2}])},[(h(!0),y(de,null,he(i.value,f=>(h(),y("div",{key:f,class:"tool-item assigned",title:b(f)},[n("div",Ip,[n("span",Ap,d(m(f)),1),n("span",{class:"tool-desc",title:b(f)},d(b(f)),9,xp)])],8,Rp))),128)),i.value.length===0?(h(),y("div",Mp,[A(p(F),{icon:"carbon:tool-box"}),n("span",null,d(r.emptyText),1)])):V("",!0)],2)]))}}),Dp=Se(Fp,[["__scopeId","data-v-62354a05"]]),Np={class:"tool-selection-content"},Up={class:"tool-controls"},Lp={class:"search-container"},Op=["placeholder"],Bp={class:"sort-container"},qp={value:"group"},Hp={value:"name"},Vp={value:"enabled"},jp={class:"tool-summary"},zp={class:"summary-text"},Wp={key:0,class:"tool-groups"},Gp=["onClick"],Kp={class:"group-title-area"},Jp={class:"group-name"},Xp={class:"group-count"},Yp={class:"group-enable-all"},Qp=["checked","onChange","data-group"],Zp={class:"enable-label"},em={class:"tool-info"},tm={class:"tool-selection-name"},sm={key:0,class:"tool-selection-desc"},om={class:"tool-actions"},nm=["checked","onChange"],am={key:1,class:"empty-state"},lm=$e({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(o,{emit:t}){const e=o,s=t,a=at(),l=se(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),fe(()=>e.modelValue,$=>{$&&!a.isLoading.value&&a.loadAvailableTools()});const i=se({get:()=>e.modelValue,set:$=>s("update:modelValue",$)}),m=x(""),b=x("group"),r=x(new Set),c=x([]),f=x(null),E=($,T)=>{const w=document.querySelector(`input[data-group="${$}"]`);w&&(w.indeterminate=P(T))};fe(()=>e.selectedToolIds,$=>{c.value=[...$]},{immediate:!0});const k=se(()=>{let $=l.value.filter(T=>T.key);if($=$.filter(T=>T.selectable===!0),m.value){const T=m.value.toLowerCase();$=$.filter(w=>w.name.toLowerCase().includes(T)||w.description.toLowerCase().includes(T)||w.serviceGroup.toLowerCase().includes(T))}switch(b.value){case"name":$=[...$].sort((T,w)=>T.name.localeCompare(w.name));break;case"enabled":$=[...$].sort((T,w)=>{const D=c.value.includes(T.key),j=c.value.includes(w.key);return D&&!j?-1:!D&&j?1:T.name.localeCompare(w.name)});break;case"group":default:$=[...$].sort((T,w)=>{const D=T.serviceGroup||"Ungrouped",j=w.serviceGroup||"Ungrouped";return D!==j?D.localeCompare(j):T.name.localeCompare(w.name)});break}return $}),u=se(()=>{const $=new Map;return l.value.filter(w=>w.key&&w.selectable===!0).forEach(w=>{const D=w.serviceGroup||"Ungrouped";$.has(D)||$.set(D,[]),$.get(D).push(w)}),$}),_=se(()=>{const $=new Map;return k.value.forEach(T=>{const w=T.serviceGroup||"Ungrouped";$.has(w)||$.set(w,[]),$.get(w).push(T)}),new Map([...$.entries()].sort())}),g=se(()=>k.value.length);fe([c,_],()=>{Ie(()=>{for(const[$,T]of _.value)E($,T)})},{flush:"post",deep:!1});const v=$=>c.value.includes($),R=($,T)=>{T.stopPropagation();const D=T.target.checked;if(!$){console.error("toolKey is undefined, cannot proceed");return}D?c.value.includes($)||(c.value=[...c.value,$]):c.value=c.value.filter(j=>j!==$)},B=$=>$.filter(T=>c.value.includes(T.key)),G=$=>$.length>0&&$.every(T=>c.value.includes(T.key)),P=$=>{const T=B($).length;return T>0&&T<$.length},I=($,T)=>{T.stopPropagation();const D=T.target.checked,j=$.map(J=>J.key);if(D){const J=[...c.value];j.forEach(le=>{J.includes(le)||J.push(le)}),c.value=J}else c.value=c.value.filter(J=>!j.includes(J))},U=$=>{r.value.has($)?r.value.delete($):r.value.add($)},M=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},H=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return fe(m,$=>{const T=$.trim().toLowerCase();if(T){f.value===null&&(f.value=new Set(r.value));for(const[w,D]of u.value)D.some(J=>J.name.toLowerCase().includes(T)||J.description&&J.description.toLowerCase().includes(T)||J.serviceGroup&&J.serviceGroup.toLowerCase().includes(T))&&r.value.delete(w)}else f.value!==null&&(r.value=new Set(f.value),f.value=null)}),fe(i,$=>{if($){r.value.clear(),f.value=null;const T=Array.from(_.value.keys());T.length>1&&T.slice(1).forEach(w=>{r.value.add(w)})}}),($,T)=>(h(),ye(bs,{modelValue:i.value,"onUpdate:modelValue":[T[4]||(T[4]=w=>i.value=w),H],title:$.$t("toolSelection.title"),onConfirm:M},{default:Xe(()=>[n("div",Np,[n("div",Up,[n("div",Lp,[ve(n("input",{"onUpdate:modelValue":T[0]||(T[0]=w=>m.value=w),type:"text",class:"search-input",placeholder:$.$t("toolSelection.searchPlaceholder")},null,8,Op),[[Te,m.value]])]),n("div",Bp,[ve(n("select",{"onUpdate:modelValue":T[1]||(T[1]=w=>b.value=w),class:"sort-select"},[n("option",qp,d($.$t("toolSelection.sortByGroup")),1),n("option",Hp,d($.$t("toolSelection.sortByName")),1),n("option",Vp,d($.$t("toolSelection.sortByStatus")),1)],512),[[Bt,b.value]])])]),n("div",jp,[n("span",zp,d($.$t("toolSelection.summary",{groups:_.value.size,tools:g.value,selected:c.value.length})),1)]),_.value.size>0?(h(),y("div",Wp,[(h(!0),y(de,null,he(_.value,([w,D])=>(h(),y("div",{key:w,class:"tool-group"},[n("div",{class:ue(["tool-group-header",{collapsed:r.value.has(w)}]),onClick:j=>U(w)},[n("div",Kp,[A(p(F),{icon:r.value.has(w)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(p(F),{icon:"carbon:folder",class:"group-icon"}),n("span",Jp,d(w),1),n("span",Xp," ("+d(B(D).length)+"/"+d(D.length)+") ",1)]),n("div",{class:"group-actions",onClick:T[2]||(T[2]=ge(()=>{},["stop"]))},[n("label",Yp,[n("input",{type:"checkbox",class:"group-enable-checkbox",checked:G(D),onChange:j=>I(D,j),"data-group":w},null,40,Qp),n("span",Zp,d($.$t("toolSelection.enableAll")),1)])])],10,Gp),n("div",{class:ue(["tool-group-content",{collapsed:r.value.has(w)}])},[(h(!0),y(de,null,he(D,j=>(h(),y("div",{key:j.key,class:"tool-selection-item"},[n("div",em,[n("div",tm,d(j.name),1),j.description?(h(),y("div",sm,d(j.description),1)):V("",!0)]),n("div",om,[n("label",{class:"tool-enable-switch",onClick:T[3]||(T[3]=ge(()=>{},["stop"]))},[n("input",{type:"checkbox",class:"tool-enable-checkbox",checked:v(j.key),onChange:J=>R(j.key,J)},null,40,nm),T[5]||(T[5]=n("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),y("div",am,[A(p(F),{icon:"carbon:tools",class:"empty-icon"}),n("p",null,d($.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),rm=Se(lm,[["__scopeId","data-v-627b463f"]]),im={class:"config-section"},cm={class:"section-header"},um={class:"visual-editor"},dm={class:"plan-basic-info"},pm={class:"form-row"},mm={class:"form-label"},hm=["placeholder"],fm={key:0,class:"field-error-message"},vm={class:"form-row"},gm={class:"form-label"},ym={class:"service-group-autocomplete"},bm=["placeholder"],_m={key:0,class:"service-group-dropdown"},wm=["onMousedown"],$m={class:"field-description"},Sm={class:"steps-section"},Tm={class:"steps-container"},Pm={class:"step-content"},Em={class:"form-row"},km={class:"form-label"},Cm=["value","onInput","placeholder"],Rm={class:"form-row"},Im={class:"form-label"},Am=["value","onInput","placeholder"],xm={key:0,class:"preview-section"},Mm={class:"preview-label"},Fm={class:"preview-content"},Dm={class:"preview-text"},Nm={class:"preview-table-header"},Um={class:"form-row"},Lm={class:"form-label"},Om={class:"model-selector-wrapper"},Bm={class:"model-input-wrapper"},qm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Hm={key:0,class:"dropdown-item disabled"},Vm={key:1,class:"dropdown-item disabled error"},jm={key:2,class:"dropdown-item disabled"},zm=["onClick","onMouseenter"],Wm=["onClick","onMouseenter"],Gm=["title"],Km={key:0,class:"error-message"},Jm={class:"form-row"},Xm={key:0,class:"empty-steps"},Ym={class:"empty-text"},Qm={key:0,class:"json-preview"},Zm={class:"preview-header"},eh={class:"form-label"},th={class:"json-code"},sh={class:"editor-footer"},oh={class:"section-actions"},nh=["disabled","title"],ah=["disabled","title"],lh=["disabled","title"],rh=["disabled"],ih={class:"modal-header"},ch={class:"modal-body"},uh={class:"form-row"},dh={class:"form-label"},ph=["placeholder"],mh={class:"modal-footer"},hh=["disabled"],fh=$e({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=De(),s=_s(),a=Qe(),l=Ve({title:"",steps:[]}),i=x(!1),m=x(!1),b=x([]),r=x(!1),c=x(""),f=se(()=>a.generateJsonString()),E=x(!1),k=x(!1);let u=null;const _=()=>{k.value=!0,u&&clearTimeout(u),u=setTimeout(()=>{k.value=!1,u=null},500)},g=()=>{if(!k.value){E.value=!0;try{const S=a.getConfig();(S.title?.trim()||!l.title?.trim())&&(l.title=S.title||""),l.steps=(S.steps||[]).map(W=>({...W})),c.value=S.serviceGroup||""}finally{setTimeout(()=>{E.value=!1},0)}}},v=()=>{E.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(ae.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{E.value=!1},0)}},R=()=>{i.value=!i.value},B=()=>{i.value=!1},G=()=>{try{u&&(clearTimeout(u),u=null),k.value=!1,a.rollbackVersion()}catch(S){console.error("Error during rollback operation:",S),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},P=()=>{try{u&&(clearTimeout(u),u=null),k.value=!1,a.restoreVersion()}catch(S){console.error("Error during restore operation:",S),s.error(e("sidebar.restoreFailed")||"Restore failed")}},I=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}u&&(clearTimeout(u),u=null),k.value=!1,v();const S=a.validate();if(!S.isValid){s.error(`Invalid format, please correct and save.
Errors: `+S.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const oe=a.generateJsonString().trim();a.updateVersionsAfterSave(oe);const me=a.planVersions.value.length;ae.hasTaskRequirementModified=!1,await ae.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:me}))}catch(S){console.error("Failed to save plan modifications:",S);const W=S instanceof Error?S.message:e("sidebar.saveFailed");throw s.error(W),S}},U=x(""),M=(S,W)=>{_();const K=l.steps[W];K&&(K.stepRequirement=S.target.value),Jt(S)},H=(S,W)=>{_();const K=l.steps[W];K&&(K.terminateColumns=S.target.value),Jt(S)},$=()=>{const S={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(S),a.setStepsWithGuard(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},T=x([]),w=x(!1),D=x(""),j=x(new Map),J=x(new Set),le=x(new Map),Fe=S=>j.value.get(S)??"",be=(S,W)=>{j.value.set(S,W)},_e=S=>{const W=Fe(S);if(!W.trim())return T.value;const K=W.toLowerCase().trim();return T.value.filter(oe=>oe.value.toLowerCase().includes(K)||oe.label.toLowerCase().includes(K))},Be=S=>{const W=l.steps[S],K=Fe(S);return J.value.has(S)&&K!==""?K:W.modelName??""},Ee=S=>w.value||D.value||l.steps[S].modelName?"":e("sidebar.modelNameDescription")||"",L=S=>J.value.has(S),q=S=>{w.value||J.value.add(S)},z=S=>{J.value.delete(S),le.value.set(S,-1);const W=l.steps[S];be(S,W.modelName??"")},X=S=>{L(S)?z(S):q(S)},te=(S,W)=>{_();const K=l.steps[W];K.modelName=S,be(W,S),z(W)},ie=(S,W)=>{_();const K=S.target;be(W,K.value),q(W)},re=S=>le.value.get(S)??-1,N=(S,W)=>{le.value.set(S,W)},Q=S=>{const W=re(S),K=_e(S);W>=0&&W<K.length?te(K[W].value,S):W===-1?te("",S):K.length>0?te(K[0].value,S):l.steps[S].modelName||te("",S)},ee=S=>{if(!L(S)){q(S),N(S,0);return}const K=_e(S).length+1,oe=re(S),me=Math.min(oe+1,K-1);N(S,me)},O=S=>{if(!L(S)){q(S);const oe=_e(S);N(S,oe.length);return}const W=re(S),K=Math.max(W-1,-1);N(S,K)},Z=S=>{S.target.closest(".model-selector")||J.value.clear()};fe(()=>l.steps,S=>{S.forEach((W,K)=>{j.value.has(K)||be(K,W.modelName??"")})},{deep:!0,immediate:!0});const Y=x(!1),pe=x(-1),Ce=async()=>{if(!w.value){w.value=!0,D.value="";try{const S=await Ep.getAvailableModels();T.value=S.options}catch(S){console.error("Failed to load models:",S),D.value=S instanceof Error?S.message:"Failed to load models",T.value=[]}finally{w.value=!1}}},ut=S=>{pe.value=S,Y.value=!0},Ys=S=>{_(),pe.value>=0&&pe.value<l.steps.length&&(l.steps[pe.value].selectedToolKeys=[...S]),Y.value=!1,pe.value=-1},Qs=(S,W)=>{_(),S>=0&&S<l.steps.length&&(l.steps[S].selectedToolKeys=[...W])},dt=x(!1),qe=x(""),He=x(!1),Zs=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}qe.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),dt.value=!0},pt=()=>{dt.value=!1,qe.value="",He.value=!1},eo=S=>{S.target===S.currentTarget&&pt()},Wt=async()=>{if(!qe.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}He.value=!0;try{const S=a.getConfig(),W=`planTemplate-${Date.now()}`,{toolConfig:K,...oe}=S,me={...oe,title:qe.value.trim(),planTemplateId:W};console.log("[JsonEditorV2] Copying plan without toolConfig:",me),(await vo.createOrUpdatePlanTemplateWithTool(me)).success?(s.success(e("sidebar.copyPlanSuccess",{title:qe.value.trim()})),await ae.loadPlanTemplateList(),pt()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(S){if(console.error("[JsonEditorV2] Error copying plan:",S),S instanceof Error&&S.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const W=S instanceof Error?S.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:W}))}}finally{He.value=!1}};fe(()=>l.title,S=>{S?.trim()?U.value="":U.value="Title is required field"},{immediate:!0});const Gt=()=>{const S=a.getServiceGroup()||"";c.value=S};fe(()=>a.config,()=>{!E.value&&!a.isUserUpdating.value&&!k.value&&g()},{deep:!0,immediate:!0}),fe(()=>a.currentPlanTemplateId.value,(S,W)=>{W!=null&&S!==W&&(j.value.clear(),J.value.clear(),le.value.clear(),Y.value=!1,dt.value=!1,i.value=!1,pe.value=-1,qe.value="",He.value=!1),g(),Gt()},{immediate:!0}),fe(()=>c.value,S=>{E.value=!0;try{a.setServiceGroup(S)}finally{setTimeout(()=>{E.value=!1},0)}});const to=async()=>{if(!r.value){r.value=!0;try{const S=await Ps.getAvailableTools(),W=new Set;S.forEach(K=>{K.serviceGroup&&W.add(K.serviceGroup)}),b.value=Array.from(W).sort()}catch(S){console.error("[JsonEditorV2] Failed to load service groups:",S),b.value=[]}finally{r.value=!1}}},Kt=se(()=>{const S=c.value.trim();if(!S)return b.value;const W=S.toLowerCase();return b.value.filter(K=>K.toLowerCase().includes(W))}),so=()=>{_()},oo=()=>{m.value=!0},no=()=>{_(),oo()},ao=()=>{setTimeout(()=>{m.value=!1},200)},lo=S=>{c.value=S,m.value=!1};Me(()=>{g(),Gt(),to(),Ce(),document.addEventListener("click",Z)}),Ue(()=>{document.removeEventListener("click",Z),u&&(clearTimeout(u),u=null)}),t({save:I});const Jt=S=>{const W=S.target;W.style.height="auto";const K=20,oe=Math.ceil(W.scrollHeight/K),me=4,Ge=12,mt=Math.max(me,Math.min(Ge,oe)),io=mt*K;W.style.height=`${io}px`,W.rows=mt,oe>Ge?W.style.overflowY="auto":W.style.overflowY="hidden"},ro=S=>{if(!S.trim())return"";const W=S.split(",").map(K=>K.trim()).filter(K=>K.length>0);return W.length===0?"":`|${W.join("|")}|`};return(S,W)=>(h(),y("div",im,[n("div",cm,[A(p(F),{icon:"carbon:code",width:"16"}),n("span",null,d(S.$t("sidebar.dynamicAgentPlan")),1)]),n("div",um,[n("div",dm,[n("div",pm,[n("label",mm,d(S.$t("sidebar.title")),1),ve(n("input",{"onUpdate:modelValue":W[0]||(W[0]=K=>l.title=K),type:"text",class:ue(["form-input",{error:U.value}]),placeholder:S.$t("sidebar.titlePlaceholder"),onInput:so},null,42,hm),[[Te,l.title]]),U.value?(h(),y("div",fm,[A(p(F),{icon:"carbon:warning",width:"12"}),ce(" "+d(U.value),1)])):V("",!0)]),n("div",vm,[n("label",gm,d(S.$t("mcpService.serviceGroup")),1),n("div",ym,[ve(n("input",{type:"text","onUpdate:modelValue":W[1]||(W[1]=K=>c.value=K),onInput:no,onFocus:W[2]||(W[2]=K=>m.value=!0),onBlur:ao,placeholder:S.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,bm),[[Te,c.value]]),m.value&&Kt.value.length>0?(h(),y("div",_m,[(h(!0),y(de,null,he(Kt.value,K=>(h(),y("div",{key:K,class:"service-group-option",onMousedown:oe=>lo(K)},d(K),41,wm))),128))])):V("",!0)]),n("div",$m,d(S.$t("mcpService.serviceGroupDescription")),1)])]),n("div",Sm,[n("div",Tm,[(h(!0),y(de,null,he(l.steps,(K,oe)=>(h(),y("div",{key:oe,class:"step-item"},[n("div",Pm,[n("div",Em,[n("label",km,d(S.$t("sidebar.stepRequirement")),1),n("textarea",{value:K.stepRequirement||"",onInput:me=>M(me,oe),class:"form-textarea auto-resize",placeholder:S.$t("sidebar.stepRequirementPlaceholder"),rows:"4"},null,40,Cm)]),n("div",Rm,[n("label",Im,d(S.$t("sidebar.terminateColumns")),1),n("textarea",{value:K.terminateColumns||"",onInput:me=>H(me,oe),class:"form-textarea auto-resize",placeholder:S.$t("sidebar.terminateColumnsPlaceholder"),rows:"4"},null,40,Am),K.terminateColumns&&K.terminateColumns.trim()?(h(),y("div",xm,[n("div",Mm,d(S.$t("sidebar.preview"))+":",1),n("div",Fm,[n("div",Dm,[ce(d(S.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),n("span",Nm,d(ro(K.terminateColumns)),1)])])])):V("",!0)]),n("div",Um,[n("label",Lm,d(S.$t("sidebar.modelName")),1),n("div",Om,[n("div",{class:ue(["model-selector",{"is-open":L(oe),"is-disabled":w.value}])},[n("div",Bm,[n("input",{value:Be(oe),type:"text",class:"form-input model-search-input",placeholder:Ee(oe),disabled:w.value,onClick:ge(me=>q(oe),["stop"]),onFocus:me=>q(oe),onInput:me=>ie(me,oe),onKeydown:[ot(me=>z(oe),["escape"]),ot(ge(me=>Q(oe),["prevent"]),["enter"]),ot(ge(me=>ee(oe),["prevent"]),["down"]),ot(ge(me=>O(oe),["prevent"]),["up"])]},null,40,qm),A(p(F),{icon:"carbon:chevron-down",width:"14",class:ue(["dropdown-arrow",{"is-open":L(oe)}]),onClick:ge(me=>X(oe),["stop"])},null,8,["class","onClick"])]),L(oe)?(h(),y("div",{key:0,class:"model-dropdown",onClick:W[3]||(W[3]=ge(()=>{},["stop"]))},[w.value?(h(),y("div",Hm,d(S.$t("sidebar.loading")),1)):D.value?(h(),y("div",Vm,d(S.$t("sidebar.modelLoadError")),1)):_e(oe).length===0?(h(),y("div",jm,d(S.$t("sidebar.noModelsFound")),1)):V("",!0),(h(!0),y(de,null,he(_e(oe),(me,Ge)=>(h(),y("div",{key:me.value,class:ue(["dropdown-item",{"is-selected":K.modelName===me.value,"is-highlighted":re(oe)===Ge}]),onClick:mt=>te(me.value,oe),onMouseenter:mt=>N(oe,Ge)},[ce(d(me.value)+" ",1),K.modelName===me.value?(h(),ye(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,zm))),128)),n("div",{class:ue(["dropdown-item",{"is-selected":!K.modelName,"is-highlighted":re(oe)===-1}]),onClick:me=>te("",oe),onMouseenter:me=>N(oe,-1)},[ce(d(S.$t("sidebar.noModelSelected"))+" ",1),K.modelName?V("",!0):(h(),ye(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Wm)])):V("",!0)],2),D.value?(h(),y("button",{key:0,onClick:Ce,class:"btn btn-sm btn-danger",title:S.$t("sidebar.retryLoadModels")},[A(p(F),{icon:"carbon:warning",width:"14"}),ce(" "+d(S.$t("sidebar.retry")),1)],8,Gm)):V("",!0)]),D.value?(h(),y("div",Km,[A(p(F),{icon:"carbon:warning",width:"12"}),ce(" "+d(D.value),1)])):V("",!0)]),n("div",Jm,[A(Dp,{title:S.$t("sidebar.selectedTools"),"selected-tool-ids":K.selectedToolKeys||[],"add-button-text":S.$t("sidebar.addRemoveTools"),"empty-text":S.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:me=>ut(oe),onToolsFiltered:me=>Qs(oe,me)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),y("div",Xm,[A(p(F),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),n("p",Ym,d(S.$t("sidebar.noSteps")),1),n("button",{class:"btn btn-primary btn-add-step",onClick:$},[A(p(F),{icon:"carbon:add",width:"16"}),ce(" "+d(S.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),i.value?(h(),y("div",Qm,[n("div",Zm,[n("label",eh,d(S.$t("sidebar.jsonPreview")),1),n("button",{onClick:B,class:"btn btn-xs"},[A(p(F),{icon:"carbon:close",width:"12"})])]),n("pre",th,d(f.value),1)])):V("",!0),n("div",sh,[n("button",{onClick:R,class:"btn btn-sm btn-secondary"},[A(p(F),{icon:"carbon:code",width:"14"}),ce(" "+d(i.value?S.$t("sidebar.hideJson"):S.$t("sidebar.showJson")),1)]),n("div",oh,[n("button",{class:"btn btn-sm",onClick:Zs,disabled:S.isGenerating||S.isExecuting,title:S.$t("sidebar.copyPlan")},[A(p(F),{icon:"carbon:copy",width:"14"}),ce(" "+d(S.$t("sidebar.copyPlan")),1)],8,nh),n("button",{class:"btn btn-sm",onClick:G,disabled:!p(a).canRollback.value,title:S.$t("sidebar.rollback")},[A(p(F),{icon:"carbon:undo",width:"14"})],8,ah),n("button",{class:"btn btn-sm",onClick:P,disabled:!p(a).canRestore.value,title:S.$t("sidebar.restore")},[A(p(F),{icon:"carbon:redo",width:"14"})],8,lh),n("button",{class:"btn btn-primary",onClick:I,disabled:S.isGenerating||S.isExecuting},[A(p(F),{icon:"carbon:save",width:"14"}),W[7]||(W[7]=ce(" Save "))],8,rh)])])]),A(rm,{modelValue:Y.value,"onUpdate:modelValue":W[4]||(W[4]=K=>Y.value=K),"selected-tool-ids":pe.value>=0?l.steps[pe.value]?.selectedToolKeys||[]:[],onConfirm:Ys},null,8,["modelValue","selected-tool-ids"]),dt.value?(h(),y("div",{key:0,class:"modal-overlay",onMousedown:eo},[n("div",{class:"modal-content",onMousedown:W[6]||(W[6]=ge(()=>{},["stop"]))},[n("div",ih,[n("h3",null,d(S.$t("sidebar.copyPlan")),1),n("button",{class:"close-btn",onClick:pt},[A(p(F),{icon:"carbon:close",width:"16"})])]),n("div",ch,[n("div",uh,[n("label",dh,d(S.$t("sidebar.newPlanTitle")),1),ve(n("input",{"onUpdate:modelValue":W[5]||(W[5]=K=>qe.value=K),type:"text",class:"form-input",placeholder:S.$t("sidebar.enterNewPlanTitle"),onKeyup:ot(Wt,["enter"])},null,40,ph),[[Te,qe.value]])])]),n("div",mh,[n("button",{class:"btn btn-secondary",onClick:pt},d(S.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:Wt,disabled:!qe.value.trim()||He.value},[He.value?(h(),ye(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ce(" "+d(He.value?S.$t("sidebar.copying"):S.$t("sidebar.copyPlan")),1)],8,hh)])],32)],32)):V("",!0)]))}}),vh=Se(fh,[["__scopeId","data-v-55f487d5"]]),gh={class:"template-list-container"},yh={class:"organization-section"},bh={class:"organization-row"},_h={class:"organization-selector"},wh={class:"organization-label"},$h=["value"],Sh={value:"by_time"},Th={value:"by_abc"},Ph={value:"by_group_time"},Eh={value:"by_group_abc"},kh={class:"search-input-wrapper"},Ch={class:"search-label"},Rh={class:"search-input-container"},Ih=["placeholder"],Ah=["title"],xh={class:"sidebar-content-list"},Mh={key:0,class:"loading-state"},Fh={key:1,class:"error-state"},Dh={key:2,class:"empty-state"},Nh=["onClick","title"],Uh=["onClick","title"],Lh={class:"group-name"},Oh={class:"group-count"},Bh=["onClick"],qh={class:"task-icon"},Hh={class:"task-details"},Vh={class:"task-title"},jh={class:"task-time"},zh={class:"task-actions"},Wh=["title","onClick"],Gh=$e({__name:"TemplateList",emits:["templateSelected","templateCreated"],setup(o,{emit:t}){const{t:e}=De(),s=Qe(),a=at(),l=x(""),i=t,m=u=>{const _=u.target;ae.setOrganizationMethod(_.value)},b=async()=>{const u=s.getPlanType()||"dynamic_agent";await ae.createNewTemplate(u);const _=s.selectedTemplate.value;_&&(s.reset(),s.setPlanType(_.planType||"dynamic_agent"),_.planTemplateId&&s.setPlanTemplateId(_.planTemplateId),s.setTitle(_.title||"")),Re.switchToTab("config"),console.log("[TemplateList] ðŸ”„ Reloading available tools for new template"),await a.loadAvailableTools(),i("templateCreated")},r=u=>{if(isNaN(u.getTime()))return console.warn("Invalid date received:",u),e("time.unknown");const g=new Date().getTime()-u.getTime(),v=Math.floor(g/6e4),R=Math.floor(g/36e5),B=Math.floor(g/864e5);return v<1?e("time.now"):v<60?e("time.minuteAgo",{count:v}):R<24?e("time.hourAgo",{count:R}):B<30?e("time.dayAgo",{count:B}):u.toLocaleDateString("zh-CN")},c=se(()=>{s.planTemplateList.value;const u=l.value.trim().toLowerCase(),_=ae.groupedTemplates;if(!u)return _;const g=new Map;for(const[v,R]of _){const B=[];for(const G of R)(G.title||"").toLowerCase().includes(u)&&B.push(G);B.length>0&&g.set(v,B)}return g});fe(l,u=>{s.planTemplateList.value;const _=u.trim().toLowerCase();if(!_||ae.organizationMethod!=="by_group_time"&&ae.organizationMethod!=="by_group_abc")return;const g=ae.groupedTemplates;for(const[v,R]of g){let B=!1;for(const G of R)if((G.title||"").toLowerCase().includes(_)){B=!0;break}B&&ae.isGroupCollapsed(v)&&ae.toggleGroupCollapse(v)}});const f=u=>{const _=u??"null";return ae.groupCollapseState[_]??!1},E=u=>{ae.toggleGroupCollapse(u)},k=async u=>{await ae.selectTemplate(u),u.planTemplateId?(await s.load(u.planTemplateId),ae.hasTaskRequirementModified=!1):(s.reset(),ae.hasTaskRequirementModified=!1),Re.switchToTab("config"),i("templateSelected",u)};return(u,_)=>(h(),y("div",gh,[n("div",yh,[n("button",{class:"new-task-btn",onClick:b},[A(p(F),{icon:"carbon:add",width:"16"}),ce(" "+d(u.$t("sidebar.newPlan")),1)]),n("div",bh,[n("div",_h,[n("label",wh,d(u.$t("sidebar.organizationLabel")),1),n("select",{value:p(ae).organizationMethod,onChange:m,class:"organization-select"},[n("option",Sh,d(u.$t("sidebar.organizationByTime")),1),n("option",Th,d(u.$t("sidebar.organizationByAbc")),1),n("option",Ph,d(u.$t("sidebar.organizationByGroupTime")),1),n("option",Eh,d(u.$t("sidebar.organizationByGroupAbc")),1)],40,$h)]),n("div",kh,[n("label",Ch,d(u.$t("sidebar.searchLabel")),1),n("div",Rh,[A(p(F),{icon:"carbon:search",width:"16",class:"search-icon"}),ve(n("input",{"onUpdate:modelValue":_[0]||(_[0]=g=>l.value=g),type:"text",class:"search-input",placeholder:u.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Ih),[[Te,l.value]]),l.value?(h(),y("button",{key:0,class:"search-clear-btn",onClick:_[1]||(_[1]=g=>l.value=""),title:u.$t("sidebar.clearSearch")||"Clear search"},[A(p(F),{icon:"carbon:close",width:"14"})],8,Ah)):V("",!0)])])])]),n("div",xh,[p(ae).isLoading?(h(),y("div",Mh,[A(p(F),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),n("span",null,d(u.$t("sidebar.loading")),1)])):p(ae).errorMessage?(h(),y("div",Fh,[A(p(F),{icon:"carbon:warning",width:"20"}),n("span",null,d(p(ae).errorMessage),1),n("button",{onClick:_[2]||(_[2]=(...g)=>p(ae).loadPlanTemplateList&&p(ae).loadPlanTemplateList(...g)),class:"retry-btn"},d(u.$t("sidebar.retry")),1)])):p(s).planTemplateList.value.length===0?(h(),y("div",Dh,[A(p(F),{icon:"carbon:document",width:"32"}),n("span",null,d(u.$t("sidebar.noTemplates")),1)])):(h(!0),y(de,{key:3},he(c.value,([g,v])=>(h(),y(de,{key:g||"ungrouped"},[(p(ae).organizationMethod==="by_group_time"||p(ae).organizationMethod==="by_group_abc")&&v.length>0?(h(),y("div",{key:0,class:"group-header",onClick:ge(R=>E(g),["prevent"]),title:f(g)?u.$t("sidebar.expandGroup"):u.$t("sidebar.collapseGroup")},[n("button",{type:"button",class:"group-toggle-btn",onClick:ge(R=>E(g),["stop","prevent"]),title:f(g)?u.$t("sidebar.expandGroup"):u.$t("sidebar.collapseGroup")},[A(p(F),{icon:f(g)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Uh),A(p(F),{icon:"carbon:folder",width:"16"}),n("span",Lh,d(g===null||g===""?u.$t("sidebar.ungroupedMethods"):g),1),n("span",Oh,"("+d(v.length)+")",1)],8,Nh)):V("",!0),(p(ae).organizationMethod==="by_group_time"||p(ae).organizationMethod==="by_group_abc")&&f(g)?V("",!0):(h(!0),y(de,{key:1},he(v,R=>(h(),y("div",{key:R.planTemplateId||"unknown",class:ue(["sidebar-content-list-item",{"sidebar-content-list-item-active":R.planTemplateId===p(s).currentPlanTemplateId.value,"grouped-item":p(ae).organizationMethod==="by_group_time"||p(ae).organizationMethod==="by_group_abc"}]),onClick:B=>k(R)},[n("div",qh,[A(p(F),{icon:"carbon:document",width:"20"})]),n("div",Hh,[n("div",Vh,d(R.title||u.$t("sidebar.unnamedPlan")),1)]),n("div",jh,d(r(p(s).parseDateTime(R.updateTime||R.createTime))),1),n("div",zh,[n("button",{class:"delete-task-btn",title:u.$t("sidebar.deleteTemplate"),onClick:ge(B=>p(ae).deleteTemplate(R),["stop"])},[A(p(F),{icon:"carbon:close",width:"16"})],8,Wh)])],10,Bh))),128))],64))),128))])]))}}),Kh=Se(Gh,[["__scopeId","data-v-c5867107"]]),Jh={class:"sidebar-content"},Xh={class:"sidebar-content-header"},Yh={class:"sidebar-content-title"},Qh={class:"tab-switcher"},Zh=["disabled"],ef={key:0,class:"tab-content"},tf={key:1,class:"tab-content config-tab"},sf={key:0,class:"config-container"},of={class:"template-info-header"},nf={class:"template-info"},af={class:"template-id"},lf=["title"],rf=$e({name:"SidebarPanel",__name:"Sidebar",setup(o,{expose:t}){const e=at(),s=Qe(),a=x(80),l=x(!1),i=x(0),m=x(0),b=E=>{l.value=!0,i.value=E.clientX,m.value=a.value,document.addEventListener("mousemove",r),document.addEventListener("mouseup",c),document.body.style.cursor="col-resize",document.body.style.userSelect="none",E.preventDefault()},r=E=>{if(!l.value)return;const k=window.innerWidth,_=(E.clientX-i.value)/k*100;let g=m.value+_;g=Math.max(15,Math.min(100,g)),a.value=g},c=()=>{l.value=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",a.value.toString())},f=()=>{a.value=80,localStorage.setItem("sidebarWidth","80")};return Me(async()=>{await ae.loadPlanTemplateList(),e.loadAvailableTools();const E=localStorage.getItem("sidebarWidth");E&&(a.value=parseFloat(E))}),Ue(()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",c)}),t({loadPlanTemplateList:ae.loadPlanTemplateList,toggleSidebar:Re.toggleSidebar,currentPlanTemplateId:s.currentPlanTemplateId}),(E,k)=>(h(),y("div",{class:ue(["sidebar-wrapper",{"sidebar-wrapper-collapsed":p(Re).isCollapsed}]),style:Je({width:a.value+"%"})},[n("div",Jh,[n("div",Xh,[n("div",Yh,d(E.$t("sidebar.title")),1)]),n("div",Qh,[n("button",{class:ue(["tab-button",{active:p(Re).currentTab==="list"}]),onClick:k[0]||(k[0]=u=>p(Re).switchToTab("list"))},[A(p(F),{icon:"carbon:list",width:"16"}),ce(" "+d(E.$t("sidebar.templateList")),1)],2),n("button",{class:ue(["tab-button",{active:p(Re).currentTab==="config"}]),onClick:k[1]||(k[1]=u=>p(Re).switchToTab("config")),disabled:!p(s).selectedTemplate.value},[A(p(F),{icon:"carbon:settings",width:"16"}),ce(" "+d(E.$t("sidebar.configuration")),1)],10,Zh)]),p(Re).currentTab==="list"?(h(),y("div",ef,[A(Kh)])):p(Re).currentTab==="config"?(h(),y("div",tf,[p(s).selectedTemplate.value?(h(),y("div",sf,[n("div",of,[n("div",nf,[n("h3",null,d(p(s).selectedTemplate.value.title||E.$t("sidebar.unnamedPlan")),1),n("span",af,"ID: "+d(p(s).selectedTemplate.value.planTemplateId),1)]),n("button",{class:"back-to-list-btn",onClick:k[2]||(k[2]=u=>p(Re).switchToTab("list"))},[A(p(F),{icon:"carbon:arrow-left",width:"16"})])]),A(vh),A(Xu)])):V("",!0)])):V("",!0)]),n("div",{class:"sidebar-resizer",onMousedown:b,onDblclick:f,title:E.$t("sidebar.resizeHint")},k[3]||(k[3]=[n("div",{class:"resizer-line"},null,-1)]),40,lf)],6))}}),cf=Se(rf,[["__scopeId","data-v-1c6f7337"]]);function uf(){const o=et(),t=Ze(),{showToast:e}=ws(),{t:s}=De(),a=r=>{const c={currentPlanId:r.currentPlanId,status:r.completed?"completed":"running"};return r.rootPlanId&&(c.rootPlanId=r.rootPlanId),r.summary&&(c.summary=r.summary),r.completed!==void 0&&(c.completed=r.completed),r.agentExecutionSequence&&(c.agentExecutionSequence=r.agentExecutionSequence),c},l=r=>{if(!r)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(r)){const[c,f,E,k=0,u=0,_=0,g=0]=r,v=new Date(c,f-1,E,k,u,_,Math.floor(g/1e6));return isNaN(v.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",r),new Date):v}if(typeof r=="string"){let c=new Date(r);if(!isNaN(c.getTime()))return c;const f=r.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(f){const[,E,k,u,_,g,v,R]=f;if(c=new Date(parseInt(E),parseInt(k)-1,parseInt(u),parseInt(_),parseInt(g),parseInt(v),R?parseInt(R.substring(0,3)):0),!isNaN(c.getTime()))return c}return!r.includes("Z")&&!r.includes("+")&&!r.includes("-",10)&&(c=new Date(r+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",r),new Date)}if(typeof r=="number"){const c=r.toString().length<13?r*1e3:r,f=new Date(c);return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",r),new Date):f}return console.warn("[useConversationHistory] Unknown date format:",r,typeof r),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",r,c),new Date}},i=r=>{if(!r)return;console.log("[useConversationHistory] Processing record:",{userRequest:r.userRequest,startTime:r.startTime,startTimeType:typeof r.startTime,endTime:r.endTime,endTimeType:typeof r.endTime});const c=r.userRequest||r.title||"History Round",f=o.createDialog(c),E=Pe.getConversationId();if(E){const k=o.getDialog(f.id);k&&(k.conversationId=E,r.rootPlanId&&(k.planId=r.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",f.id,E))}if(r.userRequest&&r.startTime){const k=l(r.startTime);console.log("[useConversationHistory] Parsed date:",{original:r.startTime,parsed:k,parsedISO:k.toISOString(),isValid:!isNaN(k.getTime())});const u={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:r.userRequest,timestamp:k,isStreaming:!1};o.addMessageToDialog(f.id,u)}if(r.currentPlanId){const k=r.summary||r.result||r.message||"Execution completed",u=a(r),_={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:k,timestamp:r.endTime&&r.endTime?l(r.endTime):r.startTime?l(r.startTime):new Date,isStreaming:!1,planExecution:u};o.addMessageToDialog(f.id,_),r.rootPlanId&&t.setCachedPlanRecord(r.rootPlanId,u)}},m=async(r,c=!1,f=!0)=>{if(!r){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&o.clearMessages(),Pe.setConversationId(r),o.setConversationId(r);const E=await ft.getConversationHistory(r);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const k=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:k.startTime,endTime:k.endTime,startTimeType:typeof k.startTime})}for(const k of E)i(k);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),f&&e(s("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:m,restoreConversationHistory:async r=>m(r,!1,!1),processHistoryRecord:i}}let Mt=null;function df(){return Mt||(Mt=uf()),Mt}const pf={class:"direct-page"},mf={class:"direct-chat"},hf={class:"chat-header"},ff={class:"header-actions"},vf=["title"],gf=["title"],yf=["title"],bf={class:"chat-content"},_f=["title"],wf={class:"message-content"},$f=$e({name:"DirectIndex",__name:"index",setup(o){const t=mo(),e=ho(),s=bt(),{toast:a}=ws(),l=et(),i=Ze(),m=df(),b=x(""),r=x(),c=x(),f=x(null),E=x(50),k=x(!1),u=x(0),_=x(0),g=se(()=>{if(Re.isCollapsed)return E.value;let T=26;c.value&&c.value.sidebarWidth!==void 0&&(T=c.value.sidebarWidth);const w=100-T;return Math.max(20,Math.min(w,E.value))});Me(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),fe(()=>i.planExecutionRecords,D=>{for(const[j,J]of D.entries())P(j)&&(r.value&&typeof r.value.updateDisplayedPlanProgress=="function"&&r.value.updateDisplayedPlanProgress(j),J.completed&&j===f.value&&(Array.from(D.entries()).some(([be,_e])=>be!==j&&_e&&!_e.completed&&_e.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),f.value=null)))},{deep:!0}),fe(()=>i.trackedPlanIds,D=>{if(!f.value&&D.value.size>0){const j=Array.from(D.value)[0];f.value=j,console.log("[Direct] Set currentRootPlanId to:",j)}},{deep:!0});const T=Pe.getConversationId();if(T&&(console.log("[Direct] Found saved conversationId, restoring conversation:",T),Ie(async()=>{try{await m.restoreConversationHistory(T)}catch(D){console.error("[DirectView] Failed to restore conversation history:",D)}})),ae.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const D=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",D),D.trim()?(s.markTaskAsProcessed(),Ie(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",D),await l.sendMessage({input:D})}catch(j){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",j),b.value=D}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(b.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",b.value),console.log("[Direct] No unprocessed task in store"));const w=localStorage.getItem("directPanelWidth");w&&(E.value=parseFloat(w)),console.log("[Direct] Final prompt value:",b.value)}),fe(()=>s.currentTask,T=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",T),T&&!T.processed&&T.prompt.trim()){const w=T.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",w),Ie(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",w),await l.sendMessage({input:w})}catch(D){console.warn("[Direct] messageDialog.sendMessage failed for new task:",D)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),fe(()=>b.value,(T,w)=>{console.log("[Direct] prompt value changed from:",w,"to:",T)},{immediate:!1}),Ue(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),f.value=null,i.cleanup(),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",B)});const v=T=>{k.value=!0,u.value=T.clientX,_.value=E.value,document.addEventListener("mousemove",R),document.addEventListener("mouseup",B),document.body.style.cursor="col-resize",document.body.style.userSelect="none",T.preventDefault()},R=T=>{if(!k.value)return;const w=window.innerWidth,j=(T.clientX-u.value)/w*100;let J=_.value+j;J=Math.max(20,Math.min(80,J)),E.value=J},B=()=>{k.value=!1,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",B),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},G=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},P=(T,w=!1)=>!f.value||T===f.value||w&&(T==="ui-state"||T==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",T,"current:",f.value),!1),I=T=>{console.log("[DirectView] Step selected:",T),r.value&&typeof r.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",T),r.value.handleStepSelected(T)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},U=()=>{e.push("/home")},M=()=>{e.push("/configs")},H=async()=>{if(Pe.selectMemoryId){console.log("[DirectView] Memory selected:",Pe.selectMemoryId);try{await m.loadConversationHistory(Pe.selectMemoryId,!0,!0)}catch(T){console.error("[DirectView] Failed to load conversation history:",T)}}},$=()=>{Pe.clearMemoryId(),Pe.clearConversationId(),l.reset()};return(T,w)=>(h(),y("div",pf,[n("div",mf,[A(cf,{ref_key:"sidebarRef",ref:c},null,512),n("div",{class:"left-panel",style:Je({width:g.value+"%"})},[n("div",hf,[n("button",{class:"back-button",onClick:U},[A(p(F),{icon:"carbon:arrow-left"})]),n("h2",null,d(T.$t("conversation")),1),n("div",ff,[A(go),n("button",{class:"config-button",onClick:$,title:T.$t("memory.newChat")},[A(p(F),{icon:"carbon:add",width:"20"})],8,vf),n("button",{class:"config-button",onClick:M,title:T.$t("direct.configuration")},[A(p(F),{icon:"carbon:settings-adjust",width:"20"})],8,gf),n("button",{class:"cron-task-btn",onClick:w[0]||(w[0]=D=>p(Pe).toggleSidebar()),title:T.$t("memory.selectMemory")},[A(p(F),{icon:"carbon:calendar",width:"20"})],8,yf)])]),n("div",bf,[A(tl,{onStepSelected:I})]),(h(),ye(Tl,{key:T.$i18n.locale,"initial-value":b.value},null,8,["initial-value"]))],4),n("div",{class:"panel-resizer",onMousedown:v,onDblclick:G,title:T.$t("direct.panelResizeHint")},w[1]||(w[1]=[n("div",{class:"resizer-line"},null,-1)]),40,_f),A(bc,{ref_key:"rightPanelRef",ref:r,style:Je({width:100-E.value+"%"}),"current-root-plan-id":f.value},null,8,["style","current-root-plan-id"])]),A(hr,{onMemorySelected:H}),p(a).show?(h(),y("div",{key:0,class:ue(["message-toast",p(a).type])},[n("div",wf,[n("span",null,d(p(a).text),1)])],2)):V("",!0)]))}}),Gf=Se($f,[["__scopeId","data-v-90b5539d"]]);export{Gf as default};
//# sourceMappingURL=index-y1dNxTca.js.map
