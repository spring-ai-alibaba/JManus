import{_ as fs}from"./Java-AI-BYpq8IxI.js";import{d as Fe,u as qe,a as v,b as h,n as Se,e as n,f as V,g as R,i as p,h as ye,t as u,F as be,q as $e,j as ke,l as Ce,A as Eo,c as ce,B as Xe,r as x,o as He,C as Pe,D as Ve,w as Te,m as De,E as Kt,G as jt,v as vs,H as ko,I as je,J as Co,z as Ue,T as Ct,p as Qe,K as Io,y as mt,M as gs,N as dt,O as ys,x as bs}from"./index-C2ljOg3j.js";import{I as A,_ as Me}from"./_plugin-vue_export-helper-C9VfXUJa.js";import{u as Et,m as xe,P as _s,D as so,a as tt,t as fe,s as Ro}from"./templateStore-CNhbZ4MJ.js";import{P as no,L as ws}from"./plan-template-with-tool-api-service-Byf09fYV.js";import{M as xo,u as It,a as Ss,b as Ao}from"./useToast-DKgeULCo.js";import"./llm-check-CJy4TeZw.js";const $s={class:"sub-plan-info"},Ps={class:"sub-plan-details"},Ts={class:"sub-plan-title"},Es={key:0,class:"nesting-level"},ks={class:"sub-plan-id"},Cs={class:"sub-plan-meta"},Is={key:0,class:"trigger-tool"},Rs={class:"trigger-text"},xs={key:0,class:"sub-plan-agents-steps"},As={class:"agents-steps-header"},Fs={class:"agents-label"},Ms={class:"agents-steps-list"},Ds=["onClick"],Ns={class:"agent-step-header"},Us=["title"],Os={class:"sub-agent-execution-info"},Ls={key:0,class:"agent-result"},Hs={class:"result-header"},Bs={class:"result-label"},qs={class:"result-content"},js={key:1,class:"agent-error"},Vs={class:"error-header"},Gs={class:"error-label"},zs={class:"error-content"},Ws={key:2,class:"think-act-preview"},Js={class:"think-act-header"},Ks={class:"think-act-label"},Xs={class:"think-act-steps-preview"},Ys=["onClick"],Zs={class:"step-number"},Qs={class:"step-description"},en={key:0,class:"more-steps"},tn={class:"more-steps-text"},on={key:3,class:"nested-sub-plans"},sn={class:"nested-sub-plans-header"},nn={class:"nested-label"},an={class:"nested-sub-plans-list"},ln={key:4,class:"direct-sub-plans"},rn={class:"direct-sub-plans-header"},cn={class:"direct-label"},un={class:"direct-sub-plans-list"},dn=Fe({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(s,{emit:e}){const t=s,o=e,{t:a}=qe(),l=()=>`nesting-level-${t.nestingLevel}`,r=()=>t.subPlan.completed?"completed":t.subPlan.agentExecutionSequence?.some(C=>C.status==="RUNNING")?"running":t.subPlan.agentExecutionSequence?.some(C=>C.status==="FINISHED")?"in-progress":"pending",d=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},g=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},c=I=>{switch(I){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},i=I=>{switch(I){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},f=I=>{switch(I){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},E=I=>I.thinkActSteps?.some(D=>D.subPlanExecutionRecord)??!1,P=I=>I.thinkActSteps?.filter(D=>D.subPlanExecutionRecord)??[],m=()=>{o("sub-plan-selected",-1,t.subPlanIndex,t.subPlan)},$=(I,D)=>{const C=D.stepId??`subplan-${t.subPlanIndex}-agent-${I}`;o("step-selected",C)},b=(I,D,C)=>{const _=C.stepId??`subplan-${t.subPlanIndex}-agent-${I}`;o("step-selected",_)},y=(I,D,C)=>{o("sub-plan-selected",I,D,C)},T=I=>{o("step-selected",I)};return(I,D)=>{const C=Eo("RecursiveSubPlan",!0);return h(),v("div",{class:Se(["recursive-sub-plan",l()])},[n("div",{class:"sub-plan-header",onClick:m},[n("div",$s,[R(p(A),{icon:g(),class:"sub-plan-status-icon"},null,8,["icon"]),n("div",Ps,[n("div",Ts,[ye(u(I.subPlan.title||I.$t("chat.subPlan"))+" #"+u(I.subPlanIndex+1)+" ",1),(I.nestingLevel??0)>0?(h(),v("span",Es,"(L"+u((I.nestingLevel??0)+1)+")",1)):V("",!0)]),n("div",ks,u(I.subPlan.currentPlanId),1)])])]),n("div",Cs,[I.subPlan.parentActToolCall?(h(),v("div",Is,[R(p(A),{icon:"carbon:function",class:"trigger-icon"}),n("span",Rs,u(I.subPlan.parentActToolCall.name),1)])):V("",!0),n("div",{class:Se(["sub-plan-status-badge",r()])},u(d()),3)]),I.subPlan.agentExecutionSequence?.length?(h(),v("div",xs,[n("div",As,[n("span",Fs,u(I.$t("chat.agentExecutions"))+":",1)]),n("div",Ms,[(h(!0),v(be,null,$e(I.subPlan.agentExecutionSequence,(_,B)=>(h(),v("div",{key:_.id||B,class:Se(["agent-step-item",c(_.status)]),onClick:N=>$(B,_)},[n("div",Ns,[R(p(A),{icon:i(_.status),class:"agent-icon"},null,8,["icon"]),n("span",{class:"agent-name",title:_.agentName==="ConfigurableDynaAgent"?I.$t("chat.clickToViewExecutionDetails"):""},u(_.agentName==="ConfigurableDynaAgent"?I.$t("chat.funcAgentExecutionDetails"):_.agentName||I.$t("chat.unknownAgent")),9,Us),n("div",{class:Se(["agent-status-badge",c(_.status)])},u(f(_.status)),3)]),n("div",Os,[_.result?(h(),v("div",Ls,[n("div",Hs,[R(p(A),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Bs,u(I.$t("chat.agentResult"))+":",1)]),n("pre",qs,u(_.result),1)])):V("",!0),_.errorMessage?(h(),v("div",js,[n("div",Vs,[R(p(A),{icon:"carbon:warning",class:"error-icon"}),n("span",Gs,u(I.$t("chat.errorMessage"))+":",1)]),n("pre",zs,u(_.errorMessage),1)])):V("",!0),_.thinkActSteps?.length?(h(),v("div",Ws,[n("div",Js,[R(p(A),{icon:"carbon:thinking",class:"think-act-icon"}),n("span",Ks,u(I.$t("chat.thinkActSteps"))+" ("+u(_.thinkActSteps.length)+")",1)]),n("div",Xs,[(h(!0),v(be,null,$e(_.thinkActSteps.slice(0,I.maxVisibleSteps??2),(N,L)=>(h(),v("div",{key:N.id||L,class:"think-act-step-preview",onClick:ke(S=>b(B,L,_),["stop"])},[n("span",Zs,"#"+u(L+1),1),n("span",Qs,u(N.actionDescription||I.$t("chat.thinking")),1),R(p(A),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Ys))),128)),_.thinkActSteps.length>(I.maxVisibleSteps??2)?(h(),v("div",en,[n("span",tn,u(I.$t("chat.andMoreSteps",{count:_.thinkActSteps.length-(I.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),E(_)?(h(),v("div",on,[n("div",sn,[R(p(A),{icon:"carbon:tree-view-alt",class:"nested-icon"}),n("span",nn,u(I.$t("chat.nestedSubPlans")),1)]),n("div",an,[(h(!0),v(be,null,$e(P(_),(N,L)=>(h(),Ce(C,{key:N.id||L,"sub-plan":N.subPlanExecutionRecord,"sub-plan-index":L,"nesting-level":(I.nestingLevel??0)+1,"max-nesting-depth":I.maxNestingDepth??3,"max-visible-steps":I.maxVisibleSteps??2,onSubPlanSelected:y,onStepSelected:T},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),_.subPlanExecutionRecords?.length?(h(),v("div",ln,[n("div",rn,[R(p(A),{icon:"carbon:tree-view",class:"direct-icon"}),n("span",cn,u(I.$t("chat.directSubPlans")),1)]),n("div",un,[(h(!0),v(be,null,$e(_.subPlanExecutionRecords,(N,L)=>(h(),Ce(C,{key:N.currentPlanId||L,"sub-plan":N,"sub-plan-index":L,"nesting-level":(I.nestingLevel??0)+1,"max-nesting-depth":I.maxNestingDepth??3,"max-visible-steps":I.maxVisibleSteps??2,onSubPlanSelected:y,onStepSelected:T},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,Ds))),128))])])):V("",!0)],2)}}}),pn=Me(dn,[["__scopeId","data-v-4b03d9b7"]]),mn={class:"execution-details"},hn={key:0,class:"plan-overview"},fn={key:0,class:"parent-tool-call"},vn={class:"parent-tool-header"},gn={class:"tool-label"},yn={class:"tool-name"},bn={key:0,class:"tool-parameters"},_n={class:"param-label"},wn={class:"param-content"},Sn={key:1,class:"agent-execution-container"},$n={class:"section-title"},Pn=["onClick"],Tn={class:"agent-info"},En={class:"agent-details"},kn=["title"],Cn={class:"request-content"},In={class:"agent-controls"},Rn={class:"agent-execution-info"},xn={key:0,class:"agent-result"},An={class:"result-header"},Fn={class:"result-label"},Mn={class:"result-content"},Dn={key:1,class:"agent-error"},Nn={class:"error-header"},Un={class:"error-label"},On={class:"error-content"},Ln={key:0,class:"sub-plans-container"},Hn={class:"sub-plans-header"},Bn={class:"sub-plans-title"},qn={class:"sub-plans-list"},jn=Fe({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(s,{emit:e}){const t=e,{t:o}=qe(),a=f=>{f.stepId?t("step-selected",f.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",f)},l=f=>{switch(f){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=f=>{switch(f){case"RUNNING":return o("chat.status.executing");case"FINISHED":return o("chat.status.completed");case"IDLE":default:return o("chat.status.pending")}},d=f=>{switch(f){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},g=(f,E,P)=>{t("sub-plan-selected",f,E,P)},c=f=>{t("step-selected",f)},i=f=>{if(!f)return"";try{const E=JSON.parse(f);return JSON.stringify(E,null,2)}catch{return f}};return(f,E)=>(h(),v("div",mn,[f.planExecution?(h(),v("div",hn,[f.planExecution.parentActToolCall?(h(),v("div",fn,[n("div",vn,[R(p(A),{icon:"carbon:flow",class:"tool-icon"}),n("span",gn,u(f.$t("chat.triggeredByTool"))+":",1),n("span",yn,u(f.planExecution.parentActToolCall.name),1)]),f.planExecution.parentActToolCall.parameters?(h(),v("div",bn,[n("span",_n,u(f.$t("common.parameters"))+":",1),n("pre",wn,u(i(f.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(f.planExecution?.agentExecutionSequence?.length??0)>0?(h(),v("div",Sn,[n("h4",$n,u(f.$t("chat.agentExecutionSequence")),1),(h(!0),v(be,null,$e(f.planExecution?.agentExecutionSequence,(P,m)=>(h(),v("div",{key:P.id||m,class:Se(["agent-execution-item",l(P.status)])},[n("div",{class:"agent-header",onClick:$=>a(P)},[n("div",Tn,[R(p(A),{icon:d(P.status),class:"agent-status-icon"},null,8,["icon"]),n("div",En,[n("div",{class:"agent-name",title:P.agentName==="ConfigurableDynaAgent"?f.$t("chat.clickToViewExecutionDetails"):""},u(P.agentName==="ConfigurableDynaAgent"?f.$t("chat.funcAgentExecutionDetails"):P.agentName||f.$t("chat.unknownAgent")),9,kn),n("pre",Cn,u(P.agentRequest),1)])]),n("div",In,[n("div",{class:Se(["agent-status-badge",l(P.status)])},u(r(P.status)),3),R(p(A),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Pn),n("div",Rn,[P.result?(h(),v("div",xn,[n("div",An,[R(p(A),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Fn,u(f.$t("chat.agentResult"))+":",1)]),n("pre",Mn,u(P.result),1)])):V("",!0),P.errorMessage?(h(),v("div",Dn,[n("div",Nn,[R(p(A),{icon:"carbon:warning",class:"error-icon"}),n("span",Un,u(f.$t("chat.errorMessage"))+":",1)]),n("pre",On,u(P.errorMessage),1)])):V("",!0)]),P.subPlanExecutionRecords?.length?(h(),v("div",Ln,[n("div",Hn,[R(p(A),{icon:"carbon:tree-view",class:"sub-plans-icon"}),n("span",Bn,u(f.$t("chat.subPlanExecutions"))+" ("+u(P.subPlanExecutionRecords.length)+") ",1)]),n("div",qn,[(h(!0),v(be,null,$e(P.subPlanExecutionRecords,($,b)=>(h(),Ce(pn,{key:$.currentPlanId||b,"sub-plan":$,"sub-plan-index":b,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:g,onStepSelected:c},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2))),128))])):V("",!0)]))}}),Vn=Me(jn,[["__scopeId","data-v-ee75d960"]]);function Fo(){return{formatResponseText:g=>g?g.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:g=>{if(!g||isNaN(g.getTime()))return"";const i=new Date().getTime()-g.getTime();if(i<6e4)return"Just now";if(i<36e5)return`${Math.floor(i/6e4)} minutes ago`;if(i<864e5)return`${Math.floor(i/36e5)} hours ago`;try{return g.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.warn("[useMessageFormatting] Error formatting timestamp:",g,f),""}},getMessageClasses:g=>ce(()=>({user:g.type==="user",assistant:g.type==="assistant",streaming:g.isStreaming,"has-error":!!g.error,"has-thinking":!!g.thinking,"has-execution":!!g.planExecution})),formatFileSize:g=>{if(g===0)return"0 B";const c=1024,i=["B","KB","MB","GB"],f=Math.floor(Math.log(g)/Math.log(c));return parseFloat((g/Math.pow(c,f)).toFixed(2))+" "+i[f]},truncateText:(g,c=100)=>!g||g.length<=c?g:g.substring(0,c)+"...",stripHtml:g=>g.replace(/<[^>]*>/g,""),hasDisplayableContent:g=>!!(g.content||(g.thinking??!1)||(g.planExecution??!1)||g.error),getMessageStatus:g=>g.error?"Send failed":g.isStreaming?"Typing...":g.type==="assistant"&&!g.content&&!g.thinking?"Waiting for response":""}}class Vt{static BASE_URL="/api/executor";static async getDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`);if(t.status===404)return null;if(!t.ok){const l=await t.text();throw new Error(`Failed to get detailed information: ${t.status} - ${l}`)}const o=await t.text(),a=JSON.parse(o);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(t){return console.error("[CommonApiService] Failed to get plan details:",t),null}}static async deleteExecutionDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`,{method:"DELETE"});if(!t.ok){const o=await t.text();throw new Error(`Failed to delete execution details: ${t.status} - ${o}`)}return await t.json()}catch(t){throw console.error("[CommonApiService] Failed to delete execution details:",t),t}}static async submitFormInput(e,t){const o=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let l;try{l=await o.json()}catch{l={message:`Failed to submit form input: ${o.status}`}}throw new Error(l.message||`Failed to submit form input: ${o.status}`)}const a=o.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await o.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}const Gn={class:"user-input-form-container"},zn={class:"user-input-header"},Wn={class:"user-input-title"},Jn={class:"user-input-message"},Kn={key:0,class:"form-description"},Xn={key:0,class:"form-grid"},Yn=["for"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],oa=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","required","onUpdate:modelValue"],na={value:""},aa=["value"],la={key:6,class:"checkbox-group"},ra=["id","name","value","onUpdate:modelValue"],ia={class:"checkbox-label"},ca={key:7,class:"radio-group"},ua=["id","name","value","onUpdate:modelValue"],da={class:"radio-label"},pa=["id","name","placeholder","required","onUpdate:modelValue"],ma={key:1,class:"form-group"},ha={for:"form-input-genericInput"},fa={type:"submit",class:"submit-user-input-btn"},va=Fe({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(s,{emit:e}){const t=s,o=e;qe();const a=Xe({}),l=x(t.genericInput??""),r=x(!1),d=x(null),g=()=>{const E=t.userInputWaitState?.formInputs;E&&E.length>0&&(!r.value||Object.keys(a).length!==E.length)&&(E.forEach((m,$)=>{(!($ in a)||m.type==="checkbox"&&!Array.isArray(a[$])||m.type!=="checkbox"&&a[$]==="")&&(m.type==="checkbox"?a[$]=[]:a[$]="")}),r.value=!0)};He(()=>{g()}),Pe(()=>t.userInputWaitState?.formInputs,()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{r.value=!1,g()},100)},{deep:!0});const c=async()=>{try{const E={},P=t.userInputWaitState?.formInputs;P&&P.length>0?Object.entries(a).forEach(([m,$])=>{const b=parseInt(m,10),T=P[b].label||`input_${m}`;Array.isArray($)?E[T]=$.join(", "):E[T]=$}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",t.planId),t.planId?(await Vt.submitFormInput(t.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),o("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},i=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(P=>P.trim()).filter(P=>P.length>0):[]:[],f=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Ve(()=>{d.value&&clearTimeout(d.value)}),(E,P)=>(h(),v("div",Gn,[n("div",zn,[R(p(A),{icon:"carbon:user",class:"user-icon"}),n("h4",Wn,u(E.$t("chat.userInputRequired")),1)]),n("p",Jn,u(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),v("p",Kn,u(E.userInputWaitState?.formDescription),1)):V("",!0),n("form",{onSubmit:ke(c,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),v("div",Xn,[(h(!0),v(be,null,$e(E.userInputWaitState?.formInputs,(m,$)=>(h(),v("div",{key:$,class:"form-group"},[n("label",{for:`form-input-${m.label.replace(/\W+/g,"_")}`},u(m.label)+u(f(m.required)?" *":"")+": ",9,Yn),!m.type||m.type==="text"?Te((h(),v("input",{key:0,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input"},null,8,Zn)),[[De,a[$]]]):m.type==="email"?Te((h(),v("input",{key:1,type:"email",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input"},null,8,Qn)),[[De,a[$]]]):m.type==="number"?Te((h(),v("input",{key:2,type:"number",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input"},null,8,ea)),[[De,a[$]]]):m.type==="password"?Te((h(),v("input",{key:3,type:"password",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input"},null,8,ta)),[[De,a[$]]]):m.type==="textarea"?Te((h(),v("textarea",{key:4,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input form-textarea",rows:"4"},null,8,oa)),[[De,a[$]]]):m.type==="select"&&m.options?Te((h(),v("select",{key:5,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input form-select"},[n("option",na,u(E.$t("selectCommon.pleaseSelect")),1),(h(!0),v(be,null,$e(i(m.options),b=>(h(),v("option",{key:b,value:b},u(b),9,aa))),128))],8,sa)),[[Kt,a[$]]]):m.type==="checkbox"&&m.options?(h(),v("div",la,[(h(!0),v(be,null,$e(i(m.options),b=>(h(),v("label",{key:b,class:"checkbox-item"},[Te(n("input",{type:"checkbox",id:`form-input-${m.label.replace(/\W+/g,"_")}-${b.replace(/\W+/g,"_")}`,name:m.label,value:b,"onUpdate:modelValue":y=>a[$]=y,class:"form-checkbox"},null,8,ra),[[jt,a[$]]]),n("span",ia,u(b),1)]))),128))])):m.type==="radio"&&m.options?(h(),v("div",ca,[(h(!0),v(be,null,$e(i(m.options),b=>(h(),v("label",{key:b,class:"radio-item"},[Te(n("input",{type:"radio",id:`form-input-${m.label.replace(/\W+/g,"_")}-${b.replace(/\W+/g,"_")}`,name:m.label,value:b,"onUpdate:modelValue":y=>a[$]=y,class:"form-radio"},null,8,ua),[[vs,a[$]]]),n("span",da,u(b),1)]))),128))])):Te((h(),v("input",{key:8,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:f(m.required),"onUpdate:modelValue":b=>a[$]=b,class:"form-input"},null,8,pa)),[[De,a[$]]])]))),128))])):(h(),v("div",ma,[n("label",ha,u(E.$t("common.input"))+":",1),Te(n("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":P[0]||(P[0]=m=>l.value=m),class:"form-input"},null,512),[[De,l.value]])])),n("button",fa,u(E.$t("chat.userInput.submit")),1)],32)]))}}),ga=Me(va,[["__scopeId","data-v-e4d0802d"]]),ya={class:"response-section"},ba={class:"response-header"},_a={class:"response-avatar"},wa={class:"response-name"},Sa={key:0,class:"response-timestamp"},$a={class:"response-content"},Pa={key:1,class:"final-response"},Ta=["innerHTML"],Ea={class:"response-actions"},ka=["title"],Ca=["title"],Ia={key:2,class:"response-placeholder"},Ra={class:"typing-indicator"},xa={class:"typing-text"},Aa={key:3,class:"response-error"},Fa={class:"error-text"},Ma={key:4,class:"response-empty"},Da={class:"empty-text"},Na=Fe({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(s,{emit:e}){const t=s,o=e,{formatResponseText:a,formatTimestamp:l}=Fo(),r=async()=>{if(t.content)try{const i=t.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(i),o("copy")}catch(i){console.error("Failed to copy to clipboard:",i)}},d=()=>{o("regenerate")},g=()=>{o("retry")},c=i=>{console.log("[ResponseSection] User input submitted:",i),o("user-input-submitted",i)};return(i,f)=>(h(),v("div",ya,[n("div",ba,[n("div",_a,[R(p(A),{icon:"carbon:bot",class:"bot-icon"})]),n("div",wa,u(i.$t("chat.botName")),1),i.timestamp?(h(),v("div",Sa,u(p(l)(i.timestamp)),1)):V("",!0)]),n("div",$a,[i.userInputWaitState?.waiting?(h(),Ce(ga,ko({key:0,"user-input-wait-state":i.userInputWaitState},i.planId?{"plan-id":i.planId}:{},{"generic-input":i.genericInput??"",onUserInputSubmitted:c}),null,16,["user-input-wait-state","generic-input"])):V("",!0),i.content?(h(),v("div",Pa,[n("div",{class:"response-text",innerHTML:p(a)(i.content)},null,8,Ta),n("div",Ea,[n("button",{class:"action-btn copy-btn",onClick:r,title:i.$t("chat.copyResponse")},[R(p(A),{icon:"carbon:copy"})],8,ka),n("button",{class:"action-btn regenerate-btn",onClick:d,title:i.$t("chat.regenerateResponse")},[R(p(A),{icon:"carbon:renew"})],8,Ca)])])):i.isStreaming?(h(),v("div",Ia,[n("div",Ra,[f[0]||(f[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1)),n("span",xa,u(i.$t("chat.thinkingResponse")),1)])])):i.error?(h(),v("div",Aa,[R(p(A),{icon:"carbon:warning",class:"error-icon"}),n("span",Fa,u(i.error),1),n("button",{class:"retry-btn",onClick:g},u(i.$t("chat.retry")),1)])):(h(),v("div",Ma,[n("span",Da,u(i.$t("chat.waitingForResponse")),1)]))])]))}}),Ua=Me(Na,[["__scopeId","data-v-a03ac86f"]]);function Oa(){const o=x(new Set),a=Xe(new Map),l=Xe(new Map),r=Xe(new Map),d=Xe(new Map),g=x(!1),c=x(null),i=_=>d.get(_),f=(_,B)=>{if(!_){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}d.set(_,B),console.log("[usePlanExecution] Cached plan record:",_)},E=()=>Array.from(o.value),P=_=>{if(!_){console.warn("[usePlanExecution] Cannot track empty planId");return}o.value.add(_),l.set(_,0),r.set(_,0),console.log("[usePlanExecution] Tracking plan:",_),c.value||y(),$(_).catch(B=>{console.error(`[usePlanExecution] Initial poll failed for ${_}:`,B)})},m=_=>{o.value.delete(_),l.delete(_),r.delete(_),console.log("[usePlanExecution] Untracking plan:",_),o.value.size===0&&a.size===0&&T()},$=async _=>{if(_)try{console.log("[usePlanExecution] Polling plan status for:",_);const B=await Vt.getDetails(_);if(console.log("[usePlanExecution] Received plan details:",B?"YES":"NO",B),r.delete(_),!B){const S=r.get(_)||0;S<10?(r.set(_,S+1),console.log(`[usePlanExecution] Plan ${_} not found yet, retrying (${S+1}/10)`),setTimeout(()=>{o.value.has(_)&&$(_).catch(M=>{console.error(`[usePlanExecution] Retry poll failed for ${_}:`,M)})},1e3)):(console.warn(`[usePlanExecution] Plan ${_} not found after 10 attempts, giving up`),m(_));return}const N=l.get(_)||0;l.set(_,N+1);const L=B.rootPlanId||B.currentPlanId;if(!L){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",B);return}if(d.set(L,B),_!==L&&(d.set(_,B),console.log("[usePlanExecution] Stored record with both keys:",{planId:_,recordKey:L})),console.log("[usePlanExecution] Updated plan execution record:",{planId:_,recordKey:L,rootPlanId:B.rootPlanId,currentPlanId:B.currentPlanId,completed:B.completed,status:B.status,attempt:N+1}),B.completed){console.log(`[usePlanExecution] Plan ${L} completed, checking for summary...`);const S=Et();S.currentTask&&S.currentTask.isRunning&&(S.currentTask.isRunning=!1);const M=B.summary||B.result||B.message,U=a.get(L)||0;if(!M&&U<10)a.set(L,U+1),console.log(`[usePlanExecution] Plan ${L} completed but no summary yet, continuing to poll (${U+1}/10)`);else{console.log(`[usePlanExecution] Plan ${L} completed, cleaning up...`,{hasSummary:!!M,pollCount:U});try{await Vt.deleteExecutionDetails(L),console.log(`[usePlanExecution] Deleted execution details for plan: ${L}`)}catch(q){const j=q instanceof Error?q.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${j}`)}m(_),a.delete(L),setTimeout(()=>{d.delete(L),_!==L&&d.delete(_)},5e3)}}B.status==="failed"&&B.message&&!B.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${L} failed:`,B.message)}catch(B){const N=B instanceof Error?B.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${_}:`,N);const L=r.get(_)||0;L<10&&(r.set(_,L+1),console.log(`[usePlanExecution] Network error for ${_}, retrying (${L+1}/10)`),setTimeout(()=>{o.value.has(_)&&$(_).catch(S=>{console.error(`[usePlanExecution] Retry poll failed for ${_}:`,S)})},1e3*(L+1)))}},b=async()=>{if(g.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const _=new Set(o.value);for(const[B]of a.entries())_.add(B);if(_.size!==0)try{g.value=!0;const B=Array.from(_).map(N=>$(N));await Promise.all(B)}catch(B){console.error("[usePlanExecution] Failed to poll tracked plans:",B)}finally{g.value=!1}},y=()=>{c.value&&clearInterval(c.value),c.value=window.setInterval(()=>{b()},1e3),console.log("[usePlanExecution] Started adaptive polling")},T=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}c.value&&(clearInterval(c.value),c.value=null),console.log("[usePlanExecution] Stopped polling")},I=async _=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${_}`),await $(_)},D=_=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:_}),!_){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}Et().setTaskRunning(_),P(_)},C=()=>{T(),o.value.clear(),a.clear(),l.clear(),r.clear(),d.clear(),g.value=!1};return{planExecutionRecords:je(d),trackedPlanIds:je(o),isPolling:je(g),getPlanExecutionRecord:i,setCachedPlanRecord:f,getTrackedPlanIds:E,trackPlan:P,untrackPlan:m,handlePlanExecutionRequested:D,pollPlanStatusImmediately:I,startPolling:y,stopPolling:T,cleanup:C}}let Dt=null;function lt(){return Dt||(Dt=Oa()),Dt}function La(){const s=lt(),e=x([]),t=x(null),o=x(null),a=x(null),l=ce(()=>a.value),r=x(!1),d=x(null),g=x(null),c=x(null),i=ce(()=>t.value&&e.value.find(F=>F.id===t.value)||null),f=ce(()=>e.value.length>0),E=ce(()=>e.value.length),P=ce(()=>{if(!o.value)return i.value?.messages||[];const F=[];for(const H of e.value)H.conversationId===o.value&&F.push(...H.messages);return F.sort((H,z)=>H.timestamp.getTime()-z.timestamp.getTime())}),m=F=>{const H={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:F||"New Conversation",messages:[],...o.value&&{conversationId:o.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return e.value.push(H),t.value=H.id,console.log("[useMessageDialog] Created new dialog round:",H.id,{conversationId:o.value,rootPlanId:a.value}),H},$=F=>e.value.find(H=>H.id===F)||null,b=F=>{if(e.value.forEach(H=>{H.isActive=!1}),F){const H=e.value.find(z=>z.id===F);H&&(H.isActive=!0,t.value=F)}else t.value=null},y=(F,H)=>{const z=e.value.find(ee=>ee.id===F);z&&(z.messages.push(H),z.updatedAt=new Date)},T=(F,H,z)=>{const ee=e.value.find(ie=>ie.id===F);if(ee){const ie=ee.messages.findIndex(ne=>ne.id===H);ie!==-1&&(ee.messages[ie]={...ee.messages[ie],...z},ee.updatedAt=new Date)}},I=F=>{const H=e.value.findIndex(z=>z.id===F);if(H!==-1){const z=e.value[H];if(e.value.splice(H,1),console.log("[useMessageDialog] Deleted dialog round:",F),t.value===F){const ee=e.value.filter(ie=>ie.conversationId===z.conversationId);t.value=ee.length>0?ee[0].id:null,t.value&&b(t.value)}}},D=F=>{const H=e.value.filter(z=>z.planId===F);H.forEach(z=>{I(z.id)}),console.log(`[useMessageDialog] Deleted ${H.length} dialog round(s) for plan:`,F)},C=F=>{const H=e.value.filter(z=>z.conversationId===F);H.forEach(z=>{I(z.id)}),console.log(`[useMessageDialog] Deleted ${H.length} dialog round(s) for conversation:`,F),o.value===F&&(o.value=null)},_=()=>{e.value=[],t.value=null},B=async F=>{let H=null,z=null;try{if(r.value){const ve="Please wait for the current task to complete before starting a new one";return d.value=ve,{success:!1,error:ve}}r.value=!0,d.value=null,H=m();const ee={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:F.input,timestamp:new Date,isStreaming:!1,...F.uploadedFiles&&{attachments:F.uploadedFiles.map(ve=>typeof ve=="string"?new File([],ve):ve)}};y(H.id,ee),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},y(H.id,z);const ie=F;let ne;if(ie.toolName&&ie.replacementParams)if(ne=await so.executeByToolName(ie.toolName,ie.replacementParams,F.uploadedFiles,F.uploadKey,"VUE_DIALOG",ie.serviceGroup),ne.conversationId&&(o.value=ne.conversationId,H.conversationId=ne.conversationId,xe.setConversationId(ne.conversationId),console.log("[useMessageDialog] Conversation ID set:",ne.conversationId)),ne.planId){const ve=ne.planId;a.value=ve,H.planId=ve,T(H.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:ve,rootPlanId:ve,status:"running"},isStreaming:!1}),s.handlePlanExecutionRequested(ve),console.log("[useMessageDialog] Root plan ID set and tracking started:",ve)}else{const ve={content:ne.message||ne.result||"No response received",isStreaming:!1,thinking:""};T(H.id,z.id,ve)}else{O(z.id);let ve="";ne=await so.sendChatMessage(F,"VUE_DIALOG",oe=>{!H||!z||(oe.type==="start"&&oe.conversationId?(o.value=oe.conversationId,H.conversationId=oe.conversationId,xe.setConversationId(oe.conversationId),console.log("[useMessageDialog] Conversation ID set from stream:",oe.conversationId)):oe.type==="chunk"&&oe.content?(ve+=oe.content,T(H.id,z.id,{content:ve,isStreaming:!0,thinking:""})):oe.type==="done"?(G(z.id),T(H.id,z.id,{content:ve||"No response received",isStreaming:!1,thinking:""})):oe.type==="error"&&(G(z.id),T(H.id,z.id,{content:`Error: ${oe.message||"Streaming error occurred"}`,error:oe.message||"Streaming error occurred",isStreaming:!1})))}),G(z.id),ne.conversationId&&(o.value=ne.conversationId,H.conversationId=ne.conversationId,xe.setConversationId(ne.conversationId)),T(H.id,z.id,{content:ne.message||ve||"No response received",isStreaming:!1,thinking:""})}return{success:!0,...ne.planId&&{planId:ne.planId},...ne.conversationId&&{conversationId:ne.conversationId}}}catch(ee){const ie=ee instanceof Error?ee.message:"Failed to send message";return d.value=ie,console.error("[useMessageDialog] Send message failed:",ee),H&&z&&T(H.id,z.id,{content:`Error: ${ie}`,error:ie,isStreaming:!1}),{success:!1,error:ie}}finally{r.value=!1}},N=async F=>{let H=null,z=null;try{if(r.value){const re="Please wait for the current task to complete before starting a new one";return d.value=re,{success:!1,error:re}}r.value=!0,d.value=null;const ee=xe.getConversationId();ee&&!o.value&&(o.value=ee,console.log("[useMessageDialog] Restored conversationId from memoryStore:",ee)),H=m(F.title),F.title&&(H.title=F.title);const ie={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:F.title,timestamp:new Date,isStreaming:!1,...F.uploadedFiles&&{attachments:F.uploadedFiles.map(re=>typeof re=="string"?new File([],re):re)}};y(H.id,ie),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},y(H.id,z);const ne=F.toolName,ve=F.serviceGroup;if(!ne||ne.trim()==="")throw new Error("Tool name is required for plan execution");const oe=await _s.executePlan(ne,ve,F.params,F.uploadedFiles,F.replacementParams,F.uploadKey??void 0,"VUE_SIDEBAR");if(oe.conversationId){const re=oe.conversationId,W=o.value||xe.getConversationId();re!==W?(console.log("[useMessageDialog] Conversation ID changed:",W,"->",re),o.value=re,H.conversationId=re,xe.setConversationId(re)):(H.conversationId=re,console.log("[useMessageDialog] Conversation ID unchanged:",re))}else o.value&&(H.conversationId=o.value);if(oe.planId){const re=oe.planId;a.value=re,H.planId=re,T(H.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:re,rootPlanId:re,status:"running"},isStreaming:!1}),s.handlePlanExecutionRequested(re),console.log("[useMessageDialog] Root plan ID set and tracking started:",re)}else{const re={content:"Plan execution started",isStreaming:!1};T(H.id,z.id,re)}return{success:!0,...oe.planId&&{planId:oe.planId}}}catch(ee){const ie=ee instanceof Error?ee.message:"Failed to execute plan";return d.value=ie,console.error("[useMessageDialog] Execute plan failed:",ee),H&&z&&T(H.id,z.id,{content:`Error: ${ie}`,error:ie,isStreaming:!1}),r.value=!1,{success:!1,error:ie}}},L=(F,H,z)=>{const ee={};z!==void 0&&(ee.planExecution=z),T(F,H,ee)},S=F=>{const H={...F};return"agentExecutionSequence"in F&&Array.isArray(F.agentExecutionSequence)&&(H.agentExecutionSequence=F.agentExecutionSequence.map(z=>M(z))),H},M=F=>{const H={...F};return"subPlanExecutionRecords"in F&&Array.isArray(F.subPlanExecutionRecords)&&(H.subPlanExecutionRecords=F.subPlanExecutionRecords.map(z=>S(z))),H},U=(F,H,z)=>{i.value||m();const ee=i.value,ie={...z};z?.planExecution&&(ie.planExecution=S(z.planExecution));const ne={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:F,content:H,timestamp:new Date,isStreaming:!1,...ie};return ee.messages.push(ne),ee.updatedAt=new Date,ne},q=(F,H)=>{if(!i.value)return;const z={...H};H.planExecution&&(z.planExecution=S(H.planExecution));const ee=i.value.messages.findIndex(ie=>ie.id===F);ee!==-1&&(i.value.messages[ee]={...i.value.messages[ee],...z},i.value.updatedAt=new Date)},j=F=>{if(i.value)return i.value.messages.find(H=>H.id===F)},O=F=>{g.value=F,q(F,{isStreaming:!0})},G=F=>{F&&q(F,{isStreaming:!1}),(g.value===F||!F)&&(g.value=null)},te=()=>{i.value&&(i.value.messages=[],i.value.updatedAt=new Date,g.value=null)},Z=(F,H)=>{r.value=!F,H!==void 0&&(c.value=H),console.log("[useMessageDialog] Input state updated:",{enabled:F,placeholder:H,isLoading:r.value})},ae=F=>{o.value=F,console.log("[useMessageDialog] Set conversationId:",F)},Ie=()=>{e.value=[],t.value=null,a.value=null,o.value=null,r.value=!1,d.value=null,c.value=null},he=(F,H,z)=>{const ee={planExecution:S(z),isStreaming:!z.completed};if(!z.completed)ee.thinking="Processing...";else{if(!z.agentExecutionSequence||z.agentExecutionSequence.length===0){const ie=z.summary??z.result??z.message??"Execution completed";ie&&(ee.content=ie,ee.thinking="")}else z.summary&&(ee.content=z.summary,ee.thinking="");z.status==="failed"&&z.message&&(ee.content=`Error: ${z.message}`,ee.thinking="")}T(F.id,H.id,ee)};return Co(()=>{const F=s.planExecutionRecords,H=F.size,z=Array.from(F.entries()),ee=e.value;console.log("[useMessageDialog] watchEffect triggered - records count:",z.length,"size:",H),console.log("[useMessageDialog] watchEffect - dialogList count:",ee.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",ee.filter(oe=>oe.planId).map(oe=>({id:oe.id,planId:oe.planId})));for(const oe of ee){if(!oe.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",oe.id);continue}const re=oe.messages.find(_e=>_e.planExecution?.rootPlanId===oe.planId||_e.planExecution?.currentPlanId===oe.planId);if(!re){console.log("[useMessageDialog] watchEffect: No message found for planId:",oe.planId,{dialogMessages:oe.messages.map(_e=>({id:_e.id,type:_e.type,planExecutionRootPlanId:_e.planExecution?.rootPlanId,planExecutionCurrentPlanId:_e.planExecution?.currentPlanId,hasPlanExecution:!!_e.planExecution}))});continue}let W=z.find(([_e])=>_e===oe.planId);const le=re.planExecution;if(!W&&le?.rootPlanId&&(W=z.find(([_e])=>_e===le.rootPlanId)),!W&&le?.currentPlanId&&(W=z.find(([_e])=>_e===le.currentPlanId)),!W){for(const[_e,Re]of z)if(Re&&(Re.rootPlanId===oe.planId||Re.currentPlanId===oe.planId||re.planExecution?.rootPlanId&&(Re.rootPlanId===re.planExecution.rootPlanId||Re.currentPlanId===re.planExecution.rootPlanId)||re.planExecution?.currentPlanId&&(Re.rootPlanId===re.planExecution.currentPlanId||Re.currentPlanId===re.planExecution.currentPlanId))){W=[_e,Re],console.log("[useMessageDialog] watchEffect: Found record by value matching:",{dialogPlanId:oe.planId,recordKey:_e,recordRootPlanId:Re.rootPlanId,recordCurrentPlanId:Re.currentPlanId});break}}if(!W){const _e=re.planExecution;if(_e&&_e.status==="running"){console.log("[useMessageDialog] watchEffect: Message has planExecution but record not found yet, keeping initial state:",{dialogId:oe.id,messageId:re.id,planId:oe.planId,messagePlanExecution:_e,availableRecordKeys:z.map(([Re])=>Re)});continue}console.log("[useMessageDialog] watchEffect: No record found and message has no running planExecution:",{dialogId:oe.id,planId:oe.planId,hasPlanExecution:!!re.planExecution,planExecutionStatus:re.planExecution?.status,availableRecordKeys:z.map(([Re])=>Re)});continue}const[,ue]=W,de=S(ue);console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:oe.id,messageId:re.id,planId:oe.planId,recordKey:W[0],recordCompleted:de.completed,recordStatus:de.status}),he(oe,re,de)}const ie=s.trackedPlanIds.value.size>0,ne=z.some(([,oe])=>oe&&!oe.completed&&oe.status!=="failed");!(ie||ne)&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:ie,hasRunningPlansInRecords:ne,trackedPlanIds:Array.from(s.trackedPlanIds.value),recordsCount:z.length}),r.value=!1)}),{dialogList:je(e),activeDialogId:je(t),rootPlanId:je(a),conversationId:je(o),isLoading:r,error:d,streamingMessageId:je(g),inputPlaceholder:je(c),activeDialog:i,activeRootPlanId:l,hasDialogs:f,dialogCount:E,messages:P,createDialog:m,getDialog:$,setActiveDialog:b,addMessageToDialog:y,updateMessageInDialog:T,deleteDialog:I,deleteConversationRoundByPlanId:D,deleteConversation:C,clearAllDialogs:_,sendMessage:B,executePlan:N,updatePlanExecutionStatus:L,updateInputState:Z,setConversationId:ae,reset:Ie,addMessage:U,updateMessage:q,findMessage:j,startStreaming:O,stopStreaming:G,clearMessages:te}}let Nt=null;function rt(){return Nt||(Nt=La()),Nt}function Ha(s){const e=x(!1),t=x(!0),o=150,a=async(b=!0)=>{s.value&&(await Ue(),s.value.scrollTo({top:s.value.scrollHeight,behavior:b?"smooth":"auto"}))},l=()=>{if(!s.value)return!1;const{scrollTop:b,scrollHeight:y,clientHeight:T}=s.value;return y-b-T<o},r=()=>{if(!s.value)return;const b=l();e.value=!b&&s.value.scrollHeight>s.value.clientHeight,b&&(t.value=!0)},d=()=>{r(),l()||(t.value=!1)},g=async()=>{t.value&&await a()},c=async()=>{t.value=!0,await a()},i=(b,y=!0)=>{if(!s.value)return;const T=s.value.querySelector(`[data-message-id="${b}"]`);T&&T.scrollIntoView({behavior:y?"smooth":"auto",block:"center"})},f=()=>{if(!s.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:b,scrollHeight:y,clientHeight:T}=s.value,I=b===0,D=b+T>=y-5,C=y>T?b/(y-T)*100:100;return{scrollTop:b,scrollHeight:y,clientHeight:T,isAtTop:I,isAtBottom:D,scrollPercentage:C}},E=()=>{s.value&&s.value.addEventListener("scroll",d,{passive:!0})},P=()=>{s.value&&s.value.removeEventListener("scroll",d)},m=()=>{E(),r()},$=()=>{P()};return He(()=>{Ue(()=>{m()})}),Ve(()=>{$()}),{showScrollToBottom:je(e),isAutoScrollEnabled:je(t),scrollToBottom:a,autoScrollToBottom:g,forceScrollToBottom:c,scrollToMessage:i,isNearBottom:l,checkScrollPosition:r,getScrollInfo:f,addScrollListener:E,removeScrollListener:P,initializeScrollBehavior:m,cleanupScrollBehavior:$}}const Ba={class:"chat-container"},qa=["data-message-id"],ja={class:"user-content"},Va={class:"message-text"},Ga={key:0,class:"attachments"},za={class:"attachment-name"},Wa={class:"attachment-size"},Ja={class:"message-timestamp"},Ka={key:0,class:"message-status error"},Xa={class:"status-text"},Ya={key:1,class:"assistant-message"},Za={key:0,class:"loading-message"},Qa={class:"loading-content"},el=["title"],tl=Fe({__name:"ChatContainer",emits:["step-selected"],setup(s,{emit:e}){const t=e,{t:o}=qe(),a=rt(),{messages:l,isLoading:r,streamingMessageId:d,updateMessage:g,startStreaming:c,findMessage:i}=a,f=x(null),{scrollToBottom:E,autoScrollToBottom:P,showScrollToBottom:m}=Ha(f),{getMessageClasses:$,formatTimestamp:b,formatFileSize:y}=Fo(),T=S=>d.value===S,I=ce(()=>l.value),D=S=>{const M=S.target;if(M.classList.contains("md-copy-btn")){const U=M.getAttribute("data-raw");if(U){const q=decodeURIComponent(U);navigator.clipboard.writeText(q).then(()=>{M.textContent=o("chat.copied"),setTimeout(()=>{M.textContent=o("chat.copy")},1e3)})}}},C=async S=>{const M=i(S);if(M)try{const U=M.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(U)}catch(U){console.error("Failed to copy message:",U)}},_=S=>{const M=i(S);M&&M.type==="assistant"&&(g(S,{content:""}),c(S),console.warn("[ChatContainer] Regenerate not yet implemented"))},B=S=>{i(S)&&(g(S,{content:""}),c(S),console.warn("[ChatContainer] Retry not yet implemented"))},N=S=>{console.log("[ChatContainer] Step selected:",S),t("step-selected",S)},L=(S,M)=>{console.log("[ChatContainer] User input submitted:",M,"for message:",S.id),console.warn("[ChatContainer] User input submission not yet implemented")};return He(()=>{Pe(l,()=>{d.value||Ue(()=>{P()})},{deep:!0})}),Ve(()=>{}),(S,M)=>(h(),v("div",Ba,[n("div",{class:"messages",ref_key:"messagesRef",ref:f,onClick:D},[(h(!0),v(be,null,$e(I.value,U=>(h(),v("div",{key:U.id,class:Se(["chat-message",[p($)(U),{streaming:T(U.id)}]])},[U.type==="user"?(h(),v("div",{key:0,class:"user-message","data-message-id":U.id},[n("div",ja,[n("div",Va,u(U.content),1),U.attachments?.length?(h(),v("div",Ga,[(h(!0),v(be,null,$e(U.attachments,(q,j)=>(h(),v("div",{key:j,class:"attachment-item"},[R(p(A),{icon:"carbon:document",class:"attachment-icon"}),n("span",za,u(q.name),1),n("span",Wa,u(p(y)(q.size)),1)]))),128))])):V("",!0),n("div",Ja,u(p(b)(U.timestamp)),1)]),U.error?(h(),v("div",Ka,[R(p(A),{icon:"carbon:warning",class:"status-icon"}),n("span",Xa,u(U.error),1)])):V("",!0)],8,qa)):U.type==="assistant"?(h(),v("div",Ya,[U.planExecution?(h(),Ce(Vn,{key:0,"plan-execution":U.planExecution,"step-actions":U.stepActions||[],"generic-input":U.genericInput||"",onStepSelected:N},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),U.content||U.error||T(U.id)||U.planExecution?.userInputWaitState?.waiting?(h(),Ce(Ua,ko({key:1,content:U.content||"","is-streaming":T(U.id)||!1},{ref_for:!0},{...U.error?{error:U.error}:{},...U.planExecution?.userInputWaitState?{userInputWaitState:U.planExecution.userInputWaitState}:{},...U.planExecution?.currentPlanId?{planId:U.planExecution.currentPlanId}:{}},{timestamp:U.timestamp,"generic-input":U.genericInput||"",onCopy:()=>C(U.id),onRegenerate:()=>_(U.id),onRetry:()=>B(U.id),onUserInputSubmitted:q=>L(U,q)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):V("",!0)])):V("",!0)],2))),128)),p(r)?(h(),v("div",Za,[n("div",Qa,[R(p(A),{icon:"carbon:circle-dash",class:"loading-icon"}),n("span",null,u(S.$t("chat.processing")),1)])])):V("",!0)],512),R(Ct,{name:"scroll-button"},{default:Qe(()=>[p(m)?(h(),v("button",{key:0,class:"scroll-to-bottom",onClick:M[0]||(M[0]=()=>p(E)()),title:S.$t("chat.scrollToBottom")},[R(p(A),{icon:"carbon:chevron-down"})],8,el)):V("",!0)]),_:1})]))}}),ol=Me(tl,[["__scopeId","data-v-b1680d2d"]]);class ao{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const t=new FormData;e.forEach(l=>{t.append("files",l)});const o=await fetch("/api/file-upload/upload",{method:"POST",body:t});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(t){throw console.error("[FileUploadApiService] Error uploading files:",t),t}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();return console.log("[FileUploadApiService] Got uploaded files:",o.totalCount,"for uploadKey:",e),o}catch(t){throw console.error("[FileUploadApiService] Error getting uploaded files:",t),t}}static async deleteFile(e,t){try{console.log("[FileUploadApiService] Deleting file:",t,"from uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(o){throw console.error("[FileUploadApiService] Error deleting file:",o),o}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",t),t}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const sl={class:"file-upload-component"},nl=["accept"],al={key:0},ll={key:1},rl={key:0,class:"files-list"},il={class:"file-name"},cl={class:"file-size"},ul=["onClick","title"],dl={key:0,class:"upload-progress"},pl=Fe({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.mhtml,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(s,{expose:e,emit:t}){const{t:o}=qe(),a=s,l=t,r=x(),d=x([]),g=x(!1),c=x(null),i=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],c.value=null,l("upload-key-changed",null)};Ve(()=>{i()}),Pe(()=>d.value,b=>{l("files-removed",b)},{deep:!0});const f=()=>{a.disabled||r.value&&r.value.click()},E=async b=>{const y=b.target,T=y.files;if(!T||T.length===0)return;const I=Array.from(T);console.log("[FileUpload] Selected files for upload:",I.map(D=>D.name)),await P(I),y.value=""},P=async b=>{if(b.length!==0){g.value=!0,l("upload-started");try{const y=await ao.uploadFiles(b);y.success&&(!c.value&&y.uploadKey?(c.value=y.uploadKey,console.log("[FileUpload] Set uploadKey:",c.value),d.value=y.uploadedFiles):c.value?(console.log("[FileUpload] Using existing uploadKey:",c.value),d.value=[...d.value,...y.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=y.uploadedFiles),y.uploadKey&&(c.value=y.uploadKey,console.log("[Input] Saved uploadKey locally:",y.uploadKey),l("upload-key-changed",c.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,c.value)),console.log("Files uploaded successfully:",y),l("upload-completed")}catch(y){console.error("File upload error:",y),l("upload-error",y)}finally{g.value=!1}}},m=async b=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",b.originalName,"from uploadKey:",c),c.value){const y=await ao.deleteFile(c.value,b.originalName);y.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",y.error)}d.value=d.value.filter(y=>y.originalName!==b.originalName),d.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),c.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",d.value.length)}catch(y){console.error("âŒ Error removing file:",y),l("upload-error",y)}},$=b=>{if(b===0)return"0 Bytes";const y=1024,T=["Bytes","KB","MB","GB"],I=Math.floor(Math.log(b)/Math.log(y));return parseFloat((b/Math.pow(y,I)).toFixed(2))+" "+T[I]};return e({uploadedFiles:d,uploadKey:c,resetSession:i,uploadFiles:P,removeFile:m,isUploading:g}),(b,y)=>(h(),v("div",sl,[n("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:b.acceptedFileTypes||""},null,40,nl),n("div",{class:Se(["uploaded-files",{"has-files":d.value.length>0}])},[n("div",{class:"files-header",onClick:f},[R(p(A),{icon:"carbon:attachment"}),d.value.length===0?(h(),v("span",al,u(p(o)("input.attachFile")),1)):(h(),v("span",ll,u(p(o)("input.attachedFiles"))+" ("+u(d.value.length)+")",1))]),d.value.length>0?(h(),v("div",rl,[(h(!0),v(be,null,$e(d.value,T=>(h(),v("div",{key:T.originalName,class:"file-item"},[R(p(A),{icon:"carbon:document",class:"file-icon"}),n("span",il,u(T.originalName),1),n("span",cl,"("+u($(T.size))+")",1),n("button",{onClick:I=>m(T),class:"remove-btn",title:p(o)("input.removeFile")},[R(p(A),{icon:"carbon:close"})],8,ul)]))),128))])):V("",!0)],2),g.value?(h(),v("div",dl,[R(p(A),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),n("span",null,u(p(o)("input.uploading")),1)])):V("",!0)]))}}),Mo=Me(pl,[["__scopeId","data-v-866ef77f"]]),ml={class:"input-area"},hl={class:"input-container"},fl={class:"input-row-first"},vl=["placeholder","disabled"],gl={class:"input-row-second"},yl=["title","disabled"],bl={value:"chat"},_l=["value"],wl=["disabled","title"],Sl=["title"],lo="chatInputHistory",ro=20,$l=Fe({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(s,{expose:e}){const{t}=qe(),o=Et(),a=tt(),l=rt(),r=lt(),d=ce(()=>o.hasRunningTask()),g=s,c=x(),i=x(),f=x(""),E=ce(()=>t("input.placeholder")),P=x(null),m=ce(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:P.value?P.value:E.value),$=x([]),b=x(null),y=x("chat"),T=x([]),I=x(!1),D=x(!1),C=x([]),_=x(-1),B=x(""),N=ce(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),L=async()=>{I.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const W=a.getAllCoordinatorToolsFromTemplates(),le=[];for(const de of W)if(de.enableInternalToolcall&&de.enableInConversation)try{const _e=JSON.parse(de.inputSchema||"[]");if(Array.isArray(_e)&&_e.length===1){const Re=_e[0],J={value:de.serviceGroup?`${de.serviceGroup}.${de.toolName}`:de.toolName,label:de.toolName,toolName:de.toolName,planTemplateId:de.planTemplateId,paramName:Re.name};de.serviceGroup&&(J.serviceGroup=de.serviceGroup),le.push(J)}}catch(_e){console.warn("[InputArea] Failed to parse inputSchema for tool:",de.toolName,_e)}T.value=le,console.log("[InputArea] Loaded",le.length,"inner tools with single parameter");const ue=localStorage.getItem("inputAreaSelectedTool");if(ue&&ue.trim()!==""){if(le.length>0)if(le.some(_e=>_e.value===ue)){D.value=!0;try{y.value=ue,console.log("[InputArea] Restored selected tool from localStorage:",ue)}finally{D.value=!1}}else console.log("[InputArea] Saved tool no longer available, resetting to chat mode"),localStorage.removeItem("inputAreaSelectedTool"),y.value===ue&&(y.value="chat");else if(y.value!==ue){D.value=!0;try{y.value=ue,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",ue)}finally{D.value=!1}}}}catch(W){console.error("[InputArea] Failed to load inner tools:",W),T.value=[]}finally{I.value=!1}},S=ce(()=>T.value.length>0?T.value.map(W=>({value:W.value,label:W.label})):g.selectionOptions);Pe(y,W=>{D.value||localStorage.setItem("inputAreaSelectedTool",W||"")});const M=()=>{try{const W=localStorage.getItem(lo);W&&(C.value=JSON.parse(W))}catch(W){console.error("[InputArea] Failed to load history:",W),C.value=[]}},U=()=>{try{localStorage.setItem(lo,JSON.stringify(C.value))}catch(W){console.error("[InputArea] Failed to save history:",W)}},q=W=>{if(!W.trim())return;const le=C.value.indexOf(W);le!==-1&&C.value.splice(le,1),C.value.unshift(W),C.value.length>ro&&(C.value=C.value.slice(0,ro)),U()},j=W=>{if(C.value.length===0)return;_.value===-1&&(B.value=f.value);let le=_.value+W;le<-1?le=-1:le>=C.value.length&&(le=C.value.length-1),_.value=le,_.value===-1?(f.value=B.value,B.value=""):f.value=C.value[_.value],H()};Pe(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),L()},{deep:!0}),He(()=>{L(),M(),Pe(()=>r.planExecutionRecords,W=>{const le=Array.from(W.entries());if(le.length===0)return;le.some(([,de])=>de&&!de.completed&&de.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),O())},{deep:!0}),Pe(()=>o.taskToInput,W=>{W?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",W),Ue(()=>{oe(W.trim()),o.getAndClearTaskToInput()}))},{immediate:!1})});const O=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),i.value?.resetSession()};Ve(()=>{O()});const G=(W,le)=>{$.value=W.map(ue=>ue.originalName),b.value=le,console.log("[InputArea] Files uploaded:",W.length,"uploadKey:",le),$.value.length>0&&(P.value=t("input.filesAttached",{count:$.value.length}))},te=W=>{$.value=W.map(le=>le.originalName),console.log("[InputArea] Files removed, remaining:",W.length),$.value.length===0?P.value=null:P.value=t("input.filesAttached",{count:$.value.length})},Z=W=>{b.value=W,console.log("[InputArea] Upload key changed:",W)},ae=()=>{console.log("[InputArea] Upload started")},Ie=()=>{console.log("[InputArea] Upload completed")},he=W=>{console.error("[InputArea] Upload error:",W)},F=ce(()=>l.isLoading.value),H=()=>{Ue(()=>{c.value&&(c.value.style.height="auto",c.value.style.height=Math.min(c.value.scrollHeight,120)+"px")})},z=W=>{if(W.key==="Enter"&&(W.ctrlKey||W.metaKey)){W.preventDefault(),ee();return}const le=N.value?W.altKey:W.ctrlKey;if(W.key==="ArrowUp"&&le){W.preventDefault(),j(1);return}if(W.key==="ArrowDown"&&le){W.preventDefault(),j(-1);return}_.value!==-1&&W.key.length===1&&!W.ctrlKey&&!W.metaKey&&!W.altKey&&(_.value=-1,B.value="")},ee=async()=>{if(!f.value.trim()||F.value)return;const W=f.value.trim();q(W),_.value=-1,B.value="",ne();const le={input:W,memoryId:xe.selectMemoryId,uploadedFiles:$.value};if(b.value?(le.uploadKey=b.value,console.log("[InputArea] Including uploadKey in message:",b.value)):console.log("[InputArea] No uploadKey available for message"),y.value&&y.value!=="chat"){const ue=T.value.find(de=>de.value===y.value);if(ue){const de=le;de.toolName=ue.toolName,ue.serviceGroup&&(de.serviceGroup=ue.serviceGroup),de.replacementParams={[ue.paramName]:W},console.log("[InputArea] Sending message with tool:",ue.toolName,"serviceGroup:",ue.serviceGroup)}}try{await l.sendMessage(le)}catch(ue){const de=ue instanceof Error?ue.message:String(ue);console.error("[InputArea] Send message failed:",de)}},ie=async()=>{console.log("[InputArea] Stop button clicked"),await o.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},ne=()=>{f.value="",H()},ve=(W,le)=>{l.updateInputState(W,le)},oe=W=>{f.value=W,H()},re=()=>f.value.trim();return Pe(()=>g.initialValue,W=>{W.trim()&&(f.value=W,H())},{immediate:!0}),e({clearInput:ne,updateState:ve,getQuery:re,focus:()=>c.value?.focus(),get uploadedFiles(){return i.value?.uploadedFiles?.map(W=>W.originalName)||[]},get uploadKey(){return i.value?.uploadKey||null}}),(W,le)=>(h(),v("div",ml,[R(Mo,{ref_key:"fileUploadRef",ref:i,disabled:F.value,onFilesUploaded:G,onFilesRemoved:te,onUploadKeyChanged:Z,onUploadStarted:ae,onUploadCompleted:Ie,onUploadError:he},null,8,["disabled"]),n("div",hl,[n("div",fl,[Te(n("textarea",{"onUpdate:modelValue":le[0]||(le[0]=ue=>f.value=ue),ref_key:"inputRef",ref:c,class:"chat-input",placeholder:m.value,disabled:F.value,onKeydown:z,onInput:H},null,40,vl),[[De,f.value]])]),n("div",gl,[Te(n("select",{"onUpdate:modelValue":le[1]||(le[1]=ue=>y.value=ue),class:"selection-input",title:W.$t("input.selectionTitle"),disabled:I.value||F.value},[n("option",bl,u(W.$t("input.chatMode")),1),(h(!0),v(be,null,$e(S.value,ue=>(h(),v("option",{key:ue.value,value:ue.value},u(ue.label),9,_l))),128))],8,yl),[[Kt,y.value]]),d.value?(h(),v("button",{key:1,class:"send-button stop-button",onClick:ie,title:W.$t("input.stop")},[R(p(A),{icon:"carbon:stop-filled"}),ye(" "+u(W.$t("input.stop")),1)],8,Sl)):(h(),v("button",{key:0,class:"send-button",disabled:!f.value.trim()||F.value,onClick:ee,title:W.$t("input.send")},[R(p(A),{icon:"carbon:send-alt"}),ye(" "+u(W.$t("input.send")),1)],8,wl))])])]))}}),Pl=Me($l,[["__scopeId","data-v-6b1fc169"]]);class St{static BASE_URL="/api/memories";static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const t=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(t)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(t){throw console.error("Failed to get memory:",t),t}}static async createMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(o){throw console.error("Failed to create memory:",o),o}}static async updateMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(o){throw console.error("Failed to update memory:",o),o}}static async deleteMemory(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete memory:",t),t}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),o=await(await this.handleResponse(e)).json();if(!o.data)throw new Error("Failed to generate conversation ID");return o.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}static async getConversationHistory(e){try{const t=await fetch(`${this.BASE_URL}/${e}/history`);return await(await this.handleResponse(t)).json()||[]}catch(t){throw console.error("Failed to get conversation history:",t),t}}}const Tl={key:0,class:"app-container"},El={class:"app-content"},kl={class:"header"},Cl={class:"relative"},Il={class:"title-edit-group"},Rl={id:"main-title",class:"main-title"},xl={key:0,id:"title-edit-container",class:"title-edit-container"},Al={class:"search-bar"},Fl={class:"search-container"},Ml=["placeholder"],Dl={class:"message-list",id:"message-list"},Nl={class:"message-header"},Ul={class:"message-content"},Ol={class:"sender-info"},Ll=["onClick"],Hl={class:"sender-name"},Bl={class:"action-buttons"},ql=["onClick"],jl={class:"action-buttons"},Vl=["onClick"],Gl={class:"message-meta"},zl={class:"message-id"},Wl={class:"meta-right"},Jl={key:0,class:"unread-count"},Kl={class:"message-time"},Xl=["id"],Yl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Zl={class:"bubble-avatar"},Ql={class:"bubble-content"},er={class:"bubble-text"},tr={key:0,class:"empty-state"},or={class:"modal-content"},sr={class:"modal-header"},nr={class:"modal-title"},ar=["placeholder"],lr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},rr={class:"modal-footer"},ir={class:"modal-content"},cr={class:"modal-header"},ur={class:"modal-title"},dr={class:"state-text",id:"delete-message"},pr={class:"modal-footer"},mr=Fe({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(s,{emit:e}){const t=x(!1),o=x(""),a=x([]),l=x([]),r=x(!1),d=x(null),g=x(""),c=x(!1),i=x(null),f=new Map,E=e,P=N=>{N.key==="Escape"&&(c.value?_():r.value&&T())};He(()=>{xe.setLoadMessages(m),document.addEventListener("keydown",P)}),Ve(()=>{document.removeEventListener("keydown",P)});const m=async()=>{try{const N=await St.getMemories();a.value=N.map(L=>({...L,expanded:f.has(L.conversation_id)?f.get(L.conversation_id):!1})),l.value=[...a.value],y()}catch(N){console.error("error:",N),a.value=[],l.value=[]}},$=N=>{xe.selectMemory(N),E("memory-selected")},b=N=>{const L=typeof N=="string"?parseInt(N,10):N;return isNaN(L)||L<=0?"--":new Date(L.toString().length===13?L:L*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},y=()=>{const N=o.value.toLowerCase().trim();if(!N){l.value=[...a.value];return}l.value=a.value.filter(L=>{const S=L.memory_name.toLowerCase().includes(N),M=L.conversation_id.toLowerCase().includes(N),U=L.messages?.some(q=>q.text.toLowerCase().includes(N))??!1;return S||M||U})},T=()=>{r.value=!1,d.value=null},I=async()=>{if(!d.value)return;const N=g.value.trim()||"unknow name",L=a.value.findIndex(S=>S.conversation_id===d.value);if(L!==-1){const S=a.value[L];try{const M=await St.updateMemory(S.conversation_id,N);M.messages||(M.messages=[]),a.value[L]={...M,expanded:S.expanded},y(),r.value=!1}catch(M){console.error("error:",M)}}},D=N=>{const L=a.value.find(S=>S.conversation_id===N);if(L){L.expanded=!L.expanded,f.set(N,L.expanded);const S=l.value.findIndex(M=>M.conversation_id===N);S!==-1&&(l.value[S]={...L})}},C=N=>{i.value=N,c.value=!0},_=()=>{c.value=!1,i.value=null},B=async()=>{if(i.value)try{await St.deleteMemory(i.value),a.value=a.value.filter(N=>N.conversation_id!==i.value),y(),a.value.length===0&&xe.clearMemoryId(),c.value=!1,i.value=null}catch(N){console.error("error:",N)}};return(N,L)=>(h(),Ce(Io,{to:"body"},[R(Ct,{name:"modal"},{default:Qe(()=>[p(xe).isCollapsed?(h(),v("div",Tl,[n("div",El,[n("div",kl,[n("div",Cl,[n("div",Il,[n("h1",Rl,[n("span",null,u(N.$t("memory.title")),1)])]),t.value?(h(),v("div",xl)):V("",!0)]),n("button",{class:"close-btn",onClick:L[0]||(L[0]=S=>p(xe).toggleSidebar())},[R(p(A),{icon:"carbon:close"})])]),n("div",Al,[n("div",Fl,[R(p(A),{class:"search-container-icon",icon:"carbon:search"}),Te(n("input",{type:"text",placeholder:N.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":L[1]||(L[1]=S=>o.value=S),onInput:y},null,40,Ml),[[De,o.value]])])]),n("div",Dl,[n("div",null,[(h(!0),v(be,null,$e(l.value,S=>(h(),v("div",{class:Se(["message-item",{expanded:S.expanded}]),key:S.conversation_id},[n("div",Nl,[n("div",Ul,[n("div",Ol,[n("div",{class:"sender-div",onClick:ke(M=>$(S.conversation_id),["stop"])},[n("h3",Hl,u(S.memory_name),1)],8,Ll),n("div",Bl,[n("button",{class:"delete-btn",onClick:ke(M=>D(S.conversation_id),["stop"])},[R(p(A),{id:"toggle-"+S.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,ql)]),n("div",jl,[n("button",{class:"delete-btn",onClick:ke(M=>C(S.conversation_id),["stop"])},[R(p(A),{icon:"carbon:delete"})],8,Vl)])]),n("div",Gl,[n("span",zl,"ID: "+u(S.conversation_id),1),n("div",Wl,[S.messages&&S.messages.length>0?(h(),v("span",Jl,u(S.messages.length)+" "+u(N.$t("memory.size")),1)):V("",!0),n("span",Kl,u(b(S.create_time)),1)])])])]),S.expanded?(h(),v("div",{key:0,id:"content-"+S.conversation_id,class:"expanded-content"},[n("div",Yl,[(h(!0),v(be,null,$e(S.messages,(M,U)=>(h(),v("div",{class:"message-bubble",key:U},[n("div",Zl,u(M.messageType),1),n("div",Ql,[n("p",er,u(M.text),1)])]))),128))])],8,Xl)):V("",!0)],2))),128))]),l.value.length===0&&o.value?(h(),v("div",tr,L[3]||(L[3]=[n("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),r.value?(h(),v("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ke(T,["self"])},[n("div",or,[n("div",sr,[n("h3",nr,u(N.$t("memory.changeName")),1),Te(n("input",{type:"text","onUpdate:modelValue":L[2]||(L[2]=S=>g.value=S),class:"edit-input",placeholder:N.$t("memory.newNamePlaceholder")},null,8,ar),[[De,g.value]]),n("span",lr,u(g.value.length),1)]),n("div",rr,[n("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:T},u(N.$t("memory.cancel")),1),n("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:I},u(N.$t("memory.save")),1)])])])):V("",!0),c.value?(h(),v("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ke(_,["self"])},[n("div",ir,[n("div",cr,[n("h3",ur,u(N.$t("memory.deleteHint")),1),n("p",dr,u(N.$t("memory.deleteHintPrefix"))+" "+u(i.value)+" "+u(N.$t("memory.deleteHintSuffix")),1)]),n("div",pr,[n("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:_},u(N.$t("memory.cancel")),1),n("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:B},u(N.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),hr=Me(mr,[["__scopeId","data-v-16358835"]]);class nt{static BASE_URL="/api/file-browser";static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const t=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(t)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(t){throw console.error("Failed to get file tree:",t),t}}static async getFileContent(e,t){try{const o=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(t)}`),l=await(await this.handleResponse(o)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(o){throw console.error("Failed to get file content:",o),o}}static async downloadFile(e,t,o){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(t)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),d=document.createElement("a");d.href=r,d.download=o??t.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(r),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,t){const o=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(o.some(r=>e.startsWith(r)))return!0;const l=t.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const t=e.name.toLowerCase();return t.endsWith(".js")?"vscode-icons:file-type-js":t.endsWith(".ts")?"vscode-icons:file-type-typescript":t.endsWith(".vue")?"vscode-icons:file-type-vue":t.endsWith(".java")?"vscode-icons:file-type-java":t.endsWith(".py")?"vscode-icons:file-type-python":t.endsWith(".json")?"vscode-icons:file-type-json":t.endsWith(".xml")?"vscode-icons:file-type-xml":t.endsWith(".html")?"vscode-icons:file-type-html":t.endsWith(".css")?"vscode-icons:file-type-css":t.endsWith(".md")?"vscode-icons:file-type-markdown":t.endsWith(".yml")||t.endsWith(".yaml")?"vscode-icons:file-type-yaml":t.endsWith(".pdf")?"vscode-icons:file-type-pdf2":t.endsWith(".doc")||t.endsWith(".docx")?"vscode-icons:file-type-word":t.endsWith(".xls")||t.endsWith(".xlsx")?"vscode-icons:file-type-excel":t.endsWith(".ppt")||t.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":t.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":t.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const fr={class:"file-tree-node"},vr={class:"node-icon"},gr={class:"node-name"},yr={key:1,class:"file-size"},br={key:2,class:"node-actions"},_r={key:0,class:"children"},wr=Fe({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(s,{emit:e}){const t=s,o=e,a=x(t.level===0),l=x(!1),r=x(!1),d=x({}),g=()=>{t.node.type==="directory"&&(a.value=!a.value)},c=()=>{t.node.type==="directory"?g():i()},i=()=>{t.node.type==="file"&&o("file-selected",t.node),P()},f=()=>{o("download-file",t.node),P()},E=y=>{y.preventDefault(),r.value=!0,d.value={position:"fixed",top:`${y.clientY}px`,left:`${y.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",P)},0)},P=()=>{r.value=!1,document.removeEventListener("click",P)},m=async()=>{try{await navigator.clipboard.writeText(t.node.path)}catch(y){console.error("Failed to copy path:",y)}P()},$=()=>t.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":nt.getFileIcon(t.node),b=y=>{if(y===0)return"0 B";const T=1024,I=["B","KB","MB","GB"],D=Math.floor(Math.log(y)/Math.log(T));return parseFloat((y/Math.pow(T,D)).toFixed(1))+" "+I[D]};return Ve(()=>{document.removeEventListener("click",P)}),(y,T)=>{const I=Eo("FileTreeNode",!0);return h(),v("div",fr,[n("div",{class:Se(["node-content",{"is-directory":y.node.type==="directory","is-file":y.node.type==="file","is-expanded":a.value}]),style:mt({paddingLeft:`${y.level*16+12}px`}),onClick:c,onContextmenu:ke(E,["prevent"])},[y.node.type==="directory"?(h(),v("div",{key:0,class:"expand-icon",onClick:ke(g,["stop"])},[R(p(A),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),n("div",vr,[R(p(A),{icon:$()},null,8,["icon"])]),n("span",gr,u(y.node.name),1),y.node.type==="file"?(h(),v("span",yr,u(b(y.node.size)),1)):V("",!0),l.value?(h(),v("div",br,[y.node.type==="file"?(h(),v("button",{key:0,onClick:T[0]||(T[0]=ke(D=>y.$emit("download-file",y.node),["stop"])),class:"action-btn download-btn",title:"Download"},[R(p(A),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),y.node.type==="directory"&&a.value&&y.node.children?(h(),v("div",_r,[(h(!0),v(be,null,$e(y.node.children,D=>(h(),Ce(I,{key:D.path,node:D,level:y.level+1,onFileSelected:T[1]||(T[1]=C=>y.$emit("file-selected",C)),onDownloadFile:T[2]||(T[2]=C=>y.$emit("download-file",C))},null,8,["node","level"]))),128))])):V("",!0),r.value?(h(),v("div",{key:1,class:"context-menu",style:mt(d.value),onClick:T[3]||(T[3]=ke(()=>{},["stop"]))},[n("div",{class:"context-menu-item",onClick:i},[R(p(A),{icon:"carbon:view"}),T[4]||(T[4]=n("span",null,"Open",-1))]),y.node.type==="file"?(h(),v("div",{key:0,class:"context-menu-item",onClick:f},[R(p(A),{icon:"carbon:download"}),T[5]||(T[5]=n("span",null,"Download",-1))])):V("",!0),T[7]||(T[7]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:m},[R(p(A),{icon:"carbon:copy"}),T[6]||(T[6]=n("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),Sr=Me(wr,[["__scopeId","data-v-3fc455d1"]]),$r={class:"file-browser"},Pr={class:"file-browser-header"},Tr={class:"header-actions"},Er=["disabled","title"],kr={class:"file-browser-content"},Cr={class:"file-tree-panel"},Ir={key:0,class:"loading-state"},Rr={key:1,class:"error-state"},xr={key:0,class:"waiting-for-files"},Ar={class:"message-content"},Fr={class:"tips"},Mr=["disabled"],Dr={key:1,class:"actual-error"},Nr={key:2,class:"empty-state"},Ur={key:3,class:"file-tree"},Or={key:0,class:"file-content-panel"},Lr={class:"file-content-header"},Hr={class:"file-info"},Br={class:"file-name"},qr={class:"file-size"},jr={class:"file-actions"},Vr=["title"],Gr=["title"],zr={class:"file-content-body"},Wr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Kr={key:2,class:"file-content"},Xr={key:0,class:"text-content"},Yr={key:1,class:"binary-content"},Zr=Fe({name:"FileBrowser",__name:"index",props:{planId:{}},setup(s){const e=s,{t}=qe(),o=x(!1),a=x(null),l=x(null),r=x(null),d=x(null),g=x(!1),c=x(null),i=x(null),f=ce(()=>!d.value||!r.value?!1:nt.isTextFile(d.value.mimeType,r.value.name)),E=ce(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),P=()=>{i.value&&(clearTimeout(i.value),i.value=null)},m=()=>{P(),i.value=window.setTimeout(()=>{E.value&&$()},5e3)},$=async()=>{if(e.planId){o.value=!0,a.value=null,P();try{l.value=await nt.getFileTree(e.planId)}catch(C){a.value=C instanceof Error?C.message:t("fileBrowser.loadError"),console.error("Failed to load file tree:",C);const _=C instanceof Error?C.message:"";(_.includes("Plan directory not found")||_.includes("not found"))&&m()}finally{o.value=!1}}},b=async C=>{if(C.type!=="directory"){r.value=C,d.value=null,g.value=!0,c.value=null;try{d.value=await nt.getFileContent(e.planId,C.path)}catch(_){c.value=_ instanceof Error?_.message:t("fileBrowser.contentLoadError"),console.error("Failed to load file content:",_)}finally{g.value=!1}}},y=async C=>{try{await nt.downloadFile(e.planId,C.path,C.name)}catch(_){console.error("Failed to download file:",_)}},T=()=>{r.value=null,d.value=null,c.value=null},I=C=>nt.getFileIcon(C),D=C=>{if(C===0)return"0 B";const _=1024,B=["B","KB","MB","GB"],N=Math.floor(Math.log(C)/Math.log(_));return parseFloat((C/Math.pow(_,N)).toFixed(1))+" "+B[N]};return Pe(()=>e.planId,C=>{C&&(r.value=null,d.value=null,$())},{immediate:!0}),He(()=>{e.planId&&$()}),Ve(()=>{P()}),(C,_)=>(h(),v("div",$r,[n("div",Pr,[n("h3",null,u(C.$t("fileBrowser.title")),1),n("div",Tr,[n("button",{class:"refresh-btn",onClick:$,disabled:o.value,title:C.$t("fileBrowser.refresh")},[R(p(A),{icon:"carbon:refresh",class:Se({rotating:o.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Er)])]),n("div",kr,[n("div",Cr,[o.value?(h(),v("div",Ir,[R(p(A),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(C.$t("fileBrowser.loading")),1)])):a.value?(h(),v("div",Rr,[E.value?(h(),v("div",xr,[R(p(A),{icon:"carbon:time",class:"rotating"}),n("div",Ar,[n("h3",null,u(C.$t("fileBrowser.waitingForGeneration")),1),n("p",null,u(C.$t("fileBrowser.planExecuting")),1),n("div",Fr,[R(p(A),{icon:"carbon:information"}),n("span",null,u(C.$t("fileBrowser.filesTip")),1)])]),n("button",{onClick:$,class:"retry-btn",disabled:o.value},[R(p(A),{icon:"carbon:refresh",class:Se({rotating:o.value})},null,8,["class"]),ye(" "+u(o.value?C.$t("fileBrowser.checking"):C.$t("fileBrowser.checkNow")),1)],8,Mr)])):(h(),v("div",Dr,[R(p(A),{icon:"carbon:warning"}),n("span",null,u(a.value),1),n("button",{onClick:$,class:"retry-btn"},u(C.$t("fileBrowser.retry")),1)]))])):l.value?(h(),v("div",Ur,[R(Sr,{node:l.value,level:0,onFileSelected:b,onDownloadFile:y},null,8,["node"])])):(h(),v("div",Nr,[R(p(A),{icon:"carbon:folder-off"}),n("span",null,u(C.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),v("div",Or,[n("div",Lr,[n("div",Hr,[R(p(A),{icon:I(r.value)},null,8,["icon"]),n("span",Br,u(r.value.name),1),n("span",qr,"("+u(D(r.value.size))+")",1)]),n("div",jr,[n("button",{onClick:_[0]||(_[0]=B=>y(r.value)),class:"download-btn",title:C.$t("fileBrowser.download")},[R(p(A),{icon:"carbon:download"})],8,Vr),n("button",{onClick:T,class:"close-btn",title:C.$t("common.close")},[R(p(A),{icon:"carbon:close"})],8,Gr)])]),n("div",zr,[g.value?(h(),v("div",Wr,[R(p(A),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(C.$t("fileBrowser.loadingContent")),1)])):c.value?(h(),v("div",Jr,[R(p(A),{icon:"carbon:warning"}),n("span",null,u(c.value),1)])):d.value?(h(),v("div",Kr,[f.value?(h(),v("div",Xr,[n("pre",null,[n("code",null,u(d.value.content),1)])])):(h(),v("div",Yr,[R(p(A),{icon:"carbon:document-unknown"}),n("p",null,u(C.$t("fileBrowser.binaryFile")),1),n("button",{onClick:_[1]||(_[1]=B=>y(r.value)),class:"download-btn-large"},[R(p(A),{icon:"carbon:download"}),ye(" "+u(C.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),Qr=Me(Zr,[["__scopeId","data-v-a19b1e5b"]]);class Do{static BASE_URL="/api/plan-template";static async getParameterRequirements(e){try{const t=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get parameter requirements: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting parameter requirements:",t),t}}}class No{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getAvailableTools(){try{const e=await fetch("/api/tools");return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get available tools:",e),e}}}function ei(){const s=x([]),e=x(!1),t=x(null);return{availableTools:s,isLoading:e,error:t,loadAvailableTools:async()=>{if(!e.value){e.value=!0,t.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await No.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),s.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),t.value=l instanceof Error?l.message:"Unknown error",s.value=[]}finally{e.value=!1}}},reset:()=>{s.value=[],e.value=!1,t.value=null}}}let Ut=null;function ht(){return Ut||(Ut=ei()),Ut}const ti={class:"modal-form wide-modal"},oi={class:"form-section"},si={class:"form-item"},ni=["placeholder"],ai={class:"field-description"},li={class:"form-section"},ri={class:"section-title"},ii={key:0,class:"params-help-text"},ci={class:"parameter-table"},ui=["onUpdate:modelValue","placeholder","readonly"],di=["onUpdate:modelValue","placeholder"],pi={class:"form-section"},mi={class:"service-publish-options"},hi={class:"http-publish-option"},fi={class:"checkbox-label"},vi={class:"checkbox-text"},gi={class:"checkbox-description"},yi={class:"conversation-publish-option"},bi={class:"checkbox-label"},_i={class:"checkbox-text"},wi={class:"checkbox-description"},Si={class:"button-container"},$i=["disabled"],Pi=["disabled"],Ti=Fe({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(s,{expose:e,emit:t}){const{t:o}=qe(),a=tt(),l=ht(),r=s,d=t,g=ce({get:()=>r.modelValue,set:q=>d("update:modelValue",q)}),c=x(""),i=x(""),f=x(!1),E=x(!1),P=x(!1),m=x(!0),$=x(!1),b=x({parameters:[],hasParameters:!1,requirements:""}),y=x(!1),T=Xe({userRequest:"",parameters:[]}),I=ce(()=>{const q=!!a.selectedTemplate.value?.toolConfig;return o(q?"mcpService.updateService":"mcpService.createService")}),D=ce(()=>!!a.selectedTemplate.value?.toolConfig),C=()=>{const q=a.selectedTemplate.value?.toolConfig;if(q){let j=q.toolDescription||"";j.trim()||(j=a.getTitle()||""),T.userRequest=j,P.value=q.enableHttpService??!1,m.value=!0,$.value=q.enableInConversation??!1,q.inputSchema&&Array.isArray(q.inputSchema)&&q.inputSchema.length>0?T.parameters=q.inputSchema.map(O=>({name:O.name||"",description:O.description||O.name||""})):b.value.hasParameters||(T.parameters=[])}else T.userRequest=a.getTitle()||"",P.value=!1,m.value=!0,$.value=!1,b.value.hasParameters||(T.parameters=[])},_=async()=>{const q=a.currentPlanTemplateId.value;if(!q){b.value={parameters:[],hasParameters:!1,requirements:""},T.parameters=[];return}y.value=!0;try{const j=await Do.getParameterRequirements(q);if(b.value=j,console.log("[PublishModal] Parameter requirements loaded:",j),j.hasParameters){const O=new Map;T.parameters.forEach(G=>{G.name&&O.set(G.name,G.description||"")}),T.parameters=j.parameters.map(G=>({name:G,description:O.get(G)||G})),console.log("[PublishModal] Updated formData.parameters with requirements:",T.parameters)}else T.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(j){console.error("[PublishModal] Failed to load parameter requirements:",j),j instanceof Error&&!j.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),b.value={parameters:[],hasParameters:!1,requirements:""},T.parameters=[]}finally{y.value=!1}},B=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",b.value.parameters),console.log("[PublishModal] Form parameters:",T.parameters);const q=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",q);const j=new Map;if(q.forEach(O=>{O.name&&j.set(O.name,O.description||"")}),b.value.hasParameters){const O=b.value.parameters.map(G=>{const ae=T.parameters.find(Ie=>Ie.name===G)?.description||""||j.get(G)||G;return{name:G,description:ae}});return console.log("[PublishModal] Merged parameters (from plan template):",O),O}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},N=(q,j)=>{j==="success"?(i.value=q,setTimeout(()=>{i.value=""},3e3)):j==="error"&&(c.value=q,setTimeout(()=>{c.value=""},5e3))},L=()=>{if(!T.userRequest.trim())return N(o("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return N(o("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return N(o("mcpService.toolNameRequiredError"),"error"),!1;if(!m.value&&!P.value)return N("Please select at least one service type","error"),!1;for(let O=0;O<T.parameters.length;O++){const G=T.parameters[O];if(G.name&&!G.description.trim())return N(`Parameter "${G.name}" description cannot be empty`,"error"),!1;if(G.description&&!G.name.trim())return N(`Parameter description "${G.description}" corresponding name cannot be empty`,"error"),!1}return!0},S=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",T),console.log("[PublishModal] Publish as HTTP service:",P.value),!L()){console.log("[PublishModal] Form validation failed");return}f.value=!0;try{const q=B();console.log("[PublishModal] Merged parameters:",q);const j=q.filter(te=>te.name.trim()).map(te=>({name:te.name.trim(),description:te.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(T.userRequest.trim()),a.setEnableInternalToolcallWithGuard(m.value),a.setEnableHttpServiceWithGuard(P.value),a.setEnableInConversationWithGuard($.value),a.setInputSchemaWithGuard(j),!await a.save())throw new Error("Failed to save plan template");const G=[];m.value&&G.push("Internal Method Call"),P.value&&G.push("HTTP Service"),G.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",G.join(", ")),N(o("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),d("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),N(o("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),d("published",null))}catch(q){console.error("[PublishModal] Failed to publish service:",q);const j=q instanceof Error?q.message:"Unknown error";N(o("mcpService.publishFailed")+": "+j,"error")}finally{f.value=!1}},M=async()=>{if(E.value||!confirm(o("mcpService.deleteConfirmMessage")))return;const q=a.currentPlanTemplateId.value;if(!q){N(o("mcpService.deleteFailed")+": "+o("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",q),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),N(o("mcpService.deleteSuccess"),"success"),g.value=!1,d("published",null)}catch(j){console.error("[PublishModal] Failed to delete tool config:",j);const O=j instanceof Error?j.message:"Unknown error";N(o("mcpService.deleteFailed")+": "+O,"error")}finally{E.value=!1}};return Pe(()=>r.modelValue,async()=>{g.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),C(),await _())}),Pe(()=>a.currentPlanTemplateId.value,(q,j)=>{q&&q!==j&&(j&&q.startsWith("planTemplate-")?setTimeout(()=>{_()},1e3):_())}),He(async()=>{g.value&&(console.log("[PublishModal] Initialize when component mounted"),C(),await _())}),e({loadParameterRequirements:_}),(q,j)=>(h(),v(be,null,[R(xo,{modelValue:g.value,"onUpdate:modelValue":j[3]||(j[3]=O=>g.value=O),title:I.value,onConfirm:S},{footer:Qe(()=>[n("div",Si,[D.value?(h(),v("button",{key:0,class:"action-btn danger",onClick:M,disabled:E.value},[E.value?(h(),Ce(p(A),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),Ce(p(A),{key:1,icon:"carbon:trash-can"})),ye(" "+u(E.value?p(o)("mcpService.deleting"):p(o)("mcpService.delete")),1)],8,$i)):V("",!0),n("button",{class:"action-btn primary",onClick:S,disabled:f.value},[f.value?(h(),Ce(p(A),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),Ce(p(A),{key:1,icon:"carbon:cloud-upload"})),ye(" "+u(f.value?p(o)("mcpService.publishing"):p(o)("mcpService.publishAsService")),1)],8,Pi)])]),default:Qe(()=>[n("div",ti,[n("div",oi,[n("div",si,[n("label",null,u(p(o)("mcpService.toolDescriptionRequired")),1),Te(n("textarea",{"onUpdate:modelValue":j[0]||(j[0]=O=>T.userRequest=O),placeholder:p(o)("mcpService.toolDescriptionPlaceholder"),class:Se([{error:!T.userRequest||!T.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,ni),[[De,T.userRequest]]),n("div",ai,u(p(o)("mcpService.toolDescriptionDescription")),1)])]),n("div",li,[n("div",ri,u(p(o)("mcpService.parameterConfig")),1),b.value.hasParameters?(h(),v("div",ii,u(p(o)("sidebar.parameterRequirementsHelp")),1)):V("",!0),n("div",ci,[n("table",null,[n("thead",null,[n("tr",null,[n("th",null,u(p(o)("mcpService.parameterName")),1),n("th",null,u(p(o)("mcpService.parameterDescription")),1)])]),n("tbody",null,[(h(!0),v(be,null,$e(T.parameters,(O,G)=>(h(),v("tr",{key:G},[n("td",null,[Te(n("input",{type:"text","onUpdate:modelValue":te=>O.name=te,placeholder:p(o)("mcpService.parameterName"),class:Se(["parameter-input",{"readonly-input":b.value.hasParameters}]),readonly:b.value.hasParameters,required:""},null,10,ui),[[De,O.name]])]),n("td",null,[Te(n("input",{type:"text","onUpdate:modelValue":te=>O.description=te,placeholder:p(o)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,di),[[De,O.description]])])]))),128))])])])]),n("div",pi,[n("div",mi,[n("div",hi,[n("label",fi,[Te(n("input",{type:"checkbox","onUpdate:modelValue":j[1]||(j[1]=O=>P.value=O),class:"checkbox-input"},null,512),[[jt,P.value]]),n("span",vi,u(p(o)("mcpService.publishAsHttpService")),1)]),n("div",gi,u(p(o)("mcpService.publishAsHttpServiceDescription")),1)]),n("div",yi,[n("label",bi,[Te(n("input",{type:"checkbox","onUpdate:modelValue":j[2]||(j[2]=O=>$.value=O),class:"checkbox-input"},null,512),[[jt,$.value]]),n("span",_i,u(p(o)("mcpService.enableInConversation")),1)]),n("div",wi,u(p(o)("mcpService.enableInConversationDescription")),1)])])])])]),_:1},8,["modelValue","title"]),c.value?(h(),v("div",{key:0,class:"error-toast",onClick:j[4]||(j[4]=O=>c.value="")},[R(p(A),{icon:"carbon:error"}),ye(" "+u(c.value),1)])):V("",!0),i.value?(h(),v("div",{key:1,class:"success-toast",onClick:j[5]||(j[5]=O=>i.value="")},[R(p(A),{icon:"carbon:checkmark"}),ye(" "+u(i.value),1)])):V("",!0)],64))}}),Ei=Me(Ti,[["__scopeId","data-v-5939a23b"]]),ki={class:"modal-header"},Ci={class:"modal-body"},Ii={class:"modal-footer"},Ri=["disabled"],xi=Fe({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(s,{emit:e}){const t=e,o=x(!1),a=()=>{t("update:modelValue",!1)},l=async()=>{o.value=!0;try{t("save"),t("update:modelValue",!1)}finally{o.value=!1}},r=()=>{t("continue"),t("update:modelValue",!1)};return(d,g)=>d.modelValue?(h(),v("div",{key:0,class:"modal-overlay",onClick:a},[n("div",{class:"modal-content",onClick:g[0]||(g[0]=ke(()=>{},["stop"]))},[n("div",ki,[n("h3",null,u(d.$t("sidebar.saveConfirmationTitle")),1),n("button",{class:"close-btn",onClick:a},[R(p(A),{icon:"carbon:close",width:"16"})])]),n("div",Ci,[n("p",null,u(d.$t("sidebar.saveConfirmationMessage")),1)]),n("div",Ii,[n("button",{class:"btn btn-secondary",onClick:a},u(d.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:l,disabled:o.value},[o.value?(h(),Ce(p(A),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ye(" "+u(o.value?d.$t("sidebar.saving"):d.$t("common.save")),1)],8,Ri),n("button",{class:"btn btn-danger",onClick:r},u(d.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),Ai=Me(xi,[["__scopeId","data-v-4817656d"]]);class Fi{parameterHistory=new Map;toolHistoryIndices=new Map;PARAMETER_HISTORY_KEY="parameterHistory";TOOL_HISTORY_INDICES_KEY="toolHistoryIndices";MAX_HISTORY_SIZE=5;constructor(){this.loadFromStorage()}loadFromStorage(){try{const e=localStorage.getItem(this.PARAMETER_HISTORY_KEY);if(e){const o=JSON.parse(e);this.parameterHistory=new Map(Object.entries(o)),console.log("[ParameterHistoryStore] Loaded parameter history from localStorage:",this.parameterHistory.size,"tools")}const t=localStorage.getItem(this.TOOL_HISTORY_INDICES_KEY);if(t){const o=JSON.parse(t);this.toolHistoryIndices=new Map(Object.entries(o)),console.log("[ParameterHistoryStore] Loaded tool history indices from localStorage:",this.toolHistoryIndices.size,"tools")}}catch(e){console.warn("[ParameterHistoryStore] Failed to load from localStorage:",e)}}saveToStorage(){try{const e=Object.fromEntries(this.parameterHistory);localStorage.setItem(this.PARAMETER_HISTORY_KEY,JSON.stringify(e)),console.log("[ParameterHistoryStore] Saved parameter history to localStorage");const t=Object.fromEntries(this.toolHistoryIndices);localStorage.setItem(this.TOOL_HISTORY_INDICES_KEY,JSON.stringify(t)),console.log("[ParameterHistoryStore] Saved tool history indices to localStorage")}catch(e){console.warn("[ParameterHistoryStore] Failed to save to localStorage:",e)}}getHistory(e){return this.parameterHistory.get(e)}hasParameterHistory(e){const t=this.parameterHistory.get(e);return t!==void 0&&t.length>0}saveParameterSet(e,t){if(!e||Object.keys(t).length===0)return;if(this.isDuplicate(e,t)){console.log("[ParameterHistoryStore] Parameter set is duplicate, not saving");return}this.parameterHistory.has(e)||this.parameterHistory.set(e,[]);const o=this.parameterHistory.get(e);o.unshift(t),o.length>this.MAX_HISTORY_SIZE&&o.splice(this.MAX_HISTORY_SIZE),this.parameterHistory.set(e,[...o]),this.saveToStorage(),console.log("[ParameterHistoryStore] Saved parameter set to history for",e)}isDuplicate(e,t){const o=this.parameterHistory.get(e);return!o||o.length===0?!1:o.some(a=>this.areParameterSetsEqual(a,t))}areParameterSetsEqual(e,t){const o=Object.keys(e).sort(),a=Object.keys(t).sort();return o.length!==a.length?!1:o.every(l=>e[l]===t[l])}getToolHistoryIndex(e){return this.toolHistoryIndices.get(e)??-1}setToolHistoryIndex(e,t){this.toolHistoryIndices.set(e,t),this.saveToStorage()}resetParamHistoryNavigation(e){e?(this.toolHistoryIndices.delete(e),console.log("[ParameterHistoryStore] Reset history navigation index for",e)):(this.toolHistoryIndices.clear(),console.log("[ParameterHistoryStore] Reset all tool history navigation indices")),this.saveToStorage()}getParameterSetFromHistory(e,t){const o=this.parameterHistory.get(e);if(!(!o||t<0||t>=o.length))return o[t]}clearHistory(e){this.parameterHistory.delete(e),this.saveToStorage(),console.log("[ParameterHistoryStore] Cleared history for",e)}clearAllHistory(){this.parameterHistory.clear(),this.toolHistoryIndices.clear(),this.saveToStorage(),console.log("[ParameterHistoryStore] Cleared all history")}}const We=new Fi,Be=Xe({getHistory:s=>We.getHistory(s),hasParameterHistory:s=>We.hasParameterHistory(s),saveParameterSet:(s,e)=>We.saveParameterSet(s,e),getToolHistoryIndex:s=>We.getToolHistoryIndex(s),setToolHistoryIndex:(s,e)=>We.setToolHistoryIndex(s,e),resetParamHistoryNavigation:s=>We.resetParamHistoryNavigation(s),getParameterSetFromHistory:(s,e)=>We.getParameterSetFromHistory(s,e),clearHistory:s=>We.clearHistory(s),clearAllHistory:()=>We.clearAllHistory(),MAX_HISTORY_SIZE:We.MAX_HISTORY_SIZE}),Mi={class:"config-section"},Di={class:"section-header"},Ni={class:"execution-content"},Ui={class:"params-requirements-group"},Oi={class:"params-help-text"},Li={key:0,class:"parameter-fields"},Hi={class:"parameter-label-row"},Bi={class:"parameter-label"},qi={key:0,class:"parameter-history-navigation"},ji={class:"history-navigation-controls"},Vi=["title","disabled"],Gi=["title"],zi=["onUpdate:modelValue","placeholder","onInput"],Wi={key:0,class:"parameter-error"},Ji={key:1,class:"validation-message"},Ki=["disabled"],Xi=["disabled"],Yi={key:1,class:"call-example-wrapper"},Zi={class:"call-example-header"},Qi={class:"call-example-title"},ec={class:"call-example-description"},tc={class:"internal-call-wrapper"},oc={class:"call-info"},sc={class:"call-method"},nc={class:"call-endpoint"},ac={key:0,class:"call-endpoint"},lc={class:"call-description"},rc={class:"call-example"},ic={class:"example-code"},cc={key:2,class:"call-example-wrapper"},uc={class:"call-example-header"},dc={class:"call-example-title"},pc={class:"call-example-description"},mc={class:"http-api-urls-wrapper"},hc={class:"tab-container"},fc={class:"tab-header"},vc=["onClick"],gc={class:"tab-content"},yc={class:"http-api-url-display"},bc={class:"api-method"},_c={class:"api-endpoint"},wc={class:"api-description"},Sc={key:0,class:"api-example"},$c={class:"example-code"},io=500,Pc=Fe({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(s,{expose:e}){const{t}=qe(),o=It(),a=tt(),l=rt(),r=lt(),d=s,g=x(""),c=x(!1),i=x({parameters:[],hasParameters:!1,requirements:""}),f=x({}),E=x(!1),P=x("post-async"),m=x({}),$=x(!1),b=x(!1),y=x(null),T=x(0),I=ce(()=>a.getCoordinatorToolConfig()),D=x(),C=x([]),_=x(null),B=x(!1),N=x(null),L=ce(()=>{const J=a.selectedTemplate.value?.title||"my-tool",X=a.selectedTemplate.value?.serviceGroup||"research",Y=a.selectedTemplate.value?.planTemplateId||"template-456",se={};i.value.hasParameters&&i.value.parameters.length>0?i.value.parameters.forEach(ze=>{se[ze]=f.value[ze]||"test"}):se.rawParam="test";const ge=y.value||t("sidebar.defaultPlanId"),Ee=y.value||t("sidebar.defaultPlanIdDetails");return[{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "${J}",
  "serviceGroup": "${X}",
  "replacementParams": ${JSON.stringify(se,null,2)},
  "uploadedFiles": []
}

Response: {
  "planId": "${ge}",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "${J}",
  "planTemplateId": "${Y}"
}

# Check execution status and get detailed results:
GET /api/executor/details/${Ee}
Response: {
  "currentPlanId": "${ge}",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "${J}",
  "serviceGroup": "${X}",
  "replacementParams": ${JSON.stringify(se,null,2)},
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`}]}),S=ce(()=>{const J=a.selectedTemplate.value?.toolConfig;return J?.enableInternalToolcall??J?.enableHttpService??J?.enableInConversation??!1}),M=ce(()=>S.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),U=ce(()=>l.isLoading.value),q=ce(()=>{if(U.value||d.isExecuting||b.value)return!1;const J=r.trackedPlanIds.value.size>0,Y=Array.from(r.planExecutionRecords.entries()).some(([,se])=>se&&!se.completed&&se.status!=="failed");return J||Y?!1:i.value.hasParameters?i.value.parameters.every(se=>{const ge=f.value[se];return typeof ge=="string"&&ge.trim()!==""}):!0}),j=(J,X)=>{C.value=J.map(Y=>Y.originalName),_.value=X,console.log("[ExecutionController] Files uploaded:",J.length,"uploadKey:",X)},O=J=>{C.value=J.map(X=>X.originalName),console.log("[ExecutionController] Files removed, remaining:",J.length)},G=J=>{_.value=J,console.log("[ExecutionController] Upload key changed:",J)},te=()=>{console.log("[ExecutionController] Upload started")},Z=()=>{console.log("[ExecutionController] Upload completed")},ae=J=>{console.error("[ExecutionController] Upload error:",J)},Ie=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),d.isExecuting||l.isLoading.value||b.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",d.isExecuting,l.isLoading.value,b.value),o.error(t("sidebar.executionInProgress"));return}if(fe.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value);return}const J=i.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;N.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:J,uploadedFiles:C.value,uploadKey:_.value},B.value=!0;return}await he()},he=async()=>{if(d.isExecuting||l.isLoading.value||b.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(b.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value),b.value=!1;return}le();try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),o.error(t("sidebar.selectPlanFirst")),b.value=!1;return}const J=a.getConfig(),X=a.selectedTemplate.value.planTemplateId||J.planTemplateId,Y={title:J.title||a.selectedTemplate.value.title||"Execution Plan",steps:(J.steps||[]).map(ot=>({stepRequirement:ot.stepRequirement||"",agentName:ot.agentName||"",modelName:ot.modelName||null,selectedToolKeys:[],terminateColumns:ot.terminateColumns||"",stepContent:""})),directResponse:J.directResponse||!1,...X&&{planTemplateId:X},...J.planType&&{planType:J.planType}},se=a.selectedTemplate.value.title??J.title??"Execution Plan",ge=a.selectedTemplate.value?.title||J.title||"",Ee=a.selectedTemplate.value?.serviceGroup||J.serviceGroup||void 0;if(!ge||ge.trim()===""){console.error("[ExecutionController] âŒ Tool name is required but not found"),o.error(t("sidebar.toolNameRequired")||"Tool name is required for execution"),b.value=!1;return}const ze=i.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",ze),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(Y,null,2)),console.log("[ExecutionController] ðŸ”§ Tool name:",ge,"Service group:",Ee);const ut={title:se,planData:Y,params:void 0,replacementParams:ze,uploadedFiles:C.value,uploadKey:_.value,toolName:ge,serviceGroup:Ee};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(ut,null,2));const Ke=await l.executePlan(ut);Ke.success?(console.log("[ExecutionController] âœ… Plan execution started successfully:",Ke.planId),Ke.planId&&(y.value=Ke.planId,console.log("[ExecutionController] ðŸ“ Tracked planId for API examples:",y.value))):(console.error("[ExecutionController] âŒ Plan execution failed:",Ke.error),o.error(Ke.error||t("sidebar.executeFailed")))}catch(J){console.error("[ExecutionController] âŒ Error executing plan:",J);const X=J instanceof Error?J.message:"Unknown error";o.error(t("sidebar.executeFailed")+": "+X),b.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),ee(),console.log("[ExecutionController] âœ… Cleanup completed")}},F=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){o.error(t("sidebar.selectPlanFirst"));return}const J=a.validate();if(!J.isValid){o.error(`Invalid format, please correct and save.
Errors: `+J.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){o.error("Plan template ID is required");return}if(!await a.save()){o.error("Failed to save plan template");return}const se=a.generateJsonString().trim();a.updateVersionsAfterSave(se);const ge=a.planVersions.value.length;fe.hasTaskRequirementModified=!1,await new Promise(Ee=>setTimeout(Ee,500)),await ne(),await fe.loadPlanTemplateList(),o.success(t("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ge})),await new Promise(Ee=>setTimeout(Ee,500)),N.value&&(await he(),N.value=null)}catch(J){console.error("[ExecutionController] âŒ Failed to save before execute:",J);const X=J instanceof Error?J.message:t("sidebar.saveFailed");throw o.error(X),J}},H=async()=>{console.log("[ExecutionController] â© Continue without save requested"),N.value&&(await he(),N.value=null)},z=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),o.error(t("mcpService.selectPlanTemplateFirst"));return}c.value=!0},ee=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),g.value="",f.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},ie=(J,X)=>{if(J.length!==X.length)return!1;const Y=[...J].sort(),se=[...X].sort();return Y.every((ge,Ee)=>ge===se[Ee])},ne=async()=>{const J=Date.now();if(J-T.value<io){console.log("[ExecutionController] â¸ï¸ Skipping refresh - too soon after last refresh (debounced)");return}const X=[...i.value.parameters];await new Promise(se=>setTimeout(se,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(se=>se.stepRequirement).join(" ||| ")),await new Promise(se=>setTimeout(se,200)),await ve(),T.value=J;const Y=[...i.value.parameters];ie(X,Y)?console.log("[ExecutionController] âœ… Parameter list unchanged, values preserved:",JSON.stringify(f.value,null,2)):console.log("[ExecutionController] ðŸ”„ Parameter list changed:",JSON.stringify({old:X,new:Y},null,2))},ve=async()=>{const J=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",J),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(i.value,null,2)),!J){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),i.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}const X={...f.value};console.log("[ExecutionController] ðŸ’¾ Preserved parameter values before reload:",JSON.stringify(X,null,2)),i.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const Y=await Do.getParameterRequirements(J);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(Y,null,2)),i.value=Y;const se={};Y.parameters.forEach(ge=>{se[ge]=X[ge]||""}),f.value=se,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(i.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(f.value,null,2)),W()}catch(Y){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",Y),Y instanceof Error&&!Y.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),i.value={parameters:[],hasParameters:!1,requirements:""},Object.keys(X).length>0?(console.log("[ExecutionController] ðŸ”„ Restoring preserved values on error:",JSON.stringify(X,null,2)),f.value={...X}):f.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(i.value,null,2)),console.log("[ExecutionController] ðŸ”„ Restored parameterValues:",JSON.stringify(f.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},oe=(J,X)=>{f.value[J]=X,m.value[J]&&delete m.value[J];const Y=a.currentPlanTemplateId.value;Y&&Be.setToolHistoryIndex(Y,-1),W()},re=()=>{if(m.value={},$.value=!1,!i.value.hasParameters)return!0;let J=!1;return i.value.parameters.forEach(X=>{(f.value[X]?f.value[X].trim():"")||(m.value[X]=`${X} is required`,J=!0)}),$.value=J,!J},W=()=>{i.value.hasParameters?g.value=JSON.stringify(f.value,null,2):g.value=""},le=()=>{const J=a.currentPlanTemplateId.value;if(!J){console.log("[ExecutionController] âš ï¸ No planTemplateId, skipping history save");return}if(!i.value.hasParameters||Object.keys(f.value).length===0){console.log("[ExecutionController] âš ï¸ No parameters to save to history");return}const X={...f.value};Be.saveParameterSet(J,X),console.log("[ExecutionController] ðŸ’¾ Saved parameter set to history:",JSON.stringify(X,null,2)),Be.resetParamHistoryNavigation(J)},ue=()=>{const J=a.currentPlanTemplateId.value;J&&Be.resetParamHistoryNavigation(J)},de=J=>{const X=a.currentPlanTemplateId.value;if(!X){console.log("[ExecutionController] âš ï¸ No planTemplateId, cannot navigate history");return}const Y=Be.getHistory(X);if(!Y||Y.length===0){console.log("[ExecutionController] âš ï¸ No history available for navigation");return}const se=Be.getToolHistoryIndex(X);let ge;if(J==="up")se===-1?ge=0:se<Y.length-1?ge=se+1:ge=se;else{if(se===-1)return;if(se>0)ge=se-1;else{ge=-1,Object.keys(f.value).forEach(Ee=>{f.value[Ee]=""}),Be.setToolHistoryIndex(X,-1),W(),console.log("[ExecutionController] ðŸ“œ Cleared all parameter values");return}}if(ge>=0&&ge<Y.length){const Ee=Be.getParameterSetFromHistory(X,ge);Ee&&(Object.keys(Ee).forEach(ze=>{f.value[ze]=Ee[ze]}),Be.setToolHistoryIndex(X,ge),W(),console.log(`[ExecutionController] ðŸ“œ Navigated to history index ${ge}:`,JSON.stringify(Ee,null,2)))}else ge===-1&&(Be.setToolHistoryIndex(X,-1),console.log("[ExecutionController] ðŸ“œ Reset to current values"))},_e=()=>{const J=a.currentPlanTemplateId.value;return J?Be.hasParameterHistory(J):!1},Re=()=>{const J=a.currentPlanTemplateId.value;return J?Be.getToolHistoryIndex(J):-1},bt=()=>{const J=a.currentPlanTemplateId.value;if(!J)return 0;const X=Be.getHistory(J);return X?X.length:0};return Pe(()=>a.currentPlanTemplateId.value,(J,X)=>{if(J&&J!==X){if(b.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}ue(),console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),X&&J.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),ve()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),ve())}}),Pe(()=>fe.hasTaskRequirementModified,async(J,X)=>{if(X===!0&&J===!1&&a.currentPlanTemplateId.value){if(b.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}if(Date.now()-T.value<io){console.log("[ExecutionController] â¸ï¸ Skipping parameter refresh - debounced (too soon after last refresh)");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(se=>setTimeout(se,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await ne()}}),Co(()=>{const J=r.planExecutionRecords,X=Array.from(J.entries()),Y=r.trackedPlanIds.value.size>0,se=X.some(([,Ee])=>Ee&&!Ee.completed&&Ee.status!=="failed");!(Y||se)&&b.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:Y,hasRunningPlansInRecords:se,trackedPlanIds:Array.from(r.trackedPlanIds.value),recordsCount:X.length}),b.value=!1)}),He(()=>{ve()}),e({executionParams:g,clearExecutionParams:ee,loadParameterRequirements:ve,refreshParameterRequirements:ne,fileUploadRef:D,uploadedFiles:C,uploadKey:_}),(J,X)=>(h(),v(be,null,[n("div",Mi,[n("div",Di,[R(p(A),{icon:"carbon:play",width:"16"}),n("span",null,u(p(t)("sidebar.executionController")),1)]),n("div",Ni,[n("div",Ui,[n("label",null,u(p(t)("sidebar.parameterRequirements")),1),n("div",Oi,u(p(t)("sidebar.parameterRequirementsHelp")),1),i.value.hasParameters?(h(),v("div",Li,[(h(!0),v(be,null,$e(i.value.parameters,(Y,se)=>(h(),v("div",{key:Y,class:"parameter-field"},[n("div",Hi,[n("label",Bi,[ye(u(Y)+" ",1),X[4]||(X[4]=n("span",{class:"required"},"*",-1))]),se===0&&_e()?(h(),v("div",qi,[n("div",ji,[n("button",{type:"button",class:"history-btn history-btn-up",title:p(t)("sidebar.historyUp"),disabled:Re()>=bt()-1,onClick:X[0]||(X[0]=ge=>de("up"))},[R(p(A),{icon:"carbon:chevron-up",width:"12"})],8,Vi),n("button",{type:"button",class:"history-btn history-btn-down",title:p(t)("sidebar.historyDown"),onClick:X[1]||(X[1]=ge=>de("down"))},[R(p(A),{icon:"carbon:chevron-down",width:"12"})],8,Gi)])])):V("",!0)]),Te(n("input",{"onUpdate:modelValue":ge=>f.value[Y]=ge,class:Se(["parameter-input",{error:m.value[Y],"viewing-history":Re()>=0}]),placeholder:p(t)("sidebar.enterValueFor",{param:Y}),onInput:ge=>oe(Y,ge.target.value),required:""},null,42,zi),[[De,f.value[Y]]]),m.value[Y]?(h(),v("div",Wi,u(m.value[Y]),1)):V("",!0)]))),128))])):V("",!0),i.value.hasParameters&&!q.value&&!d.isExecuting?(h(),v("div",Ji,[R(p(A),{icon:"carbon:warning",width:"14"}),ye(" "+u(p(t)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),R(Mo,{ref_key:"fileUploadRef",ref:D,disabled:d.isExecuting,onFilesUploaded:j,onFilesRemoved:O,onUploadKeyChanged:G,onUploadStarted:te,onUploadCompleted:Z,onUploadError:ae},null,8,["disabled"]),n("button",{class:"btn btn-primary execute-btn",onClick:Ie,disabled:!q.value},[R(p(A),{icon:d.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:Se({spinning:d.isExecuting})},null,8,["icon","class"]),ye(" "+u(d.isExecuting?p(t)("sidebar.executing"):p(t)("sidebar.executePlan")),1)],8,Ki),I.value?(h(),v("button",{key:0,class:"btn publish-mcp-btn",onClick:z,disabled:!p(a).currentPlanTemplateId.value},[R(p(A),{icon:"carbon:application",width:"16"}),ye(" "+u(M.value),1)],8,Xi)):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),v("div",Yi,[n("div",Zi,[n("h4",Qi,u(p(t)("sidebar.internalCall")),1),n("p",ec,u(p(t)("sidebar.internalCallDescription")),1)]),n("div",tc,[n("div",oc,[n("div",sc,u(p(t)("sidebar.internalMethodCall")),1),n("div",nc,u(p(t)("sidebar.toolName"))+": "+u(p(a).selectedTemplate.value?.title||p(a).currentPlanTemplateId.value||""),1),p(a).selectedTemplate.value?.serviceGroup?(h(),v("div",ac,u(p(t)("sidebar.serviceGroup"))+": "+u(p(a).selectedTemplate.value.serviceGroup),1)):V("",!0),n("div",lc,u(p(t)("sidebar.internalCallUsage")),1),n("div",rc,[n("strong",null,u(p(t)("sidebar.usage"))+":",1),n("pre",ic,u(p(t)("sidebar.internalCallExample")),1)])])])])):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),v("div",cc,[n("div",uc,[n("h4",dc,u(p(t)("sidebar.httpCallExample")),1),n("p",pc,u(p(t)("sidebar.httpCallDescription")),1)]),n("div",mc,[n("div",hc,[n("div",fc,[(h(!0),v(be,null,$e(L.value,Y=>(h(),v("button",{key:Y.id,class:Se(["tab-button",{active:P.value===Y.id}]),onClick:se=>P.value=Y.id},u(Y.label),11,vc))),128))]),n("div",gc,[(h(!0),v(be,null,$e(L.value,Y=>Te((h(),v("div",{key:Y.id,class:"tab-panel"},[n("div",yc,[n("div",bc,u(Y.method),1),n("div",_c,u(Y.endpoint),1),n("div",wc,u(Y.description),1),Y.example?(h(),v("div",Sc,[n("strong",null,u(p(t)("sidebar.example"))+":",1),n("pre",$c,u(Y.example),1)])):V("",!0)])])),[[gs,P.value===Y.id]])),128))])])])])):V("",!0)])]),R(Ai,{modelValue:B.value,"onUpdate:modelValue":X[2]||(X[2]=Y=>B.value=Y),onSave:F,onContinue:H},null,8,["modelValue"]),R(Ei,{modelValue:c.value,"onUpdate:modelValue":X[3]||(X[3]=Y=>c.value=Y)},null,8,["modelValue"])],64))}}),Tc=Me(Pc,[["__scopeId","data-v-cd8309fc"]]);function Uo(s,e){return function(){return s.apply(e,arguments)}}const{toString:Ec}=Object.prototype,{getPrototypeOf:Xt}=Object,{iterator:Rt,toStringTag:Oo}=Symbol,xt=(s=>e=>{const t=Ec.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ge=s=>(s=s.toLowerCase(),e=>xt(e)===s),At=s=>e=>typeof e===s,{isArray:it}=Array,at=At("undefined");function ft(s){return s!==null&&!at(s)&&s.constructor!==null&&!at(s.constructor)&&Oe(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Lo=Ge("ArrayBuffer");function kc(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&Lo(s.buffer),e}const Cc=At("string"),Oe=At("function"),Ho=At("number"),vt=s=>s!==null&&typeof s=="object",Ic=s=>s===!0||s===!1,$t=s=>{if(xt(s)!=="object")return!1;const e=Xt(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Oo in s)&&!(Rt in s)},Rc=s=>{if(!vt(s)||ft(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},xc=Ge("Date"),Ac=Ge("File"),Fc=Ge("Blob"),Mc=Ge("FileList"),Dc=s=>vt(s)&&Oe(s.pipe),Nc=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||Oe(s.append)&&((e=xt(s))==="formdata"||e==="object"&&Oe(s.toString)&&s.toString()==="[object FormData]"))},Uc=Ge("URLSearchParams"),[Oc,Lc,Hc,Bc]=["ReadableStream","Request","Response","Headers"].map(Ge),qc=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function gt(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let o,a;if(typeof s!="object"&&(s=[s]),it(s))for(o=0,a=s.length;o<a;o++)e.call(null,s[o],o,s);else{if(ft(s))return;const l=t?Object.getOwnPropertyNames(s):Object.keys(s),r=l.length;let d;for(o=0;o<r;o++)d=l[o],e.call(null,s[d],d,s)}}function Bo(s,e){if(ft(s))return null;e=e.toLowerCase();const t=Object.keys(s);let o=t.length,a;for(;o-- >0;)if(a=t[o],e===a.toLowerCase())return a;return null}const Ye=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qo=s=>!at(s)&&s!==Ye;function Gt(){const{caseless:s,skipUndefined:e}=qo(this)&&this||{},t={},o=(a,l)=>{const r=s&&Bo(t,l)||l;$t(t[r])&&$t(a)?t[r]=Gt(t[r],a):$t(a)?t[r]=Gt({},a):it(a)?t[r]=a.slice():(!e||!at(a))&&(t[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&gt(arguments[a],o);return t}const jc=(s,e,t,{allOwnKeys:o}={})=>(gt(e,(a,l)=>{t&&Oe(a)?s[l]=Uo(a,t):s[l]=a},{allOwnKeys:o}),s),Vc=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Gc=(s,e,t,o)=>{s.prototype=Object.create(e.prototype,o),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},zc=(s,e,t,o)=>{let a,l,r;const d={};if(e=e||{},s==null)return e;do{for(a=Object.getOwnPropertyNames(s),l=a.length;l-- >0;)r=a[l],(!o||o(r,s,e))&&!d[r]&&(e[r]=s[r],d[r]=!0);s=t!==!1&&Xt(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},Wc=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const o=s.indexOf(e,t);return o!==-1&&o===t},Jc=s=>{if(!s)return null;if(it(s))return s;let e=s.length;if(!Ho(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},Kc=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&Xt(Uint8Array)),Xc=(s,e)=>{const o=(s&&s[Rt]).call(s);let a;for(;(a=o.next())&&!a.done;){const l=a.value;e.call(s,l[0],l[1])}},Yc=(s,e)=>{let t;const o=[];for(;(t=s.exec(e))!==null;)o.push(t);return o},Zc=Ge("HTMLFormElement"),Qc=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,o,a){return o.toUpperCase()+a}),co=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),eu=Ge("RegExp"),jo=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),o={};gt(t,(a,l)=>{let r;(r=e(a,l,s))!==!1&&(o[l]=r||a)}),Object.defineProperties(s,o)},tu=s=>{jo(s,(e,t)=>{if(Oe(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const o=s[t];if(Oe(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ou=(s,e)=>{const t={},o=a=>{a.forEach(l=>{t[l]=!0})};return it(s)?o(s):o(String(s).split(e)),t},su=()=>{},nu=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function au(s){return!!(s&&Oe(s.append)&&s[Oo]==="FormData"&&s[Rt])}const lu=s=>{const e=new Array(10),t=(o,a)=>{if(vt(o)){if(e.indexOf(o)>=0)return;if(ft(o))return o;if(!("toJSON"in o)){e[a]=o;const l=it(o)?[]:{};return gt(o,(r,d)=>{const g=t(r,a+1);!at(g)&&(l[d]=g)}),e[a]=void 0,l}}return o};return t(s,0)},ru=Ge("AsyncFunction"),iu=s=>s&&(vt(s)||Oe(s))&&Oe(s.then)&&Oe(s.catch),Vo=((s,e)=>s?setImmediate:e?((t,o)=>(Ye.addEventListener("message",({source:a,data:l})=>{a===Ye&&l===t&&o.length&&o.shift()()},!1),a=>{o.push(a),Ye.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Oe(Ye.postMessage)),cu=typeof queueMicrotask<"u"?queueMicrotask.bind(Ye):typeof process<"u"&&process.nextTick||Vo,uu=s=>s!=null&&Oe(s[Rt]),k={isArray:it,isArrayBuffer:Lo,isBuffer:ft,isFormData:Nc,isArrayBufferView:kc,isString:Cc,isNumber:Ho,isBoolean:Ic,isObject:vt,isPlainObject:$t,isEmptyObject:Rc,isReadableStream:Oc,isRequest:Lc,isResponse:Hc,isHeaders:Bc,isUndefined:at,isDate:xc,isFile:Ac,isBlob:Fc,isRegExp:eu,isFunction:Oe,isStream:Dc,isURLSearchParams:Uc,isTypedArray:Kc,isFileList:Mc,forEach:gt,merge:Gt,extend:jc,trim:qc,stripBOM:Vc,inherits:Gc,toFlatObject:zc,kindOf:xt,kindOfTest:Ge,endsWith:Wc,toArray:Jc,forEachEntry:Xc,matchAll:Yc,isHTMLForm:Zc,hasOwnProperty:co,hasOwnProp:co,reduceDescriptors:jo,freezeMethods:tu,toObjectSet:ou,toCamelCase:Qc,noop:su,toFiniteNumber:nu,findKey:Bo,global:Ye,isContextDefined:qo,isSpecCompliantForm:au,toJSONObject:lu,isAsyncFn:ru,isThenable:iu,setImmediate:Vo,asap:cu,isIterable:uu};function me(s,e,t,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),o&&(this.request=o),a&&(this.response=a,this.status=a.status?a.status:null)}k.inherits(me,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.status}}});const Go=me.prototype,zo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{zo[s]={value:s}});Object.defineProperties(me,zo);Object.defineProperty(Go,"isAxiosError",{value:!0});me.from=(s,e,t,o,a,l)=>{const r=Object.create(Go);k.toFlatObject(s,r,function(i){return i!==Error.prototype},c=>c!=="isAxiosError");const d=s&&s.message?s.message:"Error",g=e==null&&s?s.code:e;return me.call(r,d,g,t,o,a),s&&r.cause==null&&Object.defineProperty(r,"cause",{value:s,configurable:!0}),r.name=s&&s.name||"Error",l&&Object.assign(r,l),r};const du=null;function zt(s){return k.isPlainObject(s)||k.isArray(s)}function Wo(s){return k.endsWith(s,"[]")?s.slice(0,-2):s}function uo(s,e,t){return s?s.concat(e).map(function(a,l){return a=Wo(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function pu(s){return k.isArray(s)&&!s.some(zt)}const mu=k.toFlatObject(k,{},null,function(e){return/^is[A-Z]/.test(e)});function Ft(s,e,t){if(!k.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=k.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,b){return!k.isUndefined(b[$])});const o=t.metaTokens,a=t.visitor||i,l=t.dots,r=t.indexes,g=(t.Blob||typeof Blob<"u"&&Blob)&&k.isSpecCompliantForm(e);if(!k.isFunction(a))throw new TypeError("visitor must be a function");function c(m){if(m===null)return"";if(k.isDate(m))return m.toISOString();if(k.isBoolean(m))return m.toString();if(!g&&k.isBlob(m))throw new me("Blob is not supported. Use a Buffer instead.");return k.isArrayBuffer(m)||k.isTypedArray(m)?g&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function i(m,$,b){let y=m;if(m&&!b&&typeof m=="object"){if(k.endsWith($,"{}"))$=o?$:$.slice(0,-2),m=JSON.stringify(m);else if(k.isArray(m)&&pu(m)||(k.isFileList(m)||k.endsWith($,"[]"))&&(y=k.toArray(m)))return $=Wo($),y.forEach(function(I,D){!(k.isUndefined(I)||I===null)&&e.append(r===!0?uo([$],D,l):r===null?$:$+"[]",c(I))}),!1}return zt(m)?!0:(e.append(uo(b,$,l),c(m)),!1)}const f=[],E=Object.assign(mu,{defaultVisitor:i,convertValue:c,isVisitable:zt});function P(m,$){if(!k.isUndefined(m)){if(f.indexOf(m)!==-1)throw Error("Circular reference detected in "+$.join("."));f.push(m),k.forEach(m,function(y,T){(!(k.isUndefined(y)||y===null)&&a.call(e,y,k.isString(T)?T.trim():T,$,E))===!0&&P(y,$?$.concat(T):[T])}),f.pop()}}if(!k.isObject(s))throw new TypeError("data must be an object");return P(s),e}function po(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function Yt(s,e){this._pairs=[],s&&Ft(s,this,e)}const Jo=Yt.prototype;Jo.append=function(e,t){this._pairs.push([e,t])};Jo.toString=function(e){const t=e?function(o){return e.call(this,o,po)}:po;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function hu(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ko(s,e,t){if(!e)return s;const o=t&&t.encode||hu;k.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=k.isURLSearchParams(e)?e.toString():new Yt(e,t).toString(o),l){const r=s.indexOf("#");r!==-1&&(s=s.slice(0,r)),s+=(s.indexOf("?")===-1?"?":"&")+l}return s}class mo{constructor(){this.handlers=[]}use(e,t,o){return this.handlers.push({fulfilled:e,rejected:t,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){k.forEach(this.handlers,function(o){o!==null&&e(o)})}}const Xo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fu=typeof URLSearchParams<"u"?URLSearchParams:Yt,vu=typeof FormData<"u"?FormData:null,gu=typeof Blob<"u"?Blob:null,yu={isBrowser:!0,classes:{URLSearchParams:fu,FormData:vu,Blob:gu},protocols:["http","https","file","blob","url","data"]},Zt=typeof window<"u"&&typeof document<"u",Wt=typeof navigator=="object"&&navigator||void 0,bu=Zt&&(!Wt||["ReactNative","NativeScript","NS"].indexOf(Wt.product)<0),_u=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wu=Zt&&window.location.href||"http://localhost",Su=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Zt,hasStandardBrowserEnv:bu,hasStandardBrowserWebWorkerEnv:_u,navigator:Wt,origin:wu},Symbol.toStringTag,{value:"Module"})),Ne={...Su,...yu};function $u(s,e){return Ft(s,new Ne.classes.URLSearchParams,{visitor:function(t,o,a,l){return Ne.isNode&&k.isBuffer(t)?(this.append(o,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function Pu(s){return k.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Tu(s){const e={},t=Object.keys(s);let o;const a=t.length;let l;for(o=0;o<a;o++)l=t[o],e[l]=s[l];return e}function Yo(s){function e(t,o,a,l){let r=t[l++];if(r==="__proto__")return!0;const d=Number.isFinite(+r),g=l>=t.length;return r=!r&&k.isArray(a)?a.length:r,g?(k.hasOwnProp(a,r)?a[r]=[a[r],o]:a[r]=o,!d):((!a[r]||!k.isObject(a[r]))&&(a[r]=[]),e(t,o,a[r],l)&&k.isArray(a[r])&&(a[r]=Tu(a[r])),!d)}if(k.isFormData(s)&&k.isFunction(s.entries)){const t={};return k.forEachEntry(s,(o,a)=>{e(Pu(o),a,t,0)}),t}return null}function Eu(s,e,t){if(k.isString(s))try{return(e||JSON.parse)(s),k.trim(s)}catch(o){if(o.name!=="SyntaxError")throw o}return(t||JSON.stringify)(s)}const yt={transitional:Xo,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const o=t.getContentType()||"",a=o.indexOf("application/json")>-1,l=k.isObject(e);if(l&&k.isHTMLForm(e)&&(e=new FormData(e)),k.isFormData(e))return a?JSON.stringify(Yo(e)):e;if(k.isArrayBuffer(e)||k.isBuffer(e)||k.isStream(e)||k.isFile(e)||k.isBlob(e)||k.isReadableStream(e))return e;if(k.isArrayBufferView(e))return e.buffer;if(k.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return $u(e,this.formSerializer).toString();if((d=k.isFileList(e))||o.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return Ft(d?{"files[]":e}:e,g&&new g,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),Eu(e)):e}],transformResponse:[function(e){const t=this.transitional||yt.transitional,o=t&&t.forcedJSONParsing,a=this.responseType==="json";if(k.isResponse(e)||k.isReadableStream(e))return e;if(e&&k.isString(e)&&(o&&!this.responseType||a)){const r=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(d){if(r)throw d.name==="SyntaxError"?me.from(d,me.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ne.classes.FormData,Blob:Ne.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};k.forEach(["delete","get","head","post","put","patch"],s=>{yt.headers[s]={}});const ku=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cu=s=>{const e={};let t,o,a;return s&&s.split(`
`).forEach(function(r){a=r.indexOf(":"),t=r.substring(0,a).trim().toLowerCase(),o=r.substring(a+1).trim(),!(!t||e[t]&&ku[t])&&(t==="set-cookie"?e[t]?e[t].push(o):e[t]=[o]:e[t]=e[t]?e[t]+", "+o:o)}),e},ho=Symbol("internals");function pt(s){return s&&String(s).trim().toLowerCase()}function Pt(s){return s===!1||s==null?s:k.isArray(s)?s.map(Pt):String(s)}function Iu(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=t.exec(s);)e[o[1]]=o[2];return e}const Ru=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function Ot(s,e,t,o,a){if(k.isFunction(o))return o.call(this,e,t);if(a&&(e=t),!!k.isString(e)){if(k.isString(o))return e.indexOf(o)!==-1;if(k.isRegExp(o))return o.test(e)}}function xu(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,o)=>t.toUpperCase()+o)}function Au(s,e){const t=k.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(s,o+t,{value:function(a,l,r){return this[o].call(this,e,a,l,r)},configurable:!0})})}let Le=class{constructor(e){e&&this.set(e)}set(e,t,o){const a=this;function l(d,g,c){const i=pt(g);if(!i)throw new Error("header name must be a non-empty string");const f=k.findKey(a,i);(!f||a[f]===void 0||c===!0||c===void 0&&a[f]!==!1)&&(a[f||g]=Pt(d))}const r=(d,g)=>k.forEach(d,(c,i)=>l(c,i,g));if(k.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(k.isString(e)&&(e=e.trim())&&!Ru(e))r(Cu(e),t);else if(k.isObject(e)&&k.isIterable(e)){let d={},g,c;for(const i of e){if(!k.isArray(i))throw TypeError("Object iterator must return a key-value pair");d[c=i[0]]=(g=d[c])?k.isArray(g)?[...g,i[1]]:[g,i[1]]:i[1]}r(d,t)}else e!=null&&l(t,e,o);return this}get(e,t){if(e=pt(e),e){const o=k.findKey(this,e);if(o){const a=this[o];if(!t)return a;if(t===!0)return Iu(a);if(k.isFunction(t))return t.call(this,a,o);if(k.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=pt(e),e){const o=k.findKey(this,e);return!!(o&&this[o]!==void 0&&(!t||Ot(this,this[o],o,t)))}return!1}delete(e,t){const o=this;let a=!1;function l(r){if(r=pt(r),r){const d=k.findKey(o,r);d&&(!t||Ot(o,o[d],d,t))&&(delete o[d],a=!0)}}return k.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let o=t.length,a=!1;for(;o--;){const l=t[o];(!e||Ot(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,o={};return k.forEach(this,(a,l)=>{const r=k.findKey(o,l);if(r){t[r]=Pt(a),delete t[l];return}const d=e?xu(l):String(l).trim();d!==l&&delete t[l],t[d]=Pt(a),o[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return k.forEach(this,(o,a)=>{o!=null&&o!==!1&&(t[a]=e&&k.isArray(o)?o.join(", "):o)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const o=new this(e);return t.forEach(a=>o.set(a)),o}static accessor(e){const o=(this[ho]=this[ho]={accessors:{}}).accessors,a=this.prototype;function l(r){const d=pt(r);o[d]||(Au(a,r),o[d]=!0)}return k.isArray(e)?e.forEach(l):l(e),this}};Le.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);k.reduceDescriptors(Le.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(o){this[t]=o}}});k.freezeMethods(Le);function Lt(s,e){const t=this||yt,o=e||t,a=Le.from(o.headers);let l=o.data;return k.forEach(s,function(d){l=d.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Zo(s){return!!(s&&s.__CANCEL__)}function ct(s,e,t){me.call(this,s??"canceled",me.ERR_CANCELED,e,t),this.name="CanceledError"}k.inherits(ct,me,{__CANCEL__:!0});function Qo(s,e,t){const o=t.config.validateStatus;!t.status||!o||o(t.status)?s(t):e(new me("Request failed with status code "+t.status,[me.ERR_BAD_REQUEST,me.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Fu(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function Mu(s,e){s=s||10;const t=new Array(s),o=new Array(s);let a=0,l=0,r;return e=e!==void 0?e:1e3,function(g){const c=Date.now(),i=o[l];r||(r=c),t[a]=g,o[a]=c;let f=l,E=0;for(;f!==a;)E+=t[f++],f=f%s;if(a=(a+1)%s,a===l&&(l=(l+1)%s),c-r<e)return;const P=i&&c-i;return P?Math.round(E*1e3/P):void 0}}function Du(s,e){let t=0,o=1e3/e,a,l;const r=(c,i=Date.now())=>{t=i,a=null,l&&(clearTimeout(l),l=null),s(...c)};return[(...c)=>{const i=Date.now(),f=i-t;f>=o?r(c,i):(a=c,l||(l=setTimeout(()=>{l=null,r(a)},o-f)))},()=>a&&r(a)]}const kt=(s,e,t=3)=>{let o=0;const a=Mu(50,250);return Du(l=>{const r=l.loaded,d=l.lengthComputable?l.total:void 0,g=r-o,c=a(g),i=r<=d;o=r;const f={loaded:r,total:d,progress:d?r/d:void 0,bytes:g,rate:c||void 0,estimated:c&&d&&i?(d-r)/c:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};s(f)},t)},fo=(s,e)=>{const t=s!=null;return[o=>e[0]({lengthComputable:t,total:s,loaded:o}),e[1]]},vo=s=>(...e)=>k.asap(()=>s(...e)),Nu=Ne.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,Ne.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(Ne.origin),Ne.navigator&&/(msie|trident)/i.test(Ne.navigator.userAgent)):()=>!0,Uu=Ne.hasStandardBrowserEnv?{write(s,e,t,o,a,l,r){if(typeof document>"u")return;const d=[`${s}=${encodeURIComponent(e)}`];k.isNumber(t)&&d.push(`expires=${new Date(t).toUTCString()}`),k.isString(o)&&d.push(`path=${o}`),k.isString(a)&&d.push(`domain=${a}`),l===!0&&d.push("secure"),k.isString(r)&&d.push(`SameSite=${r}`),document.cookie=d.join("; ")},read(s){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Ou(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Lu(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function es(s,e,t){let o=!Ou(e);return s&&(o||t==!1)?Lu(s,e):e}const go=s=>s instanceof Le?{...s}:s;function et(s,e){e=e||{};const t={};function o(c,i,f,E){return k.isPlainObject(c)&&k.isPlainObject(i)?k.merge.call({caseless:E},c,i):k.isPlainObject(i)?k.merge({},i):k.isArray(i)?i.slice():i}function a(c,i,f,E){if(k.isUndefined(i)){if(!k.isUndefined(c))return o(void 0,c,f,E)}else return o(c,i,f,E)}function l(c,i){if(!k.isUndefined(i))return o(void 0,i)}function r(c,i){if(k.isUndefined(i)){if(!k.isUndefined(c))return o(void 0,c)}else return o(void 0,i)}function d(c,i,f){if(f in e)return o(c,i);if(f in s)return o(void 0,c)}const g={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:d,headers:(c,i,f)=>a(go(c),go(i),f,!0)};return k.forEach(Object.keys({...s,...e}),function(i){const f=g[i]||a,E=f(s[i],e[i],i);k.isUndefined(E)&&f!==d||(t[i]=E)}),t}const ts=s=>{const e=et({},s);let{data:t,withXSRFToken:o,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:d}=e;if(e.headers=r=Le.from(r),e.url=Ko(es(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),d&&r.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),k.isFormData(t)){if(Ne.hasStandardBrowserEnv||Ne.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(k.isFunction(t.getHeaders)){const g=t.getHeaders(),c=["content-type","content-length"];Object.entries(g).forEach(([i,f])=>{c.includes(i.toLowerCase())&&r.set(i,f)})}}if(Ne.hasStandardBrowserEnv&&(o&&k.isFunction(o)&&(o=o(e)),o||o!==!1&&Nu(e.url))){const g=a&&l&&Uu.read(l);g&&r.set(a,g)}return e},Hu=typeof XMLHttpRequest<"u",Bu=Hu&&function(s){return new Promise(function(t,o){const a=ts(s);let l=a.data;const r=Le.from(a.headers).normalize();let{responseType:d,onUploadProgress:g,onDownloadProgress:c}=a,i,f,E,P,m;function $(){P&&P(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(i),a.signal&&a.signal.removeEventListener("abort",i)}let b=new XMLHttpRequest;b.open(a.method.toUpperCase(),a.url,!0),b.timeout=a.timeout;function y(){if(!b)return;const I=Le.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),C={data:!d||d==="text"||d==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:I,config:s,request:b};Qo(function(B){t(B),$()},function(B){o(B),$()},C),b=null}"onloadend"in b?b.onloadend=y:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(y)},b.onabort=function(){b&&(o(new me("Request aborted",me.ECONNABORTED,s,b)),b=null)},b.onerror=function(D){const C=D&&D.message?D.message:"Network Error",_=new me(C,me.ERR_NETWORK,s,b);_.event=D||null,o(_),b=null},b.ontimeout=function(){let D=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const C=a.transitional||Xo;a.timeoutErrorMessage&&(D=a.timeoutErrorMessage),o(new me(D,C.clarifyTimeoutError?me.ETIMEDOUT:me.ECONNABORTED,s,b)),b=null},l===void 0&&r.setContentType(null),"setRequestHeader"in b&&k.forEach(r.toJSON(),function(D,C){b.setRequestHeader(C,D)}),k.isUndefined(a.withCredentials)||(b.withCredentials=!!a.withCredentials),d&&d!=="json"&&(b.responseType=a.responseType),c&&([E,m]=kt(c,!0),b.addEventListener("progress",E)),g&&b.upload&&([f,P]=kt(g),b.upload.addEventListener("progress",f),b.upload.addEventListener("loadend",P)),(a.cancelToken||a.signal)&&(i=I=>{b&&(o(!I||I.type?new ct(null,s,b):I),b.abort(),b=null)},a.cancelToken&&a.cancelToken.subscribe(i),a.signal&&(a.signal.aborted?i():a.signal.addEventListener("abort",i)));const T=Fu(a.url);if(T&&Ne.protocols.indexOf(T)===-1){o(new me("Unsupported protocol "+T+":",me.ERR_BAD_REQUEST,s));return}b.send(l||null)})},qu=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let o=new AbortController,a;const l=function(c){if(!a){a=!0,d();const i=c instanceof Error?c:this.reason;o.abort(i instanceof me?i:new ct(i instanceof Error?i.message:i))}};let r=e&&setTimeout(()=>{r=null,l(new me(`timeout ${e} of ms exceeded`,me.ETIMEDOUT))},e);const d=()=>{s&&(r&&clearTimeout(r),r=null,s.forEach(c=>{c.unsubscribe?c.unsubscribe(l):c.removeEventListener("abort",l)}),s=null)};s.forEach(c=>c.addEventListener("abort",l));const{signal:g}=o;return g.unsubscribe=()=>k.asap(d),g}},ju=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let o=0,a;for(;o<t;)a=o+e,yield s.slice(o,a),o=a},Vu=async function*(s,e){for await(const t of Gu(s))yield*ju(t,e)},Gu=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:o}=await e.read();if(t)break;yield o}}finally{await e.cancel()}},yo=(s,e,t,o)=>{const a=Vu(s,e);let l=0,r,d=g=>{r||(r=!0,o&&o(g))};return new ReadableStream({async pull(g){try{const{done:c,value:i}=await a.next();if(c){d(),g.close();return}let f=i.byteLength;if(t){let E=l+=f;t(E)}g.enqueue(new Uint8Array(i))}catch(c){throw d(c),c}},cancel(g){return d(g),a.return()}},{highWaterMark:2})},bo=64*1024,{isFunction:wt}=k,zu=(({Request:s,Response:e})=>({Request:s,Response:e}))(k.global),{ReadableStream:_o,TextEncoder:wo}=k.global,So=(s,...e)=>{try{return!!s(...e)}catch{return!1}},Wu=s=>{s=k.merge.call({skipUndefined:!0},zu,s);const{fetch:e,Request:t,Response:o}=s,a=e?wt(e):typeof fetch=="function",l=wt(t),r=wt(o);if(!a)return!1;const d=a&&wt(_o),g=a&&(typeof wo=="function"?(m=>$=>m.encode($))(new wo):async m=>new Uint8Array(await new t(m).arrayBuffer())),c=l&&d&&So(()=>{let m=!1;const $=new t(Ne.origin,{body:new _o,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!$}),i=r&&d&&So(()=>k.isReadableStream(new o("").body)),f={stream:i&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!f[m]&&(f[m]=($,b)=>{let y=$&&$[m];if(y)return y.call($);throw new me(`Response type '${m}' is not supported`,me.ERR_NOT_SUPPORT,b)})});const E=async m=>{if(m==null)return 0;if(k.isBlob(m))return m.size;if(k.isSpecCompliantForm(m))return(await new t(Ne.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(k.isArrayBufferView(m)||k.isArrayBuffer(m))return m.byteLength;if(k.isURLSearchParams(m)&&(m=m+""),k.isString(m))return(await g(m)).byteLength},P=async(m,$)=>{const b=k.toFiniteNumber(m.getContentLength());return b??E($)};return async m=>{let{url:$,method:b,data:y,signal:T,cancelToken:I,timeout:D,onDownloadProgress:C,onUploadProgress:_,responseType:B,headers:N,withCredentials:L="same-origin",fetchOptions:S}=ts(m),M=e||fetch;B=B?(B+"").toLowerCase():"text";let U=qu([T,I&&I.toAbortSignal()],D),q=null;const j=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let O;try{if(_&&c&&b!=="get"&&b!=="head"&&(O=await P(N,y))!==0){let he=new t($,{method:"POST",body:y,duplex:"half"}),F;if(k.isFormData(y)&&(F=he.headers.get("content-type"))&&N.setContentType(F),he.body){const[H,z]=fo(O,kt(vo(_)));y=yo(he.body,bo,H,z)}}k.isString(L)||(L=L?"include":"omit");const G=l&&"credentials"in t.prototype,te={...S,signal:U,method:b.toUpperCase(),headers:N.normalize().toJSON(),body:y,duplex:"half",credentials:G?L:void 0};q=l&&new t($,te);let Z=await(l?M(q,S):M($,te));const ae=i&&(B==="stream"||B==="response");if(i&&(C||ae&&j)){const he={};["status","statusText","headers"].forEach(ee=>{he[ee]=Z[ee]});const F=k.toFiniteNumber(Z.headers.get("content-length")),[H,z]=C&&fo(F,kt(vo(C),!0))||[];Z=new o(yo(Z.body,bo,H,()=>{z&&z(),j&&j()}),he)}B=B||"text";let Ie=await f[k.findKey(f,B)||"text"](Z,m);return!ae&&j&&j(),await new Promise((he,F)=>{Qo(he,F,{data:Ie,headers:Le.from(Z.headers),status:Z.status,statusText:Z.statusText,config:m,request:q})})}catch(G){throw j&&j(),G&&G.name==="TypeError"&&/Load failed|fetch/i.test(G.message)?Object.assign(new me("Network Error",me.ERR_NETWORK,m,q),{cause:G.cause||G}):me.from(G,G&&G.code,m,q)}}},Ju=new Map,os=s=>{let e=s&&s.env||{};const{fetch:t,Request:o,Response:a}=e,l=[o,a,t];let r=l.length,d=r,g,c,i=Ju;for(;d--;)g=l[d],c=i.get(g),c===void 0&&i.set(g,c=d?new Map:Wu(e)),i=c;return c};os();const Qt={http:du,xhr:Bu,fetch:{get:os}};k.forEach(Qt,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const $o=s=>`- ${s}`,Ku=s=>k.isFunction(s)||s===null||s===!1;function Xu(s,e){s=k.isArray(s)?s:[s];const{length:t}=s;let o,a;const l={};for(let r=0;r<t;r++){o=s[r];let d;if(a=o,!Ku(o)&&(a=Qt[(d=String(o)).toLowerCase()],a===void 0))throw new me(`Unknown adapter '${d}'`);if(a&&(k.isFunction(a)||(a=a.get(e))))break;l[d||"#"+r]=a}if(!a){const r=Object.entries(l).map(([g,c])=>`adapter ${g} `+(c===!1?"is not supported by the environment":"is not available in the build"));let d=t?r.length>1?`since :
`+r.map($o).join(`
`):" "+$o(r[0]):"as no adapter specified";throw new me("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return a}const ss={getAdapter:Xu,adapters:Qt};function Ht(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ct(null,s)}function Po(s){return Ht(s),s.headers=Le.from(s.headers),s.data=Lt.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),ss.getAdapter(s.adapter||yt.adapter,s)(s).then(function(o){return Ht(s),o.data=Lt.call(s,s.transformResponse,o),o.headers=Le.from(o.headers),o},function(o){return Zo(o)||(Ht(s),o&&o.response&&(o.response.data=Lt.call(s,s.transformResponse,o.response),o.response.headers=Le.from(o.response.headers))),Promise.reject(o)})}const ns="1.13.2",Mt={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{Mt[s]=function(o){return typeof o===s||"a"+(e<1?"n ":" ")+s}});const To={};Mt.transitional=function(e,t,o){function a(l,r){return"[Axios v"+ns+"] Transitional option '"+l+"'"+r+(o?". "+o:"")}return(l,r,d)=>{if(e===!1)throw new me(a(r," has been removed"+(t?" in "+t:"")),me.ERR_DEPRECATED);return t&&!To[r]&&(To[r]=!0,console.warn(a(r," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,r,d):!0}};Mt.spelling=function(e){return(t,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function Yu(s,e,t){if(typeof s!="object")throw new me("options must be an object",me.ERR_BAD_OPTION_VALUE);const o=Object.keys(s);let a=o.length;for(;a-- >0;){const l=o[a],r=e[l];if(r){const d=s[l],g=d===void 0||r(d,l,s);if(g!==!0)throw new me("option "+l+" must be "+g,me.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new me("Unknown option "+l,me.ERR_BAD_OPTION)}}const Tt={assertOptions:Yu,validators:Mt},Je=Tt.validators;let Ze=class{constructor(e){this.defaults=e||{},this.interceptors={request:new mo,response:new mo}}async request(e,t){try{return await this._request(e,t)}catch(o){if(o instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{o.stack?l&&!String(o.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+l):o.stack=l}catch{}}throw o}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=et(this.defaults,t);const{transitional:o,paramsSerializer:a,headers:l}=t;o!==void 0&&Tt.assertOptions(o,{silentJSONParsing:Je.transitional(Je.boolean),forcedJSONParsing:Je.transitional(Je.boolean),clarifyTimeoutError:Je.transitional(Je.boolean)},!1),a!=null&&(k.isFunction(a)?t.paramsSerializer={serialize:a}:Tt.assertOptions(a,{encode:Je.function,serialize:Je.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Tt.assertOptions(t,{baseUrl:Je.spelling("baseURL"),withXsrfToken:Je.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=l&&k.merge(l.common,l[t.method]);l&&k.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),t.headers=Le.concat(r,l);const d=[];let g=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(t)===!1||(g=g&&$.synchronous,d.unshift($.fulfilled,$.rejected))});const c=[];this.interceptors.response.forEach(function($){c.push($.fulfilled,$.rejected)});let i,f=0,E;if(!g){const m=[Po.bind(this),void 0];for(m.unshift(...d),m.push(...c),E=m.length,i=Promise.resolve(t);f<E;)i=i.then(m[f++],m[f++]);return i}E=d.length;let P=t;for(;f<E;){const m=d[f++],$=d[f++];try{P=m(P)}catch(b){$.call(this,b);break}}try{i=Po.call(this,P)}catch(m){return Promise.reject(m)}for(f=0,E=c.length;f<E;)i=i.then(c[f++],c[f++]);return i}getUri(e){e=et(this.defaults,e);const t=es(e.baseURL,e.url,e.allowAbsoluteUrls);return Ko(t,e.params,e.paramsSerializer)}};k.forEach(["delete","get","head","options"],function(e){Ze.prototype[e]=function(t,o){return this.request(et(o||{},{method:e,url:t,data:(o||{}).data}))}});k.forEach(["post","put","patch"],function(e){function t(o){return function(l,r,d){return this.request(et(d||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}Ze.prototype[e]=t(),Ze.prototype[e+"Form"]=t(!0)});let Zu=class as{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const o=this;this.promise.then(a=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](a);o._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(d=>{o.subscribe(d),l=d}).then(a);return r.cancel=function(){o.unsubscribe(l)},r},e(function(l,r,d){o.reason||(o.reason=new ct(l,r,d),t(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=o=>{e.abort(o)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new as(function(a){e=a}),cancel:e}}};function Qu(s){return function(t){return s.apply(null,t)}}function ed(s){return k.isObject(s)&&s.isAxiosError===!0}const Jt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Jt).forEach(([s,e])=>{Jt[e]=s});function ls(s){const e=new Ze(s),t=Uo(Ze.prototype.request,e);return k.extend(t,Ze.prototype,e,{allOwnKeys:!0}),k.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return ls(et(s,a))},t}const Ae=ls(yt);Ae.Axios=Ze;Ae.CanceledError=ct;Ae.CancelToken=Zu;Ae.isCancel=Zo;Ae.VERSION=ns;Ae.toFormData=Ft;Ae.AxiosError=me;Ae.Cancel=Ae.CanceledError;Ae.all=function(e){return Promise.all(e)};Ae.spread=Qu;Ae.isAxiosError=ed;Ae.mergeConfig=et;Ae.AxiosHeaders=Le;Ae.formToJSON=s=>Yo(k.isHTMLForm(s)?new FormData(s):s);Ae.getAdapter=ss.getAdapter;Ae.HttpStatusCode=Jt;Ae.default=Ae;const{Axios:zf,AxiosError:Wf,CanceledError:Jf,isCancel:Kf,CancelToken:Xf,VERSION:Yf,all:Zf,Cancel:Qf,isAxiosError:ev,spread:tv,toFormData:ov,AxiosHeaders:sv,HttpStatusCode:nv,formToJSON:av,getAdapter:lv,mergeConfig:rv}=Ae;class td{static async getAvailableModels(){try{return(await Ae({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const od={class:"assigned-tools"},sd={class:"section-header"},nd=["title"],ad={class:"tool-info"},ld={class:"tool-name"},rd=["title"],id={key:0,class:"no-tools"},cd=Fe({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(s,{emit:e}){const t=s,o=e,a=ht(),l=ce(()=>a.availableTools.value);He(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=ce(()=>Array.isArray(t.selectedToolIds)?t.selectedToolIds.filter(c=>l.value.some(i=>i.key===c)):[]);Pe(r,c=>{if(!Array.isArray(t.selectedToolIds))return;const i=t.selectedToolIds.length;c.length!==i&&o("tools-filtered",c)},{immediate:!0});const d=c=>{const i=l.value.find(E=>E.key===c);return i?`${i.serviceGroup||"Ungrouped"}.${i.name}`:c},g=c=>{const i=l.value.find(f=>f.key===c);return i?i.description:""};return(c,i)=>(h(),v("div",od,[n("div",sd,[n("span",null,u(c.title)+" ("+u(r.value.length)+")",1),c.showAddButton?(h(),v("button",{key:0,class:"action-btn small",onClick:i[0]||(i[0]=f=>c.$emit("add-tools"))},[R(p(A),{icon:"carbon:add"}),ye(" "+u(c.addButtonText),1)])):V("",!0)]),n("div",{class:Se(["tools-grid",{"grid-layout":c.useGridLayout,"has-more-items":c.useGridLayout&&r.value.length>2}])},[(h(!0),v(be,null,$e(r.value,f=>(h(),v("div",{key:f,class:"tool-item assigned",title:g(f)},[n("div",ad,[n("span",ld,u(d(f)),1),n("span",{class:"tool-desc",title:g(f)},u(g(f)),9,rd)])],8,nd))),128)),r.value.length===0?(h(),v("div",id,[R(p(A),{icon:"carbon:tool-box"}),n("span",null,u(c.emptyText),1)])):V("",!0)],2)]))}}),ud=Me(cd,[["__scopeId","data-v-62354a05"]]),dd={class:"tool-selection-content"},pd={class:"tool-controls"},md={class:"search-container"},hd=["placeholder"],fd={class:"sort-container"},vd={value:"group"},gd={value:"name"},yd={value:"enabled"},bd={class:"tool-summary"},_d={class:"summary-text"},wd={key:0,class:"tool-groups"},Sd=["onClick"],$d={class:"group-title-area"},Pd={class:"group-name"},Td={class:"group-count"},Ed={class:"group-enable-all"},kd=["checked","onChange","data-group"],Cd={class:"enable-label"},Id={class:"tool-info"},Rd={class:"tool-selection-name"},xd={key:0,class:"tool-selection-desc"},Ad={class:"tool-actions"},Fd=["checked","onChange"],Md={key:1,class:"empty-state"},Dd=Fe({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(s,{emit:e}){const t=s,o=e,a=ht(),l=ce(()=>a.availableTools.value);He(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),Pe(()=>t.modelValue,S=>{S&&!a.isLoading.value&&a.loadAvailableTools()});const r=ce({get:()=>t.modelValue,set:S=>o("update:modelValue",S)}),d=x(""),g=x("group"),c=x(new Set),i=x([]),f=x(null),E=(S,M)=>{const U=document.querySelector(`input[data-group="${S}"]`);U&&(U.indeterminate=C(M))};Pe(()=>t.selectedToolIds,S=>{i.value=[...S]},{immediate:!0});const P=ce(()=>{let S=l.value.filter(M=>M.key);if(S=S.filter(M=>M.selectable===!0),d.value){const M=d.value.toLowerCase();S=S.filter(U=>U.name.toLowerCase().includes(M)||U.description.toLowerCase().includes(M)||U.serviceGroup.toLowerCase().includes(M))}switch(g.value){case"name":S=[...S].sort((M,U)=>M.name.localeCompare(U.name));break;case"enabled":S=[...S].sort((M,U)=>{const q=i.value.includes(M.key),j=i.value.includes(U.key);return q&&!j?-1:!q&&j?1:M.name.localeCompare(U.name)});break;case"group":default:S=[...S].sort((M,U)=>{const q=M.serviceGroup||"Ungrouped",j=U.serviceGroup||"Ungrouped";return q!==j?q.localeCompare(j):M.name.localeCompare(U.name)});break}return S}),m=ce(()=>{const S=new Map;return l.value.filter(U=>U.key&&U.selectable===!0).forEach(U=>{const q=U.serviceGroup||"Ungrouped";S.has(q)||S.set(q,[]),S.get(q).push(U)}),S}),$=ce(()=>{const S=new Map;return P.value.forEach(M=>{const U=M.serviceGroup||"Ungrouped";S.has(U)||S.set(U,[]),S.get(U).push(M)}),new Map([...S.entries()].sort())}),b=ce(()=>P.value.length);Pe([i,$],()=>{Ue(()=>{for(const[S,M]of $.value)E(S,M)})},{flush:"post",deep:!1});const y=S=>i.value.includes(S),T=(S,M)=>{M.stopPropagation();const q=M.target.checked;if(!S){console.error("toolKey is undefined, cannot proceed");return}q?i.value.includes(S)||(i.value=[...i.value,S]):i.value=i.value.filter(j=>j!==S)},I=S=>S.filter(M=>i.value.includes(M.key)),D=S=>S.length>0&&S.every(M=>i.value.includes(M.key)),C=S=>{const M=I(S).length;return M>0&&M<S.length},_=(S,M)=>{M.stopPropagation();const q=M.target.checked,j=S.map(O=>O.key);if(q){const O=[...i.value];j.forEach(G=>{O.includes(G)||O.push(G)}),i.value=O}else i.value=i.value.filter(O=>!j.includes(O))},B=S=>{c.value.has(S)?c.value.delete(S):c.value.add(S)},N=()=>{o("confirm",[...i.value]),o("update:modelValue",!1)},L=()=>{i.value=[...t.selectedToolIds],o("update:modelValue",!1)};return Pe(d,S=>{const M=S.trim().toLowerCase();if(M){f.value===null&&(f.value=new Set(c.value));for(const[U,q]of m.value)q.some(O=>O.name.toLowerCase().includes(M)||O.description&&O.description.toLowerCase().includes(M)||O.serviceGroup&&O.serviceGroup.toLowerCase().includes(M))&&c.value.delete(U)}else f.value!==null&&(c.value=new Set(f.value),f.value=null)}),Pe(r,S=>{if(S){c.value.clear(),f.value=null;const M=Array.from($.value.keys());M.length>1&&M.slice(1).forEach(U=>{c.value.add(U)})}}),(S,M)=>(h(),Ce(xo,{modelValue:r.value,"onUpdate:modelValue":[M[4]||(M[4]=U=>r.value=U),L],title:S.$t("toolSelection.title"),onConfirm:N},{default:Qe(()=>[n("div",dd,[n("div",pd,[n("div",md,[Te(n("input",{"onUpdate:modelValue":M[0]||(M[0]=U=>d.value=U),type:"text",class:"search-input",placeholder:S.$t("toolSelection.searchPlaceholder")},null,8,hd),[[De,d.value]])]),n("div",fd,[Te(n("select",{"onUpdate:modelValue":M[1]||(M[1]=U=>g.value=U),class:"sort-select"},[n("option",vd,u(S.$t("toolSelection.sortByGroup")),1),n("option",gd,u(S.$t("toolSelection.sortByName")),1),n("option",yd,u(S.$t("toolSelection.sortByStatus")),1)],512),[[Kt,g.value]])])]),n("div",bd,[n("span",_d,u(S.$t("toolSelection.summary",{groups:$.value.size,tools:b.value,selected:i.value.length})),1)]),$.value.size>0?(h(),v("div",wd,[(h(!0),v(be,null,$e($.value,([U,q])=>(h(),v("div",{key:U,class:"tool-group"},[n("div",{class:Se(["tool-group-header",{collapsed:c.value.has(U)}]),onClick:j=>B(U)},[n("div",$d,[R(p(A),{icon:c.value.has(U)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),R(p(A),{icon:"carbon:folder",class:"group-icon"}),n("span",Pd,u(U),1),n("span",Td," ("+u(I(q).length)+"/"+u(q.length)+") ",1)]),n("div",{class:"group-actions",onClick:M[2]||(M[2]=ke(()=>{},["stop"]))},[n("label",Ed,[n("input",{type:"checkbox",class:"group-enable-checkbox",checked:D(q),onChange:j=>_(q,j),"data-group":U},null,40,kd),n("span",Cd,u(S.$t("toolSelection.enableAll")),1)])])],10,Sd),n("div",{class:Se(["tool-group-content",{collapsed:c.value.has(U)}])},[(h(!0),v(be,null,$e(q,j=>(h(),v("div",{key:j.key,class:"tool-selection-item"},[n("div",Id,[n("div",Rd,u(j.name),1),j.description?(h(),v("div",xd,u(j.description),1)):V("",!0)]),n("div",Ad,[n("label",{class:"tool-enable-switch",onClick:M[3]||(M[3]=ke(()=>{},["stop"]))},[n("input",{type:"checkbox",class:"tool-enable-checkbox",checked:y(j.key),onChange:O=>T(j.key,O)},null,40,Fd),M[5]||(M[5]=n("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),v("div",Md,[R(p(A),{icon:"carbon:tools",class:"empty-icon"}),n("p",null,u(S.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Nd=Me(Dd,[["__scopeId","data-v-627b463f"]]),Ud={class:"config-section"},Od={class:"section-header"},Ld={class:"visual-editor"},Hd={class:"plan-basic-info"},Bd={class:"form-row"},qd={class:"form-label"},jd=["placeholder"],Vd={key:0,class:"field-error-message"},Gd={class:"form-row"},zd={class:"form-label"},Wd={class:"service-group-autocomplete"},Jd=["placeholder"],Kd={key:0,class:"service-group-dropdown"},Xd=["onMousedown"],Yd={class:"field-description"},Zd={class:"steps-section"},Qd={class:"steps-container"},ep={class:"step-content"},tp={class:"form-row"},op={class:"form-label"},sp=["value","onInput","placeholder"],np={class:"form-row"},ap={class:"form-label"},lp=["value","onInput","placeholder"],rp={key:0,class:"preview-section"},ip={class:"preview-label"},cp={class:"preview-content"},up={class:"preview-text"},dp={class:"preview-table-header"},pp={class:"form-row"},mp={class:"form-label"},hp={class:"model-selector-wrapper"},fp={class:"model-input-wrapper"},vp=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],gp={key:0,class:"dropdown-item disabled"},yp={key:1,class:"dropdown-item disabled error"},bp={key:2,class:"dropdown-item disabled"},_p=["onClick","onMouseenter"],wp=["onClick","onMouseenter"],Sp=["title"],$p={key:0,class:"error-message"},Pp={class:"form-row"},Tp={key:0,class:"empty-steps"},Ep={class:"empty-text"},kp={key:0,class:"json-preview"},Cp={class:"preview-header"},Ip={class:"form-label"},Rp={class:"json-code"},xp={class:"editor-footer"},Ap={class:"section-actions"},Fp=["disabled","title"],Mp=["disabled","title"],Dp=["disabled","title"],Np=["disabled"],Up={class:"modal-header"},Op={class:"modal-body"},Lp={class:"form-row"},Hp={class:"form-label"},Bp=["placeholder"],qp={class:"modal-footer"},jp=["disabled"],Vp=Fe({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(s,{expose:e}){const{t}=qe(),o=It(),a=tt(),l=Xe({title:"",steps:[]}),r=x(!1),d=x(!1),g=x([]),c=x(!1),i=x(""),f=ce(()=>a.generateJsonString()),E=x(!1);let P=null;const m=()=>{a.isUserUpdating.value=!0,P&&clearTimeout(P),P=setTimeout(()=>{a.isUserUpdating.value=!1,P=null},500)},$=()=>{if(a.isUserUpdating.value){console.log("[JsonEditorV2] syncDisplayDataFromConfig skipped: isUserUpdating is true");return}console.log("[JsonEditorV2] syncDisplayDataFromConfig called"),E.value=!0;try{const w=a.getConfig();console.log("[JsonEditorV2] Syncing displayData with config:",{title:w.title,stepsCount:w.steps?.length||0,serviceGroup:w.serviceGroup}),(w.title?.trim()||!l.title?.trim())&&(l.title=w.title||""),l.steps=(w.steps||[]).map(K=>({...K})),i.value=w.serviceGroup||"",console.log("[JsonEditorV2] displayData synced:",{title:l.title,stepsCount:l.steps.length,serviceGroup:i.value})}finally{setTimeout(()=>{E.value=!1},0)}},b=()=>{E.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(fe.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{E.value=!1},0)}},y=()=>{r.value=!r.value},T=()=>{r.value=!1},I=()=>{try{P&&(clearTimeout(P),P=null),a.isUserUpdating.value=!1,a.rollbackVersion()}catch(w){console.error("Error during rollback operation:",w),o.error(t("sidebar.rollbackFailed")||"Rollback failed")}},D=()=>{try{P&&(clearTimeout(P),P=null),a.isUserUpdating.value=!1,a.restoreVersion()}catch(w){console.error("Error during restore operation:",w),o.error(t("sidebar.restoreFailed")||"Restore failed")}},C=async()=>{try{if(!a.selectedTemplate.value){o.error(t("sidebar.selectPlanFirst"));return}P&&(clearTimeout(P),P=null),a.isUserUpdating.value=!1,b();const w=a.validate();if(!w.isValid){o.error(`Invalid format, please correct and save.
Errors: `+w.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){o.error("Plan template ID is required");return}if(!await a.save()){o.error("Failed to save plan template");return}const pe=a.generateJsonString().trim();a.updateVersionsAfterSave(pe);const we=a.planVersions.value.length;fe.hasTaskRequirementModified=!1,await fe.loadPlanTemplateList(),o.success(t("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:we}))}catch(w){console.error("Failed to save plan modifications:",w);const K=w instanceof Error?w.message:t("sidebar.saveFailed");throw o.error(K),w}},_=x(""),B=(w,K)=>{m();const Q=l.steps[K];Q&&(Q.stepRequirement=w.target.value),oo(w)},N=(w,K)=>{m();const Q=l.steps[K];Q&&(Q.terminateColumns=w.target.value),oo(w)},L=()=>{const w={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(w),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},S=x([]),M=x(!1),U=x(""),q=x(new Map),j=x(new Set),O=x(new Map),G=w=>q.value.get(w)??"",te=(w,K)=>{q.value.set(w,K)},Z=w=>{const K=G(w);if(!K.trim())return S.value;const Q=K.toLowerCase().trim();return S.value.filter(pe=>pe.value.toLowerCase().includes(Q)||pe.label.toLowerCase().includes(Q))},ae=w=>{const K=l.steps[w],Q=G(w);return j.value.has(w)&&Q!==""?Q:K.modelName??""},Ie=w=>M.value||U.value||l.steps[w].modelName?"":t("sidebar.modelNameDescription")||"",he=w=>j.value.has(w),F=w=>{M.value||j.value.add(w)},H=w=>{j.value.delete(w),O.value.set(w,-1);const K=l.steps[w];te(w,K.modelName??"")},z=w=>{he(w)?H(w):F(w)},ee=(w,K)=>{m();const Q=l.steps[K];Q.modelName=w,te(K,w),H(K)},ie=(w,K)=>{m();const Q=w.target;te(K,Q.value),F(K)},ne=w=>O.value.get(w)??-1,ve=(w,K)=>{O.value.set(w,K)},oe=w=>{const K=ne(w),Q=Z(w);K>=0&&K<Q.length?ee(Q[K].value,w):K===-1?ee("",w):Q.length>0?ee(Q[0].value,w):l.steps[w].modelName||ee("",w)},re=w=>{if(!he(w)){F(w),ve(w,0);return}const Q=Z(w).length+1,pe=ne(w),we=Math.min(pe+1,Q-1);ve(w,we)},W=w=>{if(!he(w)){F(w);const pe=Z(w);ve(w,pe.length);return}const K=ne(w),Q=Math.max(K-1,-1);ve(w,Q)},le=w=>{w.target.closest(".model-selector")||j.value.clear()};Pe(()=>l.steps,w=>{w.forEach((K,Q)=>{q.value.has(Q)||te(Q,K.modelName??"")})},{deep:!0,immediate:!0});const ue=x(!1),de=x(-1),_e=async()=>{if(!M.value){M.value=!0,U.value="";try{const w=await td.getAvailableModels();S.value=w.options}catch(w){console.error("Failed to load models:",w),U.value=w instanceof Error?w.message:"Failed to load models",S.value=[]}finally{M.value=!1}}},Re=w=>{de.value=w,ue.value=!0},bt=w=>{m(),de.value>=0&&de.value<l.steps.length&&(l.steps[de.value].selectedToolKeys=[...w]),ue.value=!1,de.value=-1},J=(w,K)=>{m(),w>=0&&w<l.steps.length&&(l.steps[w].selectedToolKeys=[...K])},X=x(!1),Y=x(""),se=x(!1),ge=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),o.error(t("sidebar.selectPlanFirst"));return}Y.value=(a.selectedTemplate.value.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),X.value=!0},Ee=()=>{X.value=!1,Y.value="",se.value=!1},ze=w=>{w.target===w.currentTarget&&Ee()},ut=async()=>{if(!Y.value.trim()){o.error(t("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){o.error(t("sidebar.noPlanToCopy"));return}se.value=!0;try{const w=a.getConfig(),K=`planTemplate-${Date.now()}`,{toolConfig:Q,...pe}=w,we={...pe,title:Y.value.trim(),planTemplateId:K};console.log("[JsonEditorV2] Copying plan without toolConfig:",we),(await no.createOrUpdatePlanTemplateWithTool(we)).success?(o.success(t("sidebar.copyPlanSuccess",{title:Y.value.trim()})),await fe.loadPlanTemplateList(),Ee()):o.error(t("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(w){if(console.error("[JsonEditorV2] Error copying plan:",w),w instanceof Error&&w.errorCode==="DUPLICATE_TITLE")o.error(t("sidebar.duplicatePlanTitle"));else{const K=w instanceof Error?w.message:"Unknown error";o.error(t("sidebar.copyPlanFailed",{message:K}))}}finally{se.value=!1}};Pe(()=>l.title,w=>{w?.trim()?_.value="":_.value="Title is required field"},{immediate:!0});const Ke=()=>{const w=a.getServiceGroup()||"";i.value=w};Pe(()=>a.config,()=>{a.needsFullRefresh.value&&!E.value&&!a.isUserUpdating.value&&$()},{deep:!0,immediate:!0}),Pe(()=>a.currentPlanTemplateId.value,(w,K)=>{console.log("[JsonEditorV2] currentPlanTemplateId changed:",{oldId:K,newId:w}),K!=null&&w!==K&&(q.value.clear(),j.value.clear(),O.value.clear(),ue.value=!1,X.value=!1,r.value=!1,de.value=-1,Y.value="",se.value=!1),console.log("[JsonEditorV2] Calling syncDisplayDataFromConfig from currentPlanTemplateId watch"),$(),Ke()},{immediate:!0}),Pe(()=>i.value,w=>{E.value=!0;try{a.setServiceGroup(w)}finally{setTimeout(()=>{E.value=!1},0)}});const ot=async()=>{if(!c.value){c.value=!0;try{const w=new Set;try{(await No.getAvailableTools()).forEach(Q=>{Q.serviceGroup&&w.add(Q.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from tools:",K)}try{(await no.getAllPlanTemplateConfigVOs()).forEach(Q=>{Q.serviceGroup&&w.add(Q.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from plan templates:",K)}g.value=Array.from(w).sort()}catch(w){console.error("[JsonEditorV2] Failed to load service groups:",w),g.value=[]}finally{c.value=!1}}},to=ce(()=>{const w=i.value.trim();if(!w)return g.value;const K=w.toLowerCase();return g.value.filter(Q=>Q.toLowerCase().includes(K))}),is=()=>{m()},cs=()=>{d.value=!0},us=()=>{m(),cs()},ds=()=>{setTimeout(()=>{d.value=!1},200)},ps=w=>{i.value=w,d.value=!1};He(()=>{$(),Ke(),ot(),_e(),document.addEventListener("click",le)}),Ve(()=>{document.removeEventListener("click",le),P&&(clearTimeout(P),P=null)}),e({save:C});const oo=w=>{const K=w.target;K.style.height="auto";const Q=20,pe=Math.ceil(K.scrollHeight/Q),we=4,st=12,_t=Math.max(we,Math.min(st,pe)),hs=_t*Q;K.style.height=`${hs}px`,K.rows=_t,pe>st?K.style.overflowY="auto":K.style.overflowY="hidden"},ms=w=>{if(!w.trim())return"";const K=w.split(",").map(Q=>Q.trim()).filter(Q=>Q.length>0);return K.length===0?"":`|${K.join("|")}|`};return(w,K)=>(h(),v("div",Ud,[n("div",Od,[R(p(A),{icon:"carbon:code",width:"16"}),n("span",null,u(w.$t("sidebar.dynamicAgentPlan")),1)]),n("div",Ld,[n("div",Hd,[n("div",Bd,[n("label",qd,u(w.$t("sidebar.title")),1),Te(n("input",{"onUpdate:modelValue":K[0]||(K[0]=Q=>l.title=Q),type:"text",class:Se(["form-input",{error:_.value}]),placeholder:w.$t("sidebar.titlePlaceholder"),onInput:is},null,42,jd),[[De,l.title]]),_.value?(h(),v("div",Vd,[R(p(A),{icon:"carbon:warning",width:"12"}),ye(" "+u(_.value),1)])):V("",!0)]),n("div",Gd,[n("label",zd,u(w.$t("mcpService.serviceGroup")),1),n("div",Wd,[Te(n("input",{type:"text","onUpdate:modelValue":K[1]||(K[1]=Q=>i.value=Q),onInput:us,onFocus:K[2]||(K[2]=Q=>d.value=!0),onBlur:ds,placeholder:w.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,Jd),[[De,i.value]]),d.value&&to.value.length>0?(h(),v("div",Kd,[(h(!0),v(be,null,$e(to.value,Q=>(h(),v("div",{key:Q,class:"service-group-option",onMousedown:pe=>ps(Q)},u(Q),41,Xd))),128))])):V("",!0)]),n("div",Yd,u(w.$t("mcpService.serviceGroupDescription")),1)])]),n("div",Zd,[n("div",Qd,[(h(!0),v(be,null,$e(l.steps,(Q,pe)=>(h(),v("div",{key:pe,class:"step-item"},[n("div",ep,[n("div",tp,[n("label",op,u(w.$t("sidebar.stepRequirement")),1),n("textarea",{value:Q.stepRequirement||"",onInput:we=>B(we,pe),class:"form-textarea auto-resize",placeholder:w.$t("sidebar.stepRequirementPlaceholder"),rows:"8"},null,40,sp)]),n("div",np,[n("label",ap,u(w.$t("sidebar.terminateColumns")),1),n("textarea",{value:Q.terminateColumns||"",onInput:we=>N(we,pe),class:"form-textarea auto-resize",placeholder:w.$t("sidebar.terminateColumnsPlaceholder"),rows:"1"},null,40,lp),Q.terminateColumns&&Q.terminateColumns.trim()?(h(),v("div",rp,[n("div",ip,u(w.$t("sidebar.preview"))+":",1),n("div",cp,[n("div",up,[ye(u(w.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),n("span",dp,u(ms(Q.terminateColumns)),1)])])])):V("",!0)]),n("div",pp,[n("label",mp,u(w.$t("sidebar.modelName")),1),n("div",hp,[n("div",{class:Se(["model-selector",{"is-open":he(pe),"is-disabled":M.value}])},[n("div",fp,[n("input",{value:ae(pe),type:"text",class:"form-input model-search-input",placeholder:Ie(pe),disabled:M.value,onClick:ke(we=>F(pe),["stop"]),onFocus:we=>F(pe),onInput:we=>ie(we,pe),onKeydown:[dt(we=>H(pe),["escape"]),dt(ke(we=>oe(pe),["prevent"]),["enter"]),dt(ke(we=>re(pe),["prevent"]),["down"]),dt(ke(we=>W(pe),["prevent"]),["up"])]},null,40,vp),R(p(A),{icon:"carbon:chevron-down",width:"14",class:Se(["dropdown-arrow",{"is-open":he(pe)}]),onClick:ke(we=>z(pe),["stop"])},null,8,["class","onClick"])]),he(pe)?(h(),v("div",{key:0,class:"model-dropdown",onClick:K[3]||(K[3]=ke(()=>{},["stop"]))},[M.value?(h(),v("div",gp,u(w.$t("sidebar.loading")),1)):U.value?(h(),v("div",yp,u(w.$t("sidebar.modelLoadError")),1)):Z(pe).length===0?(h(),v("div",bp,u(w.$t("sidebar.noModelsFound")),1)):V("",!0),(h(!0),v(be,null,$e(Z(pe),(we,st)=>(h(),v("div",{key:we.value,class:Se(["dropdown-item",{"is-selected":Q.modelName===we.value,"is-highlighted":ne(pe)===st}]),onClick:_t=>ee(we.value,pe),onMouseenter:_t=>ve(pe,st)},[ye(u(we.value)+" ",1),Q.modelName===we.value?(h(),Ce(p(A),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,_p))),128)),n("div",{class:Se(["dropdown-item",{"is-selected":!Q.modelName,"is-highlighted":ne(pe)===-1}]),onClick:we=>ee("",pe),onMouseenter:we=>ve(pe,-1)},[ye(u(w.$t("sidebar.noModelSelected"))+" ",1),Q.modelName?V("",!0):(h(),Ce(p(A),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,wp)])):V("",!0)],2),U.value?(h(),v("button",{key:0,onClick:_e,class:"btn btn-sm btn-danger",title:w.$t("sidebar.retryLoadModels")},[R(p(A),{icon:"carbon:warning",width:"14"}),ye(" "+u(w.$t("sidebar.retry")),1)],8,Sp)):V("",!0)]),U.value?(h(),v("div",$p,[R(p(A),{icon:"carbon:warning",width:"12"}),ye(" "+u(U.value),1)])):V("",!0)]),n("div",Pp,[R(ud,{title:w.$t("sidebar.selectedTools"),"selected-tool-ids":Q.selectedToolKeys||[],"add-button-text":w.$t("sidebar.addRemoveTools"),"empty-text":w.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:we=>Re(pe),onToolsFiltered:we=>J(pe,we)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),v("div",Tp,[R(p(A),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),n("p",Ep,u(w.$t("sidebar.noSteps")),1),n("button",{class:"btn btn-primary btn-add-step",onClick:L},[R(p(A),{icon:"carbon:add",width:"16"}),ye(" "+u(w.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),r.value?(h(),v("div",kp,[n("div",Cp,[n("label",Ip,u(w.$t("sidebar.jsonPreview")),1),n("button",{onClick:T,class:"btn btn-xs"},[R(p(A),{icon:"carbon:close",width:"12"})])]),n("pre",Rp,u(f.value),1)])):V("",!0),n("div",xp,[n("button",{onClick:y,class:"btn btn-sm btn-secondary"},[R(p(A),{icon:"carbon:code",width:"14"}),ye(" "+u(r.value?w.$t("sidebar.hideJson"):w.$t("sidebar.showJson")),1)]),n("div",Ap,[n("button",{class:"btn btn-sm",onClick:ge,disabled:w.isGenerating||w.isExecuting,title:w.$t("sidebar.copyPlan")},[R(p(A),{icon:"carbon:copy",width:"14"}),ye(" "+u(w.$t("sidebar.copyPlan")),1)],8,Fp),n("button",{class:"btn btn-sm",onClick:I,disabled:!p(a).canRollback.value,title:w.$t("sidebar.rollback")},[R(p(A),{icon:"carbon:undo",width:"14"})],8,Mp),n("button",{class:"btn btn-sm",onClick:D,disabled:!p(a).canRestore.value,title:w.$t("sidebar.restore")},[R(p(A),{icon:"carbon:redo",width:"14"})],8,Dp),n("button",{class:"btn btn-primary",onClick:C,disabled:w.isGenerating||w.isExecuting},[R(p(A),{icon:"carbon:save",width:"14"}),K[7]||(K[7]=ye(" Save "))],8,Np)])])]),R(Nd,{modelValue:ue.value,"onUpdate:modelValue":K[4]||(K[4]=Q=>ue.value=Q),"selected-tool-ids":de.value>=0?l.steps[de.value]?.selectedToolKeys||[]:[],onConfirm:bt},null,8,["modelValue","selected-tool-ids"]),X.value?(h(),v("div",{key:0,class:"modal-overlay",onMousedown:ze},[n("div",{class:"modal-content",onMousedown:K[6]||(K[6]=ke(()=>{},["stop"]))},[n("div",Up,[n("h3",null,u(w.$t("sidebar.copyPlan")),1),n("button",{class:"close-btn",onClick:Ee},[R(p(A),{icon:"carbon:close",width:"16"})])]),n("div",Op,[n("div",Lp,[n("label",Hp,u(w.$t("sidebar.newPlanTitle")),1),Te(n("input",{"onUpdate:modelValue":K[5]||(K[5]=Q=>Y.value=Q),type:"text",class:"form-input",placeholder:w.$t("sidebar.enterNewPlanTitle"),onKeyup:dt(ut,["enter"])},null,40,Bp),[[De,Y.value]])])]),n("div",qp,[n("button",{class:"btn btn-secondary",onClick:Ee},u(w.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:ut,disabled:!Y.value.trim()||se.value},[se.value?(h(),Ce(p(A),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ye(" "+u(se.value?w.$t("sidebar.copying"):w.$t("sidebar.copyPlan")),1)],8,jp)])],32)],32)):V("",!0)]))}}),Gp=Me(Vp,[["__scopeId","data-v-91127bd0"]]),zp="/api/executor";async function rs(s){try{const e=await fetch(`${zp}/agent-execution/${s}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${s}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${s}:`,e),null}}async function Wp(s){return console.log(`Refreshing agent execution detail for stepId: ${s}`),rs(s)}function Jp(){const s=rt(),e=lt(),t=x(null),o=x(null),a=x("config"),l=ce(()=>s.activeRootPlanId.value),r=y=>{if(!y)return null;for(const[T,I]of e.planExecutionRecords.entries())if((I.rootPlanId||I.currentPlanId)&&I.agentExecutionSequence)for(const C of I.agentExecutionSequence){if(C.stepId===y){const _=I.rootPlanId||I.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:y,rootPlanId:_,planId:T}),_||null}if(C.subPlanExecutionRecords)for(const _ of C.subPlanExecutionRecords){const B=d(_,y);if(B)return B}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",y),null},d=(y,T)=>{if(!y||!y.agentExecutionSequence)return null;for(const I of y.agentExecutionSequence){if(I.stepId===T)return y.rootPlanId||y.currentPlanId||null;if(I.subPlanExecutionRecords)for(const D of I.subPlanExecutionRecords){const C=d(D,T);if(C)return C}}return null},g=ce(()=>o.value||l.value),c=ce(()=>!g.value),i=async y=>{if(console.log("[useRightPanel] Step selected:",{stepId:y}),!y){console.warn("[useRightPanel] No stepId provided"),t.value=null,o.value=null;return}E("details"),console.log("[useRightPanel] Switched to details tab");try{const T=r(y);T?(o.value=T,console.log("[useRightPanel] Set selectedRootPlanId to:",T)):(o.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const I=await rs(y);if(!I){console.warn("[useRightPanel] Agent execution detail not found for stepId:",y),t.value=null,o.value=null;return}const D={stepId:y,title:I.agentName??`Step ${y}`,description:I.agentDescription??"",agentExecution:I,completed:I.status==="FINISHED",current:I.status==="RUNNING"};t.value=D,console.log("[useRightPanel] Step details updated:",D),await Ue(),console.log("[useRightPanel] After nextTick - selectedStep:",t.value)}catch(T){console.error("[useRightPanel] Error fetching step details:",T),t.value=null,o.value=null}},f=async()=>{if(!t.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",t.value.stepId);try{const y=await Wp(t.value.stepId);y&&(t.value.agentExecution=y,t.value.completed=y.status==="FINISHED",t.value.current=y.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(y){console.error("[useRightPanel] Error refreshing step:",y)}},E=y=>{a.value=y,console.log("[useRightPanel] Active tab set to:",y)},P=y=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",y)},m=()=>{t.value=null,o.value=null,console.log("[useRightPanel] Selected step cleared")},$=y=>{if(y===null||typeof y>"u"||y==="")return"N/A";if(typeof y=="object"&&y!==null)try{return JSON.stringify(y,null,2)}catch{return String(y)}if(typeof y=="string"){const T=y.trim();if(T==="")return"N/A";try{const I=JSON.parse(T);return JSON.stringify(I,null,2)}catch{return T}}return String(y)},b=()=>{t.value=null,o.value=null,a.value="config",console.log("[useRightPanel] State reset")};return{selectedStep:je(t),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:g,shouldShowNoTaskMessage:c,handleStepSelected:i,refreshCurrentStep:f,setActiveTab:E,updateDisplayedPlanProgress:P,clearSelectedStep:m,formatJson:$,reset:b}}let Bt=null;function eo(){return Bt||(Bt=Jp()),Bt}const Kp={class:"right-panel"},Xp={class:"preview-header"},Yp={class:"preview-tabs"},Zp={class:"preview-content"},Qp={key:0,class:"config-tab-content"},em={key:0,class:"config-container"},tm={class:"template-info-header"},om={class:"template-info"},sm={class:"template-id"},nm={key:1,class:"no-template-selected"},am={class:"action-buttons"},lm=["title"],rm={class:"import-description"},im={href:"https://github.com/Lynxe-public/Lynxe-public-prompts",target:"_blank",rel:"noopener noreferrer",class:"prompt-library-link"},cm={key:1,class:"step-details"},um={key:0,class:"step-info"},dm={key:0,class:"agent-info"},pm={class:"info-item"},mm={class:"label"},hm=["title"],fm={class:"info-item"},vm={class:"label"},gm={class:"value"},ym={class:"execution-status"},bm={class:"status-item"},_m={class:"status-text"},wm={key:0},Sm={key:0,class:"think-act-steps"},$m={class:"steps-container"},Pm={class:"step-header"},Tm={class:"step-number"},Em={class:"think-section"},km={class:"think-content"},Cm={class:"input"},Im={class:"label-row"},Rm={class:"label"},xm={class:"label-actions"},Am=["onClick","title"],Fm={class:"char-count-badge"},Mm={class:"pre-container"},Dm={class:"output"},Nm={class:"label-row"},Um={class:"label"},Om={class:"label-actions"},Lm=["onClick","title"],Hm={class:"char-count-badge"},Bm={class:"pre-container"},qm={key:0,class:"action-section"},jm={class:"action-content"},Vm={class:"tool-info"},Gm={class:"label"},zm={class:"value"},Wm={class:"input"},Jm={class:"label"},Km={class:"output"},Xm={class:"label"},Ym={key:0,class:"no-tools"},Zm={key:0,class:"sub-plan-section"},Qm={class:"sub-plan-content"},eh={class:"sub-plan-header"},th={class:"sub-plan-info"},oh={class:"label"},sh={class:"value"},nh={key:0,class:"sub-plan-info"},ah={class:"label"},lh={class:"value"},rh={class:"sub-plan-status"},ih={class:"status-text"},ch={key:0,class:"no-steps-message"},uh={key:1,class:"no-execution-message"},dh={class:"step-basic-info"},ph={class:"info-item"},mh={class:"label"},hh={class:"value"},fh={key:0,class:"info-item"},vh={class:"label"},gh={class:"value"},yh={class:"info-item"},bh={class:"label"},_h={class:"no-execution-hint"},wh={key:2,class:"execution-indicator"},Sh={class:"execution-text"},$h={key:1,class:"no-selection"},Ph=["title"],Th={key:2,class:"file-browser-container"},Eh={key:1,class:"no-plan-message"},kh={class:"message-content"},Ch={class:"tips"},Ih=Fe({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(s,{expose:e}){const t=s,{t:o}=qe(),a=It(),l=async O=>{if(!O){a.error(o("rightPanel.copyFailed")||"Failed to copy");return}try{await navigator.clipboard.writeText(O),a.success(o("rightPanel.copySuccess")||"Copied to clipboard")}catch(G){console.error("Failed to copy to clipboard:",G),a.error(o("rightPanel.copyFailed")||"Failed to copy")}},r=eo(),d=tt(),g=ht(),{handleImport:c}=Ss(),i=x(),f=x(!1),E=x(!0),P=x(!0),m=ce(()=>r.selectedStep.value),$=ce({get:()=>r.activeTab.value,set:O=>r.setActiveTab(O)}),b=ce(()=>r.fileBrowserPlanId.value),y=ce(()=>r.shouldShowNoTaskMessage.value),T=ce(()=>m.value?m.value.completed?o("rightPanel.status.completed"):m.value.current?o("rightPanel.status.executing"):o("rightPanel.status.waiting"):""),I=async()=>{try{const O=d.getPlanType()||"dynamic_agent";await fe.createNewTemplate(O);const G=d.selectedTemplate.value;G&&(d.reset(),d.setPlanType(G.planType||"dynamic_agent"),G.planTemplateId&&d.setPlanTemplateId(G.planTemplateId),d.setTitle(G.title||"")),console.log("[RightPanel] ðŸ”„ Reloading available tools for new template"),await g.loadAvailableTools()}catch(O){console.error("[RightPanel] Failed to create new plan:",O);const G=O instanceof Error?O.message:o("rightPanel.createPlanFailed");a.error(G)}},D=async O=>{await c(O,{onSuccess:async G=>{const te=o("rightPanel.importSuccess",{total:G.total,success:G.successCount,failed:G.failureCount});a.success(te)},onError:G=>{const te=G instanceof Error?G.message:o("rightPanel.importFailed");a.error(te)},onReload:async()=>{await fe.loadPlanTemplateList()},onSingleTemplateImported:async G=>{G.planTemplateId&&(d.setPlanTemplateId(G.planTemplateId),await d.load(G.planTemplateId))}})},C=async O=>{await r.handleStepSelected(O),setTimeout(()=>{N()},100),S()},_=async()=>{await r.refreshCurrentStep(),S()};Pe(()=>t.selectedStepId,async O=>{O?await C(O):r.clearSelectedStep()},{immediate:!0});const B=O=>{i.value=O??void 0},N=()=>{if(!i.value)return;const{scrollTop:O,scrollHeight:G,clientHeight:te}=i.value,Z=G-O-te<50,ae=G>te;E.value=Z,f.value=ae&&!Z,Z?P.value=!0:G-O-te>100&&(P.value=!1)},L=()=>{i.value&&(i.value.scrollTo({top:i.value.scrollHeight,behavior:"smooth"}),Ue(()=>{P.value=!0,N()}))},S=()=>{!P.value||!i.value||Ue(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},M=r.formatJson,U=()=>{P.value=!0,i.value&&i.value.removeEventListener("scroll",N)},q=()=>{const O=()=>{const G=i.value;return G?(B(G),G.addEventListener("scroll",N),P.value=!0,N(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ue(()=>{O()||setTimeout(()=>{O()},100)})};return He(()=>{console.log("[RightPanel] Component mounted"),Ue(()=>{q()})}),Ve(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),U()}),e({handleStepSelected:C,refreshCurrentStep:_,updateDisplayedPlanProgress:O=>{r.updateDisplayedPlanProgress(O)}}),(O,G)=>(h(),v("div",Kp,[n("div",Xp,[n("div",Yp,[n("div",{class:Se(["tab-item",{active:$.value==="config"}]),onClick:G[0]||(G[0]=te=>$.value="config")},[R(p(A),{icon:"carbon:settings"}),n("span",null,u(p(o)("sidebar.configuration")),1)],2),n("div",{class:Se(["tab-item",{active:$.value==="details"}]),onClick:G[1]||(G[1]=te=>$.value="details")},[R(p(A),{icon:"carbon:events"}),n("span",null,u(p(o)("rightPanel.stepExecutionDetails")),1)],2),n("div",{class:Se(["tab-item",{active:$.value==="files"}]),onClick:G[2]||(G[2]=te=>$.value="files")},[R(p(A),{icon:"carbon:folder"}),n("span",null,u(p(o)("fileBrowser.title")),1)],2)])]),n("div",Zp,[$.value==="config"?(h(),v("div",Qp,[p(d).selectedTemplate.value?(h(),v("div",em,[n("div",tm,[n("div",om,[n("h3",null,u(p(d).selectedTemplate.value.title||p(o)("sidebar.unnamedPlan")),1),n("span",sm,"ID: "+u(p(d).selectedTemplate.value.planTemplateId),1)]),n("button",{class:"back-to-list-btn",onClick:G[3]||(G[3]=te=>p(Ro).switchToTab("list"))},[R(p(A),{icon:"carbon:arrow-left",width:"16"})])]),R(Gp),R(Tc)])):(h(),v("div",nm,[n("div",am,[n("button",{class:"new-task-btn",onClick:I},[R(p(A),{icon:"carbon:add",width:"16"}),ye(" "+u(p(o)("rightPanel.newFuncAgentPlan")),1)]),n("label",{class:"new-task-btn",title:p(o)("rightPanel.importExistingPlan")},[R(p(A),{icon:"carbon:import",width:"16"}),ye(" "+u(p(o)("rightPanel.importExistingPlan"))+" ",1),n("input",{type:"file",accept:".json",onChange:D,style:{display:"none"}},null,32)],8,lm)]),n("p",rm,[ye(u(p(o)("rightPanel.importDescription"))+" ",1),n("a",im,u(p(o)("rightPanel.promptLibrary")),1),ye(" "+u(p(o)("rightPanel.importDescriptionSuffix")),1)])]))])):V("",!0),$.value==="details"?(h(),v("div",cm,[m.value?(h(),v("div",um,[n("h3",null,u(m.value.title||m.value.description||p(o)("rightPanel.defaultStepTitle",{number:1})),1),m.value.agentExecution?(h(),v("div",dm,[n("div",pm,[n("span",mm,u(p(o)("rightPanel.executingAgent"))+":",1),n("span",{class:"value",title:m.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(o)("chat.clickToViewExecutionDetails"):""},u(m.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(o)("chat.funcAgentExecutionDetails"):m.value.agentExecution.agentName),9,hm)]),n("div",fm,[n("span",vm,u(p(o)("rightPanel.callingModel"))+":",1),n("span",gm,u(m.value.agentExecution.modelName),1)])])):V("",!0),n("div",ym,[n("div",bm,[m.value.completed?(h(),Ce(p(A),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):m.value.current?(h(),Ce(p(A),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),Ce(p(A),{key:2,icon:"carbon:time",class:"status-icon pending"})),n("span",_m,u(T.value),1)])])])):V("",!0),n("div",{ref_key:"scrollContainer",ref:i,class:"step-details-scroll-container",onScroll:N},[m.value?(h(),v("div",wm,[m.value.agentExecution?.thinkActSteps&&m.value.agentExecution.thinkActSteps.length>0?(h(),v("div",Sm,[n("h4",null,u(p(o)("rightPanel.thinkAndActionSteps")),1),n("div",$m,[(h(!0),v(be,null,$e(m.value.agentExecution.thinkActSteps,(te,Z)=>(h(),v("div",{key:Z,class:"think-act-step"},[n("div",Pm,[n("span",Tm,"#"+u(Z+1),1),n("span",{class:Se(["step-status",te.status])},u(te.status||p(o)("rightPanel.executing")),3)]),n("div",Em,[n("h5",null,[R(p(A),{icon:"carbon:thinking"}),ye(" "+u(p(o)("rightPanel.thinking")),1)]),n("div",km,[n("div",Cm,[n("div",Im,[n("span",Rm,u(p(o)("rightPanel.input"))+":",1),n("div",xm,[n("button",{class:"copy-btn",onClick:ae=>l(te.thinkInput),title:p(o)("rightPanel.copyToClipboard")},[R(p(A),{icon:"carbon:copy"})],8,Am),n("span",Fm,u(te.inputCharCount??0)+" chars",1)])]),n("div",Mm,[n("pre",null,u(p(M)(te.thinkInput)),1)])]),n("div",Dm,[n("div",Nm,[n("span",Um,u(p(o)("rightPanel.output"))+":",1),n("div",Om,[n("button",{class:"copy-btn",onClick:ae=>l(te.thinkOutput),title:p(o)("rightPanel.copyToClipboard")},[R(p(A),{icon:"carbon:copy"})],8,Lm),n("span",Hm,u(te.outputCharCount??0)+" chars",1)])]),n("div",Bm,[n("pre",null,u(p(M)(te.thinkOutput)),1)])])])]),te.actionNeeded?(h(),v("div",qm,[n("h5",null,[R(p(A),{icon:"carbon:play"}),ye(" "+u(p(o)("rightPanel.action")),1)]),n("div",jm,[(h(!0),v(be,null,$e(te.actToolInfoList||[],(ae,Ie)=>(h(),v("div",{key:`tool-${Ie}-${ae?.id||ae?.name||Ie}`,class:"tool-execution-item"},[n("div",Vm,[n("span",Gm,u(p(o)("rightPanel.tool"))+":",1),n("span",zm,u(ae?.name||"N/A"),1)]),n("div",Wm,[n("span",Jm,u(p(o)("rightPanel.toolParameters"))+":",1),n("pre",null,u(p(M)(ae?.parameters)),1)]),n("div",Km,[n("span",Xm,u(p(o)("rightPanel.executionResult"))+":",1),n("pre",null,u(p(M)(ae?.result)),1)])]))),128)),!te.actToolInfoList||te.actToolInfoList.length===0?(h(),v("div",Ym,[n("p",null,u(p(o)("rightPanel.noToolsExecuted")),1)])):V("",!0)]),te.subPlanExecutionRecord?(h(),v("div",Zm,[n("h5",null,[R(p(A),{icon:"carbon:tree-view"}),ye(" "+u(p(o)("rightPanel.subPlan")),1)]),n("div",Qm,[n("div",eh,[n("div",th,[n("span",oh,u(O.$t("rightPanel.subPlanId"))+":",1),n("span",sh,u(te.subPlanExecutionRecord.currentPlanId),1)]),te.subPlanExecutionRecord.title?(h(),v("div",nh,[n("span",ah,u(O.$t("rightPanel.title"))+":",1),n("span",lh,u(te.subPlanExecutionRecord.title),1)])):V("",!0),n("div",rh,[te.subPlanExecutionRecord.completed?(h(),Ce(p(A),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),Ce(p(A),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),n("span",ih,u(te.subPlanExecutionRecord.completed?O.$t("rightPanel.status.completed"):O.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),m.value.agentExecution&&!m.value.agentExecution.thinkActSteps?.length?(h(),v("div",ch,[n("p",null,u(p(o)("rightPanel.noStepDetails")),1)])):m.value.agentExecution?V("",!0):(h(),v("div",uh,[R(p(A),{icon:"carbon:information",class:"info-icon"}),n("h4",null,u(p(o)("rightPanel.stepInfo")),1),n("div",dh,[n("div",ph,[n("span",mh,u(p(o)("rightPanel.stepName"))+":",1),n("span",hh,u(m.value.title||m.value.description||m.value.stepId),1)]),m.value.description?(h(),v("div",fh,[n("span",vh,u(O.$t("rightPanel.description"))+":",1),n("span",gh,u(m.value.description),1)])):V("",!0),n("div",yh,[n("span",bh,u(O.$t("rightPanel.status.label"))+":",1),n("span",{class:Se(["value",{"status-completed":m.value.completed,"status-current":m.value.current,"status-pending":!m.value.completed&&!m.value.current}])},u(m.value.completed?O.$t("rightPanel.status.completed"):m.value.current?O.$t("rightPanel.status.executing"):O.$t("rightPanel.status.pending")),3)])]),n("p",_h,u(p(o)("rightPanel.noExecutionInfo")),1)])),m.value.current&&!m.value.completed?(h(),v("div",wh,[G[4]||(G[4]=n("div",{class:"execution-waves"},[n("div",{class:"wave wave-1"}),n("div",{class:"wave wave-2"}),n("div",{class:"wave wave-3"})],-1)),n("p",Sh,[R(p(A),{icon:"carbon:in-progress",class:"rotating-icon"}),ye(" "+u(p(o)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(h(),v("div",$h,[R(p(A),{icon:"carbon:events",class:"empty-icon"}),n("h3",null,u(p(o)("rightPanel.noStepSelected")),1),n("p",null,u(p(o)("rightPanel.selectStepHint")),1)]))])):V("",!0),R(Ct,{name:"scroll-button"},{default:Qe(()=>[f.value?(h(),v("button",{key:0,onClick:L,class:"scroll-to-bottom-btn",title:p(o)("rightPanel.scrollToBottom")},[R(p(A),{icon:"carbon:chevron-down"})],8,Ph)):V("",!0)]),_:1})],544)])):V("",!0),$.value==="files"?(h(),v("div",Th,[b.value?(h(),Ce(Qr,{key:0,"plan-id":b.value},null,8,["plan-id"])):y.value?(h(),v("div",Eh,[R(p(A),{icon:"carbon:folder-off"}),n("div",kh,[n("h3",null,u(p(o)("fileBrowser.noFilesYet")),1),n("p",null,u(p(o)("fileBrowser.noPlanExecuting")),1),n("div",Ch,[R(p(A),{icon:"carbon:information"}),n("span",null,u(p(o)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])]))}}),Rh=Me(Ih,[["__scopeId","data-v-d35a8db8"]]),xh={class:"template-list-container"},Ah={class:"organization-section"},Fh={class:"organization-row"},Mh={class:"organization-selector"},Dh={class:"organization-label"},Nh=["value"],Uh={value:"by_time"},Oh={value:"by_abc"},Lh={value:"by_group_time"},Hh={value:"by_group_abc"},Bh={class:"search-input-wrapper"},qh={class:"search-label"},jh={class:"search-input-container"},Vh=["placeholder"],Gh=["title"],zh={class:"sidebar-content-list"},Wh={key:0,class:"loading-state"},Jh={key:1,class:"error-state"},Kh={key:2,class:"empty-state"},Xh=["onClick","title"],Yh=["onClick","title"],Zh={class:"group-name"},Qh={class:"group-count"},ef=["onClick"],tf={class:"task-icon"},of={class:"task-details"},sf={class:"task-title"},nf={class:"task-time"},af={class:"task-actions"},lf=["title","onClick"],rf={class:"confirm-header"},cf={class:"confirm-content"},uf={class:"confirm-actions"},df=["disabled"],pf=Fe({__name:"TemplateList",emits:["templateSelected"],setup(s,{emit:e}){const{t}=qe(),o=tt(),a=eo(),l=It(),r=x(""),d=x(!1),g=x(null),c=x(!1),i=e,f=D=>{const C=D.target;fe.setOrganizationMethod(C.value)},E=D=>{if(isNaN(D.getTime()))return console.warn("Invalid date received:",D),t("time.unknown");const _=new Date().getTime()-D.getTime(),B=Math.floor(_/6e4),N=Math.floor(_/36e5),L=Math.floor(_/864e5);return B<1?t("time.now"):B<60?t("time.minuteAgo",{count:B}):N<24?t("time.hourAgo",{count:N}):L<30?t("time.dayAgo",{count:L}):D.toLocaleDateString("zh-CN")},P=ce(()=>{o.planTemplateList.value;const D=r.value.trim().toLowerCase(),C=fe.groupedTemplates;if(!D)return C;const _=new Map;for(const[B,N]of C){const L=[];for(const S of N)(S.title||"").toLowerCase().includes(D)&&L.push(S);L.length>0&&_.set(B,L)}return _});Pe(r,D=>{o.planTemplateList.value;const C=D.trim().toLowerCase();if(!C||fe.organizationMethod!=="by_group_time"&&fe.organizationMethod!=="by_group_abc")return;const _=fe.groupedTemplates;for(const[B,N]of _){let L=!1;for(const S of N)if((S.title||"").toLowerCase().includes(C)){L=!0;break}L&&fe.isGroupCollapsed(B)&&fe.toggleGroupCollapse(B)}});const m=D=>{const C=D??"null";return fe.groupCollapseState[C]??!1},$=D=>{fe.toggleGroupCollapse(D)},b=async D=>{a.setActiveTab("config"),await fe.selectTemplate(D),D.planTemplateId?(await o.load(D.planTemplateId),fe.hasTaskRequirementModified=!1):(o.reset(),fe.hasTaskRequirementModified=!1),i("templateSelected",D)},y=D=>{g.value=D,d.value=!0},T=async()=>{if(g.value){c.value=!0;try{await fe.deleteTemplate(g.value),d.value=!1,g.value=null,l.success(t("sidebar.deleteSuccess")||"Template deleted successfully")}catch(D){console.error("Failed to delete template:",D),l.error(t("sidebar.deleteFailed")||`Delete failed: ${D instanceof Error?D.message:String(D)}`)}finally{c.value=!1}}},I=()=>{d.value=!1,g.value=null};return(D,C)=>(h(),v(be,null,[n("div",xh,[n("div",Ah,[n("div",Fh,[n("div",Mh,[n("label",Dh,u(D.$t("sidebar.organizationLabel")),1),n("select",{value:p(fe).organizationMethod,onChange:f,class:"organization-select"},[n("option",Uh,u(D.$t("sidebar.organizationByTime")),1),n("option",Oh,u(D.$t("sidebar.organizationByAbc")),1),n("option",Lh,u(D.$t("sidebar.organizationByGroupTime")),1),n("option",Hh,u(D.$t("sidebar.organizationByGroupAbc")),1)],40,Nh)]),n("div",Bh,[n("label",qh,u(D.$t("sidebar.searchLabel")),1),n("div",jh,[R(p(A),{icon:"carbon:search",width:"16",class:"search-icon"}),Te(n("input",{"onUpdate:modelValue":C[0]||(C[0]=_=>r.value=_),type:"text",class:"search-input",placeholder:D.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Vh),[[De,r.value]]),r.value?(h(),v("button",{key:0,class:"search-clear-btn",onClick:C[1]||(C[1]=_=>r.value=""),title:D.$t("sidebar.clearSearch")||"Clear search"},[R(p(A),{icon:"carbon:close",width:"14"})],8,Gh)):V("",!0)])])])]),n("div",zh,[p(fe).isLoading?(h(),v("div",Wh,[R(p(A),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),n("span",null,u(D.$t("sidebar.loading")),1)])):p(fe).errorMessage?(h(),v("div",Jh,[R(p(A),{icon:"carbon:warning",width:"20"}),n("span",null,u(p(fe).errorMessage),1),n("button",{onClick:C[2]||(C[2]=(..._)=>p(fe).loadPlanTemplateList&&p(fe).loadPlanTemplateList(..._)),class:"retry-btn"},u(D.$t("sidebar.retry")),1)])):p(o).planTemplateList.value.length===0?(h(),v("div",Kh,[R(p(A),{icon:"carbon:document",width:"32"}),n("span",null,u(D.$t("sidebar.noTemplates")),1)])):(h(!0),v(be,{key:3},$e(P.value,([_,B])=>(h(),v(be,{key:_||"ungrouped"},[(p(fe).organizationMethod==="by_group_time"||p(fe).organizationMethod==="by_group_abc")&&B.length>0?(h(),v("div",{key:0,class:"group-header",onClick:ke(N=>$(_),["prevent"]),title:m(_)?D.$t("sidebar.expandGroup"):D.$t("sidebar.collapseGroup")},[n("button",{type:"button",class:"group-toggle-btn",onClick:ke(N=>$(_),["stop","prevent"]),title:m(_)?D.$t("sidebar.expandGroup"):D.$t("sidebar.collapseGroup")},[R(p(A),{icon:m(_)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Yh),R(p(A),{icon:"carbon:folder",width:"16"}),n("span",Zh,u(_===null||_===""?D.$t("sidebar.ungroupedMethods"):_),1),n("span",Qh,"("+u(B.length)+")",1)],8,Xh)):V("",!0),(p(fe).organizationMethod==="by_group_time"||p(fe).organizationMethod==="by_group_abc")&&m(_)?V("",!0):(h(!0),v(be,{key:1},$e(B,N=>(h(),v("div",{key:N.planTemplateId||"unknown",class:Se(["sidebar-content-list-item",{"sidebar-content-list-item-active":N.planTemplateId===p(o).currentPlanTemplateId.value,"grouped-item":p(fe).organizationMethod==="by_group_time"||p(fe).organizationMethod==="by_group_abc"}]),onClick:L=>b(N)},[n("div",tf,[R(p(A),{icon:"carbon:document",width:"20"})]),n("div",of,[n("div",sf,u(N.title||D.$t("sidebar.unnamedPlan")),1)]),n("div",nf,u(E(p(o).parseDateTime(N.updateTime||N.createTime))),1),n("div",af,[n("button",{class:"delete-task-btn",title:D.$t("sidebar.deleteTemplate"),onClick:ke(L=>y(N),["stop"])},[R(p(A),{icon:"carbon:close",width:"16"})],8,lf)])],10,ef))),128))],64))),128))])]),(h(),Ce(Io,{to:"body"},[R(Ct,{name:"modal"},{default:Qe(()=>[d.value?(h(),v("div",{key:0,class:"modal-overlay",onClick:I},[n("div",{class:"confirm-modal",onClick:C[3]||(C[3]=ke(()=>{},["stop"]))},[n("div",rf,[R(p(A),{icon:"carbon:warning",class:"warning-icon"}),n("h3",null,u(D.$t("sidebar.deleteConfirm")),1)]),n("div",cf,[n("p",null,u(D.$t("sidebar.deleteConfirmMessage",{templateName:g.value?.title||""})),1)]),n("div",uf,[n("button",{class:"confirm-btn cancel-btn",onClick:I},u(D.$t("common.cancel")),1),n("button",{class:"confirm-btn delete-btn",onClick:T,disabled:c.value},[R(p(A),{icon:c.value?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ye(" "+u(D.$t("common.delete")),1)],8,df)])])])):V("",!0)]),_:1})]))],64))}}),mf=Me(pf,[["__scopeId","data-v-afbd5426"]]),hf={class:"sidebar-content"},ff={class:"sidebar-content-header"},vf={class:"sidebar-content-title"},gf={class:"tab-content"},yf=Fe({name:"SidebarPanel",__name:"Sidebar",props:{width:{}},setup(s,{expose:e}){const t=s,o=ht(),a=tt(),l=eo(),r=async()=>{const d=a.getPlanType()||"dynamic_agent";await fe.createNewTemplate(d);const g=a.selectedTemplate.value;g&&(a.reset(),a.setPlanType(g.planType||"dynamic_agent"),g.planTemplateId&&a.setPlanTemplateId(g.planTemplateId),a.setTitle(g.title||"")),l.setActiveTab("config"),console.log("[Sidebar] ðŸ”„ Reloading available tools for new template"),await o.loadAvailableTools()};return He(async()=>{await fe.loadPlanTemplateList(),o.loadAvailableTools()}),e({loadPlanTemplateList:fe.loadPlanTemplateList,toggleSidebar:Ro.toggleSidebar}),(d,g)=>(h(),v("div",{class:"sidebar-wrapper",style:mt({width:t.width+"%"})},[n("div",hf,[n("div",ff,[n("div",vf,u(d.$t("sidebar.title")),1),n("button",{class:"new-task-btn",onClick:r},[R(p(A),{icon:"carbon:add",width:"16"}),ye(" "+u(d.$t("sidebar.newPlan")),1)])]),n("div",gf,[R(mf)])])],4))}}),bf=Me(yf,[["__scopeId","data-v-0414be7c"]]);function _f(){const s=rt(),e=lt(),{showToast:t}=Ao(),{t:o}=qe(),a=c=>{const i={currentPlanId:c.currentPlanId,status:c.completed?"completed":"running"};return c.rootPlanId&&(i.rootPlanId=c.rootPlanId),c.summary&&(i.summary=c.summary),c.completed!==void 0&&(i.completed=c.completed),c.agentExecutionSequence&&(i.agentExecutionSequence=c.agentExecutionSequence),i},l=c=>{if(!c)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(c)){const[i,f,E,P=0,m=0,$=0,b=0]=c,y=new Date(i,f-1,E,P,m,$,Math.floor(b/1e6));return isNaN(y.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",c),new Date):y}if(typeof c=="string"){let i=new Date(c);if(!isNaN(i.getTime()))return i;const f=c.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(f){const[,E,P,m,$,b,y,T]=f;if(i=new Date(parseInt(E),parseInt(P)-1,parseInt(m),parseInt($),parseInt(b),parseInt(y),T?parseInt(T.substring(0,3)):0),!isNaN(i.getTime()))return i}return!c.includes("Z")&&!c.includes("+")&&!c.includes("-",10)&&(i=new Date(c+"Z"),!isNaN(i.getTime()))?i:(console.warn("[useConversationHistory] Failed to parse date string:",c),new Date)}if(typeof c=="number"){const i=c.toString().length<13?c*1e3:c,f=new Date(i);return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",c),new Date):f}return console.warn("[useConversationHistory] Unknown date format:",c,typeof c),new Date}catch(i){return console.warn("[useConversationHistory] Error parsing date:",c,i),new Date}},r=c=>{if(!c)return;console.log("[useConversationHistory] Processing record:",{userRequest:c.userRequest,startTime:c.startTime,startTimeType:typeof c.startTime,endTime:c.endTime,endTimeType:typeof c.endTime});const i=c.userRequest||c.title||"History Round",f=s.createDialog(i),E=xe.getConversationId();if(E){const P=s.getDialog(f.id);P&&(P.conversationId=E,c.rootPlanId&&(P.planId=c.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",f.id,E))}if(c.userRequest&&c.startTime){const P=l(c.startTime);console.log("[useConversationHistory] Parsed date:",{original:c.startTime,parsed:P,parsedISO:P.toISOString(),isValid:!isNaN(P.getTime())});const m={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:c.userRequest,timestamp:P,isStreaming:!1};s.addMessageToDialog(f.id,m)}if(c.currentPlanId){const P=c.summary||c.result||c.message||"Execution completed",m=a(c),$={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:P,timestamp:c.endTime&&c.endTime?l(c.endTime):c.startTime?l(c.startTime):new Date,isStreaming:!1,planExecution:m};s.addMessageToDialog(f.id,$),c.rootPlanId&&e.setCachedPlanRecord(c.rootPlanId,m)}},d=async(c,i=!1,f=!0)=>{if(!c){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{i&&s.clearMessages(),xe.setConversationId(c),s.setConversationId(c);const E=await St.getConversationHistory(c);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const P=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:P.startTime,endTime:P.endTime,startTimeType:typeof P.startTime})}for(const P of E)r(P);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),f&&t(o("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:d,restoreConversationHistory:async c=>d(c,!1,!1),processHistoryRecord:r}}let qt=null;function wf(){return qt||(qt=_f()),qt}const Sf={class:"direct-page"},$f={class:"branding-header"},Pf={class:"branding-content"},Tf={class:"branding-actions"},Ef=["title"],kf={class:"direct-chat"},Cf=["title"],If=["title"],Rf={class:"chat-header"},xf={class:"header-actions"},Af=["title"],Ff=["title"],Mf={class:"chat-content"},Df={class:"message-content"},Nf=Fe({name:"DirectIndex",__name:"index",setup(s){const e=ys(),t=bs(),o=Et(),{toast:a}=Ao(),l=rt(),r=lt(),d=wf(),g=x(""),c=x(),i=x(),f=x(null),E=x(50),P=x(80),m=x(!1),$=x(0),b=x(0),y=x(!1),T=x(0),I=x(0);He(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",o.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",o.hasUnprocessedTask()),Pe(()=>r.planExecutionRecords,he=>{for(const[F,H]of he.entries())U(F)&&(c.value&&typeof c.value.updateDisplayedPlanProgress=="function"&&c.value.updateDisplayedPlanProgress(F),H.completed&&F===f.value&&(Array.from(he.entries()).some(([ie,ne])=>ie!==F&&ne&&!ne.completed&&ne.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),f.value=null)))},{deep:!0}),Pe(()=>r.trackedPlanIds,he=>{if(!f.value&&he.value.size>0){const F=Array.from(he.value)[0];f.value=F,console.log("[Direct] Set currentRootPlanId to:",F)}},{deep:!0});const Z=xe.getConversationId();if(Z&&(console.log("[Direct] Found saved conversationId, restoring conversation:",Z),Ue(async()=>{try{await d.restoreConversationHistory(Z)}catch(he){console.error("[DirectView] Failed to restore conversation history:",he)}})),fe.loadPlanTemplateList(),o.hasUnprocessedTask()&&o.currentTask){const he=o.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",he),he.trim()?(o.markTaskAsProcessed(),Ue(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",he),await l.sendMessage({input:he})}catch(F){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",F),g.value=he}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),o.markTaskAsProcessed())}else o.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(g.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",g.value),console.log("[Direct] No unprocessed task in store"));const ae=localStorage.getItem("directPanelWidth");ae&&(E.value=parseFloat(ae));const Ie=localStorage.getItem("sidebarWidth");Ie&&(P.value=parseFloat(Ie)),console.log("[Direct] Final prompt value:",g.value)}),Pe(()=>o.currentTask,Z=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",Z),Z&&!Z.processed&&Z.prompt.trim()){const ae=Z.prompt;o.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",ae),Ue(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",ae),await l.sendMessage({input:ae})}catch(Ie){console.warn("[Direct] messageDialog.sendMessage failed for new task:",Ie)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),Pe(()=>g.value,(Z,ae)=>{console.log("[Direct] prompt value changed from:",ae,"to:",Z)},{immediate:!1}),Ve(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),f.value=null,r.cleanup(),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",_),document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",S)});const D=Z=>{m.value=!0,$.value=Z.clientX,b.value=E.value,document.addEventListener("mousemove",C),document.addEventListener("mouseup",_),document.body.style.cursor="col-resize",document.body.style.userSelect="none",Z.preventDefault()},C=Z=>{if(!m.value)return;const ae=window.innerWidth,he=-(Z.clientX-$.value)/ae*100;let F=b.value+he;F=Math.max(20,Math.min(80,F)),E.value=F},_=()=>{m.value=!1,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",_),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},B=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},N=Z=>{y.value=!0,T.value=Z.clientX,I.value=P.value,document.addEventListener("mousemove",L),document.addEventListener("mouseup",S),document.body.style.cursor="col-resize",document.body.style.userSelect="none",Z.preventDefault()},L=Z=>{if(!y.value)return;const ae=window.innerWidth,he=(Z.clientX-T.value)/ae*100;let F=I.value+he;F=Math.max(15,Math.min(100,F)),P.value=F},S=()=>{y.value=!1,document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",S),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",P.value.toString())},M=()=>{P.value=80,localStorage.setItem("sidebarWidth","80")},U=(Z,ae=!1)=>!f.value||Z===f.value||ae&&(Z==="ui-state"||Z==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",Z,"current:",f.value),!1),q=Z=>{console.log("[DirectView] Step selected:",Z),c.value&&typeof c.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to config/preview panel:",Z),c.value.handleStepSelected(Z)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},j=()=>{t.push("/home")},O=()=>{t.push("/configs")},G=async()=>{if(xe.selectMemoryId){console.log("[DirectView] Memory selected:",xe.selectMemoryId);try{await d.loadConversationHistory(xe.selectMemoryId,!0,!0)}catch(Z){console.error("[DirectView] Failed to load conversation history:",Z)}}},te=()=>{xe.clearMemoryId(),xe.clearConversationId(),l.reset()};return(Z,ae)=>(h(),v("div",Sf,[n("header",$f,[n("div",Pf,[ae[1]||(ae[1]=n("div",{class:"branding-logo"},[n("img",{src:fs,alt:"Lynxe",class:"java-logo"}),n("h1",null,"Lynxe")],-1)),n("div",Tf,[R(ws),n("button",{class:"back-button",onClick:j},[R(p(A),{icon:"carbon:arrow-left"})]),n("button",{class:"config-button",onClick:O,title:Z.$t("direct.configuration")},[R(p(A),{icon:"carbon:settings-adjust",width:"20"})],8,Ef)])])]),n("div",kf,[R(bf,{ref_key:"sidebarRef",ref:i,width:P.value},null,8,["width"]),n("div",{class:"panel-resizer",onMousedown:N,onDblclick:M,title:Z.$t("sidebar.resizeHint")},ae[2]||(ae[2]=[n("div",{class:"resizer-line"},null,-1)]),40,Cf),R(Rh,{ref_key:"rightPanelRef",ref:c,style:mt({width:100-P.value-E.value+"%"}),"current-root-plan-id":f.value},null,8,["style","current-root-plan-id"]),n("div",{class:"panel-resizer",onMousedown:D,onDblclick:B,title:Z.$t("direct.panelResizeHint")},ae[3]||(ae[3]=[n("div",{class:"resizer-line"},null,-1)]),40,If),n("div",{class:"left-panel",style:mt({width:E.value+"%"})},[n("div",Rf,[n("h2",null,u(Z.$t("conversation")),1),n("div",xf,[n("button",{class:"config-button",onClick:te,title:Z.$t("memory.newChat")},[R(p(A),{icon:"carbon:add",width:"20"})],8,Af),n("button",{class:"cron-task-btn",onClick:ae[0]||(ae[0]=Ie=>p(xe).toggleSidebar()),title:Z.$t("memory.selectMemory")},[R(p(A),{icon:"carbon:calendar",width:"20"})],8,Ff)])]),n("div",Mf,[R(ol,{onStepSelected:q})]),(h(),Ce(Pl,{key:Z.$i18n.locale,"initial-value":g.value},null,8,["initial-value"]))],4)]),R(hr,{onMemorySelected:G}),p(a).show?(h(),v("div",{key:0,class:Se(["message-toast",p(a).type])},[n("div",Df,[n("span",null,u(p(a).text),1)])],2)):V("",!0)]))}}),iv=Me(Nf,[["__scopeId","data-v-4b41408b"]]);export{iv as default};
//# sourceMappingURL=index-Jg9JpMUB.js.map
