import{d as Te,u as Ne,a as g,b as h,n as ue,e as n,f as V,g as A,i as p,h as ce,t as u,y as Xe,F as de,q as fe,j as _e,l as we,A as fs,c as se,B as je,r as M,o as De,C as ve,D as Le,w as ye,m as ke,E as Bt,G as Ft,v as so,H as vs,I as Ue,J as gs,z as Ae,T as qt,p as Ye,K as oo,M as no,N as nt,O as ao,x as lo}from"./index-CAx6GS4W.js";import{I as F,_ as Ee}from"./_plugin-vue_export-helper-L0WeBCxl.js";import{u as yt,m as Ce,P as ro,D as Jt,a as Ze,s as xe,t as le,b as io}from"./templateStore-WiL39W7-.js";import{L as co}from"./LanguageSwitcher-DGPPLy-u.js";import{M as ys,u as bs,a as _s}from"./useToast-ZkBlILtK.js";import"./llm-check-CJy4TeZw.js";const uo={class:"sub-plan-info"},po={class:"sub-plan-details"},mo={class:"sub-plan-title"},ho={key:0,class:"nesting-level"},fo={class:"sub-plan-id"},vo={class:"sub-plan-meta"},go={key:0,class:"trigger-tool"},yo={class:"trigger-text"},bo={key:0,class:"sub-plan-progress"},_o={class:"progress-info"},wo={class:"progress-text"},$o={class:"progress-bar"},So={key:1,class:"sub-plan-agents-steps"},Po={class:"agents-steps-header"},To={class:"agents-label"},Eo={class:"agents-steps-list"},ko=["onClick"],Co={class:"agent-step-header"},Io=["title"],Ro={class:"sub-agent-execution-info"},xo={key:0,class:"agent-result"},Ao={class:"result-header"},Mo={class:"result-label"},Fo={class:"result-content"},Do={key:1,class:"agent-error"},No={class:"error-header"},Uo={class:"error-label"},Lo={class:"error-content"},Oo={key:2,class:"think-act-preview"},Bo={class:"think-act-header"},qo={class:"think-act-label"},Ho={class:"think-act-steps-preview"},Vo=["onClick"],jo={class:"step-number"},zo={class:"step-description"},Wo={key:0,class:"more-steps"},Go={class:"more-steps-text"},Ko={key:3,class:"nested-sub-plans"},Jo={class:"nested-sub-plans-header"},Xo={class:"nested-label"},Yo={class:"nested-sub-plans-list"},Qo={key:4,class:"direct-sub-plans"},Zo={class:"direct-sub-plans-header"},en={class:"direct-label"},tn={class:"direct-sub-plans-list"},sn=Te({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=o,s=t,{t:a}=Ne(),l=()=>`nesting-level-${e.nestingLevel}`,i=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(U=>U.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(U=>U.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},b=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},r=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const T=c();return Math.min(100,T/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(T=>T.status==="FINISHED").length:0,f=T=>{switch(T){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},E=T=>{switch(T){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},k=T=>{switch(T){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},d=T=>T.thinkActSteps?.some(R=>R.subPlanExecutionRecord)??!1,w=T=>T.thinkActSteps?.filter(R=>R.subPlanExecutionRecord)??[],y=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},v=(T,R)=>{const U=R.stepId??`subplan-${e.subPlanIndex}-agent-${T}`;s("step-selected",U)},I=(T,R,U)=>{const x=U.stepId??`subplan-${e.subPlanIndex}-agent-${T}`;s("step-selected",x)},O=(T,R,U)=>{s("sub-plan-selected",T,R,U)},W=T=>{s("step-selected",T)};return(T,R)=>{const U=fs("RecursiveSubPlan",!0);return h(),g("div",{class:ue(["recursive-sub-plan",l()])},[n("div",{class:"sub-plan-header",onClick:y},[n("div",uo,[A(p(F),{icon:b(),class:"sub-plan-status-icon"},null,8,["icon"]),n("div",po,[n("div",mo,[ce(u(T.subPlan.title||T.$t("chat.subPlan"))+" #"+u(T.subPlanIndex+1)+" ",1),(T.nestingLevel??0)>0?(h(),g("span",ho,"(L"+u((T.nestingLevel??0)+1)+")",1)):V("",!0)]),n("div",fo,u(T.subPlan.currentPlanId),1)])]),n("div",vo,[n("div",{class:ue(["sub-plan-status-badge",i()])},u(m()),3),T.subPlan.parentActToolCall?(h(),g("div",go,[A(p(F),{icon:"carbon:function",class:"trigger-icon"}),n("span",yo,u(T.subPlan.parentActToolCall.name),1)])):V("",!0)])]),T.subPlan.agentExecutionSequence?.length?(h(),g("div",bo,[n("div",_o,[n("span",wo,u(T.$t("chat.progress"))+": "+u(c())+" / "+u(T.subPlan.agentExecutionSequence.length),1),n("div",$o,[n("div",{class:"progress-fill",style:Xe({width:r()+"%"})},null,4)])])])):V("",!0),T.subPlan.agentExecutionSequence?.length?(h(),g("div",So,[n("div",Po,[n("span",To,u(T.$t("chat.agentExecutions"))+":",1)]),n("div",Eo,[(h(!0),g(de,null,fe(T.subPlan.agentExecutionSequence,(x,q)=>(h(),g("div",{key:x.id||q,class:ue(["agent-step-item",f(x.status)]),onClick:_=>v(q,x)},[n("div",Co,[A(p(F),{icon:E(x.status),class:"agent-icon"},null,8,["icon"]),n("span",{class:"agent-name",title:x.agentName==="ConfigurableDynaAgent"?T.$t("chat.clickToViewExecutionDetails"):""},u(x.agentName==="ConfigurableDynaAgent"?T.$t("chat.funcAgentExecutionDetails"):x.agentName||T.$t("chat.unknownAgent")),9,Io),n("div",{class:ue(["agent-status-badge",f(x.status)])},u(k(x.status)),3)]),n("div",Ro,[x.result?(h(),g("div",xo,[n("div",Ao,[A(p(F),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Mo,u(T.$t("chat.agentResult"))+":",1)]),n("pre",Fo,u(x.result),1)])):V("",!0),x.errorMessage?(h(),g("div",Do,[n("div",No,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",Uo,u(T.$t("chat.errorMessage"))+":",1)]),n("pre",Lo,u(x.errorMessage),1)])):V("",!0),x.thinkActSteps?.length?(h(),g("div",Oo,[n("div",Bo,[A(p(F),{icon:"carbon:thinking",class:"think-act-icon"}),n("span",qo,u(T.$t("chat.thinkActSteps"))+" ("+u(x.thinkActSteps.length)+")",1)]),n("div",Ho,[(h(!0),g(de,null,fe(x.thinkActSteps.slice(0,T.maxVisibleSteps??2),(_,P)=>(h(),g("div",{key:_.id||P,class:"think-act-step-preview",onClick:_e($=>I(q,P,x),["stop"])},[n("span",jo,"#"+u(P+1),1),n("span",zo,u(_.actionDescription||T.$t("chat.thinking")),1),A(p(F),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Vo))),128)),x.thinkActSteps.length>(T.maxVisibleSteps??2)?(h(),g("div",Wo,[n("span",Go,u(T.$t("chat.andMoreSteps",{count:x.thinkActSteps.length-(T.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),d(x)?(h(),g("div",Ko,[n("div",Jo,[A(p(F),{icon:"carbon:tree-view-alt",class:"nested-icon"}),n("span",Xo,u(T.$t("chat.nestedSubPlans")),1)]),n("div",Yo,[(h(!0),g(de,null,fe(w(x),(_,P)=>(h(),we(U,{key:_.id||P,"sub-plan":_.subPlanExecutionRecord,"sub-plan-index":P,"nesting-level":(T.nestingLevel??0)+1,"max-nesting-depth":T.maxNestingDepth??3,"max-visible-steps":T.maxVisibleSteps??2,onSubPlanSelected:O,onStepSelected:W},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),x.subPlanExecutionRecords?.length?(h(),g("div",Qo,[n("div",Zo,[A(p(F),{icon:"carbon:tree-view",class:"direct-icon"}),n("span",en,u(T.$t("chat.directSubPlans")),1)]),n("div",tn,[(h(!0),g(de,null,fe(x.subPlanExecutionRecords,(_,P)=>(h(),we(U,{key:_.currentPlanId||P,"sub-plan":_,"sub-plan-index":P,"nesting-level":(T.nestingLevel??0)+1,"max-nesting-depth":T.maxNestingDepth??3,"max-visible-steps":T.maxVisibleSteps??2,onSubPlanSelected:O,onStepSelected:W},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,ko))),128))])])):V("",!0)],2)}}}),on=Ee(sn,[["__scopeId","data-v-36486b62"]]),nn={class:"execution-details"},an={key:0,class:"plan-overview"},ln={key:0,class:"parent-tool-call"},rn={class:"parent-tool-header"},cn={class:"tool-label"},un={class:"tool-name"},dn={key:0,class:"tool-parameters"},pn={class:"param-label"},mn={class:"param-content"},hn={key:1,class:"agent-execution-container"},fn={class:"section-title"},vn=["onClick"],gn={class:"agent-info"},yn={class:"agent-details"},bn=["title"],_n={class:"request-content"},wn={class:"agent-controls"},$n={class:"agent-execution-info"},Sn={key:0,class:"agent-result"},Pn={class:"result-header"},Tn={class:"result-label"},En={class:"result-content"},kn={key:1,class:"agent-error"},Cn={class:"error-header"},In={class:"error-label"},Rn={class:"error-content"},xn={key:0,class:"sub-plans-container"},An={class:"sub-plans-header"},Mn={class:"sub-plans-title"},Fn={class:"sub-plans-list"},Dn=Te({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:t}){const e=t,{t:s}=Ne(),a=f=>{f.stepId?e("step-selected",f.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",f)},l=f=>{switch(f){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},i=f=>{switch(f){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},m=f=>{switch(f){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},b=(f,E,k)=>{e("sub-plan-selected",f,E,k)},r=f=>{e("step-selected",f)},c=f=>{if(!f)return"";try{const E=JSON.parse(f);return JSON.stringify(E,null,2)}catch{return f}};return(f,E)=>(h(),g("div",nn,[f.planExecution?(h(),g("div",an,[f.planExecution.parentActToolCall?(h(),g("div",ln,[n("div",rn,[A(p(F),{icon:"carbon:flow",class:"tool-icon"}),n("span",cn,u(f.$t("chat.triggeredByTool"))+":",1),n("span",un,u(f.planExecution.parentActToolCall.name),1)]),f.planExecution.parentActToolCall.parameters?(h(),g("div",dn,[n("span",pn,u(f.$t("common.parameters"))+":",1),n("pre",mn,u(c(f.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(f.planExecution?.agentExecutionSequence?.length??0)>0?(h(),g("div",hn,[n("h4",fn,u(f.$t("chat.agentExecutionSequence")),1),(h(!0),g(de,null,fe(f.planExecution?.agentExecutionSequence,(k,d)=>(h(),g("div",{key:k.id||d,class:ue(["agent-execution-item",l(k.status)])},[n("div",{class:"agent-header",onClick:w=>a(k)},[n("div",gn,[A(p(F),{icon:m(k.status),class:"agent-status-icon"},null,8,["icon"]),n("div",yn,[n("div",{class:"agent-name",title:k.agentName==="ConfigurableDynaAgent"?f.$t("chat.clickToViewExecutionDetails"):""},u(k.agentName==="ConfigurableDynaAgent"?f.$t("chat.funcAgentExecutionDetails"):k.agentName||f.$t("chat.unknownAgent")),9,bn),n("pre",_n,u(k.agentRequest),1)])]),n("div",wn,[n("div",{class:ue(["agent-status-badge",l(k.status)])},u(i(k.status)),3),A(p(F),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,vn),n("div",$n,[k.result?(h(),g("div",Sn,[n("div",Pn,[A(p(F),{icon:"carbon:checkmark",class:"result-icon"}),n("span",Tn,u(f.$t("chat.agentResult"))+":",1)]),n("pre",En,u(k.result),1)])):V("",!0),k.errorMessage?(h(),g("div",kn,[n("div",Cn,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",In,u(f.$t("chat.errorMessage"))+":",1)]),n("pre",Rn,u(k.errorMessage),1)])):V("",!0)]),k.subPlanExecutionRecords?.length?(h(),g("div",xn,[n("div",An,[A(p(F),{icon:"carbon:tree-view",class:"sub-plans-icon"}),n("span",Mn,u(f.$t("chat.subPlanExecutions"))+" ("+u(k.subPlanExecutionRecords.length)+") ",1)]),n("div",Fn,[(h(!0),g(de,null,fe(k.subPlanExecutionRecords,(w,y)=>(h(),we(on,{key:w.currentPlanId||y,"sub-plan":w,"sub-plan-index":y,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:b,onStepSelected:r},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2))),128))])):V("",!0)]))}}),Nn=Ee(Dn,[["__scopeId","data-v-ee75d960"]]);function ws(){return{formatResponseText:b=>b?b.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:b=>{if(!b||isNaN(b.getTime()))return"";const c=new Date().getTime()-b.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return b.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.warn("[useMessageFormatting] Error formatting timestamp:",b,f),""}},getMessageClasses:b=>se(()=>({user:b.type==="user",assistant:b.type==="assistant",streaming:b.isStreaming,"has-error":!!b.error,"has-thinking":!!b.thinking,"has-execution":!!b.planExecution})),formatFileSize:b=>{if(b===0)return"0 B";const r=1024,c=["B","KB","MB","GB"],f=Math.floor(Math.log(b)/Math.log(r));return parseFloat((b/Math.pow(r,f)).toFixed(2))+" "+c[f]},truncateText:(b,r=100)=>!b||b.length<=r?b:b.substring(0,r)+"...",stripHtml:b=>b.replace(/<[^>]*>/g,""),hasDisplayableContent:b=>!!(b.content||(b.thinking??!1)||(b.planExecution??!1)||b.error),getMessageStatus:b=>b.error?"Send failed":b.isStreaming?"Typing...":b.type==="assistant"&&!b.content&&!b.thinking?"Waiting for response":""}}class Dt{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Un={class:"user-input-form-container"},Ln={class:"user-input-header"},On={class:"user-input-title"},Bn={class:"user-input-message"},qn={key:0,class:"form-description"},Hn={key:0,class:"form-grid"},Vn=["for"],jn=["id","name","placeholder","required","onUpdate:modelValue"],zn=["id","name","placeholder","required","onUpdate:modelValue"],Wn=["id","name","placeholder","required","onUpdate:modelValue"],Gn=["id","name","placeholder","required","onUpdate:modelValue"],Kn=["id","name","placeholder","required","onUpdate:modelValue"],Jn=["id","name","required","onUpdate:modelValue"],Xn={value:""},Yn=["value"],Qn={key:6,class:"checkbox-group"},Zn=["id","name","value","onUpdate:modelValue"],ea={class:"checkbox-label"},ta={key:7,class:"radio-group"},sa=["id","name","value","onUpdate:modelValue"],oa={class:"radio-label"},na=["id","name","placeholder","required","onUpdate:modelValue"],aa={key:1,class:"form-group"},la={for:"form-input-genericInput"},ra={type:"submit",class:"submit-user-input-btn"},ia=Te({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:t}){const e=o,s=t;Ne();const a=je({}),l=M(e.genericInput??""),i=M(!1),m=M(null),b=()=>{const E=e.userInputWaitState?.formInputs;E&&E.length>0&&(!i.value||Object.keys(a).length!==E.length)&&(E.forEach((d,w)=>{(!(w in a)||d.type==="checkbox"&&!Array.isArray(a[w])||d.type!=="checkbox"&&a[w]==="")&&(d.type==="checkbox"?a[w]=[]:a[w]="")}),i.value=!0)};De(()=>{b()}),ve(()=>e.userInputWaitState?.formInputs,()=>{m.value&&clearTimeout(m.value),m.value=setTimeout(()=>{i.value=!1,b()},100)},{deep:!0});const r=async()=>{try{const E={},k=e.userInputWaitState?.formInputs;k&&k.length>0?Object.entries(a).forEach(([d,w])=>{const y=parseInt(d,10),I=k[y].label||`input_${d}`;Array.isArray(w)?E[I]=w.join(", "):E[I]=w}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",e.planId),e.planId?(await Dt.submitFormInput(e.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},c=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(k=>k.trim()).filter(k=>k.length>0):[]:[],f=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Le(()=>{m.value&&clearTimeout(m.value)}),(E,k)=>(h(),g("div",Un,[n("div",Ln,[A(p(F),{icon:"carbon:user",class:"user-icon"}),n("h4",On,u(E.$t("chat.userInputRequired")),1)]),n("p",Bn,u(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),g("p",qn,u(E.userInputWaitState?.formDescription),1)):V("",!0),n("form",{onSubmit:_e(r,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),g("div",Hn,[(h(!0),g(de,null,fe(E.userInputWaitState?.formInputs,(d,w)=>(h(),g("div",{key:w,class:"form-group"},[n("label",{for:`form-input-${d.label.replace(/\W+/g,"_")}`},u(d.label)+u(f(d.required)?" *":"")+": ",9,Vn),!d.type||d.type==="text"?ye((h(),g("input",{key:0,type:"text",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input"},null,8,jn)),[[ke,a[w]]]):d.type==="email"?ye((h(),g("input",{key:1,type:"email",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input"},null,8,zn)),[[ke,a[w]]]):d.type==="number"?ye((h(),g("input",{key:2,type:"number",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input"},null,8,Wn)),[[ke,a[w]]]):d.type==="password"?ye((h(),g("input",{key:3,type:"password",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input"},null,8,Gn)),[[ke,a[w]]]):d.type==="textarea"?ye((h(),g("textarea",{key:4,id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input form-textarea",rows:"4"},null,8,Kn)),[[ke,a[w]]]):d.type==="select"&&d.options?ye((h(),g("select",{key:5,id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input form-select"},[n("option",Xn,u(E.$t("selectCommon.pleaseSelect")),1),(h(!0),g(de,null,fe(c(d.options),y=>(h(),g("option",{key:y,value:y},u(y),9,Yn))),128))],8,Jn)),[[Bt,a[w]]]):d.type==="checkbox"&&d.options?(h(),g("div",Qn,[(h(!0),g(de,null,fe(c(d.options),y=>(h(),g("label",{key:y,class:"checkbox-item"},[ye(n("input",{type:"checkbox",id:`form-input-${d.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:d.label,value:y,"onUpdate:modelValue":v=>a[w]=v,class:"form-checkbox"},null,8,Zn),[[Ft,a[w]]]),n("span",ea,u(y),1)]))),128))])):d.type==="radio"&&d.options?(h(),g("div",ta,[(h(!0),g(de,null,fe(c(d.options),y=>(h(),g("label",{key:y,class:"radio-item"},[ye(n("input",{type:"radio",id:`form-input-${d.label.replace(/\W+/g,"_")}-${y.replace(/\W+/g,"_")}`,name:d.label,value:y,"onUpdate:modelValue":v=>a[w]=v,class:"form-radio"},null,8,sa),[[so,a[w]]]),n("span",oa,u(y),1)]))),128))])):ye((h(),g("input",{key:8,type:"text",id:`form-input-${d.label.replace(/\W+/g,"_")}`,name:d.label,placeholder:d.placeholder||"",required:f(d.required),"onUpdate:modelValue":y=>a[w]=y,class:"form-input"},null,8,na)),[[ke,a[w]]])]))),128))])):(h(),g("div",aa,[n("label",la,u(E.$t("common.input"))+":",1),ye(n("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":k[0]||(k[0]=d=>l.value=d),class:"form-input"},null,512),[[ke,l.value]])])),n("button",ra,u(E.$t("chat.userInput.submit")),1)],32)]))}}),ca=Ee(ia,[["__scopeId","data-v-e4d0802d"]]),ua={class:"response-section"},da={class:"response-header"},pa={class:"response-avatar"},ma={class:"response-name"},ha={key:0,class:"response-timestamp"},fa={class:"response-content"},va={key:1,class:"final-response"},ga=["innerHTML"],ya={class:"response-actions"},ba=["title"],_a=["title"],wa={key:2,class:"response-placeholder"},$a={class:"typing-indicator"},Sa={class:"typing-text"},Pa={key:3,class:"response-error"},Ta={class:"error-text"},Ea={key:4,class:"response-empty"},ka={class:"empty-text"},Ca=Te({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:t}){const e=o,s=t,{formatResponseText:a,formatTimestamp:l}=ws(),i=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},m=()=>{s("regenerate")},b=()=>{s("retry")},r=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,f)=>(h(),g("div",ua,[n("div",da,[n("div",pa,[A(p(F),{icon:"carbon:bot",class:"bot-icon"})]),n("div",ma,u(c.$t("chat.botName")),1),c.timestamp?(h(),g("div",ha,u(p(l)(c.timestamp)),1)):V("",!0)]),n("div",fa,[c.userInputWaitState?.waiting?(h(),we(ca,vs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:r}),null,16,["user-input-wait-state","generic-input"])):V("",!0),c.content?(h(),g("div",va,[n("div",{class:"response-text",innerHTML:p(a)(c.content)},null,8,ga),n("div",ya,[n("button",{class:"action-btn copy-btn",onClick:i,title:c.$t("chat.copyResponse")},[A(p(F),{icon:"carbon:copy"})],8,ba),n("button",{class:"action-btn regenerate-btn",onClick:m,title:c.$t("chat.regenerateResponse")},[A(p(F),{icon:"carbon:renew"})],8,_a)])])):c.isStreaming?(h(),g("div",wa,[n("div",$a,[f[0]||(f[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1)),n("span",Sa,u(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),g("div",Pa,[A(p(F),{icon:"carbon:warning",class:"error-icon"}),n("span",Ta,u(c.error),1),n("button",{class:"retry-btn",onClick:b},u(c.$t("chat.retry")),1)])):(h(),g("div",Ea,[n("span",ka,u(c.$t("chat.waitingForResponse")),1)]))])]))}}),Ia=Ee(Ca,[["__scopeId","data-v-a03ac86f"]]);function Ra(){const s=M(new Set),a=je(new Map),l=je(new Map),i=je(new Map),m=je(new Map),b=M(!1),r=M(null),c=R=>m.get(R),f=(R,U)=>{if(!R){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}m.set(R,U),console.log("[usePlanExecution] Cached plan record:",R)},E=()=>Array.from(s.value),k=R=>{if(!R){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(R),l.set(R,0),i.set(R,0),console.log("[usePlanExecution] Tracking plan:",R),r.value||v(),w(R).catch(U=>{console.error(`[usePlanExecution] Initial poll failed for ${R}:`,U)})},d=R=>{s.value.delete(R),l.delete(R),i.delete(R),console.log("[usePlanExecution] Untracking plan:",R),s.value.size===0&&a.size===0&&I()},w=async R=>{if(R)try{console.log("[usePlanExecution] Polling plan status for:",R);const U=await Dt.getDetails(R);if(console.log("[usePlanExecution] Received plan details:",U?"YES":"NO",U),i.delete(R),!U){const _=i.get(R)||0;_<10?(i.set(R,_+1),console.log(`[usePlanExecution] Plan ${R} not found yet, retrying (${_+1}/10)`),setTimeout(()=>{s.value.has(R)&&w(R).catch(P=>{console.error(`[usePlanExecution] Retry poll failed for ${R}:`,P)})},1e3)):(console.warn(`[usePlanExecution] Plan ${R} not found after 10 attempts, giving up`),d(R));return}const x=l.get(R)||0;l.set(R,x+1);const q=U.rootPlanId||U.currentPlanId;if(!q){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",U);return}if(m.set(q,U),R!==q&&(m.set(R,U),console.log("[usePlanExecution] Stored record with both keys:",{planId:R,recordKey:q})),console.log("[usePlanExecution] Updated plan execution record:",{planId:R,recordKey:q,rootPlanId:U.rootPlanId,currentPlanId:U.currentPlanId,completed:U.completed,status:U.status,attempt:x+1}),U.completed){console.log(`[usePlanExecution] Plan ${q} completed, checking for summary...`);const _=yt();_.currentTask&&_.currentTask.isRunning&&(_.currentTask.isRunning=!1);const P=U.summary||U.result||U.message,$=a.get(q)||0;if(!P&&$<10)a.set(q,$+1),console.log(`[usePlanExecution] Plan ${q} completed but no summary yet, continuing to poll (${$+1}/10)`);else{console.log(`[usePlanExecution] Plan ${q} completed, cleaning up...`,{hasSummary:!!P,pollCount:$});try{await Dt.deleteExecutionDetails(q),console.log(`[usePlanExecution] Deleted execution details for plan: ${q}`)}catch(N){const j=N instanceof Error?N.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${j}`)}d(R),a.delete(q),setTimeout(()=>{m.delete(q),R!==q&&m.delete(R)},5e3)}}U.status==="failed"&&U.message&&!U.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${q} failed:`,U.message)}catch(U){const x=U instanceof Error?U.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${R}:`,x);const q=i.get(R)||0;q<10&&(i.set(R,q+1),console.log(`[usePlanExecution] Network error for ${R}, retrying (${q+1}/10)`),setTimeout(()=>{s.value.has(R)&&w(R).catch(_=>{console.error(`[usePlanExecution] Retry poll failed for ${R}:`,_)})},1e3*(q+1)))}},y=async()=>{if(b.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const R=new Set(s.value);for(const[U]of a.entries())R.add(U);if(R.size!==0)try{b.value=!0;const U=Array.from(R).map(x=>w(x));await Promise.all(U)}catch(U){console.error("[usePlanExecution] Failed to poll tracked plans:",U)}finally{b.value=!1}},v=()=>{r.value&&clearInterval(r.value),r.value=window.setInterval(()=>{y()},1e3),console.log("[usePlanExecution] Started adaptive polling")},I=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}r.value&&(clearInterval(r.value),r.value=null),console.log("[usePlanExecution] Stopped polling")},O=async R=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${R}`),await w(R)},W=R=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:R}),!R){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}yt().setTaskRunning(R),k(R)},T=()=>{I(),s.value.clear(),a.clear(),l.clear(),i.clear(),m.clear(),b.value=!1};return{planExecutionRecords:Ue(m),trackedPlanIds:Ue(s),isPolling:Ue(b),getPlanExecutionRecord:c,setCachedPlanRecord:f,getTrackedPlanIds:E,trackPlan:k,untrackPlan:d,handlePlanExecutionRequested:W,pollPlanStatusImmediately:O,startPolling:v,stopPolling:I,cleanup:T}}let Et=null;function et(){return Et||(Et=Ra()),Et}function xa(){const o=et(),t=M([]),e=M(null),s=M(null),a=M(null),l=se(()=>c.value?.planId||null),i=M(!1),m=M(null),b=M(null),r=M(null),c=se(()=>e.value&&t.value.find(B=>B.id===e.value)||null),f=se(()=>t.value.length>0),E=se(()=>t.value.length),k=se(()=>{if(!s.value)return c.value?.messages||[];const B=[];for(const H of t.value)H.conversationId===s.value&&B.push(...H.messages);return B.sort((H,z)=>H.timestamp.getTime()-z.timestamp.getTime())}),d=B=>{const H={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:B||"New Conversation",messages:[],...s.value&&{conversationId:s.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(H),e.value=H.id,console.log("[useMessageDialog] Created new dialog round:",H.id,{conversationId:s.value,planId:H.planId}),H},w=B=>t.value.find(H=>H.id===B)||null,y=B=>{if(t.value.forEach(H=>{H.isActive=!1}),B){const H=t.value.find(z=>z.id===B);H&&(H.isActive=!0,e.value=B)}else e.value=null},v=(B,H)=>{const z=t.value.find(Y=>Y.id===B);z&&(z.messages.push(H),z.updatedAt=new Date)},I=(B,H,z)=>{const Y=t.value.find(ne=>ne.id===B);if(Y){const ne=Y.messages.findIndex(re=>re.id===H);ne!==-1&&(Y.messages[ne]={...Y.messages[ne],...z},Y.updatedAt=new Date)}},O=B=>{const H=t.value.findIndex(z=>z.id===B);if(H!==-1){const z=t.value[H];if(t.value.splice(H,1),console.log("[useMessageDialog] Deleted dialog round:",B),e.value===B){const Y=t.value.filter(ne=>ne.conversationId===z.conversationId);e.value=Y.length>0?Y[0].id:null,e.value&&y(e.value)}}},W=B=>{const H=t.value.filter(z=>z.planId===B);H.forEach(z=>{O(z.id)}),console.log(`[useMessageDialog] Deleted ${H.length} dialog round(s) for plan:`,B)},T=B=>{const H=t.value.filter(z=>z.conversationId===B);H.forEach(z=>{O(z.id)}),console.log(`[useMessageDialog] Deleted ${H.length} dialog round(s) for conversation:`,B),s.value===B&&(s.value=null)},R=()=>{t.value=[],e.value=null},U=async B=>{let H=null,z=null;try{if(i.value){const he="Please wait for the current task to complete before starting a new one";return m.value=he,{success:!1,error:he}}i.value=!0,m.value=null,H=d();const Y={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:B.input,timestamp:new Date,isStreaming:!1,...B.uploadedFiles&&{attachments:B.uploadedFiles.map(he=>typeof he=="string"?new File([],he):he)}};v(H.id,Y),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},v(H.id,z);const ne=B;let re;if(ne.toolName&&ne.replacementParams?re=await Jt.executeByToolName(ne.toolName,ne.replacementParams,B.uploadedFiles,B.uploadKey,"VUE_DIALOG"):re=await Jt.sendMessageWithDefaultPlan(B,"VUE_DIALOG"),re.conversationId&&(s.value=re.conversationId,H.conversationId=re.conversationId,Ce.setConversationId(re.conversationId),console.log("[useMessageDialog] Conversation ID set:",re.conversationId)),re.planId){const he=re.planId;H.planId=he,I(H.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:he,rootPlanId:he,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(he),console.log("[useMessageDialog] Root plan ID set and tracking started:",he)}else{const he={content:re.message||re.result||"No response received",isStreaming:!1};I(H.id,z.id,he)}return{success:!0,...re.planId&&{planId:re.planId},...re.conversationId&&{conversationId:re.conversationId}}}catch(Y){const ne=Y instanceof Error?Y.message:"Failed to send message";return m.value=ne,console.error("[useMessageDialog] Send message failed:",Y),H&&z&&I(H.id,z.id,{content:`Error: ${ne}`,error:ne,isStreaming:!1}),{success:!1,error:ne}}finally{i.value=!1}},x=async B=>{let H=null,z=null;try{if(i.value){const D="Please wait for the current task to complete before starting a new one";return m.value=D,{success:!1,error:D}}i.value=!0,m.value=null;const Y=Ce.getConversationId();Y&&!s.value&&(s.value=Y,console.log("[useMessageDialog] Restored conversationId from memoryStore:",Y)),H=d(B.title),B.title&&(H.title=B.title);const ne={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:B.title,timestamp:new Date,isStreaming:!1,...B.uploadedFiles&&{attachments:B.uploadedFiles.map(D=>typeof D=="string"?new File([],D):D)}};v(H.id,ne),z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},v(H.id,z);const re=B.planData.planTemplateId;if(!re||re===null)throw new Error("Plan template ID is required");const he=await ro.executePlan(re,B.params,B.uploadedFiles,B.replacementParams,B.uploadKey??void 0,"VUE_SIDEBAR");if(he.conversationId){const D=he.conversationId,K=s.value||Ce.getConversationId();D!==K?(console.log("[useMessageDialog] Conversation ID changed:",K,"->",D),s.value=D,H.conversationId=D,Ce.setConversationId(D)):(H.conversationId=D,console.log("[useMessageDialog] Conversation ID unchanged:",D))}else s.value&&(H.conversationId=s.value);if(he.planId){const D=he.planId;H.planId=D,I(H.id,z.id,{thinking:"Planning execution...",planExecution:{currentPlanId:D,rootPlanId:D,status:"running"},isStreaming:!1}),o.handlePlanExecutionRequested(D),console.log("[useMessageDialog] Root plan ID set and tracking started:",D)}else{const D={content:"Plan execution started",isStreaming:!1};I(H.id,z.id,D)}return{success:!0,...he.planId&&{planId:he.planId}}}catch(Y){const ne=Y instanceof Error?Y.message:"Failed to execute plan";return m.value=ne,console.error("[useMessageDialog] Execute plan failed:",Y),H&&z&&I(H.id,z.id,{content:`Error: ${ne}`,error:ne,isStreaming:!1}),i.value=!1,{success:!1,error:ne}}},q=(B,H,z)=>{const Y={};z!==void 0&&(Y.planExecution=z),I(B,H,Y)},_=B=>{const H={...B};return"agentExecutionSequence"in B&&Array.isArray(B.agentExecutionSequence)&&(H.agentExecutionSequence=B.agentExecutionSequence.map(z=>P(z))),H},P=B=>{const H={...B};return"subPlanExecutionRecords"in B&&Array.isArray(B.subPlanExecutionRecords)&&(H.subPlanExecutionRecords=B.subPlanExecutionRecords.map(z=>_(z))),H},$=(B,H,z)=>{c.value||d();const Y=c.value,ne={...z};z?.planExecution&&(ne.planExecution=_(z.planExecution));const re={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:B,content:H,timestamp:new Date,isStreaming:!1,...ne};return Y.messages.push(re),Y.updatedAt=new Date,re},N=(B,H)=>{if(!c.value)return;const z={...H};H.planExecution&&(z.planExecution=_(H.planExecution));const Y=c.value.messages.findIndex(ne=>ne.id===B);Y!==-1&&(c.value.messages[Y]={...c.value.messages[Y],...z},c.value.updatedAt=new Date)},j=B=>{if(c.value)return c.value.messages.find(H=>H.id===B)},Q=B=>{b.value=B,N(B,{isStreaming:!0})},me=B=>{B&&N(B,{isStreaming:!1}),(b.value===B||!B)&&(b.value=null)},Ie=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,b.value=null)},be=(B,H)=>{i.value=!B,H!==void 0&&(r.value=H),console.log("[useMessageDialog] Input state updated:",{enabled:B,placeholder:H,isLoading:i.value})},Pe=B=>{s.value=B,console.log("[useMessageDialog] Set conversationId:",B)},qe=()=>{t.value=[],e.value=null,a.value=null,s.value=null,i.value=!1,m.value=null,r.value=null},$e=(B,H,z)=>{const Y={planExecution:_(z),isStreaming:!z.completed};if(!z.completed)Y.thinking="Processing...";else{if(!z.agentExecutionSequence||z.agentExecutionSequence.length===0){const ne=z.summary??z.result??z.message??"Execution completed";ne&&(Y.content=ne,Y.thinking="")}else z.summary&&(Y.content=z.summary,Y.thinking="");z.status==="failed"&&z.message&&(Y.content=`Error: ${z.message}`,Y.thinking="")}I(B.id,H.id,Y)};return gs(()=>{const B=o.planExecutionRecords,H=B.size,z=Array.from(B.entries()),Y=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",z.length,"size:",H),console.log("[useMessageDialog] watchEffect - dialogList count:",Y.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",Y.filter(D=>D.planId).map(D=>({id:D.id,planId:D.planId})));for(const D of Y){const K=D.messages.filter(te=>te.type==="assistant"&&te.planExecution?.rootPlanId),J=D.planId||K[0]?.planExecution?.rootPlanId;if(!J)continue;let L=z.find(([te])=>te===J);if(!L){const te=new Set;for(const ge of K)ge.planExecution?.rootPlanId&&te.add(ge.planExecution.rootPlanId),ge.planExecution?.currentPlanId&&te.add(ge.planExecution.currentPlanId);te.add(J);for(const[ge,He]of z){const Ve=He.rootPlanId,dt=He.currentPlanId;if(ge===J||Ve===J||dt===J||te.has(ge)||te.has(Ve||"")||te.has(dt||"")){L=[ge,He];break}}}if(!L){const te=K.find(ge=>ge.planExecution?.rootPlanId===J||ge.planExecution?.currentPlanId===J);if(te){!D.planId&&te.planExecution?.rootPlanId&&(D.planId=te.planExecution.rootPlanId,console.log("[useMessageDialog] watchEffect: Set dialog.planId from message planExecution:",{dialogId:D.id,planId:te.planExecution.rootPlanId})),D.planId&&console.log("[useMessageDialog] watchEffect: Record not found yet for planId (showing initial state):",J,{dialogId:D.id,availableRecordKeys:z.map(([ge])=>ge),trackedPlanIds:Array.from(o.trackedPlanIds.value),messageHasPlanExecution:!0});continue}else continue}const[,ee]=L,Z=_(ee),pe=K.find(te=>{const ge=te.planExecution?.rootPlanId,He=te.planExecution?.currentPlanId;return ge===J||He===J||ge===Z.rootPlanId||He===Z.currentPlanId||ge===Z.currentPlanId||He===Z.rootPlanId});if(!pe){console.log("[useMessageDialog] watchEffect: No message found for planId:",J,{dialogId:D.id,dialogPlanId:D.planId,dialogMessages:D.messages.map(te=>({id:te.id,type:te.type,planExecutionRootPlanId:te.planExecution?.rootPlanId,planExecutionCurrentPlanId:te.planExecution?.currentPlanId,hasPlanExecution:!!te.planExecution}))});continue}!D.planId&&Z.rootPlanId&&(D.planId=Z.rootPlanId,console.log("[useMessageDialog] watchEffect: Set dialog.planId from record:",{dialogId:D.id,planId:Z.rootPlanId})),console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:D.id,messageId:pe.id,planId:J,recordRootPlanId:Z.rootPlanId,recordCurrentPlanId:Z.currentPlanId,recordCompleted:Z.completed,recordStatus:Z.status}),$e(D,pe,Z)}const ne=o.trackedPlanIds.value.size>0,re=z.some(([,D])=>D&&!D.completed&&D.status!=="failed");!(ne||re)&&i.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:ne,hasRunningPlansInRecords:re,trackedPlanIds:Array.from(o.trackedPlanIds.value),recordsCount:z.length}),i.value=!1)}),{dialogList:Ue(t),activeDialogId:Ue(e),rootPlanId:Ue(a),conversationId:Ue(s),isLoading:i,error:m,streamingMessageId:Ue(b),inputPlaceholder:Ue(r),activeDialog:c,activeRootPlanId:l,hasDialogs:f,dialogCount:E,messages:k,createDialog:d,getDialog:w,setActiveDialog:y,addMessageToDialog:v,updateMessageInDialog:I,deleteDialog:O,deleteConversationRoundByPlanId:W,deleteConversation:T,clearAllDialogs:R,sendMessage:U,executePlan:x,updatePlanExecutionStatus:q,updateInputState:be,setConversationId:Pe,reset:qe,addMessage:$,updateMessage:N,findMessage:j,startStreaming:Q,stopStreaming:me,clearMessages:Ie}}let kt=null;function tt(){return kt||(kt=xa()),kt}function Aa(o){const t=M(!1),e=M(!0),s=150,a=async(y=!0)=>{o.value&&(await Ae(),o.value.scrollTo({top:o.value.scrollHeight,behavior:y?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:y,scrollHeight:v,clientHeight:I}=o.value;return v-y-I<s},i=()=>{if(!o.value)return;const y=l();t.value=!y&&o.value.scrollHeight>o.value.clientHeight,y&&(e.value=!0)},m=()=>{i(),l()||(e.value=!1)},b=async()=>{e.value&&await a()},r=async()=>{e.value=!0,await a()},c=(y,v=!0)=>{if(!o.value)return;const I=o.value.querySelector(`[data-message-id="${y}"]`);I&&I.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},f=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:y,scrollHeight:v,clientHeight:I}=o.value,O=y===0,W=y+I>=v-5,T=v>I?y/(v-I)*100:100;return{scrollTop:y,scrollHeight:v,clientHeight:I,isAtTop:O,isAtBottom:W,scrollPercentage:T}},E=()=>{o.value&&o.value.addEventListener("scroll",m,{passive:!0})},k=()=>{o.value&&o.value.removeEventListener("scroll",m)},d=()=>{E(),i()},w=()=>{k()};return De(()=>{Ae(()=>{d()})}),Le(()=>{w()}),{showScrollToBottom:Ue(t),isAutoScrollEnabled:Ue(e),scrollToBottom:a,autoScrollToBottom:b,forceScrollToBottom:r,scrollToMessage:c,isNearBottom:l,checkScrollPosition:i,getScrollInfo:f,addScrollListener:E,removeScrollListener:k,initializeScrollBehavior:d,cleanupScrollBehavior:w}}const Ma={class:"chat-container"},Fa=["data-message-id"],Da={class:"user-content"},Na={class:"message-text"},Ua={key:0,class:"attachments"},La={class:"attachment-name"},Oa={class:"attachment-size"},Ba={class:"message-timestamp"},qa={key:0,class:"message-status error"},Ha={class:"status-text"},Va={key:1,class:"assistant-message"},ja={key:0,class:"loading-message"},za={class:"loading-content"},Wa=["title"],Ga=Te({__name:"ChatContainer",emits:["step-selected"],setup(o,{emit:t}){const e=t,{t:s}=Ne(),a=tt(),{messages:l,isLoading:i,streamingMessageId:m,updateMessage:b,startStreaming:r,findMessage:c}=a,f=M(null),{scrollToBottom:E,autoScrollToBottom:k,showScrollToBottom:d}=Aa(f),{getMessageClasses:w,formatTimestamp:y,formatFileSize:v}=ws(),I=_=>m.value===_,O=se(()=>l.value),W=_=>{const P=_.target;if(P.classList.contains("md-copy-btn")){const $=P.getAttribute("data-raw");if($){const N=decodeURIComponent($);navigator.clipboard.writeText(N).then(()=>{P.textContent=s("chat.copied"),setTimeout(()=>{P.textContent=s("chat.copy")},1e3)})}}},T=async _=>{const P=c(_);if(P)try{const $=P.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText($)}catch($){console.error("Failed to copy message:",$)}},R=_=>{const P=c(_);P&&P.type==="assistant"&&(b(_,{content:""}),r(_),console.warn("[ChatContainer] Regenerate not yet implemented"))},U=_=>{c(_)&&(b(_,{content:""}),r(_),console.warn("[ChatContainer] Retry not yet implemented"))},x=_=>{console.log("[ChatContainer] Step selected:",_),e("step-selected",_)},q=(_,P)=>{console.log("[ChatContainer] User input submitted:",P,"for message:",_.id),console.warn("[ChatContainer] User input submission not yet implemented")};return De(()=>{ve(l,()=>{Ae(()=>{k()})},{deep:!0})}),Le(()=>{}),(_,P)=>(h(),g("div",Ma,[n("div",{class:"messages",ref_key:"messagesRef",ref:f,onClick:W},[(h(!0),g(de,null,fe(O.value,$=>(h(),g("div",{key:$.id,class:ue(["chat-message",[p(w)($),{streaming:I($.id)}]])},[$.type==="user"?(h(),g("div",{key:0,class:"user-message","data-message-id":$.id},[n("div",Da,[n("div",Na,u($.content),1),$.attachments?.length?(h(),g("div",Ua,[(h(!0),g(de,null,fe($.attachments,(N,j)=>(h(),g("div",{key:j,class:"attachment-item"},[A(p(F),{icon:"carbon:document",class:"attachment-icon"}),n("span",La,u(N.name),1),n("span",Oa,u(p(v)(N.size)),1)]))),128))])):V("",!0),n("div",Ba,u(p(y)($.timestamp)),1)]),$.error?(h(),g("div",qa,[A(p(F),{icon:"carbon:warning",class:"status-icon"}),n("span",Ha,u($.error),1)])):V("",!0)],8,Fa)):$.type==="assistant"?(h(),g("div",Va,[$.planExecution?(h(),we(Nn,{key:0,"plan-execution":$.planExecution,"step-actions":$.stepActions||[],"generic-input":$.genericInput||"",onStepSelected:x},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),$.content||$.error||I($.id)||$.planExecution?.userInputWaitState?.waiting?(h(),we(Ia,vs({key:1,content:$.content||"","is-streaming":I($.id)||!1},{ref_for:!0},{...$.error?{error:$.error}:{},...$.planExecution?.userInputWaitState?{userInputWaitState:$.planExecution.userInputWaitState}:{},...$.planExecution?.currentPlanId?{planId:$.planExecution.currentPlanId}:{}},{timestamp:$.timestamp,"generic-input":$.genericInput||"",onCopy:()=>T($.id),onRegenerate:()=>R($.id),onRetry:()=>U($.id),onUserInputSubmitted:N=>q($,N)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):V("",!0)])):V("",!0)],2))),128)),p(i)?(h(),g("div",ja,[n("div",za,[A(p(F),{icon:"carbon:circle-dash",class:"loading-icon"}),n("span",null,u(_.$t("chat.processing")),1)])])):V("",!0)],512),A(qt,{name:"scroll-button"},{default:Ye(()=>[p(d)?(h(),g("button",{key:0,class:"scroll-to-bottom",onClick:P[0]||(P[0]=()=>p(E)()),title:_.$t("chat.scrollToBottom")},[A(p(F),{icon:"carbon:chevron-down"})],8,Wa)):V("",!0)]),_:1})]))}}),Ka=Ee(Ga,[["__scopeId","data-v-9504dbce"]]);class Xt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const Ja={class:"file-upload-component"},Xa=["accept"],Ya={key:0},Qa={key:1},Za={key:0,class:"files-list"},el={class:"file-name"},tl={class:"file-size"},sl=["onClick","title"],ol={key:0,class:"upload-progress"},nl=Te({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:t,emit:e}){const{t:s}=Ne(),a=o,l=e,i=M(),m=M([]),b=M(!1),r=M(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),m.value=[],r.value=null,l("upload-key-changed",null)};Le(()=>{c()}),ve(()=>m.value,y=>{l("files-removed",y)},{deep:!0});const f=()=>{a.disabled||i.value&&i.value.click()},E=async y=>{const v=y.target,I=v.files;if(!I||I.length===0)return;const O=Array.from(I);console.log("[FileUpload] Selected files for upload:",O.map(W=>W.name)),await k(O),v.value=""},k=async y=>{if(y.length!==0){b.value=!0,l("upload-started");try{const v=await Xt.uploadFiles(y);v.success&&(!r.value&&v.uploadKey?(r.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",r.value),m.value=v.uploadedFiles):r.value?(console.log("[FileUpload] Using existing uploadKey:",r.value),m.value=[...m.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),m.value=v.uploadedFiles),v.uploadKey&&(r.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",r.value)),console.log("[Input] Updated global uploadedFiles state:",m.value),l("files-uploaded",m.value,r.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{b.value=!1}}},d=async y=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",y.originalName,"from uploadKey:",r),r.value){const v=await Xt.deleteFile(r.value,y.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}m.value=m.value.filter(v=>v.originalName!==y.originalName),m.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),r.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",m.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},w=y=>{if(y===0)return"0 Bytes";const v=1024,I=["Bytes","KB","MB","GB"],O=Math.floor(Math.log(y)/Math.log(v));return parseFloat((y/Math.pow(v,O)).toFixed(2))+" "+I[O]};return t({uploadedFiles:m,uploadKey:r,resetSession:c,uploadFiles:k,removeFile:d,isUploading:b}),(y,v)=>(h(),g("div",Ja,[n("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:y.acceptedFileTypes||""},null,40,Xa),n("div",{class:ue(["uploaded-files",{"has-files":m.value.length>0}])},[n("div",{class:"files-header",onClick:f},[A(p(F),{icon:"carbon:attachment"}),m.value.length===0?(h(),g("span",Ya,u(p(s)("input.attachFile")),1)):(h(),g("span",Qa,u(p(s)("input.attachedFiles"))+" ("+u(m.value.length)+")",1))]),m.value.length>0?(h(),g("div",Za,[(h(!0),g(de,null,fe(m.value,I=>(h(),g("div",{key:I.originalName,class:"file-item"},[A(p(F),{icon:"carbon:document",class:"file-icon"}),n("span",el,u(I.originalName),1),n("span",tl,"("+u(w(I.size))+")",1),n("button",{onClick:O=>d(I),class:"remove-btn",title:p(s)("input.removeFile")},[A(p(F),{icon:"carbon:close"})],8,sl)]))),128))])):V("",!0)],2),b.value?(h(),g("div",ol,[A(p(F),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),n("span",null,u(p(s)("input.uploading")),1)])):V("",!0)]))}}),$s=Ee(nl,[["__scopeId","data-v-a97ebade"]]),al={class:"input-area"},ll={class:"input-container"},rl={class:"input-row-first"},il=["placeholder","disabled"],cl={class:"input-row-second"},ul=["title","disabled"],dl={value:""},pl=["value"],ml=["title"],hl=["disabled","title"],fl=["title"],Yt="chatInputHistory",Qt=20,vl=Te({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(o,{expose:t}){const{t:e}=Ne(),s=yt(),a=Ze(),l=tt(),i=et(),m=se(()=>s.hasRunningTask()),b=o,r=M(),c=M(),f=M(""),E=se(()=>e("input.placeholder")),k=M(null),d=se(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:k.value?k.value:E.value),w=M([]),y=M(null),v=M(""),I=M([]),O=M(!1),W=M(!1),T=M([]),R=M(-1),U=M(""),x=se(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),q=async()=>{O.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const L=a.getAllCoordinatorToolsFromTemplates(),ee=[];for(const pe of L)if(pe.enableInternalToolcall)try{const te=JSON.parse(pe.inputSchema||"[]");if(Array.isArray(te)&&te.length===1){const ge=te[0];ee.push({value:pe.planTemplateId,label:`${pe.toolName} (${ge.name})`,toolName:pe.toolName,planTemplateId:pe.planTemplateId,paramName:ge.name})}}catch(te){console.warn("[InputArea] Failed to parse inputSchema for tool:",pe.toolName,te)}I.value=ee,console.log("[InputArea] Loaded",ee.length,"inner tools with single parameter");const Z=localStorage.getItem("inputAreaSelectedTool");if(Z){if(ee.length>0)if(ee.some(te=>te.value===Z)){W.value=!0;try{v.value=Z,console.log("[InputArea] Restored selected tool from localStorage:",Z)}finally{W.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),v.value===Z&&(v.value="");else if(v.value!==Z){W.value=!0;try{v.value=Z,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",Z)}finally{W.value=!1}}}}catch(L){console.error("[InputArea] Failed to load inner tools:",L),I.value=[]}finally{O.value=!1}},_=se(()=>I.value.length>0?I.value.map(L=>({value:L.value,label:L.label})):b.selectionOptions);ve(v,L=>{W.value||localStorage.setItem("inputAreaSelectedTool",L||"")});const P=()=>{try{const L=localStorage.getItem(Yt);L&&(T.value=JSON.parse(L))}catch(L){console.error("[InputArea] Failed to load history:",L),T.value=[]}},$=()=>{try{localStorage.setItem(Yt,JSON.stringify(T.value))}catch(L){console.error("[InputArea] Failed to save history:",L)}},N=L=>{if(!L.trim())return;const ee=T.value.indexOf(L);ee!==-1&&T.value.splice(ee,1),T.value.unshift(L),T.value.length>Qt&&(T.value=T.value.slice(0,Qt)),$()},j=L=>{if(T.value.length===0)return;R.value===-1&&(U.value=f.value);let ee=R.value+L;ee<-1?ee=-1:ee>=T.value.length&&(ee=T.value.length-1),R.value=ee,R.value===-1?(f.value=U.value,U.value=""):f.value=T.value[R.value],H()};ve(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),q()},{deep:!0}),De(()=>{q(),P(),ve(()=>i.planExecutionRecords,L=>{const ee=Array.from(L.entries());if(ee.length===0)return;ee.some(([,pe])=>pe&&!pe.completed&&pe.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),Q())},{deep:!0}),ve(()=>s.taskToInput,L=>{L?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",L),Ae(()=>{K(L.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const Q=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),c.value?.resetSession()};Le(()=>{Q()});const me=(L,ee)=>{w.value=L.map(Z=>Z.originalName),y.value=ee,console.log("[InputArea] Files uploaded:",L.length,"uploadKey:",ee),w.value.length>0&&(k.value=e("input.filesAttached",{count:w.value.length}))},Ie=L=>{w.value=L.map(ee=>ee.originalName),console.log("[InputArea] Files removed, remaining:",L.length),w.value.length===0?k.value=null:k.value=e("input.filesAttached",{count:w.value.length})},be=L=>{y.value=L,console.log("[InputArea] Upload key changed:",L)},Pe=()=>{console.log("[InputArea] Upload started")},qe=()=>{console.log("[InputArea] Upload completed")},$e=L=>{console.error("[InputArea] Upload error:",L)},B=se(()=>l.isLoading.value),H=()=>{Ae(()=>{r.value&&(r.value.style.height="auto",r.value.style.height=Math.min(r.value.scrollHeight,120)+"px")})},z=L=>{if(L.key==="Enter"&&(L.ctrlKey||L.metaKey)){L.preventDefault(),Y();return}const ee=x.value?L.altKey:L.ctrlKey;if(L.key==="ArrowUp"&&ee){L.preventDefault(),j(1);return}if(L.key==="ArrowDown"&&ee){L.preventDefault(),j(-1);return}R.value!==-1&&L.key.length===1&&!L.ctrlKey&&!L.metaKey&&!L.altKey&&(R.value=-1,U.value="")},Y=async()=>{if(!f.value.trim()||B.value)return;const L=f.value.trim();N(L),R.value=-1,U.value="";const ee={input:L,memoryId:Ce.selectMemoryId,uploadedFiles:w.value};if(y.value?(ee.uploadKey=y.value,console.log("[InputArea] Including uploadKey in message:",y.value)):console.log("[InputArea] No uploadKey available for message"),v.value){const Z=I.value.find(pe=>pe.value===v.value);if(Z){const pe=ee;pe.toolName=Z.planTemplateId,pe.replacementParams={[Z.paramName]:L},console.log("[InputArea] Sending message with tool:",Z.toolName)}}try{await l.sendMessage(ee)}catch(Z){const pe=Z instanceof Error?Z.message:String(Z);console.error("[InputArea] Send message failed:",pe)}he()},ne=()=>{xe.toggleSidebar(),console.log("[InputArea] Plan mode button clicked, sidebar toggled, isCollapsed:",xe.isCollapsed)},re=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},he=()=>{f.value="",H()},D=(L,ee)=>{l.updateInputState(L,ee)},K=L=>{f.value=L,H()},J=()=>f.value.trim();return ve(()=>b.initialValue,L=>{L.trim()&&(f.value=L,H())},{immediate:!0}),t({clearInput:he,updateState:D,getQuery:J,focus:()=>r.value?.focus(),get uploadedFiles(){return c.value?.uploadedFiles?.map(L=>L.originalName)||[]},get uploadKey(){return c.value?.uploadKey||null}}),(L,ee)=>(h(),g("div",al,[A($s,{ref_key:"fileUploadRef",ref:c,disabled:B.value,onFilesUploaded:me,onFilesRemoved:Ie,onUploadKeyChanged:be,onUploadStarted:Pe,onUploadCompleted:qe,onUploadError:$e},null,8,["disabled"]),n("div",ll,[n("div",rl,[ye(n("textarea",{"onUpdate:modelValue":ee[0]||(ee[0]=Z=>f.value=Z),ref_key:"inputRef",ref:r,class:"chat-input",placeholder:d.value,disabled:B.value,onKeydown:z,onInput:H},null,40,il),[[ke,f.value]])]),n("div",cl,[ye(n("select",{"onUpdate:modelValue":ee[1]||(ee[1]=Z=>v.value=Z),class:"selection-input",title:L.$t("input.selectionTitle"),disabled:O.value||B.value},[n("option",dl,u(L.$t("input.defaultFuncAgent")),1),(h(!0),g(de,null,fe(_.value,Z=>(h(),g("option",{key:Z.value,value:Z.value},u(Z.label),9,pl))),128))],8,ul),[[Bt,v.value]]),n("button",{class:"plan-mode-btn",title:L.$t("input.planMode"),onClick:ne},[A(p(F),{icon:"carbon:document"}),ce(" "+u(L.$t("input.planMode")),1)],8,ml),m.value?(h(),g("button",{key:1,class:"send-button stop-button",onClick:re,title:L.$t("input.stop")},[A(p(F),{icon:"carbon:stop-filled"}),ce(" "+u(L.$t("input.stop")),1)],8,fl)):(h(),g("button",{key:0,class:"send-button",disabled:!f.value.trim()||B.value,onClick:Y,title:L.$t("input.send")},[A(p(F),{icon:"carbon:send-alt"}),ce(" "+u(L.$t("input.send")),1)],8,hl))])])]))}}),gl=Ee(vl,[["__scopeId","data-v-f6666260"]]);class ht{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const yl={key:0,class:"app-container"},bl={class:"app-content"},_l={class:"header"},wl={class:"relative"},$l={class:"title-edit-group"},Sl={id:"main-title",class:"main-title"},Pl={key:0,id:"title-edit-container",class:"title-edit-container"},Tl={class:"search-bar"},El={class:"search-container"},kl=["placeholder"],Cl={class:"message-list",id:"message-list"},Il={class:"message-header"},Rl={class:"message-content"},xl={class:"sender-info"},Al=["onClick"],Ml={class:"sender-name"},Fl={class:"action-buttons"},Dl=["onClick"],Nl={class:"action-buttons"},Ul=["onClick"],Ll={class:"message-meta"},Ol={class:"message-id"},Bl={class:"meta-right"},ql={key:0,class:"unread-count"},Hl={class:"message-time"},Vl=["id"],jl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},zl={class:"bubble-avatar"},Wl={class:"bubble-content"},Gl={class:"bubble-text"},Kl={key:0,class:"empty-state"},Jl={class:"modal-content"},Xl={class:"modal-header"},Yl={class:"modal-title"},Ql=["placeholder"],Zl={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},er={class:"modal-footer"},tr={class:"modal-content"},sr={class:"modal-header"},or={class:"modal-title"},nr={class:"state-text",id:"delete-message"},ar={class:"modal-footer"},lr=Te({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(o,{emit:t}){const e=M(!1),s=M(""),a=M([]),l=M([]),i=M(!1),m=M(null),b=M(""),r=M(!1),c=M(null),f=new Map,E=t,k=x=>{x.key==="Escape"&&(r.value?R():i.value&&I())};De(()=>{Ce.setLoadMessages(d),document.addEventListener("keydown",k)}),Le(()=>{document.removeEventListener("keydown",k)});const d=async()=>{try{const x=await ht.getMemories();a.value=x.map(q=>({...q,expanded:f.has(q.conversation_id)?f.get(q.conversation_id):!1})),l.value=[...a.value],v()}catch(x){console.error("error:",x),a.value=[],l.value=[]}},w=x=>{Ce.selectMemory(x),E("memory-selected")},y=x=>{const q=typeof x=="string"?parseInt(x,10):x;return isNaN(q)||q<=0?"--":new Date(q.toString().length===13?q:q*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const x=s.value.toLowerCase().trim();if(!x){l.value=[...a.value];return}l.value=a.value.filter(q=>{const _=q.memory_name.toLowerCase().includes(x),P=q.conversation_id.toLowerCase().includes(x),$=q.messages?.some(N=>N.text.toLowerCase().includes(x))??!1;return _||P||$})},I=()=>{i.value=!1,m.value=null},O=async()=>{if(!m.value)return;const x=b.value.trim()||"unknow name",q=a.value.findIndex(_=>_.conversation_id===m.value);if(q!==-1){const _=a.value[q];try{const P=await ht.updateMemory(_.conversation_id,x);P.messages||(P.messages=[]),a.value[q]={...P,expanded:_.expanded},v(),i.value=!1}catch(P){console.error("error:",P)}}},W=x=>{const q=a.value.find(_=>_.conversation_id===x);if(q){q.expanded=!q.expanded,f.set(x,q.expanded);const _=l.value.findIndex(P=>P.conversation_id===x);_!==-1&&(l.value[_]={...q})}},T=x=>{c.value=x,r.value=!0},R=()=>{r.value=!1,c.value=null},U=async()=>{if(c.value)try{await ht.deleteMemory(c.value),a.value=a.value.filter(x=>x.conversation_id!==c.value),v(),a.value.length===0&&Ce.clearMemoryId(),r.value=!1,c.value=null}catch(x){console.error("error:",x)}};return(x,q)=>(h(),we(oo,{to:"body"},[A(qt,{name:"modal"},{default:Ye(()=>[p(Ce).isCollapsed?(h(),g("div",yl,[n("div",bl,[n("div",_l,[n("div",wl,[n("div",$l,[n("h1",Sl,[n("span",null,u(x.$t("memory.title")),1)])]),e.value?(h(),g("div",Pl)):V("",!0)]),n("button",{class:"close-btn",onClick:q[0]||(q[0]=_=>p(Ce).toggleSidebar())},[A(p(F),{icon:"carbon:close"})])]),n("div",Tl,[n("div",El,[A(p(F),{class:"search-container-icon",icon:"carbon:search"}),ye(n("input",{type:"text",placeholder:x.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":q[1]||(q[1]=_=>s.value=_),onInput:v},null,40,kl),[[ke,s.value]])])]),n("div",Cl,[n("div",null,[(h(!0),g(de,null,fe(l.value,_=>(h(),g("div",{class:ue(["message-item",{expanded:_.expanded}]),key:_.conversation_id},[n("div",Il,[n("div",Rl,[n("div",xl,[n("div",{class:"sender-div",onClick:_e(P=>w(_.conversation_id),["stop"])},[n("h3",Ml,u(_.memory_name),1)],8,Al),n("div",Fl,[n("button",{class:"delete-btn",onClick:_e(P=>W(_.conversation_id),["stop"])},[A(p(F),{id:"toggle-"+_.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Dl)]),n("div",Nl,[n("button",{class:"delete-btn",onClick:_e(P=>T(_.conversation_id),["stop"])},[A(p(F),{icon:"carbon:delete"})],8,Ul)])]),n("div",Ll,[n("span",Ol,"ID: "+u(_.conversation_id),1),n("div",Bl,[_.messages&&_.messages.length>0?(h(),g("span",ql,u(_.messages.length)+" "+u(x.$t("memory.size")),1)):V("",!0),n("span",Hl,u(y(_.create_time)),1)])])])]),_.expanded?(h(),g("div",{key:0,id:"content-"+_.conversation_id,class:"expanded-content"},[n("div",jl,[(h(!0),g(de,null,fe(_.messages,(P,$)=>(h(),g("div",{class:"message-bubble",key:$},[n("div",zl,u(P.messageType),1),n("div",Wl,[n("p",Gl,u(P.text),1)])]))),128))])],8,Vl)):V("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),g("div",Kl,q[3]||(q[3]=[n("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),i.value?(h(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:_e(I,["self"])},[n("div",Jl,[n("div",Xl,[n("h3",Yl,u(x.$t("memory.changeName")),1),ye(n("input",{type:"text","onUpdate:modelValue":q[2]||(q[2]=_=>b.value=_),class:"edit-input",placeholder:x.$t("memory.newNamePlaceholder")},null,8,Ql),[[ke,b.value]]),n("span",Zl,u(b.value.length),1)]),n("div",er,[n("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:I},u(x.$t("memory.cancel")),1),n("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:O},u(x.$t("memory.save")),1)])])])):V("",!0),r.value?(h(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:_e(R,["self"])},[n("div",tr,[n("div",sr,[n("h3",or,u(x.$t("memory.deleteHint")),1),n("p",nr,u(x.$t("memory.deleteHintPrefix"))+" "+u(c.value)+" "+u(x.$t("memory.deleteHintSuffix")),1)]),n("div",ar,[n("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:R},u(x.$t("memory.cancel")),1),n("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:U},u(x.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),rr=Ee(lr,[["__scopeId","data-v-16358835"]]);class Je{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),m=document.createElement("a");m.href=i,m.download=s??e.split("/").pop()??"download",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(i),document.body.removeChild(m)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(i=>t.startsWith(i)))return!0;const l=e.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const ir={class:"file-tree-node"},cr={class:"node-icon"},ur={class:"node-name"},dr={key:1,class:"file-size"},pr={key:2,class:"node-actions"},mr={key:0,class:"children"},hr=Te({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:t}){const e=o,s=t,a=M(e.level===0),l=M(!1),i=M(!1),m=M({}),b=()=>{e.node.type==="directory"&&(a.value=!a.value)},r=()=>{e.node.type==="directory"?b():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),k()},f=()=>{s("download-file",e.node),k()},E=v=>{v.preventDefault(),i.value=!0,m.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",k)},0)},k=()=>{i.value=!1,document.removeEventListener("click",k)},d=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(v){console.error("Failed to copy path:",v)}k()},w=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Je.getFileIcon(e.node),y=v=>{if(v===0)return"0 B";const I=1024,O=["B","KB","MB","GB"],W=Math.floor(Math.log(v)/Math.log(I));return parseFloat((v/Math.pow(I,W)).toFixed(1))+" "+O[W]};return Le(()=>{document.removeEventListener("click",k)}),(v,I)=>{const O=fs("FileTreeNode",!0);return h(),g("div",ir,[n("div",{class:ue(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Xe({paddingLeft:`${v.level*16+12}px`}),onClick:r,onContextmenu:_e(E,["prevent"])},[v.node.type==="directory"?(h(),g("div",{key:0,class:"expand-icon",onClick:_e(b,["stop"])},[A(p(F),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),n("div",cr,[A(p(F),{icon:w()},null,8,["icon"])]),n("span",ur,u(v.node.name),1),v.node.type==="file"?(h(),g("span",dr,u(y(v.node.size)),1)):V("",!0),l.value?(h(),g("div",pr,[v.node.type==="file"?(h(),g("button",{key:0,onClick:I[0]||(I[0]=_e(W=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(p(F),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(h(),g("div",mr,[(h(!0),g(de,null,fe(v.node.children,W=>(h(),we(O,{key:W.path,node:W,level:v.level+1,onFileSelected:I[1]||(I[1]=T=>v.$emit("file-selected",T)),onDownloadFile:I[2]||(I[2]=T=>v.$emit("download-file",T))},null,8,["node","level"]))),128))])):V("",!0),i.value?(h(),g("div",{key:1,class:"context-menu",style:Xe(m.value),onClick:I[3]||(I[3]=_e(()=>{},["stop"]))},[n("div",{class:"context-menu-item",onClick:c},[A(p(F),{icon:"carbon:view"}),I[4]||(I[4]=n("span",null,"Open",-1))]),v.node.type==="file"?(h(),g("div",{key:0,class:"context-menu-item",onClick:f},[A(p(F),{icon:"carbon:download"}),I[5]||(I[5]=n("span",null,"Download",-1))])):V("",!0),I[7]||(I[7]=n("div",{class:"context-menu-divider"},null,-1)),n("div",{class:"context-menu-item",onClick:d},[A(p(F),{icon:"carbon:copy"}),I[6]||(I[6]=n("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),fr=Ee(hr,[["__scopeId","data-v-3fc455d1"]]),vr={class:"file-browser"},gr={class:"file-browser-header"},yr={class:"header-actions"},br=["disabled","title"],_r={class:"file-browser-content"},wr={class:"file-tree-panel"},$r={key:0,class:"loading-state"},Sr={key:1,class:"error-state"},Pr={key:0,class:"waiting-for-files"},Tr={class:"message-content"},Er={class:"tips"},kr=["disabled"],Cr={key:1,class:"actual-error"},Ir={key:2,class:"empty-state"},Rr={key:3,class:"file-tree"},xr={key:0,class:"file-content-panel"},Ar={class:"file-content-header"},Mr={class:"file-info"},Fr={class:"file-name"},Dr={class:"file-size"},Nr={class:"file-actions"},Ur=["title"],Lr=["title"],Or={class:"file-content-body"},Br={key:0,class:"loading-content"},qr={key:1,class:"content-error"},Hr={key:2,class:"file-content"},Vr={key:0,class:"text-content"},jr={key:1,class:"binary-content"},zr=Te({name:"FileBrowser",__name:"index",props:{planId:{}},setup(o){const t=o,{t:e}=Ne(),s=M(!1),a=M(null),l=M(null),i=M(null),m=M(null),b=M(!1),r=M(null),c=M(null),f=se(()=>!m.value||!i.value?!1:Je.isTextFile(m.value.mimeType,i.value.name)),E=se(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),k=()=>{c.value&&(clearTimeout(c.value),c.value=null)},d=()=>{k(),c.value=window.setTimeout(()=>{E.value&&w()},5e3)},w=async()=>{if(t.planId){s.value=!0,a.value=null,k();try{l.value=await Je.getFileTree(t.planId)}catch(T){a.value=T instanceof Error?T.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",T);const R=T instanceof Error?T.message:"";(R.includes("Plan directory not found")||R.includes("not found"))&&d()}finally{s.value=!1}}},y=async T=>{if(T.type!=="directory"){i.value=T,m.value=null,b.value=!0,r.value=null;try{m.value=await Je.getFileContent(t.planId,T.path)}catch(R){r.value=R instanceof Error?R.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",R)}finally{b.value=!1}}},v=async T=>{try{await Je.downloadFile(t.planId,T.path,T.name)}catch(R){console.error("Failed to download file:",R)}},I=()=>{i.value=null,m.value=null,r.value=null},O=T=>Je.getFileIcon(T),W=T=>{if(T===0)return"0 B";const R=1024,U=["B","KB","MB","GB"],x=Math.floor(Math.log(T)/Math.log(R));return parseFloat((T/Math.pow(R,x)).toFixed(1))+" "+U[x]};return ve(()=>t.planId,T=>{T&&(i.value=null,m.value=null,w())},{immediate:!0}),De(()=>{t.planId&&w()}),Le(()=>{k()}),(T,R)=>(h(),g("div",vr,[n("div",gr,[n("h3",null,u(T.$t("fileBrowser.title")),1),n("div",yr,[n("button",{class:"refresh-btn",onClick:w,disabled:s.value,title:T.$t("fileBrowser.refresh")},[A(p(F),{icon:"carbon:refresh",class:ue({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,br)])]),n("div",_r,[n("div",wr,[s.value?(h(),g("div",$r,[A(p(F),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(T.$t("fileBrowser.loading")),1)])):a.value?(h(),g("div",Sr,[E.value?(h(),g("div",Pr,[A(p(F),{icon:"carbon:time",class:"rotating"}),n("div",Tr,[n("h3",null,u(T.$t("fileBrowser.waitingForGeneration")),1),n("p",null,u(T.$t("fileBrowser.planExecuting")),1),n("div",Er,[A(p(F),{icon:"carbon:information"}),n("span",null,u(T.$t("fileBrowser.filesTip")),1)])]),n("button",{onClick:w,class:"retry-btn",disabled:s.value},[A(p(F),{icon:"carbon:refresh",class:ue({rotating:s.value})},null,8,["class"]),ce(" "+u(s.value?T.$t("fileBrowser.checking"):T.$t("fileBrowser.checkNow")),1)],8,kr)])):(h(),g("div",Cr,[A(p(F),{icon:"carbon:warning"}),n("span",null,u(a.value),1),n("button",{onClick:w,class:"retry-btn"},u(T.$t("fileBrowser.retry")),1)]))])):l.value?(h(),g("div",Rr,[A(fr,{node:l.value,level:0,onFileSelected:y,onDownloadFile:v},null,8,["node"])])):(h(),g("div",Ir,[A(p(F),{icon:"carbon:folder-off"}),n("span",null,u(T.$t("fileBrowser.noFiles")),1)]))]),i.value?(h(),g("div",xr,[n("div",Ar,[n("div",Mr,[A(p(F),{icon:O(i.value)},null,8,["icon"]),n("span",Fr,u(i.value.name),1),n("span",Dr,"("+u(W(i.value.size))+")",1)]),n("div",Nr,[n("button",{onClick:R[0]||(R[0]=U=>v(i.value)),class:"download-btn",title:T.$t("fileBrowser.download")},[A(p(F),{icon:"carbon:download"})],8,Ur),n("button",{onClick:I,class:"close-btn",title:T.$t("common.close")},[A(p(F),{icon:"carbon:close"})],8,Lr)])]),n("div",Or,[b.value?(h(),g("div",Br,[A(p(F),{icon:"carbon:loading",class:"rotating"}),n("span",null,u(T.$t("fileBrowser.loadingContent")),1)])):r.value?(h(),g("div",qr,[A(p(F),{icon:"carbon:warning"}),n("span",null,u(r.value),1)])):m.value?(h(),g("div",Hr,[f.value?(h(),g("div",Vr,[n("pre",null,[n("code",null,u(m.value.content),1)])])):(h(),g("div",jr,[A(p(F),{icon:"carbon:document-unknown"}),n("p",null,u(T.$t("fileBrowser.binaryFile")),1),n("button",{onClick:R[1]||(R[1]=U=>v(i.value)),class:"download-btn-large"},[A(p(F),{icon:"carbon:download"}),ce(" "+u(T.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),Wr=Ee(zr,[["__scopeId","data-v-a19b1e5b"]]),Gr="/api/executor";async function Ss(o){try{const t=await fetch(`${Gr}/agent-execution/${o}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,t),null}}async function Kr(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Ss(o)}function Jr(){const o=tt(),t=et(),e=M(null),s=M(null),a=M("details"),l=se(()=>o.activeRootPlanId.value),i=v=>{if(!v)return null;for(const[I,O]of t.planExecutionRecords.entries())if((O.rootPlanId||O.currentPlanId)&&O.agentExecutionSequence)for(const T of O.agentExecutionSequence){if(T.stepId===v){const R=O.rootPlanId||O.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:v,rootPlanId:R,planId:I}),R||null}if(T.subPlanExecutionRecords)for(const R of T.subPlanExecutionRecords){const U=m(R,v);if(U)return U}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",v),null},m=(v,I)=>{if(!v||!v.agentExecutionSequence)return null;for(const O of v.agentExecutionSequence){if(O.stepId===I)return v.rootPlanId||v.currentPlanId||null;if(O.subPlanExecutionRecords)for(const W of O.subPlanExecutionRecords){const T=m(W,I);if(T)return T}}return null},b=se(()=>s.value||l.value),r=se(()=>!b.value),c=async v=>{if(console.log("[useRightPanel] Step selected:",{stepId:v}),!v){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}try{const I=i(v);I?(s.value=I,console.log("[useRightPanel] Set selectedRootPlanId to:",I)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const O=await Ss(v);if(!O){console.warn("[useRightPanel] Agent execution detail not found for stepId:",v),e.value=null,s.value=null;return}const W={stepId:v,title:O.agentName??`Step ${v}`,description:O.agentDescription??"",agentExecution:O,completed:O.status==="FINISHED",current:O.status==="RUNNING"};e.value=W,console.log("[useRightPanel] Step details updated:",W),await Ae(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(I){console.error("[useRightPanel] Error fetching step details:",I),e.value=null,s.value=null}},f=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const v=await Kr(e.value.stepId);v&&(e.value.agentExecution=v,e.value.completed=v.status==="FINISHED",e.value.current=v.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(v){console.error("[useRightPanel] Error refreshing step:",v)}},E=v=>{a.value=v,console.log("[useRightPanel] Active tab set to:",v)},k=v=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",v)},d=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},w=v=>{if(v===null||typeof v>"u"||v==="")return"N/A";if(typeof v=="object"&&v!==null)try{return JSON.stringify(v,null,2)}catch{return String(v)}if(typeof v=="string"){const I=v.trim();if(I==="")return"N/A";try{const O=JSON.parse(I);return JSON.stringify(O,null,2)}catch{return I}}return String(v)},y=()=>{e.value=null,s.value=null,a.value="details",console.log("[useRightPanel] State reset")};return{selectedStep:Ue(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:b,shouldShowNoTaskMessage:r,handleStepSelected:c,refreshCurrentStep:f,setActiveTab:E,updateDisplayedPlanProgress:k,clearSelectedStep:d,formatJson:w,reset:y}}let Ct=null;function Xr(){return Ct||(Ct=Jr()),Ct}const Yr={class:"right-panel"},Qr={class:"preview-header"},Zr={class:"preview-tabs"},ei={class:"preview-content"},ti={key:0,class:"step-details"},si={key:0,class:"step-info"},oi={key:0,class:"agent-info"},ni={class:"info-item"},ai={class:"label"},li=["title"],ri={class:"info-item"},ii={class:"label"},ci={class:"value"},ui={class:"execution-status"},di={class:"status-item"},pi={class:"status-text"},mi={key:0},hi={key:0,class:"think-act-steps"},fi={class:"steps-container"},vi={class:"step-header"},gi={class:"step-number"},yi={class:"think-section"},bi={class:"think-content"},_i={class:"input"},wi={class:"label"},$i={class:"output"},Si={class:"label"},Pi={key:0,class:"action-section"},Ti={class:"action-content"},Ei={class:"tool-info"},ki={class:"label"},Ci={class:"value"},Ii={class:"input"},Ri={class:"label"},xi={class:"output"},Ai={class:"label"},Mi={key:0,class:"no-tools"},Fi={key:0,class:"sub-plan-section"},Di={class:"sub-plan-content"},Ni={class:"sub-plan-header"},Ui={class:"sub-plan-info"},Li={class:"label"},Oi={class:"value"},Bi={key:0,class:"sub-plan-info"},qi={class:"label"},Hi={class:"value"},Vi={class:"sub-plan-status"},ji={class:"status-text"},zi={key:0,class:"no-steps-message"},Wi={key:1,class:"no-execution-message"},Gi={class:"step-basic-info"},Ki={class:"info-item"},Ji={class:"label"},Xi={class:"value"},Yi={key:0,class:"info-item"},Qi={class:"label"},Zi={class:"value"},ec={class:"info-item"},tc={class:"label"},sc={class:"no-execution-hint"},oc={key:2,class:"execution-indicator"},nc={class:"execution-text"},ac={key:1,class:"no-selection"},lc=["title"],rc={key:1,class:"file-browser-container"},ic={key:1,class:"no-plan-message"},cc={class:"message-content"},uc={class:"tips"},dc=Te({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:t}){const e=o,{t:s}=Ne(),a=Xr(),l=M(),i=M(!1),m=M(!0),b=M(!0),r=se(()=>a.selectedStep.value),c=se({get:()=>a.activeTab.value,set:x=>a.setActiveTab(x)}),f=se(()=>a.fileBrowserPlanId.value),E=se(()=>a.shouldShowNoTaskMessage.value),k=se(()=>r.value?r.value.completed?s("rightPanel.status.completed"):r.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),d=async x=>{await a.handleStepSelected(x),setTimeout(()=>{v()},100),O()},w=async()=>{await a.refreshCurrentStep(),O()};ve(()=>e.selectedStepId,async x=>{x?await d(x):a.clearSelectedStep()},{immediate:!0});const y=x=>{l.value=x??void 0},v=()=>{if(!l.value)return;const{scrollTop:x,scrollHeight:q,clientHeight:_}=l.value,P=q-x-_<50,$=q>_;m.value=P,i.value=$&&!P,P?b.value=!0:q-x-_>100&&(b.value=!1)},I=()=>{l.value&&(l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"}),Ae(()=>{b.value=!0,v()}))},O=()=>{!b.value||!l.value||Ae(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},W=a.formatJson,T=()=>{b.value=!0,l.value&&l.value.removeEventListener("scroll",v)},R=()=>{const x=()=>{const q=l.value;return q?(y(q),q.addEventListener("scroll",v),b.value=!0,v(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ae(()=>{x()||setTimeout(()=>{x()},100)})};return De(()=>{console.log("[RightPanel] Component mounted"),Ae(()=>{R()})}),Le(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),T()}),t({handleStepSelected:d,refreshCurrentStep:w,updateDisplayedPlanProgress:x=>{a.updateDisplayedPlanProgress(x)}}),(x,q)=>(h(),g("div",Yr,[n("div",Qr,[n("div",Zr,[n("div",{class:ue(["tab-item",{active:c.value==="details"}]),onClick:q[0]||(q[0]=_=>c.value="details")},[A(p(F),{icon:"carbon:events"}),n("span",null,u(p(s)("rightPanel.stepExecutionDetails")),1)],2),n("div",{class:ue(["tab-item",{active:c.value==="files"}]),onClick:q[1]||(q[1]=_=>c.value="files")},[A(p(F),{icon:"carbon:folder"}),n("span",null,u(p(s)("fileBrowser.title")),1)],2)])]),n("div",ei,[c.value==="details"?(h(),g("div",ti,[r.value?(h(),g("div",si,[n("h3",null,u(r.value.title||r.value.description||p(s)("rightPanel.defaultStepTitle",{number:1})),1),r.value.agentExecution?(h(),g("div",oi,[n("div",ni,[n("span",ai,u(p(s)("rightPanel.executingAgent"))+":",1),n("span",{class:"value",title:r.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.clickToViewExecutionDetails"):""},u(r.value.agentExecution.agentName==="ConfigurableDynaAgent"?p(s)("chat.funcAgentExecutionDetails"):r.value.agentExecution.agentName),9,li)]),n("div",ri,[n("span",ii,u(p(s)("rightPanel.callingModel"))+":",1),n("span",ci,u(r.value.agentExecution.modelName),1)])])):V("",!0),n("div",ui,[n("div",di,[r.value.completed?(h(),we(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):r.value.current?(h(),we(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),we(p(F),{key:2,icon:"carbon:time",class:"status-icon pending"})),n("span",pi,u(k.value),1)])])])):V("",!0),n("div",{ref_key:"scrollContainer",ref:l,class:"step-details-scroll-container",onScroll:v},[r.value?(h(),g("div",mi,[r.value.agentExecution?.thinkActSteps&&r.value.agentExecution.thinkActSteps.length>0?(h(),g("div",hi,[n("h4",null,u(p(s)("rightPanel.thinkAndActionSteps")),1),n("div",fi,[(h(!0),g(de,null,fe(r.value.agentExecution.thinkActSteps,(_,P)=>(h(),g("div",{key:P,class:"think-act-step"},[n("div",vi,[n("span",gi,"#"+u(P+1),1),n("span",{class:ue(["step-status",_.status])},u(_.status||p(s)("rightPanel.executing")),3)]),n("div",yi,[n("h5",null,[A(p(F),{icon:"carbon:thinking"}),ce(" "+u(p(s)("rightPanel.thinking")),1)]),n("div",bi,[n("div",_i,[n("span",wi,u(p(s)("rightPanel.input"))+":",1),n("pre",null,u(p(W)(_.thinkInput)),1)]),n("div",$i,[n("span",Si,u(p(s)("rightPanel.output"))+":",1),n("pre",null,u(p(W)(_.thinkOutput)),1)])])]),_.actionNeeded?(h(),g("div",Pi,[n("h5",null,[A(p(F),{icon:"carbon:play"}),ce(" "+u(p(s)("rightPanel.action")),1)]),n("div",Ti,[(h(!0),g(de,null,fe(_.actToolInfoList||[],($,N)=>(h(),g("div",{key:`tool-${N}-${$?.id||$?.name||N}`,class:"tool-execution-item"},[n("div",Ei,[n("span",ki,u(p(s)("rightPanel.tool"))+":",1),n("span",Ci,u($?.name||"N/A"),1)]),n("div",Ii,[n("span",Ri,u(p(s)("rightPanel.toolParameters"))+":",1),n("pre",null,u(p(W)($?.parameters)),1)]),n("div",xi,[n("span",Ai,u(p(s)("rightPanel.executionResult"))+":",1),n("pre",null,u(p(W)($?.result)),1)])]))),128)),!_.actToolInfoList||_.actToolInfoList.length===0?(h(),g("div",Mi,[n("p",null,u(p(s)("rightPanel.noToolsExecuted")),1)])):V("",!0)]),_.subPlanExecutionRecord?(h(),g("div",Fi,[n("h5",null,[A(p(F),{icon:"carbon:tree-view"}),ce(" "+u(p(s)("rightPanel.subPlan")),1)]),n("div",Di,[n("div",Ni,[n("div",Ui,[n("span",Li,u(x.$t("rightPanel.subPlanId"))+":",1),n("span",Oi,u(_.subPlanExecutionRecord.currentPlanId),1)]),_.subPlanExecutionRecord.title?(h(),g("div",Bi,[n("span",qi,u(x.$t("rightPanel.title"))+":",1),n("span",Hi,u(_.subPlanExecutionRecord.title),1)])):V("",!0),n("div",Vi,[_.subPlanExecutionRecord.completed?(h(),we(p(F),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),we(p(F),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),n("span",ji,u(_.subPlanExecutionRecord.completed?x.$t("rightPanel.status.completed"):x.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),r.value.agentExecution&&!r.value.agentExecution.thinkActSteps?.length?(h(),g("div",zi,[n("p",null,u(p(s)("rightPanel.noStepDetails")),1)])):r.value.agentExecution?V("",!0):(h(),g("div",Wi,[A(p(F),{icon:"carbon:information",class:"info-icon"}),n("h4",null,u(p(s)("rightPanel.stepInfo")),1),n("div",Gi,[n("div",Ki,[n("span",Ji,u(p(s)("rightPanel.stepName"))+":",1),n("span",Xi,u(r.value.title||r.value.description||r.value.stepId),1)]),r.value.description?(h(),g("div",Yi,[n("span",Qi,u(x.$t("rightPanel.description"))+":",1),n("span",Zi,u(r.value.description),1)])):V("",!0),n("div",ec,[n("span",tc,u(x.$t("rightPanel.status.label"))+":",1),n("span",{class:ue(["value",{"status-completed":r.value.completed,"status-current":r.value.current,"status-pending":!r.value.completed&&!r.value.current}])},u(r.value.completed?x.$t("rightPanel.status.completed"):r.value.current?x.$t("rightPanel.status.executing"):x.$t("rightPanel.status.pending")),3)])]),n("p",sc,u(p(s)("rightPanel.noExecutionInfo")),1)])),r.value.current&&!r.value.completed?(h(),g("div",oc,[q[2]||(q[2]=n("div",{class:"execution-waves"},[n("div",{class:"wave wave-1"}),n("div",{class:"wave wave-2"}),n("div",{class:"wave wave-3"})],-1)),n("p",nc,[A(p(F),{icon:"carbon:in-progress",class:"rotating-icon"}),ce(" "+u(p(s)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(h(),g("div",ac,[A(p(F),{icon:"carbon:events",class:"empty-icon"}),n("h3",null,u(p(s)("rightPanel.noStepSelected")),1),n("p",null,u(p(s)("rightPanel.selectStepHint")),1)]))])):V("",!0),A(qt,{name:"scroll-button"},{default:Ye(()=>[i.value?(h(),g("button",{key:0,onClick:I,class:"scroll-to-bottom-btn",title:p(s)("rightPanel.scrollToBottom")},[A(p(F),{icon:"carbon:chevron-down"})],8,lc)):V("",!0)]),_:1})],544)])):V("",!0),c.value==="files"?(h(),g("div",rc,[f.value?(h(),we(Wr,{key:0,"plan-id":f.value},null,8,["plan-id"])):E.value?(h(),g("div",ic,[A(p(F),{icon:"carbon:folder-off"}),n("div",cc,[n("h3",null,u(p(s)("fileBrowser.noFilesYet")),1),n("p",null,u(p(s)("fileBrowser.noPlanExecuting")),1),n("div",uc,[A(p(F),{icon:"carbon:information"}),n("span",null,u(p(s)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])]))}}),pc=Ee(dc,[["__scopeId","data-v-139a2d37"]]);class Ps{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function mc(){const o=M([]),t=M(!1),e=M(null);return{availableTools:o,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await Ps.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),o.value=l.filter(i=>i.selectable!==!1).map(i=>({key:i.key||"",name:i.name||"",description:i.description||"",enabled:i.enabled||!1,serviceGroup:i.serviceGroup||"default",selectable:i.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",o.value=[]}finally{t.value=!1}}},reset:()=>{o.value=[],t.value=!1,e.value=null}}}let It=null;function lt(){return It||(It=mc()),It}class Ts{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}const hc={class:"modal-form wide-modal"},fc={class:"form-section"},vc={class:"form-item"},gc=["placeholder"],yc={class:"field-description"},bc={class:"form-section"},_c={class:"section-title"},wc={key:0,class:"params-help-text"},$c={class:"parameter-table"},Sc=["onUpdate:modelValue","placeholder","readonly"],Pc=["onUpdate:modelValue","placeholder"],Tc={class:"form-section"},Ec={class:"service-publish-options"},kc={class:"internal-toolcall-publish-option"},Cc={class:"checkbox-label"},Ic={class:"checkbox-text"},Rc={class:"checkbox-description"},xc={class:"http-publish-option"},Ac={class:"checkbox-label"},Mc={class:"checkbox-text"},Fc={class:"checkbox-description"},Dc={class:"button-container"},Nc=["disabled"],Uc=["disabled"],Lc=Te({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(o,{expose:t,emit:e}){const{t:s}=Ne(),a=Ze(),l=lt(),i=o,m=e,b=se({get:()=>i.modelValue,set:$=>m("update:modelValue",$)}),r=M(""),c=M(""),f=M(!1),E=M(!1),k=M(!1),d=M(!0),w=M({parameters:[],hasParameters:!1,requirements:""}),y=M(!1),v=je({userRequest:"",parameters:[]}),I=se(()=>{const $=!!a.selectedTemplate.value?.toolConfig;return s($?"mcpService.updateService":"mcpService.createService")}),O=se(()=>!!a.selectedTemplate.value?.toolConfig),W=()=>{const $=a.selectedTemplate.value?.toolConfig;$?(v.userRequest=$.toolDescription||"",k.value=$.enableHttpService??!1,d.value=$.enableInternalToolcall??!0,$.inputSchema&&Array.isArray($.inputSchema)&&$.inputSchema.length>0?v.parameters=$.inputSchema.map(N=>({name:N.name||"",description:N.description||""})):w.value.hasParameters||(v.parameters=[])):(v.userRequest="",k.value=!1,d.value=!0,w.value.hasParameters||(v.parameters=[]))},T=async()=>{const $=a.currentPlanTemplateId.value;if(!$){w.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[];return}y.value=!0;try{const N=await Ts.getParameterRequirements($);if(w.value=N,console.log("[PublishModal] Parameter requirements loaded:",N),N.hasParameters){const j=new Map;v.parameters.forEach(Q=>{Q.name&&j.set(Q.name,Q.description||"")}),v.parameters=N.parameters.map(Q=>({name:Q,description:j.get(Q)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",v.parameters)}else v.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(N){console.error("[PublishModal] Failed to load parameter requirements:",N),N instanceof Error&&!N.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),w.value={parameters:[],hasParameters:!1,requirements:""},v.parameters=[]}finally{y.value=!1}},R=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",w.value.parameters),console.log("[PublishModal] Form parameters:",v.parameters);const $=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",$);const N=new Map;if($.forEach(j=>{j.name&&N.set(j.name,j.description||"")}),w.value.hasParameters){const j=w.value.parameters.map(Q=>{const be=v.parameters.find(Pe=>Pe.name===Q)?.description||""||N.get(Q)||"";return{name:Q,description:be}});return console.log("[PublishModal] Merged parameters (from plan template):",j),j}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},U=($,N)=>{N==="success"?(c.value=$,setTimeout(()=>{c.value=""},3e3)):N==="error"&&(r.value=$,setTimeout(()=>{r.value=""},5e3))},x=()=>{if(!v.userRequest.trim())return U(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return U(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return U(s("mcpService.toolNameRequiredError"),"error"),!1;if(!d.value&&!k.value)return U("Please select at least one service type","error"),!1;for(let j=0;j<v.parameters.length;j++){const Q=v.parameters[j];if(Q.name&&!Q.description.trim())return U(`Parameter "${Q.name}" description cannot be empty`,"error"),!1;if(Q.description&&!Q.name.trim())return U(`Parameter description "${Q.description}" corresponding name cannot be empty`,"error"),!1}return!0},q=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",v),console.log("[PublishModal] Publish as HTTP service:",k.value),!x()){console.log("[PublishModal] Form validation failed");return}f.value=!0;try{const $=R();console.log("[PublishModal] Merged parameters:",$);const N=$.filter(me=>me.name.trim()).map(me=>({name:me.name.trim(),description:me.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(v.userRequest.trim()),a.setEnableInternalToolcallWithGuard(d.value),a.setEnableHttpServiceWithGuard(k.value),a.setInputSchemaWithGuard(N),!await a.save())throw new Error("Failed to save plan template");const Q=[];d.value&&Q.push("Internal Method Call"),k.value&&Q.push("HTTP Service"),Q.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",Q.join(", ")),U(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),m("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),U(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),m("published",null))}catch($){console.error("[PublishModal] Failed to publish service:",$);const N=$ instanceof Error?$.message:"Unknown error";U(s("mcpService.publishFailed")+": "+N,"error")}finally{f.value=!1}},_=async()=>{if(E.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const $=a.currentPlanTemplateId.value;if(!$){U(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",$),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),U(s("mcpService.deleteSuccess"),"success"),b.value=!1,m("published",null)}catch(N){console.error("[PublishModal] Failed to delete tool config:",N);const j=N instanceof Error?N.message:"Unknown error";U(s("mcpService.deleteFailed")+": "+j,"error")}finally{E.value=!1}};return ve(()=>i.modelValue,async()=>{b.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),W(),await T())}),ve(()=>a.currentPlanTemplateId.value,($,N)=>{$&&$!==N&&(N&&$.startsWith("planTemplate-")?setTimeout(()=>{T()},1e3):T())}),De(async()=>{b.value&&(console.log("[PublishModal] Initialize when component mounted"),W(),await T())}),t({loadParameterRequirements:T}),($,N)=>(h(),g(de,null,[A(ys,{modelValue:b.value,"onUpdate:modelValue":N[3]||(N[3]=j=>b.value=j),title:I.value,onConfirm:q},{footer:Ye(()=>[n("div",Dc,[O.value?(h(),g("button",{key:0,class:"action-btn danger",onClick:_,disabled:E.value},[E.value?(h(),we(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),we(p(F),{key:1,icon:"carbon:trash-can"})),ce(" "+u(E.value?p(s)("mcpService.deleting"):p(s)("mcpService.delete")),1)],8,Nc)):V("",!0),n("button",{class:"action-btn primary",onClick:q,disabled:f.value},[f.value?(h(),we(p(F),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),we(p(F),{key:1,icon:"carbon:cloud-upload"})),ce(" "+u(f.value?p(s)("mcpService.publishing"):p(s)("mcpService.publishAsService")),1)],8,Uc)])]),default:Ye(()=>[n("div",hc,[n("div",fc,[n("div",vc,[n("label",null,u(p(s)("mcpService.toolDescriptionRequired")),1),ye(n("textarea",{"onUpdate:modelValue":N[0]||(N[0]=j=>v.userRequest=j),placeholder:p(s)("mcpService.toolDescriptionPlaceholder"),class:ue([{error:!v.userRequest||!v.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,gc),[[ke,v.userRequest]]),n("div",yc,u(p(s)("mcpService.toolDescriptionDescription")),1)])]),n("div",bc,[n("div",_c,u(p(s)("mcpService.parameterConfig")),1),w.value.hasParameters?(h(),g("div",wc,u(p(s)("sidebar.parameterRequirementsHelp")),1)):V("",!0),n("div",$c,[n("table",null,[n("thead",null,[n("tr",null,[n("th",null,u(p(s)("mcpService.parameterName")),1),n("th",null,u(p(s)("mcpService.parameterDescription")),1)])]),n("tbody",null,[(h(!0),g(de,null,fe(v.parameters,(j,Q)=>(h(),g("tr",{key:Q},[n("td",null,[ye(n("input",{type:"text","onUpdate:modelValue":me=>j.name=me,placeholder:p(s)("mcpService.parameterName"),class:ue(["parameter-input",{"readonly-input":w.value.hasParameters}]),readonly:w.value.hasParameters,required:""},null,10,Sc),[[ke,j.name]])]),n("td",null,[ye(n("input",{type:"text","onUpdate:modelValue":me=>j.description=me,placeholder:p(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Pc),[[ke,j.description]])])]))),128))])])])]),n("div",Tc,[n("div",Ec,[n("div",kc,[n("label",Cc,[ye(n("input",{type:"checkbox","onUpdate:modelValue":N[1]||(N[1]=j=>d.value=j),class:"checkbox-input"},null,512),[[Ft,d.value]]),n("span",Ic,u(p(s)("mcpService.publishAsInternalToolcall")),1)]),n("div",Rc,u(p(s)("mcpService.publishAsInternalToolcallDescription")),1)]),n("div",xc,[n("label",Ac,[ye(n("input",{type:"checkbox","onUpdate:modelValue":N[2]||(N[2]=j=>k.value=j),class:"checkbox-input"},null,512),[[Ft,k.value]]),n("span",Mc,u(p(s)("mcpService.publishAsHttpService")),1)]),n("div",Fc,u(p(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),r.value?(h(),g("div",{key:0,class:"error-toast",onClick:N[4]||(N[4]=j=>r.value="")},[A(p(F),{icon:"carbon:error"}),ce(" "+u(r.value),1)])):V("",!0),c.value?(h(),g("div",{key:1,class:"success-toast",onClick:N[5]||(N[5]=j=>c.value="")},[A(p(F),{icon:"carbon:checkmark"}),ce(" "+u(c.value),1)])):V("",!0)],64))}}),Oc=Ee(Lc,[["__scopeId","data-v-235a4588"]]),Bc={class:"modal-header"},qc={class:"modal-body"},Hc={class:"modal-footer"},Vc=["disabled"],jc=Te({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(o,{emit:t}){const e=t,s=M(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},i=()=>{e("continue"),e("update:modelValue",!1)};return(m,b)=>m.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:a},[n("div",{class:"modal-content",onClick:b[0]||(b[0]=_e(()=>{},["stop"]))},[n("div",Bc,[n("h3",null,u(m.$t("sidebar.saveConfirmationTitle")),1),n("button",{class:"close-btn",onClick:a},[A(p(F),{icon:"carbon:close",width:"16"})])]),n("div",qc,[n("p",null,u(m.$t("sidebar.saveConfirmationMessage")),1)]),n("div",Hc,[n("button",{class:"btn btn-secondary",onClick:a},u(m.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),we(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ce(" "+u(s.value?m.$t("sidebar.saving"):m.$t("common.save")),1)],8,Vc),n("button",{class:"btn btn-danger",onClick:i},u(m.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),zc=Ee(jc,[["__scopeId","data-v-4817656d"]]),Wc={class:"config-section"},Gc={class:"section-header"},Kc={class:"execution-content"},Jc={class:"params-requirements-group"},Xc={class:"params-help-text"},Yc={key:0,class:"parameter-fields"},Qc={class:"parameter-label"},Zc=["onUpdate:modelValue","placeholder","onInput"],eu={key:0,class:"parameter-error"},tu={key:1,class:"validation-message"},su=["disabled"],ou=["disabled"],nu={key:1,class:"call-example-wrapper"},au={class:"call-example-header"},lu={class:"call-example-title"},ru={class:"call-example-description"},iu={class:"internal-call-wrapper"},cu={class:"call-info"},uu={class:"call-method"},du={class:"call-endpoint"},pu={key:0,class:"call-endpoint"},mu={class:"call-description"},hu={class:"call-example"},fu={class:"example-code"},vu={key:2,class:"call-example-wrapper"},gu={class:"call-example-header"},yu={class:"call-example-title"},bu={class:"call-example-description"},_u={class:"http-api-urls-wrapper"},wu={class:"tab-container"},$u={class:"tab-header"},Su=["onClick"],Pu={class:"tab-content"},Tu={class:"http-api-url-display"},Eu={class:"api-method"},ku={class:"api-endpoint"},Cu={class:"api-description"},Iu={key:0,class:"api-example"},Ru={class:"example-code"},xu={key:3,class:"call-example-wrapper"},Au={class:"call-example-header"},Mu={class:"call-example-title"},Fu={class:"call-example-description"},Du={class:"mcp-call-wrapper"},Nu={class:"call-info"},Uu={class:"call-method"},Lu={class:"call-endpoint"},Ou={class:"call-description"},Bu={class:"call-example"},qu={class:"example-code"},Hu=Te({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=Ne(),s=bs(),a=Ze(),l=tt(),i=et(),m=o,b=M(""),r=M(!1),c=M({parameters:[],hasParameters:!1,requirements:""}),f=M({}),E=M(!1),k=M("get-sync"),d=M({}),w=M(!1),y=M(!1),v=se(()=>a.getCoordinatorToolConfig()),I=M(),O=M([]),W=M(null),T=M(!1),R=M(null),U=M([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),x=se(()=>{const D=a.selectedTemplate.value?.toolConfig;return D?.enableInternalToolcall??D?.enableHttpService??D?.enableMcpService??!1}),q=se(()=>x.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),_=se(()=>l.isLoading.value),P=se(()=>{if(_.value||m.isExecuting||y.value)return!1;const D=i.trackedPlanIds.value.size>0,J=Array.from(i.planExecutionRecords.entries()).some(([,L])=>L&&!L.completed&&L.status!=="failed");return D||J?!1:c.value.hasParameters?c.value.parameters.every(L=>{const ee=f.value[L];return typeof ee=="string"&&ee.trim()!==""}):!0}),$=(D,K)=>{O.value=D.map(J=>J.originalName),W.value=K,console.log("[ExecutionController] Files uploaded:",D.length,"uploadKey:",K)},N=D=>{O.value=D.map(K=>K.originalName),console.log("[ExecutionController] Files removed, remaining:",D.length)},j=D=>{W.value=D,console.log("[ExecutionController] Upload key changed:",D)},Q=()=>{console.log("[ExecutionController] Upload started")},me=()=>{console.log("[ExecutionController] Upload completed")},Ie=D=>{console.error("[ExecutionController] Upload error:",D)},be=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",m.isExecuting,l.isLoading.value,y.value),s.error(e("sidebar.executionInProgress"));return}if(le.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",d.value);return}const D=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;R.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:D,uploadedFiles:O.value,uploadKey:W.value},T.value=!0;return}await Pe()},Pe=async()=>{if(m.isExecuting||l.isLoading.value||y.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(y.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!re()){console.log("[ExecutionController] âŒ Parameter validation failed:",d.value),y.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),y.value=!1;return}const D=a.getConfig(),K=a.selectedTemplate.value.planTemplateId||D.planTemplateId,J={title:D.title||a.selectedTemplate.value.title||"Execution Plan",steps:(D.steps||[]).map(te=>({stepRequirement:te.stepRequirement||"",agentName:te.agentName||"",modelName:te.modelName||null,selectedToolKeys:[],terminateColumns:te.terminateColumns||"",stepContent:""})),directResponse:D.directResponse||!1,...K&&{planTemplateId:K},...D.planType&&{planType:D.planType}},L=a.selectedTemplate.value.title??D.title??"Execution Plan",ee=c.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",ee),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(J,null,2));const Z={title:L,planData:J,params:void 0,replacementParams:ee,uploadedFiles:O.value,uploadKey:W.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(Z,null,2));const pe=await l.executePlan(Z);pe.success?console.log("[ExecutionController] âœ… Plan execution started successfully:",pe.planId):(console.error("[ExecutionController] âŒ Plan execution failed:",pe.error),s.error(pe.error||e("sidebar.executeFailed")))}catch(D){console.error("[ExecutionController] âŒ Error executing plan:",D);const K=D instanceof Error?D.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+K),y.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),H(),console.log("[ExecutionController] âœ… Cleanup completed")}},qe=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const D=a.validate();if(!D.isValid){s.error(`Invalid format, please correct and save.
Errors: `+D.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const L=a.generateJsonString().trim();a.updateVersionsAfterSave(L);const ee=a.planVersions.value.length;le.hasTaskRequirementModified=!1,await new Promise(Z=>setTimeout(Z,500)),await z(),await le.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ee})),await new Promise(Z=>setTimeout(Z,500)),R.value&&(await Pe(),R.value=null)}catch(D){console.error("[ExecutionController] âŒ Failed to save before execute:",D);const K=D instanceof Error?D.message:e("sidebar.saveFailed");throw s.error(K),D}},$e=async()=>{console.log("[ExecutionController] â© Continue without save requested"),R.value&&(await Pe(),R.value=null)},B=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}r.value=!0},H=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),b.value="",f.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},z=async()=>{await new Promise(D=>setTimeout(D,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(D=>D.stepRequirement).join(" ||| ")),await new Promise(D=>setTimeout(D,200)),await Y()},Y=async()=>{const D=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",D),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!D){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const K=await Ts.getParameterRequirements(D);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(K,null,2)),c.value=K;const J={};K.parameters.forEach(L=>{J[L]=f.value[L]||""}),f.value=J,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(f.value,null,2)),he()}catch(K){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",K),K instanceof Error&&!K.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(f.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},ne=(D,K)=>{f.value[D]=K,d.value[D]&&delete d.value[D],he()},re=()=>{if(d.value={},w.value=!1,!c.value.hasParameters)return!0;let D=!1;return c.value.parameters.forEach(K=>{(f.value[K]?f.value[K].trim():"")||(d.value[K]=`${K} is required`,D=!0)}),w.value=D,!D},he=()=>{c.value.hasParameters?b.value=JSON.stringify(f.value,null,2):b.value=""};return ve(()=>a.currentPlanTemplateId.value,(D,K)=>{if(D&&D!==K){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),K&&D.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),Y()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),Y())}}),ve(()=>le.hasTaskRequirementModified,async(D,K)=>{if(K===!0&&D===!1&&a.currentPlanTemplateId.value){if(y.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(J=>setTimeout(J,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await z()}}),gs(()=>{const D=i.planExecutionRecords,K=Array.from(D.entries()),J=i.trackedPlanIds.value.size>0,L=K.some(([,Z])=>Z&&!Z.completed&&Z.status!=="failed");!(J||L)&&y.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:J,hasRunningPlansInRecords:L,trackedPlanIds:Array.from(i.trackedPlanIds.value),recordsCount:K.length}),y.value=!1)}),De(()=>{Y()}),t({executionParams:b,clearExecutionParams:H,loadParameterRequirements:Y,refreshParameterRequirements:z,fileUploadRef:I,uploadedFiles:O,uploadKey:W}),(D,K)=>(h(),g(de,null,[n("div",Wc,[n("div",Gc,[A(p(F),{icon:"carbon:play",width:"16"}),n("span",null,u(p(e)("sidebar.executionController")),1)]),n("div",Kc,[n("div",Jc,[n("label",null,u(p(e)("sidebar.parameterRequirements")),1),n("div",Xc,u(p(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),g("div",Yc,[(h(!0),g(de,null,fe(c.value.parameters,J=>(h(),g("div",{key:J,class:"parameter-field"},[n("label",Qc,[ce(u(J)+" ",1),K[2]||(K[2]=n("span",{class:"required"},"*",-1))]),ye(n("input",{"onUpdate:modelValue":L=>f.value[J]=L,class:ue(["parameter-input",{error:d.value[J]}]),placeholder:p(e)("sidebar.enterValueFor",{param:J}),onInput:L=>ne(J,L.target.value),required:""},null,42,Zc),[[ke,f.value[J]]]),d.value[J]?(h(),g("div",eu,u(d.value[J]),1)):V("",!0)]))),128))])):V("",!0),c.value.hasParameters&&!P.value&&!m.isExecuting?(h(),g("div",tu,[A(p(F),{icon:"carbon:warning",width:"14"}),ce(" "+u(p(e)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),A($s,{ref_key:"fileUploadRef",ref:I,disabled:m.isExecuting,onFilesUploaded:$,onFilesRemoved:N,onUploadKeyChanged:j,onUploadStarted:Q,onUploadCompleted:me,onUploadError:Ie},null,8,["disabled"]),n("button",{class:"btn btn-primary execute-btn",onClick:be,disabled:!P.value},[A(p(F),{icon:m.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ue({spinning:m.isExecuting})},null,8,["icon","class"]),ce(" "+u(m.isExecuting?p(e)("sidebar.executing"):p(e)("sidebar.executePlan")),1)],8,su),v.value?(h(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:B,disabled:!p(a).currentPlanTemplateId.value},[A(p(F),{icon:"carbon:application",width:"16"}),ce(" "+u(q.value),1)],8,ou)):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),g("div",nu,[n("div",au,[n("h4",lu,u(p(e)("sidebar.internalCall")),1),n("p",ru,u(p(e)("sidebar.internalCallDescription")),1)]),n("div",iu,[n("div",cu,[n("div",uu,u(p(e)("sidebar.internalMethodCall")),1),n("div",du,u(p(e)("sidebar.toolName"))+": "+u(p(a).selectedTemplate.value?.title||p(a).currentPlanTemplateId.value||""),1),p(a).selectedTemplate.value?.serviceGroup?(h(),g("div",pu,u(p(e)("sidebar.serviceGroup"))+": "+u(p(a).selectedTemplate.value.serviceGroup),1)):V("",!0),n("div",mu,u(p(e)("sidebar.internalCallUsage")),1),n("div",hu,[n("strong",null,u(p(e)("sidebar.usage"))+":",1),n("pre",fu,u(p(e)("sidebar.internalCallExample")),1)])])])])):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),g("div",vu,[n("div",gu,[n("h4",yu,u(p(e)("sidebar.httpCallExample")),1),n("p",bu,u(p(e)("sidebar.httpCallDescription")),1)]),n("div",_u,[n("div",wu,[n("div",$u,[(h(!0),g(de,null,fe(U.value,J=>(h(),g("button",{key:J.id,class:ue(["tab-button",{active:k.value===J.id}]),onClick:L=>k.value=J.id},u(J.label),11,Su))),128))]),n("div",Pu,[(h(!0),g(de,null,fe(U.value,J=>ye((h(),g("div",{key:J.id,class:"tab-panel"},[n("div",Tu,[n("div",Eu,u(J.method),1),n("div",ku,u(J.endpoint),1),n("div",Cu,u(J.description),1),J.example?(h(),g("div",Iu,[n("strong",null,u(p(e)("sidebar.example"))+":",1),n("pre",Ru,u(J.example),1)])):V("",!0)])])),[[no,k.value===J.id]])),128))])])])])):V("",!0),p(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),g("div",xu,[n("div",Au,[n("h4",Mu,u(p(e)("sidebar.mcpCall")),1),n("p",Fu,u(p(e)("sidebar.mcpCallDescription")),1)]),n("div",Du,[n("div",Nu,[n("div",Uu,u(p(e)("sidebar.mcpServiceCall")),1),n("div",Lu,u(p(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),n("div",Ou,u(p(e)("sidebar.mcpCallUsage")),1),n("div",Bu,[n("strong",null,u(p(e)("sidebar.usage"))+":",1),n("pre",qu,u(p(e)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])]),A(zc,{modelValue:T.value,"onUpdate:modelValue":K[0]||(K[0]=J=>T.value=J),onSave:qe,onContinue:$e},null,8,["modelValue"]),A(Oc,{modelValue:r.value,"onUpdate:modelValue":K[1]||(K[1]=J=>r.value=J)},null,8,["modelValue"])],64))}}),Vu=Ee(Hu,[["__scopeId","data-v-8e9b3e6f"]]);function Es(o,t){return function(){return o.apply(t,arguments)}}const{toString:ju}=Object.prototype,{getPrototypeOf:Ht}=Object,{iterator:_t,toStringTag:ks}=Symbol,wt=(o=>t=>{const e=ju.call(t);return o[e]||(o[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Oe=o=>(o=o.toLowerCase(),t=>wt(t)===o),$t=o=>t=>typeof t===o,{isArray:st}=Array,Qe=$t("undefined");function rt(o){return o!==null&&!Qe(o)&&o.constructor!==null&&!Qe(o.constructor)&&Me(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const Cs=Oe("ArrayBuffer");function zu(o){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(o):t=o&&o.buffer&&Cs(o.buffer),t}const Wu=$t("string"),Me=$t("function"),Is=$t("number"),it=o=>o!==null&&typeof o=="object",Gu=o=>o===!0||o===!1,ft=o=>{if(wt(o)!=="object")return!1;const t=Ht(o);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ks in o)&&!(_t in o)},Ku=o=>{if(!it(o)||rt(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},Ju=Oe("Date"),Xu=Oe("File"),Yu=Oe("Blob"),Qu=Oe("FileList"),Zu=o=>it(o)&&Me(o.pipe),ed=o=>{let t;return o&&(typeof FormData=="function"&&o instanceof FormData||Me(o.append)&&((t=wt(o))==="formdata"||t==="object"&&Me(o.toString)&&o.toString()==="[object FormData]"))},td=Oe("URLSearchParams"),[sd,od,nd,ad]=["ReadableStream","Request","Response","Headers"].map(Oe),ld=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ct(o,t,{allOwnKeys:e=!1}={}){if(o===null||typeof o>"u")return;let s,a;if(typeof o!="object"&&(o=[o]),st(o))for(s=0,a=o.length;s<a;s++)t.call(null,o[s],s,o);else{if(rt(o))return;const l=e?Object.getOwnPropertyNames(o):Object.keys(o),i=l.length;let m;for(s=0;s<i;s++)m=l[s],t.call(null,o[m],m,o)}}function Rs(o,t){if(rt(o))return null;t=t.toLowerCase();const e=Object.keys(o);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const ze=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,xs=o=>!Qe(o)&&o!==ze;function Nt(){const{caseless:o,skipUndefined:t}=xs(this)&&this||{},e={},s=(a,l)=>{const i=o&&Rs(e,l)||l;ft(e[i])&&ft(a)?e[i]=Nt(e[i],a):ft(a)?e[i]=Nt({},a):st(a)?e[i]=a.slice():(!t||!Qe(a))&&(e[i]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&ct(arguments[a],s);return e}const rd=(o,t,e,{allOwnKeys:s}={})=>(ct(t,(a,l)=>{e&&Me(a)?o[l]=Es(a,e):o[l]=a},{allOwnKeys:s}),o),id=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),cd=(o,t,e,s)=>{o.prototype=Object.create(t.prototype,s),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:t.prototype}),e&&Object.assign(o.prototype,e)},ud=(o,t,e,s)=>{let a,l,i;const m={};if(t=t||{},o==null)return t;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)i=a[l],(!s||s(i,o,t))&&!m[i]&&(t[i]=o[i],m[i]=!0);o=e!==!1&&Ht(o)}while(o&&(!e||e(o,t))&&o!==Object.prototype);return t},dd=(o,t,e)=>{o=String(o),(e===void 0||e>o.length)&&(e=o.length),e-=t.length;const s=o.indexOf(t,e);return s!==-1&&s===e},pd=o=>{if(!o)return null;if(st(o))return o;let t=o.length;if(!Is(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=o[t];return e},md=(o=>t=>o&&t instanceof o)(typeof Uint8Array<"u"&&Ht(Uint8Array)),hd=(o,t)=>{const s=(o&&o[_t]).call(o);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(o,l[0],l[1])}},fd=(o,t)=>{let e;const s=[];for(;(e=o.exec(t))!==null;)s.push(e);return s},vd=Oe("HTMLFormElement"),gd=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),Zt=(({hasOwnProperty:o})=>(t,e)=>o.call(t,e))(Object.prototype),yd=Oe("RegExp"),As=(o,t)=>{const e=Object.getOwnPropertyDescriptors(o),s={};ct(e,(a,l)=>{let i;(i=t(a,l,o))!==!1&&(s[l]=i||a)}),Object.defineProperties(o,s)},bd=o=>{As(o,(t,e)=>{if(Me(o)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=o[e];if(Me(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},_d=(o,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return st(o)?s(o):s(String(o).split(t)),e},wd=()=>{},$d=(o,t)=>o!=null&&Number.isFinite(o=+o)?o:t;function Sd(o){return!!(o&&Me(o.append)&&o[ks]==="FormData"&&o[_t])}const Pd=o=>{const t=new Array(10),e=(s,a)=>{if(it(s)){if(t.indexOf(s)>=0)return;if(rt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=st(s)?[]:{};return ct(s,(i,m)=>{const b=e(i,a+1);!Qe(b)&&(l[m]=b)}),t[a]=void 0,l}}return s};return e(o,0)},Td=Oe("AsyncFunction"),Ed=o=>o&&(it(o)||Me(o))&&Me(o.then)&&Me(o.catch),Ms=((o,t)=>o?setImmediate:t?((e,s)=>(ze.addEventListener("message",({source:a,data:l})=>{a===ze&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),ze.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Me(ze.postMessage)),kd=typeof queueMicrotask<"u"?queueMicrotask.bind(ze):typeof process<"u"&&process.nextTick||Ms,Cd=o=>o!=null&&Me(o[_t]),C={isArray:st,isArrayBuffer:Cs,isBuffer:rt,isFormData:ed,isArrayBufferView:zu,isString:Wu,isNumber:Is,isBoolean:Gu,isObject:it,isPlainObject:ft,isEmptyObject:Ku,isReadableStream:sd,isRequest:od,isResponse:nd,isHeaders:ad,isUndefined:Qe,isDate:Ju,isFile:Xu,isBlob:Yu,isRegExp:yd,isFunction:Me,isStream:Zu,isURLSearchParams:td,isTypedArray:md,isFileList:Qu,forEach:ct,merge:Nt,extend:rd,trim:ld,stripBOM:id,inherits:cd,toFlatObject:ud,kindOf:wt,kindOfTest:Oe,endsWith:dd,toArray:pd,forEachEntry:hd,matchAll:fd,isHTMLForm:vd,hasOwnProperty:Zt,hasOwnProp:Zt,reduceDescriptors:As,freezeMethods:bd,toObjectSet:_d,toCamelCase:gd,noop:wd,toFiniteNumber:$d,findKey:Rs,global:ze,isContextDefined:xs,isSpecCompliantForm:Sd,toJSONObject:Pd,isAsyncFn:Td,isThenable:Ed,setImmediate:Ms,asap:kd,isIterable:Cd};function oe(o,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const Fs=oe.prototype,Ds={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{Ds[o]={value:o}});Object.defineProperties(oe,Ds);Object.defineProperty(Fs,"isAxiosError",{value:!0});oe.from=(o,t,e,s,a,l)=>{const i=Object.create(Fs);C.toFlatObject(o,i,function(c){return c!==Error.prototype},r=>r!=="isAxiosError");const m=o&&o.message?o.message:"Error",b=t==null&&o?o.code:t;return oe.call(i,m,b,e,s,a),o&&i.cause==null&&Object.defineProperty(i,"cause",{value:o,configurable:!0}),i.name=o&&o.name||"Error",l&&Object.assign(i,l),i};const Id=null;function Ut(o){return C.isPlainObject(o)||C.isArray(o)}function Ns(o){return C.endsWith(o,"[]")?o.slice(0,-2):o}function es(o,t,e){return o?o.concat(t).map(function(a,l){return a=Ns(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function Rd(o){return C.isArray(o)&&!o.some(Ut)}const xd=C.toFlatObject(C,{},null,function(t){return/^is[A-Z]/.test(t)});function St(o,t,e){if(!C.isObject(o))throw new TypeError("target must be an object");t=t||new FormData,e=C.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,y){return!C.isUndefined(y[w])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,i=e.indexes,b=(e.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(t);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function r(d){if(d===null)return"";if(C.isDate(d))return d.toISOString();if(C.isBoolean(d))return d.toString();if(!b&&C.isBlob(d))throw new oe("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(d)||C.isTypedArray(d)?b&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function c(d,w,y){let v=d;if(d&&!y&&typeof d=="object"){if(C.endsWith(w,"{}"))w=s?w:w.slice(0,-2),d=JSON.stringify(d);else if(C.isArray(d)&&Rd(d)||(C.isFileList(d)||C.endsWith(w,"[]"))&&(v=C.toArray(d)))return w=Ns(w),v.forEach(function(O,W){!(C.isUndefined(O)||O===null)&&t.append(i===!0?es([w],W,l):i===null?w:w+"[]",r(O))}),!1}return Ut(d)?!0:(t.append(es(y,w,l),r(d)),!1)}const f=[],E=Object.assign(xd,{defaultVisitor:c,convertValue:r,isVisitable:Ut});function k(d,w){if(!C.isUndefined(d)){if(f.indexOf(d)!==-1)throw Error("Circular reference detected in "+w.join("."));f.push(d),C.forEach(d,function(v,I){(!(C.isUndefined(v)||v===null)&&a.call(t,v,C.isString(I)?I.trim():I,w,E))===!0&&k(v,w?w.concat(I):[I])}),f.pop()}}if(!C.isObject(o))throw new TypeError("data must be an object");return k(o),t}function ts(o){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Vt(o,t){this._pairs=[],o&&St(o,this,t)}const Us=Vt.prototype;Us.append=function(t,e){this._pairs.push([t,e])};Us.toString=function(t){const e=t?function(s){return t.call(this,s,ts)}:ts;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function Ad(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ls(o,t,e){if(!t)return o;const s=e&&e.encode||Ad;C.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=C.isURLSearchParams(t)?t.toString():new Vt(t,e).toString(s),l){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class ss{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Os={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Md=typeof URLSearchParams<"u"?URLSearchParams:Vt,Fd=typeof FormData<"u"?FormData:null,Dd=typeof Blob<"u"?Blob:null,Nd={isBrowser:!0,classes:{URLSearchParams:Md,FormData:Fd,Blob:Dd},protocols:["http","https","file","blob","url","data"]},jt=typeof window<"u"&&typeof document<"u",Lt=typeof navigator=="object"&&navigator||void 0,Ud=jt&&(!Lt||["ReactNative","NativeScript","NS"].indexOf(Lt.product)<0),Ld=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Od=jt&&window.location.href||"http://localhost",Bd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jt,hasStandardBrowserEnv:Ud,hasStandardBrowserWebWorkerEnv:Ld,navigator:Lt,origin:Od},Symbol.toStringTag,{value:"Module"})),Re={...Bd,...Nd};function qd(o,t){return St(o,new Re.classes.URLSearchParams,{visitor:function(e,s,a,l){return Re.isNode&&C.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Hd(o){return C.matchAll(/\w+|\[(\w*)]/g,o).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Vd(o){const t={},e=Object.keys(o);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=o[l];return t}function Bs(o){function t(e,s,a,l){let i=e[l++];if(i==="__proto__")return!0;const m=Number.isFinite(+i),b=l>=e.length;return i=!i&&C.isArray(a)?a.length:i,b?(C.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!m):((!a[i]||!C.isObject(a[i]))&&(a[i]=[]),t(e,s,a[i],l)&&C.isArray(a[i])&&(a[i]=Vd(a[i])),!m)}if(C.isFormData(o)&&C.isFunction(o.entries)){const e={};return C.forEachEntry(o,(s,a)=>{t(Hd(s),a,e,0)}),e}return null}function jd(o,t,e){if(C.isString(o))try{return(t||JSON.parse)(o),C.trim(o)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(o)}const ut={transitional:Os,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=C.isObject(t);if(l&&C.isHTMLForm(t)&&(t=new FormData(t)),C.isFormData(t))return a?JSON.stringify(Bs(t)):t;if(C.isArrayBuffer(t)||C.isBuffer(t)||C.isStream(t)||C.isFile(t)||C.isBlob(t)||C.isReadableStream(t))return t;if(C.isArrayBufferView(t))return t.buffer;if(C.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let m;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return qd(t,this.formSerializer).toString();if((m=C.isFileList(t))||s.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return St(m?{"files[]":t}:t,b&&new b,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),jd(t)):t}],transformResponse:[function(t){const e=this.transitional||ut.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(t)||C.isReadableStream(t))return t;if(t&&C.isString(t)&&(s&&!this.responseType||a)){const i=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(m){if(i)throw m.name==="SyntaxError"?oe.from(m,oe.ERR_BAD_RESPONSE,this,null,this.response):m}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],o=>{ut.headers[o]={}});const zd=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Wd=o=>{const t={};let e,s,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),e=i.substring(0,a).trim().toLowerCase(),s=i.substring(a+1).trim(),!(!e||t[e]&&zd[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},os=Symbol("internals");function at(o){return o&&String(o).trim().toLowerCase()}function vt(o){return o===!1||o==null?o:C.isArray(o)?o.map(vt):String(o)}function Gd(o){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(o);)t[s[1]]=s[2];return t}const Kd=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function Rt(o,t,e,s,a){if(C.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!C.isString(t)){if(C.isString(s))return t.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(t)}}function Jd(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Xd(o,t){const e=C.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(o,s+e,{value:function(a,l,i){return this[s].call(this,t,a,l,i)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(m,b,r){const c=at(b);if(!c)throw new Error("header name must be a non-empty string");const f=C.findKey(a,c);(!f||a[f]===void 0||r===!0||r===void 0&&a[f]!==!1)&&(a[f||b]=vt(m))}const i=(m,b)=>C.forEach(m,(r,c)=>l(r,c,b));if(C.isPlainObject(t)||t instanceof this.constructor)i(t,e);else if(C.isString(t)&&(t=t.trim())&&!Kd(t))i(Wd(t),e);else if(C.isObject(t)&&C.isIterable(t)){let m={},b,r;for(const c of t){if(!C.isArray(c))throw TypeError("Object iterator must return a key-value pair");m[r=c[0]]=(b=m[r])?C.isArray(b)?[...b,c[1]]:[b,c[1]]:c[1]}i(m,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=at(t),t){const s=C.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return Gd(a);if(C.isFunction(e))return e.call(this,a,s);if(C.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=at(t),t){const s=C.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Rt(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(i){if(i=at(i),i){const m=C.findKey(s,i);m&&(!e||Rt(s,s[m],m,e))&&(delete s[m],a=!0)}}return C.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Rt(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return C.forEach(this,(a,l)=>{const i=C.findKey(s,l);if(i){e[i]=vt(a),delete e[l];return}const m=t?Jd(l):String(l).trim();m!==l&&delete e[l],e[m]=vt(a),s[m]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return C.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&C.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[os]=this[os]={accessors:{}}).accessors,a=this.prototype;function l(i){const m=at(i);s[m]||(Xd(a,i),s[m]=!0)}return C.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(Fe.prototype,({value:o},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>o,set(s){this[e]=s}}});C.freezeMethods(Fe);function xt(o,t){const e=this||ut,s=t||e,a=Fe.from(s.headers);let l=s.data;return C.forEach(o,function(m){l=m.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function qs(o){return!!(o&&o.__CANCEL__)}function ot(o,t,e){oe.call(this,o??"canceled",oe.ERR_CANCELED,t,e),this.name="CanceledError"}C.inherits(ot,oe,{__CANCEL__:!0});function Hs(o,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?o(e):t(new oe("Request failed with status code "+e.status,[oe.ERR_BAD_REQUEST,oe.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Yd(o){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return t&&t[1]||""}function Qd(o,t){o=o||10;const e=new Array(o),s=new Array(o);let a=0,l=0,i;return t=t!==void 0?t:1e3,function(b){const r=Date.now(),c=s[l];i||(i=r),e[a]=b,s[a]=r;let f=l,E=0;for(;f!==a;)E+=e[f++],f=f%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),r-i<t)return;const k=c&&r-c;return k?Math.round(E*1e3/k):void 0}}function Zd(o,t){let e=0,s=1e3/t,a,l;const i=(r,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),o(...r)};return[(...r)=>{const c=Date.now(),f=c-e;f>=s?i(r,c):(a=r,l||(l=setTimeout(()=>{l=null,i(a)},s-f)))},()=>a&&i(a)]}const bt=(o,t,e=3)=>{let s=0;const a=Qd(50,250);return Zd(l=>{const i=l.loaded,m=l.lengthComputable?l.total:void 0,b=i-s,r=a(b),c=i<=m;s=i;const f={loaded:i,total:m,progress:m?i/m:void 0,bytes:b,rate:r||void 0,estimated:r&&m&&c?(m-i)/r:void 0,event:l,lengthComputable:m!=null,[t?"download":"upload"]:!0};o(f)},e)},ns=(o,t)=>{const e=o!=null;return[s=>t[0]({lengthComputable:e,total:o,loaded:s}),t[1]]},as=o=>(...t)=>C.asap(()=>o(...t)),ep=Re.hasStandardBrowserEnv?((o,t)=>e=>(e=new URL(e,Re.origin),o.protocol===e.protocol&&o.host===e.host&&(t||o.port===e.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,tp=Re.hasStandardBrowserEnv?{write(o,t,e,s,a,l,i){if(typeof document>"u")return;const m=[`${o}=${encodeURIComponent(t)}`];C.isNumber(e)&&m.push(`expires=${new Date(e).toUTCString()}`),C.isString(s)&&m.push(`path=${s}`),C.isString(a)&&m.push(`domain=${a}`),l===!0&&m.push("secure"),C.isString(i)&&m.push(`SameSite=${i}`),document.cookie=m.join("; ")},read(o){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function sp(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function op(o,t){return t?o.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):o}function Vs(o,t,e){let s=!sp(t);return o&&(s||e==!1)?op(o,t):t}const ls=o=>o instanceof Fe?{...o}:o;function Ge(o,t){t=t||{};const e={};function s(r,c,f,E){return C.isPlainObject(r)&&C.isPlainObject(c)?C.merge.call({caseless:E},r,c):C.isPlainObject(c)?C.merge({},c):C.isArray(c)?c.slice():c}function a(r,c,f,E){if(C.isUndefined(c)){if(!C.isUndefined(r))return s(void 0,r,f,E)}else return s(r,c,f,E)}function l(r,c){if(!C.isUndefined(c))return s(void 0,c)}function i(r,c){if(C.isUndefined(c)){if(!C.isUndefined(r))return s(void 0,r)}else return s(void 0,c)}function m(r,c,f){if(f in t)return s(r,c);if(f in o)return s(void 0,r)}const b={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:m,headers:(r,c,f)=>a(ls(r),ls(c),f,!0)};return C.forEach(Object.keys({...o,...t}),function(c){const f=b[c]||a,E=f(o[c],t[c],c);C.isUndefined(E)&&f!==m||(e[c]=E)}),e}const js=o=>{const t=Ge({},o);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:m}=t;if(t.headers=i=Fe.from(i),t.url=Ls(Vs(t.baseURL,t.url,t.allowAbsoluteUrls),o.params,o.paramsSerializer),m&&i.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),C.isFormData(e)){if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(C.isFunction(e.getHeaders)){const b=e.getHeaders(),r=["content-type","content-length"];Object.entries(b).forEach(([c,f])=>{r.includes(c.toLowerCase())&&i.set(c,f)})}}if(Re.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(t)),s||s!==!1&&ep(t.url))){const b=a&&l&&tp.read(l);b&&i.set(a,b)}return t},np=typeof XMLHttpRequest<"u",ap=np&&function(o){return new Promise(function(e,s){const a=js(o);let l=a.data;const i=Fe.from(a.headers).normalize();let{responseType:m,onUploadProgress:b,onDownloadProgress:r}=a,c,f,E,k,d;function w(){k&&k(),d&&d(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function v(){if(!y)return;const O=Fe.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),T={data:!m||m==="text"||m==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:O,config:o,request:y};Hs(function(U){e(U),w()},function(U){s(U),w()},T),y=null}"onloadend"in y?y.onloadend=v:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(v)},y.onabort=function(){y&&(s(new oe("Request aborted",oe.ECONNABORTED,o,y)),y=null)},y.onerror=function(W){const T=W&&W.message?W.message:"Network Error",R=new oe(T,oe.ERR_NETWORK,o,y);R.event=W||null,s(R),y=null},y.ontimeout=function(){let W=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const T=a.transitional||Os;a.timeoutErrorMessage&&(W=a.timeoutErrorMessage),s(new oe(W,T.clarifyTimeoutError?oe.ETIMEDOUT:oe.ECONNABORTED,o,y)),y=null},l===void 0&&i.setContentType(null),"setRequestHeader"in y&&C.forEach(i.toJSON(),function(W,T){y.setRequestHeader(T,W)}),C.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),m&&m!=="json"&&(y.responseType=a.responseType),r&&([E,d]=bt(r,!0),y.addEventListener("progress",E)),b&&y.upload&&([f,k]=bt(b),y.upload.addEventListener("progress",f),y.upload.addEventListener("loadend",k)),(a.cancelToken||a.signal)&&(c=O=>{y&&(s(!O||O.type?new ot(null,o,y):O),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const I=Yd(a.url);if(I&&Re.protocols.indexOf(I)===-1){s(new oe("Unsupported protocol "+I+":",oe.ERR_BAD_REQUEST,o));return}y.send(l||null)})},lp=(o,t)=>{const{length:e}=o=o?o.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(r){if(!a){a=!0,m();const c=r instanceof Error?r:this.reason;s.abort(c instanceof oe?c:new ot(c instanceof Error?c.message:c))}};let i=t&&setTimeout(()=>{i=null,l(new oe(`timeout ${t} of ms exceeded`,oe.ETIMEDOUT))},t);const m=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(r=>{r.unsubscribe?r.unsubscribe(l):r.removeEventListener("abort",l)}),o=null)};o.forEach(r=>r.addEventListener("abort",l));const{signal:b}=s;return b.unsubscribe=()=>C.asap(m),b}},rp=function*(o,t){let e=o.byteLength;if(e<t){yield o;return}let s=0,a;for(;s<e;)a=s+t,yield o.slice(s,a),s=a},ip=async function*(o,t){for await(const e of cp(o))yield*rp(e,t)},cp=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const t=o.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},rs=(o,t,e,s)=>{const a=ip(o,t);let l=0,i,m=b=>{i||(i=!0,s&&s(b))};return new ReadableStream({async pull(b){try{const{done:r,value:c}=await a.next();if(r){m(),b.close();return}let f=c.byteLength;if(e){let E=l+=f;e(E)}b.enqueue(new Uint8Array(c))}catch(r){throw m(r),r}},cancel(b){return m(b),a.return()}},{highWaterMark:2})},is=64*1024,{isFunction:mt}=C,up=(({Request:o,Response:t})=>({Request:o,Response:t}))(C.global),{ReadableStream:cs,TextEncoder:us}=C.global,ds=(o,...t)=>{try{return!!o(...t)}catch{return!1}},dp=o=>{o=C.merge.call({skipUndefined:!0},up,o);const{fetch:t,Request:e,Response:s}=o,a=t?mt(t):typeof fetch=="function",l=mt(e),i=mt(s);if(!a)return!1;const m=a&&mt(cs),b=a&&(typeof us=="function"?(d=>w=>d.encode(w))(new us):async d=>new Uint8Array(await new e(d).arrayBuffer())),r=l&&m&&ds(()=>{let d=!1;const w=new e(Re.origin,{body:new cs,method:"POST",get duplex(){return d=!0,"half"}}).headers.has("Content-Type");return d&&!w}),c=i&&m&&ds(()=>C.isReadableStream(new s("").body)),f={stream:c&&(d=>d.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(d=>{!f[d]&&(f[d]=(w,y)=>{let v=w&&w[d];if(v)return v.call(w);throw new oe(`Response type '${d}' is not supported`,oe.ERR_NOT_SUPPORT,y)})});const E=async d=>{if(d==null)return 0;if(C.isBlob(d))return d.size;if(C.isSpecCompliantForm(d))return(await new e(Re.origin,{method:"POST",body:d}).arrayBuffer()).byteLength;if(C.isArrayBufferView(d)||C.isArrayBuffer(d))return d.byteLength;if(C.isURLSearchParams(d)&&(d=d+""),C.isString(d))return(await b(d)).byteLength},k=async(d,w)=>{const y=C.toFiniteNumber(d.getContentLength());return y??E(w)};return async d=>{let{url:w,method:y,data:v,signal:I,cancelToken:O,timeout:W,onDownloadProgress:T,onUploadProgress:R,responseType:U,headers:x,withCredentials:q="same-origin",fetchOptions:_}=js(d),P=t||fetch;U=U?(U+"").toLowerCase():"text";let $=lp([I,O&&O.toAbortSignal()],W),N=null;const j=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let Q;try{if(R&&r&&y!=="get"&&y!=="head"&&(Q=await k(x,v))!==0){let $e=new e(w,{method:"POST",body:v,duplex:"half"}),B;if(C.isFormData(v)&&(B=$e.headers.get("content-type"))&&x.setContentType(B),$e.body){const[H,z]=ns(Q,bt(as(R)));v=rs($e.body,is,H,z)}}C.isString(q)||(q=q?"include":"omit");const me=l&&"credentials"in e.prototype,Ie={..._,signal:$,method:y.toUpperCase(),headers:x.normalize().toJSON(),body:v,duplex:"half",credentials:me?q:void 0};N=l&&new e(w,Ie);let be=await(l?P(N,_):P(w,Ie));const Pe=c&&(U==="stream"||U==="response");if(c&&(T||Pe&&j)){const $e={};["status","statusText","headers"].forEach(Y=>{$e[Y]=be[Y]});const B=C.toFiniteNumber(be.headers.get("content-length")),[H,z]=T&&ns(B,bt(as(T),!0))||[];be=new s(rs(be.body,is,H,()=>{z&&z(),j&&j()}),$e)}U=U||"text";let qe=await f[C.findKey(f,U)||"text"](be,d);return!Pe&&j&&j(),await new Promise(($e,B)=>{Hs($e,B,{data:qe,headers:Fe.from(be.headers),status:be.status,statusText:be.statusText,config:d,request:N})})}catch(me){throw j&&j(),me&&me.name==="TypeError"&&/Load failed|fetch/i.test(me.message)?Object.assign(new oe("Network Error",oe.ERR_NETWORK,d,N),{cause:me.cause||me}):oe.from(me,me&&me.code,d,N)}}},pp=new Map,zs=o=>{let t=o&&o.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let i=l.length,m=i,b,r,c=pp;for(;m--;)b=l[m],r=c.get(b),r===void 0&&c.set(b,r=m?new Map:dp(t)),c=r;return r};zs();const zt={http:Id,xhr:ap,fetch:{get:zs}};C.forEach(zt,(o,t)=>{if(o){try{Object.defineProperty(o,"name",{value:t})}catch{}Object.defineProperty(o,"adapterName",{value:t})}});const ps=o=>`- ${o}`,mp=o=>C.isFunction(o)||o===null||o===!1;function hp(o,t){o=C.isArray(o)?o:[o];const{length:e}=o;let s,a;const l={};for(let i=0;i<e;i++){s=o[i];let m;if(a=s,!mp(s)&&(a=zt[(m=String(s)).toLowerCase()],a===void 0))throw new oe(`Unknown adapter '${m}'`);if(a&&(C.isFunction(a)||(a=a.get(t))))break;l[m||"#"+i]=a}if(!a){const i=Object.entries(l).map(([b,r])=>`adapter ${b} `+(r===!1?"is not supported by the environment":"is not available in the build"));let m=e?i.length>1?`since :
`+i.map(ps).join(`
`):" "+ps(i[0]):"as no adapter specified";throw new oe("There is no suitable adapter to dispatch the request "+m,"ERR_NOT_SUPPORT")}return a}const Ws={getAdapter:hp,adapters:zt};function At(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new ot(null,o)}function ms(o){return At(o),o.headers=Fe.from(o.headers),o.data=xt.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Ws.getAdapter(o.adapter||ut.adapter,o)(o).then(function(s){return At(o),s.data=xt.call(o,o.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return qs(s)||(At(o),s&&s.response&&(s.response.data=xt.call(o,o.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const Gs="1.13.2",Pt={};["object","boolean","number","function","string","symbol"].forEach((o,t)=>{Pt[o]=function(s){return typeof s===o||"a"+(t<1?"n ":" ")+o}});const hs={};Pt.transitional=function(t,e,s){function a(l,i){return"[Axios v"+Gs+"] Transitional option '"+l+"'"+i+(s?". "+s:"")}return(l,i,m)=>{if(t===!1)throw new oe(a(i," has been removed"+(e?" in "+e:"")),oe.ERR_DEPRECATED);return e&&!hs[i]&&(hs[i]=!0,console.warn(a(i," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,i,m):!0}};Pt.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function fp(o,t,e){if(typeof o!="object")throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);const s=Object.keys(o);let a=s.length;for(;a-- >0;){const l=s[a],i=t[l];if(i){const m=o[l],b=m===void 0||i(m,l,o);if(b!==!0)throw new oe("option "+l+" must be "+b,oe.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new oe("Unknown option "+l,oe.ERR_BAD_OPTION)}}const gt={assertOptions:fp,validators:Pt},Be=gt.validators;let We=class{constructor(t){this.defaults=t||{},this.interceptors={request:new ss,response:new ss}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Ge(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&gt.assertOptions(s,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),a!=null&&(C.isFunction(a)?e.paramsSerializer={serialize:a}:gt.assertOptions(a,{encode:Be.function,serialize:Be.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),gt.assertOptions(e,{baseUrl:Be.spelling("baseURL"),withXsrfToken:Be.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let i=l&&C.merge(l.common,l[e.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],d=>{delete l[d]}),e.headers=Fe.concat(i,l);const m=[];let b=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(e)===!1||(b=b&&w.synchronous,m.unshift(w.fulfilled,w.rejected))});const r=[];this.interceptors.response.forEach(function(w){r.push(w.fulfilled,w.rejected)});let c,f=0,E;if(!b){const d=[ms.bind(this),void 0];for(d.unshift(...m),d.push(...r),E=d.length,c=Promise.resolve(e);f<E;)c=c.then(d[f++],d[f++]);return c}E=m.length;let k=e;for(;f<E;){const d=m[f++],w=m[f++];try{k=d(k)}catch(y){w.call(this,y);break}}try{c=ms.call(this,k)}catch(d){return Promise.reject(d)}for(f=0,E=r.length;f<E;)c=c.then(r[f++],r[f++]);return c}getUri(t){t=Ge(this.defaults,t);const e=Vs(t.baseURL,t.url,t.allowAbsoluteUrls);return Ls(e,t.params,t.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(t){We.prototype[t]=function(e,s){return this.request(Ge(s||{},{method:t,url:e,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(t){function e(s){return function(l,i,m){return this.request(Ge(m||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}We.prototype[t]=e(),We.prototype[t+"Form"]=e(!0)});let vp=class Ks{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(m=>{s.subscribe(m),l=m}).then(a);return i.cancel=function(){s.unsubscribe(l)},i},t(function(l,i,m){s.reason||(s.reason=new ot(l,i,m),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Ks(function(a){t=a}),cancel:t}}};function gp(o){return function(e){return o.apply(null,e)}}function yp(o){return C.isObject(o)&&o.isAxiosError===!0}const Ot={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Ot).forEach(([o,t])=>{Ot[t]=o});function Js(o){const t=new We(o),e=Es(We.prototype.request,t);return C.extend(e,We.prototype,t,{allOwnKeys:!0}),C.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Js(Ge(o,a))},e}const Se=Js(ut);Se.Axios=We;Se.CanceledError=ot;Se.CancelToken=vp;Se.isCancel=qs;Se.VERSION=Gs;Se.toFormData=St;Se.AxiosError=oe;Se.Cancel=Se.CanceledError;Se.all=function(t){return Promise.all(t)};Se.spread=gp;Se.isAxiosError=yp;Se.mergeConfig=Ge;Se.AxiosHeaders=Fe;Se.formToJSON=o=>Bs(C.isHTMLForm(o)?new FormData(o):o);Se.getAdapter=Ws.getAdapter;Se.HttpStatusCode=Ot;Se.default=Se;const{Axios:Pf,AxiosError:Tf,CanceledError:Ef,isCancel:kf,CancelToken:Cf,VERSION:If,all:Rf,Cancel:xf,isAxiosError:Af,spread:Mf,toFormData:Ff,AxiosHeaders:Df,HttpStatusCode:Nf,formToJSON:Uf,getAdapter:Lf,mergeConfig:Of}=Se;class bp{static async getAvailableModels(){try{return(await Se({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const _p={class:"assigned-tools"},wp={class:"section-header"},$p=["title"],Sp={class:"tool-info"},Pp={class:"tool-name"},Tp=["title"],Ep={key:0,class:"no-tools"},kp=Te({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(o,{emit:t}){const e=o,s=t,a=lt(),l=se(()=>a.availableTools.value);De(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const i=se(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(r=>l.value.some(c=>c.key===r)):[]);ve(i,r=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;r.length!==c&&s("tools-filtered",r)},{immediate:!0});const m=r=>{const c=l.value.find(E=>E.key===r);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:r},b=r=>{const c=l.value.find(f=>f.key===r);return c?c.description:""};return(r,c)=>(h(),g("div",_p,[n("div",wp,[n("span",null,u(r.title)+" ("+u(i.value.length)+")",1),r.showAddButton?(h(),g("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=f=>r.$emit("add-tools"))},[A(p(F),{icon:"carbon:add"}),ce(" "+u(r.addButtonText),1)])):V("",!0)]),n("div",{class:ue(["tools-grid",{"grid-layout":r.useGridLayout,"has-more-items":r.useGridLayout&&i.value.length>2}])},[(h(!0),g(de,null,fe(i.value,f=>(h(),g("div",{key:f,class:"tool-item assigned",title:b(f)},[n("div",Sp,[n("span",Pp,u(m(f)),1),n("span",{class:"tool-desc",title:b(f)},u(b(f)),9,Tp)])],8,$p))),128)),i.value.length===0?(h(),g("div",Ep,[A(p(F),{icon:"carbon:tool-box"}),n("span",null,u(r.emptyText),1)])):V("",!0)],2)]))}}),Cp=Ee(kp,[["__scopeId","data-v-62354a05"]]),Ip={class:"tool-selection-content"},Rp={class:"tool-controls"},xp={class:"search-container"},Ap=["placeholder"],Mp={class:"sort-container"},Fp={value:"group"},Dp={value:"name"},Np={value:"enabled"},Up={class:"tool-summary"},Lp={class:"summary-text"},Op={key:0,class:"tool-groups"},Bp=["onClick"],qp={class:"group-title-area"},Hp={class:"group-name"},Vp={class:"group-count"},jp={class:"group-enable-all"},zp=["checked","onChange","data-group"],Wp={class:"enable-label"},Gp={class:"tool-info"},Kp={class:"tool-selection-name"},Jp={key:0,class:"tool-selection-desc"},Xp={class:"tool-actions"},Yp=["checked","onChange"],Qp={key:1,class:"empty-state"},Zp=Te({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(o,{emit:t}){const e=o,s=t,a=lt(),l=se(()=>a.availableTools.value);De(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),ve(()=>e.modelValue,_=>{_&&!a.isLoading.value&&a.loadAvailableTools()});const i=se({get:()=>e.modelValue,set:_=>s("update:modelValue",_)}),m=M(""),b=M("group"),r=M(new Set),c=M([]),f=M(null),E=(_,P)=>{const $=document.querySelector(`input[data-group="${_}"]`);$&&($.indeterminate=T(P))};ve(()=>e.selectedToolIds,_=>{c.value=[..._]},{immediate:!0});const k=se(()=>{let _=l.value.filter(P=>P.key);if(_=_.filter(P=>P.selectable===!0),m.value){const P=m.value.toLowerCase();_=_.filter($=>$.name.toLowerCase().includes(P)||$.description.toLowerCase().includes(P)||$.serviceGroup.toLowerCase().includes(P))}switch(b.value){case"name":_=[..._].sort((P,$)=>P.name.localeCompare($.name));break;case"enabled":_=[..._].sort((P,$)=>{const N=c.value.includes(P.key),j=c.value.includes($.key);return N&&!j?-1:!N&&j?1:P.name.localeCompare($.name)});break;case"group":default:_=[..._].sort((P,$)=>{const N=P.serviceGroup||"Ungrouped",j=$.serviceGroup||"Ungrouped";return N!==j?N.localeCompare(j):P.name.localeCompare($.name)});break}return _}),d=se(()=>{const _=new Map;return l.value.filter($=>$.key&&$.selectable===!0).forEach($=>{const N=$.serviceGroup||"Ungrouped";_.has(N)||_.set(N,[]),_.get(N).push($)}),_}),w=se(()=>{const _=new Map;return k.value.forEach(P=>{const $=P.serviceGroup||"Ungrouped";_.has($)||_.set($,[]),_.get($).push(P)}),new Map([..._.entries()].sort())}),y=se(()=>k.value.length);ve([c,w],()=>{Ae(()=>{for(const[_,P]of w.value)E(_,P)})},{flush:"post",deep:!1});const v=_=>c.value.includes(_),I=(_,P)=>{P.stopPropagation();const N=P.target.checked;if(!_){console.error("toolKey is undefined, cannot proceed");return}N?c.value.includes(_)||(c.value=[...c.value,_]):c.value=c.value.filter(j=>j!==_)},O=_=>_.filter(P=>c.value.includes(P.key)),W=_=>_.length>0&&_.every(P=>c.value.includes(P.key)),T=_=>{const P=O(_).length;return P>0&&P<_.length},R=(_,P)=>{P.stopPropagation();const N=P.target.checked,j=_.map(Q=>Q.key);if(N){const Q=[...c.value];j.forEach(me=>{Q.includes(me)||Q.push(me)}),c.value=Q}else c.value=c.value.filter(Q=>!j.includes(Q))},U=_=>{r.value.has(_)?r.value.delete(_):r.value.add(_)},x=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},q=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return ve(m,_=>{const P=_.trim().toLowerCase();if(P){f.value===null&&(f.value=new Set(r.value));for(const[$,N]of d.value)N.some(Q=>Q.name.toLowerCase().includes(P)||Q.description&&Q.description.toLowerCase().includes(P)||Q.serviceGroup&&Q.serviceGroup.toLowerCase().includes(P))&&r.value.delete($)}else f.value!==null&&(r.value=new Set(f.value),f.value=null)}),ve(i,_=>{if(_){r.value.clear(),f.value=null;const P=Array.from(w.value.keys());P.length>1&&P.slice(1).forEach($=>{r.value.add($)})}}),(_,P)=>(h(),we(ys,{modelValue:i.value,"onUpdate:modelValue":[P[4]||(P[4]=$=>i.value=$),q],title:_.$t("toolSelection.title"),onConfirm:x},{default:Ye(()=>[n("div",Ip,[n("div",Rp,[n("div",xp,[ye(n("input",{"onUpdate:modelValue":P[0]||(P[0]=$=>m.value=$),type:"text",class:"search-input",placeholder:_.$t("toolSelection.searchPlaceholder")},null,8,Ap),[[ke,m.value]])]),n("div",Mp,[ye(n("select",{"onUpdate:modelValue":P[1]||(P[1]=$=>b.value=$),class:"sort-select"},[n("option",Fp,u(_.$t("toolSelection.sortByGroup")),1),n("option",Dp,u(_.$t("toolSelection.sortByName")),1),n("option",Np,u(_.$t("toolSelection.sortByStatus")),1)],512),[[Bt,b.value]])])]),n("div",Up,[n("span",Lp,u(_.$t("toolSelection.summary",{groups:w.value.size,tools:y.value,selected:c.value.length})),1)]),w.value.size>0?(h(),g("div",Op,[(h(!0),g(de,null,fe(w.value,([$,N])=>(h(),g("div",{key:$,class:"tool-group"},[n("div",{class:ue(["tool-group-header",{collapsed:r.value.has($)}]),onClick:j=>U($)},[n("div",qp,[A(p(F),{icon:r.value.has($)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(p(F),{icon:"carbon:folder",class:"group-icon"}),n("span",Hp,u($),1),n("span",Vp," ("+u(O(N).length)+"/"+u(N.length)+") ",1)]),n("div",{class:"group-actions",onClick:P[2]||(P[2]=_e(()=>{},["stop"]))},[n("label",jp,[n("input",{type:"checkbox",class:"group-enable-checkbox",checked:W(N),onChange:j=>R(N,j),"data-group":$},null,40,zp),n("span",Wp,u(_.$t("toolSelection.enableAll")),1)])])],10,Bp),n("div",{class:ue(["tool-group-content",{collapsed:r.value.has($)}])},[(h(!0),g(de,null,fe(N,j=>(h(),g("div",{key:j.key,class:"tool-selection-item"},[n("div",Gp,[n("div",Kp,u(j.name),1),j.description?(h(),g("div",Jp,u(j.description),1)):V("",!0)]),n("div",Xp,[n("label",{class:"tool-enable-switch",onClick:P[3]||(P[3]=_e(()=>{},["stop"]))},[n("input",{type:"checkbox",class:"tool-enable-checkbox",checked:v(j.key),onChange:Q=>I(j.key,Q)},null,40,Yp),P[5]||(P[5]=n("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),g("div",Qp,[A(p(F),{icon:"carbon:tools",class:"empty-icon"}),n("p",null,u(_.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),em=Ee(Zp,[["__scopeId","data-v-627b463f"]]),tm={class:"config-section"},sm={class:"section-header"},om={class:"visual-editor"},nm={class:"plan-basic-info"},am={class:"form-row"},lm={class:"form-label"},rm=["placeholder"],im={key:0,class:"field-error-message"},cm={class:"form-row"},um={class:"form-label"},dm={class:"service-group-autocomplete"},pm=["placeholder"],mm={key:0,class:"service-group-dropdown"},hm=["onMousedown"],fm={class:"field-description"},vm={class:"steps-section"},gm={class:"steps-container"},ym={class:"step-content"},bm={class:"form-row"},_m={class:"form-label"},wm=["value","onInput","placeholder"],$m={class:"form-row"},Sm={class:"form-label"},Pm=["value","onInput","placeholder"],Tm={key:0,class:"preview-section"},Em={class:"preview-label"},km={class:"preview-content"},Cm={class:"preview-text"},Im={class:"preview-table-header"},Rm={class:"form-row"},xm={class:"form-label"},Am={class:"model-selector-wrapper"},Mm={class:"model-input-wrapper"},Fm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Dm={key:0,class:"dropdown-item disabled"},Nm={key:1,class:"dropdown-item disabled error"},Um={key:2,class:"dropdown-item disabled"},Lm=["onClick","onMouseenter"],Om=["onClick","onMouseenter"],Bm=["title"],qm={key:0,class:"error-message"},Hm={class:"form-row"},Vm={key:0,class:"empty-steps"},jm={class:"empty-text"},zm={key:0,class:"json-preview"},Wm={class:"preview-header"},Gm={class:"form-label"},Km={class:"json-code"},Jm={class:"editor-footer"},Xm={class:"section-actions"},Ym=["disabled","title"],Qm=["disabled","title"],Zm=["disabled","title"],eh=["disabled"],th={class:"modal-header"},sh={class:"modal-body"},oh={class:"form-row"},nh={class:"form-label"},ah=["placeholder"],lh={class:"modal-footer"},rh=["disabled"],ih=Te({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(o,{expose:t}){const{t:e}=Ne(),s=bs(),a=Ze(),l=je({title:"",steps:[]}),i=M(!1),m=M(!1),b=M([]),r=M(!1),c=M(""),f=se(()=>a.generateJsonString()),E=M(!1),k=()=>{E.value=!0;try{const S=a.getConfig();(S.title?.trim()||!l.title?.trim())&&(l.title=S.title||""),l.steps=S.steps||[],c.value=S.serviceGroup||""}finally{setTimeout(()=>{E.value=!1},0)}},d=()=>{E.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(le.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{E.value=!1},0)}},w=()=>{i.value=!i.value},y=()=>{i.value=!1},v=()=>{try{a.rollbackVersion()}catch(S){console.error("Error during rollback operation:",S),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},I=()=>{try{a.restoreVersion()}catch(S){console.error("Error during restore operation:",S),s.error(e("sidebar.restoreFailed")||"Restore failed")}},O=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}d();const S=a.validate();if(!S.isValid){s.error(`Invalid format, please correct and save.
Errors: `+S.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const ae=a.generateJsonString().trim();a.updateVersionsAfterSave(ae);const ie=a.planVersions.value.length;le.hasTaskRequirementModified=!1,await le.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ie}))}catch(S){console.error("Failed to save plan modifications:",S);const G=S instanceof Error?S.message:e("sidebar.saveFailed");throw s.error(G),S}},W=M(""),T=()=>{const S={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push(S),a.setStepsWithGuard(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},R=M([]),U=M(!1),x=M(""),q=M(new Map),_=M(new Set),P=M(new Map),$=S=>q.value.get(S)??"",N=(S,G)=>{q.value.set(S,G)},j=S=>{const G=$(S);if(!G.trim())return R.value;const X=G.toLowerCase().trim();return R.value.filter(ae=>ae.value.toLowerCase().includes(X)||ae.label.toLowerCase().includes(X))},Q=S=>{const G=l.steps[S],X=$(S);return _.value.has(S)&&X!==""?X:G.modelName??""},me=S=>U.value||x.value||l.steps[S].modelName?"":e("sidebar.modelNameDescription")||"",Ie=S=>_.value.has(S),be=S=>{U.value||_.value.add(S)},Pe=S=>{_.value.delete(S),P.value.set(S,-1);const G=l.steps[S];N(S,G.modelName??"")},qe=S=>{Ie(S)?Pe(S):be(S)},$e=(S,G)=>{const X=l.steps[G];X.modelName=S,N(G,S),Pe(G)},B=(S,G)=>{const X=S.target;N(G,X.value),be(G)},H=S=>P.value.get(S)??-1,z=(S,G)=>{P.value.set(S,G)},Y=S=>{const G=H(S),X=j(S);G>=0&&G<X.length?$e(X[G].value,S):G===-1?$e("",S):X.length>0?$e(X[0].value,S):l.steps[S].modelName||$e("",S)},ne=S=>{if(!Ie(S)){be(S),z(S,0);return}const X=j(S).length+1,ae=H(S),ie=Math.min(ae+1,X-1);z(S,ie)},re=S=>{if(!Ie(S)){be(S);const ae=j(S);z(S,ae.length);return}const G=H(S),X=Math.max(G-1,-1);z(S,X)},he=S=>{S.target.closest(".model-selector")||_.value.clear()};ve(()=>l.steps,S=>{S.forEach((G,X)=>{q.value.has(X)||N(X,G.modelName??"")})},{deep:!0,immediate:!0});const D=M(!1),K=M(-1),J=async()=>{if(!U.value){U.value=!0,x.value="";try{const S=await bp.getAvailableModels();R.value=S.options}catch(S){console.error("Failed to load models:",S),x.value=S instanceof Error?S.message:"Failed to load models",R.value=[]}finally{U.value=!1}}},L=S=>{K.value=S,D.value=!0},ee=S=>{K.value>=0&&K.value<l.steps.length&&(l.steps[K.value].selectedToolKeys=[...S]),D.value=!1,K.value=-1},Z=(S,G)=>{S>=0&&S<l.steps.length&&(l.steps[S].selectedToolKeys=[...G])},pe=M(!1),te=M(""),ge=M(!1),He=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}te.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),pe.value=!0},Ve=()=>{pe.value=!1,te.value="",ge.value=!1},dt=S=>{S.target===S.currentTarget&&Ve()},Tt=async()=>{if(!te.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}ge.value=!0;try{const S=a.getConfig(),G=`planTemplate-${Date.now()}`,{toolConfig:X,...ae}=S,ie={...ae,title:te.value.trim(),planTemplateId:G};console.log("[JsonEditorV2] Copying plan without toolConfig:",ie),(await io.createOrUpdatePlanTemplateWithTool(ie)).success?(s.success(e("sidebar.copyPlanSuccess",{title:te.value.trim()})),await le.loadPlanTemplateList(),Ve()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch(S){if(console.error("[JsonEditorV2] Error copying plan:",S),S instanceof Error&&S.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const G=S instanceof Error?S.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:G}))}}finally{ge.value=!1}};ve(()=>l.title,S=>{S?.trim()?W.value="":W.value="Title is required field"},{immediate:!0});const Wt=()=>{const S=a.getServiceGroup()||"";c.value=S};ve(()=>a.config,()=>{!E.value&&!a.isUserUpdating.value&&k()},{deep:!0,immediate:!0}),ve(()=>a.currentPlanTemplateId.value,(S,G)=>{G!=null&&S!==G&&(q.value.clear(),_.value.clear(),P.value.clear(),D.value=!1,pe.value=!1,i.value=!1,K.value=-1,te.value="",ge.value=!1),k(),Wt()},{immediate:!0}),ve(()=>c.value,S=>{E.value=!0;try{a.setServiceGroup(S)}finally{setTimeout(()=>{E.value=!1},0)}});const Xs=async()=>{if(!r.value){r.value=!0;try{const S=await Ps.getAvailableTools(),G=new Set;S.forEach(X=>{X.serviceGroup&&G.add(X.serviceGroup)}),b.value=Array.from(G).sort()}catch(S){console.error("[JsonEditorV2] Failed to load service groups:",S),b.value=[]}finally{r.value=!1}}},Gt=se(()=>{const S=c.value.trim();if(!S)return b.value;const G=S.toLowerCase();return b.value.filter(X=>X.toLowerCase().includes(G))}),Ys=()=>{m.value=!0},Qs=()=>{setTimeout(()=>{m.value=!1},200)},Zs=S=>{c.value=S,m.value=!1};De(()=>{k(),Wt(),Xs(),J(),document.addEventListener("click",he)}),Le(()=>{document.removeEventListener("click",he)}),t({save:O});const Kt=S=>{const G=S.target;G.style.height="auto";const X=20,ae=Math.ceil(G.scrollHeight/X),ie=4,Ke=12,pt=Math.max(ie,Math.min(Ke,ae)),to=pt*X;G.style.height=`${to}px`,G.rows=pt,ae>Ke?G.style.overflowY="auto":G.style.overflowY="hidden"},eo=S=>{if(!S.trim())return"";const G=S.split(",").map(X=>X.trim()).filter(X=>X.length>0);return G.length===0?"":`|${G.join("|")}|`};return(S,G)=>(h(),g("div",tm,[n("div",sm,[A(p(F),{icon:"carbon:code",width:"16"}),n("span",null,u(S.$t("sidebar.dynamicAgentPlan")),1)]),n("div",om,[n("div",nm,[n("div",am,[n("label",lm,u(S.$t("sidebar.title")),1),ye(n("input",{"onUpdate:modelValue":G[0]||(G[0]=X=>l.title=X),type:"text",class:ue(["form-input",{error:W.value}]),placeholder:S.$t("sidebar.titlePlaceholder")},null,10,rm),[[ke,l.title]]),W.value?(h(),g("div",im,[A(p(F),{icon:"carbon:warning",width:"12"}),ce(" "+u(W.value),1)])):V("",!0)]),n("div",cm,[n("label",um,u(S.$t("mcpService.serviceGroup")),1),n("div",dm,[ye(n("input",{type:"text","onUpdate:modelValue":G[1]||(G[1]=X=>c.value=X),onInput:Ys,onFocus:G[2]||(G[2]=X=>m.value=!0),onBlur:Qs,placeholder:S.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,pm),[[ke,c.value]]),m.value&&Gt.value.length>0?(h(),g("div",mm,[(h(!0),g(de,null,fe(Gt.value,X=>(h(),g("div",{key:X,class:"service-group-option",onMousedown:ae=>Zs(X)},u(X),41,hm))),128))])):V("",!0)]),n("div",fm,u(S.$t("mcpService.serviceGroupDescription")),1)])]),n("div",vm,[n("div",gm,[(h(!0),g(de,null,fe(l.steps,(X,ae)=>(h(),g("div",{key:ae,class:"step-item"},[n("div",ym,[n("div",bm,[n("label",_m,u(S.$t("sidebar.stepRequirement")),1),n("textarea",{value:X.stepRequirement||"",onInput:ie=>{X.stepRequirement=ie.target.value,Kt(ie)},class:"form-textarea auto-resize",placeholder:S.$t("sidebar.stepRequirementPlaceholder"),rows:"4"},null,40,wm)]),n("div",$m,[n("label",Sm,u(S.$t("sidebar.terminateColumns")),1),n("textarea",{value:X.terminateColumns||"",onInput:ie=>{X.terminateColumns=ie.target.value,Kt(ie)},class:"form-textarea auto-resize",placeholder:S.$t("sidebar.terminateColumnsPlaceholder"),rows:"4"},null,40,Pm),X.terminateColumns&&X.terminateColumns.trim()?(h(),g("div",Tm,[n("div",Em,u(S.$t("sidebar.preview"))+":",1),n("div",km,[n("div",Cm,[ce(u(S.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),n("span",Im,u(eo(X.terminateColumns)),1)])])])):V("",!0)]),n("div",Rm,[n("label",xm,u(S.$t("sidebar.modelName")),1),n("div",Am,[n("div",{class:ue(["model-selector",{"is-open":Ie(ae),"is-disabled":U.value}])},[n("div",Mm,[n("input",{value:Q(ae),type:"text",class:"form-input model-search-input",placeholder:me(ae),disabled:U.value,onClick:_e(ie=>be(ae),["stop"]),onFocus:ie=>be(ae),onInput:ie=>B(ie,ae),onKeydown:[nt(ie=>Pe(ae),["escape"]),nt(_e(ie=>Y(ae),["prevent"]),["enter"]),nt(_e(ie=>ne(ae),["prevent"]),["down"]),nt(_e(ie=>re(ae),["prevent"]),["up"])]},null,40,Fm),A(p(F),{icon:"carbon:chevron-down",width:"14",class:ue(["dropdown-arrow",{"is-open":Ie(ae)}]),onClick:_e(ie=>qe(ae),["stop"])},null,8,["class","onClick"])]),Ie(ae)?(h(),g("div",{key:0,class:"model-dropdown",onClick:G[3]||(G[3]=_e(()=>{},["stop"]))},[U.value?(h(),g("div",Dm,u(S.$t("sidebar.loading")),1)):x.value?(h(),g("div",Nm,u(S.$t("sidebar.modelLoadError")),1)):j(ae).length===0?(h(),g("div",Um,u(S.$t("sidebar.noModelsFound")),1)):V("",!0),(h(!0),g(de,null,fe(j(ae),(ie,Ke)=>(h(),g("div",{key:ie.value,class:ue(["dropdown-item",{"is-selected":X.modelName===ie.value,"is-highlighted":H(ae)===Ke}]),onClick:pt=>$e(ie.value,ae),onMouseenter:pt=>z(ae,Ke)},[ce(u(ie.value)+" ",1),X.modelName===ie.value?(h(),we(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,Lm))),128)),n("div",{class:ue(["dropdown-item",{"is-selected":!X.modelName,"is-highlighted":H(ae)===-1}]),onClick:ie=>$e("",ae),onMouseenter:ie=>z(ae,-1)},[ce(u(S.$t("sidebar.noModelSelected"))+" ",1),X.modelName?V("",!0):(h(),we(p(F),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Om)])):V("",!0)],2),x.value?(h(),g("button",{key:0,onClick:J,class:"btn btn-sm btn-danger",title:S.$t("sidebar.retryLoadModels")},[A(p(F),{icon:"carbon:warning",width:"14"}),ce(" "+u(S.$t("sidebar.retry")),1)],8,Bm)):V("",!0)]),x.value?(h(),g("div",qm,[A(p(F),{icon:"carbon:warning",width:"12"}),ce(" "+u(x.value),1)])):V("",!0)]),n("div",Hm,[A(Cp,{title:S.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys||[],"add-button-text":S.$t("sidebar.addRemoveTools"),"empty-text":S.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ie=>L(ae),onToolsFiltered:ie=>Z(ae,ie)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),g("div",Vm,[A(p(F),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),n("p",jm,u(S.$t("sidebar.noSteps")),1),n("button",{class:"btn btn-primary btn-add-step",onClick:T},[A(p(F),{icon:"carbon:add",width:"16"}),ce(" "+u(S.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),i.value?(h(),g("div",zm,[n("div",Wm,[n("label",Gm,u(S.$t("sidebar.jsonPreview")),1),n("button",{onClick:y,class:"btn btn-xs"},[A(p(F),{icon:"carbon:close",width:"12"})])]),n("pre",Km,u(f.value),1)])):V("",!0),n("div",Jm,[n("button",{onClick:w,class:"btn btn-sm btn-secondary"},[A(p(F),{icon:"carbon:code",width:"14"}),ce(" "+u(i.value?S.$t("sidebar.hideJson"):S.$t("sidebar.showJson")),1)]),n("div",Xm,[n("button",{class:"btn btn-sm",onClick:He,disabled:S.isGenerating||S.isExecuting,title:S.$t("sidebar.copyPlan")},[A(p(F),{icon:"carbon:copy",width:"14"}),ce(" "+u(S.$t("sidebar.copyPlan")),1)],8,Ym),n("button",{class:"btn btn-sm",onClick:v,disabled:!p(a).canRollback.value,title:S.$t("sidebar.rollback")},[A(p(F),{icon:"carbon:undo",width:"14"})],8,Qm),n("button",{class:"btn btn-sm",onClick:I,disabled:!p(a).canRestore.value,title:S.$t("sidebar.restore")},[A(p(F),{icon:"carbon:redo",width:"14"})],8,Zm),n("button",{class:"btn btn-primary",onClick:O,disabled:S.isGenerating||S.isExecuting},[A(p(F),{icon:"carbon:save",width:"14"}),G[7]||(G[7]=ce(" Save "))],8,eh)])])]),A(em,{modelValue:D.value,"onUpdate:modelValue":G[4]||(G[4]=X=>D.value=X),"selected-tool-ids":K.value>=0?l.steps[K.value]?.selectedToolKeys||[]:[],onConfirm:ee},null,8,["modelValue","selected-tool-ids"]),pe.value?(h(),g("div",{key:0,class:"modal-overlay",onMousedown:dt},[n("div",{class:"modal-content",onMousedown:G[6]||(G[6]=_e(()=>{},["stop"]))},[n("div",th,[n("h3",null,u(S.$t("sidebar.copyPlan")),1),n("button",{class:"close-btn",onClick:Ve},[A(p(F),{icon:"carbon:close",width:"16"})])]),n("div",sh,[n("div",oh,[n("label",nh,u(S.$t("sidebar.newPlanTitle")),1),ye(n("input",{"onUpdate:modelValue":G[5]||(G[5]=X=>te.value=X),type:"text",class:"form-input",placeholder:S.$t("sidebar.enterNewPlanTitle"),onKeyup:nt(Tt,["enter"])},null,40,ah),[[ke,te.value]])])]),n("div",lh,[n("button",{class:"btn btn-secondary",onClick:Ve},u(S.$t("common.cancel")),1),n("button",{class:"btn btn-primary",onClick:Tt,disabled:!te.value.trim()||ge.value},[ge.value?(h(),we(p(F),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),ce(" "+u(ge.value?S.$t("sidebar.copying"):S.$t("sidebar.copyPlan")),1)],8,rh)])],32)],32)):V("",!0)]))}}),ch=Ee(ih,[["__scopeId","data-v-ad24015c"]]),uh={class:"template-list-container"},dh={class:"organization-section"},ph={class:"organization-row"},mh={class:"organization-selector"},hh={class:"organization-label"},fh=["value"],vh={value:"by_time"},gh={value:"by_abc"},yh={value:"by_group_time"},bh={value:"by_group_abc"},_h={class:"search-input-wrapper"},wh={class:"search-label"},$h={class:"search-input-container"},Sh=["placeholder"],Ph=["title"],Th={class:"sidebar-content-list"},Eh={key:0,class:"loading-state"},kh={key:1,class:"error-state"},Ch={key:2,class:"empty-state"},Ih=["onClick","title"],Rh=["onClick","title"],xh={class:"group-name"},Ah={class:"group-count"},Mh=["onClick"],Fh={class:"task-icon"},Dh={class:"task-details"},Nh={class:"task-title"},Uh={class:"task-time"},Lh={class:"task-actions"},Oh=["title","onClick"],Bh=Te({__name:"TemplateList",emits:["templateSelected","templateCreated"],setup(o,{emit:t}){const{t:e}=Ne(),s=Ze(),a=lt(),l=M(""),i=t,m=d=>{const w=d.target;le.setOrganizationMethod(w.value)},b=async()=>{const d=s.getPlanType()||"dynamic_agent";await le.createNewTemplate(d);const w=s.selectedTemplate.value;w&&(s.reset(),s.setPlanType(w.planType||"dynamic_agent"),w.planTemplateId&&s.setPlanTemplateId(w.planTemplateId),s.setTitle(w.title||"")),xe.switchToTab("config"),console.log("[TemplateList] ðŸ”„ Reloading available tools for new template"),await a.loadAvailableTools(),i("templateCreated")},r=d=>{if(isNaN(d.getTime()))return console.warn("Invalid date received:",d),e("time.unknown");const y=new Date().getTime()-d.getTime(),v=Math.floor(y/6e4),I=Math.floor(y/36e5),O=Math.floor(y/864e5);return v<1?e("time.now"):v<60?e("time.minuteAgo",{count:v}):I<24?e("time.hourAgo",{count:I}):O<30?e("time.dayAgo",{count:O}):d.toLocaleDateString("zh-CN")},c=se(()=>{s.planTemplateList.value;const d=l.value.trim().toLowerCase(),w=le.groupedTemplates;if(!d)return w;const y=new Map;for(const[v,I]of w){const O=[];for(const W of I)(W.title||"").toLowerCase().includes(d)&&O.push(W);O.length>0&&y.set(v,O)}return y});ve(l,d=>{s.planTemplateList.value;const w=d.trim().toLowerCase();if(!w||le.organizationMethod!=="by_group_time"&&le.organizationMethod!=="by_group_abc")return;const y=le.groupedTemplates;for(const[v,I]of y){let O=!1;for(const W of I)if((W.title||"").toLowerCase().includes(w)){O=!0;break}O&&le.isGroupCollapsed(v)&&le.toggleGroupCollapse(v)}});const f=d=>{const w=d??"null";return le.groupCollapseState[w]??!1},E=d=>{le.toggleGroupCollapse(d)},k=async d=>{await le.selectTemplate(d),d.planTemplateId?(await s.load(d.planTemplateId),le.hasTaskRequirementModified=!1):(s.reset(),le.hasTaskRequirementModified=!1),xe.switchToTab("config"),i("templateSelected",d)};return(d,w)=>(h(),g("div",uh,[n("div",dh,[n("button",{class:"new-task-btn",onClick:b},[A(p(F),{icon:"carbon:add",width:"16"}),ce(" "+u(d.$t("sidebar.newPlan")),1)]),n("div",ph,[n("div",mh,[n("label",hh,u(d.$t("sidebar.organizationLabel")),1),n("select",{value:p(le).organizationMethod,onChange:m,class:"organization-select"},[n("option",vh,u(d.$t("sidebar.organizationByTime")),1),n("option",gh,u(d.$t("sidebar.organizationByAbc")),1),n("option",yh,u(d.$t("sidebar.organizationByGroupTime")),1),n("option",bh,u(d.$t("sidebar.organizationByGroupAbc")),1)],40,fh)]),n("div",_h,[n("label",wh,u(d.$t("sidebar.searchLabel")),1),n("div",$h,[A(p(F),{icon:"carbon:search",width:"16",class:"search-icon"}),ye(n("input",{"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),type:"text",class:"search-input",placeholder:d.$t("sidebar.searchPlaceholder")||"Search..."},null,8,Sh),[[ke,l.value]]),l.value?(h(),g("button",{key:0,class:"search-clear-btn",onClick:w[1]||(w[1]=y=>l.value=""),title:d.$t("sidebar.clearSearch")||"Clear search"},[A(p(F),{icon:"carbon:close",width:"14"})],8,Ph)):V("",!0)])])])]),n("div",Th,[p(le).isLoading?(h(),g("div",Eh,[A(p(F),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),n("span",null,u(d.$t("sidebar.loading")),1)])):p(le).errorMessage?(h(),g("div",kh,[A(p(F),{icon:"carbon:warning",width:"20"}),n("span",null,u(p(le).errorMessage),1),n("button",{onClick:w[2]||(w[2]=(...y)=>p(le).loadPlanTemplateList&&p(le).loadPlanTemplateList(...y)),class:"retry-btn"},u(d.$t("sidebar.retry")),1)])):p(s).planTemplateList.value.length===0?(h(),g("div",Ch,[A(p(F),{icon:"carbon:document",width:"32"}),n("span",null,u(d.$t("sidebar.noTemplates")),1)])):(h(!0),g(de,{key:3},fe(c.value,([y,v])=>(h(),g(de,{key:y||"ungrouped"},[(p(le).organizationMethod==="by_group_time"||p(le).organizationMethod==="by_group_abc")&&v.length>0?(h(),g("div",{key:0,class:"group-header",onClick:_e(I=>E(y),["prevent"]),title:f(y)?d.$t("sidebar.expandGroup"):d.$t("sidebar.collapseGroup")},[n("button",{type:"button",class:"group-toggle-btn",onClick:_e(I=>E(y),["stop","prevent"]),title:f(y)?d.$t("sidebar.expandGroup"):d.$t("sidebar.collapseGroup")},[A(p(F),{icon:f(y)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Rh),A(p(F),{icon:"carbon:folder",width:"16"}),n("span",xh,u(y===null||y===""?d.$t("sidebar.ungroupedMethods"):y),1),n("span",Ah,"("+u(v.length)+")",1)],8,Ih)):V("",!0),(p(le).organizationMethod==="by_group_time"||p(le).organizationMethod==="by_group_abc")&&f(y)?V("",!0):(h(!0),g(de,{key:1},fe(v,I=>(h(),g("div",{key:I.planTemplateId||"unknown",class:ue(["sidebar-content-list-item",{"sidebar-content-list-item-active":I.planTemplateId===p(s).currentPlanTemplateId.value,"grouped-item":p(le).organizationMethod==="by_group_time"||p(le).organizationMethod==="by_group_abc"}]),onClick:O=>k(I)},[n("div",Fh,[A(p(F),{icon:"carbon:document",width:"20"})]),n("div",Dh,[n("div",Nh,u(I.title||d.$t("sidebar.unnamedPlan")),1)]),n("div",Uh,u(r(p(s).parseDateTime(I.updateTime||I.createTime))),1),n("div",Lh,[n("button",{class:"delete-task-btn",title:d.$t("sidebar.deleteTemplate"),onClick:_e(O=>p(le).deleteTemplate(I),["stop"])},[A(p(F),{icon:"carbon:close",width:"16"})],8,Oh)])],10,Mh))),128))],64))),128))])]))}}),qh=Ee(Bh,[["__scopeId","data-v-c5867107"]]),Hh={class:"sidebar-content"},Vh={class:"sidebar-content-header"},jh={class:"sidebar-content-title"},zh={class:"tab-switcher"},Wh=["disabled"],Gh={key:0,class:"tab-content"},Kh={key:1,class:"tab-content config-tab"},Jh={key:0,class:"config-container"},Xh={class:"template-info-header"},Yh={class:"template-info"},Qh={class:"template-id"},Zh=["title"],ef=Te({name:"SidebarPanel",__name:"Sidebar",setup(o,{expose:t}){const e=lt(),s=Ze(),a=M(80),l=M(!1),i=M(0),m=M(0),b=E=>{l.value=!0,i.value=E.clientX,m.value=a.value,document.addEventListener("mousemove",r),document.addEventListener("mouseup",c),document.body.style.cursor="col-resize",document.body.style.userSelect="none",E.preventDefault()},r=E=>{if(!l.value)return;const k=window.innerWidth,w=(E.clientX-i.value)/k*100;let y=m.value+w;y=Math.max(15,Math.min(100,y)),a.value=y},c=()=>{l.value=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",a.value.toString())},f=()=>{a.value=80,localStorage.setItem("sidebarWidth","80")};return De(async()=>{await le.loadPlanTemplateList(),e.loadAvailableTools();const E=localStorage.getItem("sidebarWidth");E&&(a.value=parseFloat(E))}),Le(()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",c)}),t({loadPlanTemplateList:le.loadPlanTemplateList,toggleSidebar:xe.toggleSidebar,currentPlanTemplateId:s.currentPlanTemplateId}),(E,k)=>(h(),g("div",{class:ue(["sidebar-wrapper",{"sidebar-wrapper-collapsed":p(xe).isCollapsed}]),style:Xe({width:a.value+"%"})},[n("div",Hh,[n("div",Vh,[n("div",jh,u(E.$t("sidebar.title")),1)]),n("div",zh,[n("button",{class:ue(["tab-button",{active:p(xe).currentTab==="list"}]),onClick:k[0]||(k[0]=d=>p(xe).switchToTab("list"))},[A(p(F),{icon:"carbon:list",width:"16"}),ce(" "+u(E.$t("sidebar.templateList")),1)],2),n("button",{class:ue(["tab-button",{active:p(xe).currentTab==="config"}]),onClick:k[1]||(k[1]=d=>p(xe).switchToTab("config")),disabled:!p(s).selectedTemplate.value},[A(p(F),{icon:"carbon:settings",width:"16"}),ce(" "+u(E.$t("sidebar.configuration")),1)],10,Wh)]),p(xe).currentTab==="list"?(h(),g("div",Gh,[A(qh)])):p(xe).currentTab==="config"?(h(),g("div",Kh,[p(s).selectedTemplate.value?(h(),g("div",Jh,[n("div",Xh,[n("div",Yh,[n("h3",null,u(p(s).selectedTemplate.value.title||E.$t("sidebar.unnamedPlan")),1),n("span",Qh,"ID: "+u(p(s).selectedTemplate.value.planTemplateId),1)]),n("button",{class:"back-to-list-btn",onClick:k[2]||(k[2]=d=>p(xe).switchToTab("list"))},[A(p(F),{icon:"carbon:arrow-left",width:"16"})])]),A(ch),A(Vu)])):V("",!0)])):V("",!0)]),n("div",{class:"sidebar-resizer",onMousedown:b,onDblclick:f,title:E.$t("sidebar.resizeHint")},k[3]||(k[3]=[n("div",{class:"resizer-line"},null,-1)]),40,Zh)],6))}}),tf=Ee(ef,[["__scopeId","data-v-1c6f7337"]]);function sf(){const o=tt(),t=et(),{showToast:e}=_s(),{t:s}=Ne(),a=r=>{const c={currentPlanId:r.currentPlanId,status:r.completed?"completed":"running"};return r.rootPlanId&&(c.rootPlanId=r.rootPlanId),r.summary&&(c.summary=r.summary),r.completed!==void 0&&(c.completed=r.completed),r.agentExecutionSequence&&(c.agentExecutionSequence=r.agentExecutionSequence),c},l=r=>{if(!r)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(r)){const[c,f,E,k=0,d=0,w=0,y=0]=r,v=new Date(c,f-1,E,k,d,w,Math.floor(y/1e6));return isNaN(v.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",r),new Date):v}if(typeof r=="string"){let c=new Date(r);if(!isNaN(c.getTime()))return c;const f=r.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(f){const[,E,k,d,w,y,v,I]=f;if(c=new Date(parseInt(E),parseInt(k)-1,parseInt(d),parseInt(w),parseInt(y),parseInt(v),I?parseInt(I.substring(0,3)):0),!isNaN(c.getTime()))return c}return!r.includes("Z")&&!r.includes("+")&&!r.includes("-",10)&&(c=new Date(r+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",r),new Date)}if(typeof r=="number"){const c=r.toString().length<13?r*1e3:r,f=new Date(c);return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",r),new Date):f}return console.warn("[useConversationHistory] Unknown date format:",r,typeof r),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",r,c),new Date}},i=r=>{if(!r)return;console.log("[useConversationHistory] Processing record:",{userRequest:r.userRequest,startTime:r.startTime,startTimeType:typeof r.startTime,endTime:r.endTime,endTimeType:typeof r.endTime});const c=r.userRequest||r.title||"History Round",f=o.createDialog(c),E=Ce.getConversationId();if(E){const k=o.getDialog(f.id);k&&(k.conversationId=E,r.rootPlanId&&(k.planId=r.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",f.id,E))}if(r.userRequest&&r.startTime){const k=l(r.startTime);console.log("[useConversationHistory] Parsed date:",{original:r.startTime,parsed:k,parsedISO:k.toISOString(),isValid:!isNaN(k.getTime())});const d={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:r.userRequest,timestamp:k,isStreaming:!1};o.addMessageToDialog(f.id,d)}if(r.currentPlanId){const k=r.summary||r.result||r.message||"Execution completed",d=a(r),w={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:k,timestamp:r.endTime&&r.endTime?l(r.endTime):r.startTime?l(r.startTime):new Date,isStreaming:!1,planExecution:d};o.addMessageToDialog(f.id,w),r.rootPlanId&&t.setCachedPlanRecord(r.rootPlanId,d)}},m=async(r,c=!1,f=!0)=>{if(!r){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&o.clearMessages(),Ce.setConversationId(r),o.setConversationId(r);const E=await ht.getConversationHistory(r);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const k=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:k.startTime,endTime:k.endTime,startTimeType:typeof k.startTime})}for(const k of E)i(k);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),f&&e(s("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:m,restoreConversationHistory:async r=>m(r,!1,!1),processHistoryRecord:i}}let Mt=null;function of(){return Mt||(Mt=sf()),Mt}const nf={class:"direct-page"},af={class:"direct-chat"},lf={class:"chat-header"},rf={class:"header-actions"},cf=["title"],uf=["title"],df=["title"],pf={class:"chat-content"},mf=["title"],hf={class:"message-content"},ff=Te({name:"DirectIndex",__name:"index",setup(o){const t=ao(),e=lo(),s=yt(),{toast:a}=_s(),l=tt(),i=et(),m=of(),b=M(""),r=M(),c=M(),f=M(null),E=M(50),k=M(!1),d=M(0),w=M(0),y=se(()=>{if(xe.isCollapsed)return E.value;let P=26;c.value&&c.value.sidebarWidth!==void 0&&(P=c.value.sidebarWidth);const $=100-P;return Math.max(20,Math.min($,E.value))});De(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),ve(()=>i.planExecutionRecords,N=>{for(const[j,Q]of N.entries())T(j)&&(r.value&&typeof r.value.updateDisplayedPlanProgress=="function"&&r.value.updateDisplayedPlanProgress(j),Q.completed&&j===f.value&&(Array.from(N.entries()).some(([be,Pe])=>be!==j&&Pe&&!Pe.completed&&Pe.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),f.value=null)))},{deep:!0}),ve(()=>i.trackedPlanIds,N=>{if(!f.value&&N.value.size>0){const j=Array.from(N.value)[0];f.value=j,console.log("[Direct] Set currentRootPlanId to:",j)}},{deep:!0});const P=Ce.getConversationId();if(P&&(console.log("[Direct] Found saved conversationId, restoring conversation:",P),Ae(async()=>{try{await m.restoreConversationHistory(P)}catch(N){console.error("[DirectView] Failed to restore conversation history:",N)}})),le.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const N=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",N),N.trim()?(s.markTaskAsProcessed(),Ae(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",N),await l.sendMessage({input:N})}catch(j){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",j),b.value=N}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(b.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",b.value),console.log("[Direct] No unprocessed task in store"));const $=localStorage.getItem("directPanelWidth");$&&(E.value=parseFloat($)),console.log("[Direct] Final prompt value:",b.value)}),ve(()=>s.currentTask,P=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",P),P&&!P.processed&&P.prompt.trim()){const $=P.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",$),Ae(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",$),await l.sendMessage({input:$})}catch(N){console.warn("[Direct] messageDialog.sendMessage failed for new task:",N)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ve(()=>b.value,(P,$)=>{console.log("[Direct] prompt value changed from:",$,"to:",P)},{immediate:!1}),Le(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),f.value=null,i.cleanup(),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",O)});const v=P=>{k.value=!0,d.value=P.clientX,w.value=E.value,document.addEventListener("mousemove",I),document.addEventListener("mouseup",O),document.body.style.cursor="col-resize",document.body.style.userSelect="none",P.preventDefault()},I=P=>{if(!k.value)return;const $=window.innerWidth,j=(P.clientX-d.value)/$*100;let Q=w.value+j;Q=Math.max(20,Math.min(80,Q)),E.value=Q},O=()=>{k.value=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",O),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},W=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},T=(P,$=!1)=>!f.value||P===f.value||$&&(P==="ui-state"||P==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",P,"current:",f.value),!1),R=P=>{console.log("[DirectView] Step selected:",P),r.value&&typeof r.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",P),r.value.handleStepSelected(P)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},U=()=>{e.push("/home")},x=()=>{e.push("/configs")},q=async()=>{if(Ce.selectMemoryId){console.log("[DirectView] Memory selected:",Ce.selectMemoryId);try{await m.loadConversationHistory(Ce.selectMemoryId,!0,!0)}catch(P){console.error("[DirectView] Failed to load conversation history:",P)}}},_=()=>{Ce.clearMemoryId(),Ce.clearConversationId(),l.reset()};return(P,$)=>(h(),g("div",nf,[n("div",af,[A(tf,{ref_key:"sidebarRef",ref:c},null,512),n("div",{class:"left-panel",style:Xe({width:y.value+"%"})},[n("div",lf,[n("button",{class:"back-button",onClick:U},[A(p(F),{icon:"carbon:arrow-left"})]),n("h2",null,u(P.$t("conversation")),1),n("div",rf,[A(co),n("button",{class:"config-button",onClick:_,title:P.$t("memory.newChat")},[A(p(F),{icon:"carbon:add",width:"20"})],8,cf),n("button",{class:"config-button",onClick:x,title:P.$t("direct.configuration")},[A(p(F),{icon:"carbon:settings-adjust",width:"20"})],8,uf),n("button",{class:"cron-task-btn",onClick:$[0]||($[0]=N=>p(Ce).toggleSidebar()),title:P.$t("memory.selectMemory")},[A(p(F),{icon:"carbon:calendar",width:"20"})],8,df)])]),n("div",pf,[A(Ka,{onStepSelected:R})]),(h(),we(gl,{key:P.$i18n.locale,"initial-value":b.value},null,8,["initial-value"]))],4),n("div",{class:"panel-resizer",onMousedown:v,onDblclick:W,title:P.$t("direct.panelResizeHint")},$[1]||($[1]=[n("div",{class:"resizer-line"},null,-1)]),40,mf),A(pc,{ref_key:"rightPanelRef",ref:r,style:Xe({width:100-E.value+"%"}),"current-root-plan-id":f.value},null,8,["style","current-root-plan-id"])]),A(rr,{onMemorySelected:q}),p(a).show?(h(),g("div",{key:0,class:ue(["message-toast",p(a).type])},[n("div",hf,[n("span",null,u(p(a).text),1)])],2)):V("",!0)]))}}),Bf=Ee(ff,[["__scopeId","data-v-90b5539d"]]);export{Bf as default};
//# sourceMappingURL=index-CIWc-ZwJ.js.map
