import{_ as uo}from"./Java-AI-BYpq8IxI.js";import{d as Te,u as De,a as y,b as h,n as ve,e as o,f as H,g as A,i as d,h as me,t as u,y as Xe,F as he,q as ge,j as we,l as $e,A as ys,c as ae,B as He,r as F,o as Me,C as ye,D as Ue,w as _e,m as Ce,E as Ot,G as Ft,v as po,H as bs,I as Ne,J as _s,z as xe,T as qt,p as Ye,K as mo,M as ho,N as ot,O as fo,x as vo}from"./index-BcKgp2Mc.js";import{I as D,_ as Ee}from"./_plugin-vue_export-helper-BZFyMJKt.js";import{u as yt,m as Ie,P as go,D as Yt,a as We,t as de,s as ws}from"./templateStore-DsVIRe-r.js";import{P as Qt,L as yo}from"./plan-template-with-tool-api-service-sy9b2Jt6.js";import{M as $s,u as Bt,a as bo,b as Ss}from"./useToast-foGVWnJm.js";import"./llm-check-CJy4TeZw.js";const _o={class:"sub-plan-info"},wo={class:"sub-plan-details"},$o={class:"sub-plan-title"},So={key:0,class:"nesting-level"},Po={class:"sub-plan-id"},To={class:"sub-plan-meta"},Eo={key:0,class:"trigger-tool"},ko={class:"trigger-text"},Co={key:0,class:"sub-plan-progress"},Io={class:"progress-info"},Ro={class:"progress-text"},xo={class:"progress-bar"},Ao={key:1,class:"sub-plan-agents-steps"},Fo={class:"agents-steps-header"},Mo={class:"agents-label"},Do={class:"agents-steps-list"},No=["onClick"],Uo={class:"agent-step-header"},Lo=["title"],Oo={class:"sub-agent-execution-info"},qo={key:0,class:"agent-result"},Bo={class:"result-header"},Ho={class:"result-label"},Vo={class:"result-content"},jo={key:1,class:"agent-error"},zo={class:"error-header"},Wo={class:"error-label"},Go={class:"error-content"},Ko={key:2,class:"think-act-preview"},Jo={class:"think-act-header"},Xo={class:"think-act-label"},Yo={class:"think-act-steps-preview"},Qo=["onClick"],Zo={class:"step-number"},en={class:"step-description"},tn={key:0,class:"more-steps"},sn={class:"more-steps-text"},on={key:3,class:"nested-sub-plans"},nn={class:"nested-sub-plans-header"},an={class:"nested-label"},ln={class:"nested-sub-plans-list"},rn={key:4,class:"direct-sub-plans"},cn={class:"direct-sub-plans-header"},un={class:"direct-label"},dn={class:"direct-sub-plans-list"},pn=Te({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=n,s=t,{t:a}=De(),l=()=>`nesting-level-${e.nestingLevel}`,r=()=>e.subPlan.completed?"completed":e.subPlan.agentExecutionSequence?.some(U=>U.status==="RUNNING")?"running":e.subPlan.agentExecutionSequence?.some(U=>U.status==="FINISHED")?"in-progress":"pending",p=()=>{switch(r()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},b=()=>{switch(r()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},i=()=>{if(!e.subPlan.agentExecutionSequence?.length)return 0;if(e.subPlan.completed)return 100;const P=c();return Math.min(100,P/e.subPlan.agentExecutionSequence.length*100)},c=()=>e.subPlan.agentExecutionSequence?.length?e.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0,g=P=>{switch(P){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},E=P=>{switch(P){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},v=P=>{switch(P){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},m=P=>P.thinkActSteps?.some(C=>C.subPlanExecutionRecord)??!1,w=P=>P.thinkActSteps?.filter(C=>C.subPlanExecutionRecord)??[],_=()=>{s("sub-plan-selected",-1,e.subPlanIndex,e.subPlan)},f=(P,C)=>{const U=C.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",U)},R=(P,C,U)=>{const L=U.stepId??`subplan-${e.subPlanIndex}-agent-${P}`;s("step-selected",L)},j=(P,C,U)=>{s("sub-plan-selected",P,C,U)},X=P=>{s("step-selected",P)};return(P,C)=>{const U=ys("RecursiveSubPlan",!0);return h(),y("div",{class:ve(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:_},[o("div",_o,[A(d(D),{icon:b(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",wo,[o("div",$o,[me(u(P.subPlan.title||P.$t("chat.subPlan"))+" #"+u(P.subPlanIndex+1)+" ",1),(P.nestingLevel??0)>0?(h(),y("span",So,"(L"+u((P.nestingLevel??0)+1)+")",1)):H("",!0)]),o("div",Po,u(P.subPlan.currentPlanId),1)])]),o("div",To,[o("div",{class:ve(["sub-plan-status-badge",r()])},u(p()),3),P.subPlan.parentActToolCall?(h(),y("div",Eo,[A(d(D),{icon:"carbon:function",class:"trigger-icon"}),o("span",ko,u(P.subPlan.parentActToolCall.name),1)])):H("",!0)])]),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Co,[o("div",Io,[o("span",Ro,u(P.$t("chat.progress"))+": "+u(c())+" / "+u(P.subPlan.agentExecutionSequence.length),1),o("div",xo,[o("div",{class:"progress-fill",style:Xe({width:i()+"%"})},null,4)])])])):H("",!0),P.subPlan.agentExecutionSequence?.length?(h(),y("div",Ao,[o("div",Fo,[o("span",Mo,u(P.$t("chat.agentExecutions"))+":",1)]),o("div",Do,[(h(!0),y(he,null,ge(P.subPlan.agentExecutionSequence,(L,W)=>(h(),y("div",{key:L.id||W,class:ve(["agent-step-item",g(L.status)]),onClick:S=>f(W,L)},[o("div",Uo,[A(d(D),{icon:E(L.status),class:"agent-icon"},null,8,["icon"]),o("span",{class:"agent-name",title:L.agentName==="ConfigurableDynaAgent"?P.$t("chat.clickToViewExecutionDetails"):""},u(L.agentName==="ConfigurableDynaAgent"?P.$t("chat.funcAgentExecutionDetails"):L.agentName||P.$t("chat.unknownAgent")),9,Lo),o("div",{class:ve(["agent-status-badge",g(L.status)])},u(v(L.status)),3)]),o("div",Oo,[L.result?(h(),y("div",qo,[o("div",Bo,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Ho,u(P.$t("chat.agentResult"))+":",1)]),o("pre",Vo,u(L.result),1)])):H("",!0),L.errorMessage?(h(),y("div",jo,[o("div",zo,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Wo,u(P.$t("chat.errorMessage"))+":",1)]),o("pre",Go,u(L.errorMessage),1)])):H("",!0),L.thinkActSteps?.length?(h(),y("div",Ko,[o("div",Jo,[A(d(D),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Xo,u(P.$t("chat.thinkActSteps"))+" ("+u(L.thinkActSteps.length)+")",1)]),o("div",Yo,[(h(!0),y(he,null,ge(L.thinkActSteps.slice(0,P.maxVisibleSteps??2),(S,x)=>(h(),y("div",{key:S.id||x,class:"think-act-step-preview",onClick:we(T=>R(W,x,L),["stop"])},[o("span",Zo,"#"+u(x+1),1),o("span",en,u(S.actionDescription||P.$t("chat.thinking")),1),A(d(D),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Qo))),128)),L.thinkActSteps.length>(P.maxVisibleSteps??2)?(h(),y("div",tn,[o("span",sn,u(P.$t("chat.andMoreSteps",{count:L.thinkActSteps.length-(P.maxVisibleSteps??2)})),1)])):H("",!0)])])):H("",!0),m(L)?(h(),y("div",on,[o("div",nn,[A(d(D),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",an,u(P.$t("chat.nestedSubPlans")),1)]),o("div",ln,[(h(!0),y(he,null,ge(w(L),(S,x)=>(h(),$e(U,{key:S.id||x,"sub-plan":S.subPlanExecutionRecord,"sub-plan-index":x,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:j,onStepSelected:X},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):H("",!0),L.subPlanExecutionRecords?.length?(h(),y("div",rn,[o("div",cn,[A(d(D),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",un,u(P.$t("chat.directSubPlans")),1)]),o("div",dn,[(h(!0),y(he,null,ge(L.subPlanExecutionRecords,(S,x)=>(h(),$e(U,{key:S.currentPlanId||x,"sub-plan":S,"sub-plan-index":x,"nesting-level":(P.nestingLevel??0)+1,"max-nesting-depth":P.maxNestingDepth??3,"max-visible-steps":P.maxVisibleSteps??2,onSubPlanSelected:j,onStepSelected:X},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):H("",!0)])],10,No))),128))])])):H("",!0)],2)}}}),mn=Ee(pn,[["__scopeId","data-v-36486b62"]]),hn={class:"execution-details"},fn={key:0,class:"plan-overview"},vn={key:0,class:"parent-tool-call"},gn={class:"parent-tool-header"},yn={class:"tool-label"},bn={class:"tool-name"},_n={key:0,class:"tool-parameters"},wn={class:"param-label"},$n={class:"param-content"},Sn={key:1,class:"agent-execution-container"},Pn={class:"section-title"},Tn=["onClick"],En={class:"agent-info"},kn={class:"agent-details"},Cn=["title"],In={class:"request-content"},Rn={class:"agent-controls"},xn={class:"agent-execution-info"},An={key:0,class:"agent-result"},Fn={class:"result-header"},Mn={class:"result-label"},Dn={class:"result-content"},Nn={key:1,class:"agent-error"},Un={class:"error-header"},Ln={class:"error-label"},On={class:"error-content"},qn={key:0,class:"sub-plans-container"},Bn={class:"sub-plans-header"},Hn={class:"sub-plans-title"},Vn={class:"sub-plans-list"},jn=Te({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=g=>{g.stepId?e("step-selected",g.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",g)},l=g=>{switch(g){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},r=g=>{switch(g){case"RUNNING":return s("chat.status.executing");case"FINISHED":return s("chat.status.completed");case"IDLE":default:return s("chat.status.pending")}},p=g=>{switch(g){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},b=(g,E,v)=>{e("sub-plan-selected",g,E,v)},i=g=>{e("step-selected",g)},c=g=>{if(!g)return"";try{const E=JSON.parse(g);return JSON.stringify(E,null,2)}catch{return g}};return(g,E)=>(h(),y("div",hn,[g.planExecution?(h(),y("div",fn,[g.planExecution.parentActToolCall?(h(),y("div",vn,[o("div",gn,[A(d(D),{icon:"carbon:flow",class:"tool-icon"}),o("span",yn,u(g.$t("chat.triggeredByTool"))+":",1),o("span",bn,u(g.planExecution.parentActToolCall.name),1)]),g.planExecution.parentActToolCall.parameters?(h(),y("div",_n,[o("span",wn,u(g.$t("common.parameters"))+":",1),o("pre",$n,u(c(g.planExecution.parentActToolCall.parameters)),1)])):H("",!0)])):H("",!0)])):H("",!0),(g.planExecution?.agentExecutionSequence?.length??0)>0?(h(),y("div",Sn,[o("h4",Pn,u(g.$t("chat.agentExecutionSequence")),1),(h(!0),y(he,null,ge(g.planExecution?.agentExecutionSequence,(v,m)=>(h(),y("div",{key:v.id||m,class:ve(["agent-execution-item",l(v.status)])},[o("div",{class:"agent-header",onClick:w=>a(v)},[o("div",En,[A(d(D),{icon:p(v.status),class:"agent-status-icon"},null,8,["icon"]),o("div",kn,[o("div",{class:"agent-name",title:v.agentName==="ConfigurableDynaAgent"?g.$t("chat.clickToViewExecutionDetails"):""},u(v.agentName==="ConfigurableDynaAgent"?g.$t("chat.funcAgentExecutionDetails"):v.agentName||g.$t("chat.unknownAgent")),9,Cn),o("pre",In,u(v.agentRequest),1)])]),o("div",Rn,[o("div",{class:ve(["agent-status-badge",l(v.status)])},u(r(v.status)),3),A(d(D),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Tn),o("div",xn,[v.result?(h(),y("div",An,[o("div",Fn,[A(d(D),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Mn,u(g.$t("chat.agentResult"))+":",1)]),o("pre",Dn,u(v.result),1)])):H("",!0),v.errorMessage?(h(),y("div",Nn,[o("div",Un,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ln,u(g.$t("chat.errorMessage"))+":",1)]),o("pre",On,u(v.errorMessage),1)])):H("",!0)]),v.subPlanExecutionRecords?.length?(h(),y("div",qn,[o("div",Bn,[A(d(D),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",Hn,u(g.$t("chat.subPlanExecutions"))+" ("+u(v.subPlanExecutionRecords.length)+") ",1)]),o("div",Vn,[(h(!0),y(he,null,ge(v.subPlanExecutionRecords,(w,_)=>(h(),$e(mn,{key:w.currentPlanId||_,"sub-plan":w,"sub-plan-index":_,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:b,onStepSelected:i},null,8,["sub-plan","sub-plan-index"]))),128))])])):H("",!0)],2))),128))])):H("",!0)]))}}),zn=Ee(jn,[["__scopeId","data-v-ee75d960"]]);function Ps(){return{formatResponseText:b=>b?b.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:b=>{if(!b||isNaN(b.getTime()))return"";const c=new Date().getTime()-b.getTime();if(c<6e4)return"Just now";if(c<36e5)return`${Math.floor(c/6e4)} minutes ago`;if(c<864e5)return`${Math.floor(c/36e5)} hours ago`;try{return b.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(g){return console.warn("[useMessageFormatting] Error formatting timestamp:",b,g),""}},getMessageClasses:b=>ae(()=>({user:b.type==="user",assistant:b.type==="assistant",streaming:b.isStreaming,"has-error":!!b.error,"has-thinking":!!b.thinking,"has-execution":!!b.planExecution})),formatFileSize:b=>{if(b===0)return"0 B";const i=1024,c=["B","KB","MB","GB"],g=Math.floor(Math.log(b)/Math.log(i));return parseFloat((b/Math.pow(i,g)).toFixed(2))+" "+c[g]},truncateText:(b,i=100)=>!b||b.length<=i?b:b.substring(0,i)+"...",stripHtml:b=>b.replace(/<[^>]*>/g,""),hasDisplayableContent:b=>!!(b.content||(b.thinking??!1)||(b.planExecution??!1)||b.error),getMessageStatus:b=>b.error?"Send failed":b.isStreaming?"Typing...":b.type==="assistant"&&!b.content&&!b.thinking?"Waiting for response":""}}class Mt{static BASE_URL="/api/executor";static async getDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`);if(e.status===404)return null;if(!e.ok){const l=await e.text();throw new Error(`Failed to get detailed information: ${e.status} - ${l}`)}const s=await e.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=t),a}catch(e){return console.error("[CommonApiService] Failed to get plan details:",e),null}}static async deleteExecutionDetails(t){try{const e=await fetch(`${this.BASE_URL}/details/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.text();throw new Error(`Failed to delete execution details: ${e.status} - ${s}`)}return await e.json()}catch(e){throw console.error("[CommonApiService] Failed to delete execution details:",e),e}}static async submitFormInput(t,e){const s=await fetch(`${this.BASE_URL}/submit-input/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const t=await fetch(this.BASE_URL);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get Prompt list:",t),t}}static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}}const Wn={class:"user-input-form-container"},Gn={class:"user-input-header"},Kn={class:"user-input-title"},Jn={class:"user-input-message"},Xn={key:0,class:"form-description"},Yn={key:0,class:"form-grid"},Qn=["for"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","placeholder","required","onUpdate:modelValue"],sa=["id","name","placeholder","required","onUpdate:modelValue"],oa=["id","name","placeholder","required","onUpdate:modelValue"],na=["id","name","required","onUpdate:modelValue"],aa={value:""},la=["value"],ra={key:6,class:"checkbox-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"checkbox-label"},ua={key:7,class:"radio-group"},da=["id","name","value","onUpdate:modelValue"],pa={class:"radio-label"},ma=["id","name","placeholder","required","onUpdate:modelValue"],ha={key:1,class:"form-group"},fa={for:"form-input-genericInput"},va={type:"submit",class:"submit-user-input-btn"},ga=Te({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:t}){const e=n,s=t;De();const a=He({}),l=F(e.genericInput??""),r=F(!1),p=F(null),b=()=>{const E=e.userInputWaitState?.formInputs;E&&E.length>0&&(!r.value||Object.keys(a).length!==E.length)&&(E.forEach((m,w)=>{(!(w in a)||m.type==="checkbox"&&!Array.isArray(a[w])||m.type!=="checkbox"&&a[w]==="")&&(m.type==="checkbox"?a[w]=[]:a[w]="")}),r.value=!0)};Me(()=>{b()}),ye(()=>e.userInputWaitState?.formInputs,()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{r.value=!1,b()},100)},{deep:!0});const i=async()=>{try{const E={},v=e.userInputWaitState?.formInputs;v&&v.length>0?Object.entries(a).forEach(([m,w])=>{const _=parseInt(m,10),R=v[_].label||`input_${m}`;Array.isArray(w)?E[R]=w.join(", "):E[R]=w}):E.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",E,"for planId:",e.planId),e.planId?(await Mt.submitFormInput(e.planId,E),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",E)}catch(E){console.error("[UserInputForm] User input submission failed:",E)}},c=E=>E?Array.isArray(E)?E:typeof E=="string"?E.split(",").map(v=>v.trim()).filter(v=>v.length>0):[]:[],g=E=>typeof E=="boolean"?E:typeof E=="string"?E==="true":!1;return Ue(()=>{p.value&&clearTimeout(p.value)}),(E,v)=>(h(),y("div",Wn,[o("div",Gn,[A(d(D),{icon:"carbon:user",class:"user-icon"}),o("h4",Kn,u(E.$t("chat.userInputRequired")),1)]),o("p",Jn,u(E.userInputWaitState?.title??E.$t("chat.userInput.message")),1),E.userInputWaitState?.formDescription?(h(),y("p",Xn,u(E.userInputWaitState?.formDescription),1)):H("",!0),o("form",{onSubmit:we(i,["prevent"]),class:"user-input-form"},[E.userInputWaitState?.formInputs&&E.userInputWaitState.formInputs.length>0?(h(),y("div",Yn,[(h(!0),y(he,null,ge(E.userInputWaitState?.formInputs,(m,w)=>(h(),y("div",{key:w,class:"form-group"},[o("label",{for:`form-input-${m.label.replace(/\W+/g,"_")}`},u(m.label)+u(g(m.required)?" *":"")+": ",9,Qn),!m.type||m.type==="text"?_e((h(),y("input",{key:0,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,Zn)),[[Ce,a[w]]]):m.type==="email"?_e((h(),y("input",{key:1,type:"email",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ea)),[[Ce,a[w]]]):m.type==="number"?_e((h(),y("input",{key:2,type:"number",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ta)),[[Ce,a[w]]]):m.type==="password"?_e((h(),y("input",{key:3,type:"password",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,sa)),[[Ce,a[w]]]):m.type==="textarea"?_e((h(),y("textarea",{key:4,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input form-textarea",rows:"4"},null,8,oa)),[[Ce,a[w]]]):m.type==="select"&&m.options?_e((h(),y("select",{key:5,id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input form-select"},[o("option",aa,u(E.$t("selectCommon.pleaseSelect")),1),(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("option",{key:_,value:_},u(_),9,la))),128))],8,na)),[[Ot,a[w]]]):m.type==="checkbox"&&m.options?(h(),y("div",ra,[(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("label",{key:_,class:"checkbox-item"},[_e(o("input",{type:"checkbox",id:`form-input-${m.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:m.label,value:_,"onUpdate:modelValue":f=>a[w]=f,class:"form-checkbox"},null,8,ia),[[Ft,a[w]]]),o("span",ca,u(_),1)]))),128))])):m.type==="radio"&&m.options?(h(),y("div",ua,[(h(!0),y(he,null,ge(c(m.options),_=>(h(),y("label",{key:_,class:"radio-item"},[_e(o("input",{type:"radio",id:`form-input-${m.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:m.label,value:_,"onUpdate:modelValue":f=>a[w]=f,class:"form-radio"},null,8,da),[[po,a[w]]]),o("span",pa,u(_),1)]))),128))])):_e((h(),y("input",{key:8,type:"text",id:`form-input-${m.label.replace(/\W+/g,"_")}`,name:m.label,placeholder:m.placeholder||"",required:g(m.required),"onUpdate:modelValue":_=>a[w]=_,class:"form-input"},null,8,ma)),[[Ce,a[w]]])]))),128))])):(h(),y("div",ha,[o("label",fa,u(E.$t("common.input"))+":",1),_e(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":v[0]||(v[0]=m=>l.value=m),class:"form-input"},null,512),[[Ce,l.value]])])),o("button",va,u(E.$t("chat.userInput.submit")),1)],32)]))}}),ya=Ee(ga,[["__scopeId","data-v-e4d0802d"]]),ba={class:"response-section"},_a={class:"response-header"},wa={class:"response-avatar"},$a={class:"response-name"},Sa={key:0,class:"response-timestamp"},Pa={class:"response-content"},Ta={key:1,class:"final-response"},Ea=["innerHTML"],ka={class:"response-actions"},Ca=["title"],Ia=["title"],Ra={key:2,class:"response-placeholder"},xa={class:"typing-indicator"},Aa={class:"typing-text"},Fa={key:3,class:"response-error"},Ma={class:"error-text"},Da={key:4,class:"response-empty"},Na={class:"empty-text"},Ua=Te({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:t}){const e=n,s=t,{formatResponseText:a,formatTimestamp:l}=Ps(),r=async()=>{if(e.content)try{const c=e.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(c),s("copy")}catch(c){console.error("Failed to copy to clipboard:",c)}},p=()=>{s("regenerate")},b=()=>{s("retry")},i=c=>{console.log("[ResponseSection] User input submitted:",c),s("user-input-submitted",c)};return(c,g)=>(h(),y("div",ba,[o("div",_a,[o("div",wa,[A(d(D),{icon:"carbon:bot",class:"bot-icon"})]),o("div",$a,u(c.$t("chat.botName")),1),c.timestamp?(h(),y("div",Sa,u(d(l)(c.timestamp)),1)):H("",!0)]),o("div",Pa,[c.userInputWaitState?.waiting?(h(),$e(ya,bs({key:0,"user-input-wait-state":c.userInputWaitState},c.planId?{"plan-id":c.planId}:{},{"generic-input":c.genericInput??"",onUserInputSubmitted:i}),null,16,["user-input-wait-state","generic-input"])):H("",!0),c.content?(h(),y("div",Ta,[o("div",{class:"response-text",innerHTML:d(a)(c.content)},null,8,Ea),o("div",ka,[o("button",{class:"action-btn copy-btn",onClick:r,title:c.$t("chat.copyResponse")},[A(d(D),{icon:"carbon:copy"})],8,Ca),o("button",{class:"action-btn regenerate-btn",onClick:p,title:c.$t("chat.regenerateResponse")},[A(d(D),{icon:"carbon:renew"})],8,Ia)])])):c.isStreaming?(h(),y("div",Ra,[o("div",xa,[g[0]||(g[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Aa,u(c.$t("chat.thinkingResponse")),1)])])):c.error?(h(),y("div",Fa,[A(d(D),{icon:"carbon:warning",class:"error-icon"}),o("span",Ma,u(c.error),1),o("button",{class:"retry-btn",onClick:b},u(c.$t("chat.retry")),1)])):(h(),y("div",Da,[o("span",Na,u(c.$t("chat.waitingForResponse")),1)]))])]))}}),La=Ee(Ua,[["__scopeId","data-v-a03ac86f"]]);function Oa(){const s=F(new Set),a=He(new Map),l=He(new Map),r=He(new Map),p=He(new Map),b=F(!1),i=F(null),c=C=>p.get(C),g=(C,U)=>{if(!C){console.warn("[usePlanExecution] Cannot cache plan record with empty planId");return}p.set(C,U),console.log("[usePlanExecution] Cached plan record:",C)},E=()=>Array.from(s.value),v=C=>{if(!C){console.warn("[usePlanExecution] Cannot track empty planId");return}s.value.add(C),l.set(C,0),r.set(C,0),console.log("[usePlanExecution] Tracking plan:",C),i.value||f(),w(C).catch(U=>{console.error(`[usePlanExecution] Initial poll failed for ${C}:`,U)})},m=C=>{s.value.delete(C),l.delete(C),r.delete(C),console.log("[usePlanExecution] Untracking plan:",C),s.value.size===0&&a.size===0&&R()},w=async C=>{if(C)try{console.log("[usePlanExecution] Polling plan status for:",C);const U=await Mt.getDetails(C);if(console.log("[usePlanExecution] Received plan details:",U?"YES":"NO",U),r.delete(C),!U){const S=r.get(C)||0;S<10?(r.set(C,S+1),console.log(`[usePlanExecution] Plan ${C} not found yet, retrying (${S+1}/10)`),setTimeout(()=>{s.value.has(C)&&w(C).catch(x=>{console.error(`[usePlanExecution] Retry poll failed for ${C}:`,x)})},1e3)):(console.warn(`[usePlanExecution] Plan ${C} not found after 10 attempts, giving up`),m(C));return}const L=l.get(C)||0;l.set(C,L+1);const W=U.rootPlanId||U.currentPlanId;if(!W){console.warn("[usePlanExecution] Plan record has no rootPlanId or currentPlanId:",U);return}if(p.set(W,U),C!==W&&(p.set(C,U),console.log("[usePlanExecution] Stored record with both keys:",{planId:C,recordKey:W})),console.log("[usePlanExecution] Updated plan execution record:",{planId:C,recordKey:W,rootPlanId:U.rootPlanId,currentPlanId:U.currentPlanId,completed:U.completed,status:U.status,attempt:L+1}),U.completed){console.log(`[usePlanExecution] Plan ${W} completed, checking for summary...`);const S=yt();S.currentTask&&S.currentTask.isRunning&&(S.currentTask.isRunning=!1);const x=U.summary||U.result||U.message,T=a.get(W)||0;if(!x&&T<10)a.set(W,T+1),console.log(`[usePlanExecution] Plan ${W} completed but no summary yet, continuing to poll (${T+1}/10)`);else{console.log(`[usePlanExecution] Plan ${W} completed, cleaning up...`,{hasSummary:!!x,pollCount:T});try{await Mt.deleteExecutionDetails(W),console.log(`[usePlanExecution] Deleted execution details for plan: ${W}`)}catch(O){const N=O instanceof Error?O.message:"Unknown error";console.error(`[usePlanExecution] Failed to delete execution details: ${N}`)}m(C),a.delete(W),setTimeout(()=>{p.delete(W),C!==W&&p.delete(C)},5e3)}}U.status==="failed"&&U.message&&!U.message.includes("Failed to get detailed information")&&console.error(`[usePlanExecution] Plan ${W} failed:`,U.message)}catch(U){const L=U instanceof Error?U.message:"Unknown error";console.error(`[usePlanExecution] Failed to poll plan status for ${C}:`,L);const W=r.get(C)||0;W<10&&(r.set(C,W+1),console.log(`[usePlanExecution] Network error for ${C}, retrying (${W+1}/10)`),setTimeout(()=>{s.value.has(C)&&w(C).catch(S=>{console.error(`[usePlanExecution] Retry poll failed for ${C}:`,S)})},1e3*(W+1)))}},_=async()=>{if(b.value){console.log("[usePlanExecution] Previous polling still in progress, skipping");return}const C=new Set(s.value);for(const[U]of a.entries())C.add(U);if(C.size!==0)try{b.value=!0;const U=Array.from(C).map(L=>w(L));await Promise.all(U)}catch(U){console.error("[usePlanExecution] Failed to poll tracked plans:",U)}finally{b.value=!1}},f=()=>{i.value&&clearInterval(i.value),i.value=window.setInterval(()=>{_()},1e3),console.log("[usePlanExecution] Started adaptive polling")},R=()=>{if(a.size>0){console.log(`[usePlanExecution] Not stopping polling - ${a.size} completed plans still waiting for summary`);return}i.value&&(clearInterval(i.value),i.value=null),console.log("[usePlanExecution] Stopped polling")},j=async C=>{console.log(`[usePlanExecution] Polling plan status immediately for: ${C}`),await w(C)},X=C=>{if(console.log("[usePlanExecution] Received plan execution request:",{planId:C}),!C){console.error("[usePlanExecution] Invalid plan execution request: missing planId");return}yt().setTaskRunning(C),v(C)},P=()=>{R(),s.value.clear(),a.clear(),l.clear(),r.clear(),p.clear(),b.value=!1};return{planExecutionRecords:Ne(p),trackedPlanIds:Ne(s),isPolling:Ne(b),getPlanExecutionRecord:c,setCachedPlanRecord:g,getTrackedPlanIds:E,trackPlan:v,untrackPlan:m,handlePlanExecutionRequested:X,pollPlanStatusImmediately:j,startPolling:f,stopPolling:R,cleanup:P}}let Tt=null;function Ze(){return Tt||(Tt=Oa()),Tt}function qa(){const n=Ze(),t=F([]),e=F(null),s=F(null),a=F(null),l=ae(()=>a.value),r=F(!1),p=F(null),b=F(null),i=F(null),c=ae(()=>e.value&&t.value.find(M=>M.id===e.value)||null),g=ae(()=>t.value.length>0),E=ae(()=>t.value.length),v=ae(()=>{if(!s.value)return c.value?.messages||[];const M=[];for(const B of t.value)B.conversationId===s.value&&M.push(...B.messages);return M.sort((B,G)=>B.timestamp.getTime()-G.timestamp.getTime())}),m=M=>{const B={id:`dialog_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:M||"New Conversation",messages:[],...s.value&&{conversationId:s.value},...a.value&&{planId:a.value},createdAt:new Date,updatedAt:new Date,isActive:!0};return t.value.push(B),e.value=B.id,console.log("[useMessageDialog] Created new dialog round:",B.id,{conversationId:s.value,rootPlanId:a.value}),B},w=M=>t.value.find(B=>B.id===M)||null,_=M=>{if(t.value.forEach(B=>{B.isActive=!1}),M){const B=t.value.find(G=>G.id===M);B&&(B.isActive=!0,e.value=M)}else e.value=null},f=(M,B)=>{const G=t.value.find(Q=>Q.id===M);G&&(G.messages.push(B),G.updatedAt=new Date)},R=(M,B,G)=>{const Q=t.value.find(se=>se.id===M);if(Q){const se=Q.messages.findIndex(le=>le.id===B);se!==-1&&(Q.messages[se]={...Q.messages[se],...G},Q.updatedAt=new Date)}},j=M=>{const B=t.value.findIndex(G=>G.id===M);if(B!==-1){const G=t.value[B];if(t.value.splice(B,1),console.log("[useMessageDialog] Deleted dialog round:",M),e.value===M){const Q=t.value.filter(se=>se.conversationId===G.conversationId);e.value=Q.length>0?Q[0].id:null,e.value&&_(e.value)}}},X=M=>{const B=t.value.filter(G=>G.planId===M);B.forEach(G=>{j(G.id)}),console.log(`[useMessageDialog] Deleted ${B.length} dialog round(s) for plan:`,M)},P=M=>{const B=t.value.filter(G=>G.conversationId===M);B.forEach(G=>{j(G.id)}),console.log(`[useMessageDialog] Deleted ${B.length} dialog round(s) for conversation:`,M),s.value===M&&(s.value=null)},C=()=>{t.value=[],e.value=null},U=async M=>{let B=null,G=null;try{if(r.value){const pe="Please wait for the current task to complete before starting a new one";return p.value=pe,{success:!1,error:pe}}r.value=!0,p.value=null,B=m();const Q={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.input,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(pe=>typeof pe=="string"?new File([],pe):pe)}};f(B.id,Q),G={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Processing...",isStreaming:!0},f(B.id,G);const se=M;let le;if(se.toolName&&se.replacementParams?le=await Yt.executeByToolName(se.toolName,se.replacementParams,M.uploadedFiles,M.uploadKey,"VUE_DIALOG"):le=await Yt.sendMessageWithDefaultPlan(M,"VUE_DIALOG"),le.conversationId&&(s.value=le.conversationId,B.conversationId=le.conversationId,Ie.setConversationId(le.conversationId),console.log("[useMessageDialog] Conversation ID set:",le.conversationId)),le.planId){const pe=le.planId;a.value=pe,B.planId=pe,R(B.id,G.id,{thinking:"Planning execution...",planExecution:{currentPlanId:pe,rootPlanId:pe,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(pe),console.log("[useMessageDialog] Root plan ID set and tracking started:",pe)}else{const pe={content:le.message||le.result||"No response received",isStreaming:!1};R(B.id,G.id,pe)}return{success:!0,...le.planId&&{planId:le.planId},...le.conversationId&&{conversationId:le.conversationId}}}catch(Q){const se=Q instanceof Error?Q.message:"Failed to send message";return p.value=se,console.error("[useMessageDialog] Send message failed:",Q),B&&G&&R(B.id,G.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),{success:!1,error:se}}finally{r.value=!1}},L=async M=>{let B=null,G=null;try{if(r.value){const te="Please wait for the current task to complete before starting a new one";return p.value=te,{success:!1,error:te}}r.value=!0,p.value=null;const Q=Ie.getConversationId();Q&&!s.value&&(s.value=Q,console.log("[useMessageDialog] Restored conversationId from memoryStore:",Q)),B=m(M.title),M.title&&(B.title=M.title);const se={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:M.title,timestamp:new Date,isStreaming:!1,...M.uploadedFiles&&{attachments:M.uploadedFiles.map(te=>typeof te=="string"?new File([],te):te)}};f(B.id,se),G={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:"",timestamp:new Date,thinking:"Planning execution...",isStreaming:!0},f(B.id,G);const le=M.planData.planTemplateId;if(!le||le===null)throw new Error("Plan template ID is required");const pe=await go.executePlan(le,M.params,M.uploadedFiles,M.replacementParams,M.uploadKey??void 0,"VUE_SIDEBAR");if(pe.conversationId){const te=pe.conversationId,V=s.value||Ie.getConversationId();te!==V?(console.log("[useMessageDialog] Conversation ID changed:",V,"->",te),s.value=te,B.conversationId=te,Ie.setConversationId(te)):(B.conversationId=te,console.log("[useMessageDialog] Conversation ID unchanged:",te))}else s.value&&(B.conversationId=s.value);if(pe.planId){const te=pe.planId;a.value=te,B.planId=te,R(B.id,G.id,{thinking:"Planning execution...",planExecution:{currentPlanId:te,rootPlanId:te,status:"running"},isStreaming:!1}),n.handlePlanExecutionRequested(te),console.log("[useMessageDialog] Root plan ID set and tracking started:",te)}else{const te={content:"Plan execution started",isStreaming:!1};R(B.id,G.id,te)}return{success:!0,...pe.planId&&{planId:pe.planId}}}catch(Q){const se=Q instanceof Error?Q.message:"Failed to execute plan";return p.value=se,console.error("[useMessageDialog] Execute plan failed:",Q),B&&G&&R(B.id,G.id,{content:`Error: ${se}`,error:se,isStreaming:!1}),r.value=!1,{success:!1,error:se}}},W=(M,B,G)=>{const Q={};G!==void 0&&(Q.planExecution=G),R(M,B,Q)},S=M=>{const B={...M};return"agentExecutionSequence"in M&&Array.isArray(M.agentExecutionSequence)&&(B.agentExecutionSequence=M.agentExecutionSequence.map(G=>x(G))),B},x=M=>{const B={...M};return"subPlanExecutionRecords"in M&&Array.isArray(M.subPlanExecutionRecords)&&(B.subPlanExecutionRecords=M.subPlanExecutionRecords.map(G=>S(G))),B},T=(M,B,G)=>{c.value||m();const Q=c.value,se={...G};G?.planExecution&&(se.planExecution=S(G.planExecution));const le={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:M,content:B,timestamp:new Date,isStreaming:!1,...se};return Q.messages.push(le),Q.updatedAt=new Date,le},O=(M,B)=>{if(!c.value)return;const G={...B};B.planExecution&&(G.planExecution=S(B.planExecution));const Q=c.value.messages.findIndex(se=>se.id===M);Q!==-1&&(c.value.messages[Q]={...c.value.messages[Q],...G},c.value.updatedAt=new Date)},N=M=>{if(c.value)return c.value.messages.find(B=>B.id===M)},q=M=>{b.value=M,O(M,{isStreaming:!0})},ee=M=>{M&&O(M,{isStreaming:!1}),(b.value===M||!M)&&(b.value=null)},Se=()=>{c.value&&(c.value.messages=[],c.value.updatedAt=new Date,b.value=null)},J=(M,B)=>{r.value=!M,B!==void 0&&(i.value=B),console.log("[useMessageDialog] Input state updated:",{enabled:M,placeholder:B,isLoading:r.value})},ce=M=>{s.value=M,console.log("[useMessageDialog] Set conversationId:",M)},ke=()=>{t.value=[],e.value=null,a.value=null,s.value=null,r.value=!1,p.value=null,i.value=null},ue=(M,B,G)=>{const Q={planExecution:S(G),isStreaming:!G.completed};if(!G.completed)Q.thinking="Processing...";else{if(!G.agentExecutionSequence||G.agentExecutionSequence.length===0){const se=G.summary??G.result??G.message??"Execution completed";se&&(Q.content=se,Q.thinking="")}else G.summary&&(Q.content=G.summary,Q.thinking="");G.status==="failed"&&G.message&&(Q.content=`Error: ${G.message}`,Q.thinking="")}R(M.id,B.id,Q)};return _s(()=>{const M=n.planExecutionRecords,B=M.size,G=Array.from(M.entries()),Q=t.value;console.log("[useMessageDialog] watchEffect triggered - records count:",G.length,"size:",B),console.log("[useMessageDialog] watchEffect - dialogList count:",Q.length),console.log("[useMessageDialog] watchEffect - dialogs with planId:",Q.filter(te=>te.planId).map(te=>({id:te.id,planId:te.planId})));for(const te of Q){if(!te.planId){console.log("[useMessageDialog] watchEffect: Skipping dialog without planId:",te.id);continue}const V=te.messages.find(oe=>oe.planExecution?.rootPlanId===te.planId||oe.planExecution?.currentPlanId===te.planId);if(!V){console.log("[useMessageDialog] watchEffect: No message found for planId:",te.planId,{dialogMessages:te.messages.map(oe=>({id:oe.id,type:oe.type,planExecutionRootPlanId:oe.planExecution?.rootPlanId,planExecutionCurrentPlanId:oe.planExecution?.currentPlanId,hasPlanExecution:!!oe.planExecution}))});continue}let I=G.find(([oe])=>oe===te.planId);const z=V.planExecution;if(!I&&z?.rootPlanId&&(I=G.find(([oe])=>oe===z.rootPlanId)),!I&&z?.currentPlanId&&(I=G.find(([oe])=>oe===z.currentPlanId)),!I){for(const[oe,be]of G)if(be&&(be.rootPlanId===te.planId||be.currentPlanId===te.planId||V.planExecution?.rootPlanId&&(be.rootPlanId===V.planExecution.rootPlanId||be.currentPlanId===V.planExecution.rootPlanId)||V.planExecution?.currentPlanId&&(be.rootPlanId===V.planExecution.currentPlanId||be.currentPlanId===V.planExecution.currentPlanId))){I=[oe,be],console.log("[useMessageDialog] watchEffect: Found record by value matching:",{dialogPlanId:te.planId,recordKey:oe,recordRootPlanId:be.rootPlanId,recordCurrentPlanId:be.currentPlanId});break}}if(!I){const oe=V.planExecution;if(oe&&oe.status==="running"){console.log("[useMessageDialog] watchEffect: Message has planExecution but record not found yet, keeping initial state:",{dialogId:te.id,messageId:V.id,planId:te.planId,messagePlanExecution:oe,availableRecordKeys:G.map(([be])=>be)});continue}console.log("[useMessageDialog] watchEffect: No record found and message has no running planExecution:",{dialogId:te.id,planId:te.planId,hasPlanExecution:!!V.planExecution,planExecutionStatus:V.planExecution?.status,availableRecordKeys:G.map(([be])=>be)});continue}const[,Z]=I,ne=S(Z);console.log("[useMessageDialog] watchEffect: Updating message with plan record:",{dialogId:te.id,messageId:V.id,planId:te.planId,recordKey:I[0],recordCompleted:ne.completed,recordStatus:ne.status}),ue(te,V,ne)}const se=n.trackedPlanIds.value.size>0,le=G.some(([,te])=>te&&!te.completed&&te.status!=="failed");!(se||le)&&r.value&&(console.log("[useMessageDialog] All plans completed, resetting isLoading",{hasTrackedPlans:se,hasRunningPlansInRecords:le,trackedPlanIds:Array.from(n.trackedPlanIds.value),recordsCount:G.length}),r.value=!1)}),{dialogList:Ne(t),activeDialogId:Ne(e),rootPlanId:Ne(a),conversationId:Ne(s),isLoading:r,error:p,streamingMessageId:Ne(b),inputPlaceholder:Ne(i),activeDialog:c,activeRootPlanId:l,hasDialogs:g,dialogCount:E,messages:v,createDialog:m,getDialog:w,setActiveDialog:_,addMessageToDialog:f,updateMessageInDialog:R,deleteDialog:j,deleteConversationRoundByPlanId:X,deleteConversation:P,clearAllDialogs:C,sendMessage:U,executePlan:L,updatePlanExecutionStatus:W,updateInputState:J,setConversationId:ce,reset:ke,addMessage:T,updateMessage:O,findMessage:N,startStreaming:q,stopStreaming:ee,clearMessages:Se}}let Et=null;function et(){return Et||(Et=qa()),Et}function Ba(n){const t=F(!1),e=F(!0),s=150,a=async(_=!0)=>{n.value&&(await xe(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:f,clientHeight:R}=n.value;return f-_-R<s},r=()=>{if(!n.value)return;const _=l();t.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(e.value=!0)},p=()=>{r(),l()||(e.value=!1)},b=async()=>{e.value&&await a()},i=async()=>{e.value=!0,await a()},c=(_,f=!0)=>{if(!n.value)return;const R=n.value.querySelector(`[data-message-id="${_}"]`);R&&R.scrollIntoView({behavior:f?"smooth":"auto",block:"center"})},g=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:f,clientHeight:R}=n.value,j=_===0,X=_+R>=f-5,P=f>R?_/(f-R)*100:100;return{scrollTop:_,scrollHeight:f,clientHeight:R,isAtTop:j,isAtBottom:X,scrollPercentage:P}},E=()=>{n.value&&n.value.addEventListener("scroll",p,{passive:!0})},v=()=>{n.value&&n.value.removeEventListener("scroll",p)},m=()=>{E(),r()},w=()=>{v()};return Me(()=>{xe(()=>{m()})}),Ue(()=>{w()}),{showScrollToBottom:Ne(t),isAutoScrollEnabled:Ne(e),scrollToBottom:a,autoScrollToBottom:b,forceScrollToBottom:i,scrollToMessage:c,isNearBottom:l,checkScrollPosition:r,getScrollInfo:g,addScrollListener:E,removeScrollListener:v,initializeScrollBehavior:m,cleanupScrollBehavior:w}}const Ha={class:"chat-container"},Va=["data-message-id"],ja={class:"user-content"},za={class:"message-text"},Wa={key:0,class:"attachments"},Ga={class:"attachment-name"},Ka={class:"attachment-size"},Ja={class:"message-timestamp"},Xa={key:0,class:"message-status error"},Ya={class:"status-text"},Qa={key:1,class:"assistant-message"},Za={key:0,class:"loading-message"},el={class:"loading-content"},tl=["title"],sl=Te({__name:"ChatContainer",emits:["step-selected"],setup(n,{emit:t}){const e=t,{t:s}=De(),a=et(),{messages:l,isLoading:r,streamingMessageId:p,updateMessage:b,startStreaming:i,findMessage:c}=a,g=F(null),{scrollToBottom:E,autoScrollToBottom:v,showScrollToBottom:m}=Ba(g),{getMessageClasses:w,formatTimestamp:_,formatFileSize:f}=Ps(),R=S=>p.value===S,j=ae(()=>l.value),X=S=>{const x=S.target;if(x.classList.contains("md-copy-btn")){const T=x.getAttribute("data-raw");if(T){const O=decodeURIComponent(T);navigator.clipboard.writeText(O).then(()=>{x.textContent=s("chat.copied"),setTimeout(()=>{x.textContent=s("chat.copy")},1e3)})}}},P=async S=>{const x=c(S);if(x)try{const T=x.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(T)}catch(T){console.error("Failed to copy message:",T)}},C=S=>{const x=c(S);x&&x.type==="assistant"&&(b(S,{content:""}),i(S),console.warn("[ChatContainer] Regenerate not yet implemented"))},U=S=>{c(S)&&(b(S,{content:""}),i(S),console.warn("[ChatContainer] Retry not yet implemented"))},L=S=>{console.log("[ChatContainer] Step selected:",S),e("step-selected",S)},W=(S,x)=>{console.log("[ChatContainer] User input submitted:",x,"for message:",S.id),console.warn("[ChatContainer] User input submission not yet implemented")};return Me(()=>{ye(l,()=>{xe(()=>{v()})},{deep:!0})}),Ue(()=>{}),(S,x)=>(h(),y("div",Ha,[o("div",{class:"messages",ref_key:"messagesRef",ref:g,onClick:X},[(h(!0),y(he,null,ge(j.value,T=>(h(),y("div",{key:T.id,class:ve(["chat-message",[d(w)(T),{streaming:R(T.id)}]])},[T.type==="user"?(h(),y("div",{key:0,class:"user-message","data-message-id":T.id},[o("div",ja,[o("div",za,u(T.content),1),T.attachments?.length?(h(),y("div",Wa,[(h(!0),y(he,null,ge(T.attachments,(O,N)=>(h(),y("div",{key:N,class:"attachment-item"},[A(d(D),{icon:"carbon:document",class:"attachment-icon"}),o("span",Ga,u(O.name),1),o("span",Ka,u(d(f)(O.size)),1)]))),128))])):H("",!0),o("div",Ja,u(d(_)(T.timestamp)),1)]),T.error?(h(),y("div",Xa,[A(d(D),{icon:"carbon:warning",class:"status-icon"}),o("span",Ya,u(T.error),1)])):H("",!0)],8,Va)):T.type==="assistant"?(h(),y("div",Qa,[T.planExecution?(h(),$e(zn,{key:0,"plan-execution":T.planExecution,"step-actions":T.stepActions||[],"generic-input":T.genericInput||"",onStepSelected:L},null,8,["plan-execution","step-actions","generic-input"])):H("",!0),T.content||T.error||R(T.id)||T.planExecution?.userInputWaitState?.waiting?(h(),$e(La,bs({key:1,content:T.content||"","is-streaming":R(T.id)||!1},{ref_for:!0},{...T.error?{error:T.error}:{},...T.planExecution?.userInputWaitState?{userInputWaitState:T.planExecution.userInputWaitState}:{},...T.planExecution?.currentPlanId?{planId:T.planExecution.currentPlanId}:{}},{timestamp:T.timestamp,"generic-input":T.genericInput||"",onCopy:()=>P(T.id),onRegenerate:()=>C(T.id),onRetry:()=>U(T.id),onUserInputSubmitted:O=>W(T,O)}),null,16,["content","is-streaming","timestamp","generic-input","onCopy","onRegenerate","onRetry","onUserInputSubmitted"])):H("",!0)])):H("",!0)],2))),128)),d(r)?(h(),y("div",Za,[o("div",el,[A(d(D),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,u(S.$t("chat.processing")),1)])])):H("",!0)],512),A(qt,{name:"scroll-button"},{default:Ye(()=>[d(m)?(h(),y("button",{key:0,class:"scroll-to-bottom",onClick:x[0]||(x[0]=()=>d(E)()),title:S.$t("chat.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,tl)):H("",!0)]),_:1})]))}}),ol=Ee(sl,[["__scopeId","data-v-b590114c"]]);class Zt{static async uploadFiles(t){try{console.log("[FileUploadApiService] Uploading files:",t.length);const e=new FormData;t.forEach(l=>{e.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:e});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(e){throw console.error("[FileUploadApiService] Error uploading files:",e),e}}static async getUploadedFiles(t){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",t);const e=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",t),s}catch(e){throw console.error("[FileUploadApiService] Error getting uploaded files:",e),e}}static async deleteFile(t,e){try{console.log("[FileUploadApiService] Deleting file:",e,"from uploadKey:",t);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(t)}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const t=await fetch("/api/file-upload/config");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("[FileUploadApiService] Got upload configuration:",e),e}catch(t){throw console.error("[FileUploadApiService] Error getting upload configuration:",t),t}}}const nl={class:"file-upload-component"},al=["accept"],ll={key:0},rl={key:1},il={key:0,class:"files-list"},cl={class:"file-name"},ul={class:"file-size"},dl=["onClick","title"],pl={key:0,class:"upload-progress"},ml=Te({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=n,l=e,r=F(),p=F([]),b=F(!1),i=F(null),c=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],i.value=null,l("upload-key-changed",null)};Ue(()=>{c()}),ye(()=>p.value,_=>{l("files-removed",_)},{deep:!0});const g=()=>{a.disabled||r.value&&r.value.click()},E=async _=>{const f=_.target,R=f.files;if(!R||R.length===0)return;const j=Array.from(R);console.log("[FileUpload] Selected files for upload:",j.map(X=>X.name)),await v(j),f.value=""},v=async _=>{if(_.length!==0){b.value=!0,l("upload-started");try{const f=await Zt.uploadFiles(_);f.success&&(!i.value&&f.uploadKey?(i.value=f.uploadKey,console.log("[FileUpload] Set uploadKey:",i.value),p.value=f.uploadedFiles):i.value?(console.log("[FileUpload] Using existing uploadKey:",i.value),p.value=[...p.value,...f.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=f.uploadedFiles),f.uploadKey&&(i.value=f.uploadKey,console.log("[Input] Saved uploadKey locally:",f.uploadKey),l("upload-key-changed",i.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,i.value)),console.log("Files uploaded successfully:",f),l("upload-completed")}catch(f){console.error("File upload error:",f),l("upload-error",f)}finally{b.value=!1}}},m=async _=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",_.originalName,"from uploadKey:",i),i.value){const f=await Zt.deleteFile(i.value,_.originalName);f.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",f.error)}p.value=p.value.filter(f=>f.originalName!==_.originalName),p.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),i.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",p.value.length)}catch(f){console.error("âŒ Error removing file:",f),l("upload-error",f)}},w=_=>{if(_===0)return"0 Bytes";const f=1024,R=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(_)/Math.log(f));return parseFloat((_/Math.pow(f,j)).toFixed(2))+" "+R[j]};return t({uploadedFiles:p,uploadKey:i,resetSession:c,uploadFiles:v,removeFile:m,isUploading:b}),(_,f)=>(h(),y("div",nl,[o("input",{ref_key:"fileInputRef",ref:r,type:"file",multiple:"",style:{display:"none"},onChange:E,accept:_.acceptedFileTypes||""},null,40,al),o("div",{class:ve(["uploaded-files",{"has-files":p.value.length>0}])},[o("div",{class:"files-header",onClick:g},[A(d(D),{icon:"carbon:attachment"}),p.value.length===0?(h(),y("span",ll,u(d(s)("input.attachFile")),1)):(h(),y("span",rl,u(d(s)("input.attachedFiles"))+" ("+u(p.value.length)+")",1))]),p.value.length>0?(h(),y("div",il,[(h(!0),y(he,null,ge(p.value,R=>(h(),y("div",{key:R.originalName,class:"file-item"},[A(d(D),{icon:"carbon:document",class:"file-icon"}),o("span",cl,u(R.originalName),1),o("span",ul,"("+u(w(R.size))+")",1),o("button",{onClick:j=>m(R),class:"remove-btn",title:d(s)("input.removeFile")},[A(d(D),{icon:"carbon:close"})],8,dl)]))),128))])):H("",!0)],2),b.value?(h(),y("div",pl,[A(d(D),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,u(d(s)("input.uploading")),1)])):H("",!0)]))}}),Ts=Ee(ml,[["__scopeId","data-v-a97ebade"]]),hl={class:"input-area"},fl={class:"input-container"},vl={class:"input-row-first"},gl=["placeholder","disabled"],yl={class:"input-row-second"},bl=["title","disabled"],_l={value:""},wl=["value"],$l=["disabled","title"],Sl=["title"],es="chatInputHistory",ts=20,Pl=Te({__name:"InputArea",props:{initialValue:{default:""},selectionOptions:{default:()=>[]}},setup(n,{expose:t}){const{t:e}=De(),s=yt(),a=We(),l=et(),r=Ze(),p=ae(()=>s.hasRunningTask()),b=n,i=F(),c=F(),g=F(""),E=ae(()=>e("input.placeholder")),v=F(null),m=ae(()=>l.inputPlaceholder.value?l.inputPlaceholder.value:v.value?v.value:E.value),w=F([]),_=F(null),f=F(""),R=F([]),j=F(!1),X=F(!1),P=F([]),C=F(-1),U=F(""),L=ae(()=>typeof window>"u"?!1:/Mac|iPhone|iPad|iPod/.test(navigator.platform)||/Mac/.test(navigator.userAgent)),W=async()=>{j.value=!0;try{console.log("[InputArea] Loading inner tools from planTemplateList...");const I=a.getAllCoordinatorToolsFromTemplates(),z=[];for(const ne of I)if(ne.enableInternalToolcall)try{const oe=JSON.parse(ne.inputSchema||"[]");if(Array.isArray(oe)&&oe.length===1){const be=oe[0];z.push({value:ne.planTemplateId,label:`${ne.toolName} (${be.name})`,toolName:ne.toolName,planTemplateId:ne.planTemplateId,paramName:be.name})}}catch(oe){console.warn("[InputArea] Failed to parse inputSchema for tool:",ne.toolName,oe)}R.value=z,console.log("[InputArea] Loaded",z.length,"inner tools with single parameter");const Z=localStorage.getItem("inputAreaSelectedTool");if(Z){if(z.length>0)if(z.some(oe=>oe.value===Z)){X.value=!0;try{f.value=Z,console.log("[InputArea] Restored selected tool from localStorage:",Z)}finally{X.value=!1}}else console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),f.value===Z&&(f.value="");else if(f.value!==Z){X.value=!0;try{f.value=Z,console.log("[InputArea] Restored selected tool from localStorage (tools not loaded yet):",Z)}finally{X.value=!1}}}}catch(I){console.error("[InputArea] Failed to load inner tools:",I),R.value=[]}finally{j.value=!1}},S=ae(()=>R.value.length>0?R.value.map(I=>({value:I.value,label:I.label})):b.selectionOptions);ye(f,I=>{X.value||localStorage.setItem("inputAreaSelectedTool",I||"")});const x=()=>{try{const I=localStorage.getItem(es);I&&(P.value=JSON.parse(I))}catch(I){console.error("[InputArea] Failed to load history:",I),P.value=[]}},T=()=>{try{localStorage.setItem(es,JSON.stringify(P.value))}catch(I){console.error("[InputArea] Failed to save history:",I)}},O=I=>{if(!I.trim())return;const z=P.value.indexOf(I);z!==-1&&P.value.splice(z,1),P.value.unshift(I),P.value.length>ts&&(P.value=P.value.slice(0,ts)),T()},N=I=>{if(P.value.length===0)return;C.value===-1&&(U.value=g.value);let z=C.value+I;z<-1?z=-1:z>=P.value.length&&(z=P.value.length-1),C.value=z,C.value===-1?(g.value=U.value,U.value=""):g.value=P.value[C.value],B()};ye(()=>a.planTemplateList.value,()=>{console.log("[InputArea] planTemplateList changed, reloading inner tools"),W()},{deep:!0}),Me(()=>{W(),x(),ye(()=>r.planExecutionRecords,I=>{const z=Array.from(I.entries());if(z.length===0)return;z.some(([,ne])=>ne&&!ne.completed&&ne.status!=="failed")||(console.log("[InputArea] All plans completed, resetting session"),q())},{deep:!0}),ye(()=>s.taskToInput,I=>{I?.trim()&&(console.log("[InputArea] taskToInput changed, setting input value:",I),xe(()=>{te(I.trim()),s.getAndClearTaskToInput()}))},{immediate:!1})});const q=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),c.value?.resetSession()};Ue(()=>{q()});const ee=(I,z)=>{w.value=I.map(Z=>Z.originalName),_.value=z,console.log("[InputArea] Files uploaded:",I.length,"uploadKey:",z),w.value.length>0&&(v.value=e("input.filesAttached",{count:w.value.length}))},Se=I=>{w.value=I.map(z=>z.originalName),console.log("[InputArea] Files removed, remaining:",I.length),w.value.length===0?v.value=null:v.value=e("input.filesAttached",{count:w.value.length})},J=I=>{_.value=I,console.log("[InputArea] Upload key changed:",I)},ce=()=>{console.log("[InputArea] Upload started")},ke=()=>{console.log("[InputArea] Upload completed")},ue=I=>{console.error("[InputArea] Upload error:",I)},M=ae(()=>l.isLoading.value),B=()=>{xe(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},G=I=>{if(I.key==="Enter"&&(I.ctrlKey||I.metaKey)){I.preventDefault(),Q();return}const z=L.value?I.altKey:I.ctrlKey;if(I.key==="ArrowUp"&&z){I.preventDefault(),N(1);return}if(I.key==="ArrowDown"&&z){I.preventDefault(),N(-1);return}C.value!==-1&&I.key.length===1&&!I.ctrlKey&&!I.metaKey&&!I.altKey&&(C.value=-1,U.value="")},Q=async()=>{if(!g.value.trim()||M.value)return;const I=g.value.trim();O(I),C.value=-1,U.value="";const z={input:I,memoryId:Ie.selectMemoryId,uploadedFiles:w.value};if(_.value?(z.uploadKey=_.value,console.log("[InputArea] Including uploadKey in message:",_.value)):console.log("[InputArea] No uploadKey available for message"),f.value){const Z=R.value.find(ne=>ne.value===f.value);if(Z){const ne=z;ne.toolName=Z.planTemplateId,ne.replacementParams={[Z.paramName]:I},console.log("[InputArea] Sending message with tool:",Z.toolName)}}try{await l.sendMessage(z)}catch(Z){const ne=Z instanceof Error?Z.message:String(Z);console.error("[InputArea] Send message failed:",ne)}le()},se=async()=>{console.log("[InputArea] Stop button clicked"),await s.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},le=()=>{g.value="",B()},pe=(I,z)=>{l.updateInputState(I,z)},te=I=>{g.value=I,B()},V=()=>g.value.trim();return ye(()=>b.initialValue,I=>{I.trim()&&(g.value=I,B())},{immediate:!0}),t({clearInput:le,updateState:pe,getQuery:V,focus:()=>i.value?.focus(),get uploadedFiles(){return c.value?.uploadedFiles?.map(I=>I.originalName)||[]},get uploadKey(){return c.value?.uploadKey||null}}),(I,z)=>(h(),y("div",hl,[A(Ts,{ref_key:"fileUploadRef",ref:c,disabled:M.value,onFilesUploaded:ee,onFilesRemoved:Se,onUploadKeyChanged:J,onUploadStarted:ce,onUploadCompleted:ke,onUploadError:ue},null,8,["disabled"]),o("div",fl,[o("div",vl,[_e(o("textarea",{"onUpdate:modelValue":z[0]||(z[0]=Z=>g.value=Z),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:M.value,onKeydown:G,onInput:B},null,40,gl),[[Ce,g.value]])]),o("div",yl,[_e(o("select",{"onUpdate:modelValue":z[1]||(z[1]=Z=>f.value=Z),class:"selection-input",title:I.$t("input.selectionTitle"),disabled:j.value||M.value},[o("option",_l,u(I.$t("input.defaultFuncAgent")),1),(h(!0),y(he,null,ge(S.value,Z=>(h(),y("option",{key:Z.value,value:Z.value},u(Z.label),9,wl))),128))],8,bl),[[Ot,f.value]]),p.value?(h(),y("button",{key:1,class:"send-button stop-button",onClick:se,title:I.$t("input.stop")},[A(d(D),{icon:"carbon:stop-filled"}),me(" "+u(I.$t("input.stop")),1)],8,Sl)):(h(),y("button",{key:0,class:"send-button",disabled:!g.value.trim()||M.value,onClick:Q,title:I.$t("input.send")},[A(d(D),{icon:"carbon:send-alt"}),me(" "+u(I.$t("input.send")),1)],8,$l))])])]))}}),Tl=Ee(Pl,[["__scopeId","data-v-63823e52"]]);class ht{static BASE_URL="/api/memories";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getMemories(){try{const t=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(t)).json()).memories??[]}catch(t){throw console.error("Failed to get memory list:",t),t}}static async getMemory(t){try{const e=await fetch(`${this.BASE_URL}/single?conversationId=${t}`),a=await(await this.handleResponse(e)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(e){throw console.error("Failed to get memory:",e),e}}static async createMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(t,e){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t,memory_name:e})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(t){try{const e=await fetch(`${this.BASE_URL}/${t}`,{method:"DELETE"});await this.handleResponse(e)}catch(e){throw console.error("Failed to delete memory:",e),e}}static async generateConversationId(){try{const t=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(t)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(t){throw console.error("Failed to generate conversation ID:",t),t}}static async getConversationHistory(t){try{const e=await fetch(`${this.BASE_URL}/${t}/history`);return await(await this.handleResponse(e)).json()||[]}catch(e){throw console.error("Failed to get conversation history:",e),e}}}const El={key:0,class:"app-container"},kl={class:"app-content"},Cl={class:"header"},Il={class:"relative"},Rl={class:"title-edit-group"},xl={id:"main-title",class:"main-title"},Al={key:0,id:"title-edit-container",class:"title-edit-container"},Fl={class:"search-bar"},Ml={class:"search-container"},Dl=["placeholder"],Nl={class:"message-list",id:"message-list"},Ul={class:"message-header"},Ll={class:"message-content"},Ol={class:"sender-info"},ql=["onClick"],Bl={class:"sender-name"},Hl={class:"action-buttons"},Vl=["onClick"],jl={class:"action-buttons"},zl=["onClick"],Wl={class:"message-meta"},Gl={class:"message-id"},Kl={class:"meta-right"},Jl={key:0,class:"unread-count"},Xl={class:"message-time"},Yl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Zl={class:"bubble-avatar"},er={class:"bubble-content"},tr={class:"bubble-text"},sr={key:0,class:"empty-state"},or={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr=["placeholder"],rr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},ir={class:"modal-footer"},cr={class:"modal-content"},ur={class:"modal-header"},dr={class:"modal-title"},pr={class:"state-text",id:"delete-message"},mr={class:"modal-footer"},hr=Te({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(n,{emit:t}){const e=F(!1),s=F(""),a=F([]),l=F([]),r=F(!1),p=F(null),b=F(""),i=F(!1),c=F(null),g=new Map,E=t,v=L=>{L.key==="Escape"&&(i.value?C():r.value&&R())};Me(()=>{Ie.setLoadMessages(m),document.addEventListener("keydown",v)}),Ue(()=>{document.removeEventListener("keydown",v)});const m=async()=>{try{const L=await ht.getMemories();a.value=L.map(W=>({...W,expanded:g.has(W.conversation_id)?g.get(W.conversation_id):!1})),l.value=[...a.value],f()}catch(L){console.error("error:",L),a.value=[],l.value=[]}},w=L=>{Ie.selectMemory(L),E("memory-selected")},_=L=>{const W=typeof L=="string"?parseInt(L,10):L;return isNaN(W)||W<=0?"--":new Date(W.toString().length===13?W:W*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},f=()=>{const L=s.value.toLowerCase().trim();if(!L){l.value=[...a.value];return}l.value=a.value.filter(W=>{const S=W.memory_name.toLowerCase().includes(L),x=W.conversation_id.toLowerCase().includes(L),T=W.messages?.some(O=>O.text.toLowerCase().includes(L))??!1;return S||x||T})},R=()=>{r.value=!1,p.value=null},j=async()=>{if(!p.value)return;const L=b.value.trim()||"unknow name",W=a.value.findIndex(S=>S.conversation_id===p.value);if(W!==-1){const S=a.value[W];try{const x=await ht.updateMemory(S.conversation_id,L);x.messages||(x.messages=[]),a.value[W]={...x,expanded:S.expanded},f(),r.value=!1}catch(x){console.error("error:",x)}}},X=L=>{const W=a.value.find(S=>S.conversation_id===L);if(W){W.expanded=!W.expanded,g.set(L,W.expanded);const S=l.value.findIndex(x=>x.conversation_id===L);S!==-1&&(l.value[S]={...W})}},P=L=>{c.value=L,i.value=!0},C=()=>{i.value=!1,c.value=null},U=async()=>{if(c.value)try{await ht.deleteMemory(c.value),a.value=a.value.filter(L=>L.conversation_id!==c.value),f(),a.value.length===0&&Ie.clearMemoryId(),i.value=!1,c.value=null}catch(L){console.error("error:",L)}};return(L,W)=>(h(),$e(mo,{to:"body"},[A(qt,{name:"modal"},{default:Ye(()=>[d(Ie).isCollapsed?(h(),y("div",El,[o("div",kl,[o("div",Cl,[o("div",Il,[o("div",Rl,[o("h1",xl,[o("span",null,u(L.$t("memory.title")),1)])]),e.value?(h(),y("div",Al)):H("",!0)]),o("button",{class:"close-btn",onClick:W[0]||(W[0]=S=>d(Ie).toggleSidebar())},[A(d(D),{icon:"carbon:close"})])]),o("div",Fl,[o("div",Ml,[A(d(D),{class:"search-container-icon",icon:"carbon:search"}),_e(o("input",{type:"text",placeholder:L.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":W[1]||(W[1]=S=>s.value=S),onInput:f},null,40,Dl),[[Ce,s.value]])])]),o("div",Nl,[o("div",null,[(h(!0),y(he,null,ge(l.value,S=>(h(),y("div",{class:ve(["message-item",{expanded:S.expanded}]),key:S.conversation_id},[o("div",Ul,[o("div",Ll,[o("div",Ol,[o("div",{class:"sender-div",onClick:we(x=>w(S.conversation_id),["stop"])},[o("h3",Bl,u(S.memory_name),1)],8,ql),o("div",Hl,[o("button",{class:"delete-btn",onClick:we(x=>X(S.conversation_id),["stop"])},[A(d(D),{id:"toggle-"+S.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Vl)]),o("div",jl,[o("button",{class:"delete-btn",onClick:we(x=>P(S.conversation_id),["stop"])},[A(d(D),{icon:"carbon:delete"})],8,zl)])]),o("div",Wl,[o("span",Gl,"ID: "+u(S.conversation_id),1),o("div",Kl,[S.messages&&S.messages.length>0?(h(),y("span",Jl,u(S.messages.length)+" "+u(L.$t("memory.size")),1)):H("",!0),o("span",Xl,u(_(S.create_time)),1)])])])]),S.expanded?(h(),y("div",{key:0,id:"content-"+S.conversation_id,class:"expanded-content"},[o("div",Ql,[(h(!0),y(he,null,ge(S.messages,(x,T)=>(h(),y("div",{class:"message-bubble",key:T},[o("div",Zl,u(x.messageType),1),o("div",er,[o("p",tr,u(x.text),1)])]))),128))])],8,Yl)):H("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),y("div",sr,W[3]||(W[3]=[o("p",{class:"state-text"},"none message",-1)]))):H("",!0)]),r.value?(h(),y("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:we(R,["self"])},[o("div",or,[o("div",nr,[o("h3",ar,u(L.$t("memory.changeName")),1),_e(o("input",{type:"text","onUpdate:modelValue":W[2]||(W[2]=S=>b.value=S),class:"edit-input",placeholder:L.$t("memory.newNamePlaceholder")},null,8,lr),[[Ce,b.value]]),o("span",rr,u(b.value.length),1)]),o("div",ir,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:R},u(L.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:j},u(L.$t("memory.save")),1)])])])):H("",!0),i.value?(h(),y("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:we(C,["self"])},[o("div",cr,[o("div",ur,[o("h3",dr,u(L.$t("memory.deleteHint")),1),o("p",pr,u(L.$t("memory.deleteHintPrefix"))+" "+u(c.value)+" "+u(L.$t("memory.deleteHintSuffix")),1)]),o("div",mr,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:C},u(L.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:U},u(L.$t("memory.delete")),1)])])])):H("",!0)])])):H("",!0)]),_:1})]))}}),fr=Ee(hr,[["__scopeId","data-v-16358835"]]);class Je{static BASE_URL="/api/file-browser";static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message??`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getFileTree(t){try{const e=await fetch(`${this.BASE_URL}/tree/${t}`),a=await(await this.handleResponse(e)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(e){throw console.error("Failed to get file tree:",e),e}}static async getFileContent(t,e){try{const s=await fetch(`${this.BASE_URL}/content/${t}?path=${encodeURIComponent(e)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(t,e,s){try{const a=await fetch(`${this.BASE_URL}/download/${t}?path=${encodeURIComponent(e)}`);await this.handleResponse(a);const l=await a.blob(),r=window.URL.createObjectURL(l),p=document.createElement("a");p.href=r,p.download=s??e.split("/").pop()??"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(r),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(t,e){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(r=>t.startsWith(r)))return!0;const l=e.toLowerCase();return a.some(r=>l.endsWith(r))}static getFileIcon(t){if(t.type==="directory")return"carbon:folder";const e=t.name.toLowerCase();return e.endsWith(".js")?"vscode-icons:file-type-js":e.endsWith(".ts")?"vscode-icons:file-type-typescript":e.endsWith(".vue")?"vscode-icons:file-type-vue":e.endsWith(".java")?"vscode-icons:file-type-java":e.endsWith(".py")?"vscode-icons:file-type-python":e.endsWith(".json")?"vscode-icons:file-type-json":e.endsWith(".xml")?"vscode-icons:file-type-xml":e.endsWith(".html")?"vscode-icons:file-type-html":e.endsWith(".css")?"vscode-icons:file-type-css":e.endsWith(".md")?"vscode-icons:file-type-markdown":e.endsWith(".yml")||e.endsWith(".yaml")?"vscode-icons:file-type-yaml":e.endsWith(".pdf")?"vscode-icons:file-type-pdf2":e.endsWith(".doc")||e.endsWith(".docx")?"vscode-icons:file-type-word":e.endsWith(".xls")||e.endsWith(".xlsx")?"vscode-icons:file-type-excel":e.endsWith(".ppt")||e.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":e.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":e.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const vr={class:"file-tree-node"},gr={class:"node-icon"},yr={class:"node-name"},br={key:1,class:"file-size"},_r={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=Te({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:t}){const e=n,s=t,a=F(e.level===0),l=F(!1),r=F(!1),p=F({}),b=()=>{e.node.type==="directory"&&(a.value=!a.value)},i=()=>{e.node.type==="directory"?b():c()},c=()=>{e.node.type==="file"&&s("file-selected",e.node),v()},g=()=>{s("download-file",e.node),v()},E=f=>{f.preventDefault(),r.value=!0,p.value={position:"fixed",top:`${f.clientY}px`,left:`${f.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",v)},0)},v=()=>{r.value=!1,document.removeEventListener("click",v)},m=async()=>{try{await navigator.clipboard.writeText(e.node.path)}catch(f){console.error("Failed to copy path:",f)}v()},w=()=>e.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Je.getFileIcon(e.node),_=f=>{if(f===0)return"0 B";const R=1024,j=["B","KB","MB","GB"],X=Math.floor(Math.log(f)/Math.log(R));return parseFloat((f/Math.pow(R,X)).toFixed(1))+" "+j[X]};return Ue(()=>{document.removeEventListener("click",v)}),(f,R)=>{const j=ys("FileTreeNode",!0);return h(),y("div",vr,[o("div",{class:ve(["node-content",{"is-directory":f.node.type==="directory","is-file":f.node.type==="file","is-expanded":a.value}]),style:Xe({paddingLeft:`${f.level*16+12}px`}),onClick:i,onContextmenu:we(E,["prevent"])},[f.node.type==="directory"?(h(),y("div",{key:0,class:"expand-icon",onClick:we(b,["stop"])},[A(d(D),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):H("",!0),o("div",gr,[A(d(D),{icon:w()},null,8,["icon"])]),o("span",yr,u(f.node.name),1),f.node.type==="file"?(h(),y("span",br,u(_(f.node.size)),1)):H("",!0),l.value?(h(),y("div",_r,[f.node.type==="file"?(h(),y("button",{key:0,onClick:R[0]||(R[0]=we(X=>f.$emit("download-file",f.node),["stop"])),class:"action-btn download-btn",title:"Download"},[A(d(D),{icon:"carbon:download"})])):H("",!0)])):H("",!0)],38),f.node.type==="directory"&&a.value&&f.node.children?(h(),y("div",wr,[(h(!0),y(he,null,ge(f.node.children,X=>(h(),$e(j,{key:X.path,node:X,level:f.level+1,onFileSelected:R[1]||(R[1]=P=>f.$emit("file-selected",P)),onDownloadFile:R[2]||(R[2]=P=>f.$emit("download-file",P))},null,8,["node","level"]))),128))])):H("",!0),r.value?(h(),y("div",{key:1,class:"context-menu",style:Xe(p.value),onClick:R[3]||(R[3]=we(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:c},[A(d(D),{icon:"carbon:view"}),R[4]||(R[4]=o("span",null,"Open",-1))]),f.node.type==="file"?(h(),y("div",{key:0,class:"context-menu-item",onClick:g},[A(d(D),{icon:"carbon:download"}),R[5]||(R[5]=o("span",null,"Download",-1))])):H("",!0),R[7]||(R[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:m},[A(d(D),{icon:"carbon:copy"}),R[6]||(R[6]=o("span",null,"Copy Path",-1))])],4)):H("",!0)])}}}),Sr=Ee($r,[["__scopeId","data-v-3fc455d1"]]),Pr={class:"file-browser"},Tr={class:"file-browser-header"},Er={class:"header-actions"},kr=["disabled","title"],Cr={class:"file-browser-content"},Ir={class:"file-tree-panel"},Rr={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Ar={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Mr={class:"tips"},Dr=["disabled"],Nr={key:1,class:"actual-error"},Ur={key:2,class:"empty-state"},Lr={key:3,class:"file-tree"},Or={key:0,class:"file-content-panel"},qr={class:"file-content-header"},Br={class:"file-info"},Hr={class:"file-name"},Vr={class:"file-size"},jr={class:"file-actions"},zr=["title"],Wr=["title"],Gr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Xr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Qr={key:1,class:"binary-content"},Zr=Te({name:"FileBrowser",__name:"index",props:{planId:{}},setup(n){const t=n,{t:e}=De(),s=F(!1),a=F(null),l=F(null),r=F(null),p=F(null),b=F(!1),i=F(null),c=F(null),g=ae(()=>!p.value||!r.value?!1:Je.isTextFile(p.value.mimeType,r.value.name)),E=ae(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),v=()=>{c.value&&(clearTimeout(c.value),c.value=null)},m=()=>{v(),c.value=window.setTimeout(()=>{E.value&&w()},5e3)},w=async()=>{if(t.planId){s.value=!0,a.value=null,v();try{l.value=await Je.getFileTree(t.planId)}catch(P){a.value=P instanceof Error?P.message:e("fileBrowser.loadError"),console.error("Failed to load file tree:",P);const C=P instanceof Error?P.message:"";(C.includes("Plan directory not found")||C.includes("not found"))&&m()}finally{s.value=!1}}},_=async P=>{if(P.type!=="directory"){r.value=P,p.value=null,b.value=!0,i.value=null;try{p.value=await Je.getFileContent(t.planId,P.path)}catch(C){i.value=C instanceof Error?C.message:e("fileBrowser.contentLoadError"),console.error("Failed to load file content:",C)}finally{b.value=!1}}},f=async P=>{try{await Je.downloadFile(t.planId,P.path,P.name)}catch(C){console.error("Failed to download file:",C)}},R=()=>{r.value=null,p.value=null,i.value=null},j=P=>Je.getFileIcon(P),X=P=>{if(P===0)return"0 B";const C=1024,U=["B","KB","MB","GB"],L=Math.floor(Math.log(P)/Math.log(C));return parseFloat((P/Math.pow(C,L)).toFixed(1))+" "+U[L]};return ye(()=>t.planId,P=>{P&&(r.value=null,p.value=null,w())},{immediate:!0}),Me(()=>{t.planId&&w()}),Ue(()=>{v()}),(P,C)=>(h(),y("div",Pr,[o("div",Tr,[o("h3",null,u(P.$t("fileBrowser.title")),1),o("div",Er,[o("button",{class:"refresh-btn",onClick:w,disabled:s.value,title:P.$t("fileBrowser.refresh")},[A(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kr)])]),o("div",Cr,[o("div",Ir,[s.value?(h(),y("div",Rr,[A(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(P.$t("fileBrowser.loading")),1)])):a.value?(h(),y("div",xr,[E.value?(h(),y("div",Ar,[A(d(D),{icon:"carbon:time",class:"rotating"}),o("div",Fr,[o("h3",null,u(P.$t("fileBrowser.waitingForGeneration")),1),o("p",null,u(P.$t("fileBrowser.planExecuting")),1),o("div",Mr,[A(d(D),{icon:"carbon:information"}),o("span",null,u(P.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:w,class:"retry-btn",disabled:s.value},[A(d(D),{icon:"carbon:refresh",class:ve({rotating:s.value})},null,8,["class"]),me(" "+u(s.value?P.$t("fileBrowser.checking"):P.$t("fileBrowser.checkNow")),1)],8,Dr)])):(h(),y("div",Nr,[A(d(D),{icon:"carbon:warning"}),o("span",null,u(a.value),1),o("button",{onClick:w,class:"retry-btn"},u(P.$t("fileBrowser.retry")),1)]))])):l.value?(h(),y("div",Lr,[A(Sr,{node:l.value,level:0,onFileSelected:_,onDownloadFile:f},null,8,["node"])])):(h(),y("div",Ur,[A(d(D),{icon:"carbon:folder-off"}),o("span",null,u(P.$t("fileBrowser.noFiles")),1)]))]),r.value?(h(),y("div",Or,[o("div",qr,[o("div",Br,[A(d(D),{icon:j(r.value)},null,8,["icon"]),o("span",Hr,u(r.value.name),1),o("span",Vr,"("+u(X(r.value.size))+")",1)]),o("div",jr,[o("button",{onClick:C[0]||(C[0]=U=>f(r.value)),class:"download-btn",title:P.$t("fileBrowser.download")},[A(d(D),{icon:"carbon:download"})],8,zr),o("button",{onClick:R,class:"close-btn",title:P.$t("common.close")},[A(d(D),{icon:"carbon:close"})],8,Wr)])]),o("div",Gr,[b.value?(h(),y("div",Kr,[A(d(D),{icon:"carbon:loading",class:"rotating"}),o("span",null,u(P.$t("fileBrowser.loadingContent")),1)])):i.value?(h(),y("div",Jr,[A(d(D),{icon:"carbon:warning"}),o("span",null,u(i.value),1)])):p.value?(h(),y("div",Xr,[g.value?(h(),y("div",Yr,[o("pre",null,[o("code",null,u(p.value.content),1)])])):(h(),y("div",Qr,[A(d(D),{icon:"carbon:document-unknown"}),o("p",null,u(P.$t("fileBrowser.binaryFile")),1),o("button",{onClick:C[1]||(C[1]=U=>f(r.value)),class:"download-btn-large"},[A(d(D),{icon:"carbon:download"}),me(" "+u(P.$t("fileBrowser.downloadToView")),1)])]))])):H("",!0)])])):H("",!0)])]))}}),ei=Ee(Zr,[["__scopeId","data-v-a19b1e5b"]]);class Es{static BASE_URL="/api/plan-template";static async getParameterRequirements(t){try{const e=await fetch(`${this.BASE_URL}/${t}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get parameter requirements: ${e.statusText}`);return await e.json()}catch(e){throw console.error("Error getting parameter requirements:",e),e}}}class ks{static async handleResponse(t){if(!t.ok)try{const e=await t.json();throw new Error(e.message||`API request failed: ${t.status}`)}catch{throw new Error(`API request failed: ${t.status} ${t.statusText}`)}return t}static async getAvailableTools(){try{const t=await fetch("/api/tools");return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get available tools:",t),t}}}function ti(){const n=F([]),t=F(!1),e=F(null);return{availableTools:n,isLoading:t,error:e,loadAvailableTools:async()=>{if(!t.value){t.value=!0,e.value=null;try{console.log("[useAvailableTools] Loading available tools...");const l=await ks.getAvailableTools();console.log("[useAvailableTools] Loaded available tools:",l),n.value=l.filter(r=>r.selectable!==!1).map(r=>({key:r.key||"",name:r.name||"",description:r.description||"",enabled:r.enabled||!1,serviceGroup:r.serviceGroup||"default",selectable:r.selectable}))}catch(l){console.error("[useAvailableTools] Error loading tools:",l),e.value=l instanceof Error?l.message:"Unknown error",n.value=[]}finally{t.value=!1}}},reset:()=>{n.value=[],t.value=!1,e.value=null}}}let kt=null;function at(){return kt||(kt=ti()),kt}const si={class:"modal-form wide-modal"},oi={class:"form-section"},ni={class:"form-item"},ai=["placeholder"],li={class:"field-description"},ri={class:"form-section"},ii={class:"section-title"},ci={key:0,class:"params-help-text"},ui={class:"parameter-table"},di=["onUpdate:modelValue","placeholder","readonly"],pi=["onUpdate:modelValue","placeholder"],mi={class:"form-section"},hi={class:"service-publish-options"},fi={class:"internal-toolcall-publish-option"},vi={class:"checkbox-label"},gi={class:"checkbox-text"},yi={class:"checkbox-description"},bi={class:"http-publish-option"},_i={class:"checkbox-label"},wi={class:"checkbox-text"},$i={class:"checkbox-description"},Si={class:"button-container"},Pi=["disabled"],Ti=["disabled"],Ei=Te({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","published"],setup(n,{expose:t,emit:e}){const{t:s}=De(),a=We(),l=at(),r=n,p=e,b=ae({get:()=>r.modelValue,set:T=>p("update:modelValue",T)}),i=F(""),c=F(""),g=F(!1),E=F(!1),v=F(!1),m=F(!0),w=F({parameters:[],hasParameters:!1,requirements:""}),_=F(!1),f=He({userRequest:"",parameters:[]}),R=ae(()=>{const T=!!a.selectedTemplate.value?.toolConfig;return s(T?"mcpService.updateService":"mcpService.createService")}),j=ae(()=>!!a.selectedTemplate.value?.toolConfig),X=()=>{const T=a.selectedTemplate.value?.toolConfig;T?(f.userRequest=T.toolDescription||"",v.value=T.enableHttpService??!1,m.value=T.enableInternalToolcall??!0,T.inputSchema&&Array.isArray(T.inputSchema)&&T.inputSchema.length>0?f.parameters=T.inputSchema.map(O=>({name:O.name||"",description:O.description||""})):w.value.hasParameters||(f.parameters=[])):(f.userRequest="",v.value=!1,m.value=!0,w.value.hasParameters||(f.parameters=[]))},P=async()=>{const T=a.currentPlanTemplateId.value;if(!T){w.value={parameters:[],hasParameters:!1,requirements:""},f.parameters=[];return}_.value=!0;try{const O=await Es.getParameterRequirements(T);if(w.value=O,console.log("[PublishModal] Parameter requirements loaded:",O),O.hasParameters){const N=new Map;f.parameters.forEach(q=>{q.name&&N.set(q.name,q.description||"")}),f.parameters=O.parameters.map(q=>({name:q,description:N.get(q)||""})),console.log("[PublishModal] Updated formData.parameters with requirements:",f.parameters)}else f.parameters=[],console.log("[PublishModal] No parameters in plan template, cleared formData.parameters")}catch(O){console.error("[PublishModal] Failed to load parameter requirements:",O),O instanceof Error&&!O.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),w.value={parameters:[],hasParameters:!1,requirements:""},f.parameters=[]}finally{_.value=!1}},C=()=>{console.log("[PublishModal] Starting parameter merge"),console.log("[PublishModal] Frontend parameters:",w.value.parameters),console.log("[PublishModal] Form parameters:",f.parameters);const T=a.selectedTemplate.value?.toolConfig?.inputSchema||[];console.log("[PublishModal] Backend inputSchema:",T);const O=new Map;if(T.forEach(N=>{N.name&&O.set(N.name,N.description||"")}),w.value.hasParameters){const N=w.value.parameters.map(q=>{const J=f.parameters.find(ce=>ce.name===q)?.description||""||O.get(q)||"";return{name:q,description:J}});return console.log("[PublishModal] Merged parameters (from plan template):",N),N}return console.log("[PublishModal] No parameters in plan template, clearing backend parameters"),[]},U=(T,O)=>{O==="success"?(c.value=T,setTimeout(()=>{c.value=""},3e3)):O==="error"&&(i.value=T,setTimeout(()=>{i.value=""},5e3))},L=()=>{if(!f.userRequest.trim())return U(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!(a.getServiceGroup()||"").trim())return U(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!(a.getTitle()||"").trim())return U(s("mcpService.toolNameRequiredError"),"error"),!1;if(!m.value&&!v.value)return U("Please select at least one service type","error"),!1;for(let N=0;N<f.parameters.length;N++){const q=f.parameters[N];if(q.name&&!q.description.trim())return U(`Parameter "${q.name}" description cannot be empty`,"error"),!1;if(q.description&&!q.name.trim())return U(`Parameter description "${q.description}" corresponding name cannot be empty`,"error"),!1}return!0},W=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",f),console.log("[PublishModal] Publish as HTTP service:",v.value),!L()){console.log("[PublishModal] Form validation failed");return}g.value=!0;try{const T=C();console.log("[PublishModal] Merged parameters:",T);const O=T.filter(ee=>ee.name.trim()).map(ee=>({name:ee.name.trim(),description:ee.description.trim()||"",type:"string"}));if(a.setToolDescriptionWithGuard(f.userRequest.trim()),a.setEnableInternalToolcallWithGuard(m.value),a.setEnableHttpServiceWithGuard(v.value),a.setInputSchemaWithGuard(O),!await a.save())throw new Error("Failed to save plan template");const q=[];m.value&&q.push("Internal Method Call"),v.value&&q.push("HTTP Service"),q.length>0?(console.log("[PublishModal] Service published successfully. Enabled services:",q.join(", ")),U(s("mcpService.publishSuccess"),"success"),await l.loadAvailableTools(),p("published",null)):(console.log("[PublishModal] Only saving tool, not publishing as any service"),U(s("mcpService.saveSuccess"),"success"),await l.loadAvailableTools(),p("published",null))}catch(T){console.error("[PublishModal] Failed to publish service:",T);const O=T instanceof Error?T.message:"Unknown error";U(s("mcpService.publishFailed")+": "+O,"error")}finally{g.value=!1}},S=async()=>{if(E.value||!confirm(s("mcpService.deleteConfirmMessage")))return;const T=a.currentPlanTemplateId.value;if(!T){U(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}E.value=!0;try{if(console.log("[PublishModal] Starting to delete tool config for planTemplateId:",T),a.setToolConfigWithGuard(void 0),!await a.save())throw new Error("Failed to save plan template after deletion");console.log("[PublishModal] Deleted successfully"),U(s("mcpService.deleteSuccess"),"success"),b.value=!1,p("published",null)}catch(O){console.error("[PublishModal] Failed to delete tool config:",O);const N=O instanceof Error?O.message:"Unknown error";U(s("mcpService.deleteFailed")+": "+N,"error")}finally{E.value=!1}};return ye(()=>r.modelValue,async()=>{b.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),X(),await P())}),ye(()=>a.currentPlanTemplateId.value,(T,O)=>{T&&T!==O&&(O&&T.startsWith("planTemplate-")?setTimeout(()=>{P()},1e3):P())}),Me(async()=>{b.value&&(console.log("[PublishModal] Initialize when component mounted"),X(),await P())}),t({loadParameterRequirements:P}),(T,O)=>(h(),y(he,null,[A($s,{modelValue:b.value,"onUpdate:modelValue":O[3]||(O[3]=N=>b.value=N),title:R.value,onConfirm:W},{footer:Ye(()=>[o("div",Si,[j.value?(h(),y("button",{key:0,class:"action-btn danger",onClick:S,disabled:E.value},[E.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),$e(d(D),{key:1,icon:"carbon:trash-can"})),me(" "+u(E.value?d(s)("mcpService.deleting"):d(s)("mcpService.delete")),1)],8,Pi)):H("",!0),o("button",{class:"action-btn primary",onClick:W,disabled:g.value},[g.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),$e(d(D),{key:1,icon:"carbon:cloud-upload"})),me(" "+u(g.value?d(s)("mcpService.publishing"):d(s)("mcpService.publishAsService")),1)],8,Ti)])]),default:Ye(()=>[o("div",si,[o("div",oi,[o("div",ni,[o("label",null,u(d(s)("mcpService.toolDescriptionRequired")),1),_e(o("textarea",{"onUpdate:modelValue":O[0]||(O[0]=N=>f.userRequest=N),placeholder:d(s)("mcpService.toolDescriptionPlaceholder"),class:ve([{error:!f.userRequest||!f.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,ai),[[Ce,f.userRequest]]),o("div",li,u(d(s)("mcpService.toolDescriptionDescription")),1)])]),o("div",ri,[o("div",ii,u(d(s)("mcpService.parameterConfig")),1),w.value.hasParameters?(h(),y("div",ci,u(d(s)("sidebar.parameterRequirementsHelp")),1)):H("",!0),o("div",ui,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,u(d(s)("mcpService.parameterName")),1),o("th",null,u(d(s)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(h(!0),y(he,null,ge(f.parameters,(N,q)=>(h(),y("tr",{key:q},[o("td",null,[_e(o("input",{type:"text","onUpdate:modelValue":ee=>N.name=ee,placeholder:d(s)("mcpService.parameterName"),class:ve(["parameter-input",{"readonly-input":w.value.hasParameters}]),readonly:w.value.hasParameters,required:""},null,10,di),[[Ce,N.name]])]),o("td",null,[_e(o("input",{type:"text","onUpdate:modelValue":ee=>N.description=ee,placeholder:d(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,pi),[[Ce,N.description]])])]))),128))])])])]),o("div",mi,[o("div",hi,[o("div",fi,[o("label",vi,[_e(o("input",{type:"checkbox","onUpdate:modelValue":O[1]||(O[1]=N=>m.value=N),class:"checkbox-input"},null,512),[[Ft,m.value]]),o("span",gi,u(d(s)("mcpService.publishAsInternalToolcall")),1)]),o("div",yi,u(d(s)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",bi,[o("label",_i,[_e(o("input",{type:"checkbox","onUpdate:modelValue":O[2]||(O[2]=N=>v.value=N),class:"checkbox-input"},null,512),[[Ft,v.value]]),o("span",wi,u(d(s)("mcpService.publishAsHttpService")),1)]),o("div",$i,u(d(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),i.value?(h(),y("div",{key:0,class:"error-toast",onClick:O[4]||(O[4]=N=>i.value="")},[A(d(D),{icon:"carbon:error"}),me(" "+u(i.value),1)])):H("",!0),c.value?(h(),y("div",{key:1,class:"success-toast",onClick:O[5]||(O[5]=N=>c.value="")},[A(d(D),{icon:"carbon:checkmark"}),me(" "+u(c.value),1)])):H("",!0)],64))}}),ki=Ee(Ei,[["__scopeId","data-v-235a4588"]]),Ci={class:"modal-header"},Ii={class:"modal-body"},Ri={class:"modal-footer"},xi=["disabled"],Ai=Te({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(n,{emit:t}){const e=t,s=F(!1),a=()=>{e("update:modelValue",!1)},l=async()=>{s.value=!0;try{e("save"),e("update:modelValue",!1)}finally{s.value=!1}},r=()=>{e("continue"),e("update:modelValue",!1)};return(p,b)=>p.modelValue?(h(),y("div",{key:0,class:"modal-overlay",onClick:a},[o("div",{class:"modal-content",onClick:b[0]||(b[0]=we(()=>{},["stop"]))},[o("div",Ci,[o("h3",null,u(p.$t("sidebar.saveConfirmationTitle")),1),o("button",{class:"close-btn",onClick:a},[A(d(D),{icon:"carbon:close",width:"16"})])]),o("div",Ii,[o("p",null,u(p.$t("sidebar.saveConfirmationMessage")),1)]),o("div",Ri,[o("button",{class:"btn btn-secondary",onClick:a},u(p.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:l,disabled:s.value},[s.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):H("",!0),me(" "+u(s.value?p.$t("sidebar.saving"):p.$t("common.save")),1)],8,xi),o("button",{class:"btn btn-danger",onClick:r},u(p.$t("sidebar.continueWithoutSave")),1)])])])):H("",!0)}}),Fi=Ee(Ai,[["__scopeId","data-v-4817656d"]]),Mi={class:"config-section"},Di={class:"section-header"},Ni={class:"execution-content"},Ui={class:"params-requirements-group"},Li={class:"params-help-text"},Oi={key:0,class:"parameter-fields"},qi={class:"parameter-label"},Bi=["onUpdate:modelValue","placeholder","onInput"],Hi={key:0,class:"parameter-error"},Vi={key:1,class:"validation-message"},ji=["disabled"],zi=["disabled"],Wi={key:1,class:"call-example-wrapper"},Gi={class:"call-example-header"},Ki={class:"call-example-title"},Ji={class:"call-example-description"},Xi={class:"internal-call-wrapper"},Yi={class:"call-info"},Qi={class:"call-method"},Zi={class:"call-endpoint"},ec={key:0,class:"call-endpoint"},tc={class:"call-description"},sc={class:"call-example"},oc={class:"example-code"},nc={key:2,class:"call-example-wrapper"},ac={class:"call-example-header"},lc={class:"call-example-title"},rc={class:"call-example-description"},ic={class:"http-api-urls-wrapper"},cc={class:"tab-container"},uc={class:"tab-header"},dc=["onClick"],pc={class:"tab-content"},mc={class:"http-api-url-display"},hc={class:"api-method"},fc={class:"api-endpoint"},vc={class:"api-description"},gc={key:0,class:"api-example"},yc={class:"example-code"},bc={key:3,class:"call-example-wrapper"},_c={class:"call-example-header"},wc={class:"call-example-title"},$c={class:"call-example-description"},Sc={class:"mcp-call-wrapper"},Pc={class:"call-info"},Tc={class:"call-method"},Ec={class:"call-endpoint"},kc={class:"call-description"},Cc={class:"call-example"},Ic={class:"example-code"},Rc=Te({__name:"ExecutionController",props:{isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=Bt(),a=We(),l=et(),r=Ze(),p=n,b=F(""),i=F(!1),c=F({parameters:[],hasParameters:!1,requirements:""}),g=F({}),E=F(!1),v=F("post-async"),m=F({}),w=F(!1),_=F(!1),f=F(null),R=ae(()=>a.getCoordinatorToolConfig()),j=F(),X=F([]),P=F(null),C=F(!1),U=F(null),L=ae(()=>{const V=a.selectedTemplate.value?.title||"my-tool",I=a.selectedTemplate.value?.serviceGroup||"research",z=a.selectedTemplate.value?.planTemplateId||"template-456",Z={};c.value.hasParameters&&c.value.parameters.length>0?c.value.parameters.forEach(be=>{Z[be]=g.value[be]||"test"}):Z.rawParam="test";const ne=f.value||e("sidebar.defaultPlanId"),oe=f.value||e("sidebar.defaultPlanIdDetails");return[{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "${V}",
  "serviceGroup": "${I}",
  "replacementParams": ${JSON.stringify(Z,null,2)},
  "uploadedFiles": []
}

Note: serviceGroup is optional. Use it to disambiguate tools with the same name in different service groups.

Response: {
  "planId": "${ne}",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "${V}",
  "planTemplateId": "${z}"
}

# Check execution status and get detailed results:
GET /api/executor/details/${oe}
Response: {
  "currentPlanId": "${ne}",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "${V}",
  "serviceGroup": "${I}",
  "replacementParams": ${JSON.stringify(Z,null,2)},
  "uploadedFiles": []
}

Note: serviceGroup is optional. Use it to disambiguate tools with the same name in different service groups.

Response: {
  "status": "completed",
  "result": "Execution result here"
}`}]}),W=ae(()=>{const V=a.selectedTemplate.value?.toolConfig;return V?.enableInternalToolcall??V?.enableHttpService??V?.enableMcpService??!1}),S=ae(()=>W.value?e("sidebar.updateServiceStatus"):e("sidebar.publishMcpService")),x=ae(()=>l.isLoading.value),T=ae(()=>{if(x.value||p.isExecuting||_.value)return!1;const V=r.trackedPlanIds.value.size>0,z=Array.from(r.planExecutionRecords.entries()).some(([,Z])=>Z&&!Z.completed&&Z.status!=="failed");return V||z?!1:c.value.hasParameters?c.value.parameters.every(Z=>{const ne=g.value[Z];return typeof ne=="string"&&ne.trim()!==""}):!0}),O=(V,I)=>{X.value=V.map(z=>z.originalName),P.value=I,console.log("[ExecutionController] Files uploaded:",V.length,"uploadKey:",I)},N=V=>{X.value=V.map(I=>I.originalName),console.log("[ExecutionController] Files removed, remaining:",V.length)},q=V=>{P.value=V,console.log("[ExecutionController] Upload key changed:",V)},ee=()=>{console.log("[ExecutionController] Upload started")},Se=()=>{console.log("[ExecutionController] Upload completed")},J=V=>{console.error("[ExecutionController] Upload error:",V)},ce=async()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),p.isExecuting||l.isLoading.value||_.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress. isExecuting: {}, messageDialog.isLoading: {}, isExecutingPlan: {}",p.isExecuting,l.isLoading.value,_.value),s.error(e("sidebar.executionInProgress"));return}if(de.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!pe()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value);return}const V=c.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;U.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:V,uploadedFiles:X.value,uploadKey:P.value},C.value=!0;return}await ke()},ke=async()=>{if(p.isExecuting||l.isLoading.value||_.value){console.log("[ExecutionController] â¸ï¸ Execution already in progress in proceedWithExecution. Skipping.");return}if(_.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!pe()){console.log("[ExecutionController] âŒ Parameter validation failed:",m.value),_.value=!1;return}try{if(!a.selectedTemplate.value){console.log("[ExecutionController] âŒ No template selected, returning"),s.error(e("sidebar.selectPlanFirst")),_.value=!1;return}const V=a.getConfig(),I=a.selectedTemplate.value.planTemplateId||V.planTemplateId,z={title:V.title||a.selectedTemplate.value.title||"Execution Plan",steps:(V.steps||[]).map(Ge=>({stepRequirement:Ge.stepRequirement||"",agentName:Ge.agentName||"",modelName:Ge.modelName||null,selectedToolKeys:[],terminateColumns:Ge.terminateColumns||"",stepContent:""})),directResponse:V.directResponse||!1,...I&&{planTemplateId:I},...V.planType&&{planType:V.planType}},Z=a.selectedTemplate.value.title??V.title??"Execution Plan",ne=c.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",ne),console.log("[ExecutionController] ðŸ“‹ Prepared plan data:",JSON.stringify(z,null,2));const oe={title:Z,planData:z,params:void 0,replacementParams:ne,uploadedFiles:X.value,uploadKey:P.value};console.log("[ExecutionController] ðŸ“¤ Executing plan with payload:",JSON.stringify(oe,null,2));const be=await l.executePlan(oe);be.success?(console.log("[ExecutionController] âœ… Plan execution started successfully:",be.planId),be.planId&&(f.value=be.planId,console.log("[ExecutionController] ðŸ“ Tracked planId for API examples:",f.value))):(console.error("[ExecutionController] âŒ Plan execution failed:",be.error),s.error(be.error||e("sidebar.executeFailed")))}catch(V){console.error("[ExecutionController] âŒ Error executing plan:",V);const I=V instanceof Error?V.message:"Unknown error";s.error(e("sidebar.executeFailed")+": "+I),_.value=!1}finally{console.log("[ExecutionController] ðŸ§¹ Cleaning up after execution"),G(),console.log("[ExecutionController] âœ… Cleanup completed")}},ue=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}const V=a.validate();if(!V.isValid){s.error(`Invalid format, please correct and save.
Errors: `+V.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const Z=a.generateJsonString().trim();a.updateVersionsAfterSave(Z);const ne=a.planVersions.value.length;de.hasTaskRequirementModified=!1,await new Promise(oe=>setTimeout(oe,500)),await Q(),await de.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:ne})),await new Promise(oe=>setTimeout(oe,500)),U.value&&(await ke(),U.value=null)}catch(V){console.error("[ExecutionController] âŒ Failed to save before execute:",V);const I=V instanceof Error?V.message:e("sidebar.saveFailed");throw s.error(I),V}},M=async()=>{console.log("[ExecutionController] â© Continue without save requested"),U.value&&(await ke(),U.value=null)},B=()=>{if(console.log("[ExecutionController] Publish MCP service button clicked"),console.log("[ExecutionController] currentPlanTemplateId:",a.currentPlanTemplateId.value),!a.currentPlanTemplateId.value){console.log("[ExecutionController] No plan template selected, showing warning"),s.error(e("mcpService.selectPlanTemplateFirst"));return}i.value=!0},G=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),b.value="",g.value={},console.log("[ExecutionController] âœ… After clear - parameterValues cleared")},Q=async()=>{await new Promise(V=>setTimeout(V,1500)),console.log("[ExecutionController] ðŸ”„ Refreshing parameter requirements for templateId:",a.currentPlanTemplateId.value),console.log("[ExecutionController] ðŸ“‹ Current selectedTemplate steps:",a.selectedTemplate.value?.steps?.map(V=>V.stepRequirement).join(" ||| ")),await new Promise(V=>setTimeout(V,200)),await se()},se=async()=>{const V=a.currentPlanTemplateId.value;if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",V),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(c.value,null,2)),!V){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),c.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}c.value={parameters:[],hasParameters:!1,requirements:""},g.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),E.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const I=await Es.getParameterRequirements(V);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(I,null,2)),c.value=I;const z={};I.parameters.forEach(Z=>{z[Z]=g.value[Z]||""}),g.value=z,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(g.value,null,2)),te()}catch(I){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",I),I instanceof Error&&!I.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),c.value={parameters:[],hasParameters:!1,requirements:""},g.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(c.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(g.value,null,2))}finally{E.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},le=(V,I)=>{g.value[V]=I,m.value[V]&&delete m.value[V],te()},pe=()=>{if(m.value={},w.value=!1,!c.value.hasParameters)return!0;let V=!1;return c.value.parameters.forEach(I=>{(g.value[I]?g.value[I].trim():"")||(m.value[I]=`${I} is required`,V=!0)}),w.value=V,!V},te=()=>{c.value.hasParameters?b.value=JSON.stringify(g.value,null,2):b.value=""};return ye(()=>a.currentPlanTemplateId.value,(V,I)=>{if(V&&V!==I){if(_.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),I&&V.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),se()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),se())}}),ye(()=>de.hasTaskRequirementModified,async(V,I)=>{if(I===!0&&V===!1&&a.currentPlanTemplateId.value){if(_.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ’¾ Save completed (hasTaskRequirementModified: true -> false), refreshing parameters"),await new Promise(z=>setTimeout(z,2e3)),console.log("[ExecutionController] â° Refreshing parameters after save"),await Q()}}),_s(()=>{const V=r.planExecutionRecords,I=Array.from(V.entries()),z=r.trackedPlanIds.value.size>0,Z=I.some(([,oe])=>oe&&!oe.completed&&oe.status!=="failed");!(z||Z)&&_.value&&(console.log("[ExecutionController] All plans completed, resetting isExecutingPlan",{hasTrackedPlans:z,hasRunningPlansInRecords:Z,trackedPlanIds:Array.from(r.trackedPlanIds.value),recordsCount:I.length}),_.value=!1)}),Me(()=>{se()}),t({executionParams:b,clearExecutionParams:G,loadParameterRequirements:se,refreshParameterRequirements:Q,fileUploadRef:j,uploadedFiles:X,uploadKey:P}),(V,I)=>(h(),y(he,null,[o("div",Mi,[o("div",Di,[A(d(D),{icon:"carbon:play",width:"16"}),o("span",null,u(d(e)("sidebar.executionController")),1)]),o("div",Ni,[o("div",Ui,[o("label",null,u(d(e)("sidebar.parameterRequirements")),1),o("div",Li,u(d(e)("sidebar.parameterRequirementsHelp")),1),c.value.hasParameters?(h(),y("div",Oi,[(h(!0),y(he,null,ge(c.value.parameters,z=>(h(),y("div",{key:z,class:"parameter-field"},[o("label",qi,[me(u(z)+" ",1),I[2]||(I[2]=o("span",{class:"required"},"*",-1))]),_e(o("input",{"onUpdate:modelValue":Z=>g.value[z]=Z,class:ve(["parameter-input",{error:m.value[z]}]),placeholder:d(e)("sidebar.enterValueFor",{param:z}),onInput:Z=>le(z,Z.target.value),required:""},null,42,Bi),[[Ce,g.value[z]]]),m.value[z]?(h(),y("div",Hi,u(m.value[z]),1)):H("",!0)]))),128))])):H("",!0),c.value.hasParameters&&!T.value&&!p.isExecuting?(h(),y("div",Vi,[A(d(D),{icon:"carbon:warning",width:"14"}),me(" "+u(d(e)("sidebar.fillAllRequiredParameters")),1)])):H("",!0)]),A(Ts,{ref_key:"fileUploadRef",ref:j,disabled:p.isExecuting,onFilesUploaded:O,onFilesRemoved:N,onUploadKeyChanged:q,onUploadStarted:ee,onUploadCompleted:Se,onUploadError:J},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:ce,disabled:!T.value},[A(d(D),{icon:p.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ve({spinning:p.isExecuting})},null,8,["icon","class"]),me(" "+u(p.isExecuting?d(e)("sidebar.executing"):d(e)("sidebar.executePlan")),1)],8,ji),R.value?(h(),y("button",{key:0,class:"btn publish-mcp-btn",onClick:B,disabled:!d(a).currentPlanTemplateId.value},[A(d(D),{icon:"carbon:application",width:"16"}),me(" "+u(S.value),1)],8,zi)):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableInternalToolcall?(h(),y("div",Wi,[o("div",Gi,[o("h4",Ki,u(d(e)("sidebar.internalCall")),1),o("p",Ji,u(d(e)("sidebar.internalCallDescription")),1)]),o("div",Xi,[o("div",Yi,[o("div",Qi,u(d(e)("sidebar.internalMethodCall")),1),o("div",Zi,u(d(e)("sidebar.toolName"))+": "+u(d(a).selectedTemplate.value?.title||d(a).currentPlanTemplateId.value||""),1),d(a).selectedTemplate.value?.serviceGroup?(h(),y("div",ec,u(d(e)("sidebar.serviceGroup"))+": "+u(d(a).selectedTemplate.value.serviceGroup),1)):H("",!0),o("div",tc,u(d(e)("sidebar.internalCallUsage")),1),o("div",sc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",oc,u(d(e)("sidebar.internalCallExample")),1)])])])])):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableHttpService?(h(),y("div",nc,[o("div",ac,[o("h4",lc,u(d(e)("sidebar.httpCallExample")),1),o("p",rc,u(d(e)("sidebar.httpCallDescription")),1)]),o("div",ic,[o("div",cc,[o("div",uc,[(h(!0),y(he,null,ge(L.value,z=>(h(),y("button",{key:z.id,class:ve(["tab-button",{active:v.value===z.id}]),onClick:Z=>v.value=z.id},u(z.label),11,dc))),128))]),o("div",pc,[(h(!0),y(he,null,ge(L.value,z=>_e((h(),y("div",{key:z.id,class:"tab-panel"},[o("div",mc,[o("div",hc,u(z.method),1),o("div",fc,u(z.endpoint),1),o("div",vc,u(z.description),1),z.example?(h(),y("div",gc,[o("strong",null,u(d(e)("sidebar.example"))+":",1),o("pre",yc,u(z.example),1)])):H("",!0)])])),[[ho,v.value===z.id]])),128))])])])])):H("",!0),d(a).selectedTemplate.value?.toolConfig?.enableMcpService?(h(),y("div",bc,[o("div",_c,[o("h4",wc,u(d(e)("sidebar.mcpCall")),1),o("p",$c,u(d(e)("sidebar.mcpCallDescription")),1)]),o("div",Sc,[o("div",Pc,[o("div",Tc,u(d(e)("sidebar.mcpServiceCall")),1),o("div",Ec,u(d(e)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",kc,u(d(e)("sidebar.mcpCallUsage")),1),o("div",Cc,[o("strong",null,u(d(e)("sidebar.usage"))+":",1),o("pre",Ic,u(d(e)("sidebar.mcpCallExample")),1)])])])])):H("",!0)])]),A(Fi,{modelValue:C.value,"onUpdate:modelValue":I[0]||(I[0]=z=>C.value=z),onSave:ue,onContinue:M},null,8,["modelValue"]),A(ki,{modelValue:i.value,"onUpdate:modelValue":I[1]||(I[1]=z=>i.value=z)},null,8,["modelValue"])],64))}}),xc=Ee(Rc,[["__scopeId","data-v-303a0c4d"]]);function Cs(n,t){return function(){return n.apply(t,arguments)}}const{toString:Ac}=Object.prototype,{getPrototypeOf:Ht}=Object,{iterator:_t,toStringTag:Is}=Symbol,wt=(n=>t=>{const e=Ac.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Le=n=>(n=n.toLowerCase(),t=>wt(t)===n),$t=n=>t=>typeof t===n,{isArray:tt}=Array,Qe=$t("undefined");function lt(n){return n!==null&&!Qe(n)&&n.constructor!==null&&!Qe(n.constructor)&&Ae(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Rs=Le("ArrayBuffer");function Fc(n){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(n):t=n&&n.buffer&&Rs(n.buffer),t}const Mc=$t("string"),Ae=$t("function"),xs=$t("number"),rt=n=>n!==null&&typeof n=="object",Dc=n=>n===!0||n===!1,ft=n=>{if(wt(n)!=="object")return!1;const t=Ht(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Is in n)&&!(_t in n)},Nc=n=>{if(!rt(n)||lt(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Uc=Le("Date"),Lc=Le("File"),Oc=Le("Blob"),qc=Le("FileList"),Bc=n=>rt(n)&&Ae(n.pipe),Hc=n=>{let t;return n&&(typeof FormData=="function"&&n instanceof FormData||Ae(n.append)&&((t=wt(n))==="formdata"||t==="object"&&Ae(n.toString)&&n.toString()==="[object FormData]"))},Vc=Le("URLSearchParams"),[jc,zc,Wc,Gc]=["ReadableStream","Request","Response","Headers"].map(Le),Kc=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function it(n,t,{allOwnKeys:e=!1}={}){if(n===null||typeof n>"u")return;let s,a;if(typeof n!="object"&&(n=[n]),tt(n))for(s=0,a=n.length;s<a;s++)t.call(null,n[s],s,n);else{if(lt(n))return;const l=e?Object.getOwnPropertyNames(n):Object.keys(n),r=l.length;let p;for(s=0;s<r;s++)p=l[s],t.call(null,n[p],p,n)}}function As(n,t){if(lt(n))return null;t=t.toLowerCase();const e=Object.keys(n);let s=e.length,a;for(;s-- >0;)if(a=e[s],t===a.toLowerCase())return a;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Fs=n=>!Qe(n)&&n!==Ve;function Dt(){const{caseless:n,skipUndefined:t}=Fs(this)&&this||{},e={},s=(a,l)=>{const r=n&&As(e,l)||l;ft(e[r])&&ft(a)?e[r]=Dt(e[r],a):ft(a)?e[r]=Dt({},a):tt(a)?e[r]=a.slice():(!t||!Qe(a))&&(e[r]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&it(arguments[a],s);return e}const Jc=(n,t,e,{allOwnKeys:s}={})=>(it(t,(a,l)=>{e&&Ae(a)?n[l]=Cs(a,e):n[l]=a},{allOwnKeys:s}),n),Xc=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Yc=(n,t,e,s)=>{n.prototype=Object.create(t.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},Qc=(n,t,e,s)=>{let a,l,r;const p={};if(t=t||{},n==null)return t;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)r=a[l],(!s||s(r,n,t))&&!p[r]&&(t[r]=n[r],p[r]=!0);n=e!==!1&&Ht(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},Zc=(n,t,e)=>{n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;const s=n.indexOf(t,e);return s!==-1&&s===e},eu=n=>{if(!n)return null;if(tt(n))return n;let t=n.length;if(!xs(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},tu=(n=>t=>n&&t instanceof n)(typeof Uint8Array<"u"&&Ht(Uint8Array)),su=(n,t)=>{const s=(n&&n[_t]).call(n);let a;for(;(a=s.next())&&!a.done;){const l=a.value;t.call(n,l[0],l[1])}},ou=(n,t)=>{let e;const s=[];for(;(e=n.exec(t))!==null;)s.push(e);return s},nu=Le("HTMLFormElement"),au=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,a){return s.toUpperCase()+a}),ss=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),lu=Le("RegExp"),Ms=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),s={};it(e,(a,l)=>{let r;(r=t(a,l,n))!==!1&&(s[l]=r||a)}),Object.defineProperties(n,s)},ru=n=>{Ms(n,(t,e)=>{if(Ae(n)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=n[e];if(Ae(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},iu=(n,t)=>{const e={},s=a=>{a.forEach(l=>{e[l]=!0})};return tt(n)?s(n):s(String(n).split(t)),e},cu=()=>{},uu=(n,t)=>n!=null&&Number.isFinite(n=+n)?n:t;function du(n){return!!(n&&Ae(n.append)&&n[Is]==="FormData"&&n[_t])}const pu=n=>{const t=new Array(10),e=(s,a)=>{if(rt(s)){if(t.indexOf(s)>=0)return;if(lt(s))return s;if(!("toJSON"in s)){t[a]=s;const l=tt(s)?[]:{};return it(s,(r,p)=>{const b=e(r,a+1);!Qe(b)&&(l[p]=b)}),t[a]=void 0,l}}return s};return e(n,0)},mu=Le("AsyncFunction"),hu=n=>n&&(rt(n)||Ae(n))&&Ae(n.then)&&Ae(n.catch),Ds=((n,t)=>n?setImmediate:t?((e,s)=>(Ve.addEventListener("message",({source:a,data:l})=>{a===Ve&&l===e&&s.length&&s.shift()()},!1),a=>{s.push(a),Ve.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ae(Ve.postMessage)),fu=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||Ds,vu=n=>n!=null&&Ae(n[_t]),k={isArray:tt,isArrayBuffer:Rs,isBuffer:lt,isFormData:Hc,isArrayBufferView:Fc,isString:Mc,isNumber:xs,isBoolean:Dc,isObject:rt,isPlainObject:ft,isEmptyObject:Nc,isReadableStream:jc,isRequest:zc,isResponse:Wc,isHeaders:Gc,isUndefined:Qe,isDate:Uc,isFile:Lc,isBlob:Oc,isRegExp:lu,isFunction:Ae,isStream:Bc,isURLSearchParams:Vc,isTypedArray:tu,isFileList:qc,forEach:it,merge:Dt,extend:Jc,trim:Kc,stripBOM:Xc,inherits:Yc,toFlatObject:Qc,kindOf:wt,kindOfTest:Le,endsWith:Zc,toArray:eu,forEachEntry:su,matchAll:ou,isHTMLForm:nu,hasOwnProperty:ss,hasOwnProp:ss,reduceDescriptors:Ms,freezeMethods:ru,toObjectSet:iu,toCamelCase:au,noop:cu,toFiniteNumber:uu,findKey:As,global:Ve,isContextDefined:Fs,isSpecCompliantForm:du,toJSONObject:pu,isAsyncFn:mu,isThenable:hu,setImmediate:Ds,asap:fu,isIterable:vu};function ie(n,t,e,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}k.inherits(ie,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.status}}});const Ns=ie.prototype,Us={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Us[n]={value:n}});Object.defineProperties(ie,Us);Object.defineProperty(Ns,"isAxiosError",{value:!0});ie.from=(n,t,e,s,a,l)=>{const r=Object.create(Ns);k.toFlatObject(n,r,function(c){return c!==Error.prototype},i=>i!=="isAxiosError");const p=n&&n.message?n.message:"Error",b=t==null&&n?n.code:t;return ie.call(r,p,b,e,s,a),n&&r.cause==null&&Object.defineProperty(r,"cause",{value:n,configurable:!0}),r.name=n&&n.name||"Error",l&&Object.assign(r,l),r};const gu=null;function Nt(n){return k.isPlainObject(n)||k.isArray(n)}function Ls(n){return k.endsWith(n,"[]")?n.slice(0,-2):n}function os(n,t,e){return n?n.concat(t).map(function(a,l){return a=Ls(a),!e&&l?"["+a+"]":a}).join(e?".":""):t}function yu(n){return k.isArray(n)&&!n.some(Nt)}const bu=k.toFlatObject(k,{},null,function(t){return/^is[A-Z]/.test(t)});function St(n,t,e){if(!k.isObject(n))throw new TypeError("target must be an object");t=t||new FormData,e=k.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,_){return!k.isUndefined(_[w])});const s=e.metaTokens,a=e.visitor||c,l=e.dots,r=e.indexes,b=(e.Blob||typeof Blob<"u"&&Blob)&&k.isSpecCompliantForm(t);if(!k.isFunction(a))throw new TypeError("visitor must be a function");function i(m){if(m===null)return"";if(k.isDate(m))return m.toISOString();if(k.isBoolean(m))return m.toString();if(!b&&k.isBlob(m))throw new ie("Blob is not supported. Use a Buffer instead.");return k.isArrayBuffer(m)||k.isTypedArray(m)?b&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function c(m,w,_){let f=m;if(m&&!_&&typeof m=="object"){if(k.endsWith(w,"{}"))w=s?w:w.slice(0,-2),m=JSON.stringify(m);else if(k.isArray(m)&&yu(m)||(k.isFileList(m)||k.endsWith(w,"[]"))&&(f=k.toArray(m)))return w=Ls(w),f.forEach(function(j,X){!(k.isUndefined(j)||j===null)&&t.append(r===!0?os([w],X,l):r===null?w:w+"[]",i(j))}),!1}return Nt(m)?!0:(t.append(os(_,w,l),i(m)),!1)}const g=[],E=Object.assign(bu,{defaultVisitor:c,convertValue:i,isVisitable:Nt});function v(m,w){if(!k.isUndefined(m)){if(g.indexOf(m)!==-1)throw Error("Circular reference detected in "+w.join("."));g.push(m),k.forEach(m,function(f,R){(!(k.isUndefined(f)||f===null)&&a.call(t,f,k.isString(R)?R.trim():R,w,E))===!0&&v(f,w?w.concat(R):[R])}),g.pop()}}if(!k.isObject(n))throw new TypeError("data must be an object");return v(n),t}function ns(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function Vt(n,t){this._pairs=[],n&&St(n,this,t)}const Os=Vt.prototype;Os.append=function(t,e){this._pairs.push([t,e])};Os.toString=function(t){const e=t?function(s){return t.call(this,s,ns)}:ns;return this._pairs.map(function(a){return e(a[0])+"="+e(a[1])},"").join("&")};function _u(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function qs(n,t,e){if(!t)return n;const s=e&&e.encode||_u;k.isFunction(e)&&(e={serialize:e});const a=e&&e.serialize;let l;if(a?l=a(t,e):l=k.isURLSearchParams(t)?t.toString():new Vt(t,e).toString(s),l){const r=n.indexOf("#");r!==-1&&(n=n.slice(0,r)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class as{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){k.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Bs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wu=typeof URLSearchParams<"u"?URLSearchParams:Vt,$u=typeof FormData<"u"?FormData:null,Su=typeof Blob<"u"?Blob:null,Pu={isBrowser:!0,classes:{URLSearchParams:wu,FormData:$u,Blob:Su},protocols:["http","https","file","blob","url","data"]},jt=typeof window<"u"&&typeof document<"u",Ut=typeof navigator=="object"&&navigator||void 0,Tu=jt&&(!Ut||["ReactNative","NativeScript","NS"].indexOf(Ut.product)<0),Eu=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ku=jt&&window.location.href||"http://localhost",Cu=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:jt,hasStandardBrowserEnv:Tu,hasStandardBrowserWebWorkerEnv:Eu,navigator:Ut,origin:ku},Symbol.toStringTag,{value:"Module"})),Re={...Cu,...Pu};function Iu(n,t){return St(n,new Re.classes.URLSearchParams,{visitor:function(e,s,a,l){return Re.isNode&&k.isBuffer(e)?(this.append(s,e.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function Ru(n){return k.matchAll(/\w+|\[(\w*)]/g,n).map(t=>t[0]==="[]"?"":t[1]||t[0])}function xu(n){const t={},e=Object.keys(n);let s;const a=e.length;let l;for(s=0;s<a;s++)l=e[s],t[l]=n[l];return t}function Hs(n){function t(e,s,a,l){let r=e[l++];if(r==="__proto__")return!0;const p=Number.isFinite(+r),b=l>=e.length;return r=!r&&k.isArray(a)?a.length:r,b?(k.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!p):((!a[r]||!k.isObject(a[r]))&&(a[r]=[]),t(e,s,a[r],l)&&k.isArray(a[r])&&(a[r]=xu(a[r])),!p)}if(k.isFormData(n)&&k.isFunction(n.entries)){const e={};return k.forEachEntry(n,(s,a)=>{t(Ru(s),a,e,0)}),e}return null}function Au(n,t,e){if(k.isString(n))try{return(t||JSON.parse)(n),k.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(n)}const ct={transitional:Bs,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",a=s.indexOf("application/json")>-1,l=k.isObject(t);if(l&&k.isHTMLForm(t)&&(t=new FormData(t)),k.isFormData(t))return a?JSON.stringify(Hs(t)):t;if(k.isArrayBuffer(t)||k.isBuffer(t)||k.isStream(t)||k.isFile(t)||k.isBlob(t)||k.isReadableStream(t))return t;if(k.isArrayBufferView(t))return t.buffer;if(k.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let p;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Iu(t,this.formSerializer).toString();if((p=k.isFileList(t))||s.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return St(p?{"files[]":t}:t,b&&new b,this.formSerializer)}}return l||a?(e.setContentType("application/json",!1),Au(t)):t}],transformResponse:[function(t){const e=this.transitional||ct.transitional,s=e&&e.forcedJSONParsing,a=this.responseType==="json";if(k.isResponse(t)||k.isReadableStream(t))return t;if(t&&k.isString(t)&&(s&&!this.responseType||a)){const r=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(p){if(r)throw p.name==="SyntaxError"?ie.from(p,ie.ERR_BAD_RESPONSE,this,null,this.response):p}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};k.forEach(["delete","get","head","post","put","patch"],n=>{ct.headers[n]={}});const Fu=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Mu=n=>{const t={};let e,s,a;return n&&n.split(`
`).forEach(function(r){a=r.indexOf(":"),e=r.substring(0,a).trim().toLowerCase(),s=r.substring(a+1).trim(),!(!e||t[e]&&Fu[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ls=Symbol("internals");function nt(n){return n&&String(n).trim().toLowerCase()}function vt(n){return n===!1||n==null?n:k.isArray(n)?n.map(vt):String(n)}function Du(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(n);)t[s[1]]=s[2];return t}const Nu=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Ct(n,t,e,s,a){if(k.isFunction(s))return s.call(this,t,e);if(a&&(t=e),!!k.isString(t)){if(k.isString(s))return t.indexOf(s)!==-1;if(k.isRegExp(s))return s.test(t)}}function Uu(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Lu(n,t){const e=k.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+e,{value:function(a,l,r){return this[s].call(this,t,a,l,r)},configurable:!0})})}let Fe=class{constructor(t){t&&this.set(t)}set(t,e,s){const a=this;function l(p,b,i){const c=nt(b);if(!c)throw new Error("header name must be a non-empty string");const g=k.findKey(a,c);(!g||a[g]===void 0||i===!0||i===void 0&&a[g]!==!1)&&(a[g||b]=vt(p))}const r=(p,b)=>k.forEach(p,(i,c)=>l(i,c,b));if(k.isPlainObject(t)||t instanceof this.constructor)r(t,e);else if(k.isString(t)&&(t=t.trim())&&!Nu(t))r(Mu(t),e);else if(k.isObject(t)&&k.isIterable(t)){let p={},b,i;for(const c of t){if(!k.isArray(c))throw TypeError("Object iterator must return a key-value pair");p[i=c[0]]=(b=p[i])?k.isArray(b)?[...b,c[1]]:[b,c[1]]:c[1]}r(p,e)}else t!=null&&l(e,t,s);return this}get(t,e){if(t=nt(t),t){const s=k.findKey(this,t);if(s){const a=this[s];if(!e)return a;if(e===!0)return Du(a);if(k.isFunction(e))return e.call(this,a,s);if(k.isRegExp(e))return e.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=nt(t),t){const s=k.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||Ct(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let a=!1;function l(r){if(r=nt(r),r){const p=k.findKey(s,r);p&&(!e||Ct(s,s[p],p,e))&&(delete s[p],a=!0)}}return k.isArray(t)?t.forEach(l):l(t),a}clear(t){const e=Object.keys(this);let s=e.length,a=!1;for(;s--;){const l=e[s];(!t||Ct(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const e=this,s={};return k.forEach(this,(a,l)=>{const r=k.findKey(s,l);if(r){e[r]=vt(a),delete e[l];return}const p=t?Uu(l):String(l).trim();p!==l&&delete e[l],e[p]=vt(a),s[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return k.forEach(this,(s,a)=>{s!=null&&s!==!1&&(e[a]=t&&k.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(a=>s.set(a)),s}static accessor(t){const s=(this[ls]=this[ls]={accessors:{}}).accessors,a=this.prototype;function l(r){const p=nt(r);s[p]||(Lu(a,r),s[p]=!0)}return k.isArray(t)?t.forEach(l):l(t),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);k.reduceDescriptors(Fe.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[e]=s}}});k.freezeMethods(Fe);function It(n,t){const e=this||ct,s=t||e,a=Fe.from(s.headers);let l=s.data;return k.forEach(n,function(p){l=p.call(e,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function Vs(n){return!!(n&&n.__CANCEL__)}function st(n,t,e){ie.call(this,n??"canceled",ie.ERR_CANCELED,t,e),this.name="CanceledError"}k.inherits(st,ie,{__CANCEL__:!0});function js(n,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?n(e):t(new ie("Request failed with status code "+e.status,[ie.ERR_BAD_REQUEST,ie.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Ou(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}function qu(n,t){n=n||10;const e=new Array(n),s=new Array(n);let a=0,l=0,r;return t=t!==void 0?t:1e3,function(b){const i=Date.now(),c=s[l];r||(r=i),e[a]=b,s[a]=i;let g=l,E=0;for(;g!==a;)E+=e[g++],g=g%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),i-r<t)return;const v=c&&i-c;return v?Math.round(E*1e3/v):void 0}}function Bu(n,t){let e=0,s=1e3/t,a,l;const r=(i,c=Date.now())=>{e=c,a=null,l&&(clearTimeout(l),l=null),n(...i)};return[(...i)=>{const c=Date.now(),g=c-e;g>=s?r(i,c):(a=i,l||(l=setTimeout(()=>{l=null,r(a)},s-g)))},()=>a&&r(a)]}const bt=(n,t,e=3)=>{let s=0;const a=qu(50,250);return Bu(l=>{const r=l.loaded,p=l.lengthComputable?l.total:void 0,b=r-s,i=a(b),c=r<=p;s=r;const g={loaded:r,total:p,progress:p?r/p:void 0,bytes:b,rate:i||void 0,estimated:i&&p&&c?(p-r)/i:void 0,event:l,lengthComputable:p!=null,[t?"download":"upload"]:!0};n(g)},e)},rs=(n,t)=>{const e=n!=null;return[s=>t[0]({lengthComputable:e,total:n,loaded:s}),t[1]]},is=n=>(...t)=>k.asap(()=>n(...t)),Hu=Re.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Re.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,Vu=Re.hasStandardBrowserEnv?{write(n,t,e,s,a,l,r){if(typeof document>"u")return;const p=[`${n}=${encodeURIComponent(t)}`];k.isNumber(e)&&p.push(`expires=${new Date(e).toUTCString()}`),k.isString(s)&&p.push(`path=${s}`),k.isString(a)&&p.push(`domain=${a}`),l===!0&&p.push("secure"),k.isString(r)&&p.push(`SameSite=${r}`),document.cookie=p.join("; ")},read(n){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ju(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function zu(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}function zs(n,t,e){let s=!ju(t);return n&&(s||e==!1)?zu(n,t):t}const cs=n=>n instanceof Fe?{...n}:n;function ze(n,t){t=t||{};const e={};function s(i,c,g,E){return k.isPlainObject(i)&&k.isPlainObject(c)?k.merge.call({caseless:E},i,c):k.isPlainObject(c)?k.merge({},c):k.isArray(c)?c.slice():c}function a(i,c,g,E){if(k.isUndefined(c)){if(!k.isUndefined(i))return s(void 0,i,g,E)}else return s(i,c,g,E)}function l(i,c){if(!k.isUndefined(c))return s(void 0,c)}function r(i,c){if(k.isUndefined(c)){if(!k.isUndefined(i))return s(void 0,i)}else return s(void 0,c)}function p(i,c,g){if(g in t)return s(i,c);if(g in n)return s(void 0,i)}const b={url:l,method:l,data:l,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:p,headers:(i,c,g)=>a(cs(i),cs(c),g,!0)};return k.forEach(Object.keys({...n,...t}),function(c){const g=b[c]||a,E=g(n[c],t[c],c);k.isUndefined(E)&&g!==p||(e[c]=E)}),e}const Ws=n=>{const t=ze({},n);let{data:e,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:r,auth:p}=t;if(t.headers=r=Fe.from(r),t.url=qs(zs(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&r.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),k.isFormData(e)){if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if(k.isFunction(e.getHeaders)){const b=e.getHeaders(),i=["content-type","content-length"];Object.entries(b).forEach(([c,g])=>{i.includes(c.toLowerCase())&&r.set(c,g)})}}if(Re.hasStandardBrowserEnv&&(s&&k.isFunction(s)&&(s=s(t)),s||s!==!1&&Hu(t.url))){const b=a&&l&&Vu.read(l);b&&r.set(a,b)}return t},Wu=typeof XMLHttpRequest<"u",Gu=Wu&&function(n){return new Promise(function(e,s){const a=Ws(n);let l=a.data;const r=Fe.from(a.headers).normalize();let{responseType:p,onUploadProgress:b,onDownloadProgress:i}=a,c,g,E,v,m;function w(){v&&v(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function f(){if(!_)return;const j=Fe.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),P={data:!p||p==="text"||p==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:j,config:n,request:_};js(function(U){e(U),w()},function(U){s(U),w()},P),_=null}"onloadend"in _?_.onloadend=f:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(f)},_.onabort=function(){_&&(s(new ie("Request aborted",ie.ECONNABORTED,n,_)),_=null)},_.onerror=function(X){const P=X&&X.message?X.message:"Network Error",C=new ie(P,ie.ERR_NETWORK,n,_);C.event=X||null,s(C),_=null},_.ontimeout=function(){let X=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const P=a.transitional||Bs;a.timeoutErrorMessage&&(X=a.timeoutErrorMessage),s(new ie(X,P.clarifyTimeoutError?ie.ETIMEDOUT:ie.ECONNABORTED,n,_)),_=null},l===void 0&&r.setContentType(null),"setRequestHeader"in _&&k.forEach(r.toJSON(),function(X,P){_.setRequestHeader(P,X)}),k.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),p&&p!=="json"&&(_.responseType=a.responseType),i&&([E,m]=bt(i,!0),_.addEventListener("progress",E)),b&&_.upload&&([g,v]=bt(b),_.upload.addEventListener("progress",g),_.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(c=j=>{_&&(s(!j||j.type?new st(null,n,_):j),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const R=Ou(a.url);if(R&&Re.protocols.indexOf(R)===-1){s(new ie("Unsupported protocol "+R+":",ie.ERR_BAD_REQUEST,n));return}_.send(l||null)})},Ku=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let s=new AbortController,a;const l=function(i){if(!a){a=!0,p();const c=i instanceof Error?i:this.reason;s.abort(c instanceof ie?c:new st(c instanceof Error?c.message:c))}};let r=t&&setTimeout(()=>{r=null,l(new ie(`timeout ${t} of ms exceeded`,ie.ETIMEDOUT))},t);const p=()=>{n&&(r&&clearTimeout(r),r=null,n.forEach(i=>{i.unsubscribe?i.unsubscribe(l):i.removeEventListener("abort",l)}),n=null)};n.forEach(i=>i.addEventListener("abort",l));const{signal:b}=s;return b.unsubscribe=()=>k.asap(p),b}},Ju=function*(n,t){let e=n.byteLength;if(e<t){yield n;return}let s=0,a;for(;s<e;)a=s+t,yield n.slice(s,a),s=a},Xu=async function*(n,t){for await(const e of Yu(n))yield*Ju(e,t)},Yu=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const t=n.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},us=(n,t,e,s)=>{const a=Xu(n,t);let l=0,r,p=b=>{r||(r=!0,s&&s(b))};return new ReadableStream({async pull(b){try{const{done:i,value:c}=await a.next();if(i){p(),b.close();return}let g=c.byteLength;if(e){let E=l+=g;e(E)}b.enqueue(new Uint8Array(c))}catch(i){throw p(i),i}},cancel(b){return p(b),a.return()}},{highWaterMark:2})},ds=64*1024,{isFunction:mt}=k,Qu=(({Request:n,Response:t})=>({Request:n,Response:t}))(k.global),{ReadableStream:ps,TextEncoder:ms}=k.global,hs=(n,...t)=>{try{return!!n(...t)}catch{return!1}},Zu=n=>{n=k.merge.call({skipUndefined:!0},Qu,n);const{fetch:t,Request:e,Response:s}=n,a=t?mt(t):typeof fetch=="function",l=mt(e),r=mt(s);if(!a)return!1;const p=a&&mt(ps),b=a&&(typeof ms=="function"?(m=>w=>m.encode(w))(new ms):async m=>new Uint8Array(await new e(m).arrayBuffer())),i=l&&p&&hs(()=>{let m=!1;const w=new e(Re.origin,{body:new ps,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!w}),c=r&&p&&hs(()=>k.isReadableStream(new s("").body)),g={stream:c&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!g[m]&&(g[m]=(w,_)=>{let f=w&&w[m];if(f)return f.call(w);throw new ie(`Response type '${m}' is not supported`,ie.ERR_NOT_SUPPORT,_)})});const E=async m=>{if(m==null)return 0;if(k.isBlob(m))return m.size;if(k.isSpecCompliantForm(m))return(await new e(Re.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(k.isArrayBufferView(m)||k.isArrayBuffer(m))return m.byteLength;if(k.isURLSearchParams(m)&&(m=m+""),k.isString(m))return(await b(m)).byteLength},v=async(m,w)=>{const _=k.toFiniteNumber(m.getContentLength());return _??E(w)};return async m=>{let{url:w,method:_,data:f,signal:R,cancelToken:j,timeout:X,onDownloadProgress:P,onUploadProgress:C,responseType:U,headers:L,withCredentials:W="same-origin",fetchOptions:S}=Ws(m),x=t||fetch;U=U?(U+"").toLowerCase():"text";let T=Ku([R,j&&j.toAbortSignal()],X),O=null;const N=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let q;try{if(C&&i&&_!=="get"&&_!=="head"&&(q=await v(L,f))!==0){let ue=new e(w,{method:"POST",body:f,duplex:"half"}),M;if(k.isFormData(f)&&(M=ue.headers.get("content-type"))&&L.setContentType(M),ue.body){const[B,G]=rs(q,bt(is(C)));f=us(ue.body,ds,B,G)}}k.isString(W)||(W=W?"include":"omit");const ee=l&&"credentials"in e.prototype,Se={...S,signal:T,method:_.toUpperCase(),headers:L.normalize().toJSON(),body:f,duplex:"half",credentials:ee?W:void 0};O=l&&new e(w,Se);let J=await(l?x(O,S):x(w,Se));const ce=c&&(U==="stream"||U==="response");if(c&&(P||ce&&N)){const ue={};["status","statusText","headers"].forEach(Q=>{ue[Q]=J[Q]});const M=k.toFiniteNumber(J.headers.get("content-length")),[B,G]=P&&rs(M,bt(is(P),!0))||[];J=new s(us(J.body,ds,B,()=>{G&&G(),N&&N()}),ue)}U=U||"text";let ke=await g[k.findKey(g,U)||"text"](J,m);return!ce&&N&&N(),await new Promise((ue,M)=>{js(ue,M,{data:ke,headers:Fe.from(J.headers),status:J.status,statusText:J.statusText,config:m,request:O})})}catch(ee){throw N&&N(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new ie("Network Error",ie.ERR_NETWORK,m,O),{cause:ee.cause||ee}):ie.from(ee,ee&&ee.code,m,O)}}},ed=new Map,Gs=n=>{let t=n&&n.env||{};const{fetch:e,Request:s,Response:a}=t,l=[s,a,e];let r=l.length,p=r,b,i,c=ed;for(;p--;)b=l[p],i=c.get(b),i===void 0&&c.set(b,i=p?new Map:Zu(t)),c=i;return i};Gs();const zt={http:gu,xhr:Gu,fetch:{get:Gs}};k.forEach(zt,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch{}Object.defineProperty(n,"adapterName",{value:t})}});const fs=n=>`- ${n}`,td=n=>k.isFunction(n)||n===null||n===!1;function sd(n,t){n=k.isArray(n)?n:[n];const{length:e}=n;let s,a;const l={};for(let r=0;r<e;r++){s=n[r];let p;if(a=s,!td(s)&&(a=zt[(p=String(s)).toLowerCase()],a===void 0))throw new ie(`Unknown adapter '${p}'`);if(a&&(k.isFunction(a)||(a=a.get(t))))break;l[p||"#"+r]=a}if(!a){const r=Object.entries(l).map(([b,i])=>`adapter ${b} `+(i===!1?"is not supported by the environment":"is not available in the build"));let p=e?r.length>1?`since :
`+r.map(fs).join(`
`):" "+fs(r[0]):"as no adapter specified";throw new ie("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return a}const Ks={getAdapter:sd,adapters:zt};function Rt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new st(null,n)}function vs(n){return Rt(n),n.headers=Fe.from(n.headers),n.data=It.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Ks.getAdapter(n.adapter||ct.adapter,n)(n).then(function(s){return Rt(n),s.data=It.call(n,n.transformResponse,s),s.headers=Fe.from(s.headers),s},function(s){return Vs(s)||(Rt(n),s&&s.response&&(s.response.data=It.call(n,n.transformResponse,s.response),s.response.headers=Fe.from(s.response.headers))),Promise.reject(s)})}const Js="1.13.2",Pt={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{Pt[n]=function(s){return typeof s===n||"a"+(t<1?"n ":" ")+n}});const gs={};Pt.transitional=function(t,e,s){function a(l,r){return"[Axios v"+Js+"] Transitional option '"+l+"'"+r+(s?". "+s:"")}return(l,r,p)=>{if(t===!1)throw new ie(a(r," has been removed"+(e?" in "+e:"")),ie.ERR_DEPRECATED);return e&&!gs[r]&&(gs[r]=!0,console.warn(a(r," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(l,r,p):!0}};Pt.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function od(n,t,e){if(typeof n!="object")throw new ie("options must be an object",ie.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let a=s.length;for(;a-- >0;){const l=s[a],r=t[l];if(r){const p=n[l],b=p===void 0||r(p,l,n);if(b!==!0)throw new ie("option "+l+" must be "+b,ie.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ie("Unknown option "+l,ie.ERR_BAD_OPTION)}}const gt={assertOptions:od,validators:Pt},Oe=gt.validators;let je=class{constructor(t){this.defaults=t||{},this.interceptors={request:new as,response:new as}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ze(this.defaults,e);const{transitional:s,paramsSerializer:a,headers:l}=e;s!==void 0&&gt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(k.isFunction(a)?e.paramsSerializer={serialize:a}:gt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),gt.assertOptions(e,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let r=l&&k.merge(l.common,l[e.method]);l&&k.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),e.headers=Fe.concat(r,l);const p=[];let b=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(e)===!1||(b=b&&w.synchronous,p.unshift(w.fulfilled,w.rejected))});const i=[];this.interceptors.response.forEach(function(w){i.push(w.fulfilled,w.rejected)});let c,g=0,E;if(!b){const m=[vs.bind(this),void 0];for(m.unshift(...p),m.push(...i),E=m.length,c=Promise.resolve(e);g<E;)c=c.then(m[g++],m[g++]);return c}E=p.length;let v=e;for(;g<E;){const m=p[g++],w=p[g++];try{v=m(v)}catch(_){w.call(this,_);break}}try{c=vs.call(this,v)}catch(m){return Promise.reject(m)}for(g=0,E=i.length;g<E;)c=c.then(i[g++],i[g++]);return c}getUri(t){t=ze(this.defaults,t);const e=zs(t.baseURL,t.url,t.allowAbsoluteUrls);return qs(e,t.params,t.paramsSerializer)}};k.forEach(["delete","get","head","options"],function(t){je.prototype[t]=function(e,s){return this.request(ze(s||{},{method:t,url:e,data:(s||{}).data}))}});k.forEach(["post","put","patch"],function(t){function e(s){return function(l,r,p){return this.request(ze(p||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:r}))}}je.prototype[t]=e(),je.prototype[t+"Form"]=e(!0)});let nd=class Xs{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(l){e=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const r=new Promise(p=>{s.subscribe(p),l=p}).then(a);return r.cancel=function(){s.unsubscribe(l)},r},t(function(l,r,p){s.reason||(s.reason=new st(l,r,p),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Xs(function(a){t=a}),cancel:t}}};function ad(n){return function(e){return n.apply(null,e)}}function ld(n){return k.isObject(n)&&n.isAxiosError===!0}const Lt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Lt).forEach(([n,t])=>{Lt[t]=n});function Ys(n){const t=new je(n),e=Cs(je.prototype.request,t);return k.extend(e,je.prototype,t,{allOwnKeys:!0}),k.extend(e,t,null,{allOwnKeys:!0}),e.create=function(a){return Ys(ze(n,a))},e}const Pe=Ys(ct);Pe.Axios=je;Pe.CanceledError=st;Pe.CancelToken=nd;Pe.isCancel=Vs;Pe.VERSION=Js;Pe.toFormData=St;Pe.AxiosError=ie;Pe.Cancel=Pe.CanceledError;Pe.all=function(t){return Promise.all(t)};Pe.spread=ad;Pe.isAxiosError=ld;Pe.mergeConfig=ze;Pe.AxiosHeaders=Fe;Pe.formToJSON=n=>Hs(k.isHTMLForm(n)?new FormData(n):n);Pe.getAdapter=Ks.getAdapter;Pe.HttpStatusCode=Lt;Pe.default=Pe;const{Axios:Lf,AxiosError:Of,CanceledError:qf,isCancel:Bf,CancelToken:Hf,VERSION:Vf,all:jf,Cancel:zf,isAxiosError:Wf,spread:Gf,toFormData:Kf,AxiosHeaders:Jf,HttpStatusCode:Xf,formToJSON:Yf,getAdapter:Qf,mergeConfig:Zf}=Pe;class rd{static async getAvailableModels(){try{return(await Pe({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(t){return console.error("Failed to fetch available models:",t),{options:[],total:0}}}}const id={class:"assigned-tools"},cd={class:"section-header"},ud=["title"],dd={class:"tool-info"},pd={class:"tool-name"},md=["title"],hd={key:0,class:"no-tools"},fd=Te({__name:"AssignedTools",props:{title:{},selectedToolIds:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=ae(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()});const r=ae(()=>Array.isArray(e.selectedToolIds)?e.selectedToolIds.filter(i=>l.value.some(c=>c.key===i)):[]);ye(r,i=>{if(!Array.isArray(e.selectedToolIds))return;const c=e.selectedToolIds.length;i.length!==c&&s("tools-filtered",i)},{immediate:!0});const p=i=>{const c=l.value.find(E=>E.key===i);return c?`${c.serviceGroup||"Ungrouped"}.${c.name}`:i},b=i=>{const c=l.value.find(g=>g.key===i);return c?c.description:""};return(i,c)=>(h(),y("div",id,[o("div",cd,[o("span",null,u(i.title)+" ("+u(r.value.length)+")",1),i.showAddButton?(h(),y("button",{key:0,class:"action-btn small",onClick:c[0]||(c[0]=g=>i.$emit("add-tools"))},[A(d(D),{icon:"carbon:add"}),me(" "+u(i.addButtonText),1)])):H("",!0)]),o("div",{class:ve(["tools-grid",{"grid-layout":i.useGridLayout,"has-more-items":i.useGridLayout&&r.value.length>2}])},[(h(!0),y(he,null,ge(r.value,g=>(h(),y("div",{key:g,class:"tool-item assigned",title:b(g)},[o("div",dd,[o("span",pd,u(p(g)),1),o("span",{class:"tool-desc",title:b(g)},u(b(g)),9,md)])],8,ud))),128)),r.value.length===0?(h(),y("div",hd,[A(d(D),{icon:"carbon:tool-box"}),o("span",null,u(i.emptyText),1)])):H("",!0)],2)]))}}),vd=Ee(fd,[["__scopeId","data-v-62354a05"]]),gd={class:"tool-selection-content"},yd={class:"tool-controls"},bd={class:"search-container"},_d=["placeholder"],wd={class:"sort-container"},$d={value:"group"},Sd={value:"name"},Pd={value:"enabled"},Td={class:"tool-summary"},Ed={class:"summary-text"},kd={key:0,class:"tool-groups"},Cd=["onClick"],Id={class:"group-title-area"},Rd={class:"group-name"},xd={class:"group-count"},Ad={class:"group-enable-all"},Fd=["checked","onChange","data-group"],Md={class:"enable-label"},Dd={class:"tool-info"},Nd={class:"tool-selection-name"},Ud={key:0,class:"tool-selection-desc"},Ld={class:"tool-actions"},Od=["checked","onChange"],qd={key:1,class:"empty-state"},Bd=Te({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:t}){const e=n,s=t,a=at(),l=ae(()=>a.availableTools.value);Me(()=>{l.value.length===0&&!a.isLoading.value&&a.loadAvailableTools()}),ye(()=>e.modelValue,S=>{S&&!a.isLoading.value&&a.loadAvailableTools()});const r=ae({get:()=>e.modelValue,set:S=>s("update:modelValue",S)}),p=F(""),b=F("group"),i=F(new Set),c=F([]),g=F(null),E=(S,x)=>{const T=document.querySelector(`input[data-group="${S}"]`);T&&(T.indeterminate=P(x))};ye(()=>e.selectedToolIds,S=>{c.value=[...S]},{immediate:!0});const v=ae(()=>{let S=l.value.filter(x=>x.key);if(S=S.filter(x=>x.selectable===!0),p.value){const x=p.value.toLowerCase();S=S.filter(T=>T.name.toLowerCase().includes(x)||T.description.toLowerCase().includes(x)||T.serviceGroup.toLowerCase().includes(x))}switch(b.value){case"name":S=[...S].sort((x,T)=>x.name.localeCompare(T.name));break;case"enabled":S=[...S].sort((x,T)=>{const O=c.value.includes(x.key),N=c.value.includes(T.key);return O&&!N?-1:!O&&N?1:x.name.localeCompare(T.name)});break;case"group":default:S=[...S].sort((x,T)=>{const O=x.serviceGroup||"Ungrouped",N=T.serviceGroup||"Ungrouped";return O!==N?O.localeCompare(N):x.name.localeCompare(T.name)});break}return S}),m=ae(()=>{const S=new Map;return l.value.filter(T=>T.key&&T.selectable===!0).forEach(T=>{const O=T.serviceGroup||"Ungrouped";S.has(O)||S.set(O,[]),S.get(O).push(T)}),S}),w=ae(()=>{const S=new Map;return v.value.forEach(x=>{const T=x.serviceGroup||"Ungrouped";S.has(T)||S.set(T,[]),S.get(T).push(x)}),new Map([...S.entries()].sort())}),_=ae(()=>v.value.length);ye([c,w],()=>{xe(()=>{for(const[S,x]of w.value)E(S,x)})},{flush:"post",deep:!1});const f=S=>c.value.includes(S),R=(S,x)=>{x.stopPropagation();const O=x.target.checked;if(!S){console.error("toolKey is undefined, cannot proceed");return}O?c.value.includes(S)||(c.value=[...c.value,S]):c.value=c.value.filter(N=>N!==S)},j=S=>S.filter(x=>c.value.includes(x.key)),X=S=>S.length>0&&S.every(x=>c.value.includes(x.key)),P=S=>{const x=j(S).length;return x>0&&x<S.length},C=(S,x)=>{x.stopPropagation();const O=x.target.checked,N=S.map(q=>q.key);if(O){const q=[...c.value];N.forEach(ee=>{q.includes(ee)||q.push(ee)}),c.value=q}else c.value=c.value.filter(q=>!N.includes(q))},U=S=>{i.value.has(S)?i.value.delete(S):i.value.add(S)},L=()=>{s("confirm",[...c.value]),s("update:modelValue",!1)},W=()=>{c.value=[...e.selectedToolIds],s("update:modelValue",!1)};return ye(p,S=>{const x=S.trim().toLowerCase();if(x){g.value===null&&(g.value=new Set(i.value));for(const[T,O]of m.value)O.some(q=>q.name.toLowerCase().includes(x)||q.description&&q.description.toLowerCase().includes(x)||q.serviceGroup&&q.serviceGroup.toLowerCase().includes(x))&&i.value.delete(T)}else g.value!==null&&(i.value=new Set(g.value),g.value=null)}),ye(r,S=>{if(S){i.value.clear(),g.value=null;const x=Array.from(w.value.keys());x.length>1&&x.slice(1).forEach(T=>{i.value.add(T)})}}),(S,x)=>(h(),$e($s,{modelValue:r.value,"onUpdate:modelValue":[x[4]||(x[4]=T=>r.value=T),W],title:S.$t("toolSelection.title"),onConfirm:L},{default:Ye(()=>[o("div",gd,[o("div",yd,[o("div",bd,[_e(o("input",{"onUpdate:modelValue":x[0]||(x[0]=T=>p.value=T),type:"text",class:"search-input",placeholder:S.$t("toolSelection.searchPlaceholder")},null,8,_d),[[Ce,p.value]])]),o("div",wd,[_e(o("select",{"onUpdate:modelValue":x[1]||(x[1]=T=>b.value=T),class:"sort-select"},[o("option",$d,u(S.$t("toolSelection.sortByGroup")),1),o("option",Sd,u(S.$t("toolSelection.sortByName")),1),o("option",Pd,u(S.$t("toolSelection.sortByStatus")),1)],512),[[Ot,b.value]])])]),o("div",Td,[o("span",Ed,u(S.$t("toolSelection.summary",{groups:w.value.size,tools:_.value,selected:c.value.length})),1)]),w.value.size>0?(h(),y("div",kd,[(h(!0),y(he,null,ge(w.value,([T,O])=>(h(),y("div",{key:T,class:"tool-group"},[o("div",{class:ve(["tool-group-header",{collapsed:i.value.has(T)}]),onClick:N=>U(T)},[o("div",Id,[A(d(D),{icon:i.value.has(T)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),A(d(D),{icon:"carbon:folder",class:"group-icon"}),o("span",Rd,u(T),1),o("span",xd," ("+u(j(O).length)+"/"+u(O.length)+") ",1)]),o("div",{class:"group-actions",onClick:x[2]||(x[2]=we(()=>{},["stop"]))},[o("label",Ad,[o("input",{type:"checkbox",class:"group-enable-checkbox",checked:X(O),onChange:N=>C(O,N),"data-group":T},null,40,Fd),o("span",Md,u(S.$t("toolSelection.enableAll")),1)])])],10,Cd),o("div",{class:ve(["tool-group-content",{collapsed:i.value.has(T)}])},[(h(!0),y(he,null,ge(O,N=>(h(),y("div",{key:N.key,class:"tool-selection-item"},[o("div",Dd,[o("div",Nd,u(N.name),1),N.description?(h(),y("div",Ud,u(N.description),1)):H("",!0)]),o("div",Ld,[o("label",{class:"tool-enable-switch",onClick:x[3]||(x[3]=we(()=>{},["stop"]))},[o("input",{type:"checkbox",class:"tool-enable-checkbox",checked:f(N.key),onChange:q=>R(N.key,q)},null,40,Od),x[5]||(x[5]=o("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),y("div",qd,[A(d(D),{icon:"carbon:tools",class:"empty-icon"}),o("p",null,u(S.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Hd=Ee(Bd,[["__scopeId","data-v-627b463f"]]),Vd={class:"config-section"},jd={class:"section-header"},zd={class:"visual-editor"},Wd={class:"plan-basic-info"},Gd={class:"form-row"},Kd={class:"form-label"},Jd=["placeholder"],Xd={key:0,class:"field-error-message"},Yd={class:"form-row"},Qd={class:"form-label"},Zd={class:"service-group-autocomplete"},ep=["placeholder"],tp={key:0,class:"service-group-dropdown"},sp=["onMousedown"],op={class:"field-description"},np={class:"steps-section"},ap={class:"steps-container"},lp={class:"step-content"},rp={class:"form-row"},ip={class:"form-label"},cp=["value","onInput","placeholder"],up={class:"form-row"},dp={class:"form-label"},pp=["value","onInput","placeholder"],mp={key:0,class:"preview-section"},hp={class:"preview-label"},fp={class:"preview-content"},vp={class:"preview-text"},gp={class:"preview-table-header"},yp={class:"form-row"},bp={class:"form-label"},_p={class:"model-selector-wrapper"},wp={class:"model-input-wrapper"},$p=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Sp={key:0,class:"dropdown-item disabled"},Pp={key:1,class:"dropdown-item disabled error"},Tp={key:2,class:"dropdown-item disabled"},Ep=["onClick","onMouseenter"],kp=["onClick","onMouseenter"],Cp=["title"],Ip={key:0,class:"error-message"},Rp={class:"form-row"},xp={key:0,class:"empty-steps"},Ap={class:"empty-text"},Fp={key:0,class:"json-preview"},Mp={class:"preview-header"},Dp={class:"form-label"},Np={class:"json-code"},Up={class:"editor-footer"},Lp={class:"section-actions"},Op=["disabled","title"],qp=["disabled","title"],Bp=["disabled","title"],Hp=["disabled"],Vp={class:"modal-header"},jp={class:"modal-body"},zp={class:"form-row"},Wp={class:"form-label"},Gp=["placeholder"],Kp={class:"modal-footer"},Jp=["disabled"],Xp=Te({__name:"JsonEditorV2",props:{isGenerating:{type:Boolean,default:!1},isExecuting:{type:Boolean,default:!1}},setup(n,{expose:t}){const{t:e}=De(),s=Bt(),a=We(),l=He({title:"",steps:[]}),r=F(!1),p=F(!1),b=F([]),i=F(!1),c=F(""),g=ae(()=>a.generateJsonString()),E=F(!1);let v=null;const m=()=>{a.isUserUpdating.value=!0,v&&clearTimeout(v),v=setTimeout(()=>{a.isUserUpdating.value=!1,v=null},500)},w=()=>{if(a.isUserUpdating.value){console.log("[JsonEditorV2] syncDisplayDataFromConfig skipped: isUserUpdating is true");return}console.log("[JsonEditorV2] syncDisplayDataFromConfig called"),E.value=!0;try{const $=a.getConfig();console.log("[JsonEditorV2] Syncing displayData with config:",{title:$.title,stepsCount:$.steps?.length||0,serviceGroup:$.serviceGroup}),($.title?.trim()||!l.title?.trim())&&(l.title=$.title||""),l.steps=($.steps||[]).map(K=>({...K})),c.value=$.serviceGroup||"",console.log("[JsonEditorV2] displayData synced:",{title:l.title,stepsCount:l.steps.length,serviceGroup:c.value})}finally{setTimeout(()=>{E.value=!1},0)}},_=()=>{E.value=!0;try{a.setTitle(l.title),a.setSteps(l.steps),a.currentPlanTemplateId.value&&(de.hasTaskRequirementModified=!0)}finally{setTimeout(()=>{E.value=!1},0)}},f=()=>{r.value=!r.value},R=()=>{r.value=!1},j=()=>{try{v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,a.rollbackVersion()}catch($){console.error("Error during rollback operation:",$),s.error(e("sidebar.rollbackFailed")||"Rollback failed")}},X=()=>{try{v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,a.restoreVersion()}catch($){console.error("Error during restore operation:",$),s.error(e("sidebar.restoreFailed")||"Restore failed")}},P=async()=>{try{if(!a.selectedTemplate.value){s.error(e("sidebar.selectPlanFirst"));return}v&&(clearTimeout(v),v=null),a.isUserUpdating.value=!1,_();const $=a.validate();if(!$.isValid){s.error(`Invalid format, please correct and save.
Errors: `+$.errors.join(", "));return}if(!a.selectedTemplate.value.planTemplateId){s.error("Plan template ID is required");return}if(!await a.save()){s.error("Failed to save plan template");return}const re=a.generateJsonString().trim();a.updateVersionsAfterSave(re);const fe=a.planVersions.value.length;de.hasTaskRequirementModified=!1,await de.loadPlanTemplateList(),s.success(e("sidebar.saveSuccess",{message:"Plan saved successfully",versionCount:fe}))}catch($){console.error("Failed to save plan modifications:",$);const K=$ instanceof Error?$.message:e("sidebar.saveFailed");throw s.error(K),$}},C=F(""),U=($,K)=>{m();const Y=l.steps[K];Y&&(Y.stepRequirement=$.target.value),Xt($)},L=($,K)=>{m();const Y=l.steps[K];Y&&(Y.terminateColumns=$.target.value),Xt($)},W=()=>{const $={stepRequirement:"",agentName:"",modelName:"",terminateColumns:"",selectedToolKeys:[]};l.steps.push($),a.setSteps(l.steps),console.log("[JsonEditorV2] Added new step, total steps:",l.steps.length)},S=F([]),x=F(!1),T=F(""),O=F(new Map),N=F(new Set),q=F(new Map),ee=$=>O.value.get($)??"",Se=($,K)=>{O.value.set($,K)},J=$=>{const K=ee($);if(!K.trim())return S.value;const Y=K.toLowerCase().trim();return S.value.filter(re=>re.value.toLowerCase().includes(Y)||re.label.toLowerCase().includes(Y))},ce=$=>{const K=l.steps[$],Y=ee($);return N.value.has($)&&Y!==""?Y:K.modelName??""},ke=$=>x.value||T.value||l.steps[$].modelName?"":e("sidebar.modelNameDescription")||"",ue=$=>N.value.has($),M=$=>{x.value||N.value.add($)},B=$=>{N.value.delete($),q.value.set($,-1);const K=l.steps[$];Se($,K.modelName??"")},G=$=>{ue($)?B($):M($)},Q=($,K)=>{m();const Y=l.steps[K];Y.modelName=$,Se(K,$),B(K)},se=($,K)=>{m();const Y=$.target;Se(K,Y.value),M(K)},le=$=>q.value.get($)??-1,pe=($,K)=>{q.value.set($,K)},te=$=>{const K=le($),Y=J($);K>=0&&K<Y.length?Q(Y[K].value,$):K===-1?Q("",$):Y.length>0?Q(Y[0].value,$):l.steps[$].modelName||Q("",$)},V=$=>{if(!ue($)){M($),pe($,0);return}const Y=J($).length+1,re=le($),fe=Math.min(re+1,Y-1);pe($,fe)},I=$=>{if(!ue($)){M($);const re=J($);pe($,re.length);return}const K=le($),Y=Math.max(K-1,-1);pe($,Y)},z=$=>{$.target.closest(".model-selector")||N.value.clear()};ye(()=>l.steps,$=>{$.forEach((K,Y)=>{O.value.has(Y)||Se(Y,K.modelName??"")})},{deep:!0,immediate:!0});const Z=F(!1),ne=F(-1),oe=async()=>{if(!x.value){x.value=!0,T.value="";try{const $=await rd.getAvailableModels();S.value=$.options}catch($){console.error("Failed to load models:",$),T.value=$ instanceof Error?$.message:"Failed to load models",S.value=[]}finally{x.value=!1}}},be=$=>{ne.value=$,Z.value=!0},Ge=$=>{m(),ne.value>=0&&ne.value<l.steps.length&&(l.steps[ne.value].selectedToolKeys=[...$]),Z.value=!1,ne.value=-1},Zs=($,K)=>{m(),$>=0&&$<l.steps.length&&(l.steps[$].selectedToolKeys=[...K])},ut=F(!1),qe=F(""),Be=F(!1),eo=()=>{if(console.log("[JsonEditorV2] Copy plan clicked"),!a.selectedTemplate.value){console.log("[JsonEditorV2] No template selected, cannot copy"),s.error(e("sidebar.selectPlanFirst"));return}qe.value=(a.selectedTemplate.value.title??e("sidebar.unnamedPlan"))+" (copy)",console.log("[JsonEditorV2] Opening copy plan modal"),ut.value=!0},dt=()=>{ut.value=!1,qe.value="",Be.value=!1},to=$=>{$.target===$.currentTarget&&dt()},Gt=async()=>{if(!qe.value.trim()){s.error(e("sidebar.titleRequired"));return}if(!a.selectedTemplate.value){s.error(e("sidebar.noPlanToCopy"));return}Be.value=!0;try{const $=a.getConfig(),K=`planTemplate-${Date.now()}`,{toolConfig:Y,...re}=$,fe={...re,title:qe.value.trim(),planTemplateId:K};console.log("[JsonEditorV2] Copying plan without toolConfig:",fe),(await Qt.createOrUpdatePlanTemplateWithTool(fe)).success?(s.success(e("sidebar.copyPlanSuccess",{title:qe.value.trim()})),await de.loadPlanTemplateList(),dt()):s.error(e("sidebar.copyPlanFailed",{message:"Failed to copy plan"}))}catch($){if(console.error("[JsonEditorV2] Error copying plan:",$),$ instanceof Error&&$.errorCode==="DUPLICATE_TITLE")s.error(e("sidebar.duplicatePlanTitle"));else{const K=$ instanceof Error?$.message:"Unknown error";s.error(e("sidebar.copyPlanFailed",{message:K}))}}finally{Be.value=!1}};ye(()=>l.title,$=>{$?.trim()?C.value="":C.value="Title is required field"},{immediate:!0});const Kt=()=>{const $=a.getServiceGroup()||"";c.value=$};ye(()=>a.config,()=>{a.needsFullRefresh.value&&!E.value&&!a.isUserUpdating.value&&w()},{deep:!0,immediate:!0}),ye(()=>a.currentPlanTemplateId.value,($,K)=>{console.log("[JsonEditorV2] currentPlanTemplateId changed:",{oldId:K,newId:$}),K!=null&&$!==K&&(O.value.clear(),N.value.clear(),q.value.clear(),Z.value=!1,ut.value=!1,r.value=!1,ne.value=-1,qe.value="",Be.value=!1),console.log("[JsonEditorV2] Calling syncDisplayDataFromConfig from currentPlanTemplateId watch"),w(),Kt()},{immediate:!0}),ye(()=>c.value,$=>{E.value=!0;try{a.setServiceGroup($)}finally{setTimeout(()=>{E.value=!1},0)}});const so=async()=>{if(!i.value){i.value=!0;try{const $=new Set;try{(await ks.getAvailableTools()).forEach(Y=>{Y.serviceGroup&&$.add(Y.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from tools:",K)}try{(await Qt.getAllPlanTemplateConfigVOs()).forEach(Y=>{Y.serviceGroup&&$.add(Y.serviceGroup)})}catch(K){console.error("[JsonEditorV2] Failed to load service groups from plan templates:",K)}b.value=Array.from($).sort()}catch($){console.error("[JsonEditorV2] Failed to load service groups:",$),b.value=[]}finally{i.value=!1}}},Jt=ae(()=>{const $=c.value.trim();if(!$)return b.value;const K=$.toLowerCase();return b.value.filter(Y=>Y.toLowerCase().includes(K))}),oo=()=>{m()},no=()=>{p.value=!0},ao=()=>{m(),no()},lo=()=>{setTimeout(()=>{p.value=!1},200)},ro=$=>{c.value=$,p.value=!1};Me(()=>{w(),Kt(),so(),oe(),document.addEventListener("click",z)}),Ue(()=>{document.removeEventListener("click",z),v&&(clearTimeout(v),v=null)}),t({save:P});const Xt=$=>{const K=$.target;K.style.height="auto";const Y=20,re=Math.ceil(K.scrollHeight/Y),fe=4,Ke=12,pt=Math.max(fe,Math.min(Ke,re)),co=pt*Y;K.style.height=`${co}px`,K.rows=pt,re>Ke?K.style.overflowY="auto":K.style.overflowY="hidden"},io=$=>{if(!$.trim())return"";const K=$.split(",").map(Y=>Y.trim()).filter(Y=>Y.length>0);return K.length===0?"":`|${K.join("|")}|`};return($,K)=>(h(),y("div",Vd,[o("div",jd,[A(d(D),{icon:"carbon:code",width:"16"}),o("span",null,u($.$t("sidebar.dynamicAgentPlan")),1)]),o("div",zd,[o("div",Wd,[o("div",Gd,[o("label",Kd,u($.$t("sidebar.title")),1),_e(o("input",{"onUpdate:modelValue":K[0]||(K[0]=Y=>l.title=Y),type:"text",class:ve(["form-input",{error:C.value}]),placeholder:$.$t("sidebar.titlePlaceholder"),onInput:oo},null,42,Jd),[[Ce,l.title]]),C.value?(h(),y("div",Xd,[A(d(D),{icon:"carbon:warning",width:"12"}),me(" "+u(C.value),1)])):H("",!0)]),o("div",Yd,[o("label",Qd,u($.$t("mcpService.serviceGroup")),1),o("div",Zd,[_e(o("input",{type:"text","onUpdate:modelValue":K[1]||(K[1]=Y=>c.value=Y),onInput:ao,onFocus:K[2]||(K[2]=Y=>p.value=!0),onBlur:lo,placeholder:$.$t("mcpService.serviceGroupPlaceholder"),class:"form-input"},null,40,ep),[[Ce,c.value]]),p.value&&Jt.value.length>0?(h(),y("div",tp,[(h(!0),y(he,null,ge(Jt.value,Y=>(h(),y("div",{key:Y,class:"service-group-option",onMousedown:re=>ro(Y)},u(Y),41,sp))),128))])):H("",!0)]),o("div",op,u($.$t("mcpService.serviceGroupDescription")),1)])]),o("div",np,[o("div",ap,[(h(!0),y(he,null,ge(l.steps,(Y,re)=>(h(),y("div",{key:re,class:"step-item"},[o("div",lp,[o("div",rp,[o("label",ip,u($.$t("sidebar.stepRequirement")),1),o("textarea",{value:Y.stepRequirement||"",onInput:fe=>U(fe,re),class:"form-textarea auto-resize",placeholder:$.$t("sidebar.stepRequirementPlaceholder"),rows:"8"},null,40,cp)]),o("div",up,[o("label",dp,u($.$t("sidebar.terminateColumns")),1),o("textarea",{value:Y.terminateColumns||"",onInput:fe=>L(fe,re),class:"form-textarea auto-resize",placeholder:$.$t("sidebar.terminateColumnsPlaceholder"),rows:"1"},null,40,pp),Y.terminateColumns&&Y.terminateColumns.trim()?(h(),y("div",mp,[o("div",hp,u($.$t("sidebar.preview"))+":",1),o("div",fp,[o("div",vp,[me(u($.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),o("span",gp,u(io(Y.terminateColumns)),1)])])])):H("",!0)]),o("div",yp,[o("label",bp,u($.$t("sidebar.modelName")),1),o("div",_p,[o("div",{class:ve(["model-selector",{"is-open":ue(re),"is-disabled":x.value}])},[o("div",wp,[o("input",{value:ce(re),type:"text",class:"form-input model-search-input",placeholder:ke(re),disabled:x.value,onClick:we(fe=>M(re),["stop"]),onFocus:fe=>M(re),onInput:fe=>se(fe,re),onKeydown:[ot(fe=>B(re),["escape"]),ot(we(fe=>te(re),["prevent"]),["enter"]),ot(we(fe=>V(re),["prevent"]),["down"]),ot(we(fe=>I(re),["prevent"]),["up"])]},null,40,$p),A(d(D),{icon:"carbon:chevron-down",width:"14",class:ve(["dropdown-arrow",{"is-open":ue(re)}]),onClick:we(fe=>G(re),["stop"])},null,8,["class","onClick"])]),ue(re)?(h(),y("div",{key:0,class:"model-dropdown",onClick:K[3]||(K[3]=we(()=>{},["stop"]))},[x.value?(h(),y("div",Sp,u($.$t("sidebar.loading")),1)):T.value?(h(),y("div",Pp,u($.$t("sidebar.modelLoadError")),1)):J(re).length===0?(h(),y("div",Tp,u($.$t("sidebar.noModelsFound")),1)):H("",!0),(h(!0),y(he,null,ge(J(re),(fe,Ke)=>(h(),y("div",{key:fe.value,class:ve(["dropdown-item",{"is-selected":Y.modelName===fe.value,"is-highlighted":le(re)===Ke}]),onClick:pt=>Q(fe.value,re),onMouseenter:pt=>pe(re,Ke)},[me(u(fe.value)+" ",1),Y.modelName===fe.value?(h(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):H("",!0)],42,Ep))),128)),o("div",{class:ve(["dropdown-item",{"is-selected":!Y.modelName,"is-highlighted":le(re)===-1}]),onClick:fe=>Q("",re),onMouseenter:fe=>pe(re,-1)},[me(u($.$t("sidebar.noModelSelected"))+" ",1),Y.modelName?H("",!0):(h(),$e(d(D),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,kp)])):H("",!0)],2),T.value?(h(),y("button",{key:0,onClick:oe,class:"btn btn-sm btn-danger",title:$.$t("sidebar.retryLoadModels")},[A(d(D),{icon:"carbon:warning",width:"14"}),me(" "+u($.$t("sidebar.retry")),1)],8,Cp)):H("",!0)]),T.value?(h(),y("div",Ip,[A(d(D),{icon:"carbon:warning",width:"12"}),me(" "+u(T.value),1)])):H("",!0)]),o("div",Rp,[A(vd,{title:$.$t("sidebar.selectedTools"),"selected-tool-ids":Y.selectedToolKeys||[],"add-button-text":$.$t("sidebar.addRemoveTools"),"empty-text":$.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:fe=>be(re),onToolsFiltered:fe=>Zs(re,fe)},null,8,["title","selected-tool-ids","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l.steps.length===0?(h(),y("div",xp,[A(d(D),{icon:"carbon:add-alt",width:"48",class:"empty-icon"}),o("p",Ap,u($.$t("sidebar.noSteps")),1),o("button",{class:"btn btn-primary btn-add-step",onClick:W},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u($.$t("sidebar.addFirstStep")),1)])])):H("",!0)])]),r.value?(h(),y("div",Fp,[o("div",Mp,[o("label",Dp,u($.$t("sidebar.jsonPreview")),1),o("button",{onClick:R,class:"btn btn-xs"},[A(d(D),{icon:"carbon:close",width:"12"})])]),o("pre",Np,u(g.value),1)])):H("",!0),o("div",Up,[o("button",{onClick:f,class:"btn btn-sm btn-secondary"},[A(d(D),{icon:"carbon:code",width:"14"}),me(" "+u(r.value?$.$t("sidebar.hideJson"):$.$t("sidebar.showJson")),1)]),o("div",Lp,[o("button",{class:"btn btn-sm",onClick:eo,disabled:$.isGenerating||$.isExecuting,title:$.$t("sidebar.copyPlan")},[A(d(D),{icon:"carbon:copy",width:"14"}),me(" "+u($.$t("sidebar.copyPlan")),1)],8,Op),o("button",{class:"btn btn-sm",onClick:j,disabled:!d(a).canRollback.value,title:$.$t("sidebar.rollback")},[A(d(D),{icon:"carbon:undo",width:"14"})],8,qp),o("button",{class:"btn btn-sm",onClick:X,disabled:!d(a).canRestore.value,title:$.$t("sidebar.restore")},[A(d(D),{icon:"carbon:redo",width:"14"})],8,Bp),o("button",{class:"btn btn-primary",onClick:P,disabled:$.isGenerating||$.isExecuting},[A(d(D),{icon:"carbon:save",width:"14"}),K[7]||(K[7]=me(" Save "))],8,Hp)])])]),A(Hd,{modelValue:Z.value,"onUpdate:modelValue":K[4]||(K[4]=Y=>Z.value=Y),"selected-tool-ids":ne.value>=0?l.steps[ne.value]?.selectedToolKeys||[]:[],onConfirm:Ge},null,8,["modelValue","selected-tool-ids"]),ut.value?(h(),y("div",{key:0,class:"modal-overlay",onMousedown:to},[o("div",{class:"modal-content",onMousedown:K[6]||(K[6]=we(()=>{},["stop"]))},[o("div",Vp,[o("h3",null,u($.$t("sidebar.copyPlan")),1),o("button",{class:"close-btn",onClick:dt},[A(d(D),{icon:"carbon:close",width:"16"})])]),o("div",jp,[o("div",zp,[o("label",Wp,u($.$t("sidebar.newPlanTitle")),1),_e(o("input",{"onUpdate:modelValue":K[5]||(K[5]=Y=>qe.value=Y),type:"text",class:"form-input",placeholder:$.$t("sidebar.enterNewPlanTitle"),onKeyup:ot(Gt,["enter"])},null,40,Gp),[[Ce,qe.value]])])]),o("div",Kp,[o("button",{class:"btn btn-secondary",onClick:dt},u($.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:Gt,disabled:!qe.value.trim()||Be.value},[Be.value?(h(),$e(d(D),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):H("",!0),me(" "+u(Be.value?$.$t("sidebar.copying"):$.$t("sidebar.copyPlan")),1)],8,Jp)])],32)],32)):H("",!0)]))}}),Yp=Ee(Xp,[["__scopeId","data-v-91127bd0"]]),Qp="/api/executor";async function Qs(n){try{const t=await fetch(`${Qp}/agent-execution/${n}`);if(!t.ok){if(t.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,t),null}}async function Zp(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Qs(n)}function em(){const n=et(),t=Ze(),e=F(null),s=F(null),a=F("config"),l=ae(()=>n.activeRootPlanId.value),r=f=>{if(!f)return null;for(const[R,j]of t.planExecutionRecords.entries())if((j.rootPlanId||j.currentPlanId)&&j.agentExecutionSequence)for(const P of j.agentExecutionSequence){if(P.stepId===f){const C=j.rootPlanId||j.currentPlanId;return console.log("[useRightPanel] Found rootPlanId for stepId:",{stepId:f,rootPlanId:C,planId:R}),C||null}if(P.subPlanExecutionRecords)for(const C of P.subPlanExecutionRecords){const U=p(C,f);if(U)return U}}return console.warn("[useRightPanel] Could not find rootPlanId for stepId:",f),null},p=(f,R)=>{if(!f||!f.agentExecutionSequence)return null;for(const j of f.agentExecutionSequence){if(j.stepId===R)return f.rootPlanId||f.currentPlanId||null;if(j.subPlanExecutionRecords)for(const X of j.subPlanExecutionRecords){const P=p(X,R);if(P)return P}}return null},b=ae(()=>s.value||l.value),i=ae(()=>!b.value),c=async f=>{if(console.log("[useRightPanel] Step selected:",{stepId:f}),!f){console.warn("[useRightPanel] No stepId provided"),e.value=null,s.value=null;return}E("details"),console.log("[useRightPanel] Switched to details tab");try{const R=r(f);R?(s.value=R,console.log("[useRightPanel] Set selectedRootPlanId to:",R)):(s.value=null,console.warn("[useRightPanel] Could not find rootPlanId for step, will use currentRootPlanId"));const j=await Qs(f);if(!j){console.warn("[useRightPanel] Agent execution detail not found for stepId:",f),e.value=null,s.value=null;return}const X={stepId:f,title:j.agentName??`Step ${f}`,description:j.agentDescription??"",agentExecution:j,completed:j.status==="FINISHED",current:j.status==="RUNNING"};e.value=X,console.log("[useRightPanel] Step details updated:",X),await xe(),console.log("[useRightPanel] After nextTick - selectedStep:",e.value)}catch(R){console.error("[useRightPanel] Error fetching step details:",R),e.value=null,s.value=null}},g=async()=>{if(!e.value?.stepId){console.warn("[useRightPanel] No step selected for refresh");return}console.log("[useRightPanel] Refreshing current step:",e.value.stepId);try{const f=await Zp(e.value.stepId);f&&(e.value.agentExecution=f,e.value.completed=f.status==="FINISHED",e.value.current=f.status==="RUNNING",console.log("[useRightPanel] Step refreshed successfully"))}catch(f){console.error("[useRightPanel] Error refreshing step:",f)}},E=f=>{a.value=f,console.log("[useRightPanel] Active tab set to:",f)},v=f=>{console.log("[useRightPanel] updateDisplayedPlanProgress called with rootPlanId:",f)},m=()=>{e.value=null,s.value=null,console.log("[useRightPanel] Selected step cleared")},w=f=>{if(f===null||typeof f>"u"||f==="")return"N/A";if(typeof f=="object"&&f!==null)try{return JSON.stringify(f,null,2)}catch{return String(f)}if(typeof f=="string"){const R=f.trim();if(R==="")return"N/A";try{const j=JSON.parse(R);return JSON.stringify(j,null,2)}catch{return R}}return String(f)},_=()=>{e.value=null,s.value=null,a.value="config",console.log("[useRightPanel] State reset")};return{selectedStep:Ne(e),activeTab:a,currentRootPlanId:l,fileBrowserPlanId:b,shouldShowNoTaskMessage:i,handleStepSelected:c,refreshCurrentStep:g,setActiveTab:E,updateDisplayedPlanProgress:v,clearSelectedStep:m,formatJson:w,reset:_}}let xt=null;function Wt(){return xt||(xt=em()),xt}const tm={class:"right-panel"},sm={class:"preview-header"},om={class:"preview-tabs"},nm={class:"preview-content"},am={key:0,class:"config-tab-content"},lm={key:0,class:"config-container"},rm={class:"template-info-header"},im={class:"template-info"},cm={class:"template-id"},um={key:1,class:"no-template-selected"},dm={class:"action-buttons"},pm=["title"],mm={class:"import-description"},hm={href:"https://github.com/Lynxe-public/Lynxe-public-prompts",target:"_blank",rel:"noopener noreferrer",class:"prompt-library-link"},fm={key:1,class:"step-details"},vm={key:0,class:"step-info"},gm={key:0,class:"agent-info"},ym={class:"info-item"},bm={class:"label"},_m=["title"],wm={class:"info-item"},$m={class:"label"},Sm={class:"value"},Pm={class:"execution-status"},Tm={class:"status-item"},Em={class:"status-text"},km={key:0},Cm={key:0,class:"think-act-steps"},Im={class:"steps-container"},Rm={class:"step-header"},xm={class:"step-number"},Am={class:"think-section"},Fm={class:"think-content"},Mm={class:"input"},Dm={class:"label"},Nm={class:"output"},Um={class:"label"},Lm={key:0,class:"action-section"},Om={class:"action-content"},qm={class:"tool-info"},Bm={class:"label"},Hm={class:"value"},Vm={class:"input"},jm={class:"label"},zm={class:"output"},Wm={class:"label"},Gm={key:0,class:"no-tools"},Km={key:0,class:"sub-plan-section"},Jm={class:"sub-plan-content"},Xm={class:"sub-plan-header"},Ym={class:"sub-plan-info"},Qm={class:"label"},Zm={class:"value"},eh={key:0,class:"sub-plan-info"},th={class:"label"},sh={class:"value"},oh={class:"sub-plan-status"},nh={class:"status-text"},ah={key:0,class:"no-steps-message"},lh={key:1,class:"no-execution-message"},rh={class:"step-basic-info"},ih={class:"info-item"},ch={class:"label"},uh={class:"value"},dh={key:0,class:"info-item"},ph={class:"label"},mh={class:"value"},hh={class:"info-item"},fh={class:"label"},vh={class:"no-execution-hint"},gh={key:2,class:"execution-indicator"},yh={class:"execution-text"},bh={key:1,class:"no-selection"},_h=["title"],wh={key:2,class:"file-browser-container"},$h={key:1,class:"no-plan-message"},Sh={class:"message-content"},Ph={class:"tips"},Th=Te({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:t}){const e=n,{t:s}=De(),a=Bt(),l=Wt(),r=We(),p=at(),{handleImport:b}=bo(),i=F(),c=F(!1),g=F(!0),E=F(!0),v=ae(()=>l.selectedStep.value),m=ae({get:()=>l.activeTab.value,set:N=>l.setActiveTab(N)}),w=ae(()=>l.fileBrowserPlanId.value),_=ae(()=>l.shouldShowNoTaskMessage.value),f=ae(()=>v.value?v.value.completed?s("rightPanel.status.completed"):v.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),R=async()=>{try{const N=r.getPlanType()||"dynamic_agent";await de.createNewTemplate(N);const q=r.selectedTemplate.value;q&&(r.reset(),r.setPlanType(q.planType||"dynamic_agent"),q.planTemplateId&&r.setPlanTemplateId(q.planTemplateId),r.setTitle(q.title||"")),console.log("[RightPanel] ðŸ”„ Reloading available tools for new template"),await p.loadAvailableTools()}catch(N){console.error("[RightPanel] Failed to create new plan:",N);const q=N instanceof Error?N.message:s("rightPanel.createPlanFailed");a.error(q)}},j=async N=>{await b(N,{onSuccess:async q=>{const ee=s("rightPanel.importSuccess",{total:q.total,success:q.successCount,failed:q.failureCount});a.success(ee)},onError:q=>{const ee=q instanceof Error?q.message:s("rightPanel.importFailed");a.error(ee)},onReload:async()=>{await de.loadPlanTemplateList()},onSingleTemplateImported:async q=>{q.planTemplateId&&(r.setPlanTemplateId(q.planTemplateId),await r.load(q.planTemplateId))}})},X=async N=>{await l.handleStepSelected(N),setTimeout(()=>{U()},100),W()},P=async()=>{await l.refreshCurrentStep(),W()};ye(()=>e.selectedStepId,async N=>{N?await X(N):l.clearSelectedStep()},{immediate:!0});const C=N=>{i.value=N??void 0},U=()=>{if(!i.value)return;const{scrollTop:N,scrollHeight:q,clientHeight:ee}=i.value,Se=q-N-ee<50,J=q>ee;g.value=Se,c.value=J&&!Se,Se?E.value=!0:q-N-ee>100&&(E.value=!1)},L=()=>{i.value&&(i.value.scrollTo({top:i.value.scrollHeight,behavior:"smooth"}),xe(()=>{E.value=!0,U()}))},W=()=>{!E.value||!i.value||xe(()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},S=l.formatJson,x=()=>{E.value=!0,i.value&&i.value.removeEventListener("scroll",U)},T=()=>{const N=()=>{const q=i.value;return q?(C(q),q.addEventListener("scroll",U),E.value=!0,U(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};xe(()=>{N()||setTimeout(()=>{N()},100)})};return Me(()=>{console.log("[RightPanel] Component mounted"),xe(()=>{T()})}),Ue(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),x()}),t({handleStepSelected:X,refreshCurrentStep:P,updateDisplayedPlanProgress:N=>{l.updateDisplayedPlanProgress(N)}}),(N,q)=>(h(),y("div",tm,[o("div",sm,[o("div",om,[o("div",{class:ve(["tab-item",{active:m.value==="config"}]),onClick:q[0]||(q[0]=ee=>m.value="config")},[A(d(D),{icon:"carbon:settings"}),o("span",null,u(d(s)("sidebar.configuration")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="details"}]),onClick:q[1]||(q[1]=ee=>m.value="details")},[A(d(D),{icon:"carbon:events"}),o("span",null,u(d(s)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ve(["tab-item",{active:m.value==="files"}]),onClick:q[2]||(q[2]=ee=>m.value="files")},[A(d(D),{icon:"carbon:folder"}),o("span",null,u(d(s)("fileBrowser.title")),1)],2)])]),o("div",nm,[m.value==="config"?(h(),y("div",am,[d(r).selectedTemplate.value?(h(),y("div",lm,[o("div",rm,[o("div",im,[o("h3",null,u(d(r).selectedTemplate.value.title||d(s)("sidebar.unnamedPlan")),1),o("span",cm,"ID: "+u(d(r).selectedTemplate.value.planTemplateId),1)]),o("button",{class:"back-to-list-btn",onClick:q[3]||(q[3]=ee=>d(ws).switchToTab("list"))},[A(d(D),{icon:"carbon:arrow-left",width:"16"})])]),A(Yp),A(xc)])):(h(),y("div",um,[o("div",dm,[o("button",{class:"new-task-btn",onClick:R},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u(d(s)("rightPanel.newFuncAgentPlan")),1)]),o("label",{class:"new-task-btn",title:d(s)("rightPanel.importExistingPlan")},[A(d(D),{icon:"carbon:import",width:"16"}),me(" "+u(d(s)("rightPanel.importExistingPlan"))+" ",1),o("input",{type:"file",accept:".json",onChange:j,style:{display:"none"}},null,32)],8,pm)]),o("p",mm,[me(u(d(s)("rightPanel.importDescription"))+" ",1),o("a",hm,u(d(s)("rightPanel.promptLibrary")),1),me(" "+u(d(s)("rightPanel.importDescriptionSuffix")),1)])]))])):H("",!0),m.value==="details"?(h(),y("div",fm,[v.value?(h(),y("div",vm,[o("h3",null,u(v.value.title||v.value.description||d(s)("rightPanel.defaultStepTitle",{number:1})),1),v.value.agentExecution?(h(),y("div",gm,[o("div",ym,[o("span",bm,u(d(s)("rightPanel.executingAgent"))+":",1),o("span",{class:"value",title:v.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.clickToViewExecutionDetails"):""},u(v.value.agentExecution.agentName==="ConfigurableDynaAgent"?d(s)("chat.funcAgentExecutionDetails"):v.value.agentExecution.agentName),9,_m)]),o("div",wm,[o("span",$m,u(d(s)("rightPanel.callingModel"))+":",1),o("span",Sm,u(v.value.agentExecution.modelName),1)])])):H("",!0),o("div",Pm,[o("div",Tm,[v.value.completed?(h(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):v.value.current?(h(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),$e(d(D),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",Em,u(f.value),1)])])])):H("",!0),o("div",{ref_key:"scrollContainer",ref:i,class:"step-details-scroll-container",onScroll:U},[v.value?(h(),y("div",km,[v.value.agentExecution?.thinkActSteps&&v.value.agentExecution.thinkActSteps.length>0?(h(),y("div",Cm,[o("h4",null,u(d(s)("rightPanel.thinkAndActionSteps")),1),o("div",Im,[(h(!0),y(he,null,ge(v.value.agentExecution.thinkActSteps,(ee,Se)=>(h(),y("div",{key:Se,class:"think-act-step"},[o("div",Rm,[o("span",xm,"#"+u(Se+1),1),o("span",{class:ve(["step-status",ee.status])},u(ee.status||d(s)("rightPanel.executing")),3)]),o("div",Am,[o("h5",null,[A(d(D),{icon:"carbon:thinking"}),me(" "+u(d(s)("rightPanel.thinking")),1)]),o("div",Fm,[o("div",Mm,[o("span",Dm,u(d(s)("rightPanel.input"))+":",1),o("pre",null,u(d(S)(ee.thinkInput)),1)]),o("div",Nm,[o("span",Um,u(d(s)("rightPanel.output"))+":",1),o("pre",null,u(d(S)(ee.thinkOutput)),1)])])]),ee.actionNeeded?(h(),y("div",Lm,[o("h5",null,[A(d(D),{icon:"carbon:play"}),me(" "+u(d(s)("rightPanel.action")),1)]),o("div",Om,[(h(!0),y(he,null,ge(ee.actToolInfoList||[],(J,ce)=>(h(),y("div",{key:`tool-${ce}-${J?.id||J?.name||ce}`,class:"tool-execution-item"},[o("div",qm,[o("span",Bm,u(d(s)("rightPanel.tool"))+":",1),o("span",Hm,u(J?.name||"N/A"),1)]),o("div",Vm,[o("span",jm,u(d(s)("rightPanel.toolParameters"))+":",1),o("pre",null,u(d(S)(J?.parameters)),1)]),o("div",zm,[o("span",Wm,u(d(s)("rightPanel.executionResult"))+":",1),o("pre",null,u(d(S)(J?.result)),1)])]))),128)),!ee.actToolInfoList||ee.actToolInfoList.length===0?(h(),y("div",Gm,[o("p",null,u(d(s)("rightPanel.noToolsExecuted")),1)])):H("",!0)]),ee.subPlanExecutionRecord?(h(),y("div",Km,[o("h5",null,[A(d(D),{icon:"carbon:tree-view"}),me(" "+u(d(s)("rightPanel.subPlan")),1)]),o("div",Jm,[o("div",Xm,[o("div",Ym,[o("span",Qm,u(N.$t("rightPanel.subPlanId"))+":",1),o("span",Zm,u(ee.subPlanExecutionRecord.currentPlanId),1)]),ee.subPlanExecutionRecord.title?(h(),y("div",eh,[o("span",th,u(N.$t("rightPanel.title"))+":",1),o("span",sh,u(ee.subPlanExecutionRecord.title),1)])):H("",!0),o("div",oh,[ee.subPlanExecutionRecord.completed?(h(),$e(d(D),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),$e(d(D),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",nh,u(ee.subPlanExecutionRecord.completed?N.$t("rightPanel.status.completed"):N.$t("rightPanel.status.executing")),1)])])])])):H("",!0)])):H("",!0)]))),128))]),v.value.agentExecution&&!v.value.agentExecution.thinkActSteps?.length?(h(),y("div",ah,[o("p",null,u(d(s)("rightPanel.noStepDetails")),1)])):v.value.agentExecution?H("",!0):(h(),y("div",lh,[A(d(D),{icon:"carbon:information",class:"info-icon"}),o("h4",null,u(d(s)("rightPanel.stepInfo")),1),o("div",rh,[o("div",ih,[o("span",ch,u(d(s)("rightPanel.stepName"))+":",1),o("span",uh,u(v.value.title||v.value.description||v.value.stepId),1)]),v.value.description?(h(),y("div",dh,[o("span",ph,u(N.$t("rightPanel.description"))+":",1),o("span",mh,u(v.value.description),1)])):H("",!0),o("div",hh,[o("span",fh,u(N.$t("rightPanel.status.label"))+":",1),o("span",{class:ve(["value",{"status-completed":v.value.completed,"status-current":v.value.current,"status-pending":!v.value.completed&&!v.value.current}])},u(v.value.completed?N.$t("rightPanel.status.completed"):v.value.current?N.$t("rightPanel.status.executing"):N.$t("rightPanel.status.pending")),3)])]),o("p",vh,u(d(s)("rightPanel.noExecutionInfo")),1)])),v.value.current&&!v.value.completed?(h(),y("div",gh,[q[4]||(q[4]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",yh,[A(d(D),{icon:"carbon:in-progress",class:"rotating-icon"}),me(" "+u(d(s)("rightPanel.stepExecuting")),1)])])):H("",!0)])):(h(),y("div",bh,[A(d(D),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,u(d(s)("rightPanel.noStepSelected")),1),o("p",null,u(d(s)("rightPanel.selectStepHint")),1)]))])):H("",!0),A(qt,{name:"scroll-button"},{default:Ye(()=>[c.value?(h(),y("button",{key:0,onClick:L,class:"scroll-to-bottom-btn",title:d(s)("rightPanel.scrollToBottom")},[A(d(D),{icon:"carbon:chevron-down"})],8,_h)):H("",!0)]),_:1})],544)])):H("",!0),m.value==="files"?(h(),y("div",wh,[w.value?(h(),$e(ei,{key:0,"plan-id":w.value},null,8,["plan-id"])):_.value?(h(),y("div",$h,[A(d(D),{icon:"carbon:folder-off"}),o("div",Sh,[o("h3",null,u(d(s)("fileBrowser.noFilesYet")),1),o("p",null,u(d(s)("fileBrowser.noPlanExecuting")),1),o("div",Ph,[A(d(D),{icon:"carbon:information"}),o("span",null,u(d(s)("fileBrowser.startTaskTip")),1)])])])):H("",!0)])):H("",!0)])]))}}),Eh=Ee(Th,[["__scopeId","data-v-afdd35f3"]]),kh={class:"template-list-container"},Ch={class:"organization-section"},Ih={class:"organization-row"},Rh={class:"organization-selector"},xh={class:"organization-label"},Ah=["value"],Fh={value:"by_time"},Mh={value:"by_abc"},Dh={value:"by_group_time"},Nh={value:"by_group_abc"},Uh={class:"search-input-wrapper"},Lh={class:"search-label"},Oh={class:"search-input-container"},qh=["placeholder"],Bh=["title"],Hh={class:"sidebar-content-list"},Vh={key:0,class:"loading-state"},jh={key:1,class:"error-state"},zh={key:2,class:"empty-state"},Wh=["onClick","title"],Gh=["onClick","title"],Kh={class:"group-name"},Jh={class:"group-count"},Xh=["onClick"],Yh={class:"task-icon"},Qh={class:"task-details"},Zh={class:"task-title"},ef={class:"task-time"},tf={class:"task-actions"},sf=["title","onClick"],of=Te({__name:"TemplateList",emits:["templateSelected"],setup(n,{emit:t}){const{t:e}=De(),s=We(),a=Wt(),l=F(""),r=t,p=v=>{const m=v.target;de.setOrganizationMethod(m.value)},b=v=>{if(isNaN(v.getTime()))return console.warn("Invalid date received:",v),e("time.unknown");const w=new Date().getTime()-v.getTime(),_=Math.floor(w/6e4),f=Math.floor(w/36e5),R=Math.floor(w/864e5);return _<1?e("time.now"):_<60?e("time.minuteAgo",{count:_}):f<24?e("time.hourAgo",{count:f}):R<30?e("time.dayAgo",{count:R}):v.toLocaleDateString("zh-CN")},i=ae(()=>{s.planTemplateList.value;const v=l.value.trim().toLowerCase(),m=de.groupedTemplates;if(!v)return m;const w=new Map;for(const[_,f]of m){const R=[];for(const j of f)(j.title||"").toLowerCase().includes(v)&&R.push(j);R.length>0&&w.set(_,R)}return w});ye(l,v=>{s.planTemplateList.value;const m=v.trim().toLowerCase();if(!m||de.organizationMethod!=="by_group_time"&&de.organizationMethod!=="by_group_abc")return;const w=de.groupedTemplates;for(const[_,f]of w){let R=!1;for(const j of f)if((j.title||"").toLowerCase().includes(m)){R=!0;break}R&&de.isGroupCollapsed(_)&&de.toggleGroupCollapse(_)}});const c=v=>{const m=v??"null";return de.groupCollapseState[m]??!1},g=v=>{de.toggleGroupCollapse(v)},E=async v=>{a.setActiveTab("config"),await de.selectTemplate(v),v.planTemplateId?(await s.load(v.planTemplateId),de.hasTaskRequirementModified=!1):(s.reset(),de.hasTaskRequirementModified=!1),r("templateSelected",v)};return(v,m)=>(h(),y("div",kh,[o("div",Ch,[o("div",Ih,[o("div",Rh,[o("label",xh,u(v.$t("sidebar.organizationLabel")),1),o("select",{value:d(de).organizationMethod,onChange:p,class:"organization-select"},[o("option",Fh,u(v.$t("sidebar.organizationByTime")),1),o("option",Mh,u(v.$t("sidebar.organizationByAbc")),1),o("option",Dh,u(v.$t("sidebar.organizationByGroupTime")),1),o("option",Nh,u(v.$t("sidebar.organizationByGroupAbc")),1)],40,Ah)]),o("div",Uh,[o("label",Lh,u(v.$t("sidebar.searchLabel")),1),o("div",Oh,[A(d(D),{icon:"carbon:search",width:"16",class:"search-icon"}),_e(o("input",{"onUpdate:modelValue":m[0]||(m[0]=w=>l.value=w),type:"text",class:"search-input",placeholder:v.$t("sidebar.searchPlaceholder")||"Search..."},null,8,qh),[[Ce,l.value]]),l.value?(h(),y("button",{key:0,class:"search-clear-btn",onClick:m[1]||(m[1]=w=>l.value=""),title:v.$t("sidebar.clearSearch")||"Clear search"},[A(d(D),{icon:"carbon:close",width:"14"})],8,Bh)):H("",!0)])])])]),o("div",Hh,[d(de).isLoading?(h(),y("div",Vh,[A(d(D),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,u(v.$t("sidebar.loading")),1)])):d(de).errorMessage?(h(),y("div",jh,[A(d(D),{icon:"carbon:warning",width:"20"}),o("span",null,u(d(de).errorMessage),1),o("button",{onClick:m[2]||(m[2]=(...w)=>d(de).loadPlanTemplateList&&d(de).loadPlanTemplateList(...w)),class:"retry-btn"},u(v.$t("sidebar.retry")),1)])):d(s).planTemplateList.value.length===0?(h(),y("div",zh,[A(d(D),{icon:"carbon:document",width:"32"}),o("span",null,u(v.$t("sidebar.noTemplates")),1)])):(h(!0),y(he,{key:3},ge(i.value,([w,_])=>(h(),y(he,{key:w||"ungrouped"},[(d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc")&&_.length>0?(h(),y("div",{key:0,class:"group-header",onClick:we(f=>g(w),["prevent"]),title:c(w)?v.$t("sidebar.expandGroup"):v.$t("sidebar.collapseGroup")},[o("button",{type:"button",class:"group-toggle-btn",onClick:we(f=>g(w),["stop","prevent"]),title:c(w)?v.$t("sidebar.expandGroup"):v.$t("sidebar.collapseGroup")},[A(d(D),{icon:c(w)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Gh),A(d(D),{icon:"carbon:folder",width:"16"}),o("span",Kh,u(w===null||w===""?v.$t("sidebar.ungroupedMethods"):w),1),o("span",Jh,"("+u(_.length)+")",1)],8,Wh)):H("",!0),(d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc")&&c(w)?H("",!0):(h(!0),y(he,{key:1},ge(_,f=>(h(),y("div",{key:f.planTemplateId||"unknown",class:ve(["sidebar-content-list-item",{"sidebar-content-list-item-active":f.planTemplateId===d(s).currentPlanTemplateId.value,"grouped-item":d(de).organizationMethod==="by_group_time"||d(de).organizationMethod==="by_group_abc"}]),onClick:R=>E(f)},[o("div",Yh,[A(d(D),{icon:"carbon:document",width:"20"})]),o("div",Qh,[o("div",Zh,u(f.title||v.$t("sidebar.unnamedPlan")),1)]),o("div",ef,u(b(d(s).parseDateTime(f.updateTime||f.createTime))),1),o("div",tf,[o("button",{class:"delete-task-btn",title:v.$t("sidebar.deleteTemplate"),onClick:we(R=>d(de).deleteTemplate(f),["stop"])},[A(d(D),{icon:"carbon:close",width:"16"})],8,sf)])],10,Xh))),128))],64))),128))])]))}}),nf=Ee(of,[["__scopeId","data-v-ef0e1961"]]),af={class:"sidebar-content"},lf={class:"sidebar-content-header"},rf={class:"sidebar-content-title"},cf={class:"tab-content"},uf=Te({name:"SidebarPanel",__name:"Sidebar",props:{width:{}},setup(n,{expose:t}){const e=n,s=at(),a=We(),l=Wt(),r=async()=>{const p=a.getPlanType()||"dynamic_agent";await de.createNewTemplate(p);const b=a.selectedTemplate.value;b&&(a.reset(),a.setPlanType(b.planType||"dynamic_agent"),b.planTemplateId&&a.setPlanTemplateId(b.planTemplateId),a.setTitle(b.title||"")),l.setActiveTab("config"),console.log("[Sidebar] ðŸ”„ Reloading available tools for new template"),await s.loadAvailableTools()};return Me(async()=>{await de.loadPlanTemplateList(),s.loadAvailableTools()}),t({loadPlanTemplateList:de.loadPlanTemplateList,toggleSidebar:ws.toggleSidebar}),(p,b)=>(h(),y("div",{class:"sidebar-wrapper",style:Xe({width:e.width+"%"})},[o("div",af,[o("div",lf,[o("div",rf,u(p.$t("sidebar.title")),1),o("button",{class:"new-task-btn",onClick:r},[A(d(D),{icon:"carbon:add",width:"16"}),me(" "+u(p.$t("sidebar.newPlan")),1)])]),o("div",cf,[A(nf)])])],4))}}),df=Ee(uf,[["__scopeId","data-v-0414be7c"]]);function pf(){const n=et(),t=Ze(),{showToast:e}=Ss(),{t:s}=De(),a=i=>{const c={currentPlanId:i.currentPlanId,status:i.completed?"completed":"running"};return i.rootPlanId&&(c.rootPlanId=i.rootPlanId),i.summary&&(c.summary=i.summary),i.completed!==void 0&&(c.completed=i.completed),i.agentExecutionSequence&&(c.agentExecutionSequence=i.agentExecutionSequence),c},l=i=>{if(!i)return console.warn("[useConversationHistory] Date value is null/undefined, using current time"),new Date;try{if(Array.isArray(i)){const[c,g,E,v=0,m=0,w=0,_=0]=i,f=new Date(c,g-1,E,v,m,w,Math.floor(_/1e6));return isNaN(f.getTime())?(console.warn("[useConversationHistory] Failed to parse date array:",i),new Date):f}if(typeof i=="string"){let c=new Date(i);if(!isNaN(c.getTime()))return c;const g=i.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?$/);if(g){const[,E,v,m,w,_,f,R]=g;if(c=new Date(parseInt(E),parseInt(v)-1,parseInt(m),parseInt(w),parseInt(_),parseInt(f),R?parseInt(R.substring(0,3)):0),!isNaN(c.getTime()))return c}return!i.includes("Z")&&!i.includes("+")&&!i.includes("-",10)&&(c=new Date(i+"Z"),!isNaN(c.getTime()))?c:(console.warn("[useConversationHistory] Failed to parse date string:",i),new Date)}if(typeof i=="number"){const c=i.toString().length<13?i*1e3:i,g=new Date(c);return isNaN(g.getTime())?(console.warn("[useConversationHistory] Failed to parse date number:",i),new Date):g}return console.warn("[useConversationHistory] Unknown date format:",i,typeof i),new Date}catch(c){return console.warn("[useConversationHistory] Error parsing date:",i,c),new Date}},r=i=>{if(!i)return;console.log("[useConversationHistory] Processing record:",{userRequest:i.userRequest,startTime:i.startTime,startTimeType:typeof i.startTime,endTime:i.endTime,endTimeType:typeof i.endTime});const c=i.userRequest||i.title||"History Round",g=n.createDialog(c),E=Ie.getConversationId();if(E){const v=n.getDialog(g.id);v&&(v.conversationId=E,i.rootPlanId&&(v.planId=i.rootPlanId),console.log("[useConversationHistory] Set conversationId on history dialog:",g.id,E))}if(i.userRequest&&i.startTime){const v=l(i.startTime);console.log("[useConversationHistory] Parsed date:",{original:i.startTime,parsed:v,parsedISO:v.toISOString(),isValid:!isNaN(v.getTime())});const m={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:i.userRequest,timestamp:v,isStreaming:!1};n.addMessageToDialog(g.id,m)}if(i.currentPlanId){const v=i.summary||i.result||i.message||"Execution completed",m=a(i),w={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"assistant",content:v,timestamp:i.endTime&&i.endTime?l(i.endTime):i.startTime?l(i.startTime):new Date,isStreaming:!1,planExecution:m};n.addMessageToDialog(g.id,w),i.rootPlanId&&t.setCachedPlanRecord(i.rootPlanId,m)}},p=async(i,c=!1,g=!0)=>{if(!i){console.warn("[useConversationHistory] Cannot load history: conversationId is empty");return}try{c&&n.clearMessages(),Ie.setConversationId(i),n.setConversationId(i);const E=await ht.getConversationHistory(i);if(console.log("[useConversationHistory] Loaded conversation history:",E),E.length>0){const v=E[0];console.log("[useConversationHistory] Sample date formats:",{startTime:v.startTime,endTime:v.endTime,startTimeType:typeof v.startTime})}for(const v of E)r(v);console.log("[useConversationHistory] Successfully loaded conversation history with",E.length,"dialog rounds")}catch(E){throw console.error("[useConversationHistory] Failed to load conversation history:",E),g&&e(s("memory.loadHistoryFailed"),"error"),E}};return{loadConversationHistory:p,restoreConversationHistory:async i=>p(i,!1,!1),processHistoryRecord:r}}let At=null;function mf(){return At||(At=pf()),At}const hf={class:"direct-page"},ff={class:"branding-header"},vf={class:"branding-content"},gf={class:"branding-actions"},yf=["title"],bf={class:"direct-chat"},_f=["title"],wf=["title"],$f={class:"chat-header"},Sf={class:"header-actions"},Pf=["title"],Tf=["title"],Ef={class:"chat-content"},kf={class:"message-content"},Cf=Te({name:"DirectIndex",__name:"index",setup(n){const t=fo(),e=vo(),s=yt(),{toast:a}=Ss(),l=et(),r=Ze(),p=mf(),b=F(""),i=F(),c=F(),g=F(null),E=F(50),v=F(80),m=F(!1),w=F(0),_=F(0),f=F(!1),R=F(0),j=F(0);Me(()=>{console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),ye(()=>r.planExecutionRecords,ue=>{for(const[M,B]of ue.entries())T(M)&&(i.value&&typeof i.value.updateDisplayedPlanProgress=="function"&&i.value.updateDisplayedPlanProgress(M),B.completed&&M===g.value&&(Array.from(ue.entries()).some(([se,le])=>se!==M&&le&&!le.completed&&le.status!=="failed")?console.log("[Direct] Current plan completed but other plans are still running, keeping currentRootPlanId"):(console.log("[Direct] All plans completed, clearing currentRootPlanId"),g.value=null)))},{deep:!0}),ye(()=>r.trackedPlanIds,ue=>{if(!g.value&&ue.value.size>0){const M=Array.from(ue.value)[0];g.value=M,console.log("[Direct] Set currentRootPlanId to:",M)}},{deep:!0});const J=Ie.getConversationId();if(J&&(console.log("[Direct] Found saved conversationId, restoring conversation:",J),xe(async()=>{try{await p.restoreConversationHistory(J)}catch(ue){console.error("[DirectView] Failed to restore conversation history:",ue)}})),de.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const ue=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",ue),ue.trim()?(s.markTaskAsProcessed(),xe(async()=>{try{console.log("[Direct] Calling messageDialog.sendMessage with taskContent:",ue),await l.sendMessage({input:ue})}catch(M){console.warn("[Direct] messageDialog.sendMessage failed, falling back to prompt:",M),b.value=ue}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),s.markTaskAsProcessed())}else s.taskToInput?console.log("[Direct] taskToInput available, InputArea will handle it automatically"):(b.value=t.query.prompt||"",console.log("[Direct] Received task from URL:",b.value),console.log("[Direct] No unprocessed task in store"));const ce=localStorage.getItem("directPanelWidth");ce&&(E.value=parseFloat(ce));const ke=localStorage.getItem("sidebarWidth");ke&&(v.value=parseFloat(ke)),console.log("[Direct] Final prompt value:",b.value)}),ye(()=>s.currentTask,J=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",J),J&&!J.processed&&J.prompt.trim()){const ce=J.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",ce),xe(async()=>{try{console.log("[Direct] Directly executing new task via messageDialog.sendMessage:",ce),await l.sendMessage({input:ce})}catch(ke){console.warn("[Direct] messageDialog.sendMessage failed for new task:",ke)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ye(()=>b.value,(J,ce)=>{console.log("[Direct] prompt value changed from:",ce,"to:",J)},{immediate:!1}),Ue(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),g.value=null,r.cleanup(),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",S)});const X=J=>{m.value=!0,w.value=J.clientX,_.value=E.value,document.addEventListener("mousemove",P),document.addEventListener("mouseup",C),document.body.style.cursor="col-resize",document.body.style.userSelect="none",J.preventDefault()},P=J=>{if(!m.value)return;const ce=window.innerWidth,ue=-(J.clientX-w.value)/ce*100;let M=_.value+ue;M=Math.max(20,Math.min(80,M)),E.value=M},C=()=>{m.value=!1,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",E.value.toString())},U=()=>{E.value=50,localStorage.setItem("directPanelWidth","50")},L=J=>{f.value=!0,R.value=J.clientX,j.value=v.value,document.addEventListener("mousemove",W),document.addEventListener("mouseup",S),document.body.style.cursor="col-resize",document.body.style.userSelect="none",J.preventDefault()},W=J=>{if(!f.value)return;const ce=window.innerWidth,ue=(J.clientX-R.value)/ce*100;let M=j.value+ue;M=Math.max(15,Math.min(100,M)),v.value=M},S=()=>{f.value=!1,document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",S),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",v.value.toString())},x=()=>{v.value=80,localStorage.setItem("sidebarWidth","80")},T=(J,ce=!1)=>!g.value||J===g.value||ce&&(J==="ui-state"||J==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",J,"current:",g.value),!1),O=J=>{console.log("[DirectView] Step selected:",J),i.value&&typeof i.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to config/preview panel:",J),i.value.handleStepSelected(J)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},N=()=>{e.push("/home")},q=()=>{e.push("/configs")},ee=async()=>{if(Ie.selectMemoryId){console.log("[DirectView] Memory selected:",Ie.selectMemoryId);try{await p.loadConversationHistory(Ie.selectMemoryId,!0,!0)}catch(J){console.error("[DirectView] Failed to load conversation history:",J)}}},Se=()=>{Ie.clearMemoryId(),Ie.clearConversationId(),l.reset()};return(J,ce)=>(h(),y("div",hf,[o("header",ff,[o("div",vf,[ce[1]||(ce[1]=o("div",{class:"branding-logo"},[o("img",{src:uo,alt:"Lynxe",class:"java-logo"}),o("h1",null,"Lynxe")],-1)),o("div",gf,[A(yo),o("button",{class:"back-button",onClick:N},[A(d(D),{icon:"carbon:arrow-left"})]),o("button",{class:"config-button",onClick:q,title:J.$t("direct.configuration")},[A(d(D),{icon:"carbon:settings-adjust",width:"20"})],8,yf)])])]),o("div",bf,[A(df,{ref_key:"sidebarRef",ref:c,width:v.value},null,8,["width"]),o("div",{class:"panel-resizer",onMousedown:L,onDblclick:x,title:J.$t("sidebar.resizeHint")},ce[2]||(ce[2]=[o("div",{class:"resizer-line"},null,-1)]),40,_f),A(Eh,{ref_key:"rightPanelRef",ref:i,style:Xe({width:100-v.value-E.value+"%"}),"current-root-plan-id":g.value},null,8,["style","current-root-plan-id"]),o("div",{class:"panel-resizer",onMousedown:X,onDblclick:U,title:J.$t("direct.panelResizeHint")},ce[3]||(ce[3]=[o("div",{class:"resizer-line"},null,-1)]),40,wf),o("div",{class:"left-panel",style:Xe({width:E.value+"%"})},[o("div",$f,[o("h2",null,u(J.$t("conversation")),1),o("div",Sf,[o("button",{class:"config-button",onClick:Se,title:J.$t("memory.newChat")},[A(d(D),{icon:"carbon:add",width:"20"})],8,Pf),o("button",{class:"cron-task-btn",onClick:ce[0]||(ce[0]=ke=>d(Ie).toggleSidebar()),title:J.$t("memory.selectMemory")},[A(d(D),{icon:"carbon:calendar",width:"20"})],8,Tf)])]),o("div",Ef,[A(ol,{onStepSelected:O})]),(h(),$e(Tl,{key:J.$i18n.locale,"initial-value":b.value},null,8,["initial-value"]))],4)]),A(fr,{onMemorySelected:ee}),d(a).show?(h(),y("div",{key:0,class:ve(["message-toast",d(a).type])},[o("div",kf,[o("span",null,u(d(a).text),1)])],2)):H("",!0)]))}}),ev=Ee(Cf,[["__scopeId","data-v-4b41408b"]]);export{ev as default};
//# sourceMappingURL=index-L0lcZ8Iw.js.map
